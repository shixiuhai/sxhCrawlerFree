!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Weblog={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function o(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function i(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var c,u,l,p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){void 0===p.window&&(p.window={addEventListener:function(){},removeEventListener:function(){},setTimeout:function(){},setInterval:function(){},_WEBLOGGER_MOCKED_WINDOW_:!0,global:p}),void 0===p.document&&(p.document=p.window.document||{cookie:"",addEventListener:function(){},removeEventListener:function(){},querySelector:function(){},querySelectorAll:function(){}},void 0===p.window.document&&(p.window.document=p.document)),void 0===p.navigator&&(p.navigator=p.window.navigator||{userAgent:""},void 0===p.window.navigator&&(p.window.navigator=p.navigator)),void 0===p.screen&&(p.screen=p.window.screen||{},void 0===p.window.screen&&(p.window.screen=p.screen)),void 0===p.history&&(p.history=p.window.history||{},void 0===p.window.history&&(p.window.history=p.history)),void 0===p.location&&(p.location=p.window.location||{hostname:"",search:"",href:"",origin:""},void 0===p.window.location&&(p.window.location=p.location));try{void 0===p.localStorage&&(p.localStorage=p.window.localStorage||{getItem:function(){},setItem:function(){}},void 0===p.window.localStorage&&(p.window.localStorage=p.localStorage))}catch(t){}}(),Object.defineProperty||(Object.defineProperty=function(t,e,n){t[e]="[object Object]"===Object.prototype.toString.call(n)&&n.hasOwnProperty("value")?n.value:n}),Object.assign||Object.defineProperty(Object,"assign",{value:function(t){if(null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!==r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},writable:!0,configurable:!0}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,r=function(){},o=function(){var o=this instanceof r?this:t;return n.apply(o,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),o.prototype=new r,o}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),o=r.length>>>0;if(0===o)return-1;var i=+e||0;if(Math.abs(i)===1/0&&(i=0),i>=o)return-1;for(n=Math.max(i>=0?i:o-Math.abs(i),0);n<o;){if(n in r&&r[n]===t)return n;n++}return-1}),Object.keys||(Object.keys=(c=Object.prototype.hasOwnProperty,u=!{toString:null}.propertyIsEnumerable("toString"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var e=[];for(var n in t)c.call(t,n)&&e.push(n);if(u)for(var r=0,o=l;r<o.length;r++){var i=o[r];c.call(t,i)&&e.push(i)}return e})),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,r;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),r=0;r<i;){var a=void 0;r in o&&(a=o[r],t.call(n,a,r,o)),r++}});var d,f,h={sessionId:"",appDevicePackageReady:!1,identityPackageReady:!1},g={unknown:0,none:1,wifi:2,"4g":3,"3g":4,"2g":5,"5g":7,"slow-2g":5};!function(t){t.CLICK="CLICK",t.DOUBLE_CLICK="DOUBLE_CLICK",t.TRIPLE_CLICK="TRIPLE_CLICK",t.LONG_PRESS="LONG_PRESS",t.PULL="PULL",t.DRAG="DRAG",t.SCALE="SCALE",t.PULL_DOWN="PULL_DOWN",t.PULL_UP="PULL_UP"}(d||(d={})),function(t){t.PV="PV",t.SHOW="SHOW",t.VIDEO="VIDEO",t.CUSTOM="CUSTOM",t.RADAR="RADAR"}(f||(f={}));var m=function(){function t(t,e){switch(this.page="",this.identity="",e){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(t.page,t.params)}return t.prototype.update=function(t,e){void 0===t&&(t=""),t&&t!==this.page&&(this.page=t,this.identity=this.generatePageId(t)),e&&(this.params=Object.assign(this.params||{},e))},t.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params)}},t.prototype.generatePageId=function(t){return t+(new Date).getTime()},t}(),v=["Kwai","Kwai_Lite","Kwai_Pro","livemate","ksthanos","ksNebula","ksnebula","kwaiying","pearl","kinder","m2u","LOLita","XFunCore","ACVideoCore","ZIKZAK"].concat(["UVideo","Vstatus","Kwaigo","MvMaster"]);function y(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return null===console||void 0===console?void 0:(t=console.warn).call.apply(t,s([null],e))}function _(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return null===console||void 0===console?void 0:(t=console.error).call.apply(t,s([null],e))}function w(t,e,n,r){return"attachEvent"in t?t.attachEvent("on"+e,n):t.addEventListener(e,n,r)}function S(t,e,n,r){return"attachEvent"in t?t.detachEvent("on"+e,n):t.removeEventListener(e,n,r)}function b(t,e,n){if(void 0===n&&(n=" "),(e-=t.length)<=0)return t;for(var r="";e;)1&e&&(r+=n),e>>=1,n+=n;return r+t}var E=function(){var t=null;return function(){try{if(null===t)for(var e=window.navigator.userAgent.toLowerCase(),n=0;n<v.length;n++)if(e.indexOf(v[n].toLowerCase())>-1)return t=!0}catch(t){return!1}}}();function k(t){for(var e={},n=0,r=t.split("&");n<r.length;n++){var o=r[n].split("="),i=o[0],a=o[1];i in e?e[i]instanceof Array?e[i].push(a):e[i]=[e[i],a]:e[i]=a}return e}function P(t){var e="";if("string"==typeof t)e=t;else try{e=JSON.stringify(t)}catch(n){e=String(t)}for(var n=0,r=0;r<e.length;r++){var o=e.charCodeAt(r);n+=o<128?1:o<2048?2:o<65536?3:o<1<<21?4:o<1<<26?5:o<1<<31?6:Number.NaN}return n}function T(t){void 0===t&&(t=location.href);var e=t.lastIndexOf("?");return-1===e?{page:t}:{page:t.slice(0,e),params:k(t.slice(e+1))}}var O=function(t,e){var n=t.url,r=t.page,o=t.params,i=t.pageId;if(!r&&"string"==typeof n){var a=T(n);r=a.page,o=a.params}if("function"==typeof e)try{var s=e({url:n,page:r,params:o});"string"==typeof s?r=s:"object"==typeof s&&(s.page&&(r=s.page),s.params&&(o=s.params),s.pageId&&(i=s.pageId))}catch(t){}else if("object"==typeof e){var c="";for(var u in e)if((n||r||"").indexOf(u)>-1){c=e[u];break}c&&(r=c)}return{page:r,params:o,pageId:i}},L=function(t){return t&&"object"==typeof t&&!Array.isArray(t)};var C,N=(C="",function(){if(C)return C;try{var t=window.devicePixelRatio||1,e=Math.floor(screen.width*t),n=Math.floor(screen.height*t);return C=e+"x"+n}catch(t){return""}});var U=function(){function t(){this.events={}}return t.prototype.on=function(t,e){e&&"function"==typeof e&&(this.events[t]=this.events[t]||[],this.events[t].push(e))},t.prototype.off=function(t,e){this.events[t]&&(e&&"function"==typeof e&&function(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}(this.events[t],e),e||(this.events[t]=[]))},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.events[t]&&this.events[t].forEach((function(t){t.apply(void 0,e)}))},t}(),R=0,x=function(t){function e(n,o){var i,a=t.call(this)||this;return a.version="3.9.21",a.plugins={},a.flush=function(){a.logger.flush()},a.baseOption=r({},o),a.logConfig=(i=n,r({env:"production",proto:"v3",timeout:3e4,wait:1e3,maxBatchLength:50,sampleRate:1,yoda:"undefined"!=typeof window&&window.yoda},i||{})),a.initUrlPackage(),e.__instance||(e.__instance=a),a}return n(e,t),Object.defineProperty(e.prototype,"sessionId",{get:function(){return h.sessionId},enumerable:!1,configurable:!0}),e.prototype.initUrlPackage=function(){this.updateCurrentUrlPackage()},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e="web"),"object"==typeof t&&t.page&&this.currentUrlPackage&&t.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(t.page,t.params);this.currentUrlPackage=new m(t,e)},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof m?t:new m(t,e)},e.prototype.updateBase=function(t){this.updateCommonPackage(t)},e.prototype.updateCommonPackage=function(t){"object"==typeof t&&this.commonPackage.update(t)},e.prototype.addPlugins=function(){var t=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(e){"object"==typeof e&&"function"==typeof e.apply&&t.addPluginInstance(e)}))},e.prototype.addPluginInstance=function(t){if(t){var e=t.key||t.constructor&&t.constructor.key||"plugin_auto_key_"+R++;"function"!=typeof t.apply||t.weblog&&t.weblog===this||t.apply(this),this.plugins[e]=t}},e.prototype.plug=function(t,e){if(this.plugins[t.key])return _("[code 301]",t.key+" 插件重复加载！");this.addPluginInstance(new t(this,e))},e.prototype.unplug=function(t){var e=this.plugins[t];e&&(e.destroy(),delete this.plugins[t])},e.prototype.unplugAll=function(){for(var t in this.plugins)this.plugins[t]&&this.unplug(t)},e.prototype.generateLog=function(t,e){return{}},e.prototype.send=function(t,e,n){void 0===t&&(t=d.CLICK);var r=this.generateLog(t.toUpperCase(),e),o="object"==typeof e&&e.callback||void 0;return"function"==typeof this.beforeSend&&this.beforeSend(t,e,r),this.logger.send(r,!!n,o)},e.prototype.collect=function(t,e){this.send(t,e)},e.prototype.sendImmediately=function(t,e){this.send(t,e,!0)},e.prototype.sendPackage=function(t,e){this.logger.sendPackage(t,e)},e.prototype.destroy=function(){this.unplugAll()},e}(U);function I(t,e,n){var r={};if(t.length>0)for(var o=e?decodeURIComponent:function(t){return t},i=t.split(/;\s/g),a=null,s=null,c=null,u=0,l=i.length;u<l;u++){if(null!==(c=i[u].match(/([^=]+)=/i)))try{a=decodeURIComponent(c[1]),s=o(i[u].substring(c[1].length+1))}catch(t){}else a=decodeURIComponent(i[u]),s="";null!==a&&(r[a]=s)}return r}var A,D={};function M(t,e,n){void 0===e&&(e={}),void 0===n&&(n=!1);try{if(!n&&t in D)return D[t];if(!(null===window||void 0===window?void 0:window.document))return;var r=document.cookie||"";return r===A?D[t]:(A=r,(D=I(r,!e.raw))[t])}catch(t){}}function j(t,e,n){void 0===n&&(n={});try{document.cookie=function(t,e,n,r){void 0===r&&(r={});var o=encodeURIComponent(t)+"="+(n?encodeURIComponent(e):e),i=r.expires,a=r.path||"/",s=r.domain||"";return i instanceof Date&&(o+="; expires="+i.toUTCString()),"number"==typeof i&&(o+="; max-age=="+i),""!==a&&(o+="; path="+a),""!==s&&(o+="; domain="+s),!0===r.secure&&(o+="; secure"),o}(t,e,!n.raw,n),D[t]=e}catch(t){}}var K={getCookie:M,setCookie:j,parseCookieString:I};function V(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function W(t){if(void 0===t&&(t="undefined"!=typeof location?location.hostname:""),!t)return"";var e=t.split("."),n=e.length;return n<=2?"":"."+e[n-2]+"."+e[n-1]}var F="";function B(){if(F)return F;try{if(!(F=M("did")||M("_did"))){F="web_"+function(){for(var t=1e9*Math.random()>>>0,e=[],n=0;n<7;n++)e.push("0123456789ABCDEF".charAt(16*Math.random()));return t+e.join("")}();var t=new Date;t.setFullYear(t.getFullYear()+1),j("_did",F,{expires:t,domain:W(),path:"/"})}return F}catch(t){return""}}var H,G,q,J=function(t){function e(e,n,r){var o=t.call(this,{},n)||this;if("string"==typeof e){var i=T(e);o.page=i.page,o.params=i.params}else o.page=(e||{}).page||"",o.params=(e||{}).params||void 0;return o.identity=o.generatePageId(),r&&"string"==typeof e&&o.init(e,r),o}return n(e,t),e.prototype.init=function(t,e){void 0===e&&(e={});var n=O({url:t,page:this.page,params:this.params},e),r=n.page,o=n.params;this.update(r,o)},e.prototype.attachUrl=function(){this.params||(this.params={}),this.params.origin_url=this.params.origin_url||(null===location||void 0===location?void 0:location.href)},e.prototype.getRealUrlPackage=function(){var t=T(location.href);t.page;var e=t.params;return{page:this.page,params:JSON.stringify(r({url:location.href,query:e},e)),page_type:this.page_type,identity:this.identity}},e.prototype.generatePageId=function(){return V()},e}(m),Q=function(){function t(t){if(this.identity_package={device_id:void 0,global_id:void 0,user_id:void 0,union_id:void 0,open_id:void 0,iu_id:void 0},this.app_package={product:void 0,language:void 0,platform:void 0,container:"H5",package_name:void 0,product_name:void 0,version_name:void 0,channel:void 0,version_code:void 0},this.experiment=void 0,this.service_name=void 0,this.safety_id=void 0,this.sub_biz=void 0,this.device_package={os_version:void 0,model:void 0,ua:void 0},this.need_encrypt=!1,this.network_package={type:g.unknown},this.h5_extra_attr={sdk_name:"webLogger",sdk_version:"3.9.21",sdk_bundle:"log.browser-full.js"},this.global_attr={entry_tag:[]},this.update(t),this.app_package.version_name){var e=this.app_package.version_name.lastIndexOf(".");this.app_package.version_code=+this.app_package.version_name.slice(e+1)||0}this.app_package.version_name||(this.app_package.version_name=void 0),this.app_package.version_code||(this.app_package.version_code=void 0)}return t.prototype.getH5ExtraAttr=function(t){return Object.assign({},this.h5_extra_attr,t)},t.prototype.update=function(t){if("object"==typeof t){!function(t,e){if(L(t)&&L(e)){var n=function(t,e,n){L(t[n])&&L(e[n])?Object.assign(t[n],e[n]):L(t[n])||L(e[n])||(t[n]=e[n])};for(var r in e)if(t.hasOwnProperty(r))n(t,e,r);else for(var o in t)L(t[o])&&t[o].hasOwnProperty(r)&&n(t[o],e,r)}}(this,t);var e=t.network_type;e&&g[e]&&(this.network_package.type=g[e])}},t.prototype.updateGlobalAttr=function(t){Object.assign(this.global_attr||{},t)},t.prototype.toJSON=function(){this.identity_package.user_id||(this.identity_package.user_id=void 0);var t=r(r({},this),{toJSON:function(){return r(r({},t),{h5_extra_attr:JSON.stringify(t.h5_extra_attr),global_attr:JSON.stringify(t.global_attr)})}});return t.global_attr=r({},this.global_attr),this.global_attr.entry_tag&&this.global_attr.entry_tag.length?t.global_attr.entry_tag=this.global_attr.entry_tag.slice():delete t.global_attr.entry_tag,Object.keys(this.global_attr).length||delete t.global_attr,t},t}(),Y="https://data-track.corp.kuaishou.com",z=Y+"/",X="production",$="logger",Z="logger-oversea",tt="rest/wd/common/log/collect/",et=[X,"test","development",$,"oversea"],nt="https://logsdk.kwai-pro.com/",rt={v2:"rest/kd/log/collect?_json=1&biz=",v3:tt+"misc2",radar:tt+"radar"},ot={v2:{production:["https://wlog.ksapisrv.com/","https://wlog.gifshow.com/"][Math.round(Math.random())],development:z,test:z,oversea:nt},v3:{production:"https://log-sdk.ksapisrv.com/",development:z,test:z,oversea:nt}},it=function(t,e,n){return void 0===t&&(t=X),void 0===e&&(e=!1),void 0===n&&(n="v3"),-1===et.indexOf(t)?t+rt[n]:e&&ot.v3[t]?ot.v3[t]+rt.radar:ot[n][t]&&rt[n]?ot[n][t]+rt[n]:ot.v3.production+rt.v3},at=function(t,e){if(!e)return t;try{return/\?(.+?)$/.test(t)?t.replace(/\?(.+?)$/,"?"+e+"&$1"):t+"?"+e}catch(e){return t}},st=function(){function t(t,e){var n=this;this.asyncQueue=[],this.throttleQueue=[],this.errorQueue=[],this.sendingQueue={},this.url="",this.isV2=!1,this.isDebug=!1,this.radarUrl="",this.drained=!1,this.batchCount=50,this.sendingYield=null,this.flush=function(t){n.sendLogs(n.throttleQueue.concat(n.asyncQueue),t),n.throttleQueue=[],n.asyncQueue=[]},this.drain=function(){n.drained=!0,n.flush(),n.flushErrorLogs(),setTimeout((function(){n.drained=!1}),1e3)},this.config=t,this.config.maxBatchLength&&this.config.maxBatchLength>1&&(this.batchCount=Math.min(50,this.config.maxBatchLength)),this.commonPackage=e,this.isDebug=this.config.logger||"logger"===this.config.env,this.isV2="v2"===this.config.proto,"function"==typeof this.config.sender&&(this.baseSendData=this.config.sender),this.updateUrls()}return t.prototype.sendData=function(t,e){this.config.sender?this.config.sender(t,e):this.baseSendData(t,e)},t.prototype.updateUrls=function(){var t=this.config.env;t&&/^(https?:)?\/\//.test(t)?this.url=t:this.url=it(t),this.formatUrl()},t.prototype.formatUrl=function(){this.radarUrl||(this.radarUrl=this.url.replace(-1!==this.url.indexOf(rt.v2)?rt.v2:rt.v3,rt.radar),-1!==this.radarUrl.indexOf(ot.v2.production)&&this.radarUrl.replace(ot.v2.production,ot.v3.production));var t=this.commonPackage.app_package,e=t.product_name,n=t.product,r="v=3.9.21&kpn="+(e||n);this.url=at(this.url,r),this.radarUrl=at(this.radarUrl,r)},t.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},t.prototype.send=function(t,e,n){if(void 0===e&&(e=!1),n||this.drained)return this.sendLogs([t],n);e?this.sendAsync(t,n):this.sendThrottle(t)},t.prototype.sendAsync=function(t,e){return i(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this.asyncQueue.push(t),this.asyncQueue.length>=this.batchCount?(this.flush(),[2]):this.sendingYield?[4,this.sendingYield]:[3,2];case 1:e.sent(),this.sendingYield=null,e.label=2;case 2:return e.trys.push([2,4,,5]),[4,Promise.resolve()];case 3:case 4:return e.sent(),[3,5];case 5:return this.asyncQueue.length?(this.flush(),[2]):[2]}}))}))},t.prototype.sendThrottle=function(t){var e=this;this.throttleQueue.push(t),this.throttleQueue.length>=this.batchCount?this.flush():(clearTimeout(this.batchWaitTimer),this.batchWaitTimer=setTimeout((function(){e.flush()}),this.config.wait))},t.prototype.sendLogs=function(t,e){var n=this;if(!t||!t.length)return"function"==typeof e&&e();var r=this.buildLogPackage(t,this.url);this.sendPackage(r,(function(t){t?n.errHandler(r):n.flushErrorLogs(),"function"==typeof e&&e(t)}))},t.prototype.sendPackage=function(t,e){var n=this.config.timeout;try{this.sendData(r(r({},t),{isDebug:this.isDebug,timeout:n}),e)}catch(t){"function"==typeof e&&e(t)}},t.prototype.buildLogPackage=function(t,e){return this.isV2?this.buildV2Package(t,e):this.buildV3Package(t,e)},t.prototype.buildV2Package=function(t,e){return{url:e,data:{log:{event:t}}}},t.prototype.buildV3Package=function(t,e,n){var r=this.getCommonPackageJSON();return n&&Object.assign(r,n),{url:e,data:{common:r,logs:t}}},t.prototype.errHandler=function(t){var e;if(this.isV2)this.errorQueue.unshift(t);else{var n=t.data;if(n.logs.length){delete n.common.h5_extra_attr.http_seq_id,delete n.common.h5_extra_attr.client_timestamp;for(var r=!1,o=0;o<this.errorQueue.length;o++){var i=this.errorQueue[o];if(i.url===t.url&&i.data.logs.length+n.logs.length<=100&&JSON.stringify(i.data.common)===JSON.stringify(n.common)){r=!0,(e=i.data.logs).push.apply(e,n.logs);break}}r||(this.errorQueue.length>=5&&this.errorQueue.pop(),this.errorQueue.unshift(t))}}},t.prototype.flushErrorLogs=function(){var t=this;this.errorQueue.forEach((function(e){t.sendPackage(e)})),this.errorQueue=[]},t.prototype.destory=function(){this.batchWaitTimer&&clearTimeout(this.batchWaitTimer),this.compensateTimer&&clearTimeout(this.compensateTimer)},t.prototype.sendRadar=function(t,e){var n=e?{service_name:e}:void 0,r=this.buildV3Package([t],this.radarUrl||this.url,n);this.sendPackage(r)},t}(),ct=(null===(H=null===window||void 0===window?void 0:window.navigator)||void 0===H?void 0:H.userAgent)||"",ut=function(){if(G)return G;var t="unknow",e=/android/i,n="Mac OS",r="Windows",o="Android",i="iPhone",a="iPhone",s="Windows Phone",c="Linux";G={os:{name:t,version:t},model:t};try{var u=ct.match(/\((.*?)\)/);if(!u)return e.test(ct)&&(G.os.name=o),G;var l=u[1]+")",p=l.split(";").map((function(t){return t.trim()})),d=void 0,f=void 0,h=void 0;if(ct.indexOf(s)>-1)h=d=s,(v=l.match(/Windows\sPhone\s(.*?)[;\)\s]/))&&(f=v[1]),h=p[p.length-1].replace(")","");else if(e.test(ct)){d=o;var g=l.match(/android.*?;(.*?)build\//i);g&&(h=(h=g[1].split(";").pop())&&h.trim());for(var m=0;m<p.length;m++)if(e.test(p[m])){f=p[m].replace(e,""),h||(h=p[m+1]);break}}else if(ct.indexOf(i)>-1||ct.indexOf(a)>-1){h=ct.indexOf(i)>-1?i:a,d="iOS",(v=l.match(/OS\s(.*?)\slike/))&&(f=v[1])}else if(ct.indexOf(n)>-1){h=d=n,(v=l.match(/OS\sX\s(.*?)[;\)\s]/))&&(f=v[1])}else if(ct.indexOf(r)>-1){var v;h=d=r,(v=l.match(/Windows\s(.*?)[;\)]/))&&(f=v[1])}else if(ct.indexOf("Nokia")>-1){d="Symbian";var y=ct.match(/Symbian.*?\/(.*?);/);y&&(f=y[1]);var _=ct.match(/Nokia(.*?)\//);_&&(h=_[1])}else l.indexOf(c)>-1&&(d=h=c);G={os:{name:d||t,version:f&&f.replace(/_/g,".").trim()||t},model:h||t}}catch(t){}return G};function lt(){return void 0===q&&(q=E()&&M("kpn")||function(){if("undefined"==typeof window)return"";for(var t=window.navigator.userAgent,e=[[/ wxwork\//,"workWechat"],[/ MicroMessenger\//,"wechat"],[/ Kwai\//,"KUAISHOU"],[/ ksthanos\//,"THANOS"],[/ ksNebula\//i,"NEBULA"],[/ QQ\//,"qq"],[/__weibo__([^_]+)/,"weibo"],[/ livemate\//,"livemate"],[/ baiduboxapp\//,"baidu"],[/ MQQBrowser\//,"qqBrowser"],[/\(MSIE ([^;]+);/,"ie"]],n=0;n<e.length;n++){var r=e[n],o=r[0],i=r[1];if(o.exec(t))return i}return""}()||""),q}var pt={supportsPushState:function(){var t=window.navigator.userAgent;return(-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)},getUAInfo:ut,getDefaultKpn:lt},dt=[["a7","640x1136",["iPhone 5","iPhone 5s"]],["a7","1536x2048",["iPad Air","iPad Mini 2","iPad Mini 3"]],["a8","640x1136",["iPod touch (6th gen)"]],["a8","750x1334",["iPhone 6"]],["a8","1242x2208",["iPhone 6 Plus"]],["a8","1536x2048",["iPad Air 2","iPad Mini 4"]],["a9","640x1136",["iPhone SE"]],["a9","750x1334",["iPhone 6s"]],["a9","1242x2208",["iPhone 6s Plus"]],["a9x","1536x2048",["iPad Pro (1st gen 9.7-inch)"]],["a9x","2048x2732",["iPad Pro (1st gen 12.9-inch)"]],["a10","750x1334",["iPhone 7"]],["a10","1242x2208",["iPhone 7 Plus"]],["a10x","1668x2224",["iPad Pro (2th gen 10.5-inch)"]],["a10x","2048x2732",["iPad Pro (2th gen 12.9-inch)"]],["a11","750x1334",["iPhone 8"]],["a11","1242x2208",["iPhone 8 Plus"]],["a11","1125x2436",["iPhone X"]],["a12","828x1792",["iPhone Xr"]],["a12","1125x2436",["iPhone Xs"]],["a12","1242x2688",["iPhone Xs Max"]],["a12x","1668x2388",["iPad Pro (3rd gen 11-inch)"]],["a12x","2048x2732",["iPad Pro (3rd gen 12.9-inch)"]]],ft=function(){try{var t=ut(),e=E(),n=t.model||t.os.name||"unknown";if("iOS"!==t.os.name||e)return n;var r=function(){for(var t=N(),e=[],n=0,r=dt;n<r.length;n++){var o=r[n];t===o[1]&&(e=e.concat(o[2]))}return e.length&&e}();return r?r.join(" or "):n}catch(t){return"unknown"}},ht={},gt=function(t){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0;return e+1>1e8&&(e=0),function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,e+1),e}}catch(t){}return ht[t]||(ht[t]=0),ht[t]++},mt=0,vt=E();function yt(){try{var t=ut().os.name;return mt=t?"Android"===t?vt?6:8:"iOS"===t?vt?7:9:10:0}catch(t){return 0}}function _t(){var t="unknown",e=null===window||void 0===window?void 0:window.navigator,n=(null==e?void 0:e.connection)||(null==e?void 0:e.mozConnection)||(null==e?void 0:e.webkitConnection);return n&&(t=n.type||n.effectiveType),t}var wt=function(t){function e(e){var n=t.call(this,r({platform:yt(),container:10===mt?"WEB":"H5",version_name:vt&&M("appver",void 0,!0)||"",network_type:_t(),device_id:B(),global_id:vt&&M("egid")||"",app_package:{language:navigator.language},device_package:{os_version:ut().os.version,model:ft(),ua:navigator.userAgent}},e))||this;return Object.assign(n.h5_extra_attr,{host_product:lt(),resolution:N(),screen_with:screen.width,screen_height:screen.height,device_pixel_ratio:window.devicePixelRatio||1,domain:window.location.origin},e.h5_extra_attr),n}return n(e,t),e.prototype.getVersionName=function(){return this.app_package.version_name},e.prototype.update=function(e){t.prototype.update.call(this,e);var n=this.app_package.version_name;if("string"==typeof n){var r=n.lastIndexOf(".");this.app_package.version_code=+n.slice(r+1)||0,this.h5_extra_attr.app_version_name=n}},e.prototype.setAdditionalSeqIdPackage=function(t){var e,n;this.additional_seq_id_package={channel:3,channel_seq_id:(n="NORMAL",void 0===n&&(n=""),gt("WEBLOGGER_CHANNEL_SEQ_ID_"+n)),custom_type:t,custom_seq_id:(e=t,gt("WEBLOGGER_V2_SEQ_ID_"+e))}},e.prototype.increaseH5SeqId=function(t){this.h5_extra_attr.client_timestamp=(new Date).valueOf(),this.h5_extra_attr.seq_id=gt(t?"WEBLOGGER_H5_CUSTOM_SEQ_ID":"WEBLOGGER_H5_SEQ_ID")},e}(Q),St=function(t,e,n){return _("[error 400]","埋点上报接口请求报错","\nurl:",e,"\ndata",n,"\nerror:",t||"server decode log failed")};function bt(t,e){var n=t.url,r=t.data,o=t.timeout,i=new XMLHttpRequest;i.open("POST",n),"object"==typeof r&&(r=JSON.stringify(r)),i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),o&&(i.timeout=o),i.onload=function(){var t=function(t,e,n,r){if(t<200||t>=300&&304!==t){var o=e||t||"unknonw error";return St(o,n,r),o}try{var i=JSON.parse(e),a=i.exception,s=i.result,c=i.error_msg;a&&St(a,n,r),1!==s&&St(c||"result is "+s,n,r)}catch(t){St(t.message,n,r)}}(i.status,i.response,n,r);e&&e(t)},i.ontimeout=i.onerror=function(t){t&&St(t,n,r),e&&e(t)},i.send(r)}var Et=function(t){var e=function(e){return _("[error 401]","GET 请求出错 url: "+t,e)};try{var n=new XMLHttpRequest;n.open("GET",t),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(),n.onerror=e}catch(t){e(t)}},kt=null===window||void 0===window?void 0:window.navigator,Pt=kt&&-1!==kt.userAgent.indexOf("Chrome")&&"function"==typeof kt.sendBeacon;function Tt(t,e){var n=t.url,r=t.data,o=t.timeout,i=t.isDebug;if(r=JSON.stringify(r),!i&&function(t){var e=t.url,n=t.data;if(!Pt)return!1;"object"==typeof n&&n.fd&&(n=n.fd);try{return kt.sendBeacon(e,n)}catch(t){return _("[error 403]","navigator.sendBeacon 报错",t),!1}}({url:n,data:r}))return e&&e();bt({url:n,data:r,timeout:o},e)}var Ot,Lt,Ct,Nt=function(t,e,n){return void 0===t&&(t=Y),function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];null===console||void 0===console||(t=console.log).call.apply(t,s([null],e))}("%c埋点抓包校验: %c"+(t+"/#/logger/index?sessionId="+n),"color:#1abf89;font-size:1.2em;line-height:2.4em;","font-size:1.2em;"),e+"/"+n+"/"},Ut="weblogger_switch",Rt=function(t){var e=function(){try{var t=M(Ut)||"undefined"!=typeof sessionStorage&&sessionStorage.getItem(Ut);if(!t)return;var e=JSON.parse(t),n=e.loggerSessionId,r=e.reportHost,o=e.loggerHost,i=e.handshakeApi;return n?(Et(i||r+"/"+n),Nt(o,r,n)):""}catch(t){return""}}()||function(t){void 0===t&&(t=location.href);var e=t.lastIndexOf("?");if(-1===e)return"";var n=k(t.slice(e+1)).webloggerSwitch;if(!n)return"";try{var r=decodeURIComponent(n),o=JSON.parse(r),i=o.loggerSessionId,a=o.reportHost,s=o.loggerHost,c=o.handshakeApi;return i?("undefined"!=typeof sessionStorage&&sessionStorage.setItem(Ut,r),Et(c||a+"/"+i),Nt(s,a,i)):""}catch(t){return""}}();if(e)return it(e,!1,t)},xt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.baseSendData=Tt,r}return n(e,t),e.prototype.updateUrls=function(){var t=this.config,e=t.env,n=t.logger,r=t.proto,o=!t.isBridge&&Rt(r);if(o)this.url=o;else if(n||e===$||e===Z){var i=function(t,e){void 0===t&&(t=B()),void 0===e&&(e=!1);var n=e?"https://data-track-sgp.corp.kuaishou.com":Y;return Et(n+"/rest/"+t),Nt(n,n+"/rest",t)}(this.commonPackage.identity_package.device_id,e===Z);this.url=it(i,!1,r)}else e&&/^(https?:)?\/\//.test(e)?this.url=e:(this.url=it(e,!1,r),this.radarUrl=it(e,!0,r));this.formatUrl()},e.prototype.getCommonPackageJSON=function(){return this.commonPackage.toJSON()},e.prototype.send=function(e,n,r){void 0===n&&(n=!1),this.isV2&&(this.commonPackage.setAdditionalSeqIdPackage(e.getEventType()),e.common_package=this.getCommonPackageJSON()),t.prototype.send.call(this,e,n,r)},e}(st);!function(t){var e,n,r,o,i,a,s,c;(e=t.ElementStatus||(t.ElementStatus={}))[e.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",e[e.CHECKED=1]="CHECKED",e[e.UNCHECKED=2]="UNCHECKED",(n=t.PageShowAction||(t.PageShowAction={}))[n.UNKNOWN_ACTION=0]="UNKNOWN_ACTION",n[n.ENTER=1]="ENTER",n[n.LEAVE=2]="LEAVE",n[n.RESUME=3]="RESUME",(r=t.ActionStatus||(t.ActionStatus={}))[r.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",r[r.SUCCESS=1]="SUCCESS",r[r.FAIL=2]="FAIL",(o=t.ActionType||(t.ActionType={}))[o.UNKNOWN_ACTION_TYPE=0]="UNKNOWN_ACTION_TYPE",o[o.CLICK=1]="CLICK",o[o.LEFT_PULL=2]="LEFT_PULL",o[o.RIGHT_PULL=3]="RIGHT_PULL",o[o.UP_PULL=4]="UP_PULL",o[o.DOWN_PULL=5]="DOWN_PULL",(i=t.SubAction||(t.SubAction={}))[i.UNKNOWN_SUB_ACTION=0]="UNKNOWN_SUB_ACTION",i[i.PAGE_ENTER=1]="PAGE_ENTER",i[i.PAGE_LEAVE=2]="PAGE_LEAVE",i[i.PAGE_RESUME=3]="PAGE_RESUME",i[i.PAGE_PAUSE=4]="PAGE_PAUSE",(a=t.Direction||(t.Direction={}))[a.UNKNOWN2=0]="UNKNOWN2",a[a.UP=1]="UP",a[a.DOWN=2]="DOWN",a[a.LEFT=3]="LEFT",a[a.RIGHT=4]="RIGHT",(s=t.TaskStatus||(t.TaskStatus={}))[s.UNKNOWN_STATUS=0]="UNKNOWN_STATUS",s[s.START=1]="START",s[s.RETRY=2]="RETRY",s[s.PAUSE=3]="PAUSE",s[s.RESUME=4]="RESUME",s[s.PENDING=5]="PENDING",s[s.PROCESSING=6]="PROCESSING",s[s.SUCCESS=7]="SUCCESS",s[s.FAIL=8]="FAIL",s[s.CANCEL=9]="CANCEL",s[s.FINISH=10]="FINISH",(c=t.OperationType||(t.OperationType={}))[c.UNKNOWN_OPERATION=0]="UNKNOWN_OPERATION",c[c.CLICK=1]="CLICK",c[c.DOUBLE_CLICK=2]="DOUBLE_CLICK",c[c.TRIPLE_CLICK=3]="TRIPLE_CLICK",c[c.LONG_PRESS=4]="LONG_PRESS",c[c.PULL=5]="PULL",c[c.DRAG=6]="DRAG",c[c.SCALE=7]="SCALE",c[c.PULL_DOWN=8]="PULL_DOWN",c[c.PULL_UP=9]="PULL_UP",c[c.RIGHT_CLICK=10]="RIGHT_CLICK",c[c.AUTO=11]="AUTO"}(Ot||(Ot={})),function(t){var e,n;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",e[e.PAGE_AUTO=10]="PAGE_AUTO",e[e.PAGE_CUSTOM=11]="PAGE_CUSTOM",e[e.ELEMENT=12]="ELEMENT",(n=t.TaskEventType||(t.TaskEventType={}))[n.UNKNOWN_TYPE=0]="UNKNOWN_TYPE",n[n.USER_OPERATION=1]="USER_OPERATION",n[n.STAY_LENGTH_STAT_EVENT=2]="STAY_LENGTH_STAT_EVENT",n[n.BACKGROUND_TASK_EVENT=3]="BACKGROUND_TASK_EVENT"}(Lt||(Lt={})),function(t){var e;(e=t.ShowType||(t.ShowType={}))[e.UNKNOWN2=0]="UNKNOWN2",e[e.PAGE=1]="PAGE"}(Ct||(Ct={}));var It,At,Dt=!0,Mt=(new Date).valueOf(),jt=function(t,e){var n,o;void 0===e&&(e=!1);var i=t.type,a=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=void 0===c?"":c,l=t.action,p=t.beginTime,d=t.params,f=t.contentPackage,h=t.status,g=t.actionType,m=t.auto,v=((n={status:h?Ot.ActionStatus[h]||Ot.ActionStatus.UNKNOWN_STATUS:Ot.ActionStatus.SUCCESS})[e?"show_type":"action_type"]=g?Ot.ActionType[g]||Ot.ActionType.UNKNOWN_ACTION_TYPE:Ot.ActionType.CLICK,n.url_package=a,n.refer_url_package=s,n[e?"content_wrapper":"content_package"]=f,n);if("PV"===i){var y=Ot.SubAction.PAGE_ENTER,_=Ot.PageShowAction.ENTER,w=Dt,S=0;switch(Dt=!1,l){case"leave":_=Ot.PageShowAction.LEAVE,y=Ot.SubAction.PAGE_LEAVE,S=(new Date).valueOf()-(p||Mt);break;case"enter":_=Ot.PageShowAction.ENTER,y=Ot.SubAction.PAGE_ENTER,Mt=(new Date).valueOf();break;case"visible":_=Ot.PageShowAction.RESUME,y=Ot.SubAction.PAGE_RESUME,Mt=(new Date).valueOf();break;case"hidden":_=Ot.PageShowAction.LEAVE,y=Ot.SubAction.PAGE_PAUSE,S=(new Date).valueOf()-(p||Mt)}var b=m?Lt.ShowType.PAGE_AUTO:Lt.ShowType.PAGE_CUSTOM;return e&&(w=void 0,b=Ct.ShowType.PAGE),{show_event:r({action:_,sub_action:y,type:b,first_load:w,time_cost:0,stay_length:S},v)}}return{show_event:r({action:e?0:Ot.PageShowAction.ENTER,type:e?0:Lt.ShowType.ELEMENT,sub_action:e?0:Ot.SubAction.PAGE_ENTER,element_package:(o={},o[e?"action2":"action"]=u,o.params=JSON.stringify(d),o)},v)}},Kt=function(t,e){var n,o;void 0===e&&(e=!1);var i=t.sessionId,a=t.currentUrlPackage,s=t.referUrlPackage,c=t.name,u=t.params,l=t.type,p=t.contentPackage,d=t.status,f=t.taskType,h=t.operationDirection,g=((n={url_package:a,refer_url_package:s,element_package:(o={},o[e?"action2":"action"]=c,o.params=JSON.stringify(u),o)})[e?"content_wrapper":"content_package"]=p,n);return e?"CLICK"===l?{click_event:r({type:f&&Ot.OperationType[f]||Ot.OperationType.CLICK,direction:h&&Ot.Direction[h]||Ot.Direction.UNKNOWN2},g)}:{task_event:r({action2:l,status:d&&Ot.TaskStatus[d]||Ot.TaskStatus.UNKNOWN_STATUS},g)}:{task_event:r({type:f&&Lt.TaskEventType[f]||Lt.TaskEventType.USER_OPERATION,status:d&&Ot.TaskStatus[d]||Ot.TaskStatus.UNKNOWN_STATUS,operation_type:Ot.OperationType[l]||Ot.OperationType.CLICK,operation_direction:h&&Ot.Direction[h]||Ot.Direction.UNKNOWN2,session_id:i},g)}},Vt=function(t){var e=t.name,n=t.params,i=t.currentUrlPackage,a=t.referUrlPackage,s=o(t,["name","params","currentUrlPackage","referUrlPackage"]);return{key:e,value:JSON.stringify(r(r({url_package:i,refer_url_package:a},n),s))}},Wt=function(t){var e=t.currentUrlPackage,n=t.referUrlPackage,o=t.options;return{video_stat_event:r(r({},o),{url_package:e,refer_url_package:n})}},Ft=(It=(new Date).getTimezoneOffset()/60)<=0?"GMT+"+b(-It+"",2,"0")+":00":"GMT-"+b(It+"",2,"0")+":00",Bt=function(){function t(t,e){void 0===e&&(e=!1),this.client_timestamp=(new Date).valueOf(),this.client_increment_id=0,this.session_id=h.sessionId,this.event_id="",e||(this.time_zone=Ft),Object.assign(this,t),this.genIncrementId()}return t.prototype.genIncrementId=function(){this.client_increment_id=this.isCustomStatEvent()?gt("WEBLOGGER_CUSTOM_INCREAMENT_ID_KEY"):gt("WEBLOGGER_INCREAMENT_ID_KEY")},t.prototype.isCustomStatEvent=function(){return!(!this.stat_package||!("custom_stat_event"in this.stat_package))},t.prototype.getEventType=function(){if(this.event_package){var t=this.event_package,e=t.task_event,n=t.show_event,r=t.click_event,o=t.custom_event;if(n)return"showEvent";if(r)return"clickEvent";if(e)return"taskEvent";if(o)return"customEvent"}return"customEvent"},t}();function Ht(t,e,n){var r;void 0===n&&(n=!1);var i,a=e.eventId,s=e.currentUrlPackage,c=e.referUrlPackage,u=e.contentPackage,l=e.name,p=e.params;switch(n&&"RADAR"!==t&&"CUSTOM"!==t&&(s&&(s.page2=s.page,delete s.page),c&&(c.page2=c.page,delete c.page)),t){case"PV":case"SHOW":return new Bt({event_package:jt({type:t,status:e.status,currentUrlPackage:s,referUrlPackage:c,action:e.type,beginTime:e.beginTime,actionType:e.actionType,name:l,params:p,contentPackage:u,operationDirection:e.operationDirection,auto:e.auto},n),event_id:a},n);case"CUSTOM":case"CUSTOM_STAT_EVENT":var d=Vt({name:l,params:p,currentUrlPackage:s,referUrlPackage:c});return new Bt(n?{event_package:{custom_event:d},event_id:a}:{stat_package:{custom_stat_event:d},event_id:a},n);case"RADAR":return new Bt({stat_package:{custom_stat_event:Vt({name:l,params:p,currentUrlPackage:s,referUrlPackage:c})},event_id:a},n);case"HEART_BEAT_EVENT":case"LAUNCH_EVENT":case"APP_USAGE_STAT_EVENT":case"EXCEPTION_EVENT":case"DEVICE_STAT_EVENT":return new Bt({stat_package:(r={},r[t.toLowerCase()]=(i=e,i.currentUrlPackage,i.referUrlPackage,o(i,["currentUrlPackage","referUrlPackage"])),r)},n);case"VIDEO":return new Bt(n?{stat_package:Wt({currentUrlPackage:s,referUrlPackage:c,options:p.params})}:{event_package:Kt({type:t,status:e.status,taskType:e.taskType,sessionId:h.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:p.params,contentPackage:u},n),event_id:a},n);default:return new Bt({event_package:Kt({type:t,status:e.status,taskType:e.taskType,sessionId:h.sessionId,currentUrlPackage:s,referUrlPackage:c,name:l,params:p,contentPackage:u},n),event_id:a},n)}}var Gt=null,qt="tool",Jt=!1,Qt=function(){return i(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:if(!At||Jt)return[2];t.label=1;case 1:return t.trys.push([1,6,,7]),Gt?[4,Gt]:[3,3];case 2:return t.sent(),[3,5];case 3:return[4,Gt=At.ready()];case 4:t.sent(),At.register({namespace:"webview",name:"getPageLoadData"}),At.register({namespace:"tool",name:"setClientLog"}),At.register({namespace:"tool",name:"sendRadarLog"}),At.register({namespace:"tool",name:"getKswitchData"}),t.label=5;case 5:return Gt=null,Jt=!0,[3,7];case 6:return t.sent(),[3,7];case 7:return[2]}}))}))},Yt=function(t,e){return void 0===e&&(e="tool"),i(void 0,void 0,void 0,(function(){var n,r,o;return a(this,(function(i){switch(i.label){case 0:return n=!1,At?Jt?[3,2]:[4,Qt()]:[3,5];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,At.tool.canIUse({namespace:e,name:t})];case 3:return r=i.sent().canUse,n=r,[3,5];case 4:return o=i.sent(),_("[error 206]","yoda.tool.canIUse({ '"+e+"', '"+t+"' }) 报错: "+o.message),[3,5];case 5:return[2,n]}}))}))},zt=void 0,Xt=function(t,e){return i(void 0,void 0,void 0,(function(){var n,r;return a(this,(function(o){switch(o.label){case 0:return At?Jt?[3,2]:[4,Qt()]:[2];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,null===(r=At.tool)||void 0===r?void 0:r.handleEntryTag({type:t,params:e})];case 3:return(n=o.sent())&&n.data&&n.data.entryTag?[2,n.data.entryTag]:[3,5];case 4:return _("[error 213]","操作染色参数报错",o.sent()),[3,5];case 5:return[2,null]}}))}))},$t={isSupportBridgeLog:function(){return i(void 0,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return At?Jt?[3,2]:[4,Qt()]:[2,!1];case 1:e.sent(),e.label=2;case 2:return[4,Yt(t="setClientLog","tool")];case 3:return e.sent()?(qt="tool",[2,!0]):[4,Yt(t,"platform")];case 4:return e.sent()?(qt="platform",[2,!0]):[2,!1]}}))}))},isSupportBridge:Yt,getWebviewLoadPerf:function(t){return void 0===t&&(t={}),i(void 0,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return At?Jt?[3,2]:[4,Qt()]:[2];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,null===(e=At.webview)||void 0===e?void 0:e.getPageLoadData(t)];case 3:return[2,n.sent()];case 4:return _("[error 207]","yoda.webview.getPageLoadData() 报错: "+n.sent().message),[3,5];case 5:return[2]}}))}))},sendRadarLog:function(t){return void 0===t&&(t={}),i(void 0,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return At?Jt?[3,2]:[4,Qt()]:[2];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,null===(e=At.tool)||void 0===e?void 0:e.sendRadarLog(t,(function(e,n){e&&1!==e.result&&_("[error 205]","yoda.tool.sendRadarLog 埋点发送失败",JSON.stringify(t),"result: "+e+", message: "+n)}))];case 3:return[2,n.sent()];case 4:return _("[error 207]","yoda.tool.sendRadarLog() 报错: "+n.sent().message),[3,5];case 5:return[2]}}))}))},setClientLog:function(t,e){return i(void 0,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return At?Jt?[3,2]:[4,Qt()]:[2];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,At[qt].setClientLog({type:t,data:e},(function(n,r){n&&1!==n.result&&_("[error 203]","yoda.tool.setClientLog 埋点发送失败",JSON.stringify({type:t,data:e}),"result: "+n+", message: "+r)}))];case 3:return[2,r.sent()];case 4:return n=r.sent(),_("[error 209]","yoda."+qt+".setClientLog() 报错: "+n.message),[3,5];case 5:return[2]}}))}))},initYoda:Qt,yodaAlready:Jt,getKDSWebviewLoadPerf:function(t){return void 0===t&&(t={}),i(void 0,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return At?Jt?[3,2]:[4,Qt()]:[2];case 1:n.sent(),n.label=2;case 2:return[4,Yt("getPageLoadData","system")];case 3:if(!n.sent())return[3,7];n.label=4;case 4:return n.trys.push([4,6,,7]),[4,null===(e=At.system)||void 0===e?void 0:e.getPageLoadData(t)];case 5:return[2,n.sent()];case 6:return _("[error 212]","yoda.system.getPageLoadData() 报错",n.sent().message),[3,7];case 7:return[2]}}))}))},sendSummarizedLog:function(t){return void 0===t&&(t={}),i(void 0,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:if(!At)return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),Jt?[3,3]:[4,Qt()];case 2:n.sent(),n.label=3;case 3:return[4,null===(e=At.tool)||void 0===e?void 0:e.sendSummarizedLog(t)];case 4:return[2,n.sent()];case 5:return _("[error 208]","yoda.tool.sendSummarizedLog() 报错: "+n.sent().message),[3,6];case 6:return[2]}}))}))}},Zt=function(t,e,n,r){void 0===t&&(t=d.CLICK),void 0===e&&(e={}),"string"!=typeof t&&(t=t.type),t=t.toUpperCase();var o={};return"string"==typeof e?(o.contentPackage=r,"CUSTOM"===t?(o.key=e,o.value=n):(o.params=n,"PV"===t?o.page=e:o.action=e)):o=e,[t,o]},te=!1,ee=Math.random(),ne=function(t){function e(e,n){void 0===e&&(e={});var r,o,i,a=t.call(this,e,n)||this;return a.yoda=null,a.SampledPageMap={},a.beforeUnload=function(t){if(!te){for(var e in a.logger.drain(),a.plugins){var n=a.plugins[e];"function"==typeof n.beforeUnload&&n.beforeUnload(t)}te=!0,setTimeout((function(){te=!1}),2e3)}},a.isBridge=e.bridgeMode&&e.yoda&&e.yoda.isInYoda,a.logConfig.isBridge=a.isBridge,r="sessionId",o=n&&n.session_id||M("sid")||(i="",E()&&(i=M("session_id")||M("sid"))?i:V()),h[r]=o,a.isV2="v2"===a.logConfig.proto,a.getSampled(e),a.presetBaseOption(a.baseOption),a.commonPackage=new wt(a.baseOption),a.logger=new xt(a.logConfig,a.commonPackage),a.initYoda(),a.addPlugins(),w(window,"pagehide",a.beforeUnload),w(window,"beforeunload",a.beforeUnload),a}return n(e,t),e.prototype.getSampled=function(t){"function"==typeof t.sampleRateFn?this.sampled=!!t.sampleRateFn():void 0!==t.sampleRate&&(this.sampled=ee<Number(t.sampleRate))},e.prototype.presetBaseOption=function(t){this.isBridge||(this.isV2?("number"!=typeof t.product&&_("[error 101]","请设置有效的 product 值，值类型为 number!"),delete t.product_name):(t.product_name&&"string"==typeof t.product_name||_("[error 100]","请设置有效的 product_name 值，值类型为 string!"),delete t.product),t.user_id||(t.user_id=M("userId")||M("userName")||void 0,t.user_id||y("[warn 102]","user_id 为空，请确定是否传入，如果是异步通过 updateCommonPackage 接口传入，可以忽略该提示!")),t.device_id||(t.device_id=B(),t.device_id||_("[error 103]","device_id 为空，请设置有效的设备 id!")),!t.global_id&&E()&&(t.global_id=M("egid")||""))},Object.defineProperty(e.prototype,"Utils",{get:function(){return{yoda:this.yoda&&$t,cookie:K,ua:pt,io:{sendData:Tt}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isKSwitchSampled",{get:function(){return void 0!==typeof zt},enumerable:!1,configurable:!0}),e.prototype.initYoda=function(){return i(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){switch(e.label){case 0:return this.logConfig.yoda&&!this.yoda&&(this.yoda=(void 0===(n=this.logConfig.yoda)&&(n=At||"undefined"!=typeof window&&window.yoda),At&&At.isInYoda?At:n&&n.isInYoda?At=n:null)),this.yoda?[4,Qt()]:[3,2];case 1:e.sent(),e.label=2;case 2:return i(void 0,void 0,void 0,(function(){var t,e,n,r,o;return a(this,(function(i){switch(i.label){case 0:if(!At)return[2,zt=null];if(void 0!==zt)return[2,zt];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,Yt("getKswitchData","tool")];case 2:return i.sent()?[4,At.tool.getKswitchData({keys:[{key:"webloggerSampling"}]})]:[2,zt=null];case 3:if((t=i.sent())&&t.data&&("string"==typeof(e=t.data[0])&&(e=JSON.parse(e)),n=e?e.value:null)){for(o in"string"==typeof n&&(n=JSON.parse(n)),r="undefined"!=typeof location?location.host:"*",n)"*"!==o&&-1===o.indexOf(r)||(zt||(zt={}),zt[o]=n[o]);if(zt)return[2,zt]}return[3,5];case 4:return _("[error 201]","yoda.tool.getKswitchData 采样配置获取出错",i.sent().message),[3,5];case 5:return[2,zt=null]}}))})).then((function(){t.currentUrlPackage&&(t.currentUrlPackage.sampled=t.getPageSampled())})),i(void 0,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return At?[4,Yt("getDeviceInfo","system")]:[2,null];case 1:if(!e.sent())return[3,5];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,null===(t=At.system)||void 0===t?void 0:t.getDeviceInfo()];case 3:return[2,e.sent()];case 4:return _("[error 210]","yoda.system.getDeviceInfo() 报错",e.sent().message),[3,5];case 5:return[2]}}))})).then((function(e){e&&e.mod&&(t.commonPackage.device_package.model=e.mod)})),i(void 0,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return At?[4,Yt("getAppInfo","system")]:[2,null];case 1:if(!e.sent())return[3,5];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,null===(t=At.system)||void 0===t?void 0:t.getAppInfo()];case 3:return[2,e.sent()];case 4:return _("[error 209]","yoda.system.getAppInfo() 报错",e.sent().message),[3,5];case 5:return[2]}}))})).then((function(e){e&&(e.did&&(t.commonPackage.identity_package.device_id=e.did),e.userId&&!t.commonPackage.identity_package.user_id&&(t.commonPackage.identity_package.user_id=e.userId),e.appver&&(t.commonPackage.app_package.version_name=e.appver))})),[2]}var n}))}))},e.prototype.initUrlPackage=function(){t.prototype.initUrlPackage.call(this);var e,n=this.logConfig.referer,r="web";n?(e=n.value,r=n.type&&n.type||r):"undefined"!=typeof document&&document.referrer&&(e=document.referrer),e&&this.updateReferUrlPackage(e,r)},e.prototype.updateCurrentUrlPackage=function(t,e){if(void 0===t&&(t=(null===location||void 0===location?void 0:location.href)||""),void 0===e&&(e="web"),"object"==typeof t&&t.page&&!t.force&&this.currentUrlPackage&&t.page===this.currentUrlPackage.page)return this.currentUrlPackage.update(t.page,t.params);this.currentUrlPackage=new J(t,e,this.logConfig.urlMap),this.currentUrlPackage.sampled=this.getPageSampled(),this.logConfig.attachUrl&&this.currentUrlPackage.attachUrl()},e.prototype.updateReferUrlPackage=function(t,e){void 0===t&&(t=this.currentUrlPackage),void 0===e&&(e="web"),this.referUrlPackage=t instanceof J?t:new J(t,e,this.logConfig.urlMap)},e.prototype.getPageSampled=function(){if(!zt)return"boolean"!=typeof this.sampled||this.sampled;var t="undefined"!=typeof location?location.href.replace(/https?:\/\//,"").split("?")[0]:"*";if(this.SampledPageMap&&void 0!==this.SampledPageMap[t])return this.SampledPageMap[t];if(zt){var e=void 0,n=0,r=null,o=[];for(var i in zt)if(zt.hasOwnProperty(i)){var a=0;if("*"===i?a=1:0===t.indexOf(i)&&(i===t?a=100:"/"===i[i.length-1]&&(a=11-1/i.length)),!a)continue;var s=zt[i],c=s.radar,u=s.overwrite,l=s.overall;a+=u?1e3:0,c&&o.push({radar:c,level:a}),a>n&&(n=a,e=l)}n&&(r={},o.sort((function(t,e){return t.level-e.level})).forEach((function(t){Object.assign(r,t.radar)})));var p=void 0;p=n>1e3||void 0===this.sampled?Math.random()<Number(e)&&(!r||{radar:r}):"boolean"!=typeof this.sampled||this.sampled,this.SampledPageMap&&(this.SampledPageMap[t]=p)}return this.SampledPageMap&&this.SampledPageMap[t]},Object.defineProperty(e.prototype,"isSendSampled",{get:function(){return!e.silenced&&(this.currentUrlPackage&&this.currentUrlPackage.sampled||this.logger.isDebug)},enumerable:!1,configurable:!0}),e.prototype.generateLog=function(t,e,n){void 0===n&&(n=Ht);var o,i=e,a=i.action,s=i.params,c=i.status,u=i.type,l=i.eventId,p=i.contentPackage,d=i.urlPage;if(p&&(p="string"==typeof p?p:JSON.stringify(p)),t===f.PV){var h=e,g=h.page,m=h.type;m||(e.type=m="enter"),"enter"===m&&g?this.updateCurrentUrlPackage({page:g,params:s}):this.currentUrlPackage.update(g,s)}else d&&d.page&&(o={page:d.page,identity:d.identity||V(),params:JSON.stringify(d.params),page_type:this.currentUrlPackage.page_type});var v={currentUrlPackage:o||this.currentUrlPackage.toJSON(),referUrlPackage:this.referUrlPackage?this.referUrlPackage.toJSON():void 0,contentPackage:p};if(v.currentUrlPackage.page.indexOf("http"),t===f.PV){var y=e.type;return n(t,r(r(r({},e),{type:y}),v),this.isV2)}if(t===f.SHOW)return n(t,r(r(r({},e),{name:a}),v),this.isV2);if(t===f.VIDEO)return n(t,r({params:e,name:"VIDEO"},v),this.isV2);if(t===f.RADAR)return n(t,e,this.isV2);if(t===f.CUSTOM){var _=e,w=_.key,S=_.value,b=_.eventId;return n(t,r(r(r({},e),{params:S,eventId:b,name:w}),v),this.isV2)}return n(t,r(r(r({},e),{params:s,status:c,taskType:u,eventId:l,name:a}),v),this.isV2)},e.prototype.collect=function(t,e,n,r){var o=Zt(t,e,n,r),i=o[0],a=o[1];return this.send(i,a,!1)},e.prototype.sendImmediately=function(t,e,n,r){var o=Zt(t,e,n,r),i=o[0],a=o[1];return this.send(i,a,!0)},e.prototype.beforeSend=function(t,e,n){var o,s,c=this;if(this.emit("event",{type:t,action:e.type||e.action,data:n}),"CLICK"===t){var u=null===(o=e)||void 0===o?void 0:o.entryTag;this.yoda&&u&&Xt("setPendingEntryTag",{entryTag:r({page_name:this.currentUrlPackage.page,element_action:null==e?void 0:e.action},u)})}else if("PV"===t&&this.yoda&&!this.isBridge){if("enter"===((null===(s=e)||void 0===s?void 0:s.type)||"enter")){this.logger.sendingYield=i(c,void 0,void 0,(function(){var t,e;return a(this,(function(n){switch(n.label){case 0:return t=this.currentUrlPackage.identity,[4,Xt("clearEntryTag",{subPage:t})];case 1:return n.sent(),[4,Xt("consumeEntryTag",{subPage:t})];case 2:return e=n.sent(),this.commonPackage.updateGlobalAttr({entry_tag:e}),[2]}}))}))}}},e.prototype.send=function(t,e,n){var r=this.generateLog(t,e);if(this.beforeSend(t,e,r),!("PV"===t&&this.isV2&&(o=this.currentUrlPackage.page,o&&/^(https?:)?\/\//.test(o)&&(_("[error 108]","请注意当前埋点页面信息为 "+o+"，不符合规范，上报失败！"),1)))){var o;if("RADAR"===t)return this.logger.sendRadar(r,null==e?void 0:e.serviceName);if(this.isSendSampled){var i="object"==typeof e&&e.callback||void 0;this.logger.send(r,!!n,i)}}},e.prototype.destroy=function(){t.prototype.destroy.call(this),S(window,"pagehide",this.beforeUnload),S(window,"beforeunload",this.beforeUnload)},e.silence=function(t){e.silenced=t},e}(x),re=function(){function t(){this.weblog="undefined"!=typeof window&&window._GLOBAL_KS_WEBLOGGER_&&window._GLOBAL_KS_WEBLOGGER_.weblog}return t.prototype.apply=function(t){this.weblog=t},t}(),oe={updateInterval:2e4,crashThreshold:1e4},ie="@ks.monitor.crash_",ae=function(t){function e(e){var n=t.call(this)||this;return n.eventName="onpagehide"in window?"pagehide":"beforeunload",n.options=r({},oe),n.historyMoniorInfo=null,n.stop=function(){clearInterval(n.updateIntervalId);try{localStorage.removeItem(n.monitorId)}catch(t){}},e&&e.logger&&n.apply(e),w(window,n.eventName,n.stop),n}return n(e,t),e.prototype.apply=function(t){t&&(this.weblog=t,this.monitorId=ie+this.weblog.sessionId,this.start())},e.prototype.destroy=function(){this.stop(),S(window,this.eventName,this.stop)},e.prototype.pickHistoryInfo=function(){for(var t in localStorage)if(0===t.indexOf(ie))try{var e=localStorage.getItem(t),n=JSON.parse(e);this.checkHistoryCrash(n)}catch(t){}},e.prototype.checkHistoryCrash=function(t){var e=(new Date).valueOf();t&&t.time&&e-t.time>this.options.crashThreshold&&this.weblog.collect("CUSTOM",{key:"crash",value:t})},e.prototype.start=function(){var t=this;this.pickHistoryInfo(),this.updateIntervalId=window.setInterval((function(){t.update()}),this.options.updateInterval),this.update()},e.prototype.update=function(){var t,e;if(window.performance&&window.performance.memory){var n={time:(new Date).valueOf(),memory:{limit:Math.floor(window.performance.memory.jsHeapSizeLimit/1024),total:Math.floor(window.performance.memory.totalJSHeapSize/1024),used:Math.floor(window.performance.memory.usedJSHeapSize/1024)},href:null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.href,sessionId:null===(e=this.weblog)||void 0===e?void 0:e.sessionId};try{localStorage.setItem(this.monitorId,JSON.stringify(n))}catch(t){}}},e.key="crachMonitor",e}(re),se={interval:1e4,decimals:2};function ce(t){return setTimeout(t,62.5)}var ue=clearTimeout,le=function(t){function e(e,n){var o=t.call(this)||this;return o.options=r({},se),o.count=0,n||e&&e.logger&&o.apply(e),Object.assign(o.options,n),o.start(),o}return n(e,t),e.prototype.destroy=function(){this.stop()},e.prototype.start=function(){this.loop(),this.fpsTick()},e.prototype.fpsTick=function(){var t=this;this.fpsTickId=function(t){return(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||ce).call(this,t)}((function(){t.count++,t.fpsTick()}))},e.prototype.loop=function(){var t=this;this.loopBeginTime=(new Date).valueOf(),this.loopId=window.setTimeout((function(){t.loopEndTime=(new Date).valueOf();var e=t.calculate();t.weblog.collect("CUSTOM",{key:"fps",value:{key:"fps",value:e}}),t.count=0,t.loop()}),this.options.interval)},e.prototype.stop=function(){!function(t){(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||ue).call(this,t)}(this.fpsTickId),window.clearTimeout(this.loopId)},e.prototype.calculate=function(){return+(1e3/((this.loopEndTime-this.loopBeginTime)/this.count)).toFixed(this.options.decimals)},e.key="fpsMonitor",e}(re),pe="undefined"!=typeof window?window.performance:null,de=pe&&pe.timing||null;pe&&pe.getEntriesByType&&pe.getEntriesByType("navigation")[0];var fe={dnsLookup:{end:"domainLookupEnd",start:"domainLookupStart"},tcpConnection:{end:"connectEnd",start:"connectStart"},resourceLoad:{end:"responseEnd",start:"requestStart"},jsCost:{custom:function(){if("function"!=typeof performance.getEntries)return 0;var t=performance.getEntries(),e=t[0],n=t.filter((function(t){return"script"===t.initiatorType}))[0];return n?e.domComplete-n.fetchStart:0}},documentContentLoaded:{end:"domComplete",start:"fetchStart"},load:{end:"loadEventEnd",start:"fetchStart"},timeToFirstByte:{end:"loadEventEnd",start:"fetchStart"},firstScreen:{custom:function(t,e){var n=(e||{}).endPoint,r=void 0!==n?n:(new Date).valueOf();return de&&r-de.fetchStart||0}},whiteScreen:{custom:function(t,e){var n=(e||{}).endPoint,r=void 0!==n?n:(new Date).valueOf();return de&&r-de.fetchStart||0}}},he=function(t){function e(e){var n=t.call(this)||this;return n.load=function(){setTimeout((function(){var t=n.collect();t&&["load","documentContentLoaded","dnsLookup","tcpConnection","jsCost","timeToFirstByte"].forEach((function(e){var r;"jsCost"===e&&0===t[e]||n.weblog.collect("CUSTOM",{key:ge[e],value:(r={},r[ge[e]]=t[e],r)})}))}))},de?(e&&n.apply(e),n):(_("The Timing Monitor need performance APIs to Support!"),n)}return n(e,t),e.prototype.apply=function(t){this.weblog=t,w(window,"load",this.load)},e.prototype.destroy=function(){S(window,"load",this.load)},e.prototype.calculate=function(t,e){var n=fe[t];if(!n)throw new Error("The perf key is not correct!");return"function"==typeof n.custom?n.custom(t,e):de[fe[t].end]-de[fe[t].start]},e.prototype.mark=function(t,e){var n,r=this.collect(t,e);r&&this.weblog.collect("CUSTOM",{key:ge[t],value:(n={},n[ge[t]]=r[t],n)})},e.prototype.collect=function(t,e){var n,r=this;if(de){if(t)return(n={})[t]=this.calculate(t,e),n;return Object.keys(fe).reduce((function(t,n){return t[n]=r.calculate(n,e),t}),{})}},e.key="timingMonitor",e}(re),ge={load:"total_download_cost",documentContentLoaded:"operational_cost",dnsLookup:"dns_query_cost",tcpConnection:"tcp_cost",jsCost:"js_cost",whiteScreen:"white_screen_cost",firstScreen:"first_screen_cost",timeToFirstByte:"ttfb_cost"};!function(t,e,n){if("undefined"!=typeof window&&void 0!==window._GLOBAL_KS_WEBLOGGER_&&"function"==typeof t){var r=window._GLOBAL_KS_WEBLOGGER_,o=r.weblog,i=r.config,a=e&&i.plugins[e]?i.plugins[e].options:void 0;if("radar"===e){var s=a||o.logConfig[e];if(!s)return;if(s.sampling=s.sampling||1,!t.samplingControl(s))return o.plug(n)}o.addPluginInstance(new t(a))}}(he);var me=function(){var t="undefined"!=typeof window?window.performance:null;if(t&&t.timing){if("function"==typeof t.timing.toJSON){var e=t.timing.toJSON();return e&&!e.redirectStart&&(e.redirectStart=e.navigationStart),e}return t.timing}return null};var ve,ye,_e,we="radar_log";!function(t){t.LOAD="load",t.RES="resource",t.API="api",t.ERROR="error",t.SDK_ERROR="sdk_error",t.CUSTOM="custom",t.BATCH="batch",t.EVENT="event"}(ve||(ve={})),function(t){t.LOAD="load_statistics",t.RES="resource_statistics",t.API="api_statistics",t.ERROR="error_statistics",t.SDK_ERROR="sdk_error",t.CUSTOM="custom_statistics"}(ye||(ye={})),function(t){t.SCRIPT="script",t.RES="res",t.API="api",t.VIDEO="video"}(_e||(_e={}));var Se,be,Ee={redirect:{end:"fetchStart",start:"navigationStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(t,e){return e.redirectCount}},ssl:{custom:function(t,e){return 0===e.secureConnectionStart?0:e.connectEnd-e.secureConnectionStart}},ssl_start:{custom:function(t,e){return 0===e.secureConnectionStart?0:e.secureConnectionStart-e.redirectStart}},ttfb:{end:"responseStart",start:"requestStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domContentLoadedEventEnd"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=performance.getEntries().filter((function(t){return"first-paint"===t.name}))[0];return t?Math.ceil(t.startTime+t.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=me(),e=performance.getEntries(),n=performance.getEntries().filter((function(t){return"navigation"===t.initiatorType}))[0],r=e.filter((function(t){return"script"===t.initiatorType}))[0],o=n?n.domComplete:t.domComplete-t.navigationStart;return r&&o?o-r.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(t,e){return e.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document?document.all.length:null}}},ke={fetch_start:{custom:function(t,e){return Math.round(e.fetchStart)}},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0},ssl:{cachedSkip:!0,custom:function(t,e){return 0===e.secureConnectionStart?0:e.connectEnd-e.secureConnectionStart}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0},total:{end:"responseEnd",start:"fetchStart"},duration:{end:"responseEnd",start:"fetchStart"},size:{cachedSkip:!0,custom:function(t,e){return e.encodedBodySize},noThrottle:!0},protocol:{custom:function(t,e){return e.nextHopProtocol}},file:{custom:function(t,e){return e.name},noThrottle:!0},res_type:{custom:function(t,e){return e.initiatorType}},cached:{custom:function(t,e){return 0===e.transferSize||null==e.transferSize&&0===e.domainLookupStart},noThrottle:!0}},Pe={fetch_start:{custom:function(t,e){return Math.round(e.fetchStart)},noThrottle:!0},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0},ssl:{cachedSkip:!0,custom:function(t,e){return 0===e.secureConnectionStart?0:e.connectEnd-e.secureConnectionStart}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0},total:{end:"responseEnd",start:"fetchStart"},duration:{end:"responseEnd",start:"fetchStart"},size:{cachedSkip:!0,custom:function(t,e){return e.encodedBodySize},noThrottle:!0},protocol:{custom:function(t,e){return e.nextHopProtocol}},file:{custom:function(t,e){return e.name},noThrottle:!0},res_type:{custom:function(t,e){return e.initiatorType}},cached:{custom:function(t,e){return 0===e.transferSize||null==e.transferSize&&0===e.domainLookupStart},noThrottle:!0}},Te=["//wlog.kuaishou.com/rest/n/log/web/collect","/rest/wd/common/log/collect/misc2","/rest/wd/common/log/collect/radar","/rest/kd/log/collect"],Oe={to_webview_page_start:{end:"pageStart",start:"userStart"},to_webview_page_show:{end:"pageShow",start:"userStart"},to_webview_pre_create:{end:"preCreate",start:"userStart"},to_webview_created:{end:"created",start:"userStart"},to_webview_start_load:{end:"startLoad",start:"userStart"},to_webview_did_start_load:{end:"didStartLoad",start:"userStart"},to_webview_did_end_load:{end:"didEndLoad",start:"userStart"},to_navigation_start:{end:"navigationStart",start:"userStart"},to_fetch_start:{end:"fetchStart",start:"userStart"},to_connect_start:{end:"connectStart",start:"userStart"},to_dom_ready:{end:"domContentLoadedEventEnd",start:"userStart"},to_total:{end:"loadEventStart",start:"userStart"},to_fmp:{end:"radarFmp",start:"userStart",notCatchIfUndefined:!0},to_main_data_receive_end:{end:"main_data_receive_end",start:"userStart",notCatchIfUndefined:!0}},Le={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connect_start",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",fmp_time:"radarFmp"},Ce=function(){return"".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)},Ne=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return{name:t,value:e,delta:0,entries:[],id:Ce(),isFinal:!1}},Ue=function(t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){var n=new PerformanceObserver((function(t){return t.getEntries().map(e)}));return n.observe({type:t,buffered:!0}),n}}catch(t){}},Re=!1,xe=!1,Ie=function(t){Re=!t.persisted},Ae=function(){addEventListener("pagehide",Ie),addEventListener("beforeunload",(function(){}))},De=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];xe||(Ae(),xe=!0),addEventListener("visibilitychange",(function(e){var n=e.timeStamp;"hidden"===document.visibilityState&&t({timeStamp:n,isUnloading:Re})}),{capture:!0,once:e})},Me=function(t,e,n,r){var o;return function(){n&&e.isFinal&&n.disconnect(),e.value>=0&&(r||e.isFinal||"hidden"===document.visibilityState)&&(e.delta=e.value-(o||0),(e.delta||e.isFinal||void 0===o)&&(t(e),o=e.value))}},je=function(){return void 0===Se&&(Se="hidden"===document.visibilityState?0:1/0,De((function(t){var e=t.timeStamp;return Se=e}),!0)),{get timeStamp(){return Se}}},Ke=function(){return be||(be=new Promise((function(t){return["scroll","keydown","pointerdown"].map((function(e){addEventListener(e,t,{once:!0,passive:!0,capture:!0})}))}))),be},Ve=/^(https?:)?\/\//;function We(t,e){if(!t)return!1;var n=t.replace(Ve,"");return e.some((function(t){return n.indexOf(t)>=0}))}var Fe={};function Be(t,e){var n=Fe[t];n?n.endTime||(n.endTime=(new Date).getTime(),n.duration=n.endTime-n.startTime,delete n.startTime,delete n.endTime):Fe[t]={startTime:(new Date).getTime()}}var He={},Ge=[{name:"fid",collectFn:function(t){var e=Ne("FID"),n=je(),r=function(t){t.startTime<n.timeStamp&&(e.value=t.processingStart-t.startTime,e.entries.push(t),e.isFinal=!0,i())},o=Ue("first-input",r),i=Me(t,e,o);o?De((function(){o.takeRecords().map(r),o.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(t,r){r.timeStamp<n.timeStamp&&(e.value=t,e.isFinal=!0,e.entries=[{entryType:"first-input",name:r.type,target:r.target,cancelable:r.cancelable,startTime:r.timeStamp,processingStart:r.timeStamp+t}],i())}))}},{name:"lcp",collectFn:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ne("LCP"),o=je(),i=function(t){var n=t.startTime;n<o.timeStamp?(r.value=n,r.entries.push(t)):r.isFinal=!0,e()},a=Ue("largest-contentful-paint",i);if(a){e=Me(t,r,a,n);var s=function(){r.isFinal||(a.takeRecords().map(i),r.isFinal=!0,e())};Ke().then(s),De(s,!0)}}},{name:"cls",collectFn:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ne("CLS",0),o=function(t){t.hadRecentInput||(r.value+=t.value,r.entries.push(t),e())},i=Ue("layout-shift",o);i&&(e=Me(t,r,i,n),De((function(t){var n=t.isUnloading;i.takeRecords().map(o),n&&(r.isFinal=!0),e()})))}},{name:"fcp",collectFn:function(t){var e,n=Ne("FCP"),r=je(),o=Ue("paint",(function(t){"first-contentful-paint"===t.name&&t.startTime<r.timeStamp&&(n.value=t.startTime,n.isFinal=!0,n.entries.push(t),e())}));o&&(e=Me(t,n,o))}}],qe=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=k(location.search.slice(1));1==+r.debug&&y.apply(void 0,s(["[radar] "+t+": "],e))};var Je=function(){var t=window.navigator.userAgent,e={};return t.split(" ").map((function(t){var n=t.split("/");e[n[0]]=n[1]})),e},Qe=function(){var t=window.navigator.userAgent;if(-1!==t.indexOf("Android"))return"WebView";if(-1!==t.indexOf("iPhone")){var e=Je();return e.Yoda&&"WK"===e.WebViewType?"YodaWKWebView":e.Yoda||"WKWebView"!==e.WebView?"UIWebView":"WKWebView"}return""},Ye=function(t,e){var n={};return Object.keys(e).forEach((function(r){t[e[r]]>0&&(n[r]=t[e[r]])})),n};function ze(t){return Array.isArray(t)?t.map((function(t){var e=t.tagName,n=void 0===e?"":e,r=t.id,o=t.getAttribute?t.getAttribute("class"):t.className||"",i=n.toLowerCase();return r&&(i+="#"+r),o&&(i+=o.split(/\s+/g).map((function(t){return"."+t})).join("")),i})).filter((function(t){return t})).join(","):""}function Xe(t){return JSON.parse(JSON.stringify(t))}var $e=function(t){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var e=Number(function(t){try{if(window&&window.localStorage){var e=window.localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(t){return e}}}catch(t){return null}return null}(t))||0;return e+1>1e8&&(e=0),function(t,e){try{if(window&&window.localStorage)return window.localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}}(t,e+1),e}}catch(t){}},Ze={},tn=function(t){return Ze[t]||(Ze[t]=0),Ze[t]++};function en(t){if(!(null==t?void 0:t.name))throw new Error("[Radar] 关键动作上报必须配置name");if((null==t?void 0:t.extra_info)&&!(t.extra_info instanceof Object))throw new Error("[Radar] 关键动作上报 extra_info 必须为 plain object")}var nn,rn,on=function(){function t(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.middlewares=[],(t=this.middlewares).push.apply(t,e)}return t.prototype.use=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=this.middlewares.pop();(t=this.middlewares).push.apply(t,e),this.middlewares.push(r)},t.prototype.invoke=function(t){var e;return(e=this.middlewares,function(t,n){var r=-1;return function o(i){if(i<=r)return new Error("`next` 被重复调用");r=i;var a=e[i];if(i===e.length&&(a=n),a)try{return a(t,o.bind(null,i+1))}catch(t){return t}}(0)})(t)},t}(),an=["KUAISHOU","THANOS","NEBULA"],sn=function(t){function e(e,n){var o,i,a=t.call(this)||this;return a.kpn="",a.plugins=[],a.logQueue=[],a.logQueueNext=[],a.queueConfig={wait:1e3,maxBatchLength:200},a.eventName="onpagehide"in window?"pagehide":"beforeunload",a.batchTimer=0,a.batchTimerNext=0,a.startedLoadReport=!1,a.radarSessionId="",a.radarSessionIdNext="",a.chromeMetric=Ge,a.isInKwai=!1,a.isUsingBridge=null,a.isUsingLegacy=null,a.isUsingDetachedReport=null,a.isSupportedYodaConcat=null,a.customDimension={},a.webviewData=null,a.webviewStart=null,a.webviewStartTime=null,a.finalSampling={},a.sampleData=null,a.sampleList=[ve.LOAD,ve.API,ve.CUSTOM,ve.ERROR,ve.EVENT,ve.RES],a.defaultSampleList={load:1,api:1,resource:.1,error:1,event:1,custom:1,isHit:!0},a.ignoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],a.lastRadarLogId="",a.computedSamplingAgain=!0,a.realSampledList=[],a.hasFmp=!1,a.customPerfList={},a.observeResource=function(t){t.getEntriesByType("resource").forEach((function(t){return a.reportPerformance(t)}))},a.asyncReportTiming=function(){Be("radarCreatedToOnload"),Be("onloadToFirstReport"),setTimeout((function(){Be("asyncReportTiming"),a.reportPerformance(me()),a.startedLoadReport=!0;try{a.observeResource(performance),a.observeChromeMetrics(a.chromeMetric),new PerformanceObserver(a.observeResource).observe({entryTypes:["resource"]})}catch(t){}Be("radarCreatedToFirstReport"),Be("onloadToFirstReport"),Be("asyncReportTiming")}),0)},a.chromeMetricCallback=function(t){var e,n,r=t.name,o=t.value;r=r.toLocaleLowerCase();var i={key:ve.CUSTOM,value:(e={},e[r]=o,e)};a.logCollect(i),a.logCollectNext({key:ve.EVENT,dimension:{name:r},value:{duration:o}}),Be(r+"Collect"),function(t){Object.assign(He,t)}(((n={})[r]=o,n))},a.observeChromeMetrics=function(t){var e=a.options;t.forEach((function(t){var n=t.name;e&&!e[n]||(Be(n+"Collect"),t.collectFn(a.chromeMetricCallback))}))},a.asyncMetricCollectDone=function(){var t={};Object.keys(Fe).forEach((function(e){var n=Fe[e];!n.duration&&n.startTime&&(n.duration=0,delete n.startTime),t[e]=n.duration}));var e={key:ve.CUSTOM,value:t};a.logCollect(e),a.flush(),a.weblog.flush(),S(window,a.eventName,a.asyncMetricCollectDone)},a.flush=function(){if(a.beforeFlush(),a.options&&!(a.logQueue.length<=0)&&a.startedLoadReport){var t=JSON.stringify(r(r({},a.weblog.commonPackage.getH5ExtraAttr()),{url:location.href,hash:location.hash,webviewStart:a.webviewStart,webviewStartTime:a.webviewStartTime,sampling_list:a.finalSampling?JSON.stringify(a.finalSampling):""})),e={project_id:a.options.projectId,radar_session_id:a.radarSessionId,h5_extra_attr:t},n=a.weblog.commonPackage,o=n.service_name,i=n.sub_biz,c=n.need_encrypt,u=n.app_package,l=a.currentUrlPackage&&a.currentUrlPackage.toJSON(),p=null;a.options.httpReportFirst||(p=a.addRadarStatEvent({key:we,value:r(r({},e),{data:s(a.logQueue),url_package:l,app_version_name:u.version_name}),serviceName:o||"",subBiz:i||"",needEncrypt:c||!1,container:u.container,realtime:!1,h5ExtraAttr:t})),p&&!a.options.httpReportFirst||a.weblog.collect("RADAR",{name:we,params:r(r({},e),{data:s(a.logQueue)}),currentUrlPackage:l,referUrlPackage:a.referUrlPackage&&a.referUrlPackage.toJSON(),serviceName:o||"radar_service_name"}),a.logQueue=[]}},a.flushNext=function(){if(a.options&&!(a.logQueueNext.length<=0)){var t=null;a.options.httpReportFirst||(t=a.reportByBridge()),t&&!a.options.httpReportFirst||a.reportByHttp(),a.logQueueNext=[]}},a.getCommonData=function(){var t,e=a.weblog.commonPackage.app_package,n=JSON.stringify(r(r({},a.weblog.commonPackage.getH5ExtraAttr()),{app_version_name:e.version_name,url:location.href,hash:location.hash})),o=a.currentUrlPackage&&a.currentUrlPackage.toJSON(),i=null===(t=a.options)||void 0===t?void 0:t.projectId;return{h5_extra_attr:n,url_package:o,app_version_name:e.version_name,project_id:i}},n&&(o=n),e&&(e.logger?a.apply(e):o=e),Be("radarCreatedToFirstReport"),Be("radarCreatedToOnload"),a.options=o,a.queueConfig=r(r({},a.queueConfig),a.options?a.options.queue:{}),a.ignoreList=a.ignoreList.concat((void 0===(i=a.options&&a.options.ignoreList)&&(i=[]),i.concat(Te).map((function(t){return t.replace(Ve,"")})))),a}return n(e,t),Object.defineProperty(e.prototype,"KSwitchSampled",{get:function(){return this.weblog.currentUrlPackage.sampled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isKSwitchSampled",{get:function(){return this.weblog.isKSwitchSampled},enumerable:!1,configurable:!0}),e.prototype.samplingControl=function(t){if(!t)return!1;var e=Math.random();return"number"==typeof t?e<t:e<t.sampling},e.prototype.use=function(t,e){var n=new t(e,this.options);this.plugins.push(n),this.weblog&&n.created()},e.prototype.apply=function(t){var e,n;this.weblog=t,this.kpn=this.weblog.Utils.ua.getDefaultKpn(),this.isInKwai=an.indexOf(this.kpn)>=0,this.upadteUrlPackage(),this.register(),this.ignoreList.push(null===(n=null===(e=this.weblog)||void 0===e?void 0:e.logger)||void 0===n?void 0:n.url),this.created()},e.prototype.created=function(){this.plugins.forEach((function(t){t.created()}))},e.prototype.destroy=function(){S(window,"load",this.asyncReportTiming),this.plugins.forEach((function(t){t.destroy()}))},e.prototype.computedRealSampled=function(t,e){if(this.isKSwitchSampled){var n=void 0;if("object"==typeof this.KSwitchSampled&&this.KSwitchSampled.radar){var r=this.KSwitchSampled.radar.all;r="number"!=typeof r?1:r;var o=this.KSwitchSampled.radar[e];n="number"!=typeof o?r:o*r}else n=this.KSwitchSampled?1:0;return n*t}return 1},e.prototype.getWebviewData=function(){if(window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.pageLoadData){var t=null;try{var e=window.__yodaCommonDataObject__.pageLoadData;t="string"==typeof e?JSON.parse(e):e}catch(t){return}var n=t.created,o=t.pageStart,i=t.userStart;this.webviewData=r({webviewStart:i||o||n},t);var a={key:ve.EVENT,value:null,dimension:{name:"客户端数据注入成功",event_type:"radar_inject_success"}};this.logCollect(a),this.logCollectNext(a)}},e.prototype.getSampleData=function(){var t=this,e=this.weblog.Utils.yoda;if(e&&(this.sampleData=this.defaultSampleList,window.updateYodaSampleRateWithParams=function(e){t.updateSampleData(e),t.handleSample()}),window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.sampleData){this.updateSampleData(),this.handleSample();var n={key:ve.EVENT,value:null,dimension:{name:"客户端采样率注入成功",event_type:"radar_sample_inject_success"}};this.logCollect(n),this.logCollectNext(n)}else e&&e.getWebviewLoadPerf().then((function(e){e.sampleData&&(t.updateSampleData(e.sampleData),t.handleSample())}))},e.prototype.updateSampleData=function(t){var e=this,n=null;try{var r=window.__yodaCommonDataObject__.sampleData||t;n="string"==typeof r?JSON.parse(r):r}catch(t){return}this.sampleData=this.defaultSampleList,n&&Object.keys(n).forEach((function(t){e.sampleData[t]=n[t]}))},e.prototype.register=function(){return i(this,void 0,void 0,(function(){var t,e,n;return a(this,(function(r){switch(r.label){case 0:return me()?("undefined"!=typeof window&&window.yodaCollectErrorDataDestroy&&window.yodaCollectErrorDataDestroy(),performance.timing.loadEventStart>0?this.asyncReportTiming():w(window,"load",this.asyncReportTiming),this.options&&this.options.radarCost&&w(window,this.eventName,this.asyncMetricCollectDone),w(window,this.eventName,this.flush),w(window,this.eventName,this.flushNext),this.getSampleData(),this.getWebviewData(),this.radarSessionId=this.nanoId(),this.radarSessionIdNext=this.uuid(),(t=this.weblog.Utils.yoda)?[3,1]:(this.isUsingBridge=!1,this.isSupportedYodaConcat=!1,this.isUsingLegacy=!1,[3,6])):[2];case 1:return null!=this.isUsingBridge?[3,3]:(e=this,[4,t.isSupportBridgeLog()]);case 2:e.isUsingBridge=r.sent(),r.label=3;case 3:return null!=this.isSupportedYodaConcat?[3,5]:(n=this,[4,t.isSupportBridge("sendRadarLog")]);case 4:n.isSupportedYodaConcat=r.sent(),r.label=5;case 5:this.isUsingLegacy=this.isUsingBridge&&!this.isSupportedYodaConcat,r.label=6;case 6:return this.isUsingDetachedReport=this.isInKwai&&!this.isUsingBridge||this.isUsingLegacy,[2]}}))}))},e.prototype.throttle=function(t,e,n,r){if(void 0===r&&(r={}),e.noThrottle||"number"!=typeof t)return t;var o=r.startPoint,i=r.endPoint;if(t>6e4||t<0||isNaN(t)){if(Math.random()<.1){var a="["+n+" 异常]: "+t+"，原始数据为："+e.end+": "+i+" - "+e.start+": "+o,s={key:ve.EVENT,value:null,dimension:{name:"雷达数据异常",event_type:"radar_error",message:a,src:location.href,webViewType:Qe(),yoda_version:Je().yoda_version||""}};this.logCollect(s),this.logCollectNext(s)}return null}return Math.round(t)},e.prototype.reportPerformance=function(t){this.plugins.forEach((function(e){t&&e.when(t)&&e.onPerfReport(t)}))},e.prototype.calculate=function(t,e,n){var r=e[t];if(r){if(r.cachedSkip)if(this.calculate("cached",e,n))return;if("function"==typeof r.custom){var o=r.custom(t,n);return this.throttle(o,r,t)}var i=r.end,a=r.start,s=+n[i]||performance.timing[i],c=+n[a]||performance.timing[a],u=s-c;if(!r.notCatchIfUndefined||void 0!==s&&void 0!==c)return this.throttle(u,r,t,{startPoint:c,endPoint:s})}else _("[warn 310]","[Radar] perf key "+t+" is unexpected!")},e.prototype.calculateNext=function(t,e,n){var r=e[t];if(r){if(r.cachedSkip)if(this.calculateNext("cached",e,n))return;if("function"==typeof r.custom)return r.custom(t,n);var o=r.end,i=r.start,a=+n[o]||performance.timing[o],s=+n[i]||performance.timing[i],c=a-s;if(!r.notCatchIfUndefined||void 0!==a&&void 0!==s)return c}},e.prototype.generateLog=function(t,e,n){var r=this;void 0===n&&(n=!0);var o={};return Object.keys(t).forEach((function(i){var a=i,s=n?r.calculate(a,t,e):r.calculateNext(a,t,e);null!=s&&(o[a]=s)})),o},e.prototype.subDimension=function(t){this.customDimension&&(t.dimension||(t.dimension={}),Object.assign(t.dimension,this.customDimension))},e.prototype.nanoId=function(){for(var t=1e9*Math.random()>>>0,e=[],n=0;n<7;n++)e.push("0123456789ABCDEF".charAt(16*Math.random()));return t+e.join("")},e.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},e.prototype.beforeFlush=function(){var t=this;if(this.computedSamplingAgain){var e={radarLoadSampling:{sampling:1,type:"load"},radarApiSampling:{sampling:this.options&&this.options.apiSampling||1,type:"api"},radarErrorSampling:{sampling:this.options&&this.options.errorSampling||1,type:"error"},radarResourceSampling:{sampling:this.options&&this.options.resourceSampling||.1,type:"resource"},radarCustomSampling:{sampling:this.options&&this.options.customSampling||1,type:"custom"},radarEventSampling:{sampling:this.options&&this.options.eventSampling||1,type:"event"}};this.realSampledList=[],Object.keys(e).forEach((function(n){var r=t.isKSwitchSampled?t.computedRealSampled(e[n].sampling,e[n].type):e[n],o=t.samplingControl(r);t.finalSampling[e[n].type]=r,o&&t.realSampledList.push(e[n].type)})),this.isKSwitchSampled&&(this.computedSamplingAgain=!1)}this.logQueue=this.logQueue.filter((function(e){return-1!==t.realSampledList.indexOf(e.key)}))},e.prototype.upadteUrlPackage=function(){this.weblog&&(this.computedSamplingAgain=!0,this.currentUrlPackage=this.weblog.currentUrlPackage,this.referUrlPackage=this.weblog.referUrlPackage)},e.prototype.decorateLog=function(t){this.currentUrlPackage||this.upadteUrlPackage(),this.customDimension&&this.subDimension(t),this.currentUrlPackage&&this.currentUrlPackage.page!==this.weblog.currentUrlPackage.page&&(this.flushNext(),this.flush(),this.upadteUrlPackage())},e.prototype.logCollect=function(t){var e=this;if(this.options){this.decorateLog(t);try{window.dispatchEvent(new CustomEvent("get-radar-data",{detail:{kv:t}}))}catch(t){}var n=!0;if("load"===t.key)for(var r=0;r<this.logQueue.length;r++){var o=this.logQueue[r];if("load"===o.key){Object.assign(o,t),n=!1;break}}n&&this.logQueue.push(t),qe("radarLog",JSON.parse(JSON.stringify(t))),this.batchTimer||(this.logQueue.length>this.queueConfig.maxBatchLength?this.flush():this.batchTimer=window.setTimeout((function(){e.flush(),clearTimeout(e.batchTimer),e.batchTimer=0}),this.queueConfig.wait))}},e.prototype.addRadarStatEvent=function(t){var e=this;try{var n=this.weblog.Utils.yoda;if(!n)return!1;var o=function(t){var e,n;if(!t.value)return t;var o=t.value,i=function(t){var e,n=[];return t.forEach((function(t){"load"===t.key?e=t:n.push(t)})),[e,n]}(o.data),a=i[0],s=i[1],c={project_id:o.project_id,app_version_name:o.app_version_name,url_package:o.url_package,h5_extra_attr:t.h5ExtraAttr};return{loadLog:a?{removeStashedLog:[],sendImmediate:null!==(n=null===(e=a.dimension)||void 0===e?void 0:e.sendImmediate)&&void 0!==n&&n,customData:r({data:[a]},c)}:null,commonLog:s.length?{removeStashedLog:[],sendImmediate:!0,customData:r({data:s},c)}:null}}(t),i=o.loadLog,a=o.commonLog;if(i){if(this.lastRadarLogId&&(i.removeStashedLog=[this.lastRadarLogId],i.sendImmediate)){var s={removeStashedLog:[this.lastRadarLogId],sendImmediate:!1,customData:{"":""}};n.sendRadarLog(s).then((function(t){t&&t.logId&&(e.lastRadarLogId=t.logId)}))}n.sendRadarLog(i).then((function(t){t&&t.logId&&(e.lastRadarLogId=t.logId)}))}return a&&n.sendRadarLog(a),!0}catch(t){return!1}},e.prototype.calculateSample=function(t){var e=(null==t?void 0:t.load)||1,n={};return t&&Object.keys(t).forEach((function(r){var o=t[r]/e;n[r]=o>1?1:o})),n},e.prototype.handleSample=function(){var t,e,n,r,o,i,a,s,c=this,u=this.weblog.Utils.yoda;u||this.sampleData||(this.sampleData={load:(null===(t=this.options)||void 0===t?void 0:t.sampling)||1,api:(null===(e=this.options)||void 0===e?void 0:e.apiSampling)||1,resource:(null===(n=this.options)||void 0===n?void 0:n.resourceSampling)||.1,error:(null===(r=this.options)||void 0===r?void 0:r.errorSampling)||1,event:(null===(o=this.options)||void 0===o?void 0:o.eventSampling)||1,custom:(null===(i=this.options)||void 0===i?void 0:i.customSampling)||1}),s=this.calculateSample(this.sampleData),a={radarLoadSampling:{sampling:1,type:"load"},radarApiSampling:{sampling:(null==s?void 0:s.api)||1,type:"api"},radarErrorSampling:{sampling:(null==s?void 0:s.error)||1,type:"error"},radarResourceSampling:{sampling:(null==s?void 0:s.resource)||.1,type:"resource"},radarCustomSampling:{sampling:(null==s?void 0:s.custom)||1,type:"custom"},radarEventSampling:{sampling:(null==s?void 0:s.event)||1,type:"event"}},this.sampleList=[],Object.keys(a).forEach((function(t){var e=a[t];c.samplingControl(e)&&c.sampleList.push(a[t].type)}))},e.prototype.logCollectNext=function(t){var e=this,n=Xe(t);if(this.options&&(!this.sampleData||!1!==this.sampleData.isHit)&&this.sampleList.includes(n.key)){var o=this.getCommonData(),i=o.app_version_name;delete o.app_version_name;var a=new on((function(t,n){return t.dimension.app_version_name=i,t=r(r(r({},t),o),{event_client_timestamp:Date.now(),event_trigger_source:"H5",radar_session_id:e.radarSessionIdNext})}));if(a.use((function(t,e){return t.key&&"load"===t.key&&(t.dimension=r(r({},t.dimension),{load_device_increase_id:$e("LOAD_DEVICE_INCREASE_ID"),load_session_increase_id:tn("LOAD_SESSION_INCREASE_ID")})),t.key&&"load"!==t.key&&(t.dimension=r(r({},t.dimension),{other_device_increase_id:$e("OTHER_DEVICE_INCREASE_ID"),other_session_increase_id:tn("OTHER_SESSION_INCREASE_ID")})),e()}),(function(t,n){return t.dimension.sample_rate=e.sampleData&&e.sampleData[t.key]||1,n()})),(n=a.invoke(n))instanceof Error)throw n;this.decorateLog(n);try{window.dispatchEvent(new CustomEvent("get-radar-next-data",{detail:{kv:n}}))}catch(t){}var s=!0;if("load"===n.key)for(var c=0;c<this.logQueueNext.length;c++){var u=this.logQueueNext[c];if("load"===u.key){Object.assign(u,n),s=!1;break}}s&&this.logQueueNext.push(n),qe("radarLogNext",JSON.parse(JSON.stringify(n))),this.batchTimerNext||(this.logQueueNext.length>this.queueConfig.maxBatchLength?this.flushNext():this.batchTimerNext=window.setTimeout((function(){e.flushNext(),clearTimeout(e.batchTimerNext),e.batchTimerNext=0}),this.queueConfig.wait))}},e.prototype.reportByHttp=function(){var t,e=this.getCommonData(),n={project_id:null===(t=this.options)||void 0===t?void 0:t.projectId,radar_session_id:this.radarSessionIdNext,h5_extra_attr:e.h5_extra_attr},r=this.logQueueNext.filter((function(t){return"load"===t.key})),o=this.logQueueNext.filter((function(t){return"load"!==t.key}));Array.isArray(r)&&r.length&&this.collectLog(n,r,"radarSDK"),Array.isArray(o)&&o.length&&this.collectLog(n,o,"radarSDKSupplement")},e.prototype.collectLog=function(t,e,n){this.weblog.collect("RADAR",{name:we,params:r(r({},t),{data:s(e)}),serviceName:n})},e.prototype.reportByBridge=function(){var t=this.weblog.Utils.yoda;if(!t)return!1;var e=this.logQueueNext.filter((function(t){return"load"===t.key})),n=this.logQueueNext.filter((function(t){return"load"!==t.key}));if(!e.length&&!n.length)return!0;try{if(e.length){var r=e[0];t.sendSummarizedLog({key:"h5_load",data:r})}return n.length&&t.sendRadarLog({data:n}),!0}catch(t){return!1}},e}(re),cn=function(t,e){this.radar=t,this.options=e},un=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.key="navigation",e.logData={},e.logSended=!1,e.saveWebviewEntry={},e.hasReportBase=!1,e.record={fmp:!1,base:!1,webviewPerf:!1},e.loadTimeout=null,e.gettingWebview=!1,e.REPEAT_TIME=5,e.getWebviewTimes=e.REPEAT_TIME,e.reportOnUnload=function(t){e.logSended||e.radar.isSupportedYodaConcat||(e.logSended=!0,e.reportFirstScreen(Object.assign(e.logData,He)),e.radar.logCollect(e.data),"noflush"!==t&&(e.radar.flush(),e.radar.weblog.flush()))},e}return n(e,t),Object.defineProperty(e.prototype,"sendImmediate",{get:function(){return this.record.fmp&&this.record.base&&this.record.webviewPerf&&!(!(t=window.navigator.userAgent.match(/tbht\/([\w]+)/i))||"0"===t[1]);var t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this.sepDimension({key:ve.LOAD,value:this.logData})},enumerable:!1,configurable:!0}),e.prototype.created=function(){return i(this,void 0,void 0,(function(){return a(this,(function(t){return[2]}))}))},e.prototype.when=function(t){if(t.custom){var e=(t.entry||{}).key;return["fmp","play_clicked","play_idr","webViewPerf"].indexOf(e)>-1}return!t.entryType||"navigation"===t.entryType},e.prototype.getWebviewLoadData=function(){return i(this,void 0,void 0,(function(){var t,e,n,r,o,i,s;return a(this,(function(a){switch(a.label){case 0:return this.record.webviewPerf?[2,!0]:(t=this.radar.weblog.Utils.yoda,(n=t)?[4,t.getWebviewLoadPerf()]:[3,2]);case 1:n=a.sent(),a.label=2;case 2:return(e=n)&&e.timeData?(this.record.webviewPerf=!0,r=e.timeData,o=r.userStart,i=r.pageStart,s=r.created,this.radar.webviewStart="userStart",this.radar.webviewStartTime=o,o||(i?(e.timeData.userStart=i,this.radar.webviewStart="pageStart",this.radar.webviewStartTime=i):(e.timeData.userStart=s,this.radar.webviewStart="created",this.radar.webviewStartTime=s)),this.onPerfReport({custom:!0,entry:{key:"webViewPerf",value:e.timeData}}),[2,!0]):[2,!1]}}))}))},e.prototype.webviewPatch=function(){return i(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.gettingWebview?[2]:(this.gettingWebview=!0,[4,this.repeatWebview()]);case 1:return t.sent(),this.gettingWebview=!1,[2]}}))}))},e.prototype.repeatWebview=function(){return i(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.getWebviewLoadData()];case 1:return!t.sent()&&this.getWebviewTimes>0?(this.getWebviewTimes--,[4,this.repeatWebview()]):[3,3];case 2:t.sent(),t.label=3;case 3:return this.getWebviewTimes=this.REPEAT_TIME,[2]}}))}))},e.prototype.onPerfReport=function(t){return i(this,void 0,void 0,(function(){var e,n,r,o,i,s,c,u,l,p=this;return a(this,(function(a){if(t.custom){if((e=t.entry)&&(n=e.key,r=e.value,o=t.renderTime,"fmp"===n&&(performance.timing.radarFmp=o,this.record.fmp=!0,u=Ye(performance.timing,Le),Object.assign(this.logData,((l={})[n]=r,l),u),this.webviewPatch(),this.record.webviewPerf&&(s=this.radar.generateLog(Oe,this.saveWebviewEntry),Object.assign(this.logData,s))),"webViewPerf"===n)){if(!(i=e.value))return[2];this.saveWebviewEntry=i,s=this.radar.generateLog(Oe,i),Object.assign(this.logData,s)}}else c=this.radar.generateLog(Ee,t),u=Ye(performance.timing,Le),Object.assign(this.logData,c,u),this.record.base=!0;return this.radar.isSupportedYodaConcat?(this.webviewPatch(),this.radar.logCollect(this.data)):this.radar.isUsingDetachedReport&&this.record.webviewPerf&&this.record.fmp&&this.record.base?this.reportOnUnload("noflush"):this.record.fmp&&this.record.base&&!this.hasReportBase?(clearTimeout(this.loadTimeout),this.loadTimeout=null,this.loadReport()):!this.hasReportBase&&this.record.base&&(this.loadTimeout=setTimeout((function(){p.loadReport(),p.hasReportBase=!0}),2e3)),[2]}))}))},e.prototype.destroy=function(){clearTimeout(this.delay)},e.prototype.sepDimension=function(t){var e=t.key,n=t.value,r=n.protocol;return{key:e,value:o(n,["protocol"]),dimension:{protocol:r,sendImmediate:this.sendImmediate}}},e.prototype.reportFirstScreen=function(t){if(t.play_clicked&&t.play_idr){var e=t.play_idr-t.play_clicked;e>0&&e<6e4&&(this.logData.play_first_screen=e)}},e.prototype.loadReport=function(){Object.assign(this.logData,He),this.radar.logCollect(Xe(this.data)),this.radar.flush(),this.radar.weblog.flush()},e}(cn);!function(t){t.LOAD="load",t.RES="resource",t.API="api",t.ERROR="error",t.SDK_ERROR="sdk_error",t.CUSTOM="custom",t.BATCH="batch",t.EVENT="event"}(nn||(nn={})),function(t){t.SCRIPT="script",t.RES="res",t.API="api",t.VIDEO="video"}(rn||(rn={}));var ln={redirect:{end:"redirectEnd",start:"redirectStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(t,e){return e.redirectCount}},ssl:{custom:function(t,e){return 0===e.secureConnectionStart?0:e.requestStart-e.secureConnectionStart}},ssl_start:{custom:function(t,e){return 0===e.secureConnectionStart?0:e.secureConnectionStart-e.redirectStart}},ttfb:{end:"responseStart",start:"requestStart"},request_start:{end:"requestStart",start:"navigationStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domInteractive"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=performance.getEntries().filter((function(t){return"first-paint"===t.name}))[0];return t?Math.ceil(t.startTime+t.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var t=me(),e=performance.getEntries(),n=performance.getEntries().filter((function(t){return"navigation"===t.initiatorType}))[0],r=e.filter((function(t){return"script"===t.initiatorType}))[0],o=n?n.domComplete:t.domComplete-t.navigationStart;return r&&o?o-r.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(t,e){return e.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document?document.all.length:null}}},pn={fetch_start:{custom:function(t,e){return Math.round(e.fetchStart)},noThrottle:!0},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0},ssl:{cachedSkip:!0,custom:function(t,e){return 0===e.secureConnectionStart?0:e.requestStart-e.secureConnectionStart}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0},total:{end:"responseEnd",start:"fetchStart"},duration:{end:"responseEnd",start:"fetchStart"},size:{cachedSkip:!0,custom:function(t,e){return e.encodedBodySize},noThrottle:!0},protocol:{custom:function(t,e){return e.nextHopProtocol}},file:{custom:function(t,e){return e.name},noThrottle:!0},res_type:{custom:function(t,e){return e.initiatorType}},cached:{custom:function(t,e){return 0===e.transferSize||null==e.transferSize&&0===e.domainLookupStart},noThrottle:!0}},dn={main_api:{end:"apiEnd",start:"apiStart"},main_api_offset:{end:"apiStart",start:"domLoading"}},fn={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connect_start",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",fmp_time:"radarFmp"},hn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.key="navigation-radar-plus",e.logData={},e}return n(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.sepDimension({key:nn.LOAD,value:this.logData})},enumerable:!1,configurable:!0}),e.prototype.created=function(){return i(this,void 0,void 0,(function(){return a(this,(function(t){return this.onPerfReport({custom:!0,entry:{key:"radar_init",value:null}}),[2]}))}))},e.prototype.when=function(t){if(t.custom){var e=(t.entry||{}).key;return["fmp","customPerf"].indexOf(e)>-1}return!t.entryType||"navigation"===t.entryType},e.prototype.onPerfReport=function(t){return i(this,void 0,void 0,(function(){var e,n,r,o,i,s;return a(this,(function(a){return t.custom?(e=t.entry)&&(n=e.key,r=e.value,o=t.renderTime,"radar_init"===n&&Object.assign(this.logData,{event_name:"radar_init"}),"fmp"===n&&(performance.timing.radarFmp=o,i=this.radar.generateLog(dn,performance.timing,!1),Object.assign(this.logData,((s={})[n]=r,s),{event_name:"fmp"},i)),"customPerf"===n&&Object.assign(this.logData,{event_name:"h5_custom_metric",custom_metric_name:r,custom_metric_timestamp:this.radar.customPerfList[r].time})):Object.assign(this.logData,{event_name:"h5_load"}),this.getCommonLog(t),this.loadReport(),[2]}))}))},e.prototype.destroy=function(){},e.prototype.getCommonLog=function(t){var e=this.radar.generateLog(ln,t,!1),n=Ye(performance.timing,fn);Object.assign(this.logData,e,n)},e.prototype.sepDimension=function(t){var e=t.key,n=t.value,r=n.protocol,i=n.event_name,a=n.custom_metric,s=n.custom_metric_name;return{key:e,value:o(n,["protocol","event_name","custom_metric","custom_metric_name"]),dimension:{protocol:r,event_name:i,custom_metric:a,custom_metric_name:s}}},e.prototype.loadReport=function(){Object.assign(this.logData,He),this.collectAndFlush()},e.prototype.collectAndFlush=function(){this.radar.logCollectNext(Xe(this.data)),this.radar.flushNext(),this.radar.weblog.flush()},e}(cn),gn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.key="resource",e.onResError=function(t){e.isScriptError(t)||e.radar.logCollect(e.sepDimension({key:ve.RES,value:{failed:!0,file:t.target.src,res_path:ze(t.path||t.composedPath&&t.composedPath())}}))},e}return n(e,t),e.prototype.created=function(){w(window,"error",this.onResError,!0)},e.prototype.when=function(t){return!We(t.name,this.radar.ignoreList)&&("resource"===t.entryType&&"fetch"!==t.initiatorType&&"xmlhttprequest"!==t.initiatorType)},e.prototype.isScriptError=function(t){return t.message||null!=t.lineno},e.prototype.onPerfReport=function(t){var e=this.radar.generateLog(Pe,t);this.radar.logCollect(this.sepDimension({key:ve.RES,value:e}))},e.prototype.destroy=function(){S(window,"error",this.onResError,!0)},e.prototype.sepDimension=function(t){var e=t.key,n=t.value,r=n.protocol,i=n.file,a=n.cached,s=n.res_path,c=n.failed,u=n.res_type;return{key:e,value:o(n,["protocol","file","cached","res_path","failed","res_type"]),dimension:{protocol:r,file:i,cached:a,failed:c,res_path:s,res_type:u}}},e}(cn),mn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.key="resource",e.onResError=function(t){e.isScriptError(t)||e.radar.logCollectNext(e.sepDimension({key:nn.RES,value:{failed:!0,file:t.target.src,res_path:ze(t.path||t.composedPath&&t.composedPath())}}))},e}return n(e,t),e.prototype.created=function(){w(window,"error",this.onResError,!0)},e.prototype.when=function(t){return!We(t.name,this.radar.ignoreList)&&("resource"===t.entryType&&"fetch"!==t.initiatorType&&"xmlhttprequest"!==t.initiatorType)},e.prototype.isScriptError=function(t){return t.message||null!=t.lineno},e.prototype.onPerfReport=function(t){var e=this.radar.generateLog(pn,t,!1);this.radar.logCollectNext(this.sepDimension({key:nn.RES,value:r(r({},e),{failed:!1})}))},e.prototype.destroy=function(){S(window,"error",this.onResError,!0)},e.prototype.sepDimension=function(t){var e=t.key,n=t.value,r=n.protocol,i=n.file,a=n.cached,s=n.res_path,c=n.failed,u=n.res_type;return{key:e,value:o(n,["protocol","file","cached","res_path","failed","res_type"]),dimension:{protocol:r,file:i,cached:a,failed:c,res_path:s,res_type:u}}},e}(cn);function vn(t){return void 0===t&&(t=""),"__radar_"+t+Math.random().toString(36).substring(2,8)}function yn(t,e){var n=window.XMLHttpRequest;if(!n)return _("HAS NOT XMLHttpRequest!"),!1;window.XMLHttpRequest=function(){var t=new n;t._request=Object.create(null),t._response=Object.create(null);var r=vn();t._request.id=r;var o=function(){var e,n,r,o;for(e in t._response.status=t.status,t._response.statusText=t.statusText,o=function(t,e){switch(null==e&&(e={}),typeof t){case"object":var n=[];for(var r in t){var o=t[r],i=r.toLowerCase();n.push(i+":\t"+o)}return n.join("\n")+"\n";case"string":for(var a=0,s=(n=t.split("\n")).length;a<s;a++){var c=n[a];if(/([^:]+):\s*(.+)/.test(c)){var u=RegExp.$1,l=null!=u?u.toLowerCase():void 0;o=RegExp.$2,null==e[l]&&(e[l]=o)}}return e}}(t.getAllResponseHeaders()))r=o[e],t._response.headers[e]||(n=e.toLowerCase(),t._response.headers[n]=r)};return t.addEventListener("readystatechange",(function(){switch(t.readyState){case 4:"function"==typeof e&&(o(),function(){if(t.responseType&&"text"!==t.responseType)"document"===t.responseType?(t._response.xml=t.responseXML,t._response.data=t.responseXML):t._response.data=t.response;else{t._response.text=t.responseText,t._response.data=t.responseText;try{t._response.xml=t.responseXML}catch(t){}}"responseURL"in t&&(t._response.finalUrl=t.responseURL)}(),e(t._request,t._response))}})),t},["DONE","HEADERS_RECEIVED","LOADING","OPENED","UNSENT"].forEach((function(t){window.XMLHttpRequest[t]=n[t]})),window.XMLHttpRequest.prototype=n.prototype,window.XMLHttpRequest.prototype._request=Object.create(null),window.XMLHttpRequest.prototype._response=Object.create(null);var r=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(t,e,n,o,i){return this._request={method:t,url:e,async:n,user:o,pass:i},this._response.headers={},r.apply(this,arguments)};var o=window.XMLHttpRequest.prototype.send;return window.XMLHttpRequest.prototype.send=function(){return"function"==typeof t&&t(this._request),o.apply(this,arguments)},function(){n&&(window.XMLHttpRequest=n),r&&(window.XMLHttpRequest.prototype.open=r),o&&(window.XMLHttpRequest.prototype.send=o)}}function _n(t,e){var n,r=function(t){if("function"!=typeof t.fetch)return null;var e=t.fetch;return t.fetch=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Sn.apply(void 0,s([t],e))}}(t.fetch),{register:function(t){return wn.push(t),function(){var e=wn.indexOf(t);e>=0&&wn.splice(e,1)}},clear:function(){wn=[]},unRegister:function(){e&&(t.fetch=e)}}}("function"==typeof importScripts?self:window);return r&&r.register({request:function(e,r){"function"==typeof t&&((n="string"==typeof e?new Request(e,r):e).id=vn(),t(n))},response:function(t){"function"==typeof e&&e(n,t)},responseError:function(t){"function"==typeof e&&e(n,{status:0,statusText:t})}}),null==r?void 0:r.unRegister}var wn=[];function Sn(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=wn.reduce((function(t,e){return[e].concat(t)}),[]);r.forEach((function(t){var n=t.request;e=n.apply(void 0,e)||e}));var o=t.apply(void 0,e),i=null;return o.then((function(t){i=t;var e=t.headers.get("content-type");return e&&e.includes("application/json")||e&&e.includes("text/html")?t.clone().text():(item.responseType="","[object Object]")})).then((function(t){var e=i.clone();return e.data=t,r.forEach((function(t){var n=t.response;n&&(e=n(e)||e)})),i}),(function(t){return r.forEach((function(e){var n=e.responseError;n&&(t=n(t)||t)})),i}))}var bn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.queue=[],e.key="api",e.logList=[],e.perfList=[],e.unhookXML=null,e.unhookFetch=null,e.beforeHook=function(t){if(!We(t.url,e.radar.ignoreList)){var n={api:e.requestURLCompletion(t.url),method:t.method,request:t,startTime:Date.now()};e.queue.push(n)}},e.afterHook=function(t,n){var i=e.queue.filter((function(e){return e.request===t}))[0];if(i){delete i.request;var a=i.startTime,s=o(i,["startTime"]),c=Date.now(),u=c-a,l=n.status;"function"==typeof e.options.customizeRadarStatus&&(l=e.options.customizeRadarStatus(n));var p=e.customHook({request:t,response:n,duration:u}),d=En(n.headers),f=r(r({duration:u,total:u,status:l,size:+d,custom_failed:!(l>=200&&l<300)},s),p);"string"==typeof n.text&&(f.responseData=n.text);var h=r(r({},n),{status:l});if(e.isResponseError(h))e.radar.logCollect(e.sepDimension({key:ve.API,value:f})),e.radar.logCollectNext(e.sepDimension({key:ve.API,value:f}));else{if(!e.radar.hasFmp){var g=performance.timing.apiStart;performance.timing.apiStart=g?Math.min(g,a):a;var m=performance.timing.apiEnd;performance.timing.apiEnd=m?Math.max(m,c):c}!e.mergeAPIPerf(null,f)&&e.logList.push(f)}e.queue=e.queue.filter((function(e){return e.request&&e.request!==t}))}},e}return n(e,t),e.prototype.when=function(t){return!We(t.name,this.radar.ignoreList)&&("resource"===t.entryType&&("fetch"===t.initiatorType||"xmlhttprequest"===t.initiatorType))},e.prototype.onPerfReport=function(t){var e=this.radar.generateLog(ke,t,!1);!this.mergeAPIPerf(r(r({},e),{api:e.file}))&&this.perfList.push(r(r({},e),{api:e.file}))},e.prototype.mergeAPIPerf=function(t,e){var n=t||e,r=t?this.logList:this.perfList;if(!n)return!1;for(var o=-1,i=0,a=r.length;i<a;i++){var s=r[i],c=(n.api||"").replace(/\?.+$/,""),u=(s.api||"").replace(/\?.+$/,""),l=n.size;c===u&&(Object.assign(n,s),delete n.file,l&&(n.size=l),!n.size&&n.responseData&&(n.size=P(n.responseData)),delete n.responseData,o=i)}return-1!==o&&(r.splice(o,1),this.radar.logCollect(this.sepDimension({key:ve.API,value:n})),this.radar.logCollectNext(this.sepDimension({key:ve.API,value:n})),!0)},e.prototype.sepDimension=function(t){var e=t.key,n=t.value,r=n.res_type,i=n.protocol,a=n.cached,s=n.custom_failed,c=n.status,u=n.api,l=n.method,p=n.response_code,d=n.response_msg;return{key:e,value:o(n,["res_type","protocol","cached","custom_failed","status","api","method","response_code","response_msg"]),dimension:{res_type:r,protocol:i,api:u,custom_failed:s,status:c,cached:a,method:l,response_code:p,response_msg:d}}},e.prototype.requestURLCompletion=function(t){var e=document.location,n=e.protocol,r=e.host;return 0===t.indexOf("//")?n+t:0===t.indexOf("/")?n+"//"+r+t:t},e.prototype.isResponseError=function(t){return 0===t.status},e.prototype.created=function(){this.unhookXML=yn(this.beforeHook,this.afterHook),this.unhookFetch=_n(this.beforeHook,this.afterHook)},e.prototype.destroy=function(){this.unhookXML&&this.unhookXML(),this.unhookFetch&&this.unhookFetch()},e.prototype.customHook=function(t){var e={};if("function"!=typeof this.options.APIHook)return e;var n={};try{n=this.options.APIHook(t)}catch(t){return{}}if(!n)return e;var r=n.response_msg,o=n.response_code,i=n.status,a=n.custom_failed;try{e.response_msg=JSON.stringify(r).slice(0,100)}catch(t){e.response_msg="radar error: 传入的response_msg有错误"}return e.response_code=Number(o),void 0!==i&&(e.status=i),void 0!==a&&(e.custom_failed=a),e},e}(cn);function En(t){return t?"function"==typeof t.get?+t.get("Content-Length")||0:+t["content-length"]||0:0}var kn=[];function Pn(t,e){On(e)>=0||(kn.push(e),setTimeout((function(){kn.splice(On(e),1)}),2e3),Tn(t,e))}function Tn(t,e){var n=function(t){var e=ve.ERROR,n=t.error_cons_type,r=t.file,i=t.error_type,a=t.msg,s=t.col,c=t.line,u=t.stack,l=o(t,["error_cons_type","file","error_type","msg","col","line","stack"]);return{key:e,value:l,dimension:{error_cons_type:n,file:r,error_type:i,msg:a,col:s,line:c,stack:u}}}(e);t.logCollect(n)}function On(t){for(var e=0;e<kn.length;e++)if(n=kn[e],r=t,n.msg===r.msg&&n.stack===r.stack&&n.file===r.file&&n.line===r.line&&n.col===r.col)return e;var n,r;return-1}function Ln(t){return t.message||null!=t.lineno}function Cn(t,e,n){var r,o,i,a;if((a=e)&&(a instanceof Error||"object"==typeof a&&"string"==typeof a.message))r=e.name||"ErrorLikeObject",o=e.message||"",i=e.stack||void 0;else if(function(t,e){return null==t&&"Script error."===(null==e?void 0:e.message)}(e,n))r="CrossOriginError",o="* cross origin "+t+" with message: "+((null==n?void 0:n.message)||"<UNKNOWN>")+"\n -- by WebLogger Radar Plugin";else{r=null==e?""+e:typeof e,o="* "+t+" with value: "+function(t){var e;try{e=t.toString()}catch(t){}"string"!=typeof e||""===e?e=null===t?"<NULL>":void 0===t?"<UNDEFINED>":""===e?"<EMPTY>":"<UNKNOWN>":e.length>2e3&&(e=e.substring(0,2e3)+"<<< ……");return e}(e)+"\n  -- by WebLogger Radar Plugin"}return{error_type:_e.SCRIPT,error_cons_type:r,msg:o,stack:i}}var Nn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.key="error",e.onError=function(t){if(Ln(t)){var n=r(r({},Cn("global error",t.error,t)),{file:t.filename,line:t.lineno,col:t.colno});Pn(e.radar,n)}},e.onPromiseError=function(t){var n=Cn("promise error",t.reason);Pn(e.radar,n)},e}return n(e,t),e.prototype.when=function(t){if(t.custom){var e=(t.entry||{}).key;if(["play_block","play_error"].indexOf(e)>-1)return!0}return!1},e.prototype.onPerfReport=function(t){if(t.custom){var e=t.entry||{},n=e.key,r=e.value;Tn(this.radar,{error_type:_e.VIDEO,error_cons_type:n,msg:r})}},e.prototype.created=function(){w(window,"error",this.onError,!0),w(window,"unhandledrejection",this.onPromiseError)},e.prototype.destroy=function(){S(window,"error",this.onError,!0),S(window,"unhandledrejection",this.onPromiseError)},e}(cn),Un=[];function Rn(t,e){In(e)>=0||(Un.push(e),setTimeout((function(){Un.splice(In(e),1)}),2e3),xn(t,e))}function xn(t,e){var n=function(t){var e=nn.ERROR,n=t.error_cons_type,r=t.file,i=t.error_type,a=t.msg,s=t.col,c=t.line,u=t.stack,l=o(t,["error_cons_type","file","error_type","msg","col","line","stack"]);return{key:e,value:l,dimension:{error_cons_type:n,file:r,error_type:i,msg:a,col:s,line:c,stack:u}}}(e);t.logCollectNext(n)}function In(t){for(var e=0;e<Un.length;e++)if(n=Un[e],r=t,n.msg===r.msg&&n.stack===r.stack&&n.file===r.file&&n.line===r.line&&n.col===r.col)return e;var n,r;return-1}function An(t){return t.message||null!=t.lineno}function Dn(t,e,n){var r,o,i,a;if((a=e)&&(a instanceof Error||"object"==typeof a&&"string"==typeof a.message))r=e.name||"ErrorLikeObject",o=e.message||"",i=e.stack||void 0;else if(function(t,e){return null==t&&"Script error."===(null==e?void 0:e.message)}(e,n))r="CrossOriginError",o=t+" - message: "+((null==n?void 0:n.message)||"<UNKNOWN>");else{r=null==e?""+e:typeof e,o=t+" - value: "+function(t){var e;try{e=t.toString()}catch(t){}"string"!=typeof e||""===e?e=null===t?"<NULL>":void 0===t?"<UNDEFINED>":""===e?"<EMPTY>":"<UNKNOWN>":e.length>2e3&&(e=e.substring(0,2e3)+"<<< ……");return e}(e)}return{error_type:rn.SCRIPT,error_cons_type:r,msg:o,stack:i}}var Mn,jn,Kn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.key="error",e.onError=function(t){if(An(t)){var n=r(r({},Dn("Global Uncaught Exception",t.error,t)),{file:t.filename,line:t.lineno,col:t.colno});Rn(e.radar,n)}},e.onPromiseError=function(t){var n=Dn("Unhandled Promise Rejection",t.reason);Rn(e.radar,n)},e}return n(e,t),e.prototype.when=function(t){if(t.custom){var e=(t.entry||{}).key;if(["play_block","play_error"].indexOf(e)>-1)return!0}return!1},e.prototype.onPerfReport=function(t){if(t.custom){var e=t.entry||{},n=e.key,r=e.value;xn(this.radar,{error_type:rn.VIDEO,error_cons_type:n,msg:r})}},e.prototype.created=function(){w(window,"error",this.onError,!0),w(window,"unhandledrejection",this.onPromiseError)},e.prototype.destroy=function(){S(window,"error",this.onError,!0),S(window,"unhandledrejection",this.onPromiseError)},e}(cn),Vn=["play_block","play_error"],Wn=["c_dimension1","c_dimension2","c_dimension3"],Fn=["main_data_receive_end"],Bn=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.radarIgnoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],r.radarFmp=0,r.customReported=[],r.customKeyList=[],r.timelineLastTime=null,r.action={start:function(t){en(t),r.event({name:t.name,extra_info:t.extra_info||"",event_type:"radar_action_start"})},end:function(t){en(t),r.event({name:t.name,extra_info:t.extra_info||"",result_type:t.result_type||"",event_type:"radar_action_end"})}},r.validOption()?(r.use(un,r),r.use(hn,r),r.options&&r.options.unuseResourcePlugin||(r.use(gn,r),r.use(mn,r)),r.options&&r.options.unuseAPIPlugin||r.use(bn,r),r.options&&r.options.unuseErrorPlugin||(r.use(Nn,r),r.use(Kn,r)),r):r}return n(e,t),e.samplingControl=function(t){if(!t)return!1;var e=Math.random();return"number"==typeof t?e<t:e<t.sampling},e.prototype.collect=function(t,e){if(0!==t.indexOf("c_")&&Fn.indexOf(t)<0)_("[error 305]","[Radar] 传入的自定义指标 "+t+" 必须为 c_ 开头");else if(Fn.indexOf(t)>-1)this.handleCollectKey(t);else{y("[radar]:Radar+之后将不再支持collect方法，请用event方法替代。");var n={key:ve.CUSTOM,value:{metric_value:e},dimension:{metric_name:t}};this.logCollect(n),this.logCollectNext({key:ve.EVENT,value:{duration:e},dimension:{name:t}})}},e.prototype.handleCollectKey=function(t){switch(t){case"main_data_receive_end":var e=Date.now();try{performance.timing&&(performance.timing[t]=e)}catch(t){}qe(t,e)}},e.prototype.reportTimePoint=function(t,e){if(this.customReported.indexOf(t)>-1)return null;-1===Vn.indexOf(t)&&this.customReported.push(t);var n=e;if("string"!=typeof e){var r=function(t){var e="undefined"!=typeof window?window.performance:null;if(!e)return{value:null};if(null!=t)return{value:t-e.timing.navigationStart,detail:{start:"navigationStart",startPoint:e.timing.navigationStart,end:"customTime",endPoint:t}};if("function"==typeof e.now)return{value:e.now(),detail:{start:"navigationStart",startPoint:e.timing.navigationStart,end:"perfNowAPI",endPoint:e.now()}};var n=Date.now();return{value:n-e.timing.navigationStart,detail:{start:"navigationStart",startPoint:e.timing.navigationStart,end:"dateNow",endPoint:n}}}(e);if(null==r.value)return;n=this.throttle(r.value,r.detail,"fmp",r.detail)}return null!=n?(this.reportPerformance({custom:!0,entry:{key:t,value:n},renderTime:e}),n):void 0},e.prototype.fmp=function(t){this.radarFmp=t||Date.now();var e=this.reportTimePoint("fmp",this.radarFmp);if(e){this.hasFmp=!0;try{performance.timing&&(performance.timing.fmp=e,performance.timing.radarFmp=this.radarFmp)}catch(t){}qe("fmp",e);var n={key:ve.CUSTOM,value:{fmp:e,fmp_time:this.radarFmp,merge:!0}};this.logCollect(n),this.logCollectNext({key:ve.EVENT,value:{duration:e},dimension:{name:"fmp"}})}},e.prototype.event=function(t,e){if(t&&t.name)if("string"==typeof t.name){t.name.length>127&&(_("[radar]:事件名称长度不能超过127字符，超过会截取后上报，请限制"),t.name=t.name.slice(0,127));var n=Je();t.extra_info&&t.extra_info instanceof Object&&(t.extra_info=JSON.stringify(t.extra_info)),void 0===t.yoda_version&&(t.yoda_version=n.Yoda||""),void 0===t.webview_type&&(t.webview_type=Qe());var r={key:ve.EVENT,value:e,dimension:t};this.logCollect(r),this.logCollectNext(r)}else _("[radar]:name字段需要为String类型");else _("[radar]:事件名称为必填字段，用于监控展示、报警配置，请填写")},e.prototype.customStage=function(t,e){if(!(this.customKeyList.length>2)){if(e=e||{sendTimeline:!0},this.customKeyList.indexOf(t)>-1)return null;this.customKeyList.push(t);var n=Date.now();"production"!==this.weblog.logConfig.env&&(this.timelineLastTime?this.timelineLastTime:this.timelineLastTime=n),this.customPerfList[t]={options:e,time:n},this.reportPerformance({custom:!0,entry:{key:"customPerf",value:t},renderTime:n})}},e.prototype.headlessTestReport=function(){-1===window.navigator.userAgent.indexOf("headless")||this.asyncReportTiming()},e.prototype.playClicked=function(t){this.reportTimePoint("play_clicked",t)},e.prototype.playIDR=function(t){this.reportTimePoint("play_idr",t)},e.prototype.playBlock=function(t){this.reportTimePoint("play_block",t)},e.prototype.playError=function(t){this.reportTimePoint("play_error",t)},e.prototype.setDimensions=function(t){var e=this,n=Object.keys(t);n.some((function(t){return-1===Wn.indexOf(t)}))&&_("[error 306]","[Radar] 传入的自定义维度只能为 "+Wn.join("、")+"，目前传入的是："+n.join("、")),n.forEach((function(n){var r=n;null==t[r]?delete e.customDimension[r]:e.customDimension[r]=t[r]}))},e.prototype.validOption=function(){var t=this;if(!this.options)return!1;var e=this.options,n=e.sampling;return"string"!=typeof e.projectId?(_("[error 303]","[Radar] 必须配置 projectId 属性，类型为 string!"),!1):n>1||n<0?(_("[error 304]","[Radar] 采样率 sampling 必须为 0~1 之间的数字"),!1):(["apiSampling","errorSampling","resourceSampling","customSampling","eventSampling"].forEach((function(e){var n=t.options[e];"number"==typeof n&&0===n&&_("[error 304]","[Radar] 采样率 "+e+" 不能被设置为 0，将改用默认值")})),!0)},e.prototype.captureException=function(t){Pn(this,Cn("capture exception",t)),Rn(this,Dn("Captured Exception",t))},e.__test__={MORE_REPORTED:Vn,CUSTOM_DIM_KEY:Wn,CUSTOM_COLLECT_KEY:Fn},e.key="radar",e}(sn),Hn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.action={start:function(){},end:function(){}},e}return n(e,t),e.prototype.fmp=function(){},e.prototype.event=function(){},e.prototype.headlessTestReport=function(){},e.prototype.customStage=function(){},e.prototype.playClicked=function(){},e.prototype.playIDR=function(){},e.prototype.playBlock=function(){},e.prototype.playError=function(){},e.prototype.setDimensions=function(){},e.prototype.destroy=function(){},e.prototype.captureException=function(){},e.key="radar",e}(re),Gn=!1,qn="hashchange",Jn=function(t){function e(e,n){var r=t.call(this)||this;return r.beginTime=(new Date).valueOf(),r.visibilityChange=function(){var t=document.visibilityState;"visible"===t&&(Gn=!1),r.weblog&&!Gn&&r.autoPVFilter(location.href,null,t)&&("hidden"!==t&&"visible"!==t||("visible"===t&&(r.beginTime=(new Date).valueOf()),r.weblog.sendImmediately("PV",{type:t,auto:!0,beginTime:r.beginTime})))},r.proxyPushState=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.urlChange(),Mn.apply(history,t)},r.proxyReplaceState=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.urlChange(),jn.apply(history,t)},r.urlChange=function(){r.weblog&&setTimeout((function(){var t=O({url:location.href},r.weblog.logConfig.urlMap),e=t.page,n=t.params,o=t.pageId;e&&e===r.weblog.currentUrlPackage.page?r.weblog.currentUrlPackage.update(e,n,o):(r.autoPVFilter(location.href,r.weblog.currentUrlPackage.page,"leave")&&r.weblog.sendImmediately("PV",{type:"leave",auto:!0,beginTime:r.beginTime,urlPage:r.weblog.currentUrlPackage.toJSON()}),r.autoPVFilter(location.href,r.weblog.currentUrlPackage.page,"enter")&&(r.weblog.updateReferUrlPackage(r.weblog.currentUrlPackage),r.weblog.updateCurrentUrlPackage(location.href),r.weblog.currentUrlPackage.page.indexOf("http"),r.beginTime=(new Date).valueOf(),r.weblog.sendImmediately("PV",{type:"enter",auto:!0})))}),0)},r.beforeUnload=function(){Gn=!0,r.weblog&&r.autoPVFilter(location.href,null,"leave")&&r.weblog.sendImmediately("PV",{type:"leave",auto:!0,beginTime:r.beginTime})},r.autoPVFilter=function(){return!0},e&&("function"==typeof e?r.autoPVFilter=e:"collect"in e&&"function"==typeof e.collect?((null==n?void 0:n.autoPVFilter)&&(r.autoPVFilter=n.autoPVFilter),r.apply(e)):"autoPVFilter"in e&&"function"==typeof e.autoPVFilter&&(r.autoPVFilter=e.autoPVFilter)),n&&"function"==typeof n.autoPVFilter&&(r.autoPVFilter=n.autoPVFilter),r}return n(e,t),e.prototype.apply=function(t){if(t&&t.sendImmediately){this.weblog=t,this.autoPVFilter(location.href,null,"enter")&&this.weblog.sendImmediately("PV",{type:"enter",auto:!0}),Mn=history.pushState,jn=history.replaceState,history.pushState=this.proxyPushState,history.replaceState=this.proxyReplaceState;var e=t.Utils.ua.supportsPushState;qn=e()?"popstate":"hashchange",w(window,qn,this.urlChange),w(document,"visibilitychange",this.visibilityChange)}},e.prototype.destroy=function(){S(window,qn,this.urlChange),S(document,"visibilitychange",this.visibilityChange),Mn&&(history.pushState=Mn),jn&&(history.replaceState=jn)},e.key="autoPV",e}(re),Qn=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.initBuildInPlugins(),r}return n(e,t),e.prototype.initBuildInPlugins=function(){var t=this.logConfig,e=t.autoPV,n=t.radar,r=t.fps,o=t.timing,i=t.crash,a=t.autoPVFilter;r&&this.plug(le),o&&this.plug(he),i&&this.plug(ae),(e||void 0===e)&&this.plug(Jn,{autoPVFilter:a}),n&&(n.sampling=n.sampling||1,Bn.samplingControl(n)?this.plug(Bn,n):this.plug(Hn))},e}(ne);"undefined"!=typeof window&&(void 0!==window._GLOBAL_KS_WEBLOGGER_?window._GLOBAL_KS_WEBLOGGER_.Factory=Qn:window.Weblog=Qn),t.BasePlugin=re,t.Weblog=Qn,t.default=Qn,Object.defineProperty(t,"__esModule",{value:!0})}));