(()=>{"use strict";var t,e,i,a;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA"}(t||(t={})),function(t){t[t.adClickReward=1]="adClickReward"}(e||(e={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(i||(i={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(a||(a={}));const n="ad_convert_event";var s,r;!function(t){t.START="start",t.CENTRT="center",t.END="end"}(s||(s={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(r||(r={}));var o,l;!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(o||(o={}));class c{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(l||(l={}));class h{}class d{}var u,C;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(u||(u={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(C||(C={}));class m{static saveLocal(t,e){if("undefined"!=typeof TKLocalStorage){(new TKLocalStorage).set(t,e)}}static getLocalString(t){if("undefined"!=typeof TKLocalStorage){let e=(new TKLocalStorage).get(t);if(e)return e.toString()}return null}static getLocalInt(t){if("undefined"!=typeof TKLocalStorage){let e=(new TKLocalStorage).get(t);if(e)return Number.parseInt(e.toString())}return 0}}let I=null;const p="TKResIndexKey";class g{constructor(){var t,e,i;this.defaultHost="p1-lm.adukwai.com",this.currentIndex=0;let a=null===(i=null===(e=null===(t=y)||void 0===t?void 0:t.appConfig)||void 0===e?void 0:e.idc)||void 0===i?void 0:i.tkres;a&&0!=a.length||(a=["p1-lm.adukwai.com","p2-lm.adukwai.com"]),this.resList=a;let n=m.getLocalInt(p);n>a.length&&(n=0),this.currentIndex=n}static getInstance(){return I||(I=new g),I}getCurrentHost(){return this.currentIndex>=this.resList.length?this.defaultHost:this.resList[this.currentIndex]}markUrlFail(t){if(!(t.indexOf(this.getCurrentHost())<0||"undefined"!=typeof KSAdTKNetworkManager&&0==KSAdTKNetworkManager.getCurrentNetworkType())){const t=this.currentIndex;this.currentIndex=++this.currentIndex%this.resList.length,this.currentIndex!==t&&m.saveLocal(p,this.currentIndex)}}}var f=null,y=null,T=null;function _(t){f=t}function A(){return f}function v(t){return t instanceof Error?t.stack?t.stack:t.message:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function w(){return!V(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function L(){return"Android"===Tachikoma.env.platform}function S(t,e){let i={x:0,y:0};if(k.supportMinimumTKVersion("4.0.0")){const a=e.getLocationOnScreen(),n=t.position;if(!a||!n)return i;n.x=parseFloat((n.x+"").replace("dp","")),n.y=parseFloat((n.y+"").replace("dp","")),i={x:a.x+n.x,y:a.y+n.y}}return i}function N(t){return"string"==typeof t&&t.length>0}function E(){return f?f.SDKVersion:Tachikoma.env.SDKVersion}function D(){return f?f.sdkType:Tachikoma.env.sdkType}function V(t){return null===t||null==t||""===t}function R(t){if(t)for(const i in t){if("object"==typeof t[i]&&!i.includes("$"))try{t[i].nativeID||(t[i].nativeID=i),R(t[i])}catch(e){}}}function b(t,e){let i=e-t,a=Math.random();return t+Math.round(a*i)}function x(t,e){!function(t,e,i){if(t&&e){const a=function(t){let e=t;return e.indexOf("/")>=0||t.startsWith("http")||(e="https://"+g.getInstance().getCurrentHost()+"/kos/nlav111362/ksad/"+t),e}(e);t.setImageLoadCallback&&a.startsWith("http")&&t.setImageLoadCallback((t=>{g.getInstance().markUrlFail(a),i&&i(t)})),t.setSrc(a)}}(t,e,null)}class k{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||k.supportMinimumTKVersion("5.0.4")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let i=t.split("."),a=e.split("."),n=Math.max(i.length,a.length);for(var s=0;s<n;s++){let t=Number(void 0!==i[s]?i[s]:"0"),e=Number(void 0!==a[s]?a[s]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let i=D(),a=1==i&&-1!=k.compareVersion(E(),t),n=2==i&&-1!=k.compareVersion(E(),e);return a||n}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let i=D(),a=1==i&&0==k.compareVersion(E(),t),n=2==i&&0==k.compareVersion(E(),e);return a||n}static supportMinimumTKVersion(t="0.0.0"){return-1!=k.compareVersion(f?f.tkVersion:Tachikoma.env.tkVersion,t)}}k.platform=Tachikoma.env.platform;class K{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i="",a=0;a<t;a++)i+=e.charAt(Math.floor(48*Math.random()));return i}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,i){if(!t)return null;const a=this.randomName(i);return Tachikoma[a]=e=>{t(e)},"Tachikoma."+a}}K.globalIndex=0;const O=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class W{static getDeviceInfoAsync(){return W.callNative("getDeviceInfo",null).then((t=>(t.result&&t.data&&_(t.data),t)))}static getKsAdDataAsync(){return W.callNative("getKsAdData",null)}static getKsAdConfigAsync(){return W.callNative("getKsAdConfig",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,y=e),t}))}static getScreenOrientationAsync(){return W.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return W.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return W.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return W.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.callNativeWithCallback("registerLifecycleListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,i,a=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},i,a)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:N(e)?e:""})}static clickAction(t,e,i,a){this.clickActionBase(Object.assign({area:t,logParam:e},i),a)}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,t,!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,i,a=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:i,playDuration:a})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e){this.callNativeWithCallback("openURL",{url:t,title:e})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static updateVideoPlayStatus(t,e,i,a){this.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:i||"",currentTime:a||0})}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((i,a)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),i(t)):i({result:0,data:null})}))))}static callNativeWithCallback(t,e,i,a=!0){const n=w()?1:0;w()&&"pageStatus"==t||w()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,i,a,0):this.callNativeWithCallbackAndType(t,e,i,a,n)}static callTKWithCallback(t,e,i,a=!0){this.callNativeWithCallbackAndType(t,e,i,a,1)}static callNativeWithCallbackAndType(t,e,i,a=!0,n=0){if("undefined"==typeof KwaiAd)return O.log("undefined value KwaiAd"),void(i&&i({result:0,data:null}));O.log("call:"+t);let s=e=>{let a=0,n=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,a=t.result,n=t.data}catch(s){a=0,n=null}O.log("cb:"+t+"  r:"+a),i&&i({result:a,data:n})};const r=K.registerCallbackForAction(s,a,t),o={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?s:r};0==n?KwaiAd.callAdBridge(o):KwaiAd.callTKBridge(o)}}function P(t){let e=null;try{1==t.adBaseInfo.adOperationType&&N(t.adBaseInfo.appIconUrl)?e=t.adBaseInfo.appIconUrl:N(t.advertiserInfo.portraitUrl)&&(e=t.advertiserInfo.portraitUrl)}catch(i){}return e||"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}function F(t){let e=null;try{switch(t.adBaseInfo.adOperationType){case 1:e=t.adBaseInfo.appName;break;case 2:e=t.adBaseInfo.productName}N(e)||(e=t.advertiserInfo.rawUserName)}catch(i){}return e||"可爱的广告君"}function B(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function M(t,e){let i;switch(e){case 1:try{i=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId}catch(a){i=void 0}break;case 12:try{i=t.adMatrixInfo.adDataV2.neoTKInfo.templateId}catch(a){i=void 0}break;case 3:try{i=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId}catch(a){i=void 0}break;case 2:try{i=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId}catch(a){i=void 0}break;case 4:try{i=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId}catch(a){i=void 0}break;case 6:try{i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId}catch(a){i=void 0}break;case 5:try{i=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId}catch(a){i=void 0}break;case 7:try{i=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId}catch(a){i=void 0}break;case 10:try{i=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId}catch(a){i=void 0}break;case 9:try{i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId}catch(a){i=void 0}break;case 11:try{i=t.adMatrixInfo.adDataV2.pushTKInfo.templateId}catch(a){i=void 0}break;case 13:try{i=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId}catch(a){i=void 0}break;case 14:try{i=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId}catch(a){i=void 0}break;case 15:try{i=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId}catch(a){i=void 0}break;case 16:try{i=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId}catch(a){i=void 0}break;default:i=void 0}return i}function U(t,e){let i=M(t,e);if(!N(i))return;const a=t.adMatrixInfo.adDataV2.templateDatas.length;for(let n=0;n<a;n++){let e=t.adMatrixInfo.adDataV2.templateDatas[n];if(e.templateId==i)return e}}function H(t,e){let i=M(t,e);const a=t.adMatrixInfo.adDataV2.templateDatas.length;for(let n=0;n<a;n++){let e=t.adMatrixInfo.styles.templates[n];if((null==e?void 0:e.templateId)==i)return e}return null}function G(t,e){let i=U(t,e);if(null!=i)return JSON.parse(i.data).autoCallAppInfo}function Y(t){let e=t.autoOpenTime;return e<=0&&(e=3e3),e/1e3}function z(t){const e=t.adMaterialInfo.materialFeature.length>0?t.adMaterialInfo.materialFeature[0]:null;if(e){let a=e.videoDuration;0==a&&(a=e.videoDurationMs/1e3);let n=a;try{n=t.adRewardInfo.rewardTime}catch(i){}return n?0==a?n:Math.min(a,n):a}return-1}function j(t,e){let i=!0;if(1==t.adBaseInfo.adOperationType)try{let a=t.downloadSafeInfo.complianceInfo;if(null!=a)switch(e){case 1:i=3!=a.actionBarType;break;case 2:i=3!=a.describeBarType;break;case 3:i=3!=a.materialJumpType;break;default:i=!0}}catch(a){i=!0}else try{let a=t.unDownloadConf.unDownloadRegionConf;if(null!=a)switch(e){case 1:i=1!=a.actionBarType;break;case 2:i=1!=a.describeBarType;break;case 3:i=1!=a.materialJumpType;break;default:i=!0}}catch(a){i=!0}return i}function J(t,e){if(V(e))return;if(!L())return void t.addEventListener("swipe",(t=>{e()}));let i=null,a=t=>{if("down"==t.type)i=t;else if("up"==t.type&&null!=i){let a=t.position.x,n=t.position.y,s=i.position.x,r=i.position.y;(Math.abs(a-s)>=10||Math.abs(n-r)>=10)&&e()}};t.addEventListener("down",a),t.addEventListener("up",a)}let $;function X(){var t;return $||($={all:t=t||new Map,on(e,i){const a=t.get(e);a?a.push(i):t.set(e,[i])},off(e,i){const a=t.get(e);a&&(i?a.splice(a.indexOf(i)>>>0,1):t.set(e,[]))},emit(e,i){let a=t.get(e);a&&a.slice().map((t=>{t(i)})),a=t.get("*"),a&&a.slice().map((t=>{t(e,i)}))},clear(){t.clear()}}),$}class q{static log(t,e,i){(i=i||{}).renderContainer=1;const a={actionType:t,payload:JSON.stringify(i)};e&&(a.clickInfo=e),W.sendLog(a)}static convertIfNeeded(t,e,i,a,n,s,r,o){let l=j(e,i);if(console.log("tkloadcontroller shouldconvert:"+l),!l)return;let h=T;V(h)||(V(s)&&(s=new c),V(s.template_id)&&(s.template_id=h.templateId),V(s.template_version)&&(s.template_version=h.templateVersion)),this.convert(i,a,n,t,s,r,o)}static convert(t,e,i,a,s,r,o){let l,c;l=V(s)?{itemClickType:i,renderContainer:1}:{itemClickType:i,renderContainer:1,clientExtData:JSON.stringify(s)},V(r)||Object.assign(l,r),X().emit(n,{clickType:i}),c=e?{x:e.x,y:e.y}:{},W.clickAction(t,{payload:JSON.stringify(l),clickInfo:c,sceneType:a,itemClickType:i},o,(i=>{1!=i.result&&(this.log(2,e,l),W.convert(1==t))}))}static expose(t){this.log(1,null,t)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,i,a,n){if(k.isAndroid())this.convertWithType(e,i,a,n);else{if(!j(t,e))return;this.convertWithType(e,i,a,n)}}static convertWithType(t,e,i,a){let s={itemClickType:i,renderContainer:1};X().emit(n,{clickType:i}),W.clickAction(t,{payload:JSON.stringify(s),clickInfo:{x:e.x,y:e.y},convertType:a},(i=>{1!=i.result&&(this.log(2,e,s),W.convert(1==t))}))}static convertWithTypeIfNeededNew(t,e,i,a,n,s){if(k.isAndroid())this.convertWithTypeNew(e,i,a,n,s);else{if(!j(t,e))return;this.convertWithTypeNew(e,i,a,n,s)}}static convertWithTypeNew(t,e,i,a,s){let r=s||{};r.itemClickType=i,r.renderContainer=1,X().emit(n,{clickType:i}),W.clickAction(t,{payload:JSON.stringify(r),clickInfo:{x:e.x,y:e.y},convertType:a},(i=>{1!=i.result&&(this.log(2,e,r),W.convert(1==t))}))}static convertNew(t,e,i,a,s,r){let o=r||{};o.itemClickType=s,o.renderContainer=1,X().emit(n,{clickType:s});let l=s;W.clickAction(e,{payload:JSON.stringify(o),clickInfo:{x:i.x,y:i.y,width:a.width,height:a.height},sceneType:t,itemClickType:l},(t=>{1!=t.result&&(this.log(2,i,o),W.convert(1==e))}))}static playNSecond(t){let e={photoPlaySecond:t};this.log(402,null,e)}static skip(){this.log(501,null,null)}}class Q extends TKView{constructor(t){super(),this.vm=t,this.hasAutoConverted=!1,this.isShowing=!1,this.styleDataInfo=G(this.vm.adInfo,1);const e=this.oneLineStyle(),i=this.getCardWidth(),a=this.getCardHeight();this.style={right:-i,height:a,width:i,flexDirection:"row",justifyContent:"space-between",alignItems:"center",position:"absolute",borderRadius:8,borderWidth:1,borderColor:"#FFFFFF66"},this.addEventListener("tap",(t=>{})),this.isTopAutoCallAppCard()?this.style={top:10}:this.style={bottom:15};const n=new TKView;n.style={top:1,left:1,bottom:1,right:1,height:a-2,width:i-2,position:"absolute",borderRadius:8,backgroundColor:"#30303099"},this.appendChild(n),this.appIcon=new TKImage,this.appIcon.style={width:this.getAppIconWH(),height:this.getAppIconWH(),borderRadius:8,borderWidth:1,borderColor:"#EAEAEAFF",marginLeft:e?8:11,marginBottom:e?8:11,marginTop:e?8:11},this.appIcon.setSrc(this.getAppIconUrl()),this.appendChild(this.appIcon);const s=new TKView;s.style={marginLeft:8,marginRight:8,width:126,height:e?18:34,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"center",flexWrap:"no-wrap",flexShrink:1},this.appendChild(s),this.titleLabel=new TKText,this.titleLabel.style={fontSize:14,color:"#FFFFFF",flexWrap:"no-wrap",textLineClamp:1,width:"100%",textOverflow:"ellipsis"},this.titleLabel.setText(String(Y(this.styleDataInfo))+this.getTitle()),s.appendChild(this.titleLabel),e||(this.subTtileLabel=new TKText,this.subTtileLabel.style={fontSize:12,color:"#FFFFFF99",flexWrap:"no-wrap",textLineClamp:1,width:"100%",textOverflow:"ellipsis"},this.subTtileLabel.setText(this.getSubTitle()),s.appendChild(this.subTtileLabel)),this.closeBtn=new TKButton,this.closeBtn.style={marginRight:9,width:53,height:24,fontSize:12,backgroundColor:"#00000000",color:"#FFFFFFB3",borderRadius:12,borderWidth:1,borderColor:"#FFFFFF4D"},this.closeBtn.setText(this.getButtonTitle()),this.closeBtn.addEventListener("tap",(t=>{this.reportCloseBtnTapped(),this.cardDismiss()})),this.appendChild(this.closeBtn)}setConverted(t){this.converted=t,t&&this.cardDismiss()}refreshCardLayout(){this.isShowing&&(this.style={right:15})}updateProgress(t){const e=this.vm.getRewardTime();let i=Math.floor(t),a=e-i<1?1:e-i;a==this.getCardShowTime()&&this.shouldShowCard()&&(this.isShowing||(this.isShowing=!0,this.addTranslateAction(),W.cardImpression(),this.reportCardImpression())),this.isShowing&&(i>=e?this.autoConvertIfNeed():a<=this.getCardShowTime()&&this.titleLabel.setText(a+this.getTitle()+""))}getCardStyle(){let t=0;return t=this.styleDataInfo.cardStyle,t}getCardHeight(){let t=60;return this.oneLineStyle()&&(t=47),t}getCardWidth(){let t=253;return this.oneLineStyle()&&(t=243),t}getAppIconWH(){let t=39;return this.oneLineStyle()&&(t=32),t}getAppIconUrl(){let t=null;return t=this.styleDataInfo.adAppUrl,N(t)||(t="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),t}getTitle(){let t=null;return t=this.styleDataInfo.title,N(t)||(t="s后打开"),t}getAdTitle(){let t=null;return t=this.styleDataInfo.adTitle,N(t)||(t="可爱的广告君"),t}getSubTitle(){let t=null;return t=this.styleDataInfo.subTitle,N(t)||(t="可查看更多精彩"),t}getButtonTitle(){let t=null;return t=this.styleDataInfo.buttonTitle,N(t)||(t="不用了"),t}oneLineStyle(){let t=!1,e=this.getCardStyle();return 1!=e&&3!=e||(t=!0),t}addTranslateAction(){let t=new TKBasicAnimation;t.duration=300,this.animPosition={x:-this.getCardWidth()-15,y:0,z:0},t.animValue={position:this.animPosition},this.addAnimation(t,"translate")}isTopAutoCallAppCard(){let t=this.styleDataInfo.cardStyle;return null==t&&(t=0),1==t||0==t}shouldShowCard(){return!this.converted}getCardShowTime(){let t=this.styleDataInfo.autoOpenTime;return(t<=0||null==t)&&(t=3e3),t/1e3}reportCardImpression(){let t=new c;t.universe_feature_freq=13;let e={elementType:191,businessSceneType:10,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};W.sendLog(i)}reportCloseBtnTapped(){let t={actionType:141,payload:JSON.stringify({elementType:69})};W.sendLog(t)}autoConvertIfNeed(){this.hasAutoConverted||this.converted||!this.isShowing||(q.convertWithTypeIfNeeded(this.vm.adInfo,1,{x:0,y:0},t.AUTO_CLICK_OTHER_AREA,8),this.hasAutoConverted=!0,this.converted=!0,this.cardDismiss())}cardDismiss(){this.isShowing=!1,this.dismissCallback&&(this.dismissCallback(),this.dismissCallback=null)}}class Z extends TKView{constructor(t){super(),this.resourceRoot=t,this.setVisibility("hidden"),this.enabled=!1}startAnimate(){this.setVisibility("visible"),this.animating=!0,this.animateTimer=setInterval((()=>{this.animatedImage&&this.animating&&this.animatedImage.start(!1)}),1e3+50*this.getFrameCount()),this.animatedImage&&this.animating&&this.animatedImage.start(!1),this.showCallback&&this.showCallback()}start(t,e){setTimeout((()=>{this.startAnimate()}),1e3*t),setTimeout((()=>{this.stop(!1)}),1e3*(t+e))}stop(t=!0){this.animating=!1;let e=!1;this.animateTimer>0&&(clearInterval(this.animateTimer),this.animateTimer=0),this.animatedImage&&(this.animatedImage.animating&&!t&&(e=!0,this.animatedImage.stopCallback=()=>{this.hide()}),this.animatedImage.stop(t)),e||this.hide()}hide(){this.setVisibility("hidden"),this.hideCallback&&this.hideCallback()}getFrameCount(){return 23}isSupportSetLocalSrc(){return k.supportMinimumTKVersion("4.0.0")&&k.isAndroid()}}class tt extends TKImage{constructor(t,e,i,a=0,n=20){super(),this.name=t,this.frameCount=e,this.frameRate=n,this.startFrameIndex=a,this.isSupportSetLocalSrc=i}start(t=!0){this.stop(),this.animating=!0,this.currentIndex=0,this.timer=setInterval((()=>{this.currentIndex++,this.currentIndex>=this.frameCount&&(this.currentIndex=this.startFrameIndex,t&&this.animating||this.stop());let e=this.name+(this.currentIndex>=10?this.currentIndex:"0"+this.currentIndex)+".png";this.isSupportSetLocalSrc?this.setLocalSrc(e):this.setSrc(e)}),1e3/this.frameRate)}stop(t=!0){t&&(this.timer&&(clearInterval(this.timer),this.timer=0),this.stopCallback&&this.stopCallback()),this.animating=!1}}class et extends Z{constructor(t){super(t),this.style={width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.animatedImage=new tt(this.resourceRoot+this.getAnimName(),this.getFrameCount(),this.isSupportSetLocalSrc(),1),this.animatedImage.style={width:this.getAnimSize().width,height:this.getAnimSize().height},this.appendChild(this.animatedImage),this.instructLabel=new TKText,this.instructLabel.style={fontSize:20,color:"#FFFFFF",fontWeight:"bold",textAlign:"center",marginTop:30,marginBottom:20,width:"100%"},this.instructLabel.setText(this.getInstruct()),this.appendChild(this.instructLabel)}getAnimSize(){return{width:0,height:0}}getInstruct(){return""}getAnimName(){return""}}class it extends et{getAnimName(){return"reward_swipe_right/reward_swipe_right_000"}getAnimSize(){return{width:200,height:142}}getInstruct(){return"右滑查看更多精彩"}constructor(t){super(t)}}class at{static isClickReward(t,e){try{let i=!0;if(k.isAndroid()&&!V(e)&&(i=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&i)return!0}catch(i){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(i){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){return t.advertiserInfo.userId}static getLiveStreamId(t){return t.adBaseInfo.liveStreamId}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!V(e)&&at.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),V(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=N(e)?e:t.advertiserInfo.rawUserName}catch(i){}return e=N(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(V(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return V(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=U(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let i="";try{i=t.neoLiveAuthorInfoData.authorName}catch(a){}try{V(i)&&(i=t.neoLiveCartDetailData.authorName)}catch(a){}try{V(i)&&(i=e.adBaseInfo.appName)}catch(a){}return i}static liveGetLiveDesc(t,e){let i="";try{i=t.neoLiveCartDetailData.liveDesc}catch(a){}try{V(i)&&(i=t.neoLiveAuthorInfoData.liveDesc)}catch(a){}try{V(i)&&(i=t.adDescription)}catch(a){}try{V(i)&&(i=e.adBaseInfo.adDescription)}catch(a){}return i}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!V(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!V(e))return e}catch(e){}return null}}class nt extends TKView{constructor(e){super(),this.vm=e,this.setupViews(),this.reloadDataInfo(),this.userInfoContainer.addEventListener("tap",(e=>{const i=S(e,this);this.vm.convert(2,i,t.CARD_OTHERAREA_CLICK)})),this.fansContainer.addEventListener("tap",(e=>{const i=S(e,this);this.vm.convert(2,i,t.CARD_FOLLOW_NUM)})),this.fansBtn.addEventListener("tap",(e=>{const i=S(e,this);this.vm.convert(2,i,t.CARD_FOLLOW_NUM)}))}setupViews(){this.style={position:"absolute",top:0,left:0,width:"100%",height:41,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.userInfoContainer=new TKView,this.userInfoContainer.style={marginLeft:16,minWidth:130,maxWidth:190,height:"100%",borderRadius:20.5,backgroundColor:"#00000060",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.appendChild(this.userInfoContainer),this.appIcon=new TKImage,this.appIcon.style={width:33,height:33,borderRadius:16.5,marginLeft:4,backgroundColor:"#00FF00"},this.userInfoContainer.appendChild(this.appIcon);const t=new TKView;t.style={flexGrow:1,marginLeft:4,paddingTop:2,paddingBottom:2,height:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"stretch",flexWrap:"no-wrap",flexShrink:1,marginRight:4},this.userInfoContainer.appendChild(t),this.nameText=new TKText,this.nameText.style={height:16,color:"#FFFFFF",fontSize:12,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.nameText);let e=new TKView;e.style={width:"100%",height:14,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},t.appendChild(e);const i=new TKImage;i.style={width:10,height:10},x(i,"icon_ksad_fans_top_fire.png"),e.appendChild(i),this.fansNumText=new TKText,this.fansNumText.style={fontSize:10,color:"#FFFFFF"},e.appendChild(this.fansNumText),this.fansBtn=new TKButton,this.fansBtn.style={width:38,height:27,marginRight:7,borderRadius:13.5,backgroundColor:"#FFFFFF",color:"#FE3666",fontSize:12},this.userInfoContainer.appendChild(this.fansBtn),this.fansContainer=new TKView,this.fansContainer.style={marginRight:16,height:30,width:120},this.appendChild(this.fansContainer),this.initFansIcon()}initFansIcon(){let t=new TKView;t.style={position:"absolute",right:0,width:42,height:30,borderRadius:15,backgroundColor:"#00000050",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.fansContainer.appendChild(t);let e=new TKImage;e.style={width:20,height:20},x(e,"icon_ksad_fans_live_more.png"),t.appendChild(e);let i=function(t){let e=null,i=["icon_ksad_fans_photo4.png","icon_ksad_fans_photo1.png","icon_ksad_fans_photo3.png","icon_ksad_fans_photo2.png"];try{e=t.advertiserInfo.fansIconList}catch(a){}if(null==e)return i;if(e.length<4)for(let n=0;n<4-e.length;n++)e.push(i[n]);return e}(this.vm.adInfo);for(let a=3;a>0;a--){let t=i[a%i.length],e=new TKImage;e.setSrc(t);let n=20*a;e.style={position:"absolute",width:30,height:30,borderRadius:15,borderWidth:1,borderColor:"#FFFFFF",left:n},this.fansContainer.appendChild(e)}}reloadDataInfo(){let t=this.vm.adInfo,e=t.adBaseInfo.appIconUrl;N(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),this.appIcon.setSrc(e);let i=t.adBaseInfo.appName;N(i)||(i=at.getAdTitle(t)),this.nameText.setText(i),this.fansBtn.setText("关注"),this.fansNumText.setText(function(t){let e=null;try{if(e=t.advertiserInfo.fansCount,e>0&&e<1e4)return e+"";if(e>=1e4)return e=(e/1e4).toFixed(1)+"万",e}catch(i){}return""}(t))}}class st extends Object{constructor(t,e,i,a){var n;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=i,this.value=this.get(),this.cb(null!==(n=this.value)&&void 0!==n?n:a,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){st.target=this;const t=this.getter.call(this.vm,this.vm);return st.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let i=0,a=e.length;i<a;i++){if(!t)return;t=t[e[i]]}return t}}}function rt(t){return!!t}let ot;function lt(){if(null!=ot)return ot;let t=!1;try{t=!1,ot=t}catch(e){}return t}function ct(t,e){if(!0===lt()&&(null==t||!1===t))throw new Error("tkmvvm ----- 请检查传值: "+e)}function ht(t){lt()&&console.log("tachikoma TKMVVM log -> "+t)}class dt extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var i=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(a){e?e===a&&i.observeValueWithKey(t,a):i.observeValueWithKey(t,a)}))}observeValueWithKey(t,e){let i=t[e];var a=new Ct(e);mt(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return st.target&&a.depend(),i},set:function(t){t!==i&&(i=t,a.notify(),mt(t))}})}defineArray(t){if(t)for(let e=0,i=t.length;e<i;e++)mt(t[e])}}var ut=0;class Ct extends Object{constructor(t){super(),this.key=t,this.pid=ut++,this.deps=new Array}depend(){st.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function mt(t,e){if(!t||"object"!=typeof t)return;var i;if(!("object"==typeof(i=t)&&Object.keys(i).length>0))return;let a=!1,n=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(n)&&(a=t[n]),!a)return ht("observe "+n),t[n]=!0,new dt(t,e);ht("already observe "+n)}class It extends Object{constructor(){super()}tk_observe(t){rt(t)&&(t in this?mt(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}function pt(t,e,i){if(!rt(t)||!rt(e)||!rt(i))return;const a=gt(e),n=null==a?void 0:a.split(".");if(!n)return void ct(n,"tk_bind error, check bind path");const s=n[0];t.tk_observe(s),new st(t,a,((t,e)=>{i&&i(t)}))}function gt(t){let e=function(t){if(t)return t.bind_path?t.$bind_path:"string"==typeof t?t:void 0}(t);if(e)return e;ct(e,"tk_bind error, check bind path")}class ft extends TKView{constructor(t){super(),this.vm=t,this.cardWidth=this.vm.getCardWidth(),this.cardHeight=this.vm.getCardHeight(),this.setupView(),this.setupData(),this.setupAction(),setTimeout((()=>{this.vm.isHasGuideHandle()&&this.vm.isSecondIcon()?this.startShowNormalAnimation():this.vm.isSecondIcon()?this.startShowSecondIconAnimation():this.vm.isHasGuideHandle()&&this.startGuideHandleAnimationOnly(),this.vm.reportCouponImpression()}),500)}createFontSizeSpanItem(t,e){const i=new TKSpanItem;return i.spanType="absoluteSize",i.color="#F72B2B",i.size=13,i.start=t,i.end=e,i}setupView(){this.style={height:this.cardHeight,width:this.cardWidth,flexDirection:"row",justifyContent:"space-between",overflow:"visible",alignItems:"flex-end",position:"absolute"};let t=0!=this.vm.cardBottomMargin?this.vm.cardBottomMargin:15;Tachikoma.env.deviceHeight,this.cardHeight;this.vm.isShowRightTop()?this.style={right:0,top:0!=this.vm.cardTopMargin?this.vm.cardTopMargin:60}:this.style={left:0,bottom:t},this.firstContentView=new TKView,this.firstContentView.style={top:0,left:0,position:"absolute",width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight(),justifyContent:"center",alignItems:"center",opacity:0},this.appendChild(this.firstContentView),this.firstIcon=new TKImage,this.firstIcon.style={position:"absolute",width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight()},this.firstContentView.appendChild(this.firstIcon),this.guidanceImage=new TKImage,this.guidanceImage.style={top:this.vm.getGuidanceImageMarginTop(),left:this.vm.getGuidanceImageMarginLeft(),position:"absolute",height:this.vm.getGuidanceImageWH(),width:this.vm.getGuidanceImageWH(),opacity:0},this.appendChild(this.guidanceImage),this.SecondContentView=new TKView,this.SecondContentView.style={top:0,left:0,width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight(),justifyContent:"center",alignItems:"center",position:"absolute",opacity:0},this.secondIcon=new TKImage,this.secondIcon.style={width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight()},this.SecondContentView.appendChild(this.secondIcon),this.secondPriceView=new TKView,this.secondPriceView.style={top:20,width:this.vm.getIconImageWidth(),height:34,flexDirection:"row",justifyContent:"center",alignItems:"center",alignContent:"center",position:"absolute"},this.SecondContentView.appendChild(this.secondPriceView),this.secondPrice=new TKText,this.secondPrice.style={fontSize:24,color:"#F72B2B",textAlign:"center",justifyContent:"center",fontWeight:"medium"},this.secondPriceView.appendChild(this.secondPrice),this.SecondContentView.appendChild(this.secondPriceView),this.secondBottomGuideMsg=new TKText,this.secondBottomGuideMsg.style={fontSize:12,color:"#D92020",fontWeight:"medium",textAlign:"center",top:69,position:"absolute"},this.SecondContentView.appendChild(this.secondBottomGuideMsg),this.appendChild(this.SecondContentView)}setupData(){let t;this.secondBottomGuideMsg.setText(this.vm.getCouponGuideMsgText()),t=this.vm.getCouponPriceTagText()+this.vm.getCouponPriceText();const e=this.createFontSizeSpanItem(0,this.vm.getCouponPriceTagText().length),i=new TKSpan;i.addSpan(e),this.secondPrice.setSpan(t,i),this.firstIcon.setSrc(this.vm.getCouponFirstIconUrlText()),this.secondIcon.setSrc(this.vm.getCouponSecondIconUrlText()),x(this.guidanceImage,"icon_ksad_hand_touch_guide.png")}setupAction(){const t=this;this.addEventListener("tap",(e=>{t.vm.reportCouponClick()}))}startHideAnimation(){this.startCouponImageHideAnimation();const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.addAnimation(e,"startHideAnimation")}startCouponImageHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.firstContentView.style={transform:{scale:.8}},t.SecondContentView.style={transform:{scale:.8}},1)]),e.timingFunction="ease-out",e.duration=300,this.addAnimation(e,"startCouponImageHideAnimation")}getShowNormalAnimation(){const t=this;let e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2},opacity:1},.01),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1}},.05),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2}},.1),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1}},.15),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2}},.2),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1},opacity:0},.25),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1},opacity:0},.45),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.55),()=>(t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.65),()=>(t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.8),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.9),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1},opacity:0},1)]),e.duration=3e3,e.repeatCount=Number.MAX_VALUE,e.timingFunction="linear",e}startShowNormalAnimation(){let t=this.getShowNormalAnimation(),e=this.getShowNormalAnimation(),i=this.getShowNormalAnimation();this.guidanceImage.addAnimation(t,"startShowNormalAnimation"),this.firstContentView.addAnimation(e,"startShowNormalAnimation"),this.SecondContentView.addAnimation(i,"startShowNormalAnimation")}getGuideHandleAnimationOnly(){const t=this;let e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2},opacity:1},.01),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1}},.5),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2}},1)]),e.duration=450,e.repeatCount=Number.MAX_VALUE,e.timingFunction="linear",e}startGuideHandleAnimationOnly(){let t=this.getGuideHandleAnimationOnly(),e=this.getGuideHandleAnimationOnly(),i=this.getGuideHandleAnimationOnly();this.guidanceImage.addAnimation(t,"startGuideHandleAnimationOnly"),this.firstContentView.addAnimation(e,"startGuideHandleAnimationOnly"),this.SecondContentView.addAnimation(i,"startGuideHandleAnimationOnly")}getShowSecondIconAnimation(){const t=this;t.guidanceImage.style={opacity:0};let e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},.01),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},.25),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.35),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.45),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.7),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.8),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},.9),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},1)]),e.duration=2400,e.repeatCount=Number.MAX_VALUE,e.timingFunction="linear",e}startShowSecondIconAnimation(){let t=this.getShowSecondIconAnimation(),e=this.getShowSecondIconAnimation(),i=this.getShowSecondIconAnimation();this.guidanceImage.addAnimation(t,"startShowSecondIconAnimation"),this.firstContentView.addAnimation(e,"startShowSecondIconAnimation"),this.SecondContentView.addAnimation(i,"startShowSecondIconAnimation")}}class yt{static createVideoCommonInstance(t,e){return 3==t?yt.createFullscreenCommonInstance(e):2==t?yt.createNeoCommonInstance(e):null}static createImageCommonInstance(t,e){var i;let a=new c;return a.template_id=M(e,16),a.template_version=null===(i=H(e,16))||void 0===i?void 0:i.templateVersion,a}static createLiveCommonInstance(t,e){var i;let a=new c;return a.template_id=M(e,14),a.template_version=null===(i=H(e,14))||void 0===i?void 0:i.templateVersion,a}static createNeoCommonInstance(t){var e;let i=new c,a=at.getNeoActionBarCardType(t);return i.actionbar_card_type=a,i.template_id=M(t,12),i.template_version=null===(e=H(t,12))||void 0===e?void 0:e.templateVersion,a!=u.LIVE_CUT3_STYLE1&&a!=u.LIVE_CUT3_STYLE2||(i.live_room_pattern=l.SIMPLIFIED_LIVE_ROOM_PATTERN),i}static createFullscreenCommonInstance(t){let e=new c,i=at.getFullscreenActionBarCardType(t);return e.actionbar_card_type=i,i!=u.LIVE_CUT3_STYLE1&&i!=u.LIVE_CUT3_STYLE2||(e.live_room_pattern=l.SIMPLIFIED_LIVE_ROOM_PATTERN),e}}class Tt extends It{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>_t(t,e)})}getData(t){}}function _t(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(i,a)=>"string"!=typeof a||"function"==typeof i[a]||0==a.indexOf("$")?Reflect.get(i,a):_t(t,e+"."+a)})}class At extends TKView{constructor(t,e){super(),this.itemWidth=2,this.animStopped=!1,e&&e>0&&(this.itemWidth=e),this.itemHeight=t[0],this.mWaveItemHeight=t,this.setupViews()}setupViews(){this.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:13,height:24},this.waveItem1=this.createWaveItemView(),this.waveItem2=this.createWaveItemView(),this.waveItem3=this.createWaveItemView(),this.appendChild(this.waveItem1),this.appendChild(this.waveItem2),this.appendChild(this.waveItem3)}createWaveItemView(){let t=new TKView;return t.style={width:this.itemWidth,height:this.itemHeight,borderRadius:1,backgroundColor:"#FFFFFF"},t}startWaveAnimation(){this.waveItem1.addAnimation(this.createWaveItemAnim(this.waveItem1,[this.mWaveItemHeight[2],this.mWaveItemHeight[1],this.mWaveItemHeight[2]]),"wave"),this.waveItem2.addAnimation(this.createWaveItemAnim(this.waveItem2,[this.mWaveItemHeight[0],this.mWaveItemHeight[2],this.mWaveItemHeight[0]]),"wave"),this.waveItem3.addAnimation(this.createWaveItemAnim(this.waveItem3,[this.mWaveItemHeight[1],this.mWaveItemHeight[0],this.mWaveItemHeight[1]]),"wave")}createWaveItemAnim(t,e){if(V(e)||e.length<3)return null;let i=new TKKeyframeAnimation;return i.setAnimations([()=>(t.style={height:e[0]},0),()=>(t.style={height:e[1]},.5),()=>(t.style={height:e[2]},1)]),i.duration=600,i.repeatCount=-1,i.timingFunction="EaseOut",i.on("start",(()=>{this.animStopped&&t.removeAnimation("wave")})),i}}class vt extends TKView{constructor(t){super(),this.mHeight=36,this.mIconSize=32,this.mFollowBtnHeight=24,this.vm=t,this.setupView(),this.bindView(),setTimeout((()=>{this.mLivingWaveView.startWaveAnimation()}),500)}setupView(){this.style={height:this.mHeight,width:160,borderRadius:this.mHeight/2,backgroundColor:"#00000033",paddingHorizontal:6,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},this.mIconView=new TKImage,this.mIconView.style={width:this.mIconSize,height:this.mIconSize,borderRadius:this.mIconSize/2,marginRight:8},this.appendChild(this.mIconView),this.appendChild(this.createNameContainer()),this.mFollowBtn=new TKText,this.mFollowBtn.style={height:this.mFollowBtnHeight,borderRadius:this.mFollowBtnHeight/2,paddingHorizontal:6,fontSize:12,includeFontPadding:!1,color:"#FFFFFF",marginLeft:8,backgroundColor:"#FE3666",textAlign:"center",textLineClamp:1},this.mFollowBtn.setText("关注"),this.appendChild(this.mFollowBtn)}createNameContainer(){let t=new TKView;t.style={flexDirection:"column",flexBasis:100,flexShrink:1,flexGrow:1},this.mNameView=new TKText,this.mNameView.style={fontSize:12,textAlign:"center",color:"#FFFFFF",marginBottom:2,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.mNameView);let e=new TKView;return e.style={flexDirection:"row"},this.mLivingWaveView=new At([2,4,5],1),this.mLivingWaveView.style={backgroundColor:"#FE3666",height:10,width:10,borderRadius:5,paddingHorizontal:1.5,flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginRight:2},this.mFansView=new TKText,this.mFansView.style={fontSize:9,color:"#FFFFFF",includeFontPadding:!1,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},e.appendChild(this.mLivingWaveView),e.appendChild(this.mFansView),t.appendChild(e),t}bindView(){V(this.vm)||(this.mIconView&&this.mIconView.setSrc(this.vm.iconUrl),this.mNameView&&this.mNameView.setText(this.vm.name),this.mFansView&&this.mFansView.setText(this.vm.fans))}}class wt extends Tt{}class Lt extends TKView{constructor(t,e){super(),this.mIconSize=30,this.mIconMargin=-4,this.mFansCount=e,this.mIconUrlList=t,V(this.mIconUrlList)||this.setupViews()}setupViews(){this.style={height:this.mIconSize,flexDirection:"row-reverse",alignItems:"center"},this.mFansCountView=new TKText,this.mFansCountView.style={height:this.mIconSize,borderRadius:this.mIconSize/2,backgroundColor:"#00000054",fontSize:9,paddingHorizontal:9,includeFontPadding:!1,textLineClamp:1,textAlign:"center",color:"#FFFFFF",marginLeft:this.mIconMargin},this.mFansCountView.setText(this.mFansCount),this.appendChild(this.mFansCountView);for(let t=this.mIconUrlList.length-1;t>=0;t--){let e=this.mIconUrlList[t],i=this.createIconImage(0!=t,e);this.appendChild(i)}}createIconImage(t,e){let i=new TKImage;return i.style={width:this.mIconSize,height:this.mIconSize,borderRadius:this.mIconSize/2,marginLeft:t?this.mIconMargin:0},i.setSrc(e),i}}class St{bindBaseData(t){this.iconUrl=P(t),this.name=F(t),this.actionText=function(t){if(V(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return V(e)&&(e=function(t){try{return 1==t.adBaseInfo.adOperationType}catch(e){}return!1}(t)?"立即下载":"查看详情"),e}(t),this.desc=t.adBaseInfo.adDescription}static newInstance(t,e){let i=new St;return i.bindBaseData(t),i.extraActionText=e.rewardContentExtraRewardNotClickedDesc,V(i.extraActionText)&&(i.extraActionText="立即点击，可再得1份奖励"),i.extraActionTextClicked=e.rewardContentExtraRewardClickedDesc,V(i.extraActionTextClicked)&&(i.extraActionTextClicked="立即打开"),i}}class Nt extends St{static newLiveCutInstance(t,e){var i;let a=new Nt;a.bindBaseData(t);let n=null==e?void 0:e.neoLiveRoomInfoData;if(V(n))return null;try{if(a.iconUrl=n.authorIconUrl,a.sellerTag=n.sellerTag,V(a.sellerTag)&&(a.sellerTag="优质主播"),a.actionBarDesc=n.actionBarDesc,a.tradeCustomerDesc=n.tradeCustomerDesc,a.watchCount=n.watchCount,n.watchUserIcons){n.watchUserIcons.length<=3?a.watchUserIcons=n.watchUserIcons:(!function(t){let e=t.length;for(let i=0;i<e;i++){let a=b(i,e-1),n=t[i];t[i]=t[a],t[a]=n}}(n.watchUserIcons),a.watchUserIcons=n.watchUserIcons.slice(0,3))}a.tradeTips=new Array;let t=null===(i=n.tradeTips)||void 0===i?void 0:i.length;for(let e=0;e<t;e++){let t=n.tradeTips[e],i=new d;i.buyerImage=t.iconUrl,i.tradeMessage=t.tipsText,a.tradeTips.push(i)}a.liveStatDataDesc=n.liveStatDataDesc,a.actionBarSubTitle=n.actionBarTips,a.desc=n.authorDesc,V(a.desc)&&(a.desc="惊喜多多，快来快来！")}catch(s){return null}return a}}class Et extends TKView{constructor(t,e){super(),this.vm=t,this.mLiveCutCardModel=e,this.setupViews()}static newInstance(t){if(V(t))return null;let e=t.getLiveCutRoomInfo();if(V(e))return null;let i=Nt.newLiveCutInstance(t.adInfo,e);return V(i)?null:new Et(t,i)}setupViews(){this.style={height:36,width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingLeft:16,paddingRight:13},this.addAdClickEvent(this,t.CARD_BLANK_AREA_CLICK,2),this.mAuthorInfoView=new vt(this.createAuthorInfoVM()),this.addAdClickEvent(this.mAuthorInfoView,t.CARD_ICON_CLICK,2),this.appendChild(this.mAuthorInfoView),this.mFansIconListView=new Lt(this.mLiveCutCardModel.watchUserIcons,this.mLiveCutCardModel.watchCount),this.addAdClickEvent(this.mFansIconListView,t.ONLINE_AUDIENCE_NUM,2),this.appendChild(this.mFansIconListView)}createAuthorInfoVM(){let t=new wt;return t.fans=this.mLiveCutCardModel.liveStatDataDesc,t.isLiving=!0,t.name=this.mLiveCutCardModel.name,t.iconUrl=this.mLiveCutCardModel.iconUrl,t}addAdClickEvent(e,i,a){if(V(e))return;let n=yt.createVideoCommonInstance(this.vm.adStyle,this.vm.adInfo);var s,r;e.addEventListener("tap",(()=>{this.vm.convert(a,{x:0,y:0},i,n)})),s=this.vm.adInfo,(null===(r=null==s?void 0:s.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===r?void 0:r.slideClick)&&J(e,(()=>{this.vm.convert(a,{x:0,y:0},t.CARD_SWIPE_CONVERT,n)}))}}class Dt extends TKView{constructor(e){super(),this.vm=e,this.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:0},this.addEventListener("tap",(e=>{this.hasInteract?this.convert(2,{x:0,y:0},t.CARD_PAGE_CLICK):this.convert(3,{x:0,y:0},t.CARD_PAGE_CLICK)})),J(this,(()=>{this.slideClick()})),this.vm.isFansLive()&&(this.followTopBar=new nt(this.vm),this.appendChild(this.followTopBar));let i=this.vm.getMiddleCardType();if(i&&i==C.LIVE_CUT3_STYLE2&&0==this.vm.screenOrientation&&this.setupLiveCutAuthorView(),this.setupCouponView(),this.shouldShowAutoCallAppCard((t=>{t&&this.showAutoCallAppCard()})),2==this.vm.adStyle&&0==this.vm.screenOrientation){let t=this.vm.getLightInteractionShowTime(),e=this.vm.getLightInteractionDuration();if(0!=this.vm.getLightInteractionType()&&0==this.vm.getAdAttributeType()&&0==this.vm.getActionBarStyle()&&!this.vm.isClickReward()){const i="image/ksad-video-middle-card/";this.interactView=new it(i),this.appendChild(this.interactView),this.interactView.hideCallback=()=>{this.hasInteract=!1,this.resizeCallback&&this.resizeCallback(this.getDefaultHeight())},this.interactView.showCallback=()=>{this.hasInteract=!0},this.interactView.start(t,e),this.style={height:"100%"}}}}setupCouponView(){this.vm.couponWidgetVM.isValidCardInfo()&&this.vm.couponWidgetVM.isValidSDKVersion()&&(this.couponWidgetView=new ft(this.vm.couponWidgetVM),this.appendChild(this.couponWidgetView),this.layout())}cardDidAppear(){}setupLiveCutAuthorView(){let t=Et.newInstance(this.vm);t&&(t.style={position:"absolute",top:16,left:0,right:0},this.appendChild(t))}cardDidDisAppear(){this.autoCallCardAdded&&this.autoCallAppView.refreshCardLayout()}slideClick(){this.hasInteract?this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT):this.vm.isSlideClick()&&this.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT)}convert(t,e,i){this.vm.convert(t,e,i),this.interactView&&this.interactView.stop(!0)}getDefaultHeight(){return 0}getHeight(){return this.hasInteract?this.vm.containerLimit.height:this.getDefaultHeight()}showAutoCallAppCard(){this.autoCallAppView=new Q(this.vm),this.appendChild(this.autoCallAppView),this.autoCallCardAdded=!0,this.layout(),this.autoCallAppView.dismissCallback=()=>{this.removeChild(this.autoCallAppView),this.autoCallAppView=null,this.autoCallCardAdded=!1},pt(this.vm,this.vm.$attrsPath.autocallHasConverted,(t=>{this.autoCallAppView&&t&&this.autoCallAppView.setConverted(t)})),this.bindAutoCallView()}bindAutoCallView(){pt(this.vm,this.vm.$attrsPath.playFailed,(t=>{this.autoCallAppView&&t&&this.autoCallAppView.cardDismiss()})),pt(this.vm,this.vm.$attrsPath.playFinished,(t=>{this.autoCallAppView&&t&&this.autoCallAppView.autoConvertIfNeed()})),pt(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{this.autoCallAppView&&null!=this.autoCallAppView&&this.autoCallAppView.updateProgress(t)}))}shouldShowAutoCallAppCard(t=void 0){if(!this.isValidSDKVersion())return!1;if(2!=this.vm.adStyle)return!1;if(this.vm.isDownloadComplaince())return!1;if(this.vm.isValidCardInfo())if(this.vm.isValidPlayable())t&&t(!1);else if(this.vm.isBrowseTask())t&&t(!1);else{if(!this.vm.isClickReward())return!!this.vm.isValideTime()&&void(t&&t(!0));t&&t(!1)}else t&&t(!1)}isValidSDKVersion(){return!!k.supportMinimumTKVersion("3.0.2")}}class Vt extends Tt{constructor(){super(...arguments),this.canShake=!0,this.lifeStatus="none",this.currentPlaybackTime=0,this.playFailed=!1,this.playFinished=!1,this.autocallHasConverted=!1,this.downloadState=0}checkDataValid(){return!!this.adInfo}getRewardTime(){return z(this.adInfo)}getLightInteractionType(){try{const t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionType;if(!V(t))return t}catch(t){}return 0}getLightInteractionShowTime(){let t=2;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionShowTime}catch(e){}return t||2}getLightInteractionDuration(){let t=6;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionDuration}catch(e){}return t||6}getAdAttributeType(){try{return this.adInfo.adBaseInfo.adAttributeType}catch(t){}return 0}getActionBarStyle(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType}catch(t){}return 0}getMiddleCardType(){var t,e,i,a,n,s;try{if(2==this.adStyle){let a=null===(i=null===(e=null===(t=this.adInfo.adMatrixInfo)||void 0===t?void 0:t.adDataV2)||void 0===e?void 0:e.neoTKInfo)||void 0===i?void 0:i.middleCardType;if(!V(a))return a}else if(3==this.adStyle){let t=null===(s=null===(n=null===(a=this.adInfo.adMatrixInfo)||void 0===a?void 0:a.adDataV2)||void 0===n?void 0:n.fullScreenInfo)||void 0===s?void 0:s.middleCardType;if(!V(t))return t}}catch(r){}return null}isClickReward(){return function(t){try{let e=!0;const i=A();if(k.isAndroid()&&A()&&(e=i.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&e)return!0}catch(e){}return!1}(this.adInfo)}isDownloadComplaince(){let t=1==this.screenOrientation;return!(!function(t){var e;try{return k.isAndroid()&&1==t.adBaseInfo.adOperationType&&(null===(e=t.downloadSafeInfo.complianceInfo)||void 0===e?void 0:e.titleBarTextSwitch)>0}catch(i){}return!1}(this.adInfo)||!t)}isValidCardInfo(){return null!=G(this.adInfo,1)}isValidPlayable(){if(!N(this.adInfo.adConversionInfo.playableUrl))return!1;let t=this.adInfo.adConversionInfo.playableStyleInfo.playableOrientation;return!(0==this.screenOrientation&&2==t||1==this.screenOrientation&&1==t)}isBrowseTask(){return 1!=this.adInfo.adBaseInfo.taskType&&0!=this.adInfo.adBaseInfo.taskType}getLiveCutRoomInfo(){return function(t,e){let i=U(e,3==t?3:12);try{let t=JSON.parse(i.data);return V(t)||V(t.neoLiveRoomInfoData)?null:t}catch(a){}return null}(this.adStyle,this.adInfo)}isValideTime(){return!(z(this.adInfo)<=Y(G(this.adInfo,1)))}isValidSDKVersion(){return!!k.supportMinimumTKVersion("3.0.2")}shouldShowAutoCallAppCard(t=void 0){if(!this.isValidSDKVersion())return!1;if(2!=this.adStyle)return!1;if(this.isDownloadComplaince())return!1;if(this.isValidCardInfo())if(this.isValidPlayable())t&&t(!1);else{if(!this.isBrowseTask())return!!this.isValideTime()&&void(t&&t(!0));t&&t(!1)}else t&&t(!1)}isSlideClick(){var t;return!!(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}convert(t,e,i,a){}isFansLive(){try{let t=this.configInfo.abConfig.shortVideoFollowRewardPlayStyle;if(k.supportMinimumVersion("3.3.26","3.3.30")&&4==t&&3==B(this.adInfo))return!0}catch(t){}return!1}isShakeEnabled(){return!1}getShakeSubtitle(){return""}startShake(){}stopShake(){}}class Rt extends Tt{constructor(t,e,i,a,n,s){super(),this.lifeStatus="none",this.cardTopMargin=0,this.cardBottomMargin=0,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.styleType=a,this.containerLimit=n,this.screenOrientation=s,this.setupData()}setupData(){this.couponWidgetInfo=function(t,e){let i=U(t,e);if(null!=i)return JSON.parse(i.data).couponWidgetInfo}(this.adInfo,this.styleType)}isValidSDKVersion(){return!(!k.isAndroid()||!k.supportMinimumTKVersion("4.0.8"))}isValidCardInfo(){return null!=this.couponWidgetInfo}isHasGuideHandle(){return 1==this.couponWidgetInfo.gestureType}isSecondIcon(){return 1==this.couponWidgetInfo.showSecondIconType}isShowRightTop(){return 1==this.couponWidgetInfo.type||1==this.screenOrientation}getCouponWidgetInfoBusinessType(){return this.couponWidgetInfo.businessType}getCardWidth(){return 100}getCardHeight(){return 140}getIconImageWidth(){return 100}getIconImageHeight(){return 100}getGuidanceImageWH(){return 54}getGuidanceImageMarginTop(){return this.getCardHeight()-this.getGuidanceImageWH()-15}getGuidanceImageMarginLeft(){return this.getCardWidth()-this.getGuidanceImageWH()}getCouponGuideMsgText(){try{return this.couponWidgetInfo.guideMsg}catch(t){}return""}getCouponPriceText(){try{return this.couponWidgetInfo.price}catch(t){}return""}getCouponPriceTagText(){try{return this.couponWidgetInfo.priceTag}catch(t){}return""}getCouponFirstIconUrlText(){try{return this.couponWidgetInfo.firstIcon}catch(t){}return""}getCouponSecondIconUrlText(){try{return this.couponWidgetInfo.secondIcon}catch(t){}return""}reportCouponClick(){let e=new c,i=new h;i.couponType=this.getCouponWidgetInfoBusinessType(),e.neo_ext_data=i,q.convertIfNeeded(1,this.adInfo,1,{x:0,y:0},t.PLAY_END_GIFT_CLICK,e)}reportCouponImpression(){let t=new c,e=new h;e.couponType=this.getCouponWidgetInfoBusinessType(),t.neo_ext_data=e;let i={elementType:13,clientExtData:JSON.stringify(t)},a={actionType:140,payload:JSON.stringify(i)};W.sendLog(a)}}class bt extends Vt{getData(t){let e=[];e.push(W.getKsAdDataAsync()),e.push(W.getDeviceInfoAsync()),e.push(W.getKsAdConfigAsync()),e.push(W.getContainerLimitAsync()),e.push(W.getScreenOrientationAsync()),Promise.all(e).then((e=>{const i=e[0].data,a=e[1].data,n=e[2].data,s=e[3].data,r=e[4].data;try{this.adInfo=i.impAdInfo[0].adInfo[0],this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=r.screenOrientation}catch(o){}this.configInfo=n,this.containerLimit=s,this.screenOrientation=r.screenOrientation,this.couponWidgetVM=new Rt(this.adInfo,this.adStyle,this.configInfo,1,this.containerLimit,this.screenOrientation),_(a),this.additionalInit(),t&&t(!0)}))}additionalInit(){this.registerLifeStatusListener(),this.registerVideoProgressListener(),this.registerConvertStatusListener()}registerLifeStatusListener(){W.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&(this.lifeStatus=e)}}))}registerVideoProgressListener(){W.registerVideoProgressListener((t=>{t.data.failed?this.playFailed=!0:t.data.finished?this.playFinished=!0:this.currentPlaybackTime=t.data.currentTime}))}registerConvertStatusListener(){W.registerConvertStatusListener((t=>{try{this.autocallHasConverted=t.data.hasConverted}catch(e){console.log("error return value")}}))}convert(t,e,i){let a=new c;a.material_click_area="middlecard_mid",q.convertIfNeeded(3,this.adInfo,t,e,i,a)}}class xt{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,W.pageStatus(t,e),this.registerNativeId())}registerNativeId(){1==Tachikoma.env.isDebug&&k.supportMinimumTKVersion("4.0.7")&&!k.isAndroid()&&(this.startConfig(),W.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{R(this)}),120)}}class kt extends xt{constructor(){super(),this.vm=new bt}setupViews(){this.middleCard=new Dt(this.vm),this.rootView.appendChild(this.middleCard),pt(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{this.middleCard&&("hideEnd"===t||"pageInvisiable"===t?this.middleCard.cardDidDisAppear():"showEnd"!==t&&"pageInvisiable"!==t||this.middleCard.cardDidAppear())}))}render(){if(super.render()){try{this.vm.getData((t=>{if(t)try{this.setupViews(),Tachikoma.render(this.rootView),this.updateRenderStatus(1,"")}catch(e){this.updateRenderStatus(0,v(e))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,v(t))}return!0}}}if(k.isAndroid()||-1!=k.compareVersion(Tachikoma.env.osVersion,"11")||-1!=k.compareVersion(Tachikoma.env.engineVersion,"0.5.36")){(new kt).render()}else W.pageStatus(0,"ios10")})();
//# sourceMappingURL=ksad-video-middle-card.129.js.map