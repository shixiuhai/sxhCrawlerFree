(()=>{"use strict";var t,e,i,n;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PORTRAIT_CLICK=13]="PORTRAIT_CLICK",t[t.COMMENT_CLICK=14]="COMMENT_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.COMMENT_DETAIL_CLICK=25]="COMMENT_DETAIL_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.COMMON_CARD_CLICK=89]="COMMON_CARD_CLICK",t[t.COMMENT_PICTURE_CLICK=100]="COMMENT_PICTURE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA",t[t.POPLAY_FALL_IOCN=186]="POPLAY_FALL_IOCN",t[t.ROTATE_SHAKE_BIG_ICON_CLICK=187]="ROTATE_SHAKE_BIG_ICON_CLICK",t[t.RETAIN_AGG_CARD_CLICK=189]="RETAIN_AGG_CARD_CLICK",t[t.PLAYEND_AGG_CARD_CLICK=190]="PLAYEND_AGG_CARD_CLICK",t[t.SURPRISE_BOX_CLICK=191]="SURPRISE_BOX_CLICK",t[t.BUBBLE_RAIN_CLICK=192]="BUBBLE_RAIN_CLICK"}(t||(t={})),function(t){t[t.adClickReward=1]="adClickReward"}(e||(e={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(i||(i={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(n||(n={}));const s="player_mute_change",a="player_play_failed",o="player_play_finished",r="player_update_video_progress",h="ad_convert_event",l="neo_playagain_event",d="neo_scan_aggregation_mute_event",c="auto_call_show";var p,m,g;!function(t){t[t.THREEIMG_DEFAULT_CLICK=0]="THREEIMG_DEFAULT_CLICK",t[t.THREEIMG_FIRST_CLICK=1]="THREEIMG_FIRST_CLICK",t[t.THREEIMG_SECOND_CLICK=2]="THREEIMG_SECOND_CLICK",t[t.THREEIMG_THIRD_CLICK=3]="THREEIMG_THIRD_CLICK"}(p||(p={})),function(t){t[t.picStyle=1]="picStyle",t[t.textStyle=2]="textStyle"}(m||(m={})),function(t){t[t.GRAYBG_ONE_LINE=1]="GRAYBG_ONE_LINE",t[t.GRADIENT_ONE_LINE=2]="GRADIENT_ONE_LINE",t[t.GRADIENT_TWO_LINE=3]="GRADIENT_TWO_LINE"}(g||(g={}));class u{static saveLocal(t,e){if("undefined"!=typeof TKLocalStorage&&Pe.supportMinimumTKVersion("4.0.0"))try{(new TKLocalStorage).set(t,e)}catch(i){}}static getLocalString(t){if("undefined"!=typeof TKLocalStorage&&Pe.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return e.toString()}catch(e){}return null}static getLocalInt(t){if("undefined"!=typeof TKLocalStorage&&Pe.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Number.parseInt(e.toString())}catch(e){}return 0}static getLocalBoolean(t){if("undefined"!=typeof TKLocalStorage&&Pe.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Boolean(e.toString)}catch(e){}return!1}}let w=null;const C="TKResIndexKey";class f{constructor(){var t,e,i;this.defaultHost="p1-lm.adukwai.com",this.currentIndex=0;let n=null===(i=null===(e=null===(t=de())||void 0===t?void 0:t.appConfig)||void 0===e?void 0:e.idc)||void 0===i?void 0:i.tkres;n&&0!=n.length||(n=["p1-lm.adukwai.com","p2-lm.adukwai.com"]),this.resList=n;let s=u.getLocalInt(C);s>n.length&&(s=0),this.currentIndex=s}static getInstance(){return w||(w=new f),w}getCurrentHost(){return this.currentIndex>=this.resList.length?this.defaultHost:this.resList[this.currentIndex]}markUrlFail(t){if(!(t.indexOf(this.getCurrentHost())<0||"undefined"!=typeof KSAdTKNetworkManager&&0==KSAdTKNetworkManager.getCurrentNetworkType())){const t=this.currentIndex;this.currentIndex=++this.currentIndex%this.resList.length,this.currentIndex!==t&&u.saveLocal(C,this.currentIndex)}}}var y,T;!function(t){t.START="start",t.CENTRT="center",t.END="end"}(y||(y={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(T||(T={}));var I,v,V;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.PRODUCT=1]="PRODUCT",t[t.EVENT=2]="EVENT",t[t.COUPON=3]="COUPON",t[t.PRODUCT_DEEP_VIDEO=4]="PRODUCT_DEEP_VIDEO"}(I||(I={}));class A{}A.UNKNOWN_DOWNLOAD_SOURCE=0,A.FROM_LANDING_PAGE=1,A.FROM_DIRECT_INSTALLATION=2;class b{}!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(v||(v={}));class S{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(V||(V={}));class x{}class L{}var _,D,F;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(_||(_={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(D||(D={})),function(t){t[t.unkonwn=0]="unkonwn",t[t.videoPromoteFollow=1]="videoPromoteFollow",t[t.videoPromoteGoods=2]="videoPromoteGoods",t[t.liveGoods=3]="liveGoods",t[t.liveNotGoods=4]="liveNotGoods",t[t.videoAd=5]="videoAd"}(F||(F={}));function k(t){try{const e=t.adMatrixInfo.adDataV2.styleComponentInfo;if(e&&e.styleComponentFlag)return!0}catch(e){}return!1}function R(t,e,i){if(console.log("tkloadcontroller target componentName:"+e+" slotId:"+i),Ie(e)&&!be(i))try{const n=t.adMatrixInfo.adDataV2.componentDatas.length;for(let s=0;s<n;s++){let n=t.adMatrixInfo.adDataV2.componentDatas[s];if(n.componentName==e&&n.slotId==i)return n}}catch(n){}}function B(t){try{if(t)return JSON.parse(t.data)}catch(e){}}function E(t,e,i=!0){try{const n=t.adMatrixInfo.adDataV2.styleComponentInfo;let s={component_id:e.componentId,combination_id:i?n.playCardInfo.combinationIds:n.endCardInfo.combinationIds,page_id:i?n.playCardInfo.pageId:n.endCardInfo.pageId};return JSON.stringify(s)}catch(n){return""}}class K{static isClickReward(t,e){try{let i=!0;if(Pe.isAndroid()&&!be(e)&&(i=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&i)return!0}catch(i){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(i){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){try{return t.advertiserInfo.userId||0}catch(e){return 0}}static getLiveStreamId(t){try{return t.adBaseInfo.liveStreamId||""}catch(e){return""}}static getLiveServiceToken(t){try{return t.adConversionInfo.liveServiceToken||""}catch(e){return""}}static getLiveUserId(t){try{return t.adConversionInfo.liveVisitorId||0}catch(e){return 0}}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!be(e)&&K.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),be(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=Ie(e)?e:t.advertiserInfo.rawUserName}catch(i){}return e=Ie(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(be(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return be(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=ot(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let i="";try{i=t.neoLiveAuthorInfoData.authorName}catch(n){}try{be(i)&&(i=t.neoLiveCartDetailData.authorName)}catch(n){}try{be(i)&&(i=e.adBaseInfo.appName)}catch(n){}return i}static liveGetLiveDesc(t,e){let i="";try{i=t.neoLiveCartDetailData.liveDesc}catch(n){}try{be(i)&&(i=t.neoLiveAuthorInfoData.liveDesc)}catch(n){}try{be(i)&&(i=t.adDescription)}catch(n){}try{be(i)&&(i=e.adBaseInfo.adDescription)}catch(n){}return i}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!be(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!be(e))return e}catch(e){}return null}static getNeoAutoDialogType(t){var e;if(k(t)){if(R(t,"reward-dialog-common",5))return 1;if(R(t,"reward-dialog-fund",5))return 2}else try{let i=0;if(K.isOriginLiveAd(t))i=null===(e=t.adMatrixInfo.adDataV2.videoLiveTKInfo)||void 0===e?void 0:e.neoAutoDialogType;else{let e=H(t);i=1==e?t.adMatrixInfo.adDataV2.neoTKInfo.neoAutoDialogType:2==e?t.adMatrixInfo.adDataV2.videoImageTKInfo.neoAutoDialogType:0}1!=i&&2!=i&&(i=0);let n=Jt(t);return 1==i&&be(n.neoAutoDialogGiftPic)&&be(n.neoAutoDialogGiftTitle)&&(i=0),i}catch(i){}return 0}static hasNeoAutoDialog(t){let e=K.getNeoAutoDialogType(t);return!be(e)&&0!=e}static newDeepVideoInteractCardInfo(t,e){if(be(t)||be(e))return null;let i;if(i=JSON.parse(JSON.stringify(Object.assign(t,e))),i.merchantStyleType=I.PRODUCT_DEEP_VIDEO,i.interactiveCardShowTime=0,i.rightsCardCustomImageUrl=t.icon,i.rightsCardCustomContent=t.name,i.rightsCardProductIconDesc="热卖",be(t.rating))i.rightsCardProductTags=t.serviceInfoList;else{let e=[t.rating];i.rightsCardProductTags=e.concat(t.serviceInfoList)}return i}}function P(t,e){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;let i=null;if(e)for(let n=0;n<t.impAdInfo.length;++n){let s=t.impAdInfo[n];if(s.adInfo.length>0&&s.adInfo[0].adBaseInfo.creativeId==e){i=s;break}}return i||(i=t.impAdInfo[0]),i}function M(t){var e;return(null===(e=null==t?void 0:t.adInfo)||void 0===e?void 0:e.length)>0?t.adInfo[0]:null}function O(t){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;const e=t.impAdInfo[0];return(null==e?void 0:e.adInfo)&&0!=e.adInfo.length?e.adInfo[0]:null}function N(t){let e=null;try{1==t.adBaseInfo.adOperationType&&Ie(t.adBaseInfo.appIconUrl)?e=t.adBaseInfo.appIconUrl:Ie(t.advertiserInfo.portraitUrl)&&(e=t.advertiserInfo.portraitUrl)}catch(i){}return e||"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}function H(t){try{return t.adMaterialInfo.materialFeature[0].featureType}catch(e){}return 0}function W(t){try{return j(t.adMaterialInfo.materialFeature[0])}catch(e){}return""}function z(t){try{return t.adMaterialInfo.materialFeature[0]}catch(e){}return null}function U(t){try{return t.adMaterialInfo.materialFeature[0].materialUrl}catch(e){}return""}function G(t){let e={width:0,height:0};try{const i=t.adMaterialInfo.materialFeature[0];1==i.featureType?(e.width=i.videoWidth,e.height=i.videoHeight):e=i.materialSize}catch(i){}return e.width>0&&e.height>0?e:{width:1280,height:720}}function j(t){try{return!Ie(t.firstFrame)||t.firstFrame.includes(".kpg")||t.firstFrame.includes(".webp")?Ie(t.coverUrl)?t.coverUrl:t.coverUrl||t.materialUrl||"":t.firstFrame}catch(e){}return""}function Y(t){try{return t.adMaterialInfo.materialFeature[0].videoDuration}catch(e){}return 0}function X(t){try{return 1==t.adBaseInfo.adOperationType}catch(e){}return!1}function J(t){let e=null;try{switch(t.adBaseInfo.adOperationType){case 1:e=t.adBaseInfo.appName;break;case 2:e=t.adBaseInfo.productName}Ie(e)||(e=t.advertiserInfo.rawUserName)}catch(i){}return e||"可爱的广告君"}function $(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function q(t){try{return t.adMatrixInfo.adDataV2.neoTKInfo.confirmCardType}catch(e){}return 0}function Z(t){let e=!1;try{e=3==t.adStyleConfInfo.innerAdType}catch(i){}return e}function Q(t){let e=!1;try{e=4==t.adStyleConfInfo.innerAdType||5==t.adStyleConfInfo.innerAdType}catch(i){}return e}function tt(t){let e=ot(t,15);if(null!=e)return JSON.parse(e.data)}function et(t){let e=ot(t,12);if(null!=e)return JSON.parse(e.data)}function it(t){let e=ot(t,12);if(null!=e)return JSON.parse(e.data)}function nt(t){return 1==$(t)}function st(t){let e=null;try{if(e=t.advertiserInfo.fansCount,e>0&&e<1e4)return e+"";if(e>=1e4)return e=(e/1e4).toFixed(1)+"万",e}catch(i){}return""}function at(t,e){let i;try{switch(e){case 1:i=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId;break;case 12:i=t.adMatrixInfo.adDataV2.neoTKInfo.templateId;break;case 3:i=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId;break;case 2:i=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId;break;case 4:i=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId;break;case 6:case 9:i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId;break;case 5:i=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId;break;case 7:i=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId;break;case 10:i=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId;break;case 11:i=t.adMatrixInfo.adDataV2.pushTKInfo.templateId;break;case 13:i=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId;break;case 14:i=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId;break;case 15:i=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId;break;case 16:i=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId;break;case 100:i=t.adMatrixInfo.adDataV2.complianceCardInfo.templateId;break;case 101:i=t.adMatrixInfo.adDataV2.downloadConfirmCardInfo.templateId;break;case 17:i=t.adMatrixInfo.adDataV2.feedTKCardInfo.templateId;break;default:i=void 0}}catch(n){i=void 0}return i}function ot(t,e){let i=at(t,e);if(console.log("tkloadcontroller target templateid:"+i),!Ie(i))return;const n=t.adMatrixInfo.adDataV2.templateDatas.length;for(let s=0;s<n;s++){let e=t.adMatrixInfo.adDataV2.templateDatas[s];if(e.templateId==i)return e}}function rt(t,e){let i=at(t,e);if(!i)return null;console.log("tkloadcontroller   get template is:"+i);const n=t.adMatrixInfo.styles.templates.length;for(let s=0;s<n;s++){let e=t.adMatrixInfo.styles.templates[s];if((null==e?void 0:e.templateId)==i)return e}return null}function ht(t,e){let i=ot(t,e);if(!be(i))return JSON.parse(i.data).bottomCouponInfo}function lt(t,e){let i=ot(t,e);if(null!=i)return JSON.parse(i.data).autoCallAppInfo}function dt(t,e){let i=ot(t,e);if(null!=i)return JSON.parse(i.data).downloadCardInfo}function ct(t,e){let i=ot(t,e);if(null!=i)return JSON.parse(i.data).cardDynamicEffects}function pt(t){var e;try{return Pe.isAndroid()&&1==t.adBaseInfo.adOperationType&&(null===(e=t.downloadSafeInfo.complianceInfo)||void 0===e?void 0:e.titleBarTextSwitch)>0}catch(i){}return!1}function mt(t){try{let e=t.autoOpenTime;return(e<=0||null==e)&&(e=3e3),e/1e3}catch(e){return 3}}function gt(t){const e=t.adMaterialInfo.materialFeature.length>0?t.adMaterialInfo.materialFeature[0]:null;if(e){let n=e.videoDuration;0==n&&(n=e.videoDurationMs/1e3);let s=n;try{s=t.adRewardInfo.rewardTime}catch(i){}return s?0==n?s:Math.min(n,s):n}return-1}function ut(t){let e="";if(t<=0||t>36e5)return e;let i,n,s,a=Math.floor(t%1e3/100),o=Math.floor(t/1e3),r=Math.floor(o%60),h=Math.floor(o/60%60);return i=""+a.toString(),n=r<10?"0"+r.toString():r.toString(),s=h<10?"0"+h.toString():h.toString(),e=s+":"+n+":"+i,e}function wt(t,e){let i=!0;if(1==t.adBaseInfo.adOperationType)try{let n=t.downloadSafeInfo.complianceInfo;if(console.log("tkloadcontroller   download ad:"+JSON.stringify(n)),null!=n)switch(e){case 1:i=3!=n.actionBarType;break;case 2:i=3!=n.describeBarType;break;case 3:i=3!=n.materialJumpType;break;default:i=!0}}catch(n){i=!0}else try{let n=t.unDownloadConf.unDownloadRegionConf;if(console.log("tkloadcontroller   h5 ad:"+JSON.stringify(n)+", clickArea: "+e),null!=n)switch(e){case 1:i=1!=n.actionBarType;break;case 2:i=1!=n.describeBarType;break;case 3:i=1!=n.materialJumpType;break;default:i=!0}console.log("tkloadcontroller   h5 ad:"+i)}catch(n){i=!0}return i}function Ct(t){let e=[];if(t.adBaseInfo.videoPlayedNS){let n=t.adBaseInfo.videoPlayedNS.split(",");if(n.length>0)for(var i=0;i<n.length;i++){let t=Number(n[i]);e.push(t)}else e=[3]}return e.sort(),e}function ft(t){return 7==$(t)}function yt(t){return K.isOriginLiveAd(t)||ft(t)}function Tt(t){return 3==$(t)}function It(t){let e=null;try{e=t.adMatrixInfo.adDataV2.merchantLiveReservationInfo}catch(i){return!1}if(be(e))return!1;if(be(e.title)||be(e.liveStartTime)||be(e.bookUserCount))return!1;try{return 2==t.adStyleConfInfo.innerAdType}catch(i){return!1}}function vt(t){try{let e=!0;const i=le();if(Pe.isAndroid()&&le()&&(e=i.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&e)return!0}catch(e){}return!1}function Vt(t){if(be(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return be(e)&&(e=X(t)?"立即下载":"查看详情"),e}function At(t,e){try{if(!Ie(t.adConversionInfo.playableUrl))return!1;const i=t.adConversionInfo.playableStyleInfo.playableOrientation;return 0==i||2==i&&1==e||1==i&&0==e}catch(i){}return!1}function bt(t,e,i){try{if(!At(t,i))return 0;if(3!=e){const e=function(t){let e;try{e=JSON.parse(t.adBaseInfo.expParam)}catch(i){}return e||{}}(t).playableStyle;return!e||e<=0?0:e}if(5==t.adMatrixInfo.adDataV2.actionBarInfo.cardType)return 1;if(6==t.adMatrixInfo.adDataV2.actionBarInfo.cardType)return 2}catch(n){}return 0}function St(t,e){try{let i=e.adMatrixInfo.styles.templates,n=0;for(;n<i.length;++n){let e=i[n];if(e&&t==e.templateId)return e.templateUrl}}catch(i){console.log("TK get matrix url error")}return""}function xt(t,e){try{let i=e.adMatrixInfo.styles.templates,n=0;for(;n<i.length;++n){let e=i[n];if(e&&t==e.templateId)return e}}catch(i){console.log("TK get matrix url error")}return""}function Lt(t,e){try{let i=e.adMatrixInfo.adDataV2.templateDatas;for(let e=0;e<i.length;e++){let n=i[e];if(n&&t==n.templateId)return n}}catch(i){}}function _t(t){try{return t.adMatrixInfo.adDataV2.rewardVideoInteractInfo.rewardTime}catch(e){return 5}}function Dt(t){try{let e=t.adMatrixInfo.adDataV2.rewardVideoInteractInfo.showTime;return e<=0&&(e=0),e}catch(e){return 15}}function Ft(t,e){let i=null,n=Ht(t,e);return n&&(i=function(t,e){let i=ot(t,e);if(null==i)return;return JSON.parse(i.data).redPacketInfo}(t,n)),i}function kt(t,e){let i=null,n=Ht(t,e);return n&&(i=function(t,e){let i=ot(t,e);if(null==i)return;return JSON.parse(i.data).merchantCardInfo}(t,n)),i}function Rt(t,e){let i=null;return i=function(t,e){let i=ot(t,e);if(null==i)return;return JSON.parse(i.data).ecIndustryInfo}(t,Ht(t,e)),i}function Bt(t,e){let i=null;return i=function(t,e){let i=ot(t,e);if(null==i)return;return JSON.parse(i.data).socialCardInfo}(t,Ht(t,e)),i}function Et(t,e){let i=null;return i=function(t,e){let i=ot(t,e);if(null==i)return;return JSON.parse(i.data).gameIndustryInfo}(t,Ht(t,e)),i}function Kt(t,e){let i=null;return i=function(t,e){let i=ot(t,e);if(null==i)return;return JSON.parse(i.data).deepVideoCardInfo}(t,Ht(t,e)),i}function Pt(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.neoTKInfo.renderType}catch(i){}return e}function Mt(t,e){let i=ot(t,e);if(null==i)return;let n=JSON.parse(i.data),s=null;try{s=n.widgetInfo}catch(a){}return s}function Ot(t,e){let i=null,n=Ht(t,e);if(n){let e=Mt(t,n);e&&(i=e.redPacketInfo),i&&(i.showTime=1.5)}return i}function Nt(t,e){let i=null,n=Ht(t,e);return n&&(i=function(t,e){let i=ot(t,e);if(null==i)return;return JSON.parse(i.data).giftBoxInfo}(t,n)),i}function Ht(t,e){let i=null;try{if(function(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.videoImageTKInfo.renderType}catch(i){}return e}(t))return 16;if(function(t){let e=!1;try{e=!be(t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId)}catch(i){}return e}(t))return 14;2==e?i=Pt(t)?12:4:3==e?i=function(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.fullScreenInfo.renderType}catch(i){}return e}(t)?3:4:13==e?i=2:4==e&&(i=5)}catch(n){}return i}function Wt(t){if(Pe.isAndroid()){try{return t.shakeInfo.acceleration}catch(e){}return 12}{const i=[.35,.5,.65,.8,1,1.5,2];let n=5;try{n=t.shakeInfo.acceleration-1}catch(e){}return n<=0?n=5:n>=i.length&&(n=i.length-1),i[n]}}function zt(t){try{return t.bidirectionalSwitch}catch(e){}return!1}function Ut(t,e){var i;if(!Pe.supportMinimumTKVersion("4.0.10"))return!1;let n=function(t,e){let i=rt(t,e);return be(i)?null:i.templateUrl}(t,7);return!be(n)&&(null===(i=null==e?void 0:e.appConfig)||void 0===i?void 0:i.autoShowActivityMiddlePage)}function Gt(t){if(null==t)return;let e=null;try{e=JSON.parse(t.data).merchantPlayInfo}catch(i){}return e}function jt(t,e){if(be(e))return;if(!ye())return void t.addEventListener("swipe",(t=>{e()}));let i=null,n=t=>{if("down"==t.type)i=t;else if("up"==t.type&&3==t.motionType&&null!=i){let n=t.position.x,s=t.position.y,a=i.position.x,o=i.position.y;(Math.abs(n-a)>=10||Math.abs(s-o)>=10)&&e()}};t.addEventListener("down",n),t.addEventListener("up",n)}function Yt(t,e){let i=ot(e,3==t?3:12);try{let t=JSON.parse(i.data);return be(t)||be(t.neoLiveRoomInfoData)?null:t}catch(n){}return null}function Xt(t){try{if(t.adMatrixInfo.adDataV2.neoTKInfo.neoItemType)return t.adMatrixInfo.adDataV2.neoTKInfo.neoItemType}catch(e){}return F.videoAd}function Jt(t){if(null==t)return null;try{let e=null;if(K.isOriginLiveAd(t))e=at(t,14);else{let i=H(t);2==i?e=at(t,16):1==i&&(e=at(t,12))}if(e){let i=Lt(e,t);return JSON.parse(i.data).neoAutoDialog}}catch(e){}return null}function $t(t){return!(!t.downloadSafeInfo||!Pe.isSupportDownloadDel())&&t.downloadSafeInfo.downloadDeleteEnable}function qt(t){return!!(X(t)&&t.downloadSafeInfo&&Pe.isSupportDownloadDel())&&t.downloadSafeInfo.downloadShowPauseEnable}function Zt(t,e){try{if(2==e&&7==t.adMatrixInfo.adDataV2.neoVideoInfo.interactionInfo.interactiveStyle)return!0;if(3==e&&7==t.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo.interactiveStyle)return!0}catch(i){return!1}return!1}function Qt(t){try{let e=t.abConfig.videoRollbackToImageTimeout;return Math.floor(e)}catch(e){return 4e3}}var te=null,ee=null,ie=null,ne=null,se=null;class ae{}function oe(t){console.log("tkloadcontroller  save global device info:"+JSON.stringify(t)),te=t}function re(t){se=t}function he(){return se}function le(){return te}function de(){return ee}function ce(){return ne}function pe(){const t=Tachikoma.env.styleTemplate;return t?JSON.parse(t):null}function me(t,e){e=e||pe(),t=t||O(ce());const i=null==e?void 0:e.templateId,n=null==e?void 0:e.templateVersionCode,s=null==t?void 0:t.adTKGrayConfig,a=i+"#"+n;return(null==s?void 0:s.get(a))||0}function ge(t){if(null==t)return-1;let e=t.screenWidth;return ye()&&(e=Tachikoma.px2Dp(e)),e}function ue(){return Date.parse((new Date).toString())}function we(t){return t instanceof Error?t.message+":"+t.stack:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function Ce(){var t;return!ye()&&(null===(t=Tachikoma.env.safeAreaInsets)||void 0===t?void 0:t.bottom)>0}function fe(){return!be(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function ye(){return"Android"===Tachikoma.env.platform}function Te(t,e){let i={x:0,y:0};if(Pe.supportMinimumTKVersion("4.0.0")){const n=e.getLocationOnScreen(),s=t.position;if(!n||!s)return i;s.x=parseFloat((s.x+"").replace("dp","")),s.y=parseFloat((s.y+"").replace("dp","")),i={x:n.x+s.x,y:n.y+s.y}}return i}function Ie(t){return"string"==typeof t&&t.length>0}function ve(){return te?te.tkVersion:Tachikoma.env.tkVersion||Tachikoma.env.TKVersion}function Ve(){return te?te.SDKVersion:Tachikoma.env.SDKVersion}function Ae(){return te?te.sdkType:Tachikoma.env.sdkType}function be(t){return null===t||null==t||""===t}function Se(t){return!!be(t)||0==t.length}ae.matchParent="100%";new class{};class xe{constructor(t,e,i){this.name=t,this.object=e,this.parent=i,this.children=new Map}addChildren(t,e){this.children.set(t,e)}}function Le(t,e,i){if(t){e||(e=new xe("root",t)),i||(i=new Set),i.add(t);for(const n in t){const s=typeof t[n],a=t[n];if("object"==s&&!n.includes("$")&&a){a.nativeID||(a.nativeID=n);const t=new xe(n,a,e);if(e.addChildren(n,t),i.has(a)){const e=[];e.push(t);let i=t,n=!1;for(;i.parent;)if(i=i.parent,e.push(i),i.object===t.object){n=!0;break}if(n){let t="执行出错：发生循环引用\n";for(let n=e.length-1;n>=0;--n)i=e[n],t+=i.name+":"+i.object+"\n";throw new Error(t)}}Le(a,t,i)}}}}function _e(){return 1==Tachikoma.env.isDebug}function De(t,e){let i=e-t,n=Math.random();return t+Math.round(n*i)}function Fe(t){let e=t;return e.indexOf("/")>=0||t.startsWith("http")||(e="https://"+f.getInstance().getCurrentHost()+"/kos/nlav111362/ksad/"+t),e}function ke(t,e){Re(t,e,null)}function Re(t,e,i){if(t&&e){const n=Fe(e);t.setImageLoadCallback&&!be(n)&&n.startsWith("http")&&t.setImageLoadCallback((t=>{f.getInstance().markUrlFail(n),i&&i(t)})),t.setSrc(n)}}function Be(t,e,i,n){let s=0;if(setTimeout((()=>{0==s&&(s=-1,n(!1))}),i),t&&e){const i=Fe(e);t.setImageLoadCallback&&!be(i)&&i.startsWith("http")&&t.setImageLoadCallback((t=>{f.getInstance().markUrlFail(i),n&&0==s&&(s=1,n(t))})),t.setSrc(i)}}function Ee(t){return!be(t)}function Ke(t){const e=t.match(/^([0-9a-zA-Z]+:\/\/)?([\da-zA-Z.-]+)([/\w.-]*)*\/?[/\w]*/);if(e){const[,,t,i]=e;return{host:t,path:i}}return{}}class Pe{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||Pe.supportMinimumTKVersion("5.0.4")}static isSupportDownloadDel(){return this.isAndroid()&&Pe.supportMinimumTKVersion("5.0.7")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let i=t.split("."),n=e.split("."),s=Math.max(i.length,n.length);for(var a=0;a<s;a++){let t=Number(void 0!==i[a]?i[a]:"0"),e=Number(void 0!==n[a]?n[a]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let i=Ae(),n=1==i&&-1!=Pe.compareVersion(Ve(),t),s=2==i&&-1!=Pe.compareVersion(Ve(),e);return n||s}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let i=Ae(),n=1==i&&0==Pe.compareVersion(Ve(),t),s=2==i&&0==Pe.compareVersion(Ve(),e);return n||s}static supportCurrentTKVersion(t="0.0.0"){return ve()==t}static supportMinimumTKVersion(t="0.0.0"){return-1!=Pe.compareVersion(ve(),t)}}Pe.platform=Tachikoma.env.platform;Fe("h5_default_icon.png"),Fe("download_default_icon.png");const Me=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t),_e()&&console.log("tkloadcontroller:"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class Oe{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i="",n=0;n<t;n++)i+=e.charAt(Math.floor(48*Math.random()));return i}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,i){if(!t)return null;const n=this.randomName(i);return Tachikoma[n]=e=>{t(e)},"Tachikoma."+n}}Oe.globalIndex=0;class Ne{static getDeviceInfoAsync(){return Ne.callNative("getDeviceInfo",null).then((t=>(t.result&&t.data&&oe(t.data),t)))}static getKsAdDataAsync(){return Ne.callNative("getKsAdData",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,ne=e),t}))}static getKsAdConfigAsync(){return Ne.callNative("getKsAdConfig",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,ee=e),t}))}static getScreenOrientationAsync(){return Ne.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return Ne.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return Ne.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return Ne.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.lifeStatusCallback=t,this.callNativeWithCallback("registerLifecycleListener",null,(t=>{this.lifeStatusCallback&&!this.isForceUpdateLifeStatus&&this.lifeStatusCallback(t)}),!1)}static forceUpdateLifeStatus(t,e){let i={result:1,data:{lifeStatus:t}};this.isForceUpdateLifeStatus=e,this.lifeStatusCallback&&this.lifeStatusCallback(i)}static registerFocusListener(t){Pe.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("registerFocusListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,i,n=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},i,n)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static adOutCallback(t,e){Pe.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("adOutCallback",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:Ie(e)?e:""})}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,(e=>{t&&t(e)}),!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,i,n=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:i,playDuration:n})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e,i){this.callNativeWithCallback("openURL",{url:t,title:e,showConfirmDialog:i})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){ye()&&this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((i,n)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),i(t)):i({result:0,data:null})}))))}static callNativeWithCallback(t,e,i,n=!0){const s=fe()?1:0;fe()&&"pageStatus"==t||fe()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,i,n,0):this.callNativeWithCallbackAndType(t,e,i,n,s)}static callTKWithCallback(t,e,i,n=!0){this.callNativeWithCallbackAndType(t,e,i,n,1)}static callNativeWithCallbackAndType(t,e,i,n=!0,s=0){if("undefined"==typeof KwaiAd)return Me.log("undefined value KwaiAd"),void(i&&i({result:0,data:null}));Me.log("call:"+t);let a=e=>{let n=0,s=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,n=t.result,s=t.data}catch(a){n=0,s=null}Me.log("cb:"+t+"  r:"+n),i&&i({result:n,data:s})};const o=Oe.registerCallbackForAction(a,n,t),r={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?a:o};0==s?KwaiAd.callAdBridge(r):KwaiAd.callTKBridge(r)}}function He(t){Ne.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}function We(t){Ne.callNativeWithCallback("showToast",{message:t})}function ze(){return Ne.callNative("registerMuteStateListener",null)}function Ue(t,e){Ne.callNativeWithCallback("cancelAppDownload",t?{url:t}:null,e)}function Ge(){Ne.callNativeWithCallback("callbackAfterHandleAdClick",{})}class je{constructor(){this.reward_type=-1,this.task_type=-1,this.task_step=-1}static createPageShowInstance(t,e,i){if(0==e||be(i))return null;if(i.loadDataTime<=0||i.downloadFinishTime<=0)return null;let n=this.INVALID_VALUE;if(e!=this.INVALID_VALUE){n=Date.parse((new Date).toString())-e,n<this.INVALID_VALUE&&(n=this.INVALID_VALUE)}let s=new je;return s.page_status=2,s.load_type=i.loadFromCache?2:1,s.render_duration_ms=n,s.download_type=i.downloadType,s.download_size=i.downloadSize,s.creative_id=t.adBaseInfo.creativeId,s.video_url=U(t),s.video_duration_ms=Y(t),s}}function Ye(t,e){Ze({category:"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_reward_check_result",primaryKey:"web_log",type:"EXECUTION_BIZ_TIME",msg:{check_type:t,request_state:1,creative_id:e.adBaseInfo.creativeId,enviType:1}})}function Xe(t,e,i,n,s){Ze({category:"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_reward_check_result",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{check_type:t,request_state:2,creative_id:e.adBaseInfo.creativeId,enviType:1,data_load_interval_duration_ms:i,message:s||"",code:n}})}function Je(t){Ze({category:"ad_client_apm_log",biz:"AD_SPLASH",sub_biz:"OTHER",rate:1,suffixRatio:"",primaryKey:"status",event_id:"ad_sdk_splash_load",type:"EXECUTION_BIZ_TIME",msg:{status:8001,error_msg:t||""}})}function $e(t,e,i,n,s=!0){let a=.01;"component_empty"==t&&(a=1);Ze({category:1==a?"ad_client_error_log":"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:a,suffixRatio:"",event_id:"ad_tk_uicomponent_track",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{is_component:s?1:0,event_name:null!=t?t:"",scene_type:null!=e?e:"",page_id:null!=i?i:"",component_name:null!=n?n:""}})}function qe(t){Ze({category:"ad_client_apm_log",biz:"AD_SPLASH",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_splash_load",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:t})}function Ze(t){Pe.supportMinimumTKVersion("4.0.4")&&(t.msg&&(t.msg.report_source=1),Ne.sendCommercialLog(t,(()=>{})))}function Qe(t,e="",i=""){var n,s;Ze({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_tk_render_performance",primaryKey:"unknown",type:"OTHER",msg:{render_state:3,error_reason:we(t),template_id:be(i)?null===(n=pe())||void 0===n?void 0:n.templateId:i,version_code:be(e)?null===(s=pe())||void 0===s?void 0:s.templateVersionCode:e}})}function ti(t,e,i){var n;if(!Pe.supportMinimumTKVersion("4.0.7"))return;let s="",a="";if(Ee(i)){const{host:t,path:e}=Ke(i)||{};s=t||"",a=e||""}const o=t.getCommercialLogInfo();Ze({category:"ad_client_apm_log",biz:ai(null===(n=t.scene)||void 0===n?void 0:n.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_deeplink_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:o.tkPublishType,template_id:o.templateId,version_code:o.templateVersion,creative_id:o.creativeId,llsid:o.llsid,pos_id:o.posId,status:e,url:i,url_host:s,url_path:a}})}function ei(t,e,i){var n;if(!Pe.supportMinimumTKVersion("4.0.7"))return;let s="",a="";if(Ee(i)){const{host:t,path:e}=Ke(i)||{};s=t||"",a=e||""}const o=t.getCommercialLogInfo();Ze({category:"ad_client_error_log",biz:ai(null===(n=t.scene)||void 0===n?void 0:n.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_deeplink_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:o.tkPublishType,template_id:o.templateId,version_code:o.templateVersion,creative_id:o.creativeId,llsid:o.llsid,pos_id:o.posId,status:e,url:i,url_host:s,url_path:a,error_code:100007}})}function ii(t,e,i,n,s){var a;if(!Pe.supportMinimumTKVersion("4.0.7"))return;let o="",r="";if(Ee(i)){const{host:t,path:e}=Ke(i)||{};o=t||"",r=e||""}const h=n?1:0,l=s?1:0,d=t.getCommercialLogInfo();Ze({category:"ad_client_apm_log",biz:ai(null===(a=t.scene)||void 0===a?void 0:a.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_appstore_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:d.tkPublishType,template_id:d.templateId,version_code:d.templateVersion,creative_id:d.creativeId,llsid:d.llsid,pos_id:d.posId,status:e,url:i,url_host:o,url_path:r,store_type:h,launch_type:l,campaign_type:t.getCampaignType(),ocpc_action_type:t.getOcpcActionType(),industry_first_level_id:t.getIndustryFirstLevelId(),ad_operation_type:t.getAdOperationType()}})}function ni(t,e,i,n,s,a){var o;if(!Pe.supportMinimumTKVersion("4.0.7"))return;let r="",h="";if(Ee(i)){const{host:t,path:e}=Ke(i)||{};r=t||"",h=e||""}const l=s?1:0,d=a?1:0,c=t.getCommercialLogInfo();Ze({category:"ad_client_error_log",biz:ai(null===(o=t.scene)||void 0===o?void 0:o.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_appstore_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:c.tkPublishType,template_id:c.templateId,version_code:c.templateVersion,creative_id:c.creativeId,llsid:c.llsid,pos_id:c.posId,status:e,url:i,url_host:r,url_path:h,store_type:l,error_code:100006,error_msg:n,launch_type:d,campaign_type:t.getCampaignType(),ocpc_action_type:t.getOcpcActionType(),industry_first_level_id:t.getIndustryFirstLevelId(),ad_operation_type:t.getAdOperationType()}})}function si(t,e){if(!Pe.supportMinimumTKVersion("4.0.7"))return;const i=ce(),n=function(t){return(null==t?void 0:t.impAdInfo)&&0!=t.impAdInfo.length?t.impAdInfo[0]:null}(i),s=O(ce());let a=Object.assign(Object.assign({},function(t,e){var i,n;return{creative_id:null==t?void 0:t.adBaseInfo.creativeId,llsid:e,template_id:null===(i=pe())||void 0===i?void 0:i.templateId,version_code:null===(n=pe())||void 0===n?void 0:n.templateVersionCode,tk_publish_type:me(t,pe())}}(s,i.llsid)),{status:t,errorMsg:e});Ze({category:"ad_client_apm_log",biz:ai(n.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_tk_endpage_performance",tag:"ad_tk_endpage_performance",primaryKey:"status",type:"OTHER",msg:a})}function ai(t){let e="OTHER";switch(t){case 3:e="AD_FULLSCREEN";break;case 2:e="AD_REWARD";break;case 4:e="AD_SPLASH";break;case 13:e="AD_INTERSTITIAL";break;case 1:e="AD_FEED";break;case 1e4:e="AD_NATIVE"}return e}je.INVALID_VALUE=-1;let oi;function ri(){var t;return oi||(oi={all:t=t||new Map,on(e,i){const n=t.get(e);n?n.push(i):t.set(e,[i])},off(e,i){const n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit(e,i){let n=t.get(e);n&&n.slice().map((t=>{t(i)})),n=t.get("*"),n&&n.slice().map((t=>{t(e,i)}))},clear(){t.clear()}}),oi}class hi{constructor(t,e,i,n,s,a,o){this.soundEnable=!1,this.ignoreCompliance=!1,this.disableDownloadDialog=!1,this.disableLeaveConfirm=!1,this.disableVideoWebPage=!1,this.disableActivityMiddlePage=!1,this.originAdInfo=t,this.deviceInfo=e,this.serverConfig=i,this.creativeId=a;let r=P(this.originAdInfo,a);this.adInfo=M(r),this.adCacheId=o||Tachikoma.env.adCacheId,this.originAdInfo.adCacheId=this.adCacheId,this.appId=s||Tachikoma.env.appId,this.scene=n,n||(Tachikoma.env.adScene?this.scene=JSON.parse(Tachikoma.env.adScene):this.scene={adStyle:r.adStyle,backUrl:""})}getCommercialLogInfo(){const t=new li;t.creativeId=this.creativeId,t.llsid=this.originAdInfo.llsid,t.posId=this.originAdInfo.impAdInfo[0].posId;const e=this.adInfo.adConversionInfo.h5SecondConfirmationSwitch;return t.landingPageType=e?0:1,this.sourceTemplate&&(t.templateId=this.sourceTemplate.templateId,t.templateVersion=this.sourceTemplate.templateVersionCode,t.tkPublishType=me(this.adInfo,this.sourceTemplate)),t}getOcpcActionType(){try{return this.adInfo.ocpcActionType}catch(t){return 0}}getCampaignType(){try{return this.adInfo.adBaseInfo.campaignType}catch(t){return 0}}getIndustryFirstLevelId(){try{return this.adInfo.adBaseInfo.industryFirstLevelId}catch(t){return 0}}getAdOperationType(){try{return this.adInfo.adBaseInfo.adOperationType}catch(t){return 0}}}class li{}class di{static createVideoCommonInstance(t,e){return 3==t?di.createFullscreenCommonInstance(e):2==t?di.createNeoCommonInstance(e):null}static createImageCommonInstance(t,e){var i;let n=new S;return n.template_id=at(e,16),n.template_version=null===(i=rt(e,16))||void 0===i?void 0:i.templateVersion,n}static createLiveCommonInstance(t,e){var i;let n=new S;return n.template_id=at(e,14),n.template_version=null===(i=rt(e,14))||void 0===i?void 0:i.templateVersion,n}static createNeoCommonInstance(t){var e;let i=new S,n=K.getNeoActionBarCardType(t);return i.actionbar_card_type=n,i.template_id=at(t,12),i.template_version=null===(e=rt(t,12))||void 0===e?void 0:e.templateVersion,n!=_.LIVE_CUT3_STYLE1&&n!=_.LIVE_CUT3_STYLE2||(i.live_room_pattern=V.SIMPLIFIED_LIVE_ROOM_PATTERN),i}static createFullscreenCommonInstance(t){let e=new S,i=K.getFullscreenActionBarCardType(t);return e.actionbar_card_type=i,i!=_.LIVE_CUT3_STYLE1&&i!=_.LIVE_CUT3_STYLE2||(e.live_room_pattern=V.SIMPLIFIED_LIVE_ROOM_PATTERN),e}static appendNeoExtData(t,e,i,n){if(null==t)return;let s=t.neo_ext_data;null==s&&(s=new x,t.neo_ext_data=s),i&&(s.videoRollbackToImageTimeout=i.videoRollbackToImageTimeout),s.originalMaterialType=H(e),n&&s&&n(s)}}var ci=function(t,e,i,n){return new(i||(i=Promise))((function(s,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function r(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}h((n=n.apply(t,e||[])).next())}))};class pi{static sendLog(t,e,i,n){this.log(t,null,e,i,n)}static log(t,e,i,n,s){(i=i||{}).renderContainer=1;const a={actionType:t,payload:JSON.stringify(i)};if(s&&(a.creativeId=s),n)if(null==n?void 0:n.adCacheId)a.adCacheId=null==n?void 0:n.adCacheId;else{const t=P(n,s);a.adTemplate=JSON.stringify(t)}e&&(a.clickInfo=e),Ne.sendLog(a)}static convertIfNeeded(t,e,i,n,s,a,o,r,h,l,d){let c=wt(e,i);if(!c)return c;let p=ie;return be(p)||(a||(a=new S),be(a.template_id)&&(a.template_id=p.templateId),be(a.template_version)&&(a.template_version=p.templateVersion)),a=pi.appendGlobalNeoExtData(a,e),yt(e)&&this.reportLivePlaySecond(this.sCurrentPlayTimeMs/1e3),this.convert(i,n,s,t,a,o,r,h,l,d),c}static convert(t,e,i,n,s,a,o,r,l,d){var c,p;return ci(this,void 0,void 0,(function*(){const m=M(P(ce(),r));if(!m||!wt(m,t))return void console.log("tkloadcontroller invalid convert:"+m+":"+t);let g,u;g=be(s)?{itemClickType:i,renderContainer:1}:{itemClickType:i,renderContainer:1,clientExtData:JSON.stringify(s)},be(a)||Object.assign(g,a),ri().emit(h,{clickType:i}),e?(u={x:e.x,y:e.y},e.width&&(u.width=e.width),e.height&&(u.height=e.height)):u={};let w=-1;(null==o?void 0:o.convertType)&&(w=o.convertType,g.triggerType=w);let C=!1;if(this.matchTKConversion()){console.log("tkloadcontroller match conversion service");let i=KSAdTKBundleService.getInstance("CommercialKSAdConversionService","conversion-service",null);if(i){console.log("tkloadcontroller service instance is:"+i);const s=new hi(l||ce(),le(),de());s.currentPlayTime=this.sCurrentPlayTimeMs,s.clickScene=n,s.convertType=w,s.creativeId=r,s.clickArea=t,s.soundEnable=this.sSoundEnable,s.sourceTemplate=pe(),(null==o?void 0:o.liveItemId)&&(s.liveItemId=o.liveItemId),Tachikoma.env.isDebug&&We("TK转化链路开始"),i.getVersion()>=2&&(this.sSecondClickCallback=t=>{0==t?Ne.forceUpdateLifeStatus("pageInvisiable",!0):1==t?Ne.forceUpdateLifeStatus("pageInvisiable",!1):2==t&&(Ne.forceUpdateLifeStatus("pageVisiable",!1),Pe.supportMinimumTKVersion("6.0.3")&&!Pe.isAndroid()&&Ge())},i.setSecondConfirmCallback(this.sSecondClickCallback),i.getVersion()>=3&&Pe.supportMinimumTKVersion("5.1.3")&&ye()&&(this.sDownloadTipCallback=t=>{switch(t){case 0:Ne.adOutCallback({targetMethod:"adDownloadConfirmTipShow"});break;case 2:Ne.adOutCallback({targetMethod:"adDownloadConfirmTipCancel"});break;case 1:Ne.adOutCallback({targetMethod:"adDownloadConfirmTipDismiss"})}},i.setDownloadConfirmTipCallback(this.sDownloadTipCallback))),this.sHandleAdClickCallback=t=>{if(this.sCurrentPlayTimeMs>0&&(g.playedDuration=this.sCurrentPlayTimeMs),t.reportExtraParam)try{let e=be(g.clientExtData)?{}:JSON.parse(g.clientExtData);e.clientExtData=JSON.parse(t.reportExtraParam),g.clientExtData=JSON.stringify(e)}catch(i){Qe(i)}this.log(2,e,g),Pe.isAndroid()||this.handleIOSConvertCallback(t)},this.sAfterHandleClickCallback=()=>{Pe.supportMinimumTKVersion("6.0.3")&&!Pe.isAndroid()&&Ge()},i.getVersion()>=4&&i.setAfterHandleClickCallback(this.sAfterHandleClickCallback),i.handleAdClick(JSON.stringify(s),this.sHandleAdClickCallback),C=!0}else this.loadConversionServiceIfNeeded((t=>{console.log("tkloadcontroller service load result:"+t)}))}let f=null==l?void 0:l.impAdInfo[0];r||(r=null===(p=null===(c=O(l||ce()))||void 0===c?void 0:c.adBaseInfo)||void 0===p?void 0:p.creativeId),function(t,e,i,n,s,a,o,r){e.isCallbackOnly=r,Ne.clickActionBase(Object.assign(Object.assign({area:t,logParam:e},i),{creativeId:n,adTemplate:a,disableCallback:o,isCallbackOnly:r}),s)}(t,{payload:JSON.stringify(g),clickInfo:u,sceneType:n,itemClickType:i},o,r,(i=>{1!=i.result&&(this.log(2,e,g),Ne.convert(1==t))}),f,d,C)}))}static handleIOSConvertCallback(t){t.success&&3==t.interactionType&&Ne.adOutCallback({targetMethod:"closeConvertPageCallback",methodParams:JSON.stringify({interactionType:t.interactionType})})}static reportClick(t,e,i,n){null==n&&(n=new S),n=pi.appendGlobalNeoExtData(n,t);let s={clientExtData:JSON.stringify(n)};s=Object.assign(s,i),pi.log(2,null,s)}static appendGlobalNeoExtData(t,e){let i=de(),n=he();return null!=n&&null!=i&&(t||(t=new S),di.appendNeoExtData(t,e,i.abConfig,(t=>{t.realRenderResult=n}))),t}static expose(t,e){this.log(1,null,t,e)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,i,n,s){this.convertWithType(e,i,n,s)}static convertWithType(t,e,i,n){this.convert(t,e,i,0,null,null,{convertType:n})}static convertWithTypeIfNeededNew(t,e,i,n,s,a){wt(t,e)&&this.convertWithTypeNew(e,i,n,s,a)}static convertWithTypeNew(t,e,i,n,s){this.convert(t,e,i,0,null,s,{convertType:n})}static playNSecond(t,e){let i={photoPlaySecond:t};if(e){let t={clientExtData:JSON.stringify(e)};Object.assign(i,t)}this.log(402,null,i)}static playStart(t){let e=null;t&&(e={clientExtData:JSON.stringify(t)}),pi.log(399,null,e)}static reportLivePlaySecond(t){let e={photoPlaySecond:Math.round(t)},i={actionType:28,payload:JSON.stringify(e)};Ne.sendLog(i)}static skip(){this.log(501,null,null)}static loadConversionServiceIfNeeded(t){this.matchTKConversion()&&KSAdTKBundleService.loadBundle("CommercialKSAdConversionService",t),t&&t(!1)}static matchTKConversion(){var t,e;return!!(null===(e=null===(t=de())||void 0===t?void 0:t.abConfig)||void 0===e?void 0:e.tkConversionSwitch)&&(!(!ye()||!Pe.supportMinimumTKVersion("6.0.5"))||!ye()&&Pe.supportMinimumTKVersion("6.0.3"))}static updateVideoPlayStatus(t,e,i,n){!function(t,e,i,n){Ne.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:i||"",currentTime:n||0})}(t,e,i,n),"progress"==t&&n&&(this.sCurrentPlayTimeMs=n)}static updateLivePlayStatus(t,e,i,n){"progress"==t&&n&&(this.sCurrentPlayTimeMs=n)}}pi.sSoundEnable=!1;class mi{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,Ne.pageStatus(t,e),this.registerNativeId(),pi.loadConversionServiceIfNeeded((t=>{})))}registerNativeId(){_e()&&Pe.supportMinimumTKVersion("4.0.7")&&!Pe.isAndroid()&&(this.startConfig(),Ne.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{Le(this)}),120)}}class gi extends Object{constructor(t,e,i,n){var s;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=i,this.value=this.get(),this.cb(null!==(s=this.value)&&void 0!==s?s:n,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){gi.target=this;const t=this.getter.call(this.vm,this.vm);return gi.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let i=0,n=e.length;i<n;i++){if(!t)return;t=t[e[i]]}return t}}}function ui(t){return!!t}function wi(t){return"string"==typeof t}let Ci;function fi(){if(null!=Ci)return Ci;let t=!1;try{t=!1,Ci=t}catch(e){}return t}function yi(t,e){if(!0===fi()&&(null==t||!1===t))throw new Error("tkmvvm ----- 请检查传值: "+e)}function Ti(t){return t.$vm}function Ii(t){fi()&&console.log("tachikoma TKMVVM log -> "+t)}class vi extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var i=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(n){e?e===n&&i.observeValueWithKey(t,n):i.observeValueWithKey(t,n)}))}observeValueWithKey(t,e){let i=t[e];var n=new Ai(e);bi(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return gi.target&&n.depend(),i},set:function(t){t!==i&&(i=t,n.notify(),bi(t))}})}defineArray(t){if(t)for(let e=0,i=t.length;e<i;e++)bi(t[e])}}var Vi=0;class Ai extends Object{constructor(t){super(),this.key=t,this.pid=Vi++,this.deps=new Array}depend(){gi.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function bi(t,e){if(!t||"object"!=typeof t)return;var i;if(!("object"==typeof(i=t)&&Object.keys(i).length>0))return;let n=!1,s=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(s)&&(n=t[s]),!n)return Ii("observe "+s),t[s]=!0,new vi(t,e);Ii("already observe "+s)}const Si={updateBackgroundColor:function(t,e,i){if(yi(e,"backgroundColor"),t&&e&&wi(e)){const i=function(t){let e="#FE3666";return t?/^rgb|^hsl/.test(t)?t:(t.startsWith("#")||(t="#"+t),/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(t)?t:e):e}(e);t.style={backgroundColor:i}}},updateStyle:function(t,e,i){yi(e,"style"),t&&e&&(t.style=e)},updateText:function(t,e,i){if(yi(e,"text"),t&&wi(e)){const i=t.setText;"function"==typeof i&&i.call(t,e)}},updateSrc:function(t,e,i){if(yi(e,"src"),t&&e&&wi(e)){const i=t.setSrc;"function"==typeof i&&i.call(t,e)}}};class xi extends Object{constructor(){super()}tk_observe(t){ui(t)&&(t in this?bi(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}function Li(t,e,i,n,s){if(!ui(t)||!ui(i))return;const a=e.charAt(0).toUpperCase()+e.slice(1),o=Si["update"+a],r=Fi(i),h=null==r?void 0:r.split(".");if(!h)return void yi(h,"tk_bind error, check bind path");const l=h[0],d=Ti(i);if(!d)return void yi(d,"vm_bind get vm error");d.tk_observe(l),new gi(d,r,((e,i)=>{if(s)for(let t=0;t<s.length;t++){s[t].dataCheck(e,r)}o&&o(t,e,i)}),n)}function _i(t,e){const i=Ti(t);if(!ui(i)||!ui(t)||!ui(e))return;const n=Fi(t),s=null==n?void 0:n.split(".");if(!s)return void yi(s,"tk_bind error, check bind path");const a=s[0];i.tk_observe(a),new gi(i,n,((t,i)=>{e&&e(t)}))}function Di(t,e,i){if(!ui(t)||!ui(e)||!ui(i))return;const n=Fi(e),s=null==n?void 0:n.split(".");if(!s)return void yi(s,"tk_bind error, check bind path");const a=s[0];t.tk_observe(a),new gi(t,n,((t,e)=>{i&&i(t)}))}function Fi(t){let e=function(t){if(t)return t.bind_path?t.$bind_path:"string"==typeof t?t:void 0}(t);if(e)return e;yi(e,"tk_bind error, check bind path")}class ki extends TKView{constructor(t,e){super(),this.downloadState=0,this.vm=t,this.showContainer=e,this.setupView(),this.setupAction(),_i(this.vm.$attrsPath.showPopupView,(t=>{console.log("jky KSAdDownloadPopup needShowPopupView: "+t),this.updatePopViewState(t)})),_i(this.vm.$attrsPath.downloadState,(t=>{this.updateControlBtnState(this.vm.isDownloadPaused())})),_i(this.vm.$attrsPath.descText,(t=>{this.desText&&t&&this.desText.setText(t)}))}setupView(){this.style={width:"100%",height:"100%",alignItems:"center",opacity:0,position:"absolute"},this.baseContainer=new TKView,this.baseContainer.style={alignItems:"center",justifyContent:"center",width:245,height:36,top:10,shadow:"0 0 8 #00000099",backgroundColor:"#FFFFFF",borderRadius:120,flexDirection:"row"},this.appendChild(this.baseContainer),this.closeButton=new TKImage,this.closeButton.style={marginStart:10,justifyContent:"center",width:10,height:10},this.closeButton.setSrc("image/ksad-compose-image/ksad_icon_close.png"),this.baseContainer.appendChild(this.closeButton),this.desText=new TKText,this.desText.style={marginStart:10,width:77,fontSize:12,textAlign:"left",includeFontPadding:!1,color:"#222222",fontWeight:"200"},this.desText.setText(this.vm.getDesText()),this.baseContainer.appendChild(this.desText),this.continueButton=new TKText,this.continueButton.style={marginStart:12,width:52,height:20,borderRadius:100,borderWidth:.5,borderColor:"#FE3666",color:"#F66484",fontSize:12,textAlign:"center"},this.updateControlBtnState(!1),this.baseContainer.appendChild(this.continueButton),this.delButton=new TKText,this.delButton.style={marginStart:8,width:52,height:20,borderRadius:100,borderWidth:.5,borderColor:"#4D666666",color:"#666666",fontSize:12,textAlign:"center"},this.delButton.setText("删除"),this.baseContainer.appendChild(this.delButton)}setupAction(){this.baseContainer.addEventListener("tap",(t=>{})),this.closeButton.addEventListener("tap",(t=>{this.vm.onCloseClick(),this.vm.showPopupView=!1})),this.continueButton.addEventListener("tap",(e=>{this.vm.convert(1,1,{x:e.position.rawX,y:e.position.rawY},t.ACTION_BAR_CLICK),this.vm.isNeedShowDownloading()||this.dismissPopup()})),this.delButton.addEventListener("tap",(t=>{var e;e=t=>{Ne.showToast(this.vm.getDeleteToast())},Ne.callNativeWithCallback("cancelAppDownloadForAd",null,e),this.dismissPopup()}))}updatePopViewState(t){console.log("jky updatePopViewState: show: "+t+", isShow: "+this.isShow),t?this.isShow||(this.showContainer.appendChild(this),this.isShow=!0,this.startShowAnimation()):this.isShow&&(this.showContainer.removeChild(this),this.isShow=!1,this.dismissPopup())}updateControlBtnState(t){t?this.continueButton.setText("继续"):this.continueButton.setText("暂停")}startShowAnimation(){this.style={visibility:"visible"};const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={marginTop:48,opacity:0},0),()=>(this.style={marginTop:64,opacity:1},1)]),t.duration=600,t.repeatCount=1,this.addAnimation(t,"popupShowAnimation")}dismissPopup(){const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={opacity:1},0),()=>(this.style={opacity:0},1)]),t.duration=300,t.repeatCount=1,this.addAnimation(t,"popupDismissAnimation"),this.style={visibility:"hidden"}}setMarginTop(t){this.baseContainer.style={top:t}}}class Ri extends TKView{constructor(t,e,i){super();let n=e.adBaseInfo,s="#00000000";3==t?s="#00000019":0!=t&&(s="#00000025"),this.style={height:be(i)?16:i,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",backgroundColor:s,borderRadius:3==t?3:2};let a=3;if(2!=t){let e=null;1==t||3==t?Ie(n.adMarkIcon)&&(e=n.adMarkIcon):Ie(n.adGrayMarkIcon)&&(e=n.adGrayMarkIcon),Ie(e)&&(this.iconView=new TKImage,this.iconView.style={width:12,height:12,marginLeft:3,opacity:3==t?.4:1},a=4,this.appendChild(this.iconView),this.iconView.setSrc(e))}let o="#9C9C9C";0!=t&&(o="#FFFFFF"),this.titleLabel=new TKText,this.titleLabel.style={color:o,minimumTextScaleFactor:.5,fontSize:10,marginLeft:a,marginRight:3,textAlign:"center",includeFontPadding:!1,opacity:3==t?.4:1};let r=n.adSourceDescription;r||(r="广告"),this.titleLabel.setText(r),this.appendChild(this.titleLabel)}setTitleColor(t){this.titleLabel&&(this.titleLabel.style={color:t},this.style={height:16,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",borderRadius:2})}}class Bi extends TKView{}class Ei extends TKView{constructor(){super(),this.style={alignItems:"center",justifyContent:"center"},this.imageView=new TKImage,this.appendChild(this.imageView)}setImageSize(t){this.imageView.style={width:t.width,height:t.height}}setImageSrc(t){ke(this.imageView,t)}setImageSrcAndSize(t,e){this.setImageSize(e),this.setImageSrc(t)}configImage(t){t&&t(this.imageView)}}class Ki extends Bi{constructor(t){super(),this.timerInterval=100,this.totalDuration=1e4,this.timerPaused=!1,this.pageClosed=!1,this.currentTime=0,this.vm=t,this.totalDuration=this.vm.getRewardDuration(),this.setupViews(),this.bindEvent(),this.elementImpression()}templateShowType(){return""}setupViews(){this.closeButton=new Ei,this.closeButton.style={marginRight:12,width:32,height:32,alignSelf:"flex-end",top:0,right:0},this.closeButton.setImageSrcAndSize("image/ksad-video-interact-card/icon_ksad_video_intteract_close.png",{width:32,height:32}),this.appendChild(this.closeButton),this.titleText=new TKText,this.titleText.enabled=!1,this.titleText.style={width:"100%",fontSize:20,color:"#FFF9E5",top:16,textAlign:"center",fontWeight:"medium"},this.titleText.setText(this.vm.getRewardTitle()),this.appendChild(this.titleText)}bindEvent(){this.closeButton.addEventListener("tap",(()=>{this.closePage(1,{interactSuccess:!1})})),this.addGlobalTapEvent(this)}addGlobalTapEvent(t){t.addEventListener("tap",(()=>{this.globalTapAction()}))}globalTapAction(e=!1){let i=new S;i.template_show_type=this.templateShowType(),pi.convertIfNeeded(0,this.vm.adInfo,3,{x:0,y:0},e?t.CARD_SWIPE_CONVERT:t.CARD_PAGE_CLICK,i)}closePage(t,e){this.pageClosed=!0,this.stopLifeTimer(),this.elementClose(t),this.vm.interactSuccess=null==e?void 0:e.interactSuccess,Ne.closePassData(e)}userInteractAction(t){let e=t?this.vm.getAnswerSuccessMsg():this.vm.getAnswerErrorMsg();Ne.showToast(e);let i=t?3:4;this.closePage(i,{interactSuccess:t})}startLifeTimer(){this.notifyLife(0,this.totalDuration,!1);let t=this;this.lifeTimer=setInterval((()=>{t.timerPaused||this.pageClosed||(t.currentTime+=this.timerInterval,t.lifeEnd=t.currentTime==t.totalDuration,t.notifyLife(t.currentTime,t.totalDuration,t.lifeEnd),t.lifeEnd&&t.stopLifeTimer())}),this.timerInterval),this.showAnimation()}stopLifeTimer(){this.lifeTimer&&(clearInterval(this.lifeTimer),this.lifeTimer=0)}showAnimation(){}notifyLife(t,e,i){if(i){if(this.interacting)return;this.closePage(2,{interactSuccess:!1})}}elementImpression(){let t=new S;t.template_show_type=this.templateShowType();let e={elementType:16,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}elementClose(t){let e=new S;e.template_show_type=this.templateShowType();let i={elementType:69,clientExtData:JSON.stringify(e),cardCloseType:t},n={actionType:141,payload:JSON.stringify(i)};Ne.sendLog(n)}}class Pi extends Bi{constructor(t,e){super(),this.answer=t,this.icon=e,this.setupViews()}setupViews(){this.style={overflow:"visible"},this.bgImage=new TKImage,this.bgImage.style={height:"100%",width:"100%",position:"absolute",flexDirection:"row",justifyContent:"center",alignItems:"center"},this.bgImage.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_button.png"),this.appendChild(this.bgImage);let t=new TKView;t.style={width:"94%",height:"100%",paddingHorizontal:8,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.answerLabel=new TKText,this.answerLabel.setText(this.answer),this.answerLabel.style={fontSize:15,color:"#FFFFFF",textAlign:"center",marginLeft:4,height:24,textLineClamp:1,textOverflow:"ellipsis",minimumTextScaleFactor:.7},this.iconImage=new TKImage,this.iconImage.setSrc(this.icon),this.iconImage.style={width:16,height:16},t.appendChild(this.iconImage),t.appendChild(this.answerLabel),this.appendChild(t)}setTips(t){this.answerLabel.setText(t)}performAnswerAnimation(t){let e=(t,e)=>(this.iconImage.style={transform:{rotate:t,scale:{x:2.4,y:2.4}}},e);this.iconImage.style={marginTop:-16},this._performAnswerAnimation("iconAnimationOne",130,[()=>e(0,0),()=>e(-10,.3),()=>e(-20,.54),()=>e(-10,.77),()=>e(0,1)],(()=>{this._performAnswerAnimation("iconAnimationTwo",180,[()=>e(10,.17),()=>e(20,.33),()=>e(10,.5),()=>e(0,.67),()=>e(-10,.83),()=>e(0,1)],(()=>{t()}))})),this.answerLabel.style={marginLeft:14},this.bgImage.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_button_red.png")}_performAnswerAnimation(t,e,i,n){let s=new TKKeyframeAnimation;s.repeatCount=1,s.timingFunction="0.77 0.20 0.56 1.00",s.setAnimations(i),s.duration=e,s.on("end",(t=>{n()})),this.iconImage.addAnimation(s,t)}}class Mi extends Ki{templateShowType(){return"answer"}setupViews(){super.setupViews();let t=new TKView;t.style={width:"100%",height:"100%",top:44,alignItems:"center",borderRadius:8,justifyContent:"flex-start"},this.addGlobalTapEvent(t),this.appendChild(t);let e=new TKView;e.enabled=!1,e.style={width:"100%",height:33,overflow:"hidden",alignItems:"center"},t.appendChild(e);let i=new TKView;i.enabled=!1,i.style={backgroundColor:"#00000066",width:66,height:66,borderRadius:33,overflow:"hidden"},e.appendChild(i);let n=new TKView;n.enabled=!1,n.style={width:"100%",height:66,alignItems:"center",position:"absolute",top:0};let s=new TKView;this.addGlobalTapEvent(s),s.style={backgroundColor:"#00000066",width:311,height:221,justifyContent:"center",alignItems:"center",borderRadius:8,overflow:"visible",opacity:1},t.appendChild(s),t.appendChild(n),this.cicleProgress=new TKCircleProgress,this.cicleProgress.enabled=!1,this.cicleProgress.style={width:50,height:50,marginTop:8,alignItems:"center",overflow:"visible"},n.appendChild(this.cicleProgress),this.numberLabel=new TKText,this.numberLabel.enabled=!1,this.numberLabel.style={width:"100%",height:22,fontSize:20,color:"#FFFFFF",textAlign:"center",position:"absolute",alignItems:"center",top:0,marginTop:22},n.appendChild(this.numberLabel),this.answerTitle=new TKText,this.answerTitle.enabled=!1,this.answerTitle.style={width:"100%",fontSize:16,color:"#FFFFFF",textAlign:"center",fontWeight:"medium",marginTop:20},this.answerTitle.setText(this.vm.getRewardSubTitle()),s.appendChild(this.answerTitle),this.rightAnswerButton=new Pi(this.vm.getRewardRightAnswer(),"image/ksad-video-interact-card/icon_ksad_video_interact_right.png"),this.rightAnswerButton.style={height:48,width:236,marginTop:20,flexDirection:"row",justifyContent:"center",alignItems:"center"},s.appendChild(this.rightAnswerButton),this.errorAnswerButton=new Pi(this.vm.getRewardErrorAnswer(),"image/ksad-video-interact-card/icon_ksad_video_interact_error.png"),this.errorAnswerButton.style={height:48,width:236,marginTop:16,flexDirection:"row",justifyContent:"center",alignItems:"center"},s.appendChild(this.errorAnswerButton),this.handGuide=new TKImage,this.handGuide.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_hand.png"),this.handGuide.enabled=!1,this.handGuide.style={width:81,height:70,position:"absolute",top:106,left:156,transform:{scale:1.2}},s.appendChild(this.handGuide),this.addHandAnimation()}addHandAnimation(){let t=new TKKeyframeAnimation;t.repeatCount=Number.MAX_SAFE_INTEGER,t.timingFunction="0.77 0.20 0.56 1.00",t.setAnimations([()=>(this.handGuide.style={transform:{scale:1.2}},0),()=>(this.handGuide.style={transform:{scale:1}},.56),()=>(this.handGuide.style={transform:{scale:1.2}},1)]),t.duration=1080,this.handGuide.addAnimation(t,"HandGuide")}bindEvent(){super.bindEvent(),this.rightAnswerButton.addEventListener("tap",(t=>{this.hidenHandGuide(),this.rightAnswerButton.setTips("回答正确!"),this.rightAnswerButton.performAnswerAnimation((()=>{setTimeout((()=>{this.userInteractAction(!0)}),100)}))})),this.errorAnswerButton.addEventListener("tap",(t=>{this.hidenHandGuide(),this.rightAnswerButton.setTips("回答错误!"),this.errorAnswerButton.performAnswerAnimation((()=>{setTimeout((()=>{this.userInteractAction(!1)}),100)}))}))}hidenHandGuide(){this.handGuide.removeAnimation("HandGuide"),this.handGuide.style={visibility:"hidden"}}notifyLife(t,e,i){let n=((e-t)/1e3).toFixed();this.cicleProgress.updateProgress(t/e),this.numberLabel.setText(n),super.notifyLife(t,e,i)}}class Oi extends Ki{constructor(){super(...arguments),this.bottomBgColor="90,#ff0000,#00ff00"}templateShowType(){return"puzzle"}setupViews(){super.setupViews(),this.style={overflow:"hidden"},this.viewAnimationSize=Pe.isAndroid()?240:235;const t=new TKView;t.style={width:300,height:"100%",marginTop:40},this.appendChild(t);const e=new TKView;e.enabled=!0,e.style={width:240,height:240,left:30,justifyContent:"flex-start",alignContent:"center"},t.appendChild(e);let i=new TKImage;i.style={width:"100%",height:"100%",backgroundColor:"#ffffff",borderRadius:46},i.setSrc(this.vm.getIconUrl()),e.appendChild(i);let n=new TKImage;n.style={position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:46},n.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_puzzle_mask.png"),e.appendChild(n),this.smallPuzzle=new TKView,this.smallPuzzle.style={width:80,height:80,bottomRightRadius:46,transform:{scale:.85,rotate:-10},alignSelf:"center",marginTop:30,marginLeft:20,overflow:"hidden",borderWidth:3,borderColor:"#FFFFFF00"},t.appendChild(this.smallPuzzle),this.puzzleViewTemp=new TKImage,this.puzzleViewTemp.style={width:240,height:240,borderRadius:46,transform:{scale:.85},position:"absolute",right:0,bottom:0},this.puzzleViewTemp.setSrc(this.vm.getIconUrl()),this.smallPuzzle.appendChild(this.puzzleViewTemp),this.smallMark=new TKImage,this.smallMark.style={width:this.viewAnimationSize,height:this.viewAnimationSize,borderRadius:46,transform:{scale:.85},right:0,bottom:0,position:"absolute",visibility:"hidden"},this.smallMark.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_puzzle_mask_tmp.png"),this.smallPuzzle.appendChild(this.smallMark),this.smallPuzzle.addEventListener("swipe",(t=>{this.interacting=!0,this.addConvertAnimation()})),this.smallPuzzle.addEventListener("tap",(t=>{this.interacting=!0,this.addConvertAnimation()})),e.addEventListener("tap",(t=>{})),this.handGuide=new TKImage,this.handGuide.enabled=!0,this.handGuide.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_hand.png"),this.handGuide.enabled=!1,this.handGuide.style={width:60,height:55,position:"absolute",top:300,left:160,transform:{scale:1}},t.appendChild(this.handGuide),this.handGuide.addEventListener("tap",(t=>{})),this.handGuideGradientRoot=new TKView,this.handGuideGradientRoot.enabled=!0,this.handGuideGradientRoot.style={position:"absolute",width:24,height:120,transform:{rotate:35},top:300,left:160,overflow:"hidden"},t.appendChild(this.handGuideGradientRoot),this.handGuideGradient=new TKView,Pe.isAndroid()?this.handGuideGradient.style={position:"absolute",width:24,height:120,bottom:0,right:0,gradientBgColor:"270, #FFFFFF80 0.4, #FFFFFF00 1"}:this.handGuideGradient.style={position:"absolute",width:24,height:120,top:0,left:0,gradientBgColor:"270, #FFFFFF80 0.4, #FFFFFF00 1"},this.handGuideGradientRoot.addEventListener("tap",(t=>{})),this.handGuideGradientRoot.appendChild(this.handGuideGradient)}showAnimation(){this.addHandAnimation(),this.timer=setInterval((()=>{this.addHandAnimation()}),1080)}addConvertAnimation(){this.hidenHandGuide();let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.smallPuzzle.style={transform:{translate:{x:0,y:0},scale:.85,rotate:-10}},this.puzzleViewTemp.style={transform:{scale:.85}},this.smallMark.style={visibility:"visible",width:this.viewAnimationSize,height:this.viewAnimationSize,transform:{scale:.85}},.01),()=>(this.smallPuzzle.style={transform:{translate:{x:70,y:-110},scale:1,rotate:0}},this.puzzleViewTemp.style={transform:{scale:1}},this.smallMark.style={width:this.viewAnimationSize,height:this.viewAnimationSize,transform:{scale:1}},1)]),t.duration=500,t.on("end",(()=>{setTimeout((()=>{this.userInteractAction(!0)}),100)})),this.smallPuzzle.addAnimation(t,"addConvertAnimation")}hidenHandGuide(){this.handGuide.removeAnimation("HandGuide"),this.handGuide.style={visibility:"hidden"},this.handGuideGradientRoot.removeAnimation("handGuideGradient"),this.handGuideGradientRoot.style={visibility:"hidden"},this.onDismiss()}addHandAnimation(){this.handGuide.removeAllAnimation(),this.handGuideGradientRoot.removeAllAnimation();let t=new TKKeyframeAnimation;this.handGuide.style={transform:{translate:{x:0,y:0},scale:1.2}},t.setAnimations([()=>(this.handGuide.style={transform:{scale:1.2}},0),()=>(this.handGuide.style={transform:{translate:{x:60,y:-100},scale:1.2}},1)]),t.duration=1080,this.handGuide.addAnimation(t,"HandGuide");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.handGuideGradientRoot.style={height:0,top:300,left:160,position:"absolute"},0),()=>(this.handGuideGradientRoot.style={height:115,top:200,left:195,position:"absolute"},1)]),e.duration=1080,this.handGuideGradientRoot.addAnimation(e,"handGuideGradient")}closePage(t,e){super.closePage(t,e),this.onDismiss()}onDismiss(){this.timer&&clearInterval(this.timer),this.handGuide.removeAllAnimation(),this.handGuideGradientRoot.removeAllAnimation()}}class Ni extends Ki{constructor(){super(...arguments),this.beginTime=-1,this.longPressValidDuration=5,this.success=!1,this.flag=!1,this.pressNumber=0}templateShowType(){return"red_packet"}setupViews(){super.setupViews(),this.longPressValidDuration=this.vm.getRedbagLongPressDuraion();let t=new TKView;this.style={overflow:"visible"},this.addGlobalTapEvent(t),t.style={width:120,height:140,marginTop:40,overflow:"visible"},this.appendChild(t),this.redbag=new TKImage,this.redbag.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_redbag.png"),this.redbag.style={width:80,height:96},this.redbag.addEventListener("tap",(t=>{})),t.appendChild(this.redbag),this.handGuide=new TKImage,this.handGuide.setSrc("image/ksad-video-interact-card/icon_ksad_video_interact_hand.png"),this.handGuide.enabled=!1,this.handGuide.style={width:60,height:55,position:"absolute",top:75,left:35,transform:{scale:1.2}},t.appendChild(this.handGuide),this.addHandAnimation()}bindEvent(){super.bindEvent(),this.redbag.addEventListener("down",(t=>{this.beginTime=0,this.interacting=!0})),this.redbag.addEventListener("longPress",(t=>{-1!=this.beginTime&&(this.flag||0==this.beginTime&&(this.beginTime=t.timestamp,this.hidenHandGuide(),this.redbagLargeAnimation(),this.flag=!0,this.startPressTimer()))})),this.redbag.addEventListener("up",(t=>{if(this.stopPressTimer(),0!=this.beginTime&&-1!=this.beginTime){if(!this.success)return void this.userInteractAction(!1);this.removeRedbagLargeAnimation()}this.beginTime=-1,this.interacting=!1}))}startPressTimer(){this.stopPressTimer(),this.pressTimer=setInterval((()=>{this.pressNumber++,.5*this.pressNumber>=this.longPressValidDuration&&!this.success&&(this.success=!0,this.stopPressTimer(),this.userInteractAction(!0))}),500)}stopPressTimer(){this.pressNumber=0,this.pressTimer&&clearInterval(this.pressTimer),this.pressTimer=0}hidenHandGuide(){this.handGuide.style={transform:{scale:1}},this.handGuide.removeAnimation("HandGuide")}addHandAnimation(){let t=new TKKeyframeAnimation;t.repeatCount=Number.MAX_SAFE_INTEGER,t.timingFunction="0.77 0.20 0.56 1.00",t.setAnimations([()=>(this.handGuide.style={transform:{scale:1.2}},0),()=>(this.handGuide.style={transform:{scale:1}},.56),()=>(this.handGuide.style={transform:{scale:1.2}},1)]),t.duration=1080,this.handGuide.addAnimation(t,"HandGuide")}redbagLargeAnimation(){let t=new TKBasicAnimation;t.repeatCount=1,t.setStartValue((()=>{this.redbag.style={transform:{scale:1}}}));let e=1+.09*this.longPressValidDuration;t.setEndValue((()=>{this.redbag.style={transform:{scale:e,translate:{y:10}}}})),t.duration=1e3*this.longPressValidDuration,this.redbag.addAnimation(t,"redBagAnimation");let i=new TKBasicAnimation;i.repeatCount=1,i.setStartValue((()=>{this.handGuide.style={transform:{scale:1}}})),i.setEndValue((()=>{this.handGuide.style={transform:{scale:1,translate:{y:10}}}})),i.duration=1e3*this.longPressValidDuration,this.handGuide.addAnimation(i,"redBagAnimation")}removeRedbagLargeAnimation(){this.redbag.removeAnimation("redBagAnimation"),this.redbag.style={transform:{scale:1}}}}class Hi extends Bi{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.bindEvent(),this.setupData())}setupData(){Di(this.vm,this.vm.$attrsPath.playPaused,(t=>{this.interactView&&(this.interactView.timerPaused=t)}))}setupViews(){this.style={gradientBgColor:"270, #00000099 0.5, #00000066 0.75, #00000000 1",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center"},this.touchContainer=new TKView,this.touchContainer.style={position:"absolute",top:0,left:0,right:0,bottom:120},this.appendChild(this.touchContainer);let t=0;switch(this.vm.getInteracrStyle()){case 1:t=460,this.interactView=new Oi(this.vm);break;case 2:t=414,this.interactView=new Mi(this.vm);break;default:t=231,this.interactView=new Ni(this.vm)}this.interactView.style={width:"100%",height:t,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(this.interactView)}startLifeTimer(){this.interactView&&this.interactView.startLifeTimer()}bindEvent(){this.touchContainer.addEventListener("tap",(()=>{this.interactView.globalTapAction()})),this.touchContainer.addEventListener("swipe",(()=>{this.interactView.globalTapAction(!0)}))}}function Wi(t,e,i){const n=new TKKeyframeAnimation;n.setAnimations([()=>(e.style={transform:{rotate:{z:0}}},0),()=>(e.style={transform:{rotate:{z:4}}},.1),()=>(e.style={transform:{rotate:{z:-4}}},.2),()=>(e.style={transform:{rotate:{z:-4}}},.3),()=>(e.style={transform:{rotate:{z:4}}},.4),()=>(e.style={transform:{rotate:{z:2.5}}},.5),()=>(e.style={transform:{rotate:{z:-2.5}}},.55),()=>(e.style={transform:{rotate:{z:-1}}},.6),()=>(e.style={transform:{rotate:{z:1}}},.68),()=>(e.style={transform:{rotate:{z:0}}},.76),()=>(e.style={transform:{rotate:{z:0}}},1)]),n.duration=t,n.on("end",(t=>{i()})),e.addAnimation(n,"anim")}function zi(t,e){const i=new TKBasicAnimation;return i.duration=t,i.timingFunction="Linear",i.animValue={position:{x:e,y:0,z:0}},i}function Ui(t,e,i,n,s=!1){const a=new TKKeyframeAnimation;return s?(a.setAnimations([()=>(t.style={transform:{scale:e}},.5),()=>(t.style={transform:{scale:1}},1)]),a.timingFunction="EaseInEaseOut"):(a.animType="scale",a.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:.33,value:e,easing:"EaseInEaseOut"},{percent:.66,value:1/e,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}]),a.duration=i,a.repeatCount=n,a}function Gi(t,e,i=!1){const n=new TKKeyframeAnimation;return i?(n.setAnimations([()=>(t.style={opacity:1},1)]),n.timingFunction="ease-in-out"):(n.animType="opacity",n.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}]),n.duration=e,n}function ji(t,e,i=!1){const n=new TKKeyframeAnimation;return i?(n.setAnimations([()=>(t.style={opacity:0},1)]),n.timingFunction="ease-in-out"):(n.animType="opacity",n.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}]),n.duration=e,n}class Yi extends TKView{constructor(t){super(),this.columnNum=3,this.traveViews=[],this.iconImages=[],this.iconDefaultSize={width:150,height:150},this.hasAnimedView=new Array(9),this.currentIntervalTime=0,this.animedCount=0,this.timer=0,this.hasShow=!1,this.vm=t,this.pendantRowDelay=0,this.rowNum=this.vm.getRowNum(),this.vm.checkParam()&&(this.style={width:"100%",height:"100%"},this.throughHitTest=!0,this.createTravelView(),this.createRedPacketInTravel())}createTravelView(){this.traveViews=[];for(let t=0;t<this.columnNum;t++){let e=new TKView;e.style={width:this.iconDefaultSize.width,height:this.vm.containerSize.height+this.iconDefaultSize.height+30,position:"absolute",left:this.getLeftMagin(t),alignItems:"center",top:-this.iconDefaultSize.height},e.throughHitTest=!0,this.appendChild(e),this.traveViews.push(e)}}getLeftMagin(t){let e=this.vm.containerSize.width/this.columnNum,i=this.iconDefaultSize.width-e;return 0==t?0:1==t?e-i/2:this.vm.containerSize.width-this.iconDefaultSize.width}createRedPacketInTravel(){this.iconImages=[];for(let t=0;t<this.columnNum;t++)for(let e=0;e<this.rowNum;e++){let i=this.createIconImage(e,t);this.iconImages[t*this.rowNum+e]=i,this.traveViews[t].appendChild(i)}}createIconImage(e,i){let n=new TKImage,s=this.vm.getScaleType(e,i);if(n.style={width:this.iconDefaultSize.width*s,height:this.iconDefaultSize.height*s,position:"absolute",top:0},this.vm.isCanClick()){let e=this;n.addEventListener("tap",(i=>{const s=Te(i,n);this.vm.convert(2,s,t.FALL_ICON_CLICK),e.hide(!0)}))}else n.addEventListener("tap",(t=>{}));return n.setSrc(this.vm.getRedPacketIconUrl()),n}createIconAnimation(t,e){const i=1e3*this.vm.getShowTime(t),n=new TKKeyframeAnimation;let s=this;n.timingFunction="linear",n.setAnimations([()=>(e.style={top:0},0),()=>(e.style={top:s.vm.containerSize.height+s.iconDefaultSize.height+30},1)]),t==this.vm.getLastAnimIconIndex()&&n.on("end",(()=>{s.hide()})),n.duration=i;let a="translateAnimation"+t.toString();if(e.addAnimation(n,a),this.vm.isCanShowRotateAnim(t)&&setTimeout((()=>{this.startRotateAnimation(e)}),this.vm.getRotateAnimDelayTime(t)),2==this.vm.getAnimType()){const t=new TKKeyframeAnimation;t.timingFunction="ease-in",t.setAnimations([()=>(e.style={opacity:1},.5),()=>(e.style={opacity:.5},.75),()=>(e.style={opacity:0},1)]),t.duration=.6*i,e.addAnimation(t,"opacityAnimation")}}startRotateAnimation(t){const e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={transform:{rotate:{z:0}}},0),()=>(t.style={transform:{rotate:{z:-25}}},.2),()=>(t.style={transform:{rotate:{z:25}}},.4),()=>(t.style={transform:{rotate:{z:-21}}},.6),()=>(t.style={transform:{rotate:{z:21}}},.8),()=>(t.style={transform:{rotate:{z:0}}},1)]),e.duration=1500,t.addAnimation(e,"rotateAnim")}show(){this.vm.isParamValid()&&(this.hasShow||(this.hasShow=!0,this.vm.reportRedPacketImpression(),this.showRedPacketIconWithAnim()))}hide(t=!1){const e=this;setTimeout((()=>{e.removeAllAnimation(),e.removeAll(),e.vm.dismissCallbackOnlyOnce()}),t?100:0)}showRedPacketIconWithAnim(){this.tryShowAnim(),this.timer=setInterval((()=>{this.currentIntervalTime+=this.vm.getAnimMinTime(),this.tryShowAnim()}),this.vm.getAnimMinTime())}tryShowAnim(){if(this.animedCount!=this.vm.getAnimedCount()){for(let t=0;t<this.vm.getAnimedCount();t++)if(!this.hasAnimedView[t]&&this.currentIntervalTime==this.vm.getIconDelayTime(t)){this.hasAnimedView[t]=!0;let e=this.iconImages[t];this.createIconAnimation(t,e),this.animedCount=this.animedCount+1}}else this.timer&&clearInterval(this.timer)}}class Xi extends TKView{constructor(t){super(),this.animationAllowed=!0,this.vm=t,this.setupView(),this.setupData(),this.setupAction(),this.startShowAnimation()}setupView(){this.throughHitTest=!0,this.style={alignItems:"flex-start",width:this.vm.getPendantSize().width,height:this.vm.getPendantSize().height},this.contentView=new TKView,this.contentView.style={justifyContent:"center",alignItems:"center"},this.appendChild(this.contentView),this.pendantTitle=new TKText,this.pendantTitle.style={top:0,marginLeft:this.vm.getPendantTitleMarginLR(),marginRight:this.vm.getPendantTitleMarginLR(),fontSize:this.vm.getPendantTitleFontSize(),color:"#FFFFFF",fontWeight:"bold",textAlign:"center",textLineHeight:20,opacity:0},this.contentView.appendChild(this.pendantTitle),this.pendantImage=new TKImage,this.pendantImage.style={width:this.vm.getPendantImageWH(),height:this.vm.getPendantImageWH(),opacity:0},this.contentView.appendChild(this.pendantImage),this.guidanceImage=new TKImage,this.guidanceImage.style={marginTop:this.vm.getGuidanceImageMarginTop(),marginLeft:this.vm.getGuidanceImageMarginLeft(),height:this.vm.getGuidanceImageWH(),width:this.vm.getGuidanceImageWH(),opacity:0},this.appendChild(this.guidanceImage)}setupData(){this.pendantTitle.setText(this.vm.getPendantTitleText()),this.pendantImage.setSrc(this.vm.getPendantImageUrl()),ke(this.guidanceImage,"icon_ksad_hand_touch_guide.png")}setupAction(){const t=this;this.pendantImage&&this.vm.enableClickPendant()&&this.pendantImage.addEventListener("tap",(e=>{t.startHideAnimation(),this.vm.enableShowPendantClickAnim()?t.startClickAnimShowAnimation(e):t.vm.reportPendantClick(e)}))}startShowAnimation(){const t=this;this.startPendantImageShowAnimation((()=>{setTimeout((()=>{t.startPendantTitleShowAnimation((()=>{t.startGuidanceImageShowAnimation()}))}),500)})),this.vm.reportPendantImpression()}startPendantImageShowAnimation(t){const e=this,i=new TKKeyframeAnimation;i.setAnimations([()=>(e.pendantImage.style={transform:{scale:.6},opacity:0},0),()=>(e.pendantImage.style={transform:{scale:1},opacity:1},.56),()=>(e.pendantImage.style={transform:{scale:.9}},.78),()=>(e.pendantImage.style={transform:{scale:1}},1)]),i.timingFunction="ease-out",i.duration=700,i.on("end",(()=>{t&&t()})),this.pendantImage.addAnimation(i,"pendantImageShowAnimation")}startPendantTitleShowAnimation(t){const e=this,i=new TKKeyframeAnimation;i.setAnimations([()=>(e.pendantTitle.style={top:10,opacity:0},0),()=>(e.pendantTitle.style={top:0,opacity:1},1)]),i.timingFunction="ease-out",i.duration=300,i.on("end",(()=>{t&&t()})),this.pendantTitle.addAnimation(i,"pendantTitleShowAnimation")}stopActionAnimation(){this.animationAllowed=!1,this.guidanceImage&&this.guidanceImage.removeAllAnimation()}startGuidanceImageShowAnimation(){if(!this.vm.enableShowGuidanceImage())return;if(!this.animationAllowed)return!1;const t=Gi(this.guidanceImage,200,!0);this.guidanceImage.addAnimation(t,"guidanceImageShowAnimation");const e=this;t.on("end",(()=>{e.startGuidanceImageMoveAnimation()}))}restartGuidanceImageMoveAnimationIfNeeded(){this.vm.enableShowGuidanceImage()&&(this.guidanceImage.removeAllAnimation(),this.startGuidanceImageMoveAnimation())}startGuidanceImageMoveAnimation(){const t=this;let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.guidanceImage.style={transform:{translate:{x:0,y:0}}},.33),()=>(t.guidanceImage.style={transform:{translate:{x:10,y:10}}},.66),()=>(t.guidanceImage.style={transform:{translate:{x:0,y:0}}},1)]),e.duration=450,e.repeatCount=Number.MAX_SAFE_INTEGER,e.timingFunction="linear",this.guidanceImage.addAnimation(e,"guidanceImageMoveAnimation")}startHideAnimation(){this.startPendantImageHideAnimation();const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.addAnimation(e,"pendantHideAnimation")}startPendantImageHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.pendantImage.style={transform:{scale:.8}},1)]),e.timingFunction="ease-out",e.duration=300,this.pendantImage.addAnimation(e,"pendantImageHideAnimation")}createPendantClickAnimViewIfNeeded(t){this.vm.enableShowPendantClickAnim()&&(this.pendantClickAnimView=new Yi(this.vm.pendantAnimViewModel),this.pendantClickAnimView.style={position:"absolute"},t.appendChild(this.pendantClickAnimView))}removePendantClickAnimViewIfNeeded(t){this.pendantClickAnimView&&t.removeChild(this.pendantClickAnimView)}startClickAnimShowAnimation(t){if(!this.pendantClickAnimView)return;this.pendantClickAnimView.show();const e=this;this.expireTimer=setTimeout((()=>{e.startClickAnimHideAnimation(),e.vm.reportPendantClick(t)}),this.vm.getPendantClickAnimDuration())}startClickAnimHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.pendantClickAnimView.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.pendantClickAnimView.addAnimation(e,"pendantClickAnimHideAnimation")}clearTimeoutIfConverted(){this.expireTimer&&clearTimeout(this.expireTimer)}}class Ji extends TKView{constructor(t,e){super(),this.vm=t,this.screenWidth=this.vm.callerContext.containerLimit.width,this.screenHeight=this.vm.callerContext.containerLimit.height,this.nextAnim=e,this.setupViews(),this.setupActions()}setupViews(){this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0},this.throughHitTest=!0,this.setupPreHeatView(),setTimeout((()=>{this.vm.enableCountDown()?this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleCountDownAnimation())}),Ji.NEO_PREHEAT_ANIMATION_SPEED):this.vm.isSplash()?this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleDisappearAnimation(Ji.SPLASH_PREHEAT_ANIMATION_SPEED))}),Ji.SPLASH_PREHEAT_ANIMATION_SPEED):this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleDisappearAnimation(Ji.INTERSTITIAL_PREHEAT_ANIMATION_SPEED))}),Ji.INTERSTITIAL_PREHEAT_ANIMATION_SPEED)}),200)}setupPreHeatView(){this.preHeatView=new TKView,this.preHeatView.throughHitTest=!0,this.preHeatView.style={width:"100%",height:"100%",top:0,alignSelf:"center",flexDirection:"column",alignItems:"center"},this.appendChild(this.preHeatView),this.preHeatBubbleRedPacketView=new TKView,this.preHeatBubbleRedPacketView.throughHitTest=!0,this.preHeatBubbleRedPacketView.style={position:"absolute",width:"100%",height:"100%",top:0,opacity:0},this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.preHeatRedPacketView=new TKView,this.preHeatRedPacketView.style={position:"absolute",width:this.screenAdaptate(270),height:this.screenAdaptate(270),top:(this.screenHeight-this.screenAdaptate(270)-38)/2,alignSelf:"center"},this.preHeatBubbleRedPacketView.appendChild(this.preHeatRedPacketView);let t=this.vm.getIndustryTopIcon();this.preHeatRedPacket=new TKImage,be(t)?(this.preHeatRedPacket.style={position:"absolute",width:this.screenAdaptate(132),height:this.screenAdaptate(132),top:this.screenAdaptate(69),alignSelf:"center"},ke(this.preHeatRedPacket,"image/BubbleRainResources/icon_ksad_bubble_rain_red_packet.png"),this.preHeatRedPacketView.appendChild(this.preHeatRedPacket),this.setupSubView(Ji.LOGO_DISTANCE_WITHOUT_IP,Ji.NUMBER_DISTANCE_WITHOUT_IP)):(this.preHeatRedPacket.style={position:"absolute",width:this.screenAdaptate(132),height:this.screenAdaptate(172),top:this.screenAdaptate(46),alignSelf:"center"},ke(this.preHeatRedPacket,t),this.preHeatRedPacketView.appendChild(this.preHeatRedPacket),this.setupSubView(Ji.LOGO_DISTANCE_WITH_IP,Ji.NUMBER_DISTANCE_WITH_IP)),this.preHeatBubble=new TKImage,this.preHeatBubble.style={position:"absolute",width:this.screenAdaptate(270),height:this.screenAdaptate(270),top:(this.screenHeight-this.screenAdaptate(270)-38)/2,alignSelf:"center"},ke(this.preHeatBubble,"image/BubbleRainResources/icon_ksad_bubble_rain_bubble.png"),this.preHeatBubbleRedPacketView.appendChild(this.preHeatBubble),this.preHeatDescView=new TKView,this.preHeatDescView.style={position:"absolute",width:202,height:38,top:(this.screenHeight+this.screenAdaptate(270)-38)/2,alignItems:"center"},this.preHeatView.appendChild(this.preHeatDescView),this.preHeatDescTextBackground=new TKView,this.preHeatDescTextBackground.style={width:202,height:38,borderRadius:20,gradientBgColor:"270, #FFF9EB, #B8976A, #DBC3A7"},this.preHeatDescView.appendChild(this.preHeatDescTextBackground),this.preHeatDescText=new TKText,this.preHeatDescText.style={position:"absolute",width:198,height:34,top:2,fontSize:16,color:"#FFFFFF",textLineHeight:22,borderRadius:20,textAlign:"center",fontWeight:"500",shadow:"0 1 3 #00000025",backgroundColor:"#FC4118"};let e=this.vm.getBubbleActionDes();be(e)&&(e="立即开启大促"),this.preHeatDescText.text=e,this.preHeatDescView.appendChild(this.preHeatDescText)}setupSubView(t,e){let i=this.vm.getRedPacketIndustryIcon();be(i)&&(i=""),this.preHeatLogo=new TKImage,this.preHeatLogo.style={position:"absolute",width:this.screenAdaptate(86),height:this.screenAdaptate(38),top:this.screenAdaptate(147+t),left:this.screenAdaptate(94)},Be(this.preHeatLogo,i,500,(t=>{t||this.preHeatLogo.setVisibility("hidden")})),this.preHeatRedPacketView.appendChild(this.preHeatLogo),this.preHeatNumber3=new TKImage,this.preHeatNumber3.style={position:"absolute",width:this.screenAdaptate(24),height:this.screenAdaptate(34),top:this.screenAdaptate(146+e),left:this.screenAdaptate(122),opacity:0},ke(this.preHeatNumber3,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number3.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber3),this.preHeatNumber2=new TKImage,this.preHeatNumber2.style={position:"absolute",width:this.screenAdaptate(24),height:this.screenAdaptate(34),top:this.screenAdaptate(146+e),left:this.screenAdaptate(123),opacity:0},ke(this.preHeatNumber2,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number2.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber2),this.preHeatNumber1=new TKImage,this.preHeatNumber1.style={position:"absolute",width:this.screenAdaptate(14),height:this.screenAdaptate(35),top:this.screenAdaptate(146+e),left:this.screenAdaptate(127),opacity:0},ke(this.preHeatNumber1,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number1.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber1)}setBubbleAppearAnimation(t,e){let i=new TKKeyframeAnimation;ye()?i.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:.13,translate:{x:0,y:154,z:0},rotate:{x:0,y:180,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]):i.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.037,y:.13},translate:{x:0,y:154,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),i.duration=400*e,i.timingFunction="0.0 0.0 0.0 1.0";let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.985,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),n.duration=200*e,n.timingFunction="0.0 0.0 0.56 1.0";let s=new TKKeyframeAnimation;s.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.985,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),s.duration=250*e,s.timingFunction="linear",s.on("end",t),n.on("end",(()=>{this.vm.isShowEnd||this.preHeatBubbleRedPacketView.addAnimation(s,"bubbleAppearAnimation3")})),i.on("end",(()=>{this.vm.isShowEnd||this.preHeatBubbleRedPacketView.addAnimation(n,"bubbleAppearAnimation2")})),this.preHeatBubbleRedPacketView.addAnimation(i,"bubbleAppearAnimation1")}setBubbleCountDownAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.preHeatLogo.style={opacity:1},.001),()=>(this.preHeatLogo.style={opacity:0},1)]),t.duration=500,t.timingFunction="0.0 0.0 0.38 0.99",this.preHeatLogo.addAnimation(t,"logoAnimation");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.preHeatNumber3.style={opacity:0},.001),()=>(this.preHeatNumber3.style={opacity:1},5/7),()=>(this.preHeatNumber3.style={opacity:0},1)]),e.duration=700,e.timingFunction="0.0 0.0 0.38 0.99";let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.preHeatNumber2.style={opacity:0},.001),()=>(this.preHeatNumber2.style={opacity:1},5/7),()=>(this.preHeatNumber2.style={opacity:0},1)]),i.duration=700,i.timingFunction="0.0 0.0 0.38 0.99";let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatNumber1.style={opacity:0},.001),()=>(this.preHeatNumber1.style={opacity:1},1)]),n.duration=500,n.timingFunction="0.0 0.0 0.38 0.99",n.on("end",(()=>{this.vm.isShowEnd||this.setBubbleDisappearAnimation(Ji.NEO_PREHEAT_ANIMATION_SPEED)})),i.on("end",(()=>{this.vm.isShowEnd||this.preHeatNumber1.addAnimation(n,"number1Animation")})),e.on("end",(()=>{this.vm.isShowEnd||this.preHeatNumber2.addAnimation(i,"number2Animation")})),this.preHeatNumber3.addAnimation(e,"number3Animation")}setBubbleDisappearAnimation(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.preHeatDescView.style={opacity:1},.001),()=>(this.preHeatDescView.style={opacity:0},1)]),e.duration=1e3*t,e.timingFunction="0.42 0.0 0.58 1.0",this.preHeatDescView.addAnimation(e,"buttonDisappearAnimation");let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.preHeatBubble.style={transform:{scale:1,translate:{y:0}},opacity:1},.001),()=>(this.preHeatBubble.style={transform:{scale:9.47,translate:{y:250}},opacity:0},1)]),i.duration=1e3*t,i.timingFunction="0.42 0.0 0.58 1.0",this.preHeatBubble.addAnimation(i,"bubbleDisappearAnimation");let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatRedPacketView.style={transform:{scale:1,translate:{y:0}}},.001),()=>(this.preHeatRedPacketView.style={transform:{scale:7.4,translate:{y:550}}},1)]),n.duration=1e3*t,n.timingFunction="0.42 0.0 0.58 1.0",this.preHeatRedPacketView.addAnimation(n,"redPacketEnlargeAnimation");let s=new TKKeyframeAnimation;s.setAnimations([()=>(this.preHeatRedPacketView.style={opacity:1},.001),()=>(this.preHeatRedPacketView.style={opacity:0},1)]),s.duration=1e3*t,s.on("end",(()=>{this.vm.isShowEnd||(this.nextAnim(),this.stopAllAnimation())})),this.preHeatRedPacketView.addAnimation(s,"redPacketDisappearAnimation")}setupActions(){let e=new S;e.template_show_type="bubble_id_click",this.preHeatDescText.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.BUBBLE_RAIN_CLICK,e)})),this.preHeatDescView.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.BUBBLE_RAIN_CLICK,e)})),this.preHeatBubble.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.BUBBLE_RAIN_CLICK,e)}))}stopAllAnimation(){this.preHeatBubbleRedPacketView&&this.preHeatBubbleRedPacketView.removeAllAnimation(),this.preHeatLogo&&this.preHeatLogo.removeAllAnimation(),this.preHeatNumber1&&this.preHeatNumber1.removeAllAnimation(),this.preHeatNumber2&&this.preHeatNumber2.removeAllAnimation(),this.preHeatNumber3&&this.preHeatNumber3.removeAllAnimation(),this.preHeatDescView&&this.preHeatDescView.removeAllAnimation(),this.preHeatBubble&&this.preHeatBubble.removeAllAnimation(),this.preHeatRedPacketView&&this.preHeatRedPacketView.removeAllAnimation(),this.removeAll()}screenAdaptate(t){return t*this.screenWidth/414}}Ji.LOGO_DISTANCE_WITH_IP=17,Ji.LOGO_DISTANCE_WITHOUT_IP=0,Ji.NUMBER_DISTANCE_WITH_IP=17,Ji.NUMBER_DISTANCE_WITHOUT_IP=0,Ji.SPLASH_PREHEAT_ANIMATION_SPEED=.5,Ji.NEO_PREHEAT_ANIMATION_SPEED=1,Ji.INTERSTITIAL_PREHEAT_ANIMATION_SPEED=1;class $i{getStartTime(){return this.startTime}setStartTime(t){this.startTime=t}}class qi extends $i{constructor(t,e){super(),this.alpha=t,this.setStartTime(e)}getAplha(){return this.alpha}setAlpha(t){this.alpha=t}}class Zi extends $i{getAplha(){return this.alpha}setAlpha(t){this.alpha=t}getRotationZ(){return this.rotationZ}getRotationX(){return this.rotationX}getRotationY(){return this.rotationY}setRotationX(t){this.rotationX=t}setRotationY(t){this.rotationY=t}setRotationZ(t){this.rotationZ=t}getScaleX(){return this.scaleX}setScaleX(t){this.scaleX=t}getScaleY(){return this.scaleY}setScaleY(t){this.scaleY=t}getTranslationX(){return this.translationX}setTranslationX(t){this.translationX=t}getTranslationY(){return this.translationY}setTranslationY(t){this.translationY=t}toString(){return"{alpha :"+this.alpha+" + rotationX :"+this.rotationX+" + rotationY :"+this.rotationY+" + rotationZ :"+this.rotationZ+" + scaleX :"+this.scaleX+" + scaleY :"+this.scaleY+" + translationX :"+this.translationX+" + translationY :"+this.translationY+"}"}}class Qi extends $i{constructor(t,e,i,n){super(),this.rotationX=void 0,this.rotationY=void 0,this.rotationZ=t,this.rotationY=n,this.rotationX=i,this.setStartTime(e)}getRotationZ(){return this.rotationZ}getRotationX(){return this.rotationX}getRotationY(){return this.rotationY}setRotation(t){this.rotationZ=t}}class tn extends $i{constructor(t,e,i){super(),this.scaleX=t,this.scaleY=e,this.setStartTime(i)}getScaleX(){return this.scaleX}setScaleX(t){this.scaleX=t}getScaleY(){return this.scaleY}setScaleY(t){this.scaleY=t}}class en extends $i{constructor(t,e,i){super(),this.translationX=t,this.translationY=e,this.setStartTime(i)}getTranslationX(){return this.translationX}setTranslationX(t){this.translationX=t}getTranslationY(){return this.translationY}setTranslationY(t){this.translationY=t}}function nn(t,e){return t.getStartTime()-e.getStartTime()}function sn(t,e,i,n,s){return((n-s)*t+(s-i)*e)/(n-i)}class an{produceAnimationResult(t){t.sort(nn);let e=t.length;this.rotationInfoList=new Array,this.alphaInfoList=new Array,this.scaleInfoList=new Array,this.translationInfoList=new Array,this.animationResult=new Map,this.timestampSet=new Set;for(let o=0;o<e;o++)this.timestampSet.add(t[o].getStartTime()),t[o]instanceof Qi?this.rotationInfoList.push(t[o]):t[o]instanceof qi?this.alphaInfoList.push(t[o]):t[o]instanceof tn?this.scaleInfoList.push(t[o]):t[o]instanceof en&&this.translationInfoList.push(t[o]),this.duration=t[o].getStartTime();let i=0,n=0,s=0,a=0;for(this.timestampSet.forEach((t=>{for(;i<this.alphaInfoList.length;){let e=this.alphaInfoList[i].getStartTime();if(!(e<=t)){if(i>0&&this.alphaInfoList[i-1].getStartTime()!=t){let n=this.alphaInfoList[i-1].getStartTime(),s=sn(this.alphaInfoList[i-1].getAplha(),this.alphaInfoList[i].getAplha(),n,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setAlpha(s);else{let e=new Zi;e.setStartTime(t),e.setAlpha(s),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setAlpha(this.alphaInfoList[i].getAplha());else{let n=new Zi;n.setStartTime(t),n.setAlpha(this.alphaInfoList[i].getAplha()),this.animationResult.set(e,n)}i++}for(;s<this.rotationInfoList.length;){let e=this.rotationInfoList[s].getStartTime();if(!(e<=t)){if(s>0&&this.rotationInfoList[s-1].getStartTime()!=t){let i=this.rotationInfoList[s-1].getStartTime(),n=sn(this.rotationInfoList[s-1].getRotationZ(),this.rotationInfoList[s].getRotationZ(),i,e,t),a=sn(this.rotationInfoList[s-1].getRotationY(),this.rotationInfoList[s].getRotationY(),i,e,t),o=sn(this.rotationInfoList[s-1].getRotationX(),this.rotationInfoList[s].getRotationX(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setRotationZ(n),this.animationResult.get(t).setRotationY(a),this.animationResult.get(t).setRotationX(o);else{let e=new Zi;e.setStartTime(t),e.setRotationZ(n),e.setRotationY(a),e.setRotationX(o),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setRotationZ(this.rotationInfoList[s].getRotationZ()),this.animationResult.get(e).setRotationY(this.rotationInfoList[s].getRotationY()),this.animationResult.get(e).setRotationX(this.rotationInfoList[s].getRotationX());else{let i=new Zi;i.setStartTime(t),i.setRotationZ(this.rotationInfoList[s].getRotationZ()),i.setRotationY(this.rotationInfoList[s].getRotationY()),i.setRotationX(this.rotationInfoList[s].getRotationX()),this.animationResult.set(e,i)}s++}for(;n<this.scaleInfoList.length;){let e=this.scaleInfoList[n].getStartTime();if(!(e<=t)){if(n>0&&this.scaleInfoList[n-1].getStartTime()!=t){let i=this.scaleInfoList[n-1].getStartTime(),s=sn(this.scaleInfoList[n-1].getScaleX(),this.scaleInfoList[n].getScaleX(),i,e,t),a=sn(this.scaleInfoList[n-1].getScaleY(),this.scaleInfoList[n].getScaleY(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setScaleX(s),this.animationResult.get(t).setScaleY(a);else{let e=new Zi;e.setStartTime(t),e.setScaleX(s),e.setScaleY(a),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setScaleX(this.scaleInfoList[n].getScaleX()),this.animationResult.get(e).setScaleY(this.scaleInfoList[n].getScaleY());else{let i=new Zi;i.setStartTime(t),i.setScaleX(this.scaleInfoList[n].getScaleX()),i.setScaleY(this.scaleInfoList[n].getScaleY()),this.animationResult.set(e,i)}n++}for(;a<this.translationInfoList.length;){let e=this.translationInfoList[a].getStartTime();if(!(e<=t)){if(a>0&&this.translationInfoList[a-1].getStartTime()!=t){let i=this.translationInfoList[a-1].getStartTime(),n=sn(this.translationInfoList[a-1].getTranslationX(),this.translationInfoList[a].getTranslationX(),i,e,t),s=sn(this.translationInfoList[a-1].getTranslationY(),this.translationInfoList[a].getTranslationY(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setTranslationX(n),this.animationResult.get(t).setTranslationY(s);else{let e=new Zi;e.setStartTime(t),e.setTranslationX(n),e.setTranslationY(s),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setTranslationX(this.translationInfoList[a].getTranslationX()),this.animationResult.get(e).setTranslationY(this.translationInfoList[a].getTranslationY());else{let t=new Zi;t.setStartTime(e),t.setTranslationX(this.translationInfoList[a].getTranslationX()),t.setTranslationY(this.translationInfoList[a].getTranslationY()),this.animationResult.set(e,t)}a++}}));i<this.alphaInfoList.length;){let t=this.alphaInfoList[i].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setAlpha(this.alphaInfoList[i].getAplha());else{let e=new Zi;e.setStartTime(t),e.setAlpha(this.alphaInfoList[i].getAplha()),this.animationResult.set(t,e)}i++}for(;s<this.rotationInfoList.length;){let t=this.rotationInfoList[s].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setRotationZ(this.rotationInfoList[s].getRotationZ()),this.animationResult.get(t).setRotationY(this.rotationInfoList[s].getRotationY()),this.animationResult.get(t).setRotationX(this.rotationInfoList[s].getRotationX());else{let e=new Zi;e.setRotationZ(this.rotationInfoList[s].getRotationZ()),e.setRotationY(this.rotationInfoList[s].getRotationY()),e.setRotationX(this.rotationInfoList[s].getRotationX()),this.animationResult.set(t,e)}s++}for(;n<this.scaleInfoList.length;){let t=this.scaleInfoList[n].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setScaleX(this.scaleInfoList[n].getScaleX()),this.animationResult.get(t).setScaleY(this.scaleInfoList[n].getScaleY());else{let e=new Zi;e.setScaleX(this.scaleInfoList[n].getScaleX()),e.setScaleY(this.scaleInfoList[n].getScaleY()),this.animationResult.set(t,e)}n++}for(;a<this.translationInfoList.length;){let t=this.translationInfoList[a].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setTranslationX(this.translationInfoList[a].getTranslationX()),this.animationResult.get(t).setTranslationY(this.translationInfoList[a].getTranslationY());else{let e=new Zi;e.setTranslationX(this.translationInfoList[a].getTranslationX()),e.setTranslationY(this.translationInfoList[a].getTranslationY()),this.animationResult.set(t,e)}a++}this.animationFiltering()}animationFiltering(){let t=-1;this.timestampSet.forEach((e=>{if(-1!=t){let i=this.animationResult.get(e);this.isInvaildNumber(i.getAplha())&&i.setAlpha(this.animationResult.get(t).getAplha()),this.isInvaildNumber(i.getRotationZ())&&i.setRotationZ(this.animationResult.get(t).getRotationZ()),this.isInvaildNumber(i.getRotationY())&&i.setRotationY(this.animationResult.get(t).getRotationY()),this.isInvaildNumber(i.getRotationX())&&i.setRotationX(this.animationResult.get(t).getRotationX()),this.isInvaildNumber(i.getScaleX())&&i.setScaleX(this.animationResult.get(t).getScaleX()),this.isInvaildNumber(i.getScaleY())&&i.setScaleY(this.animationResult.get(t).getScaleY()),this.isInvaildNumber(i.getTranslationX())&&i.setTranslationX(this.animationResult.get(t).getTranslationX()),this.isInvaildNumber(i.getTranslationY())&&i.setTranslationY(this.animationResult.get(t).getTranslationY())}t=e}))}isInvaildNumber(t){return isNaN(t)||null==t||null==t}bindViewAnmation(t,e,i,n){if(null==t)return;const s=new TKKeyframeAnimation;let a=new Array;this.timestampSet.forEach((e=>{a.push((()=>(t.style={transform:{scale:{x:this.animationResult.get(e).getScaleX(),y:this.animationResult.get(e).getScaleY()},translate:{x:this.animationResult.get(e).getTranslationX(),y:this.animationResult.get(e).getTranslationY()},rotate:{z:this.animationResult.get(e).getRotationZ(),y:this.animationResult.get(e).getRotationY(),x:this.animationResult.get(e).getRotationX()}},opacity:this.animationResult.get(e).getAplha()},0==this.duration?1:this.animationResult.get(e).getStartTime()/this.duration)))})),s.setAnimations(a),s.duration=this.duration,be(n)?s.timingFunction="linear":s.timingFunction=n,i&&(s.on("start",(t=>{i("start")})),s.on("end",(t=>{i("end")}))),t.addAnimation(s,e)}}class on{static bindAnimation(t,e,i,n,s){let a=new an;a.produceAnimationResult(t),a.bindViewAnmation(e,i,n,s)}}class rn extends TKView{constructor(t){super(),this.vm=t,this.animationMap=new Map,this.setupViews()}setupViews(){this.screenWidth=this.vm.callerContext.containerLimit.width,this.screenHeight=this.vm.callerContext.containerLimit.height,this.differenceLength=this.screenAdaptate(102)-this.screenHeight+896,this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0},this.throughHitTest=!0,this.setBubbleRainAnimation()}setBubbleRainAnimation(){this.setBubbleAnimation1(),this.setBubbleAnimation2(),this.setBubbleAnimation3(),this.setBubbleAnimation4(),this.setBubbleAnimation5(),this.setBubbleAnimation6(),this.setBubbleAnimation7(),this.setBubbleAnimation8(),this.setBubbleAnimation9(),this.setBubbleAnimation10(),this.setBubbleAnimation11(),this.setBubbleAnimation12()}screenAdaptate(t){return t*this.screenWidth/414}bindBubbleRainAnim(){let e=this.vm.getRedPacketUrl(),i=this.vm.getRedPacketIndustryIcon();be(i)&&(i=""),this.bubbles=new Array;for(let n=1;n<=12;n++){let s=new TKView,a=new TKImage,o=new TKImage,r=new TKImage,h=new TKImage,l=new S;if(l.template_show_type="bubble_redpacket_click",5==n?(l.template_show_type="bubble_gold_redpacket_click",s.style={position:"absolute",width:this.screenAdaptate(259),height:this.screenAdaptate(259),top:0,left:0,opacity:0},this.appendChild(s),o.style={position:"absolute",width:this.screenAdaptate(139),height:this.screenAdaptate(139),top:this.screenAdaptate(57),left:this.screenAdaptate(61)},ke(o,"image/BubbleRainResources/icon_ksad_bubble_rain_golden_red_packet.png"),s.appendChild(o),r.style={position:"absolute",width:this.screenAdaptate(86),height:this.screenAdaptate(38),top:this.screenAdaptate(83),left:this.screenAdaptate(88)},Be(r,i,500,(t=>{t||r.setVisibility("hidden")})),s.appendChild(r),a.style={position:"absolute",width:this.screenAdaptate(259),height:this.screenAdaptate(259),top:0,left:0},ke(a,"image/BubbleRainResources/icon_ksad_bubble_rain_golden_bubble.png"),s.appendChild(a)):(s.style={position:"absolute",width:this.screenAdaptate(204),height:this.screenAdaptate(204),top:0,left:0,opacity:0},this.appendChild(s),be(e)?(o.style={position:"absolute",width:this.screenAdaptate(110),height:this.screenAdaptate(110),top:this.screenAdaptate(47),left:this.screenAdaptate(47)},ke(o,"image/BubbleRainResources/icon_ksad_bubble_rain_red_packet.png"),s.appendChild(o),r.style={position:"absolute",width:this.screenAdaptate(72),height:this.screenAdaptate(32),top:this.screenAdaptate(111),left:this.screenAdaptate(68)},Be(r,i,500,(t=>{t||r.setVisibility("hidden")})),s.appendChild(r)):(h.style={position:"absolute",width:this.screenAdaptate(152),height:this.screenAdaptate(152),top:this.screenAdaptate(26),left:this.screenAdaptate(26)},ke(h,e),s.appendChild(h)),a.style={position:"absolute",width:this.screenAdaptate(204),height:this.screenAdaptate(204),top:0,left:0},ke(a,"image/BubbleRainResources/icon_ksad_bubble_rain_bubble.png"),s.appendChild(a)),s.addEventListener("tap",(e=>{this.vm.convert(1,{x:e.position.rawX,y:e.position.rawY},t.BUBBLE_RAIN_CLICK,l)})),12==n){const t=this;on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_1"),s,"bubbleAnimation"+n+"_1",(e=>{if("end"==e){if(this.vm.isShowEnd)return;on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_2"),s,"bubbleAnimation"+n+"_2",(e=>{if("end"==e){if(this.vm.isShowEnd)return;on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_3"),s,"bubbleAnimation"+n+"_3",(e=>{if("end"==e){if(this.vm.isShowEnd)return;on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_4"),s,"bubbleAnimation"+n+"_4",(e=>{if("end"==e){if(this.vm.isShowEnd)return;t.onAnimateComplete&&t.onAnimateComplete()}}),"0.92 0.0 0.68 1.0")}}))}}),"0.51 0.57 0.69 0.94")}}),"0.0 0.0 0.0 0.99")}else on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_1"),s,"bubbleAnimation"+n+"_1",(t=>{if("end"==t){if(this.vm.isShowEnd)return;on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_2"),s,"bubbleAnimation"+n+"_2",(t=>{if("end"==t){if(this.vm.isShowEnd)return;on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_3"),s,"bubbleAnimation"+n+"_3",(t=>{if("end"==t){if(this.vm.isShowEnd)return;on.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_4"),s,"bubbleAnimation"+n+"_4",null,"0.92 0.0 0.68 1.0")}}))}}),"0.51 0.57 0.69 0.94")}}),"0.0 0.0 0.0 0.99");this.bubbles.push(s),this.appendChild(s)}}setBubbleAnimation1(){let t=new Array;t=[new qi(1,.001),new Qi(90,.001),new Qi(-4.98,800),new en(.126*-this.screenWidth,-813-this.differenceLength,.001),new en(.118*-this.screenWidth,927-this.differenceLength,800)],this.animationMap.set("bubbleAnimation1_1",t);let e=new Array;e=[new qi(1,.001),new Qi(-4.98,.001),new Qi(1,900),new en(.118*-this.screenWidth,927-this.differenceLength,.001),new en(.116*-this.screenWidth,829-this.differenceLength,900)],this.animationMap.set("bubbleAnimation1_2",e);let i=new Array;i=[new qi(1,.001),new Qi(1,.001),new Qi(0,600),new en(.116*-this.screenWidth,829-this.differenceLength,.001),new en(.116*-this.screenWidth,835-this.differenceLength,600)],this.animationMap.set("bubbleAnimation1_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.116*-this.screenWidth,835-this.differenceLength,.001),new en(.116*-this.screenWidth,1211-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation1_4",n)}setBubbleAnimation2(){let t=new Array;t=[new qi(1,.001),new Qi(90,.001),new Qi(-4.98,800),new en(.167*this.screenWidth,-425-this.differenceLength,.001),new en(.258*this.screenWidth,789-this.differenceLength,800)],this.animationMap.set("bubbleAnimation2_1",t);let e=new Array;e=[new qi(1,.001),new Qi(-4.98,.001),new Qi(1,900),new en(.258*this.screenWidth,789-this.differenceLength,.001),new en(.254*this.screenWidth,718-this.differenceLength,900)],this.animationMap.set("bubbleAnimation2_2",e);let i=new Array;i=[new qi(1,.001),new Qi(1,.001),new Qi(0,600),new en(.254*this.screenWidth,718-this.differenceLength,.001),new en(.254*this.screenWidth,724-this.differenceLength,600)],this.animationMap.set("bubbleAnimation2_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.254*this.screenWidth,724-this.differenceLength,.001),new en(.254*this.screenWidth,1281-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation2_4",n)}setBubbleAnimation3(){let t=new Array;t=[new qi(1,.001),new Qi(-90,.001),new Qi(4.98,800),new en(.587*this.screenWidth,-706-this.differenceLength,.001),new en(.587*this.screenWidth,949-this.differenceLength,800)],this.animationMap.set("bubbleAnimation3_1",t);let e=new Array;e=[new qi(1,.001),new Qi(4.98,.001),new Qi(-1,900),new en(.587*this.screenWidth,949-this.differenceLength,.001),new en(.587*this.screenWidth,855-this.differenceLength,900)],this.animationMap.set("bubbleAnimation3_2",e);let i=new Array;i=[new qi(1,.001),new Qi(-1,.001),new Qi(0,600),new en(.587*this.screenWidth,855-this.differenceLength,.001),new en(.587*this.screenWidth,861-this.differenceLength,600)],this.animationMap.set("bubbleAnimation3_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.587*this.screenWidth,861-this.differenceLength,.001),new en(.589*this.screenWidth,1318-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation3_4",n)}setBubbleAnimation4(){let t=new Array;t=[new qi(1,.001),new Qi(-90,.001),new Qi(4.98,800),new en(.71*this.screenWidth,-480-this.differenceLength,.001),new en(.71*this.screenWidth,719-this.differenceLength,800)],this.animationMap.set("bubbleAnimation4_1",t);let e=new Array;e=[new qi(1,.001),new Qi(4.98,.001),new Qi(-1,900),new en(.71*this.screenWidth,719-this.differenceLength,.001),new en(.71*this.screenWidth,654-this.differenceLength,900)],this.animationMap.set("bubbleAnimation4_2",e);let i=new Array;i=[new qi(1,.001),new Qi(-1,.001),new Qi(0,600),new en(.71*this.screenWidth,654-this.differenceLength,.001),new en(.71*this.screenWidth,660-this.differenceLength,600)],this.animationMap.set("bubbleAnimation4_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.71*this.screenWidth,660-this.differenceLength,.001),new en(.71*this.screenWidth,1008-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation4_4",n)}setBubbleAnimation5(){let t=this.screenAdaptate(130)-this.screenHeight+896,e=new Array;e=[new qi(1,.001),new Qi(-90,.001),new Qi(4.98,800),new en(.08*-this.screenWidth,-641-t,.001),new en(.08*-this.screenWidth,604-t,800)],this.animationMap.set("bubbleAnimation5_1",e);let i=new Array;i=[new qi(1,.001),new Qi(4.98,.001),new Qi(-1,900),new en(.08*-this.screenWidth,604-t,.001),new en(.08*-this.screenWidth,533-t,900)],this.animationMap.set("bubbleAnimation5_2",i);let n=new Array;n=[new qi(1,.001),new Qi(-1,.001),new Qi(0,600),new en(.08*-this.screenWidth,533-t,.001),new en(.08*-this.screenWidth,538-t,600)],this.animationMap.set("bubbleAnimation5_3",n);let s=new Array;s=[new qi(1,.001),new Qi(0,.001),new en(.08*-this.screenWidth,538-t,.001),new en(.08*-this.screenWidth,1210-t,2e3)],this.animationMap.set("bubbleAnimation5_4",s)}setBubbleAnimation6(){let t=new Array;t=[new qi(1,.001),new Qi(90,.001),new Qi(-4.98,800),new en(.483*this.screenWidth,-287-this.differenceLength,.001),new en(.505*this.screenWidth,524-this.differenceLength,800)],this.animationMap.set("bubbleAnimation6_1",t);let e=new Array;e=[new qi(1,.001),new Qi(-4.98,.001),new Qi(1,900),new en(.505*this.screenWidth,524-this.differenceLength,.001),new en(.505*this.screenWidth,477-this.differenceLength,900)],this.animationMap.set("bubbleAnimation6_2",e);let i=new Array;i=[new qi(1,.001),new Qi(1,.001),new Qi(0,600),new en(.505*this.screenWidth,477-this.differenceLength,.001),new en(.505*this.screenWidth,481-this.differenceLength,600)],this.animationMap.set("bubbleAnimation6_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.505*this.screenWidth,481-this.differenceLength,.001),new en(.505*this.screenWidth,1578-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation6_4",n)}setBubbleAnimation7(){let t=new Array;t=[new qi(1,.001),new Qi(90,.001),new Qi(-4.98,800),new en(.097*this.screenWidth,-776-this.differenceLength,.001),new en(.053*this.screenWidth,376-this.differenceLength,800)],this.animationMap.set("bubbleAnimation7_1",t);let e=new Array;e=[new qi(1,.001),new Qi(-4.98,.001),new Qi(1,900),new en(.053*this.screenWidth,376-this.differenceLength,.001),new en(.058*this.screenWidth,319-this.differenceLength,900)],this.animationMap.set("bubbleAnimation7_2",e);let i=new Array;i=[new qi(1,.001),new Qi(1,.001),new Qi(0,600),new en(.058*this.screenWidth,319-this.differenceLength,.001),new en(.058*this.screenWidth,325-this.differenceLength,600)],this.animationMap.set("bubbleAnimation7_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.058*this.screenWidth,325-this.differenceLength,.001),new en(.058*this.screenWidth,1470-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation7_4",n)}setBubbleAnimation8(){let t=new Array;t=[new qi(1,.001),new Qi(90,.001),new Qi(-4.98,800),new en(.529*this.screenWidth,-581-this.differenceLength,.001),new en(.57*this.screenWidth,323-this.differenceLength,800)],this.animationMap.set("bubbleAnimation8_1",t);let e=new Array;e=[new qi(1,.001),new Qi(-4.98,.001),new Qi(1,900),new en(.57*this.screenWidth,323-this.differenceLength,.001),new en(.57*this.screenWidth,271-this.differenceLength,900)],this.animationMap.set("bubbleAnimation8_2",e);let i=new Array;i=[new qi(1,.001),new Qi(1,.001),new Qi(0,600),new en(.57*this.screenWidth,271-this.differenceLength,.001),new en(.57*this.screenWidth,275-this.differenceLength,600)],this.animationMap.set("bubbleAnimation8_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.57*this.screenWidth,275-this.differenceLength,.001),new en(.57*this.screenWidth,1442-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation8_4",n)}setBubbleAnimation9(){let t=new Array;t=[new qi(1,.001),new Qi(-90,.001),new Qi(4.98,800),new en(.188*-this.screenWidth,-599-this.differenceLength,.001),new en(.188*-this.screenWidth,199-this.differenceLength,800)],this.animationMap.set("bubbleAnimation9_1",t);let e=new Array;e=[new qi(1,.001),new Qi(4.98,.001),new Qi(-1,900),new en(.188*-this.screenWidth,199-this.differenceLength,.001),new en(.188*-this.screenWidth,153-this.differenceLength,900)],this.animationMap.set("bubbleAnimation9_2",e);let i=new Array;i=[new qi(1,.001),new Qi(-1,.001),new Qi(0,600),new en(.188*-this.screenWidth,153-this.differenceLength,.001),new en(.188*-this.screenWidth,158-this.differenceLength,600)],this.animationMap.set("bubbleAnimation9_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.188*-this.screenWidth,158-this.differenceLength,.001),new en(.188*-this.screenWidth,1379-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation9_4",n)}setBubbleAnimation10(){let t=new Array;t=[new qi(1,.001),new Qi(90,.001),new Qi(-4.98,800),new en(.312*this.screenWidth,-513-this.differenceLength,.001),new en(.312*this.screenWidth,136-this.differenceLength,800)],this.animationMap.set("bubbleAnimation10_1",t);let e=new Array;e=[new qi(1,.001),new Qi(-4.98,.001),new Qi(1,900),new en(.312*this.screenWidth,136-this.differenceLength,.001),new en(.312*this.screenWidth,99-this.differenceLength,900)],this.animationMap.set("bubbleAnimation10_2",e);let i=new Array;i=[new qi(1,.001),new Qi(1,.001),new Qi(0,600),new en(.312*this.screenWidth,99-this.differenceLength,.001),new en(.312*this.screenWidth,103-this.differenceLength,600)],this.animationMap.set("bubbleAnimation10_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.312*this.screenWidth,103-this.differenceLength,.001),new en(.312*this.screenWidth,1386-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation10_4",n)}setBubbleAnimation11(){let t=new Array;t=[new qi(1,.001),new Qi(-90,.001),new Qi(4.98,800),new en(.036*-this.screenWidth,-425-this.differenceLength,.001),new en(.036*-this.screenWidth,-17-this.differenceLength,800)],this.animationMap.set("bubbleAnimation11_1",t);let e=new Array;e=[new qi(1,.001),new Qi(4.98,.001),new Qi(-1,900),new en(.036*-this.screenWidth,-17-this.differenceLength,.001),new en(.036*-this.screenWidth,-43-this.differenceLength,900)],this.animationMap.set("bubbleAnimation11_2",e);let i=new Array;i=[new qi(1,.001),new Qi(-1,.001),new Qi(0,600),new en(.036*-this.screenWidth,-43-this.differenceLength,.001),new en(.036*-this.screenWidth,-36-this.differenceLength,600)],this.animationMap.set("bubbleAnimation11_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.036*-this.screenWidth,-36-this.differenceLength,.001),new en(.036*-this.screenWidth,1566-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation11_4",n)}setBubbleAnimation12(){let t=new Array;t=[new qi(1,.001),new Qi(90,.001),new Qi(-4.98,800),new en(.792*this.screenWidth,-146-this.differenceLength,.001),new en(.792*this.screenWidth,17-this.differenceLength,800)],this.animationMap.set("bubbleAnimation12_1",t);let e=new Array;e=[new qi(1,.001),new Qi(-4.98,.001),new Qi(1,900),new en(.792*this.screenWidth,17-this.differenceLength,.001),new en(.792*this.screenWidth,7-this.differenceLength,900)],this.animationMap.set("bubbleAnimation12_2",e);let i=new Array;i=[new qi(1,.001),new Qi(1,.001),new Qi(0,600),new en(.792*this.screenWidth,7-this.differenceLength,.001),new en(.792*this.screenWidth,10-this.differenceLength,600)],this.animationMap.set("bubbleAnimation12_3",i);let n=new Array;n=[new qi(1,.001),new Qi(0,.001),new en(.792*this.screenWidth,10-this.differenceLength,.001),new en(.792*this.screenWidth,1526-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation12_4",n)}stopAllAnimation(){if(!be(this.bubbles))for(let t=0;t<this.bubbles.length;t++)this.bubbles[t].removeAllAnimation();this.removeAll()}}class hn{constructor(t){this.currentPlaybackTimeMs=0,this.countDownTime=0,this.isTimerPaused=!1,this.mTimerInterval=500,this.mTotalStayTime=0,this.mTotalStayTime=t}setTotalPlayTime(t){t&&(this.mTotalStayTime=t)}setTimerInterval(t){t&&(this.mTimerInterval=t)}play(){this.startTimer()}paused(){this.isTimerPaused=!0}resume(){this.isTimerPaused=!1}stop(){this.stopTimer()}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{this.isTimerPaused||(this.currentPlaybackTimeMs+=this.mTimerInterval,this.onCurrentPlaybackCallback&&this.onCurrentPlaybackCallback(this.currentPlaybackTimeMs),this.currentPlaybackTimeMs>=this.mTotalStayTime?(this.stopTimer(),this.onFinishCallback&&this.onFinishCallback()):this.currentPlaybackTimeMs<this.mTotalStayTime&&(this.countDownTime=(this.mTotalStayTime-this.currentPlaybackTimeMs)/1e3,this.countDownCallback&&this.countDownCallback(this.countDownTime)))}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}}class ln extends TKView{constructor(t){super(),this.hasRemove=!1,this.vm=t,this.throughHitTest=!0,this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0};const e=this;this.timePlay=new hn(this.vm.getDelayTime()),this.timePlay.onFinishCallback=()=>{e.vm.hasShown=!0,e.vm.reportElementImpression(),e.setupViews()},ri().on(h,(t=>{this.vm.hasShown&&(this.vm.isShowEnd=!0)})),_i(this.vm.$attrsPath.isShowEnd,(t=>{t&&this.onDismiss()})),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{switch(t){case"showEnd":this.timePlay.play();break;case"pageInvisiable":this.timePlay.paused();break;case"pageVisiable":this.timePlay.resume();break;case"hideEnd":this.vm.isShowEnd=!0}}))}setupViews(){const t=this;this.preHeatView=new Ji(this.vm,(()=>{t.rainFallView=new rn(this.vm),t.rainFallView.onAnimateComplete=()=>{t.onDismiss()},t.appendChild(this.rainFallView),t.rainFallView.bindBubbleRainAnim()})),this.appendChild(this.preHeatView)}onDismiss(){this.hasRemove||(this.hasRemove=!0,this.preHeatView&&this.preHeatView.stopAllAnimation(),this.rainFallView&&this.rainFallView.stopAllAnimation(),this.timePlay.stop(),this.style={visibility:"hidden"},this.onDismissComplete&&this.onDismissComplete())}}class dn extends TKView{constructor(t){super(),this.vm=t,this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute"},this.throughHitTest=!0,this.setPreloadData(),this.preloadView(),this.produceAnimation(),this.setupAction()}setPreloadData(){this.imageViews=new Array,this.animationMap=new Map,this.imageSrcs=new Array,this.levelsConfig=[8,10,9,7,5,4,13,12,11,6,3,2,1];for(let t=0;t<3;t++){let e="image/ksad-compose-image/GiftBox/ksad_gift_box_"+t+".png",i=this.vm.getGiftBoxIconUrls()[t];this.imageSrcs.push(be(i)?e:i)}}preloadView(){this.vm.callerContext.containerLimit.width;let t=this.vm.callerContext.containerLimit.height,e=this.vm.callerContext.containerLimit.width/375,i=[85*e,215.5*e,-28*e,100*e,-10*e,170*e,223*e,-59*e,27*e,-27*e,198.5*e,113.5*e,60*e],n=[0,0,0,1,0,0,1,0,1,0,2,2,0];3==this.vm.callerContext.adStyle||2==this.vm.callerContext.adStyle?Pe.isAndroid()?this.appendHeight=70*e/t:this.appendHeight=100*e/t:this.appendHeight=53*e/t;for(let s=0;s<13;s++){let t=new TKImage;t.style={position:"absolute",width:195*e,height:195*e,top:200*-e,left:i[s],right:0,opacity:1},Be(t,this.imageSrcs[n[s]],500,(e=>{e||(this.hasLoadFailed=!0,ke(t,"image/ksad-compose-image/GiftBox/ksad_gift_box_"+n[s]+".png"))})),this.imageViews.push(t)}}produceAnimation(){this.configGiftBoxAnimation1(),this.configGiftBoxAnimation2(),this.configGiftBoxAnimation3(),this.configGiftBoxAnimation4(),this.configGiftBoxAnimation5(),this.configGiftBoxAnimation6(),this.configGiftBoxAnimation7(),this.configGiftBoxAnimation8(),this.configGiftBoxAnimation9(),this.configGiftBoxAnimation10(),this.configGiftBoxAnimation11(),this.configGiftBoxAnimation12(),this.configGiftBoxAnimation13()}configGiftBoxAnimation1(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(0,500),new Qi(-18,600),new en(0,0,0),new en(0,1.025*t+t*this.appendHeight,500)],this.animationMap.set("animation0",e)}configGiftBoxAnimation2(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(-45,0),new Qi(-45,700),new Qi(-60,800),new en(0,0,500),new en(0,1.024*t+t*this.appendHeight,700)],this.animationMap.set("animation1",e)}configGiftBoxAnimation3(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(-60,0),new Qi(-60,750),new Qi(-40,850),new en(0,0,550),new en(0,1.034*t+t*this.appendHeight,750)],this.animationMap.set("animation2",e)}configGiftBoxAnimation4(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(-100,0),new en(0,0,600),new en(0,.93*t+t*this.appendHeight,750),new en(0,.91*t+t*this.appendHeight,800),new en(0,.945*t+t*this.appendHeight,850)],this.animationMap.set("animation3",e)}configGiftBoxAnimation5(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(-100,0),new Qi(-100,800),new Qi(-85,850),new en(0,0,600),new en(0,.95*t+t*this.appendHeight,800)],this.animationMap.set("animation4",e)}configGiftBoxAnimation6(){let t=this.vm.callerContext.containerLimit.height,e=new Array,i=new Qi(-15,0),n=new en(0,0,800);e=[i,n,n,new en(0,.925*t+t*this.appendHeight,1050)],this.animationMap.set("animation5",e)}configGiftBoxAnimation7(){let t=this.vm.callerContext.containerLimit.width,e=this.vm.callerContext.containerLimit.height,i=new Array;i=[new Qi(35,0),new Qi(35,1050),new Qi(105,1150),new en(0,0,850),new en(0,.825*e+e*this.appendHeight,1050),new en(.1*t,.925*e+e*this.appendHeight,1150)],this.animationMap.set("animation6",i)}configGiftBoxAnimation8(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new en(0,0,900),new en(0,.92*t+t*this.appendHeight,1200)],this.animationMap.set("animation7",e)}configGiftBoxAnimation9(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(-35,0),new Qi(-35,1400),new Qi(-25,1500),new en(0,0,1100),new en(0,.835*t+t*this.appendHeight,1400)],this.animationMap.set("animation8",e)}configGiftBoxAnimation10(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(-60,0),new Qi(-60,1850),new Qi(-40,1950),new en(0,0,1650),new en(0,.777*t+t*this.appendHeight,1850)],this.animationMap.set("animation9",e)}configGiftBoxAnimation11(){let t=this.vm.callerContext.containerLimit.width,e=this.vm.callerContext.containerLimit.height,i=new Array;i=[new Qi(70,0),new Qi(70,1950),new Qi(95,2150),new en(0,0,1650),new en(0,.803*e+e*this.appendHeight,1950),new en(.05*t,.823*e+e*this.appendHeight,2150)],this.animationMap.set("animation10",i)}configGiftBoxAnimation12(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(8,0),new en(0,0,1650),new en(0,.795*t+t*this.appendHeight,1900)],this.animationMap.set("animation11",e)}configGiftBoxAnimation13(){this.vm.callerContext.containerLimit.width;let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Qi(-15,0),new Qi(-15,2600),new Qi(-40,2750),new en(0,0,2400),new en(0,.682*t+t*this.appendHeight,2600),new en(.02*-t,.702*t+t*this.appendHeight,2750)],this.animationMap.set("animation12",e)}setupAction(){const t=this;for(let e=0;e<this.imageViews.length;e++)this.appendChild(this.imageViews[this.levelsConfig[e]-1]),this.imageViews[this.levelsConfig[e]-1].addEventListener("tap",(e=>{this.hasClicked=!0,t.clickCallback&&t.clickCallback(),t.setVisibility("gone")}))}show(){console.log("giftbox multibox show"+this.imageViews.length);for(let e=0;e<this.imageViews.length;e++)on.bindAnimation(this.animationMap.get("animation"+(this.levelsConfig[e]-1)),this.imageViews[this.levelsConfig[e]-1],"showAnimation"+e);const t=this;setTimeout((()=>{t.dismiss()}),this.vm.getGiftBoxShowTime()-1500)}dismiss(){if(this.hasClicked||this.hasDismissed)return;let t=new qi(1,0),e=new qi(0,150);const i=this;on.bindAnimation([t,e],this,"dismissAnimation",(t=>{i.hasClicked||i.hasDismissed||"end"==t&&(i.autoDismissCallback&&i.autoDismissCallback(),i.hasDismissed=!0,i.setVisibility("gone"),console.log("giftbox multibox dismiss"))}))}}class cn extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData(),this.setupAction()}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",visibility:"hidden"},this.throughHitTest=!0,this.guideView=new TKView,this.guideView.style={justifyContent:"center",alignItems:"center",opacity:0},this.appendChild(this.guideView),this.guideLabel=new TKText,this.guideLabel.style={height:36,paddingLeft:20,paddingRight:20,backgroundColor:"#0D0000B2",textAlign:"center",color:"#FFFFFF",borderRadius:18,fontWeight:"bold"},this.guideView.appendChild(this.guideLabel),this.guideImageView=new TKImage,this.guideImageView.style={width:12,height:6},this.guideView.appendChild(this.guideImageView),this.giftBoxImage=new TKImage,this.giftBoxImage.style={marginTop:-7,width:195,height:195,opacity:0},this.appendChild(this.giftBoxImage)}setupData(){let t="image/ksad-compose-image/GiftBox/ksad_gift_box_0.png",e=be(this.vm.getGiftBoxIconUrls()[0])?t:this.vm.getGiftBoxIconUrls()[0];Be(this.giftBoxImage,e,500,(e=>{e||(ke(this.giftBoxImage,t),this.hasLoadFailed=!0)})),this.guideLabel.setText(this.vm.getSingleBoxGuideText()),ke(this.guideImageView,"icon_ksad_gift_box_guide_arrow.png")}setupAction(){const t=this;this.giftBoxImage.addEventListener("tap",(e=>{t.hasClicked=!0,t.clickCallback&&t.clickCallback(),t.dismiss()}))}autoDismiss(){this.hasClicked||(this.autoDismissCallback&&this.autoDismissCallback(),this.dismiss())}startShowAnimation(){const t=this,e=Gi(this.giftBoxImage,300,!0);e.on("end",(()=>{t.startShakeAnimation()})),this.giftBoxImage.addAnimation(e,"giftBoxShowAnimation");const i=Gi(this.guideView,300,!0);this.guideView.addAnimation(i,"guideShowAnimation")}startShakeAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.giftBoxImage.style={transform:{rotate:20}},.16),()=>(t.giftBoxImage.style={transform:{rotate:0}},.32),()=>(t.giftBoxImage.style={transform:{rotate:-20}},.48),()=>(t.giftBoxImage.style={transform:{rotate:0}},.64),()=>(t.giftBoxImage.style={transform:{rotate:20}},.8),()=>(t.giftBoxImage.style={transform:{rotate:0}},1)]),e.duration=900,e.timingFunction="linear",e.on("end",(()=>{t.startHideAnimation()})),this.giftBoxImage.addAnimation(e,"shakeAnimation")}startHideAnimation(){const t=this,e=ji(this.giftBoxImage,200,!0);e.on("end",(()=>{t.autoDismiss()})),this.giftBoxImage.addAnimation(e,"giftBoxHideAnimation");const i=ji(this.guideView,200,!0);this.guideView.addAnimation(i,"guideHideAnimation")}show(){console.log("giftbox singlebox show"),this.style={visibility:"visible"},this.startShowAnimation()}dismiss(){this.style={visibility:"hidden"},this.setVisibility("gone")}}class pn extends TKView{constructor(t){super(),this.lottieLoadFailed=!1,this.vm=t,this.setupViews(),this.setupData()}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",visibility:"hidden"},this.throughHitTest=!0;const t=this,e=Math.ceil(812*Tachikoma.env.deviceWidth/375);Pe.supportMinimumTKVersion("5.0.0")&&(this.couponView=new TKLottieImageView,this.couponView.style={width:"100%",height:e,opacity:0},this.couponView.enabled=!1,this.couponView.setLoop(!1),this.couponView.onAnimationLoaded((e=>{e||(console.log("giftbox transition load animation failed"),t.lottieLoadFailed=!0)})),this.couponView.onAnimationEnd((()=>{t.convert()})),this.appendChild(this.couponView))}setupData(){this.couponView&&this.couponView.setUri(this.vm.getClickAnimationLottieUrl())}startShowAnimation(){this.style={visibility:"visible"},this.startCouponViewFallAnimation()}startCouponViewFallAnimation(){this.couponView&&(this.couponView.style={opacity:1},this.couponView.play())}convert(){this.hasConverted||(this.hasConverted=!0,this.vm.reportGiftBoxClick())}show(){this.vm.enableShowClickAnimation()&&!this.lottieLoadFailed?(console.log("giftbox transition show"),this.startShowAnimation(),setTimeout((()=>{this.convert()}),2300)):this.convert()}}class mn{static reportGiftBoxShowEvent(t){try{Ze({category:"ad_client_apm_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:t?.1:.001,suffixRatio:"",event_id:"ad_huge_scene_render_performance",primaryKey:"status",type:"OTHER",msg:{load_status:t?2:1,scene:"gift_box",status:1}})}catch(e){}}static reportGiftBoxClickEvent(t){try{Ze({category:"ad_client_apm_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:t?.1:.001,suffixRatio:"",event_id:"ad_huge_scene_render_performance",primaryKey:"status",type:"OTHER",msg:{load_status:t?2:1,scene:"gift_box",status:2}})}catch(e){}}}class gn extends TKView{constructor(t){super(),this.vm=t,this.setupViews();const e=this;_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"showEnd"===t&&(2!=e.vm.callerContext.adStyle&&3!=e.vm.callerContext.adStyle||e.startDelayTimerIfNeeded()),"pageVisiable"===t&&e.startDelayTimerIfNeeded(),"pageInvisiable"===t&&e.stopDelayTimerIfNeeded()})),ri().on(h,(t=>{setTimeout((()=>{console.log("giftbox dismiss"),e.transitionView&&(e.transitionView.hasConverted=!0),e.dismissCallback&&e.dismissCallback()}),500)}))}setupViews(){this.style={width:"100%",height:"100%"},this.throughHitTest=!0;const t=this;this.singleBoxView=new cn(this.vm),this.singleBoxView.autoDismissCallback=()=>{console.log("giftbox singlebox auto dissmiss"),t.multiBoxView&&t.multiBoxView.show()},this.singleBoxView.clickCallback=()=>{console.log("giftbox singlebox click"),t.convert()},this.appendChild(this.singleBoxView),this.multiBoxView=new dn(this.vm),this.multiBoxView.clickCallback=()=>{console.log("giftbox multibox click"),t.convert()},this.multiBoxView.autoDismissCallback=()=>{t.dismissCallback&&t.dismissCallback()},this.appendChild(this.multiBoxView),this.transitionView=new pn(this.vm),this.appendChild(this.transitionView)}show(){console.log("giftbox show"),this.vm.hasShown=!0,this.vm.showMultiBoxViewDirectly()?this.multiBoxView&&this.multiBoxView.show():this.singleBoxView&&this.singleBoxView.show(),this.vm.reportGiftBoxImpression();let t=this.singleBoxView.hasLoadFailed||this.multiBoxView.hasLoadFailed;mn.reportGiftBoxShowEvent(t)}hide(){this.style={visibility:"gone"},this.dismissCallback&&this.dismissCallback()}convert(){this.transitionView&&this.transitionView.show();let t=this.singleBoxView.hasLoadFailed||this.multiBoxView.hasLoadFailed;mn.reportGiftBoxClickEvent(t)}startDelayTimerIfNeeded(){if(this.vm.hasShown)return;if(this.vm.getGiftBoxDelayTime()<=0)return void this.show();if(this.delayTimer)return void this.delayTimer.resume();this.delayTimer=new hn(this.vm.getGiftBoxDelayTime()),this.delayTimer.play();const t=this;this.delayTimer.onFinishCallback=()=>{t.show()}}stopDelayTimerIfNeeded(){this.vm.hasShown||this.delayTimer&&this.delayTimer.paused()}}class un extends Bi{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),Di(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{this.vm.updateShowRedPacketRain(t)})),Di(this.vm,this.vm.$attrsPath.showRedPacketRain,(t=>{t&&this.redPackView&&this.redPackView.show()})),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"==t&&this.festivalPendantView&&this.festivalPendantView.restartGuidanceImageMoveAnimationIfNeeded(),"hideEnd"==t&&this.festivalPendantView&&this.festivalPendantView.stopActionAnimation()})),Di(this.vm,this.vm.$attrsPath.hasShowPlayend,(t=>{t&&(this.festivalPendantView&&(this.festivalPendantView.clearTimeoutIfConverted(),this.festivalPendantView.removePendantClickAnimViewIfNeeded(this),this.festivalPendantView.setVisibility("hidden")),this.redPackView&&this.redPackView.hide(),this.bubbleRainView&&(this.vm.bubbleRainViewModel.isShowEnd=!0),this.giftBoxView&&this.giftBoxView.hide())})),Di(this.vm,this.vm.$attrsPath.festivalPendantBottom,(t=>{if(!this.vm.isValidFestivalPendantBottom())return;const e=this.vm.callerContext.containerLimit.height-this.vm.festivalPendantViewModel.getPendantSize().height-t;this.festivalPendantView&&(this.festivalPendantView.style={top:this.vm.isNeedNewStyleTop()?e-60:e,visibility:"visible"})})),Di(this.vm,this.vm.$attrsPath.adHasConvert,(t=>{t&&(this.redPackView&&this.redPackView.hide(!0),this.festivalPendantView&&this.festivalPendantView.clearTimeoutIfConverted())})))}setupViews(){if(this.style={width:"100%",height:"100%"},this.throughHitTest=!0,this.vm.enableShowGiftBoxView())this.createGiftBoxView();else if(this.vm.enableBubblerainView())this.bubbleRainView=new ln(this.vm.bubbleRainViewModel),this.bubbleRainView.onDismissComplete=()=>{this.removeChild(this.bubbleRainView)},this.appendChild(this.bubbleRainView);else if(this.vm.enableShowRedPacketView()){this.redPackView=new Yi(this.vm.redPacketViewModel),this.appendChild(this.redPackView);const t=this;this.vm.redPacketViewModel.dismissCallback=()=>{t.vm.enableShowFestivalPendantView()&&t.createFestivalPendantView()}}else this.vm.enableShowFestivalPendantView()&&this.createFestivalPendantView()}createFestivalPendantView(){this.festivalPendantView||(this.festivalPendantView=new Xi(this.vm.festivalPendantViewModel),this.festivalPendantView.style={position:"absolute",visibility:"hidden"},this.appendChild(this.festivalPendantView),this.festivalPendantView.createPendantClickAnimViewIfNeeded(this),setTimeout((()=>{this.vm.isValidFestivalPendantBottom()||this.vm.getFestivalPendantBottom()}),this.vm.enableShowRedPacketView()?0:500),setTimeout((()=>{this.vm.isValidFestivalPendantBottom()||this.vm.getFestivalPendantBottom()}),1500))}createGiftBoxView(){if(this.giftBoxView)return;const t=this;this.giftBoxView=new gn(this.vm.giftBoxViewModel),this.giftBoxView.dismissCallback=()=>{t.removeChild(this.giftBoxView)},this.appendChild(this.giftBoxView)}}class wn extends Bi{constructor(){super()}refeshCurrentTIme(t){}showConfirmCard(){}refreshActionDes(t){}}class Cn extends wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.vm.isNeedExpose&&this.vm.neoGiftPopupExposure())}setupViews(){this.style={width:271,height:138,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.titleLabel=new TKText,this.titleLabel.style={textAlign:"center",width:"100%",height:89,fontSize:16,color:"#222222"},this.titleLabel.setText(this.vm.getShowAlertInfo()),this.appendChild(this.titleLabel);const t=new TKView;t.style={backgroundColor:"#F5F5F5",height:1,width:"100%"},this.appendChild(t);let e=new TKView;e.style={width:"100%",height:46,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.skipBtn=new TKText,this.skipBtn.style={width:"50%",height:"100%",color:"#9C9C9C",textAlign:"center",fontSize:14},this.skipBtn.setText("关闭广告"),e.appendChild(this.skipBtn),this.appendChild(e),this.skipBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}));const i=new TKView;i.style={backgroundColor:"#F5F5F5",height:"100%",width:1},e.appendChild(i),this.continueBtn=new TKText,this.continueBtn.style={width:"50%",height:"100%",color:"#FE3666",textAlign:"center",fontSize:14},this.continueBtn.setText("继续观看"),e.appendChild(this.continueBtn),this.continueBtn.addEventListener("tap",(t=>{this.vm.handleContinue()}))}}class fn extends xi{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>yn(t,e)})}getData(t){}}function yn(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(i,n)=>"string"!=typeof n||"function"==typeof i[n]||0==n.indexOf("$")?Reflect.get(i,n):yn(t,e+"."+n)})}var Tn;!function(t){t[t.Unknow=0]="Unknow",t[t.neoGift=1]="neoGift"}(Tn||(Tn={}));class In extends fn{constructor(){super(...arguments),this.isPlayAgain=!1,this.currentPlaybackTime=0,this.lifeStatus="none",this.isMoreShow=!1,this.sceneSource=Tn.Unknow,this.sceneType=0,this.isNeedExpose=!0}checkDataValid(){return!!this.adInfo}refreshCurrentTime(t){}getShowAlertInfo(){let t="观看完整视频即可获取奖励";try{let e=this.adInfo.adRewardInfo.rewardTime;e<this.getVideoDuration()&&(t="观看视频"+e.toString()+"s即可获取奖励")}catch(e){}return t}getVideoDuration(){let t=0;try{let e=this.adInfo;const i=e.adMaterialInfo.materialFeature.length>0?e.adMaterialInfo.materialFeature[0]:null;i&&(t=i.videoDuration,0==t&&(t=i.videoDurationMs/1e3))}catch(e){}return t}getRewardTime(){return gt(this.adInfo)}getIconUrl(){try{let t=this.adInfo.adBaseInfo.appIconUrl;return Ie(t)||(t=this.adInfo.advertiserInfo.portraitUrl),Ie(t)||(t="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),t}catch(t){}return"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}getProductName(){let t="";try{if(K.isOriginLiveAd(this.adInfo)){let e=K.obtainVideoLiveData(this.adInfo);t=K.liveGetAuthorName(e,this.adInfo)}else t=this.adInfo.adProductInfo.name}catch(e){}return t}getDescription(){let t="";try{if(K.isOriginLiveAd(this.adInfo)){let e=K.obtainVideoLiveData(this.adInfo);t=K.liveGetLiveDesc(e,this.adInfo)}else t=this.adInfo.adBaseInfo.adDescription}catch(e){}return t}getAppName(){let t="";try{t=this.adInfo.adBaseInfo.appName}catch(e){}return t}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}isEcFollow(){return Tt(this.adInfo)}isLiveSubscribe(){return It(this.adInfo)}isJinniu(){return nt(this.adInfo)}handleAbandon(){}handleContinue(){}handleClose(){}handleGiftCallAction(t){}handleConvert(t,e,i){}getNeoConformTips(){var t;if(Pt(this.adInfo))try{return null!==(t=et(this.adInfo).confirmTipsDes)&&void 0!==t?t:"为你推荐更多精彩内容"}catch(e){console.log("TK endCardInfo confirmTipsDes error")}try{return this.adInfo.adMatrixInfo.adDataV2.confirmTKInfo.tipsDes}catch(e){console.log("TK endCardInfo getNeoConformTips error")}return"为你推荐更多精彩内容"}getNeoConformActionDes(){return Vt(this.adInfo)}getNeoConfirmCardType(){try{return this.adInfo.adMatrixInfo.adDataV2.confirmTKInfo.cardType}catch(t){console.log("TK endCardInfo getNeoConfirmCardType error")}return 1}getRetainCodeType(){switch(q(this.adInfo)){case 9:return v.RETAIN_CARD_TYPE_7;case 10:return v.RETAIN_CARD_TYPE_5;case 5:return v.RETAIN_CARD_TYPE_8;case 6:return v.RETAIN_CARD_TYPE_9;case 7:return v.RETAIN_CARD_TYPE_10;case 8:return v.RETAIN_CARD_TYPE_11;default:return}}neoGiftPopupExposure(t=!1){if(this.isMoreShow)return;let e;switch(this.isMoreShow=!0,q(this.adInfo)){case 9:case 10:case 5:case 6:case 7:case 8:if(e={elementType:149,retain_code_type:this.getRetainCodeType()},10==q(this.adInfo)){let t=new S;t.universe_feature_freq=6,e.clientExtData=JSON.stringify(t)}else if(9!=q(this.adInfo)){let t=new S;t.universe_feature_freq=10,e.clientExtData=JSON.stringify(t)}let t={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(t);break;default:this.confirmExposure()}}confirmExposure(){let t={};t=3==this.sceneType?{elementType:149,businessSceneType:33}:{elementType:149},pi.log(140,{x:0,y:0},t)}}class vn extends TKView{constructor(){super(),this.animCount=0,this.animationAllowed=!0,this.createLiveView(),this.createLineLeftView(),this.createLineMiddleView(),this.createLineRightView(),this.startLiveViewAnimation(),this.animationTimer=setInterval((()=>{this.animCount++,this.startLiveViewAnimation()}),300)}createLiveView(){this.liveView=new TKView,this.liveView.style={backgroundColor:"#FE3666",width:16,height:16,borderRadius:8,flexDirection:"row",alignItems:"center",justifyContent:"center"},this.appendChild(this.liveView)}createLineLeftView(){this.lineLeft=new TKView,this.lineLeft.style={position:"absolute",bottom:4,width:1.5,left:4,height:8,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineLeft)}createLineMiddleView(){this.lineMiddle=new TKView,this.lineMiddle.style={position:"absolute",bottom:4,width:1.5,height:4,left:7,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineMiddle)}createLineRightView(){this.lineRight=new TKView,this.lineRight.style={position:"absolute",bottom:4,width:1.5,left:10,height:6,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineRight)}startLiveViewAnimation(){if(!this.animationAllowed)return;const t=this.getAnimation(this.lineLeft,1);this.lineLeft.addAnimation(t,"animLeft");const e=this.getAnimation(this.lineMiddle,2);this.lineMiddle.addAnimation(e,"animMiddle");const i=this.getAnimation(this.lineRight,3);this.lineRight.addAnimation(i,"animRight")}getAnimation(t,e){const i=new TKKeyframeAnimation;return i.setAnimations([()=>(1==e?t.style={height:this.animCount%2==0?6:8}:2==e?t.style={height:this.animCount%2==0?8:4}:3==e&&(t.style={height:this.animCount%2==0?4:6}),1)]),i.duration=300,i}stopLiveViewAnimation(){clearInterval(this.animationTimer),this.animationAllowed=!1,this.lineLeft&&this.lineLeft.removeAllAnimation(),this.lineMiddle&&this.lineMiddle.removeAllAnimation(),this.lineRight&&this.lineRight.removeAllAnimation()}setLineSize(t,e){this.lineLeft.style={bottom:4,width:e,height:t,backgroundColor:"#FFFFFF"},this.lineMiddle.style={bottom:4,width:e,height:t-4,backgroundColor:"#FFFFFF"},this.lineRight.style={bottom:4,width:e,height:t-2,backgroundColor:"#FFFFFF"}}}class Vn extends wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.reloadDataInfo(),this.bindEvent(),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"hideEnd"==t&&this.liveIcon&&this.liveIcon.stopLiveViewAnimation()})),this.vm.isNeedExpose&&this.vm.confirmExposure(),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){let t=0==this.vm.screenOrientation;this.style={width:271,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},this.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={marginTop:t?32:28,width:205,height:25,fontSize:18,color:"#000000",fontWeight:"bold"},e.appendChild(this.titleLabel);let i=new TKView;if(i.style={width:80,height:80,alignItems:"center",justifyContent:"center",flexDirection:"column"},this.appIcon=new TKImage,this.appIcon.style={width:54,height:54,borderRadius:27},i.appendChild(this.appIcon),e.appendChild(i),this.vm.adInfo.adBaseInfo.isAccountLive)if(1!=this.vm.configInfo.abConfig.shortVideoFollowRewardPlayStyle)this.liveIcon=new vn,this.liveIcon.style={position:"absolute",right:13,bottom:13},i.appendChild(this.liveIcon);else{let t=new TKText;t.style={fontSize:10,color:"#FFFFFF",backgroundColor:"#FE3666",height:14,topLeftRadius:7,topRightRadius:7,bottomRightRadius:7,position:"absolute",top:6,left:50,paddingHorizontal:5,textAlign:"center",minimumTextScaleFactor:.5},t.setText("直播"),this.mIconBorder=new TKView,this.mIconBorder.style={opacity:0,width:52,height:52,borderColor:"#FE3666",borderWidth:1,borderRadius:26,position:"absolute"},i.appendChild(this.mIconBorder),i.appendChild(t),this.animateTimer=setInterval((()=>{this.startLiveBorderAnima(this.mIconBorder)}),800)}this.nameLabel=new TKText,this.nameLabel.style={maxWidth:"82%",maxHeight:50,fontSize:16,fontWeight:"medium",color:"#222222",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:10,maxWidth:"82%",maxHeight:40,fontSize:14,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descLabel),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},e.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center",minimumTextScaleFactor:.5},this.detailContainer.appendChild(this.detailLabel);let n=new TKImage;n.style={width:12,height:12},n.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(n);let s=new TKView;s.style={marginTop:t?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:t?24:12},e.appendChild(s),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},s.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C",minimumTextScaleFactor:.5},s.appendChild(this.abandonBtn)}reloadDataInfo(){let t=this.vm.adInfo;this.titleLabel.formattedText='再看<font color="#FE3666">00秒</font>，即可获得<font color="#FE3666">奖励</font>',this.nameLabel.setText(this.vm.getAppName()),this.descLabel.setText(st(this.vm.adInfo)+"人关注了Ta");let e=t.adBaseInfo.appIconUrl;Ie(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),this.appIcon.setSrc(e),this.detailLabel.setText(Vt(this.vm.adInfo)),this.actionBtn.setText("留下看看"),this.abandonBtn.setText("放弃奖励")}bindEvent(){this.detailLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(t=>{this.vm.handleContinue()})),this.abandonBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}))}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.formattedText='再看<font color="#FE3666">'+this.skipTime+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}convert(t,e,i){this.vm.handleConvert(t,e,i)}startLiveBorderAnima(t){let e=new TKKeyframeAnimation;t.style={opacity:1,transform:{scale:1}},e.setAnimations([()=>(t.style={opacity:1,transform:{scale:1.15}},.5),()=>(t.style={opacity:0,transform:{scale:1.35}},1)]),e.duration=500,t.addAnimation(e,"borderWave")}}class An extends wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.vm.isNeedExpose&&this.vm.neoGiftPopupExposure(),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){this.style={width:271,height:266,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"};const t=new TKView;t.style={marginTop:50,paddingTop:30,paddingLeft:32,paddingRight:32,width:"100%",height:216,backgroundColor:"#FFFFFF",borderRadius:12,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(t);let e=new TKView;e.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},t.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={width:205,height:20,includeFontPadding:!1,fontSize:18,textAlign:"center",color:"#222222"},e.appendChild(this.titleLabel);let i=new TKText;i.style={width:"100%",height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666",textAlign:"center",fontSize:15,fontWeight:"bold"},i.setText("留下看看"),t.appendChild(i),i.addEventListener("tap",(t=>{this.vm.handleContinue()}));let n=new TKText;n.style={width:"50%",height:48,color:"#9C9C9C",textAlign:"center",fontSize:14,fontWeight:"bold"},n.setText("残忍离开"),t.appendChild(n),n.addEventListener("tap",(t=>{this.vm.handleAbandon()}));let s=new TKView;s.style={width:"100%",height:100,position:"absolute",top:0,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(s);let a=new TKImage;ke(a,"icon_confirm_present.png"),a.style={width:127,height:100},s.appendChild(a)}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);const i=e>0?e:0;this.titleLabel.formattedText='再看<font color="#FE3666">'+i+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}}class bn extends wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.vm.isNeedExpose&&this.vm.neoGiftPopupExposure())}setupViews(){this.style={width:271,height:326,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.contentContainer=new TKView,this.contentContainer.style={marginTop:50,paddingTop:30,paddingLeft:32,paddingRight:32,width:"100%",height:243,backgroundColor:"#FFFFFF",borderRadius:12,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(this.contentContainer);let t=new TKView;t.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.contentContainer.appendChild(t),this.titleLabel=new TKText,this.titleLabel.style={width:205,height:20,includeFontPadding:!1,fontSize:18,textAlign:"center",color:"#222222",fontWeight:"bold"},t.appendChild(this.titleLabel),this.titleLabel.setText(this.vm.getNeoConformTips());const e=this;this.covertActionBtn=new TKText,this.covertActionBtn.style={width:"100%",height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666",textAlign:"center",fontSize:15,fontWeight:"bold"},this.covertActionBtn.setText(this.vm.getNeoConformActionDes()),this.contentContainer.appendChild(this.covertActionBtn),this.covertActionBtn.addEventListener("tap",(t=>{e.vm.handleGiftCallAction(t)}));let i=new TKText;i.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FFFFFF",borderWidth:1,borderColor:"#FE366680",color:"#FE3666",marginTop:10,fontWeight:"bold",textAlign:"center",fontSize:15},i.setText("留下看看"),this.contentContainer.appendChild(i),i.addEventListener("tap",(t=>{e.vm.handleContinue()})),this.skipBtn=new TKText,this.skipBtn.style={width:80,height:17,fontSize:12,color:"#FFFFFFCC",marginTop:15,backgroundColor:"#FFFFFF00",fontWeight:"bold",textAlign:"center"},this.skipBtn.setText("残忍离开"),this.appendChild(this.skipBtn),this.skipBtn.addEventListener("tap",(t=>{e.vm.handleAbandon()}));let n=new TKView;n.style={width:"100%",height:100,position:"absolute",top:0,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(n);let s=new TKImage;ke(s,"icon_confirm_present.png"),s.style={width:127,height:100},n.appendChild(s)}refreshActionDes(t){be(t)||this.covertActionBtn.setText(t)}}class Sn extends TKView{constructor(t,e,i,n="#30303099",s="#FFFFFF",a){super(),this.adInfo=t,this.isVertical=0==e,this.backgroundColor=n,this.color=s,this.shadow=a,this.containerWidth=i,this.setupView(),this.setupData()}setupView(){this.style={opacity:.6,flexDirection:"column",backgroundColor:this.backgroundColor,borderRadius:4,padding:10};let t=this.style.width;if("number"==typeof t)this.containerWidth=t;else if("string"==typeof t)if(isNaN(Number(t))){if("%"!=t.slice(-1))return;this.containerWidth*=Number(t.slice(0,-1))/100}else this.containerWidth=Number(t);if(this.addEventListener("tap",(()=>{})),this.appInfoLabel=this.createLabel(this.color),this.isVertical&&(this.appInfoLabel.style={flexShrink:1,textLineClamp:1,textOverflow:"ellipsis"},this.appInfoLabel.text=this.appendNameText(""),this.appInfoLabel.text=this.appendDeveloperText(this.appInfoLabel.text),Ie(this.appInfoLabel.text)&&Pe.supportMinimumTKVersion("5.0.0")))try{this.appInfoLabel.measureForText(this.appInfoLabel.text,this.containerWidth,2).startIndex>1&&(this.appendChild(this.appInfoLabel),this.isTooLong=!0)}catch(e){console.error("ignore"+new Error(e).stack)}this.otherLabel=this.createLabel(this.color),this.otherLabel.style={marginRight:10},this.appendChild(this.otherLabel),Ie(this.shadow)&&(this.otherLabel.style={shadow:this.shadow})}createLabel(t){let e=new TKText;return e.style={color:t,fontSize:10,textLineHeight:16},e}setupData(){let t="";if(this.isVertical?(this.isTooLong||(t=this.appendNameText(t),t=this.appendDeveloperText(t)),t=this.appendRecordText(t)):(t=this.appendNameText(t),t=this.appendDeveloperText(t),t=this.appendRecordText(t)),Pe.supportMinimumTKVersion("4.0.5")?Ie(this.adInfo.downloadSafeInfo.appVersion)&&(t+="| 版本 "+this.adInfo.downloadSafeInfo.appVersion):Ie(this.adInfo.adBaseInfo.appVersion)&&(t+="版本 "+this.adInfo.adBaseInfo.appVersion),be(this.adInfo.downloadSafeInfo.introductionInfoUrl)&&be(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&be(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.span=new TKSpan,!be(this.adInfo.downloadSafeInfo.introductionInfoUrl)){const e=t.length;t+="功能";const i=t.length;be(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&be(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.introductionClickSpanItem=new TKSpanItem,this.introductionClickSpanItem.spanType="click",this.introductionClickSpanItem.start=e,this.introductionClickSpanItem.end=i,this.introductionClickSpanItem.color=this.color,this.introductionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.introductionInfoUrl,"功能介绍")})),this.span.addSpan(this.introductionClickSpanItem)}if(!be(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)){const e=t.length;t+="权限";const i=t.length;be(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.permissionClickSpanItem=new TKSpanItem,this.permissionClickSpanItem.spanType="click",this.permissionClickSpanItem.start=e,this.permissionClickSpanItem.end=i,this.permissionClickSpanItem.color=this.color,this.permissionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPermissionInfoUrl,"权限信息")})),this.span.addSpan(this.permissionClickSpanItem)}if(!be(this.adInfo.downloadSafeInfo.appPrivacyUrl)){const e=t.length;t+="隐私";const i=t.length;t+=" ",this.privacyClickSpanItem=new TKSpanItem,this.privacyClickSpanItem.spanType="click",this.privacyClickSpanItem.start=e,this.privacyClickSpanItem.end=i,this.privacyClickSpanItem.color=this.color,this.privacyClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPrivacyUrl,"隐私政策")})),this.span.addSpan(this.privacyClickSpanItem)}this.otherLabel.setSpan(t,this.span)}appendNameText(t){return Pe.supportMinimumTKVersion("4.0.5")?Ie(this.adInfo.downloadSafeInfo.appName)&&(t+=this.adInfo.downloadSafeInfo.appName+" "):Ie(this.adInfo.adBaseInfo.appName)&&(t+=this.adInfo.adBaseInfo.appName+" "),t}appendDeveloperText(t){return Pe.supportMinimumTKVersion("4.0.5")?Ie(this.adInfo.downloadSafeInfo.corporationName)&&(t+=this.adInfo.downloadSafeInfo.corporationName+" "):Ie(this.adInfo.adBaseInfo.corporationName)&&(t+=this.adInfo.adBaseInfo.corporationName+" "),t}appendRecordText(t){return Pe.supportMinimumTKVersion("4.0.5")&&Ie(this.adInfo.downloadSafeInfo.recordNumber)&&(t+=this.adInfo.downloadSafeInfo.recordNumber+" "),t}}class xn extends TKView{constructor(){super(),this.style={height:28,bottomLeftRadius:14,topLeftRadius:14,backgroundColor:"#30303099",flexDirection:"row",alignItems:"center"};const t=new TKImage;t.style={marginLeft:5,width:18,height:18},t.setSrc("image/ksad-video-top-bar/icon_ksad_gift_small.png"),this.appendChild(t);const e=new TKText;e.style={color:"#FFFFFF",fontSize:14,marginLeft:4,marginRight:8},e.setText("观看完视频可获得奖励"),this.appendChild(e),this.addEventListener("tap",(()=>{}))}}const Ln=28;class _n extends TKView{constructor(t){if(super(),this.callActionTimer=0,this.hasShowCallBtn=!1,this.closeTimer=0,this.hasShowCloseBtn=!1,this.expcetedHeight=44,this.playEndCloseHadDelayShow=!1,this.isFinishAdvance=!1,this.vm=t,this.hasReward=!1,this.btnMargin=this.vm.isDeepRewardTask()?8:12,this.currentTime=0,this.actionState=-1,this.style={position:"absolute",top:0,left:0,right:0,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.topBarContainer=new TKView,this.topBarContainer.style={width:"100%",height:44,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.appendChild(this.topBarContainer),this.leftContainer=new TKView,this.leftContainer.style={height:Ln,marginLeft:16-this.btnMargin/2,alignItems:"center",justifyContent:"center",flexDirection:"row"},this.topBarContainer.appendChild(this.leftContainer),this.rightContainer=this.getRightContainer(),this.topBarContainer.appendChild(this.rightContainer),this.videoDuration=this.vm.getVideoDuration(),this.vm.isRewardVideo()){let t=this.vm.getSkipConfirmSwitch();this.skipNeedPromopt=t,this.rewardSecond=this.vm.getRewardTime(),this.skipSecond=Math.min(this.vm.getSkipShowTime(),this.rewardSecond),this.leftTime=this.rewardSecond}else this.skipNeedPromopt=!1,this.skipSecond=this.vm.getSkipShowTime(),K.isOriginLiveAd(this.vm.adInfo)?this.rewardSecond=30:this.rewardSecond=this.videoDuration,this.leftTime=this.rewardSecond;if(Pe.supportMinimumVersion("3.3.21","3.3.28")){let t=null,e=this.vm.isShowPrivacy(),i="flex-end";0!=this.vm.screenOrientation&&e?(t=new TKView,t.style={width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},i="flex-start",this.appendChild(t)):t=this;let n=!1;if(e){this.vm.configInfo.abConfig.reduceDownloadVisibility&&(this.style={gradientBgColor:"-90,#00000030,#00000000"});const e=0==this.vm.screenOrientation?this.vm.containerLimit.width-62:154,i=this.vm.configInfo.abConfig.reduceDownloadVisibility?"#FFFFFF00":"#30303099";this.privacyView=new Sn(this.vm.adInfo,this.vm.screenOrientation,e,i,"#FFFFFF","1 1 1 #00000030"),this.privacyView.style={alignSelf:"stretch",marginTop:10},0==this.vm.screenOrientation?(this.privacyView.style={marginLeft:16,marginRight:16,flexGrow:1},this.expcetedHeight+=78):(this.privacyView.style={marginLeft:16,width:200},this.expcetedHeight+=114,n=!0),t.appendChild(this.privacyView),this.privacyView.clickCallback=(t,e)=>{this.vm.handleOpenURL(t,e)}}this.getHasGuideBar()&&(this.guideBar=new xn,this.guideBar.style={alignSelf:i,marginTop:10},t.appendChild(this.guideBar),n||(this.expcetedHeight+=38))}Di(this.vm,this.vm.$attrsPath.isMuted,(t=>{this.setMuted(t)})),Di(this.vm,this.vm.$attrsPath.playFailed,(t=>{t&&this.playFailed()})),Di(this.vm,this.vm.$attrsPath.playFinished,(t=>{t&&this.finishPlay()})),Di(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{t&&this.countDown(t)})),Di(this.vm,this.vm.$attrsPath.hasGetDeepGift,(t=>{t&&this.getDeepReward(t)})),Di(this.vm,this.vm.$attrsPath.hasInstallTargetApp,(t=>{t&&!this.vm.isCovertTask()&&(this.updateRewardState(!0),this.updateActionBarState(4,!0))})),Di(this.vm,this.vm.$attrsPath.hasShowPlayend,(t=>{t&&(this.vm.isCovertTask()&&this.vm.giveRewardTime>0&&this.updateRewardState(!0),this.updateActionBarState(4))})),ri().on(s,(t=>{this.setMuted(t.muted),this.vm.isMuted=t.muted})),1!=this.vm.topbarModelType&&this.setupAction()}setupAction(){this.topBarContainer.addEventListener("tap",(e=>{this.vm.convertForOtherArea(e,4==this.actionState?2:3,Te(e,this.topBarContainer),t.CARD_PAGE_CLICK)})),this.vm.isSlideClick()&&jt(this.topBarContainer,(()=>{this.vm.convertForOtherArea(null,4==this.actionState?2:3,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}shouldShowNormalCallBtn(){return!0}handleCallImpressionWhenPlay(){this.callImpressionWhenPlayCalled||(this.callImpressionWhenPlayCalled=!0,this.vm.handleCallImpressionOnPlay())}updateActionBarStateInner(t,e=!1){}updateActionBarState(t,e=!1){if(!e&&t<=this.actionState)return;4==t&&this.guideBar&&this.guideBar.setVisibility("hidden"),this.actionState=t,this.leftContainer.removeAll(),this.rightContainer.removeAll(),this.updateActionBarStateInner(t,e);let i=this;if(4==this.actionState)clearTimeout(this.callActionTimer),this.closeBtn&&(2==this.vm.needShowPlayEndCloseBtn?this.hidePlayEndCloseBtn():this.vm.isDelayShowEndClose()&&!this.playEndCloseHadDelayShow?(this.hidePlayEndCloseBtn(),0==this.closeTimer&&(this.closeTimer=setTimeout((()=>{this.playEndCloseHadDelayShow=!0,this.showPlayEndCloseBtn()}),1e3*this.vm.getCloseDelaySeconds()))):this.showPlayEndCloseBtn(),this.vm.getPlayEndCallDescription&&this.vm.handleCallImpressionOnFinish());else if(this.callContainer&&this.shouldShowNormalCallBtn()){const t=this.vm.getPlayDetailCallDescription(),e=this.vm.getPlayDetailCallBtnShowTime();t&&(this.hasShowCallBtn||(0==e?this.hasShowCallBtn=!0:this.callActionTimer||(this.callActionTimer=setTimeout((()=>{i.callContainer.appendChild(i.getCallBtn()),i.callLabel.setText(t),i.layout(),i.handleCallImpressionWhenPlay(),i.hasShowCallBtn=!0}),1e3*e))),this.hasShowCallBtn&&(this.callContainer.removeAll(),this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t),this.handleCallImpressionWhenPlay()))}this.layout()}updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+""),this.layout())}showPlayEndCloseBtn(){this.closeBtn&&!this.hasShowCloseBtn&&(this.closeBtn.style={display:"flex"},this.hasShowCloseBtn=!0,Pe.isAndroid()||this.layout())}hidePlayEndCloseBtn(){this.closeBtn&&(this.closeBtn.style={display:"none"})}updateRewardState(t){this.hasReward=t&&this.vm.isRewardVideo(),this.hasReward&&this.vm&&this.vm.impressionCheckResult&&this.vm.handleHasGift()}getHasGuideBar(){return!1}countDown(t){var e,i,n,s,a,o;t<this.currentTime||this.vm.isDeepRewardTask()&&this.hasDeepReward||(this.currentTime=t,t=Math.floor(t),this.leftTime=this.rewardSecond-t<1?1:this.rewardSecond-t,Pe.supportMinimumTKVersion("5.0.1")&&this.vm.isNeedCheck&&2==this.vm.getRealAdStyle()&&(this.vm.isNeedSeverCheck=this.isNeedSeverCheck(),this.callBackAdvanceMs=(null===(i=null===(e=this.vm.adInfo.adRewardInfo)||void 0===e?void 0:e.callBackStrategyInfo)||void 0===i?void 0:i.rewardAdvanceSwitch)?(null===(s=null===(n=this.vm.adInfo.adRewardInfo)||void 0===n?void 0:n.callBackStrategyInfo)||void 0===s?void 0:s.callBackAdvanceMs)/1e3:0,t>=this.rewardSecond-this.vm.giveRewardTime-this.callBackAdvanceMs&&(null===(o=null===(a=this.vm.adInfo.adRewardInfo)||void 0===a?void 0:a.callBackStrategyInfo)||void 0===o?void 0:o.rewardAdvanceSwitch)&&!this.isFinishAdvance&&this.vm.impressionCheckResult&&this.vm.isNeedCheck&&this.vm.adInfo.adConversionInfo.callbackUrlInfo&&(this.vm.isNeedSeverCheck?(this.vm.severCheckState=1,this.secverCheck()):this.updateRewardState(!0),this.isFinishAdvance=!0)),t>=this.rewardSecond-this.vm.giveRewardTime?(this.updateRewardState(!0),this.updateActionBarState(2)):(this.updateCountDownText(),t>=this.skipSecond?this.updateActionBarState(1):this.updateActionBarState(0)))}isNeedSeverCheck(){var t,e,i,n,s,a;return(null===(e=null===(t=this.vm.adInfo.adRewardInfo)||void 0===t?void 0:t.callBackStrategyInfo)||void 0===e?void 0:e.serverCheckSwitch)&&(null===(n=null===(i=this.vm.adInfo.adRewardInfo)||void 0===i?void 0:i.callBackStrategyInfo)||void 0===n?void 0:n.callBackAdvanceMs)>0&&(null===(a=null===(s=this.vm.adInfo.adRewardInfo)||void 0===s?void 0:s.callBackStrategyInfo)||void 0===a?void 0:a.rewardAdvanceSwitch)}secverCheck(){if(Pe.supportMinimumTKVersion("4.0.9")){const i=new TKNetwork;i.isAddCommonParameters=1,i.method="POST",i.url="/rest/e/v3/open/checkReward";try{Ye(2,this.vm.adInfo);let n=JSON.parse(this.vm.adInfo.adConversionInfo.callbackUrlInfo);n.checkType=2;const s={callbackUrlInfo:JSON.stringify(n),impInfo:[{posId:this.vm.posId,adNum:1,adStyle:2}]};try{var t=JSON.parse(JSON.stringify(this.vm.adInfo.serverExt));be(t)||(delete t._tkmvvm_observed,delete t.nativeID,s.serverExt=t)}catch(e){}i.params=s;const a=ue();i.request(((t,i)=>{console.log("[caijie] tknetwork  response "+t+" error "+i);const n=ue()-a;if(!i)try{const e=JSON.parse(t).data,i=JSON.parse(e);1==i.result?(this.updateRewardState(!0),this.vm.severCheckState=1):this.vm.severCheckState=2,Xe(2,this.vm.adInfo,n,i.result,i.errorMsg)}catch(e){}}))}catch(e){}}}getDeepReward(t){this.vm.isDeepRewardTask()&&(this.hasDeepReward=t,4==this.actionState?(this.updateCountDownText(),this.layout()):this.updateActionBarState(3))}finishPlay(){this.updateRewardState(!0),this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!1)}playFailed(){this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!0)}setMuted(t){this.soundBtn&&(t?this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_mute.png"):this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_sound.png"))}hasFeedbackBtn(){return!1}getRightContainer(){let t=new TKView,e={height:Ln,marginRight:16-this.btnMargin/2,alignItems:"center",flexDirection:"row",justifyContent:"center"};return t.style=e,t}getCallContainer(){let t=new TKView;return t.style={height:"100%",alignItems:"center",justifyContent:"center",flexDirection:"row"},t.enabled=!0,this.callContainer=t,t}getSoundBtn(){this.soundBtn=new Ei,this.soundBtn.setImageSize({width:22,height:22});let t={width:Ln,height:Ln,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,backgroundColor:"#30303099"};return this.soundBtn.style=t,this.setMuted(this.vm.isMuted),this.soundBtn.addEventListener("tap",(t=>{this.vm.handleMuteChange(!this.vm.isMuted),this.setMuted(this.vm.isMuted)})),this.soundBtn}getSkipBtn(){let t=new Ei,e={height:Ln,borderRadius:14,backgroundColor:"#30303099",marginRight:this.btnMargin/2,marginLeft:this.btnMargin/2};if(t.style=e,this.vm.getSkipTips()){t.style={paddingLeft:12,paddingRight:12};let e=new TKText;e.style={fontSize:14,color:"#FFFFFF"},e.setText(this.vm.getSkipTips()),t.appendChild(e)}else t.style={width:Ln},1==this.vm.getSkipType()?t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_skip.png",{width:Ln,height:Ln}):t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12});return t.addEventListener("tap",(t=>{this.onSkipClick()})),this.skipBtn=t,t}onSkipClick(){let t=this.skipNeedPromopt&&(this.vm.isDeepRewardTask()?!this.hasDeepReward:!this.hasReward),e=this.vm.isRewardVideo();console.log("jky topbar view onSkipClick showPromopt: "+t),this.vm.handleSkip(t,e,this.skipSecond)}getFeedbackBtn(){this.feedbackBtn=new TKView,this.feedbackBtn.style={height:Ln,borderRadius:14,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,backgroundColor:"30303099",paddingLeft:8,paddingRight:8,alignItems:"center",justifyContent:"center"};let t=new TKText;return t.style={fontSize:14,color:"#FFFFFF"},t.setText("反馈"),this.feedbackBtn.appendChild(t),this.feedbackBtn.addEventListener("tap",(()=>{this.vm.handleOpenFeedback()})),this.feedbackBtn}getCloseBtn(){let t=new Ei,e={width:Ln,height:Ln};return e.marginLeft=this.btnMargin/2,e.marginRight=this.btnMargin/2,e.borderRadius=14,e.backgroundColor="#30303099",t.style=e,t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12}),t.addEventListener("tap",(()=>{this.vm.handleClose()})),this.closeBtn=t,Di(this.vm,this.vm.$attrsPath.needShowPlayEndCloseBtn,(t=>{let e=this.vm.getCloseDelaySeconds();console.log("jky topbar view onBind needShowPlayEndCloseBtn: "+t+", closeBtnDelayTime: "+e),1==t&&e<=0&&this.showPlayEndCloseBtn()})),t}getGiftBtn(t=!0){let e=new Ei;return e.setImageSize({width:Ln,height:Ln}),e.style={width:Ln,height:Ln,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},t&&e.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift.png"),e.addEventListener("tap",(t=>{this.vm.handleGiftClick(t)})),this.giftBtn=e,e}getCountDownLabel(){let t=new TKText;return t.style={color:"#FFFFFF",fontSize:14,textAlign:"center",height:"100%",textLineClamp:1,minimumTextScaleFactor:.5},t}getCountDownHasBg(){return!0}getCountDownBtn(){return this.countDownBtn=new TKView,this.countDownBtn.style={height:Ln,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},this.getCountDownHasBg()&&(this.countDownBtn.style={borderRadius:14,backgroundColor:"#30303099"}),this.countDownBtn.style={width:Ln},this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={width:"100%"},this.countDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.countDownBtn}getGiftCountDownBtn(){this.giftCountDownBtn=new TKView,this.giftCountDownBtn.style={marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,height:Ln,borderRadius:14,backgroundColor:"#30303099"},this.giftCountDownBtn.addEventListener("tap",(t=>{this.vm.handleGiftClick(t)}));let t=this.getGiftBtn(!1);return t.style={marginTop:2,marginLeft:2,width:24,height:24,borderRadius:12,backgroundColor:"#FE3666"},t.setImageSize({width:21,height:21}),t.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift_new.png"),this.giftCountDownBtn.appendChild(t),this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={marginTop:-26,marginLeft:26+this.btnMargin/2,marginRight:this.btnMargin},this.giftCountDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.giftCountDownBtn}getCallBtn(){this.callBtn=new TKView,this.callBtn.setBackgroundColor("#30303099"),this.callBtn.style={paddingLeft:10,paddingRight:10,height:Ln,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.callBtn.addEventListener("tap",(t=>{this.vm.handleCallClick(4==this.actionState,t)})),this.callLabel=new TKText,this.callLabel.nativeID="topBarCallLabel",this.callLabel.style={fontSize:14,color:"#FFFFFF"},this.callBtn.appendChild(this.callLabel);let t=new TKImage;return t.style={width:6,height:11,marginLeft:6},t.setSrc(this.vm.getResourceRoot()+"icon_ksad_white_right_arrow.png"),this.callBtn.appendChild(t),this.callBtn}}class Dn extends wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.reloadDataInfo(),this.bindEvent(),this.vm.isNeedExpose&&this.vm.neoGiftPopupExposure())}setupViews(){this.style={width:286,flexDirection:"column"},this.mHeaderView=this.createHeader(),this.appendChild(this.mHeaderView),this.mCardView=this.createCardView(),this.appendChild(this.mCardView)}createHeader(){let t=new TKView;return t.style={height:30,flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},this.titleLabel=new TKText,this.titleLabel.style={width:205,fontSize:14,color:"#FFFFFF",textAlign:"right"},t.appendChild(this.titleLabel),this.closeBtn=new Ei,this.closeBtn.style={paddingLeft:12,paddingRight:12,marginLeft:4,width:Ln,height:Ln},this.closeBtn.setImageSrcAndSize("image/ksad-video-confirm-card/icon_ksad_confirm_close.png",{width:24,height:24}),t.appendChild(this.closeBtn),t}createCardView(){let t=new TKView,e=0==this.vm.screenOrientation;t.style={width:"100%",borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let i=new TKView;i.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},t.appendChild(i),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:4,borderColor:"#EAEAEA",borderWidth:.5,marginTop:28},i.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={marginTop:10,maxWidth:"82%",maxHeight:50,fontSize:16,fontWeight:"medium",color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},i.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:8,maxWidth:"82%",maxHeight:40,fontSize:16,color:"#6C6C6C",textLineClamp:2,textOverflow:"ellipsis",textAlign:"center"},i.appendChild(this.descLabel),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},i.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center"},this.detailContainer.appendChild(this.detailLabel);let n=new TKImage;n.style={width:12,height:12},n.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(n);let s=new TKView;return s.style={marginTop:e?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:e?24:12},i.appendChild(s),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},s.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C"},s.appendChild(this.abandonBtn),t}reloadDataInfo(){this.titleLabel.setText("再看0秒，可获取优惠"),this.nameLabel.setText(this.vm.getProductName()),this.appIcon.setSrc(this.vm.getIconUrl()),this.descLabel.setText(this.vm.getDescription()),this.detailLabel.setText(Vt(this.vm.adInfo)),this.actionBtn.setText("继续看"),this.abandonBtn.setText("残忍离开")}bindEvent(){this.closeBtn.addEventListener("tap",(t=>{this.vm.handleClose()})),this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK)})),this.detailLabel.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(t=>{this.vm.handleContinue()})),this.abandonBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}))}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.setText("再看"+this.skipTime+"秒，即可获得优惠")}convert(t,e,i){this.vm.handleConvert(t,e,i)}}class Fn extends wn{constructor(t,e=!1,i=!1){super(),this.roundIcon=!1,this.showDesc=!1,this.vm=t,this.roundIcon=e,this.showDesc=i,this.vm.checkDataValid()&&(this.setupViews(),this.reloadDataInfo(),this.bindEvent(),this.vm.isNeedExpose&&this.vm.neoGiftPopupExposure(),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){let t=0==this.vm.screenOrientation;this.style={width:271,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},this.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={marginTop:t?32:28,width:205,height:25,fontSize:18,color:"#000000",fontWeight:"bold"},e.appendChild(this.titleLabel),this.appIcon=new TKImage,this.appIcon.style={width:64,height:64,borderRadius:this.roundIcon?32:6,borderColor:"#EAEAEA",borderWidth:.5,marginTop:12},e.appendChild(this.appIcon),this.showDesc?(this.nameLabel=new TKText,this.nameLabel.style={marginTop:12,maxWidth:"82%",maxHeight:40,fontSize:16,fontWeight:"medium",color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},e.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:10,maxWidth:"82%",maxHeight:18,fontSize:14,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descLabel)):(this.nameLabel=new TKText,this.nameLabel.style={marginTop:12,maxWidth:"82%",maxHeight:50,fontSize:16,fontWeight:"medium",color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.nameLabel)),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},e.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center"},this.detailContainer.appendChild(this.detailLabel);let i=new TKImage;i.style={width:12,height:12},i.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(i);let n=new TKView;n.style={marginTop:t?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:t?24:12},e.appendChild(n),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},n.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C"},n.appendChild(this.abandonBtn),this.closeBtn=new Ei,this.closeBtn.style={paddingLeft:12,paddingRight:12,width:Ln,height:Ln,position:"absolute",top:0,left:0},this.closeBtn.setImageSrcAndSize("image/ksad-video-confirm-card/icon_ksad_confirm_close.png",{width:24,height:24}),this.appendChild(this.closeBtn)}reloadDataInfo(){this.vm.adInfo;this.titleLabel.formattedText='再看<font color="#FE3666">00秒</font>，即可获得<font color="#FE3666">奖励</font>',this.nameLabel.setText(this.getName()),this.descLabel&&this.descLabel.setText(this.getDesc()),this.appIcon.setSrc(this.vm.getIconUrl()),this.detailLabel.setText(this.getDetailLabelText()),this.actionBtn.setText("继续观看"),this.abandonBtn.setText("放弃奖励")}getName(){return this.vm.getProductName()}getDesc(){return this.vm.getDescription()}getDetailLabelText(){return Vt(this.vm.adInfo)}bindEvent(){this.closeBtn.addEventListener("tap",(t=>{this.vm.handleClose()})),this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ICON_TITLE_CLICK)})),this.descLabel&&this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK)})),this.detailLabel.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(t=>{this.vm.handleContinue()})),this.abandonBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}))}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.formattedText='再看<font color="#FE3666">'+this.skipTime+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}convert(t,e,i){this.vm.handleConvert(t,e,i)}}class kn extends Fn{getName(){return function(t){let e=null;try{return e=t.adMatrixInfo.adDataV2.merchantLiveReservationInfo,e.title}catch(i){}return""}(this.vm.adInfo)}getDetailLabelText(){return Vt(this.vm.adInfo)}}class Rn extends wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.reloadDataInfo(),this.bindEvent(),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"hideEnd"==t&&this.liveIcon&&this.liveIcon.stopLiveViewAnimation()})),this.vm.isNeedExpose&&this.vm.neoGiftPopupExposure(),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){let t=0==this.vm.screenOrientation;this.style={width:271,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},this.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={marginTop:t?32:28,width:205,height:25,fontSize:18,color:"#000000",fontWeight:"bold"},e.appendChild(this.titleLabel);let i=new TKView;i.style={marginTop:9,width:60,height:60,alignItems:"center",justifyContent:"center",flexDirection:"column"},this.appIcon=new TKImage,this.appIcon.style={width:54,height:54,borderRadius:27},this.liveIcon=new vn,this.liveIcon.style={position:"absolute",right:3,bottom:3},i.appendChild(this.appIcon),i.appendChild(this.liveIcon),e.appendChild(i),this.nameLabel=new TKText,this.nameLabel.style={marginTop:12,maxWidth:"82%",maxHeight:50,fontSize:16,fontWeight:"medium",color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:10,maxWidth:"82%",maxHeight:40,fontSize:14,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descLabel),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},e.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center"},this.detailContainer.appendChild(this.detailLabel);let n=new TKImage;n.style={width:12,height:12},n.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(n);let s=new TKView;s.style={marginTop:t?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:t?24:12},e.appendChild(s),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},s.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C"},s.appendChild(this.abandonBtn)}reloadDataInfo(){let t=this.vm.adInfo;this.titleLabel.formattedText='再看<font color="#FE3666">00秒</font>，即可获得<font color="#FE3666">奖励</font>',this.nameLabel.setText(t.adBaseInfo.appName),this.descLabel.setText(t.adBaseInfo.adDescription);let e=t.adBaseInfo.appIconUrl;Ie(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),this.appIcon.setSrc(e),this.detailLabel.setText(Vt(this.vm.adInfo)),this.actionBtn.setText("留下看看"),this.abandonBtn.setText("残忍离开")}bindEvent(){this.detailLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(()=>{pi.log(451),this.vm.handleClose()})),this.abandonBtn.addEventListener("tap",(()=>{this.vm.handleAbandon()}))}didDisappear(){this.liveIcon&&this.liveIcon.stopLiveViewAnimation()}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.formattedText='再看<font color="#FE3666">'+this.skipTime+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}convert(t,e,i){this.vm.handleConvert(t,e,i)}}class Bn extends wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){this.style={width:271,height:266,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"};const t=new TKView;t.style={marginTop:50,paddingTop:30,paddingLeft:32,paddingRight:32,width:"100%",height:216,backgroundColor:"#FFFFFF",borderRadius:12,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(t);let e=new TKView;e.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},t.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={width:205,height:20,includeFontPadding:!1,fontSize:18,fontWeight:"500",textAlign:"center",color:"#222222"},e.appendChild(this.titleLabel);let i=new TKText;i.style={width:"100%",height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666",textAlign:"center",fontSize:15,fontWeight:"bold"},i.setText("留下看看"),t.appendChild(i),i.addEventListener("tap",(t=>{this.vm.handleContinue()}));let n=new TKText;n.style={width:"50%",height:48,color:"#9C9C9C",textAlign:"center",fontSize:14,fontWeight:"bold"},n.setText("残忍离开"),t.appendChild(n),n.addEventListener("tap",(t=>{this.vm.handleAbandon()}));let s=new TKView;s.style={width:"100%",height:100,position:"absolute",top:0,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(s);let a=new TKImage;ke(a,"scan_aggregation_confirm_bg.png"),a.style={width:127,height:100,transform:{scale:1.3}},s.appendChild(a)}refeshCurrentTIme(t){let e=this.vm.getScanAggregationRewardTime()-Math.floor(t);const i=e>0?e:0;this.titleLabel.formattedText='再看<font color="#FE3666">'+i+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}}class En extends TKView{constructor(t=!1){super(),this.style={width:"100%",height:"100%",position:"absolute",flexDirection:"column",justifyContent:"center",alignItems:"center"},t||(this.addEventListener("tap",(t=>{})),this.addEventListener("swipe",(t=>{})))}showDialog(t){t.removeChild(this),this.style={visibility:"visible"},t.appendChild(this),this.dialogContainer=t}isShowing(){return"visible"==this.style.visibility}dismiss(){this.style={visibility:"hidden"},this.dialogContainer&&this.dialogContainer.removeChild(this)}}class Kn extends fn{constructor(t,e,i,n){super(),this.canShowAggregation=!1,this.aggcardType=Pn.AGG_CARD_FANS,this.adStyle=t,this.configInfo=e,this.containerLimit=i,this.screenOrientation=n}handleConvert(e,i){if(this.adImpInfo&&this.adInfo){let n=0,s=0;be(i)||(n=i.position.rawX,s=i.position.rawY),pi.convertIfNeeded(1,this.adInfo,2,{x:n,y:s},0==e?t.RETAIN_AGG_CARD_CLICK:t.PLAYEND_AGG_CARD_CLICK,null,{},null,null,this.adResult,!0),this.isShowConfirm&&this.isShowConfirm(!1)}}getActionDataText(t){if(!Ie(t.aggActionDescription)){if(this.aggcardType==Pn.AGG_CARD_FANS)return"去看看";if(this.aggcardType==Pn.AGG_CARD_LIVE_ORDER)return"立即预约";if(this.aggcardType==Pn.AGG_CARD_SHOP)return"查看商品"}return t.aggActionDescription}getLiveNameText(t){return Ie(t.aggProductName)?t.aggProductName:""}getDesText(t){if(!Ie(t.aggAdDescription)){if(this.aggcardType==Pn.AGG_CARD_FANS)return"他来了他来了，他带着福利走来了";if(this.aggcardType==Pn.AGG_CARD_LIVE_ORDER)return"直播专享福利，快来预约";if(this.aggcardType==Pn.AGG_CARD_SHOP)return"老铁都爱买，你也来逛逛吧";if(this.aggcardType==Pn.AGG_CARD_LIVE)return"直播限时福利，进来看看"}return t.aggAdDescription}getIconImg(t){return Ie(t.aggUserIcon)?t.aggUserIcon:"image/ksad-video-image/aggregation_icon_backup.png"}getCoverImg(t){return Ie(t.aggMaterialUrl)?t.aggMaterialUrl:"image/ksad-video-image/aggregation_right_bg.png"}getShopBackupCoverImg(){return"image/ksad-video-image/aggregation_shop_bg.png"}}var Pn,Mn;!function(t){t[t.AGG_CARD_FANS=1]="AGG_CARD_FANS",t[t.AGG_CARD_LIVE_ORDER=2]="AGG_CARD_LIVE_ORDER",t[t.AGG_CARD_SHOP=3]="AGG_CARD_SHOP",t[t.AGG_CARD_LIVE=4]="AGG_CARD_LIVE"}(Pn||(Pn={})),function(t){t[t.SHOW_CONFIRM=0]="SHOW_CONFIRM",t[t.SHOW_END_CARD=1]="SHOW_END_CARD"}(Mn||(Mn={}));class On extends TKView{constructor(t,e){super(),this.showLocation=Mn.SHOW_CONFIRM,this.vm=t,e&&(this.showLocation=e),this.setupView()}setupView(){this.style={width:"100%",height:274,alignItems:"center"},this.contentView=new TKView,this.setupContentView(this.contentView),this.appendChild(this.contentView),Di(this.vm,this.vm.$attrsPath.canShowAggregation,(t=>{t&&this.updateUI(this.vm.aggregationCardInfo)})),this.contentView.addEventListener("tap",(t=>{this.vm.handleConvert(this.showLocation,t)})),jt(this.contentView,(()=>{this.vm.handleConvert(this.showLocation,null)})),this.adIcon=new TKImage,this.adIcon.style={height:16,width:40,position:"absolute",end:8,bottom:8},this.adIcon.setSrc("image/ksad-video-image/aggregation_icon_ad.png"),this.contentView.appendChild(this.adIcon)}updateUI(t){}setupContentView(t){}}class Nn extends On{updateUI(t){this.leftImg.setSrc(this.vm.getCoverImg(t)),Ie(t.aggMaterialUrl)?(this.rightBaseImg.setBlurRadius(8),this.rightBaseImg.setSrc(this.vm.getCoverImg(t))):(this.rightBaseImg.setSrc(""),this.rightBaseImg.setBlurRadius(0)),this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.buttonView.setText(this.vm.getActionDataText(t))}setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",backgroundColor:"#4F4F4F"},this.leftImg=new TKImage,this.leftImg.style={width:"45%",height:"100%",backgroundColor:"#4F4F4F",topLeftRadius:8,bottomLeftRadius:8},e.appendChild(this.leftImg);let i=new TKView;i.style={width:"55%",height:"100%",gradientBgColor:"90,585858 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,alignItems:"center",position:"absolute",marginStart:"45%"},e.appendChild(i),this.rightBaseImg=new TKBlurImage,this.rightBaseImg.style={width:"100%",height:"100%",backgroundColor:"#6D6D6D",topRightRadius:this.showLocation==Mn.SHOW_CONFIRM?8:10,bottomRightRadius:this.showLocation==Mn.SHOW_CONFIRM?8:10,position:"absolute"},i.appendChild(this.rightBaseImg);let n=new TKView;n.style={width:"100%",height:"100%",gradientBgColor:"360,585858FF 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,flexDirection:"column",alignItems:"center"},i.appendChild(n),this.iconView=new TKImage,this.iconView.style={width:32,height:32,borderRadius:16,backgroundColor:"#4F4F4F",marginTop:this.showLocation==Mn.SHOW_CONFIRM?37:60,transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},n.appendChild(this.iconView),this.desView=new TKText,this.desView.style={marginTop:this.showLocation==Mn.SHOW_CONFIRM?10:17,maxWidth:112,fontSize:12,fontWeight:"500",textAlign:"center",color:"#FFFFFF",textLineClamp:2,textLineSpace:4,transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},this.desView.setText("老铁发福利，快来关注主播，领取好礼"),n.appendChild(this.desView),this.buttonView=new TKText,this.buttonView.style={marginTop:20,maxWidth:200,height:24,fontSize:12,paddingLeft:12,paddingRight:12,paddingTop:4,paddingBottom:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:12,transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},this.buttonView.setText("去关注"),n.appendChild(this.buttonView)}}class Hn extends On{setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.baseBackground=new TKBlurImage,this.baseBackground.style={width:"100%",height:"100%",borderRadius:8,position:"absolute"},e.appendChild(this.baseBackground),this.baseBackgroundCover=new TKView,this.baseBackgroundCover.style={width:"100%",height:"100%",borderRadius:8,backgroundColor:"#00000033",position:"absolute"},e.appendChild(this.baseBackgroundCover),this.midImg=new TKImage,this.midImg.style={height:"100%",width:"45%"},e.appendChild(this.midImg);let i=new TKView;i.style={height:"100%",marginTop:12,borderRadius:8,flexDirection:"column",position:"absolute",start:0},e.appendChild(i),this.playIcon=new TKImage,this.playIcon.style={height:70,width:70,position:"absolute",justifyContent:"center",alignItems:"center"},e.appendChild(this.playIcon),this.playIcon.setSrc("image/ksad-video-image/aggregation_play_icon.png"),this.livebaseView=new TKView,this.livebaseView.style={height:22,width:54,borderRadius:4,alignItems:"center",justifyContent:"center",marginStart:8,marginTop:8,visibility:"hidden",transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},i.appendChild(this.livebaseView),this.setLiveIconView(this.livebaseView);let n=new TKView;n.style={height:20,width:"100%",flexDirection:"row",alignItems:"center",marginTop:this.showLocation==Mn.SHOW_CONFIRM?107:186},i.appendChild(n),this.iconView=new TKImage,this.iconView.style={height:this.showLocation==Mn.SHOW_CONFIRM?14:16,width:this.showLocation==Mn.SHOW_CONFIRM?14:16,marginStart:this.showLocation==Mn.SHOW_CONFIRM?8:10,borderRadius:this.showLocation==Mn.SHOW_CONFIRM?7:8},n.appendChild(this.iconView),this.liveName=new TKText,this.liveName.style={maxWidth:200,height:20,fontSize:10,fontWeight:"400",color:"#FFFFFF",marginStart:this.showLocation==Mn.SHOW_CONFIRM?4:6,textAlign:"center"},n.appendChild(this.liveName);let s=new TKView;s.style={height:25,maxWidth:200,borderRadius:4,backgroundColor:"#30303099",marginTop:(this.showLocation,Mn.SHOW_CONFIRM,3),marginStart:this.showLocation==Mn.SHOW_CONFIRM?8:10,justifyContent:"center",alignItems:"flex-start"},i.appendChild(s),this.desView=new TKText,this.desView.style={height:25,fontSize:this.showLocation==Mn.SHOW_CONFIRM?13:14,fontWeight:"500",color:"#FFFFFF",textLineClamp:1,textAlign:"center",paddingStart:this.showLocation==Mn.SHOW_CONFIRM?4:6,paddingEnd:this.showLocation==Mn.SHOW_CONFIRM?4:6},s.appendChild(this.desView)}setLiveIconView(t){let e=new TKView;e.style={height:19,width:54,borderRadius:4,flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:"#30303099"},t.appendChild(e);let i=new TKView;i.style={height:6,width:6,borderRadius:3,backgroundColor:"#15B15D"},e.appendChild(i);let n=new TKText;n.style={height:14,width:34,fontSize:11,fontWeight:"500",color:"#FFFFFF",marginStart:2,textAlign:"center"},n.setText("直播中"),e.appendChild(n)}updateUI(t){try{Ie(t.aggMaterialUrl)?(this.baseBackground.setBlurRadius(33),this.baseBackground.setSrc(this.vm.getCoverImg(t)),this.midImg.setSrc(this.vm.getCoverImg(t))):(this.baseBackgroundCover.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"},this.baseBackground.setSrc(""),this.baseBackground.setBlurRadius(0),this.baseBackground.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"}),this.vm.adInfo.adBaseInfo.isAccountLive&&(this.livebaseView.style={visibility:"visible"})}catch(e){}this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.liveName.setText(this.vm.getLiveNameText(t))}}class Wn extends On{updateUI(t){this.leftImg.setSrc(this.vm.getCoverImg(t)),Ie(t.aggMaterialUrl)?(this.rightBaseImg.setBlurRadius(8),this.rightBaseImg.setSrc(this.vm.getCoverImg(t))):(this.rightBaseImg.setSrc(""),this.rightBaseImg.setBlurRadius(0)),this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.buttonView.setText(this.vm.getActionDataText(t))}setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",backgroundColor:"#4F4F4F"},this.leftImg=new TKImage,this.leftImg.style={width:"45%",height:"100%",topLeftRadius:8,bottomLeftRadius:8},e.appendChild(this.leftImg);let i=new TKView;i.style={width:"55%",height:"100%",gradientBgColor:"90,585858 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,alignItems:"center",position:"absolute",marginStart:"45%"},e.appendChild(i),this.rightBaseImg=new TKBlurImage,this.rightBaseImg.style={width:"100%",height:"100%",backgroundColor:"#6D6D6D",topRightRadius:this.showLocation==Mn.SHOW_CONFIRM?8:9,bottomRightRadius:this.showLocation==Mn.SHOW_CONFIRM?8:9,position:"absolute"},i.appendChild(this.rightBaseImg);let n=new TKView;n.style={width:"100%",height:"100%",gradientBgColor:"360,585858FF 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,flexDirection:"column",alignItems:"center"},i.appendChild(n),this.iconView=new TKImage,this.iconView.style={width:32,height:32,borderRadius:16,marginTop:this.showLocation==Mn.SHOW_CONFIRM?37:60,transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},n.appendChild(this.iconView),this.desView=new TKText,this.desView.style={marginTop:this.showLocation==Mn.SHOW_CONFIRM?10:17,maxWidth:112,fontSize:12,fontWeight:"500",textAlign:"center",color:"#FFFFFF",textLineClamp:2,textLineSpace:4,transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},n.appendChild(this.desView),this.buttonView=new TKText,this.buttonView.style={marginTop:20,maxWidth:200,height:24,fontSize:12,paddingLeft:12,paddingRight:12,paddingTop:4,paddingBottom:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:12,transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},this.buttonView.setText("去关注"),n.appendChild(this.buttonView)}}class zn extends On{setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.baseBackground=new TKBlurImage,this.baseBackground.style={width:"100%",height:"100%",borderRadius:8,backgroundColor:"#FFFFFF",position:"absolute"},e.appendChild(this.baseBackground),this.baseBackgroundCover=new TKView,this.baseBackgroundCover.style={width:"100%",height:"100%",borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"},e.appendChild(this.baseBackgroundCover);let i=new TKView;i.style={width:"55%",height:"100%",justifyContent:"center",topLeftRadius:4,bottomLeftRadius:4},e.appendChild(i),this.leftImg=new TKImage,this.leftImg.style={width:this.showLocation==Mn.SHOW_CONFIRM?128:146,height:this.showLocation==Mn.SHOW_CONFIRM?128:146,marginStart:20,borderRadius:4,transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},i.appendChild(this.leftImg),this.rightView=new TKView,this.rightView.style={width:"45%",height:"100%",topRightRadius:4,bottomRightRadius:4,flexDirection:"column",alignItems:"center",transform:{scale:this.showLocation==Mn.SHOW_CONFIRM?1:1.2}},e.appendChild(this.rightView),this.iconView=new TKImage,this.iconView.style={width:32,height:32,borderRadius:16,marginTop:this.showLocation==Mn.SHOW_CONFIRM?37:70},this.rightView.appendChild(this.iconView),this.desView=new TKText,this.desView.style={marginTop:10,maxWidth:87,fontSize:12,textLineClamp:2,textLineSpace:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF"},this.desView.setText("老铁发福利，快来关注主播，领取好礼"),this.rightView.appendChild(this.desView),this.buttonView=new TKText,this.buttonView.style={marginTop:20,maxWidth:200,height:24,fontSize:12,paddingLeft:12,paddingRight:12,paddingTop:4,paddingBottom:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:12},this.buttonView.setText("立即预约"),this.rightView.appendChild(this.buttonView)}updateUI(t){try{Ie(t.aggMaterialUrl)?(this.leftImg.setSrc(this.vm.getCoverImg(t)),this.rightView.style={width:121,height:"100%",topRightRadius:4,bottomRightRadius:4,flexDirection:"column",alignItems:"center"},this.baseBackground.setBlurRadius(8),this.baseBackground.setSrc(this.vm.getCoverImg(t))):(this.rightView.style={width:121,height:"100%",gradientBgColor:"360,585858FF 0, 585858CC 1",topRightRadius:4,bottomRightRadius:4,flexDirection:"column",alignItems:"center"},this.baseBackgroundCover.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"},this.leftImg.setSrc(this.vm.getShopBackupCoverImg()),this.baseBackground.setSrc(""),this.baseBackground.setBlurRadius(0),this.baseBackground.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"})}catch(e){}this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.buttonView.setText(this.vm.getActionDataText(t))}}class Un extends wn{constructor(t,e){super(),this.isExpose=!1,this.vm=t,this.cardType=e,this.isVertical=0==this.vm.screenOrientation,this.setupView(),this.refeshCurrentTIme(this.vm.currentPlaybackTime),Di(this.vm,this.vm.$attrsPath.canShowAggregation,(t=>{this.parseAgg(this.vm.aggregationCardVM),this.vm.aggregationCardVM.canShowAggregation=t}))}showConfirmCard(){if(this.vm.canShowAggregation||(this.confirmBaseView.style={width:"100%",height:"100%",alignItems:"center",justifyContent:"center",flexDirection:"column"}),!this.isExpose&&this.vm.canShowAggregation){let t=null,e=di.createNeoCommonInstance(this.vm.aggregationCardVM.adInfo);e&&(t={clientExtData:JSON.stringify(e)}),pi.expose(t,this.vm.aggregationCardVM.adResult),this.neoAggCardExposure(),this.isExpose=!0,this.vm.hasShowAggCard=!0}}refeshCurrentTIme(t){this.confirmView.refeshCurrentTIme(t)}neoAggCardExposure(){let t;switch(q(this.vm.adInfo)){case 14:case 16:case 17:case 18:case 19:case 21:t={elementType:232};let e={actionType:140,payload:JSON.stringify(t),adTemplate:JSON.stringify(this.vm.aggregationCardVM.adImpInfo)};Ne.sendLog(e)}}setupView(){this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%",gradientBgColor:"270,00000000 0, 000000CC 1",flexDirection:this.isVertical?"column":"row",justifyContent:"center",alignItems:"center"},this.appendChild(this.rootView),this.confirmBaseView=new TKView,this.confirmBaseView.style={width:"100%",height:356,justifyContent:"flex-end",alignItems:"center",marginBottom:12,flexDirection:"column"},this.setupConfirmView(),this.rootView.appendChild(this.confirmBaseView),this.aggregationView=new TKView,this.aggregationView.style={width:"100%",flexShrink:1,backgroundColor:"#FFFFFF00",alignItems:"center",justifyContent:"center"},this.setupAggregationView(),this.rootView.appendChild(this.aggregationView),this.rootView.addEventListener("tap",(t=>{}))}setupConfirmView(){14==this.cardType?this.confirmView=new Vn(this.vm):16==this.cardType?this.confirmView=new Fn(this.vm):17==this.cardType?this.confirmView=new kn(this.vm,!0):18==this.cardType||19==this.cardType?this.confirmView=new Rn(this.vm):21==this.cardType?this.confirmView=new Fn(this.vm,!0,!0):this.confirmView=new Vn(this.vm),this.confirmBaseView.appendChild(this.confirmView)}setupAggregationView(){let t=new TKImage;t.style={width:272,height:18},t.setSrc("image/ksad-video-image/aggregation_middle_icon.png"),this.aggregationView.appendChild(t),14==this.cardType?(this.vm.aggregationCardVM.aggcardType=Pn.AGG_CARD_FANS,this.confirmContentview=new Nn(this.vm.aggregationCardVM)):16==this.cardType?(this.vm.aggregationCardVM.aggcardType=Pn.AGG_CARD_SHOP,this.confirmContentview=new zn(this.vm.aggregationCardVM)):17==this.cardType?(this.vm.aggregationCardVM.aggcardType=Pn.AGG_CARD_LIVE_ORDER,this.confirmContentview=new Wn(this.vm.aggregationCardVM)):18!=this.cardType&&19!=this.cardType&&21!=this.cardType||(this.vm.aggregationCardVM.aggcardType=Pn.AGG_CARD_LIVE,this.confirmContentview=new Hn(this.vm.aggregationCardVM)),this.vm.aggregationCardVM.isShowConfirm=t=>{this.vm.isShow=t},this.aggregationView.appendChild(this.confirmContentview)}parseAgg(t){t.adResult&&(t.adImpInfo=t.adResult.impAdInfo[0],t.adInfo=t.adImpInfo.adInfo[0],t.aggregationCardInfo=it(t.adInfo).innerAggregationInfo)}}class Gn extends TKView{constructor(e){super(),this.isVertical=!0,this.vm=e,this.isVertical=0==this.vm.screenOrientation,this.setupView(),this.bottomContainer&&this.bottomContainer.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)}))}setupView(){this.setContentBaseViewStyle(),this.centerView=new TKView,this.centerView.style={alignItems:"center",justifyContent:"center"};let t=new TKImage;t.style={width:"100%",height:"100%",topRightRadius:this.isVertical?24:0,topLeftRadius:24,bottomLeftRadius:this.isVertical?0:24,resize:"stretch",position:"absolute"};let e=new TKImage;e.style={width:"100%",height:"100%",topRightRadius:this.isVertical?24:0,topLeftRadius:24,bottomLeftRadius:this.isVertical?0:24,position:"absolute",gradientBgColor:"90,FFFFFF 0, FFFFFF00 1"},t.setSrc(this.getBackground()),ke(e,this.getWhiteBackground()),this.appendChild(t),this.appendChild(e),this.iconBase=new TKView,this.iconView=new TKImage,this.setIconStyle(),this.iconView.setSrc(this.getIconViewUrl()),this.iconBase.appendChild(this.iconView),this.centerView.appendChild(this.iconBase),this.midContainer=new TKView,this.midContainer.style={justifyContent:"center",alignItems:"center",flexDirection:"column"},this.centerView.appendChild(this.midContainer),this.titleView=new TKText,this.titleView.style={width:"100%",height:30,marginTop:this.getDecMarginTop(),color:"#222222",fontWeight:"bold",textAlign:"center",textOverflow:"ellipsis",fontSize:26,textLineClamp:1,maxWidth:263},this.titleView.setText(this.getTitleText()),this.midContainer.appendChild(this.titleView),this.decView=new TKText,this.decView.style={width:263,marginTop:this.getDecMarginTop(),color:"#222222",maxHeight:this.isVertical?89:51,fontWeight:"normal",textAlign:"center",textOverflow:"ellipsis",fontSize:this.isVertical?18:16,textLineClamp:2,textLineSpace:5},this.decView.setText(this.getDecText()),this.midContainer.appendChild(this.decView),this.bottomContainer=new TKView,this.bottomContainer.style={width:263,height:48,marginTop:20,borderRadius:25,backgroundColor:"#FE3666",flexDirection:"row",justifyContent:"center",alignItems:"center"},this.centerView.appendChild(this.bottomContainer),this.leftBottomContent=new TKView,this.bottomContainer.appendChild(this.leftBottomContent),this.clickBtn=new TKText,this.clickBtn.style={color:"#FFFFFF",fontWeight:"normal",fontSize:16},this.clickBtn.setText(this.getClickText()),this.bottomContainer.appendChild(this.clickBtn),this.appendChild(this.centerView)}getWhiteBackground(){return this.isVertical?"confirm_background.png":"confirm_background_landing.png"}convert(t,e,i){this.vm.handleConvert(t,e,i)}getBackground(){return this.vm.getCoverUrl()}getDecMarginTop(){return this.isVertical?20:8}getTitleMarginTop(){return this.isVertical?20:12}setIconStyle(){this.isVertical?this.setIconViewStyle(140,30,2):this.setIconViewStyle(100,24,2)}setIconViewStyle(t,e,i){this.iconView.style={width:t,height:t,borderRadius:e,backgroundColor:"#FFFFFF",borderColor:"#EAEAEA",borderWidth:i,justifyContent:"center"}}setContentBaseViewStyle(){this.isVertical?this.style={width:"100%",height:"100%",topRightRadius:24,topLeftRadius:24,backgroundColor:"#FFFFFF",alignItems:"center",justifyContent:"center"}:this.style={flexGrow:1,width:"100%",height:"100%",topLeftRadius:24,alignItems:"center",justifyContent:"center",bottomLeftRadius:24}}getIconViewUrl(){return N(this.vm.adInfo)}getTitleText(){return this.vm.getTitleText()}getDecText(){return this.vm.getDec()}getClickText(){return this.vm.getClickText()}refreshActionText(t){this.clickBtn.setText(t)}}class jn extends TKView{constructor(t,e,i){super(),this.adInfo=t,this.fansUrls=function(t){let e=null,i=["icon_ksad_fans_photo4.png","icon_ksad_fans_photo1.png","icon_ksad_fans_photo3.png","icon_ksad_fans_photo2.png"];try{e=t.advertiserInfo.fansIconList}catch(n){}if(null==e)return i;if(e.length<4)for(let s=0;s<4-e.length;s++)e.push(i[s]);return e}(t),this.portraits=new Array;for(let n=0;n<i+1;n++){let t=n%this.fansUrls.length,s=this.fansUrls[t],a=new Yn(s,i);a.left=16*n+4,a.style={position:"absolute",width:e,height:e,borderRadius:e/2,borderWidth:1,borderColor:"#FFFFFF",left:a.left},this.appendChild(a),this.portraits.push(a)}this.portraits[i].style={opacity:0},this.startAnimation()}startAnimation(){this.animationAllowed=!0,this.cycleAnimation()}stopActionAnimation(){this.animationAllowed=!1;for(let t=0;t<this.portraits.length;t++){this.portraits[t].removeAllAnimation()}}cycleAnimation(){this.animationAllowed&&setTimeout((()=>{for(let t=0;t<this.portraits.length;t++){this.portraits[t].moveAnimation(this)}this.cycleAnimation()}),800)}}class Yn extends TKImage{constructor(t,e){super(),this.iconCount=e,ke(this,t)}moveAnimation(t){this.willHide=!1,this.willShow=!1;let e=this.left;-12==e&&(this.willShow=!0,e=16*this.iconCount+4,t.appendChild(this)),4==e&&(this.willHide=!0);let i=e-16,n=new TKKeyframeAnimation;n.setAnimations([()=>(this.style={left:e,opacity:this.willShow?0:1,transform:{scale:this.willShow?.8:1}},0),()=>(this.style={left:i,opacity:this.willHide?0:1,transform:{scale:this.willHide?.8:1}},1)]),n.duration=500,n.on("end",(()=>{this.left=i})),this.addAnimation(n,"moveAniamtion")}}class Xn extends Gn{constructor(t){super(t),this.vm=t,this.registerBridgeHandle(),this.setupFansContentView()}setupFansContentView(){let t=70;this.isVertical||(t=50),this.iconView.style={borderRadius:t},this.titleView.setText(this.getTitleText()),this.decView.setText(this.getDecText());let e=new TKView;e.style={marginTop:12,height:32,backgroundColor:"#F3F3F3",borderRadius:16,justifyContent:"flex-start",alignItems:"center",flexDirection:"row"};let i=new jn(this.vm.adInfo,24,3);i.style={width:86,height:24,marginLeft:6},e.appendChild(i);let n=new TKText;n.style={height:20,color:"#222222",marginEnd:5,left:-10,textAlign:"center",fontSize:14},n.setText(this.getFansCountText()),e.appendChild(n),this.midContainer.appendChild(e)}registerBridgeHandle(){}setIconStyle(){this.isVertical?this.setIconViewStyle(140,30,2):this.setIconViewStyle(100,24,2)}getFansCountText(){return this.vm.getFansCount()}}class Jn{setBridgeHandler(t){}callJS(t){}}let $n,qn,Zn;$n="undefined"==typeof KSAdTKJsBridge?Jn:KSAdTKJsBridge;class Qn extends $n{constructor(){super(),this.bridgeHandlers=new Map;const t=this;this.setBridgeHandler((e=>{let i=e;"string"==typeof e&&(i=JSON.parse(e));const n=e=>{t.callbackJS(i.callback,{result:1,data:e})},s=(e,n)=>{t.callbackJS(i.callback,{result:e,error_msg:n})},a=t.handlerForName(i.action);console.log("tkloadcontroller  call bridge:"+JSON.stringify(e)+" handler:"+a+" data:"+i.data),a?a.handleJsCall(i.data,n,s):s(-1,"bridge handle not registered")}))}registerBridgeHandler(t){this.bridgeHandlers.set(t.getName(),t)}handlerForName(t){return this.bridgeHandlers.get(t)}callbackJS(t,e){if(console.log("tkloadcontroller callback js:"+t+" param:"+JSON.stringify(e)),"string"==typeof t){const i=t;this.callJS(i+"("+JSON.stringify(e)+")")}else{t(e)}}}class ts{loadUrl(t){}setOnFinishListener(t){}setOnStartListener(t){}setOnFailedListener(t){}setOnDownloadListener(t){}setShouldOverrideUrlLoadingListener(t){}registerBridgeForName(t,e){}callJSWithParam(t,e){}callJS(t){}setScrollEnabled(t){}setJavaScriptEnabled(t){}setAllowFileAccess(t){}setAllowContentAccess(t){}setTextZoom(t){}setAllowFileAccessFromFileURLs(t){}setAllowUniversalAccessFromFileURLs(t){}setMixedContentMode(t){}setDebugEnabled(t){}setSaveEnabled(t){}setCacheMode(t){}setOnDeeplinkSuccessListener(t){}setOnDeeplinkFailListener(t){}setDeeplinkEnabled(t){}setInnerDownloadEnabled(t){}}qn="undefined"==typeof KSAdWebView?ts:KSAdWebView;class es extends qn{}class is{handleJsCall(t,e,i){}getName(){return""}}class ns extends is{getName(){return"cancelAppDownloadForAd"}handleJsCall(t,e,i){var n;const s=JSON.parse(t);const a=M(this.getAdTemplate(s));Ue(null===(n=null==a?void 0:a.adConversionInfo)||void 0===n?void 0:n.appDownloadUrl,(t=>{t.result?e(null):i(t.result,null)}))}getAdTemplate(t){return t.adTemplate?t.adTemplate:P(this.adResult,Number(t.creativeId))}}class ss extends is{getName(){return"cancelAppDownload"}handleJsCall(t,e,i){const n=JSON.parse(t);n.url?Ue(n.url,(t=>{t.result?e(null):i(t.result,null)})):i(1,"url is null")}}class as extends is{constructor(){super()}getName(){return"clickAction"}handleJsCall(t,e,i){const n=JSON.parse(t);if(be(n.area)||be(n.logParam))i(0,"no data");else{if(this.clickCallback)this.clickCallback(n);else if(pi.matchTKConversion()){let t=JSON.parse(n.logParam.payload);pi.convertIfNeeded(n.logParam.sceneType,O(ce()),n.area,n.logParam.clickInfo,n.itemClickType,null,t,null,n.creativeId,null)}else Ne.clickActionBase(n);e(null)}}}class os extends is{constructor(){super()}getName(){return"commercialLog"}handleJsCall(t,e,i){const n=JSON.parse(t),s=n;be(n)?i(0,"no data"):(e(null),Pe.supportMinimumTKVersion("4.0.4")&&Ne.sendCommercialLog(s))}}class rs extends is{constructor(t){super(),this.configInfo=t}getName(){return"getKsAdConfig"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.configInfo?e(this.configInfo):i(0,"no data")}}class hs extends is{constructor(t){super(),this.adOriginInfo=t}getName(){return"getKsAdData"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.adOriginInfo?(e(this.adOriginInfo),console.log("KSAdGetAdDataHandler=========>GetAdData ad count = "+this.adOriginInfo.impAdInfo.length)):(i(0,"no data"),console.log("KSAdGetAdDataHandler=========>GetAdData no data"))}}class ls extends is{constructor(t){super(),this.containerLimit=t}getName(){return"getContainerLimit"}handleJsCall(t,e,i){if(console.log("tkloadcontroller call :"+this.getName()),this.containerLimit){e({width:this.containerLimit.width,height:this.containerLimit.height})}else i(0,"no data")}}class ds extends is{constructor(t){super(),this.deviceInfo=t}getName(){return"getDeviceInfo"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()+this.deviceInfo),this.deviceInfo?e(this.deviceInfo):i(0,"no data")}}class cs extends is{constructor(t){super(),this.extraGivenStatus=0,this.adStyle=t}getName(){return"getNativeData"}handleJsCall(t,e,i){this.onSuccess=e;const n=this,s=JSON.parse(t);try{if(!be(s)){const t=s.target;"playableSrc"==t&&n.onSuccess({playableSrc:this.playableSourceType}),"getExtraReward"==t&&n.onSuccess({extraRewardStatus:this.extraGivenStatus}),"getAdType"==t&&this.adStyle&&n.onSuccess({adType:this.adStyle})}}catch(a){}}}class ps extends is{constructor(){super()}getName(){return"adImpression"}handleJsCall(t,e,i){Ne.innerAdImpression(),e(null)}}class ms extends is{constructor(){super(),this.lifeStatus="none"}getName(){return"registerLifecycleListener"}handleJsCall(t,e,i){this.onSuccess=e}changeLifeStatus(){this.onSuccess&&this.onSuccess({lifeStatus:this.lifeStatus})}}class gs extends is{constructor(){super()}getName(){return"log"}handleJsCall(t,e,i){const n=JSON.parse(t);if(Tachikoma.env.isService&&this.adResult&&!n.adTemplate){let t=this.creativeId||n.creativeId;n.adTemplate=JSON.stringify(P(this.adResult,t))}console.log("tkloadcontroller handle log:"+JSON.stringify(n)),be(n)?i(0,"no data"):(Ne.sendLog(n),e(null))}}class us extends is{constructor(t){super(),this.onPageStatus=t}getName(){return"pageStatus"}handleJsCall(t,e,i){const n=JSON.parse(t);console.log("tkloadcontroller callback render status:"+t),this.onPageStatus&&(n.status&&1==n.status?this.onPageStatus(!0):this.onPageStatus(!1)),e(null)}}class ws extends is{getName(){return"registerProgressListener"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.mOnSuccess=e,be(this.mBufferedProgress)||(this.mOnSuccess(this.mBufferedProgress),this.mBufferedProgress=void 0)}updateDownloadProgress(t){this.mOnSuccess?this.mOnSuccess(t):this.mBufferedProgress=t}}class Cs extends is{constructor(t){super(),this.screenOrientation=t}getName(){return"getScreenOrientation"}handleJsCall(t,e,i){if(be(this.screenOrientation))i(0,"no data");else{e({screenOrientation:this.screenOrientation})}}}class fs extends is{constructor(t){super(),this.playAgainCallback=t}getName(){return"showPlayAgain"}handleJsCall(t,e,i){this.playAgainCallback?(this.playAgainCallback(),e(null)):i(0,"no listen playAgainCallback")}}class ys extends is{constructor(){super()}getName(){return"updateExtraReward"}handleJsCall(t,e,i){const n=JSON.parse(t);be(n)?i(0,"no data"):(Ne.updateExtraReward(n),e(null))}}class Ts extends es{constructor(t){super(),this.renderStatus=-2,this.deepLinkEnabled=!0,this.vm=t,this.registerBridgeHandle(),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{this.lifestatusHandler.lifeStatus=t,this.lifestatusHandler.changeLifeStatus()})),Di(this.vm,this.vm.$attrsPath.extraGivenStatus,(t=>{this.getNativeIdHandler.extraGivenStatus=t})),Di(this.vm,this.vm.$attrsPath.playableSourceType,(t=>{this.getNativeIdHandler.playableSourceType=t})),Di(this.vm,this.vm.$attrsPath.currentDownloadProgress,(t=>{be(t)||be(this.registerDownloadProgressListener)||this.registerDownloadProgressListener.updateDownloadProgress(t)}))}render(t){Ie(t)?(this.url=t,this.loadUrl(this.url)):this.renderStatus=0}setDeeplinkEnabledTag(t){this.setDeeplinkEnabled(t),this.deepLinkEnabled=t}getDeeplinkEnabledTag(){return this.deepLinkEnabled}registerBridgeHandle(){this.setOnStartListener((()=>{console.log("KSAdBaseWebView=====++++++ load start")})),this.setOnFinishListener((()=>{console.log("KSAdBaseWebView=====++++++ load finish")})),this.setOnFailedListener(((t,e,i)=>{console.log("KSAdBaseWebView=====++++++ load failed:"+t+":"+e+":"+i)})),this.setJavaScriptEnabled(!0),this.setAllowFileAccess(!0),this.setAllowFileAccessFromFileURLs(!1),this.setAllowUniversalAccessFromFileURLs(!1),this.setAllowContentAccess(!0),this.setMixedContentMode(0);const t=new Qn;this.bridge=t;const e=this;this.getDataHandler=new hs(this.vm.adOriginInfo),t.registerBridgeHandler(this.getDataHandler);const i=new rs(this.vm.configInfo);t.registerBridgeHandler(i);const n=new ds(le());t.registerBridgeHandler(n);const s=new Cs(this.vm.screenOrientation);t.registerBridgeHandler(s);const a=new us((t=>{e.renderStatus=t?1:0,e.renderFinishCallback&&e.renderFinishCallback(t)}));t.registerBridgeHandler(a),this.lifestatusHandler=new ms,t.registerBridgeHandler(this.lifestatusHandler);const o=new os;t.registerBridgeHandler(o);const r=new gs;r.adResult=this.vm.adOriginInfo,t.registerBridgeHandler(r);const h=new ls(this.vm.containerLimit);t.registerBridgeHandler(h);const d=new as;t.registerBridgeHandler(d),this.clickActionHandler=d;const c=new ps;t.registerBridgeHandler(c),this.showPlayAgainandler=new fs((()=>{ri().emit(l,{})})),t.registerBridgeHandler(this.showPlayAgainandler),this.getNativeIdHandler=new cs(this.vm.adStyle),t.registerBridgeHandler(this.getNativeIdHandler);const p=new ys;t.registerBridgeHandler(p),this.registerDownloadProgressListener=new ws,t.registerBridgeHandler(this.registerDownloadProgressListener);const m=new ss;t.registerBridgeHandler(m);const g=new ns;g.adResult=this.vm.adOriginInfo,t.registerBridgeHandler(g),this.registerBridgeForName(t,"KwaiAd")}registerBridgeHandler(t){this.bridge.registerBridgeHandler(t)}addClickCallback(t){this.clickActionHandler.clickCallback=t}willShow(){this.vm.lifeStatus="showStart"}didShow(){this.visible=!0,this.vm.lifeStatus="showEnd"}willHide(){this.vm.lifeStatus="hideStart"}didHide(){this.visible=!1,this.vm.lifeStatus="hideEnd"}pageVisiable(){this.visible=!0,this.vm.lifeStatus="pageVisiable"}pageInvisiable(){this.visible=!1,this.vm.lifeStatus="pageInvisiable"}}class Is extends TKView{constructor(t){super(),this.vm=t,this.setupView();try{this.vm.getLandingPageUrl((t=>{setTimeout((()=>{this.webview.render(t)}),100)}))}catch(e){}}setupView(){this.style={width:"100%",height:"100%",topRightRadius:24,topLeftRadius:24,position:"absolute"};try{this.webview=new Ts(this.vm.webViewVM),this.webview.style={width:"100%",height:"100%",topRightRadius:24,topLeftRadius:24,position:"absolute",left:0},this.webview.enabled=!1,this.webview.setDeeplinkEnabled(!1),this.appendChild(this.webview);let t=this;this.webview.setOnFinishListener((()=>{console.log("KSAdBaseWebView=====++++++ load finish"),t.vm.isWebViewDidLoad=!0}))}catch(i){console.log("webview error")}let e=new TKView;e.style={width:"100%",height:"100%",flexGrow:1},this.appendChild(e),e.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_OTHERAREA_CLICK)})),this.vm.supportSlideClick()&&jt(e,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}convert(t,e,i){this.vm.handleConvert(t,e,i)}}class vs extends TKView{constructor(t){super(),this.imageSrcs=["icon_ksad_fans_animate_1.png","icon_ksad_fans_animate_2.png","icon_ksad_fans_animate_3.png","icon_ksad_fans_animate_4.png","icon_ksad_fans_animate_5.png","icon_ksad_fans_animate_6.png","icon_ksad_fans_animate_7.png","icon_ksad_fans_animate_1.png","icon_ksad_fans_animate_2.png","icon_ksad_fans_animate_3.png","icon_ksad_fans_animate_4.png","icon_ksad_fans_animate_5.png","icon_ksad_fans_animate_6.png","icon_ksad_fans_animate_7.png"],this.mImageRight=0,this.mImageRight=t,this.images=new Array;for(let e=0;e<this.imageSrcs.length;++e){let t=this.imageSrcs[e],i=this.createAnimateImage(t);this.images.push(i)}}createAnimateImage(t){let e=new TKImage;return e.style={width:34,height:34,position:"absolute",right:this.mImageRight,top:150,opacity:0},ke(e,t),this.appendChild(e),e}stopActionAnimation(){this.animationAllowed=!1;for(let t=0;t<this.images.length;++t){this.images[t].removeAllAnimation()}}startAnimation(){this.animationAllowed=!0,this.cycleAniamtion()}cycleAniamtion(){if(this.animationAllowed){for(let t=0;t<this.images.length;++t){let e=this.images[t];setTimeout((()=>{this.animationMove(e)}),300*t)}setTimeout((()=>{this.cycleAniamtion()}),4200)}}animationMove(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={transform:{scale:1}},0),()=>(t.style={transform:{scale:1.3}},1)]),e.duration=600,t.addAnimation(e,"scaleAniamtion");let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={opacity:0,top:125},0),()=>(t.style={opacity:1,top:98},.2),()=>(t.style={opacity:1,top:71},.4),()=>(t.style={opacity:0,top:0},.8),()=>(t.style={opacity:0,top:-20},1)]),i.duration=1600,t.addAnimation(i,"moveAniamtion")}}class Vs extends Gn{constructor(t){super(t),this.vm=t,this.setupLiveCoverView()}setupLiveCoverView(){this.iconView.style={marginTop:0,width:56,height:56,borderRadius:28},this.titleView.style={height:20,marginTop:8,fontSize:16},this.midContainer.removeChild(this.decView);let t=new TKView;t.style={height:20,width:"100%",marginTop:8,flexDirection:"row",justifyContent:"center",alignItems:"center"};let e=this.getLabelList();if(!be(e)){const i=e.length>2?2:e.length;for(let n=0;n<i;n++){let i=new TKText;i.style={height:20,marginStart:10,borderRadius:4,backgroundColor:"#FE36661A",color:"#FE3666",paddingStart:5,paddingEnd:5,textAlign:"center",fontSize:12},i.setText(e[n].toString()),t.appendChild(i)}this.midContainer.appendChild(t)}this.setupLiveImgView(this.vm)}setupLiveImgView(t){let e=new TKView;e.style={marginTop:16};let i=new TKImage;i.style={width:176,height:317,borderRadius:8},i.setSrc(this.getLiveImg()),e.appendChild(i),this.midContainer.appendChild(e),this.setupLiveStateView(e);let n=new vs(15);n.style={marginStart:132,marginTop:125,width:50,height:170,position:"absolute",opacity:1},n.startAnimation(),e.appendChild(n);let s=new TKImage;s.style={height:28,width:28,marginStart:136,marginTop:280,position:"absolute"},s.setSrc("image/ksad-video-top-bar/icon_ksad_confirm_live.png"),e.appendChild(s);let a=new vn;a.style={transform:{scale:1.2}},this.leftBottomContent.appendChild(a)}setupLiveStateView(t){let e=new TKView;e.style={marginStart:8,marginTop:8,height:20,borderRadius:10,borderWidth:1,borderColor:"#FFFFFF32",paddingEnd:8,backgroundColor:"#30303099",position:"absolute",flexDirection:"row"};let i=new vn;i.style={marginLeft:2,justifyContent:"center"},e.appendChild(i);let n=new TKText;n.style={marginStart:4,marginTop:4,marginBottom:4,color:"#FFFFFF",textAlign:"center",fontSize:12,includeFontPadding:!1},this.setLiveStateText(n),e.appendChild(n),t.appendChild(e)}getLiveImg(){return this.vm.getLiveImg()}getLabelList(){return this.vm.getLabelList()}getwatchingCount(){return this.vm.getwatchingCount()}setLiveStateText(t){be(this.getwatchingCount())?(t.style={marginStart:4,marginTop:4,marginBottom:4,color:"#FFFFFF",textAlign:"center",fontSize:10},t.setText("直播中")):(t.style={marginStart:4,marginBottom:4,color:"#FFFFFF",textAlign:"center",fontSize:10},t.setText(this.getwatchingCount()))}}class As extends wn{constructor(t,e){super(),this.fingerStyle=0,this.vm=t,this.cardType=e,this.isVertical=0==this.vm.screenOrientation,this.setupView(),this.actionText=this.vm.actionText,this.refeshCurrentTIme(this.vm.currentPlaybackTime)}showConfirmCard(){this.confirmWebView&&(this.vm.isWebViewDidLoad?(this.confirmWebView.setVisibility("visible"),this.confirmContentview.setVisibility("hidden")):(this.confirmWebView.setVisibility("hidden"),this.confirmContentview.setVisibility("visible"))),this.startAnim()}setupView(){this.style={width:"100%",height:"100%"},this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%",backgroundColor:"#00000099",flexDirection:this.isVertical?"column":"row"},this.appendChild(this.rootView),this.confirmView=new TKView,this.confirmView.style={width:this.isVertical?"100%":328,height:this.isVertical?228:"100%",alignItems:"flex-start",justifyContent:"flex-start",flexDirection:"column"},this.setupConfirmView(),this.rootView.appendChild(this.confirmView),this.contentBaseView=new TKView,this.setupContenViewStyle(),this.setupContentView(),this.isVertical&&Pe.supportMinimumTKVersion("5.0.0")&&this.setLottieView(),this.rootView.appendChild(this.contentBaseView),this.rootView.addEventListener("tap",(t=>{})),this.continueBtn.addEventListener("tap",(t=>{this.vm.handleContinue()})),this.skipBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()})),this.contentBaseView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_OTHERAREA_CLICK)})),this.vm.supportSlideClick()&&jt(this.contentBaseView,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}setLottieView(){Pe.supportMinimumTKVersion("5.0.0")&&(this.lottieBg=new TKView,this.lottieBg.style={width:"100%",height:"100%",gradientBgColor:"90,00000033 0.6, 00000000 1",alignItems:"center",position:"absolute"},this.lottieBg.throughHitTest=!0,this.fingerLottieView=new TKLottieImageView,this.fingerLottieView.style={width:74,height:190,bottom:0,position:"absolute"},this.lottieBg.appendChild(this.fingerLottieView),this.contentBaseView.appendChild(this.lottieBg))}convert(t,e,i){this.vm.handleConvert(t,e,i)}setupConfirmView(){let t=new TKView;t.style={width:"100%",height:this.isVertical?28:62,marginTop:this.isVertical?89:164,flexDirection:this.isVertical?"row":"column",justifyContent:"center",alignItems:"center"},this.confirmView.appendChild(t),this.gitfImage=new TKImage,this.gitfImage.style={width:28,height:28},this.gitfImage.setSrc(this.getGiftImg()),t.appendChild(this.gitfImage),this.desTextView=new TKText,this.desTextView.style={height:28,marginTop:5,marginStart:10,color:"#FFFFFF",fontWeight:"bold",textAlign:"center",fontSize:18,includeFontPadding:!1},this.desTextView.setText(this.getDesText()),t.appendChild(this.desTextView);let e=new TKView;e.style={width:"100%",height:48,marginTop:20,alignItems:"center",justifyContent:"center",flexDirection:"row"},this.confirmView.appendChild(e),this.skipBtn=new TKText,this.skipBtn.style={width:122,height:36,borderRadius:18,borderWidth:1,borderColor:"#FFFFFF66",color:"#FFFFFF99",fontWeight:"bold",textAlign:"center",fontSize:15},this.skipBtn.setText("残忍离开"),this.skipBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()})),e.appendChild(this.skipBtn),this.continueBtn=new TKText,this.continueBtn.style={width:122,height:36,borderRadius:18,backgroundColor:"#FFFFFF33",marginStart:20,color:"#FFFFFF",fontWeight:"bold",textAlign:"center",fontSize:15},this.continueBtn.setText("留下看看"),e.appendChild(this.continueBtn)}getGiftImg(){return this.vm.hasGift?(this.desTextView.style={marginTop:0},0==$(this.vm.adInfo)?this.gitfImage.style={borderRadius:8,borderColor:"#EAEAEA",borderWidth:.5}:this.gitfImage.style={borderRadius:14,borderColor:"#EAEAEA",borderWidth:.5},N(this.vm.adInfo)):"image/ksad-video-top-bar/icon_ksad_gift.png"}getDesText(){var t;return this.vm.hasGift&&null!==(t=this.vm.getConfirmGiftTipDec())&&void 0!==t?t:"内容很精彩不留下来看看吗?"}refeshCurrentTIme(t){if(this.vm.hasGift)this.gitfImage.setSrc(this.getGiftImg()),this.desTextView.setText(this.getDesText());else{let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.desTextView.setText("再看"+this.skipTime+"秒，即可获得奖励!")}}setupContentView(){this.isVertical?(5==this.cardType&&(this.confirmContentview=new Gn(this.vm),this.contentBaseView.appendChild(this.confirmContentview)),7==this.cardType&&(this.confirmContentview=new Xn(this.vm),this.contentBaseView.appendChild(this.confirmContentview)),8==this.cardType&&(this.confirmContentview=new Vs(this.vm),this.contentBaseView.appendChild(this.confirmContentview),this.vm.containerLimit.height<760&&(this.confirmContentview.centerView.style={transform:{scale:.8}})),6==this.cardType&&(this.confirmContentview=new Gn(this.vm),this.contentBaseView.appendChild(this.confirmContentview),this.confirmContentview.setVisibility("hidden"),Pe.supportMinimumTKVersion("5.0.3")||ye()?!Pe.supportMinimumTKVersion("5.0.1")&&ye()?this.confirmContentview.setVisibility("visible"):(this.confirmWebView=new Is(this.vm),this.contentBaseView.appendChild(this.confirmWebView)):this.confirmContentview.setVisibility("visible"))):0==$(this.vm.adInfo)?(this.confirmContentview=new Gn(this.vm),this.contentBaseView.appendChild(this.confirmContentview)):(this.confirmContentview=new Xn(this.vm),this.contentBaseView.appendChild(this.confirmContentview))}setupContenViewStyle(){this.isVertical?this.contentBaseView.style={width:"100%",flexShrink:1,backgroundColor:"#FFFFFF",alignItems:"center",justifyContent:"center",topLeftRadius:24,topRightRadius:24}:this.contentBaseView.style={flexGrow:1,height:"100%",backgroundColor:"#FFFFFF",topLeftRadius:24,alignItems:"center",justifyContent:"center",bottomLeftRadius:24}}startAnim(){this.isVertical?(this.anim1(),setTimeout((()=>{this.anim2()}),300),Pe.supportMinimumTKVersion("5.0.0")&&setTimeout((()=>{this.showAnimation()}),500)):(this.landinganim1(),setTimeout((()=>{this.landinganim2()}),300))}anim1(){this.confirmView.style={transform:{translate:{y:256}},opacity:0},this.rootView.style={opacity:1},this.contentBaseView.style={transform:{translate:{y:600}},opacity:0};const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.confirmView.style={transform:{translate:{y:256}},opacity:1},this.rootView.style={opacity:1},1)]),t.duration=300,t.repeatCount=1,this.confirmView.addAnimation(t,"basictransform")}anim2(){const t=new TKBasicAnimation;t.setStartValue((()=>{this.confirmView.style={transform:{translate:{y:256}}}})),t.setEndValue((()=>{this.confirmView.style={transform:{translate:{y:0}}}})),t.duration=500,t.repeatCount=1,this.confirmView.addAnimation(t,"basictransform1");const e=new TKBasicAnimation;e.setStartValue((()=>{this.contentBaseView.style={transform:{translate:{y:430}},opacity:0}})),e.setEndValue((()=>{this.contentBaseView.style={transform:{translate:{y:0}},opacity:1}})),e.duration=500,e.repeatCount=1,this.contentBaseView.addAnimation(e,"basictransform2")}landinganim1(){const t=new TKKeyframeAnimation;this.confirmView.style={transform:{translate:{x:328}},opacity:0},this.rootView.style={opacity:1},this.contentBaseView.style={transform:{translate:{x:600}},opacity:0},t.setAnimations([()=>(this.confirmView.style={transform:{translate:{x:328}},opacity:1},this.rootView.style={opacity:1},this.contentBaseView.style={transform:{translate:{x:600}},opacity:0},1)]),t.duration=300,t.repeatCount=1,this.confirmView.addAnimation(t,"landinganim1")}landinganim2(){const t=new TKBasicAnimation;t.setStartValue((()=>{this.confirmView.style={transform:{translate:{x:328}}}})),t.setEndValue((()=>{this.confirmView.style={transform:{translate:{x:0}}}})),t.duration=500,t.repeatCount=1,this.confirmView.addAnimation(t,"basictransform1");const e=new TKBasicAnimation;e.setStartValue((()=>{this.contentBaseView.style={transform:{translate:{x:450}},opacity:0}})),e.setEndValue((()=>{this.contentBaseView.style={transform:{translate:{x:0}},opacity:1}})),e.duration=500,e.repeatCount=1,this.contentBaseView.addAnimation(e,"basictransform2")}showAnimation(){this.fingerLottieView.setUri("bundle://image/ksad-video-confirm-card/"+(0==this.fingerStyle?"finger_swipe_vertical.json":"finger_swipe_horizontal.json")),this.fingerLottieView.play();this.fingerLottieView.onAnimationEnd((()=>{this.lottieBg&&this.contentBaseView&&this.contentBaseView.removeChild(this.lottieBg)}))}refreshActionDes(t){this.confirmContentview&&this.confirmContentview.refreshActionText(t)}}class bs extends En{constructor(t){super(),this.vm=t;const e=this;this.style={backgroundColor:"#00000060"},this.actionText=this.vm.actionText,this.setupConfirmCard(),this.vm.refreshActionDesCallBack=t=>{e.refreshActionText(t)},this.vm.skipToEndHandler=()=>{e.skipToEndHandler&&e.skipToEndHandler()},Di(this.vm,this.vm.$attrsPath.isShow,(t=>{t||e.dismiss()}))}setupConfirmCard(){if(3===this.vm.getSceneType())this.confirmView=this.getScanAggregationConfirmCard(),this.vm.sceneType=3;else this.confirmView=this.getConfirmCard();this.appendChild(this.confirmView)}showDialog(t){super.showDialog(t),3==this.vm.sceneType?this.vm.confirmExposure():this.vm.neoGiftPopupExposure(this.vm.hasGift),this.vm.isShow=!0,this.confirmView.refeshCurrentTIme(this.vm.currentPlaybackTime),this.confirmView.showConfirmCard()}refreshActionText(t){this.actionText=t,this.confirmView.refreshActionDes(t)}getConfirmCard(){this.vm.isNeedExpose=!1;let t=q(this.vm.adInfo);if(5==t||6==t||7==t||8==t)return new As(this.vm,t);if(9==t)return new An(this.vm);if(10==t)return this.vm.sceneSource=Tn.neoGift,new bn(this.vm);if(11==t)return new Fn(this.vm);if(12==t)return new Fn(this.vm,!0,!0);if(3==t||4==t)return new Rn(this.vm);if(2==t)return new Vn(this.vm);if(13==t)return new kn(this.vm,!0);if(1==t)return new Dn(this.vm);if(Pe.supportMinimumTKVersion("5.1.1")&&this.vm.adInfo.adConversionInfo.universeAggreRetainPopUps){if(0!=this.vm.screenOrientation)return new Cn(this.vm);if(14==t||16==t||17==t||18==t||19==t||21==t)return new Un(this.vm,t)}return this.vm.configInfo.abConfig.rewardContentDetainType?1==this.vm.getNeoConfirmCardType()?new An(this.vm):(this.vm.sceneSource=Tn.neoGift,new bn(this.vm)):new Cn(this.vm)}getScanAggregationConfirmCard(){return new Bn(this.vm)}}class Ss extends TKView{constructor(t){super(),this.vm=t,this.setupViews()}setupViews(){this.style={width:"100%",height:"100%"}}}class xs extends Ss{setupViews(){super.setupViews(),this.style={position:"absolute",flexDirection:"column",width:375,height:310,bottom:this.vm.positionBottom},this.setupGestureAnimViews()}setupGestureAnimViews(){this.gestureView=new TKView,this.gestureView.style={position:"absolute",flexDirection:"column",width:"100%",height:"100%"},this.appendChild(this.gestureView),this.gestureAnimView=new TKView,this.gestureAnimView.style={position:"absolute",width:375,height:250,top:0},this.gestureView.appendChild(this.gestureAnimView),this.gestureBreathAnimView=new TKView,this.gestureBreathAnimView.style={position:"absolute",width:52,height:52,top:81,left:164},this.gestureAnimView.appendChild(this.gestureBreathAnimView),this.gestureBreathAnimView.setVisibility("hidden"),this.breathBackground=new TKView,this.breathBackground.style={position:"absolute",borderRadius:10,backgroundColor:"#FF4F79",opacity:.5,width:22,height:22,top:15,left:15},this.gestureBreathAnimView.appendChild(this.breathBackground),this.breathAnim=new TKView,this.breathAnim.style={position:"absolute",borderRadius:10,backgroundColor:"#FF4F79",opacity:.2,width:22,height:22,top:15,left:15},this.gestureBreathAnimView.appendChild(this.breathAnim);const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.breathAnim.style={transform:{scale:2.3}},.5),()=>(this.breathAnim.style={transform:{scale:1}},1)]),t.duration=1e3,t.repeatCount=Number.MAX_SAFE_INTEGER,this.timer=setTimeout((()=>{this.gestureBreathAnimView.setVisibility("visible"),this.breathAnim.addAnimation(t,"handBreathAnimation")}),2800),this.gesturePathAnimView=new TKView,this.gesturePathAnimView.style={position:"absolute",width:36,height:1,top:123,left:170},this.gestureAnimView.appendChild(this.gesturePathAnimView),this.gesturePath=new TKImage,this.gesturePath.style={width:"100%",height:"100%",resize:"stretch"},ke(this.gesturePath,"icon_ksad_interact_gesture_rectangle.png"),this.gesturePathAnimView.appendChild(this.gesturePath);const e=new TKKeyframeAnimation;e.timingFunction="linear",e.setAnimations([()=>(this.gesturePathAnimView.style={opacity:0},1e-6),()=>(this.gesturePathAnimView.style={width:36,height:101,top:23,opacity:1},5/28),()=>(this.gesturePathAnimView.style={width:36,height:101,top:23},.25),()=>(this.gesturePathAnimView.style={width:36,height:1,top:123,left:170,opacity:0,transform:{rotate:90}},.250001),()=>(this.gesturePathAnimView.style={opacity:1,width:36,height:101,top:70,left:229},12/28),()=>(this.gesturePathAnimView.style={width:36,height:101,top:70,left:229},.5),()=>(this.gesturePathAnimView.style={width:36,height:1,top:123,left:170,opacity:0,transform:{rotate:180}},.500001),()=>(this.gesturePathAnimView.style={width:36,height:101,opacity:1},19/28),()=>(this.gesturePathAnimView.style={width:36,height:101},.75),()=>(this.gesturePathAnimView.style={width:36,height:1,top:123,left:168,opacity:0,transform:{rotate:270}},.750001),()=>(this.gesturePathAnimView.style={width:36,height:101,top:70,left:124,opacity:1},26/28),()=>(this.gesturePathAnimView.style={width:36,height:101,top:70,left:124},.999999),()=>(this.gesturePathAnimView.style={opacity:0},1)]),e.duration=2800,this.gesturePathAnimView.addAnimation(e,"pathAnimation"),this.gestureHandAnimView=new TKView,this.gestureHandAnimView.style={position:"absolute",width:125,height:125,top:65,left:140},this.gestureAnimView.appendChild(this.gestureHandAnimView),this.gestureHand=new TKImage,this.gestureHand.style={width:"100%",height:"100%"},ke(this.gestureHand,"icon_ksad_interact_gesture_hand.png"),this.gestureHandAnimView.appendChild(this.gestureHand);const i=new TKKeyframeAnimation;i.timingFunction="linear",i.setAnimations([()=>(this.gestureHandAnimView.style={transform:{translate:{x:0,y:-100}}},5/28),()=>(this.gestureHandAnimView.style={transform:{translate:{x:0,y:-100}}},.25),()=>(this.gestureHandAnimView.style={left:130,top:72,transform:{translate:{x:0,y:0},rotate:90}},.250001),()=>(this.gestureHandAnimView.style={transform:{translate:{x:100,y:0},rotate:90}},12/28),()=>(this.gestureHandAnimView.style={transform:{translate:{x:100,y:0},rotate:90}},.5),()=>(this.gestureHandAnimView.style={left:140,top:65,transform:{translate:{x:0,y:0},rotate:0}},.500001),()=>(this.gestureHandAnimView.style={transform:{translate:{x:0,y:100},rotate:0}},19/28),()=>(this.gestureHandAnimView.style={transform:{translate:{x:0,y:100},rotate:0}},.75),()=>(this.gestureHandAnimView.style={left:125,top:72,transform:{translate:{x:0,y:0},rotate:90}},.750001),()=>(this.gestureHandAnimView.style={transform:{translate:{x:-100,y:0},rotate:90}},26/28),()=>(this.gestureHandAnimView.style={transform:{translate:{x:-100,y:0},rotate:90}},.999999),()=>(this.gestureHandAnimView.style={top:65,left:152,transform:{translate:{x:0,y:0},rotate:30}},1)]),i.duration=2800,this.gestureHandAnimView.addAnimation(i,"handAnimation"),i.on("start",(()=>{this.onAnimStart&&this.onAnimStart()})),this.gestureTextView=new TKText,this.gestureTextView.style={position:"absolute",maxWidth:"100%",height:23,top:260,textAlign:"center",alignSelf:"center",shadow:"1 1 1 #00000020",fontSize:16,textLineHeightClamp:23,color:"#FFFFFF",fontWeight:"500",textOverflow:"ellipsis",textLineClamp:1},this.gestureTextView.setText(this.vm.getGestureActionDescription()),this.gestureView.appendChild(this.gestureTextView)}stopAllAnimatiom(){this.breathAnim&&this.breathAnim.removeAllAnimation(),this.gestureHandAnimView&&this.gestureHandAnimView.removeAllAnimation(),this.gesturePathAnimView&&this.gesturePathAnimView.removeAllAnimation(),this.removeAll()}}class Ls extends TKView{requestDraw(){}}Zn="undefined"==typeof Canvas2DView?Ls:Canvas2DView;class _s extends Zn{}class Ds extends _s{constructor(t,e,i){if(super(),this.downX=0,this.downY=0,this.upX=0,this.upY=0,this.hasConvert=!1,this.vm=t,Pe.supportMinimumTKVersion("5.0.0")){const t=new Paint,n=new Paint,s=125,a={x:300,y:300,width:s,height:s},o=new ImageResource("https://p1-lm.adukwai.com/kos/nlav111362/ksad/icon_ksad_interact_gesture_hand.png");o.load();const r=36;t.setStrokeWidth(r),t.setStyle(1),t.setJoin(1),t.setCap(0);const h=new Path;let l=0,d=0,c=0,p=0;this.addEventListener("down",(t=>{e(),c=t.position.x,p=t.position.y,this.downX=c,this.downY=p,h.reset(),h.moveTo(c,p),l=c,d=p,a.x=c-45,a.y=p-45,this.requestDraw()})),this.addEventListener("up",(t=>{this.upX=t.position.x,this.upY=t.position.y,this.eventConvert(this.downX,this.downY,this.upX,this.upY),setTimeout((()=>{i()}),200)})),this.addEventListener("pan",(e=>{let i=0,n=0;Pe.isAndroid()?(i=e.translation.deltaX+c,n=e.translation.deltaY+p):(i=e.translation.deltaX+this.downX,n=e.translation.deltaY+this.downY),c=i,p=n;a.x=c-62,a.y=p-62;let s=Math.abs(i-l),o=Math.abs(n-d);(s>=5||o>=5)&&(Pe.isAndroid()?t.setLinearGradient(this.downX,this.downY,c,p,["#FFFFFF00","#FF4F79"]):t.setLinearGradient(this.downX,this.downY,c,p,["#FF4F79","#FFFFFF00"]),h.reset(),h.moveTo(this.downX,this.downY),h.lineTo(c,p),l=i,d=n,this.requestDraw())})),this.onDraw=e=>{e.drawPath(h,t),e.drawImage(o,a,null,n)}}}eventConvert(t,e,i,n){if(1==this.hasConvert)return;const s=i-t,a=n-e;this.hasConvert=!0,Math.abs(s)>=0&&Math.abs(s)<10&&Math.abs(a)>=0&&Math.abs(a)<10?this.vm.convert({x:t,y:t}):Math.abs(s)>=Math.abs(a)?s>0?this.vm.handleSlideConvert(t,e,3):this.vm.handleSlideConvert(t,e,2):a>0?this.vm.handleSlideConvert(t,e,4):this.vm.handleSlideConvert(t,e,1)}dismiss(){!ye()&&!this.hasConvert&&this.downX&&this.downY&&this.eventConvert(this.downX,this.downY,this.upX,this.upY)}}class Fs extends TKView{constructor(t,e,i){super(),this.hasRemove=!1,this.vm=t,this.rootContainer=e,this.vm.positionBottom=i.getSize().height,this.rootContainer.insertBefore(this,i),this.rootContainer.addEventListener("tap",(t=>{})),this.setupViews(),this.vm.reportInteractGestureImpression(),ri().on(h,(t=>{this.dismiss()})),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"pageVisiable":this.vm.isPaused=!1;break;case"pageInvisiable":this.vm.isPaused=!0}})),Di(this.vm,this.vm.$attrsPath.isPaused,(t=>{t?this.vm.timerPaused():this.vm.timerResume()})),Di(this.vm,this.vm.$attrsPath.isShowEnd,(t=>{t&&this.dismiss()}))}setupViews(){this.style={position:"absolute",flexDirection:"row",justifyContent:"center",width:"100%",height:"100%"},this.interactView=new xs(this.vm),this.appendChild(this.interactView),this.gestureSlideCanvasView=new Ds(this.vm,(()=>{this.interactView.breathAnim&&this.interactView.breathAnim.removeAllAnimation(),this.interactView.gestureHandAnimView&&this.interactView.gestureHandAnimView.removeAllAnimation(),this.interactView.gesturePathAnimView&&this.interactView.gesturePathAnimView.removeAllAnimation(),this.interactView.removeAll()}),(()=>{this.dismiss()})),this.gestureSlideCanvasView.style={position:"absolute",width:"100%",height:"100%"},this.appendChild(this.gestureSlideCanvasView),this.vm.timerPlay()}dismiss(){this.hasRemove||(this.hasRemove=!0,this.gestureSlideCanvasView.dismiss(),this.interactView.stopAllAnimatiom(),this.rootContainer.removeChild(this))}}class ks extends TKView{constructor(t){super(),this.rowCount=3,this.rowHeight=32,this.currentGetTextIndex=0,this.mDanmakuRollTimer=0,this.mRowContainers=new Array,this.mLastAddRowIndex=-1,this.mTextList=t,this.setupViews()}setupViews(){this.style={flexDirection:"column",justifyContent:"space-between",alignItems:"center"};for(let t=0;t<this.rowCount;t++){let t=this.createRowListView();this.mRowContainers.push(t),this.appendChild(t)}}startRoll(){this.mDanmakuRollTimer=setInterval((()=>{if(this.currentGetTextIndex>=this.mTextList.length)return void this.stop();let t=Math.floor(Math.random()*this.rowCount);t==this.mLastAddRowIndex&&(t=(t+1)%this.rowCount),this.addDanmakuItem(this.mRowContainers[t],this.getItemText()),this.mLastAddRowIndex=t}),1500)}stop(){this.mDanmakuRollTimer&&clearInterval(this.mDanmakuRollTimer)}createRowListView(){let t=new TKView;return t.style={width:1e3,height:this.rowHeight},t}addDanmakuItem(t,e){let i=new Rs(e,this.rowHeight,(()=>{t.removeChild(i)}));i.style={position:"absolute",right:0},setTimeout((()=>{i.startTransXAnimation()}),100),t.appendChild(i)}getItemText(){let t=this.currentGetTextIndex%this.mTextList.length,e=this.mTextList[t];return this.currentGetTextIndex++,e}}class Rs extends TKView{constructor(t,e,i){super(),this.transDuration=8e3,this.transX=-700,this.mTextViewHeight=e,this.mText=t,this.mAnimEndCallback=i,this.setupViews()}setupViews(){this.style={height:this.mTextViewHeight,borderRadius:this.mTextViewHeight/2,backgroundColor:"#00000033",flexDirection:"row",paddingHorizontal:this.mTextViewHeight/2,justifyContent:"center",alignItems:"center"};let t=new TKText;t.style={fontSize:14,color:"#FFFFFF",marginRight:8},t.setText(this.mText),this.appendChild(t);let e=new TKImage;e.style={width:16,height:14},ke(e,"icon_ksad_plus_one.png"),this.appendChild(e)}startTransXAnimation(){let t=new TKBasicAnimation;t.duration=this.transDuration,t.timingFunction="linear",t.setEndValue((()=>{this.style={transform:{translate:{x:this.transX}}}})),t.on("end",this.mAnimEndCallback),this.addAnimation(t,"transX")}}class Bs extends TKView{constructor(t,e,i,n){super(),this.showAtBottom=!1,this.startPositionFunc=e,this.endPositionFunc=i,this.showAtBottom=n,this.vm=t,this.setupView(),this.setupData(),this.setupActions(),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"===t&&this.stopRotateAnimation()}))}setupActions(){this.addEventListener("tap",(e=>{this.vm.convert(1,Te(e,this),t.SHAKE_BIG_ICON_CLICK)})),this.vm.isSlideClick()&&jt(this,(()=>{this.vm.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}setupData(){this.titleView.setText("摇一摇"),this.smallTitleView.setText("摇一摇"),this.descView.setText(this.vm.getShakeSubtitle())}setupView(){let t={width:168,height:135};1==this.vm.getInteractiveStyleType()&&(t.height=150);const e=this.startPositionFunc(t);this.style={width:168,height:135,left:e.x,top:e.y,position:"absolute",justifyContent:"center",alignItems:"center"},1==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:150}),this.setVisibility("hidden"),this.appendShakeView()}loadFinish(){if(this.vm.startListenSensor(),_i(this.vm.$attrsPath.callerContext.pageFocusAndVisible,(t=>{this.vm.callerContext.hasShowPlayend||(t?this.vm.startListenSensor():this.vm.stopListenSensor())})),this.setVisibility("visible"),this.startActionAnimation(),this.showAtBottom)return void this.showAtBottomWithoutAnimation();let t=this;setTimeout((()=>{t.textDisappearAnimation(),t.changeShakeStyleAnimation()}),3600)}showAtBottomWithoutAnimation(){this.titleContainer.style={opacity:0},this.updateSubViewsBeforeChangeAnimation(),this.updateThisFinalStyle(),this.updateShakeViewTransformStyle(),this.updateShakeViewBorderStyle(),this.updateShakeAnimViewFinalStyle(),this.updateShakeImgFinalStyle()}appendShakeView(){this.clipChildren=!0,this.smallTitleContainer=new TKView,this.smallTitleContainer.style={width:107,height:30,top:6,left:-77,backgroundColor:"#00000066",borderRadius:16,borderColor:"#FFFFFF4D",borderWidth:1,opacity:1,position:"absolute",justifyContent:"flex-start",alignItems:"flex-start",visibility:"hidden"},this.appendChild(this.smallTitleContainer),this.smallTitleView=new TKText,this.smallTitleView.style={color:"#FFFFFF",fontSize:14,fontWeight:"medium",textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",marginLeft:49,height:"100%"},this.smallTitleContainer.appendChild(this.smallTitleView),this.shakeView=new TKView,this.shakeView.style={width:110,height:110,top:0,borderRadius:55,backgroundColor:"#00000066",position:"absolute"},this.appendChild(this.shakeView),this.shakeAnimView=new TKView,this.shakeAnimView.style={width:110,height:110,left:53,top:10,position:"absolute"},this.shakeAnimView.enabled=!1,this.shakeImg=new TKImage,this.shakeImg.style={width:62,height:62},this.shakeImg.enabled=!1,this.shakeAnimView.appendChild(this.shakeImg),this.appendChild(this.shakeAnimView),this.titleContainer=new TKView,this.titleContainer.style={width:168,height:65,marginTop:81,justifyContent:"center",alignItems:"center"},this.appendChild(this.titleContainer),this.titleView=new TKText,this.titleView.style={color:"#FFFFFF",fontSize:14,fontWeight:"medium",textLineClamp:1,textOverflow:"ellipsis",textAlign:"center"},this.titleContainer.appendChild(this.titleView),this.descView=new TKText,this.descView.style={color:"#FFFFFFC8",marginTop:19,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center"},this.titleContainer.appendChild(this.descView),1==this.vm.getInteractiveStyleType()&&(this.shakeView.style={width:96,height:96},this.shakeAnimView.style={width:96,height:96,top:20},this.titleContainer.style={width:168,height:65,marginTop:106},this.titleView.style={fontSize:18},this.descView.style={marginTop:4}),Re(this.shakeImg,"icon_ksad_shake_hand.png",(t=>{t&&this.loadFinish()}))}addShakeAnim(){let t=new TKKeyframeAnimation;t.animType="rotationZ";let e=Pe.isAndroid()?.8:1;t.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.25,value:Pe.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.33,value:-Pe.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.5,value:Pe.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.66,value:-Pe.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.83,value:Pe.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.91,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}];t.duration=1200,this.shakeAnimView&&this.shakeAnimView.addAnimation(t,"addShakeRotate")}startActionAnimation(){this.stopRotateAnimation(),this.addShakeAnim(),this.timer=setInterval((()=>{this.addShakeAnim()}),1200)}stopRotateAnimation(){this.timer&&clearInterval(this.timer),this.shakeAnimView&&this.shakeAnimView.removeAllAnimation()}textDisappearAnimation(){let t=new TKKeyframeAnimation;t.animType="opacity",t.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}],t.duration=500,this.titleContainer&&this.titleContainer.addAnimation(t,"textDisappear")}changeShakeStyleAnimation(){this.updateSubViewsBeforeChangeAnimation();let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.updateThisFinalStyle(),1)]),t.duration=500,t.timingFunction="EaseInEaseOut",this.addAnimation(t,"changeShakeStyleAnimation");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.shakeView.style={transform:{scale:1}},0),()=>(this.shakeView.style={transform:{scale:.7}},.5),()=>(this.updateShakeViewTransformStyle(),1)]),e.duration=500,e.timingFunction="EaseInEaseOut",this.shakeView.addAnimation(e,"changeShakeStyleAnim2");let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.updateShakeViewBorderStyle(),1)]),i.duration=500,i.timingFunction="EaseInEaseOut",this.shakeView.addAnimation(i,"changeShakeBorderAnim");let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.updateShakeAnimViewFinalStyle(),1)]),n.duration=500,n.timingFunction="EaseInEaseOut",this.shakeAnimView.addAnimation(n,"changeShakeStyleAnim3");let s=new TKKeyframeAnimation;s.setAnimations([()=>(this.updateShakeImgFinalStyle(),1)]),s.duration=500,s.timingFunction="EaseInEaseOut",this.shakeImg.addAnimation(s,"changeShakeStyleAnim4")}updateSubViewsBeforeChangeAnimation(){this.removeChild(this.titleContainer),this.titleContainer.removeChild(this.descView)}updateThisFinalStyle(){const t=this.endPositionFunc({width:109,height:46});this.style={width:46,height:46,left:t.x,top:t.y,position:"absolute",justifyContent:"center",alignItems:"center"}}updateShakeViewTransformStyle(){let t=-32,e=.4;return 1==this.vm.getInteractiveStyleType()&&(t=-25,e=.45),this.shakeView.style={transform:{translate:{y:t},scale:e}},1}updateShakeViewBorderStyle(){this.shakeView.style={borderWidth:1,borderColor:"#FFFFFF"}}updateShakeAnimViewFinalStyle(){this.shakeAnimView.style={width:60,height:60,position:"absolute",left:8,top:8}}updateShakeImgFinalStyle(){this.shakeImg.style={width:30,height:30,position:"absolute"}}stopActionAnimation(){this.stopRotateAnimation()}}class Es extends is{constructor(t){super(),this.mAdInfo=t}getName(){return"getKsPlayableAdData"}handleJsCall(t,e,i){this.onSuccess=e;try{let t=this.mAdInfo.adStyleInfo.playableExtraData;be(t)?i(-2,"not found playableExtraData in adStyleInfo"):e({playableExtraData:t})}catch(n){i(-1,"not found playableExtraData")}}}class Ks extends is{constructor(){super()}getName(){return"getKsPlayableDeviceInfo"}handleJsCall(t,e,i){this.onSuccess=e;const n=this;Ne.getKsPlayableDeviceInfo((t=>{t&&t.data&&n.onSuccess&&n.onSuccess(t.data)}))}}class Ps extends is{constructor(t){super(),this.clickTimestamp=0,this.isCanConvert=!1,this.validClickConvertTime=1e3,this.isCanConvert=t.isCanConvert,this.validClickConvertTime=t.getValidClickConvertTime(),Di(t,t.$attrsPath.isCanConvert,(t=>{this.isCanConvert=t}))}getName(){return"playableConvert"}handleJsCall(t,e,i){const n=JSON.parse(t);!be(n)&&this.canConvert()?(ye()||pi.log(2,{x:0,y:0},n),Ne.playableConvert(n),this.clickTimestamp=ue(),e(null)):i(0,"no data")}canConvert(){if(!this.isCanConvert)return!1;if(this.validClickConvertTime<=0)return!0;return!(ue()-this.clickTimestamp<this.validClickConvertTime)}}class Ms extends es{constructor(t){super(),this.renderStatus=-2,this.vm=t,Pe.supportMinimumTKVersion("4.0.11")&&(this.setShouldOverrideUrlLoadingListener((t=>!1)),this.allowDeeplinkEnabled(!1)),this.registerBridgeHandle()}render(t){Ie(t)&&this.loadUrl(t)}registerBridgeHandle(){this.setOnStartListener((()=>{console.log("KSAdPlayable=====++++++ load start")})),this.setOnFinishListener((()=>{console.log("KSAdPlayable=====++++++ load finish")})),this.setOnFailedListener(((t,e,i)=>{console.log("KSAdPlayable=====++++++ load failed:"+t+":"+e+":"+i)})),this.setJavaScriptEnabled(!0);const t=new Qn,e=this,i=new Es(this.vm.adInfo);t.registerBridgeHandler(i);const n=new rs(this.vm.configInfo);t.registerBridgeHandler(n);const s=new Ks;t.registerBridgeHandler(s);const a=new Cs(this.vm.screenOrientation);t.registerBridgeHandler(a);const o=new us((t=>{e.renderStatus=t?1:0,e.vm.renderSuccess=t}));t.registerBridgeHandler(o),this.lifestatusHandler=new ms,t.registerBridgeHandler(this.lifestatusHandler);const r=new os;t.registerBridgeHandler(r);const h=new gs;t.registerBridgeHandler(h);const l=new as;t.registerBridgeHandler(l),this.playableConvertHandler=new Ps(this.vm),t.registerBridgeHandler(this.playableConvertHandler);const d=new cs(this.vm.adStyle);t.registerBridgeHandler(d),this.registerBridgeForName(t,"KwaiAd")}willShow(){this.lifestatusHandler.lifeStatus="showStart",this.lifestatusHandler.changeLifeStatus()}didShow(){this.visible=!0,this.lifestatusHandler.lifeStatus="showEnd",this.lifestatusHandler.changeLifeStatus(),this.startDeepLinkLimited()}willHide(){this.lifestatusHandler.lifeStatus="hideStart",this.lifestatusHandler.changeLifeStatus(),this.endDeeplinkLimited()}didHide(){this.visible=!1,this.lifestatusHandler.lifeStatus="hideEnd",this.lifestatusHandler.changeLifeStatus()}pageVisiable(){this.visible=!0,this.lifestatusHandler.lifeStatus="pageVisiable",this.lifestatusHandler.changeLifeStatus()}pageInvisiable(){this.visible=!1,this.lifestatusHandler.lifeStatus="pageInvisiable",this.lifestatusHandler.changeLifeStatus()}startDeepLinkLimited(){if(Pe.supportMinimumTKVersion("4.0.11")){const t=this.vm.getPlayableDeeplinkLimitedTimeMs();if(0==t)return void this.allowDeeplinkEnabled(!0);if(-1==t)return;t>0&&(this.limitedTimer=setTimeout((()=>{this.endDeeplinkLimited()}),t))}}endDeeplinkLimited(){Pe.supportMinimumTKVersion("4.0.11")&&(this.allowDeeplinkEnabled(!0),this.limitedTimer&&(clearInterval(this.limitedTimer),this.limitedTimer=0))}allowDeeplinkEnabled(t){Pe.supportMinimumTKVersion("4.0.11")&&(this.setDeeplinkEnabled(t),this.vm.isCanConvert=t)}}class Os extends TKView{constructor(t){super(),this.vm=t,this.setupView(),this.appendChild(this.playableCard),this.setupUserTouchView()}setupUserTouchView(){0!=this.vm.playableVM.getPlayableDeeplinkLimitedTimeMs()&&Pe.supportMinimumTKVersion("4.0.11")&&(this.userTouch=new KSAdTouchInterceptView,this.userTouch.style={width:"100%",height:"100%",backgroundColor:"#00000000"},this.userTouch.setTouchDownInterceptor((t=>(this.userTouch&&(this.removeChild(this.userTouch),this.userTouch=null,this.playableCard.endDeeplinkLimited()),!0))),this.appendChild(this.userTouch))}render(){console.log("KSAdPlayableCardView load url"+this.vm.getPlayableUrl());try{return this.playableCard.render(this.vm.getPlayableUrl()),!0}catch(t){return!1}}show(){1==this.playableCard.renderStatus&&(console.log("====++++ add KSAdPlayableCardView"),this.playableCard.willShow(),this.playableCard.didShow())}setupView(){this.style={flexDirection:"row",alignItems:"center",justifyContent:"center"},this.setupWebView()}setupWebView(){try{this.playableCard=new Ms(this.vm.playableVM),this.playableCard.style={width:"100%",height:"100%",position:"absolute",left:0}}catch(t){console.log("webview error")}}}class Ns extends TKView{constructor(){super(),this.setupViews()}setupViews(){this.style={width:28,height:34,flexDirection:"column-reverse",justifyContent:"space-around",alignItems:"center"},this.mArrow1=this.createArrowUpView(),this.appendChild(this.mArrow1),this.mArrow2=this.createArrowUpView(),this.appendChild(this.mArrow2),this.mArrow3=this.createArrowUpView(),this.appendChild(this.mArrow3)}createArrowUpView(){let t=new TKImage;return t.style={width:"100%",height:18,opacity:0},t.setSrc("image/ksad-pre-landingpage-card/icon_up_arrow.png"),t}startAnimation(){let t=this.createArrowAnimation(this.mArrow1,[1,.6,.3,0,0,0]),e=this.createArrowAnimation(this.mArrow2,[0,1,.6,.3,0,0]),i=this.createArrowAnimation(this.mArrow3,[0,0,1,.6,.3,0]);this.mArrow1.addAnimation(t,"arrowUp"),this.mArrow2.addAnimation(e,"arrowUp"),this.mArrow3.addAnimation(i,"arrowUp")}stopAnimation(){this.mArrow1.removeAllAnimation(),this.mArrow2.removeAllAnimation(),this.mArrow3.removeAllAnimation()}createArrowAnimation(t,e){if(e.length<5)return null;let i=new TKKeyframeAnimation;return i.duration=600,i.timingFunction="ease-out",i.repeatCount=Number.MAX_SAFE_INTEGER,i.setAnimations([()=>(t.style={opacity:e[0]},1/6),()=>(t.style={opacity:e[1]},2/6),()=>(t.style={opacity:e[2]},.5),()=>(t.style={opacity:e[3]},4/6),()=>(t.style={opacity:e[4]},5/6),()=>(t.style={opacity:e[5]},1)]),i}}class Hs extends is{constructor(){super()}getName(){return"closeTKDialog"}handleJsCall(t,e,i){this.closeCallback&&this.closeCallback(),e(null)}}class Ws extends is{constructor(){super(),this.isMoreShow=!1,this.isPreLandingPage=!1}getName(){return"getTKPreEnv"}handleJsCall(t,e,i){e({isPreLandingPage:this.isPreLandingPage,isMoreShow:this.isMoreShow})}}class zs extends is{constructor(){super()}getName(){return"skipVideo"}handleJsCall(t,e,i){const n=JSON.parse(t);if(be(n))i(0,"no data");else{const t=n.needPromopt,i=n.needReport,s=n.showTime;this.skipCallback&&this.skipCallback(t,i,s),e(null)}}}class Us{constructor(t){this.vm=t,Pe.supportMinimumTKVersion("4.0.9")&&(this.dialog=new KSAdDialog,this.registerBridgeHandle(),this.setupView())}setupView(){this.dialog.setTemplateInfo(this.vm.getTemplateInfo())}showConfirm(){const t=this;this.dialog.show(((e,i)=>{e?t.vm.isShow=!0:this.vm.handleLeaveCallback&&this.vm.handleLeaveCallback()}))}dismiss(){this.dialog.dismiss()}registerBridgeHandle(){const t=new Qn,e=new hs(this.vm.adOriginInfo);t.registerBridgeHandler(e);const i=new rs(this.vm.configInfo);t.registerBridgeHandler(i);const n=new ds(le());t.registerBridgeHandler(n);const s=new Cs(this.vm.screenOrientation);t.registerBridgeHandler(s);const a=new zs;a.skipCallback=(t,e,i)=>{this.vm.handleLeaveCallback&&this.vm.handleLeaveCallback()},t.registerBridgeHandler(a);const o=new Hs;o.closeCallback=()=>{this.dialog.dismiss()},t.registerBridgeHandler(o);const r=new os;t.registerBridgeHandler(r);const h=new gs;t.registerBridgeHandler(h);const l=new ls(this.vm.containerLimit);t.registerBridgeHandler(l);const d=new as;t.registerBridgeHandler(d);const c=new Ws;c.isPreLandingPage=!0,t.registerBridgeHandler(c),this.dialog.registerBridge(t)}}class Gs extends TKView{constructor(t){super(),this.mDuration=150,this.mWebViewMarginTop=114,this.vm=t,this.setupViews(),this.setupConfirm(),this.renderWebView(),Di(this.vm,this.vm.$attrsPath.isSlideUp,(t=>{t?this.slideUp():this.slideDown()})),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"showEnd"==t&&Pe.supportMinimumTKVersion("4.0.11")&&this.mWebView.setDeeplinkEnabled(!0)})),this.vm.backPressedCallback=()=>{this.vm.isSlideUp?this.handleBackClick():this.vm.topBarVM.handleClose()},this.setVisibility("hidden")}setupViews(){this.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-start"},this.appendChild(this.createBgImageView()),this.appendChild(this.createTopView()),this.appendChild(this.createContentView()),this.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),this.mContentView.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),this.vm.topBarVM.convertForOtherArea=e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)}}setupConfirm(){this.confirmDialog=new Us(this.vm.confirmVM);const t=this;this.vm.confirmVM.handleLeaveCallback=()=>{t.confirmDialog.dismiss(),this.vm.isSlideUp=!1}}createBgImageView(){this.mBgImageView=new TKImage,this.mBgImageView.style={width:"100%",height:"100%",position:"absolute",left:0,right:0,bottom:0,top:0};let t=this.vm.getPlayEndBgUrl();return this.mBgImageView.setSrc(t),this.mBgImageView}show(){Pe.supportMinimumTKVersion("4.0.11")&&this.mWebView.setDeeplinkEnabled(!0),this.showCardAnimation(),this.setVisibility("visible"),this.vm.reportPreFormImpression()}createTopView(){this.mTopView=new TKView,this.mTopView.style={width:"100%",height:64+(Ce()?20:0),paddingTop:20,backgroundColor:"#FFFFFF",opacity:0,flexDirection:"column",justifyContent:"center",alignItems:"center"};let t=new TKView;return t.style={width:"100%",height:44,bottom:0,position:"absolute",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.mTitleText=new TKText,this.mTitleText.style={width:"100%",height:"100%",position:"absolute",color:"#000000",fontWeight:"medium",fontSize:18,textAlign:"center"},this.mTitleText.setText(this.vm.getTopBarTitle()),t.appendChild(this.mTitleText),this.mBackBtn=new TKImage,this.mBackBtn.style={width:11,height:18,marginLeft:22,marginRight:22},this.mBackBtn.setSrc("image/ksad-pre-landingpage-card/icon_actionbar_back.png"),t.appendChild(this.mBackBtn),this.mCloseBtn=new TKImage,this.mCloseBtn.style={width:14,height:14},this.mCloseBtn.setSrc("image/ksad-pre-landingpage-card/icon_actionbar_close.png"),t.appendChild(this.mCloseBtn),this.mBackBtn.addEventListener("tap",(()=>{this.handleBackClick()})),this.mCloseBtn.addEventListener("tap",(()=>{this.handleCloseClick()})),this.mTopView.appendChild(t),this.mTopView}handleBackClick(){this.vm.needShowConfimDialog()?this.confirmDialog.showConfirm():this.vm.isSlideUp=!1}handleCloseClick(){this.vm.needShowConfimDialog()?this.confirmDialog.showConfirm():this.vm.isSlideUp=!1}createContentView(){return this.mContentView=new TKView,this.mContentView.style={flexBasis:300,flexGrow:1,flexShrink:1,flexDirection:"column"},this.mContentBgView=new TKView,this.mContentBgView.style={width:"100%",height:140,position:"absolute",left:0,top:0,right:0,gradientBgColor:"90,0000009E,00000000"},this.mContentBgView.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),this.mContentView.appendChild(this.mContentBgView),this.mWebViewContainer=new TKView,this.mWebViewContainer.style={width:"100%",height:"100%",top:this.mWebViewMarginTop+80,position:"absolute",left:0,right:0},this.setupWebView(),this.mWebViewContainer.appendChild(this.mWebView),this.mUpSlideView=this.createUpSlideTipsView(),this.mWebViewContainer.appendChild(this.mUpSlideView),this.mContentView.appendChild(this.mWebViewContainer),this.mContentMaskView=this.createContentMaskView(),this.mContentView.appendChild(this.mContentMaskView),this.mContentView}createContentMaskView(){let e=new TKView;e.style={width:"100%",height:"100%",position:"absolute",top:this.vm.isAppAdvance()?this.mWebViewMarginTop:0},e.addEventListener("tap",(e=>{this.vm.handleAdClick(t.INTERACT_LANDING_PAGE_CLICK,e)})),e.addEventListener("swipe",(()=>{this.vm.handleAdClick(t.INTERACT_LANDING_PAGE_CLICK,null)}));let i=new TKView;return i.style={width:"100%",height:this.mWebViewMarginTop,position:"absolute",top:0},i.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),i.addEventListener("swipe",(()=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,null)})),e.appendChild(i),e}setupWebView(){if(Pe.supportMinimumTKVersion("4.0.9"))try{this.mWebView=new KSAdWebView,this.mWebView.style={width:"100%",height:"100%",backgroundColor:"#FFFFFF00",topLeftRadius:20,topRightRadius:20,position:"absolute",top:0,left:0,right:0};let t=new S;t.is_special_preload=1;let e={clientExtData:JSON.stringify(t)};this.mWebView.setOnStartListener((()=>{})),this.mWebView.setOnFinishListener((()=>{this.vm.pageLoaded||(Ne.sendLog({actionType:51,payload:JSON.stringify(e)}),this.vm.pageLoaded=!0)})),this.mWebView.setOnFailedListener(((t,i,n)=>{Ne.sendLog({actionType:59,payload:JSON.stringify(e)}),this.vm.pageLoadedFailed=!0})),this.mWebView.setJavaScriptEnabled(!0),this.mWebView.setAllowFileAccess(!0),this.mWebView.setAllowFileAccessFromFileURLs(!1),this.mWebView.setAllowUniversalAccessFromFileURLs(!1),this.mWebView.setAllowContentAccess(!0),this.mWebView.setMixedContentMode(0),this.mWebView.setScrollEnabled(!0),Pe.supportMinimumTKVersion("4.0.11")&&this.mWebView.setDeeplinkEnabled(!1)}catch(t){console.log("jky webview error")}}renderWebView(){this.vm.getLandingPageUrl((t=>{be(t)?this.vm.pageLoadedFailed=!0:this.mWebView.loadUrl(t)}))}createUpSlideTipsView(){let t=new TKView;t.style={topLeftRadius:20,topRightRadius:20,height:140,width:"100%",gradientBgColor:"90,00000000,00000040",flexDirection:"column",alignItems:"center"},this.mSlideUpIconView=new Ns,this.mSlideUpIconView.style={top:7,alignSelf:"center",position:"absolute"},t.appendChild(this.mSlideUpIconView);let e=new TKText;return e.style={top:48,fontSize:12,color:"#F4F4F4",alignSelf:"center"},e.setText("上滑/点击查看更多"),t.appendChild(e),t}showCardAnimation(){let t=new TKKeyframeAnimation;t.duration=300,t.timingFunction="EaseOut",t.setAnimations([()=>(this.mWebViewContainer.style={opacity:0,top:this.mWebViewMarginTop+80},0),()=>(this.mWebViewContainer.style={opacity:0,top:this.mWebViewMarginTop+80},.5),()=>(this.mWebViewContainer.style={opacity:1,top:this.mWebViewMarginTop},1)]),t.on("end",(()=>{this.mSlideUpIconView.startAnimation(),this.leadSlideUp()})),this.mWebViewContainer.addAnimation(t,"showAnimation")}leadSlideUp(){let t=new TKKeyframeAnimation;t.duration=600,t.timingFunction="EaseOut",t.repeatCount=Number.MAX_SAFE_INTEGER,t.setAnimations([()=>1/3,()=>(this.mWebViewContainer.style={transform:{translate:{y:14}}},5/6),()=>(this.mWebViewContainer.style={transform:{translate:{y:0}}},1)]),this.mWebViewContainer.addAnimation(t,"leadSlideUpAnima")}slideUp(){if(1==this.mTopView.style.opacity)return;this.mWebViewContainer.removeAllAnimation();let t=new TKBasicAnimation;t.duration=this.mDuration,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mWebViewContainer.style={top:0}}));let e=new TKBasicAnimation;e.duration=this.mDuration,e.timingFunction="EaseOut",e.setEndValue((()=>{this.mTopView.style={opacity:1}}));let i=new TKBasicAnimation;i.duration=this.mDuration,i.timingFunction="EaseOut",i.setEndValue((()=>{this.mUpSlideView.style={opacity:0}})),e.on("end",(()=>{this.mWebView.style={backgroundColor:"#FFFFFF",topLeftRadius:0,topRightRadius:0}})),this.mContentMaskView.style={visibility:"hidden"},this.mWebViewContainer.addAnimation(t,"upSlideAnim"),this.mTopView.addAnimation(e,"upSlideAnim"),this.mUpSlideView.addAnimation(i,"upSlideAnim")}slideDown(){if(0==this.mTopView.style.opacity)return;this.mWebViewContainer.removeAllAnimation();let t=new TKBasicAnimation;t.duration=this.mDuration,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mWebViewContainer.style={top:this.mWebViewMarginTop}}));let e=new TKBasicAnimation;e.duration=this.mDuration,e.timingFunction="EaseOut",e.setStartValue((()=>{this.mWebView.style={backgroundColor:"#FFFFFF00",topLeftRadius:20,topRightRadius:20}})),e.setEndValue((()=>{this.mTopView.style={opacity:0}}));let i=new TKBasicAnimation;i.duration=this.mDuration,i.timingFunction="EaseOut",i.setEndValue((()=>{this.mUpSlideView.style={opacity:1}})),this.mContentMaskView.style={visibility:"visible"},t.on("end",(()=>{this.leadSlideUp()})),this.mWebViewContainer.addAnimation(t,"downSlideAnim"),this.mTopView.addAnimation(e,"downSlideAnim"),this.mUpSlideView.addAnimation(i,"downSlideAnim")}}class js{constructor(t,e,i){this.xDegree=t,this.yDegree=e,this.zDegree=i}}class Ys{constructor(t){this.radFlag=!1,this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antiXFlag=!1,this.antiYFlag=!1,this.antiZFlag=!1,this.bidirectionalSwitch=!1,this.NS2S=1e-9,this.rotateInfo=t,this.bidirectionalSwitch=function(t){try{return t.bidirectionalSwitch}catch(e){}return!1}(t)}beforeMonitor(){this.startTime=Pe.isAndroid()?0:ue()/1e3,this.maxSensorInfo=new js(0,0,0),this.xDegree=0,this.yDegree=0,this.zDegree=0}resetValues(){this.xDegree=0,this.yDegree=0,this.zDegree=0}canConvertRotate(t){try{if(!be(t)&&!be(t.values)){if(!this.radFlag){this.xOriginOmiga=0,this.yOriginOmiga=0,this.zOriginOmiga=0;let i=-1;try{i=de().abConfig.rotateProgressIncreaseCompatible}catch(e){}i>=0&&(t.values[0]>i&&(this.xOriginOmiga=t.values[0]),t.values[1]>i&&(this.yOriginOmiga=t.values[1]),t.values[2]>i&&(this.zOriginOmiga=t.values[2])),this.radFlag=!0}let i=!1,n=!1,s=!1,a=0;Pe.isAndroid()?(0!=this.startTime&&(a=(t.timestamp-this.startTime)*this.NS2S),this.startTime=t.timestamp):(a=t.timestamp/1e3-this.startTime,this.startTime=t.timestamp/1e3),this.xDegree+=a*(t.values[0]-this.xOriginOmiga)*180/Math.PI,this.yDegree+=a*(t.values[1]-this.yOriginOmiga)*180/Math.PI,this.zDegree+=a*(t.values[2]-this.zOriginOmiga)*180/Math.PI;let o=new js(this.xDegree,this.yDegree,this.zDegree);if(Math.abs(o.xDegree)>Math.abs(this.maxSensorInfo.xDegree)&&(this.maxSensorInfo.xDegree=o.xDegree),Math.abs(o.yDegree)>Math.abs(this.maxSensorInfo.yDegree)&&(this.maxSensorInfo.yDegree=o.yDegree),Math.abs(o.zDegree)>Math.abs(this.maxSensorInfo.zDegree)&&(this.maxSensorInfo.zDegree=o.zDegree),this.bidirectionalSwitch)return this.bidirectionRotateConvert(o);i=this.canConvertCurrentDegree(o.xDegree,this.rotateInfo.x),n=this.canConvertCurrentDegree(o.yDegree,this.rotateInfo.y),s=this.canConvertCurrentDegree(o.zDegree,this.rotateInfo.z);let r=i||n||s;return r&&(this.radFlag=!1),r}}catch(i){}return!1}bidirectionRotateConvert(t){t.xDegree>0&&!this.xFlag?this.xFlag=this.canConvertCurrentDegree(t.xDegree,this.rotateInfo.x):t.xDegree<0&&!this.antiXFlag&&(this.antiXFlag=this.canConvertCurrentDegree(t.xDegree,this.rotateInfo.x)),t.yDegree>0&&!this.yFlag?this.yFlag=this.canConvertCurrentDegree(t.yDegree,this.rotateInfo.y):t.yDegree<0&&!this.antiYFlag&&(this.antiYFlag=this.canConvertCurrentDegree(t.yDegree,this.rotateInfo.y)),t.zDegree>0&&!this.zFlag?this.zFlag=this.canConvertCurrentDegree(t.zDegree,this.rotateInfo.z):t.zDegree<0&&!this.antiZFlag&&(this.antiZFlag=this.canConvertCurrentDegree(t.zDegree,this.rotateInfo.z));let e=this.xFlag&&this.antiXFlag,i=this.yFlag&&this.antiYFlag,n=this.zFlag&&this.antiZFlag,s=e||i||n;return s&&(console.log("bidirection function canRotate, x:"+e+"===y:"+i+"===z:"+n),this.resetFlag()),s}resetFlag(){this.xFlag=!1,this.antiXFlag=!1,this.yFlag=!1,this.antiYFlag=!1,this.zFlag=!1,this.antiZFlag=!1,this.radFlag=!1}canConvertCurrentDegree(t,e){if(e.rotateDegree<0)return!1;let i=!0,n=0==e.rotateDegree?45:e.rotateDegree;switch(e.direction){case 1:i=t<0&&Math.abs(t)>=n;break;case 2:i=t>0&&Math.abs(t)>=n;break;default:i=Math.abs(t)>=n}return i&&this.bidirectionalSwitch&&this.resetValues(),i}maxRotateContent(){return JSON.stringify({x:Math.round(this.maxSensorInfo.xDegree),y:Math.round(this.maxSensorInfo.yDegree),z:Math.round(this.maxSensorInfo.zDegree)})}}class Xs{constructor(t){this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antixFlag=!1,this.antiyFlag=!1,this.antizFlag=!1,this.canShakeCount=0,this.interactiveInfo=t}bidireationShakeConvert(t){let e=this.canBidireationShake(t);return ye()?this.canShakeCount>2&&(console.log("bidirection function android success convert, current canShakeCount:"+this.canShakeCount),this.canShakeCount=0,!0):e}canBidireationShake(t){t[0]>0&&!this.xFlag?this.xFlag=this.computeAcceleration(t[0]):t[0]<0&&!this.antixFlag&&(this.antixFlag=this.computeAcceleration(t[0])),t[1]>0&&!this.yFlag?this.yFlag=this.computeAcceleration(t[1]):t[1]<0&&!this.antiyFlag&&(this.antiyFlag=this.computeAcceleration(t[1])),t[2]>0&&!this.zFlag?this.zFlag=this.computeAcceleration(t[2]):t[2]<0&&!this.antizFlag&&(this.antizFlag=this.computeAcceleration(t[2]));let e=this.xFlag&&this.antixFlag,i=this.yFlag&&this.antiyFlag,n=this.zFlag&&this.antizFlag,s=e||i||n;return s&&(console.log("bidirection function canShake, x:"+e+"===y:"+i+"===z:"+n),this.canShakeCount++,this.resetFlag()),s}computeAcceleration(t){let e=Math.abs(t-9.81);return Math.abs(t)>=Wt(this.interactiveInfo)&&e>=.05}resetFlag(){this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antixFlag=!1,this.antiyFlag=!1,this.antizFlag=!1}}class Js{constructor(t){this.gravity=9.81,this.minError=.05,this.accelerationThreshold=Wt(t),this.bidireationalSwitch=zt(t.shakeInfo),this.bidirectionalRotateShakeUtil=new Xs(t),this.lastValue=new Array,this.lastValue[0]=0,this.lastValue[1]=0,this.lastValue[2]=0}beforeMonitor(){this.maxAcceleration=0}resetValues(){this.lastValue=new Array,this.lastValue[0]=0,this.lastValue[1]=0,this.lastValue[2]=0}canConvertShake(t){try{if(!be(t)&&!be(t.values)){if(t=this.noiseReduction(t),this.isInvalidValue(t.values))return!1;this.lastValue=t.values;let e=t.values[0],i=t.values[1],n=t.values[2];return this.bidireationalSwitch?(this.maxAcceleration=Math.max(Math.max(Math.abs(e),Math.abs(i)),Math.abs(n)),this.bidirectionalRotateShakeUtil.bidireationShakeConvert(t.values)):(this.maxAcceleration=Math.sqrt(e*e+i*i+n*n),this.maxAcceleration>=this.accelerationThreshold)}}catch(e){}return!1}isInvalidValue(t){let e=Math.abs(Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]));return!!(Math.abs(e-this.gravity)<=this.minError&&Pe.isAndroid())}noiseReduction(t){let e=.6;return 0==this.lastValue[0]&&0==this.lastValue[1]&&0==this.lastValue[2]&&(e=1),this.lastValue[0]=e*t.values[0]+(1-e)*this.lastValue[0],this.lastValue[1]=e*t.values[1]+(1-e)*this.lastValue[1],this.lastValue[2]=e*t.values[2]+(1-e)*this.lastValue[2],t.values[0]=this.lastValue[0],t.values[1]=this.lastValue[1],t.values[2]=this.lastValue[2],t}}class $s{constructor(t,e,i){this.xDegree=t,this.yDegree=e,this.zDegree=i}}class qs{constructor(t){this.rotationMatrix=new Array(9),this.simulatedGyroscopeValues=[],this.originRotateDegree=[],this.mRotateDegree=[],this.isInitValidValue=!1,this.rotateInfo=t,this.resetMaxRotateInfo()}resetMaxRotateInfo(){this.maxSensorInfo=new $s(0,0,0)}handleImitateSensorData(t,e,i,n=(t=>{})){if(0!=e.length&&0!=t.length){if(this.getRotationMatrix(this.rotationMatrix,null,t,e),this.getOrientation(this.rotationMatrix,this.simulatedGyroscopeValues),this.mRotateDegree[0]=180*this.simulatedGyroscopeValues[0]/Math.PI,this.mRotateDegree[1]=180*this.simulatedGyroscopeValues[1]/Math.PI,this.mRotateDegree[2]=180*this.simulatedGyroscopeValues[2]/Math.PI,!this.isInitValidValue&&(0!=this.mRotateDegree[0]||0!=this.mRotateDegree[1]||0!=this.mRotateDegree[2])){this.isInitValidValue=!0;let t=new Array(3);t[0]=this.mRotateDegree[0],t[1]=this.mRotateDegree[1],t[2]=this.mRotateDegree[2],this.originRotateDegree=t}this.mRotateDegree[0]=this.mRotateDegree[0]-this.originRotateDegree[0],this.mRotateDegree[1]=this.mRotateDegree[1]-this.originRotateDegree[1],this.mRotateDegree[2]=this.mRotateDegree[2]-this.originRotateDegree[2],!be(this.mRotateDegree)&&n&&n(this.mRotateDegree),this.canConvertRotate(this.mRotateDegree)&&(i&&i(this.maxRotateContent()),this.resetMaxRotateInfo())}}canConvertRotate(t){try{if(!be(t)){let e=!1,i=!1,n=!1;return Math.abs(t[0])>Math.abs(this.maxSensorInfo.xDegree)&&(this.maxSensorInfo.xDegree=t[0]),Math.abs(t[1])>Math.abs(this.maxSensorInfo.yDegree)&&(this.maxSensorInfo.yDegree=t[1]),Math.abs(t[2])>Math.abs(this.maxSensorInfo.zDegree)&&(this.maxSensorInfo.zDegree=t[2]),e=this.canConvertCurrentDegree(t[0],this.rotateInfo.x),i=this.canConvertCurrentDegree(t[1],this.rotateInfo.y),n=this.canConvertCurrentDegree(t[2],this.rotateInfo.z),e||i||n}}catch(e){}return!1}canConvertCurrentDegree(t,e){if(e.rotateDegree<0)return!1;let i=!0,n=0==e.rotateDegree?45:e.rotateDegree;switch(e.direction){case 1:i=t<0&&Math.abs(t)>=n;break;case 2:i=t>0&&Math.abs(t)>=n;break;default:i=Math.abs(t)>=n}return i}maxRotateContent(){return JSON.stringify({x:Math.round(this.maxSensorInfo.xDegree),y:Math.round(this.maxSensorInfo.yDegree),z:Math.round(this.maxSensorInfo.zDegree),useImitateRotate:!0})}getRotationMatrix(t,e,i,n){try{let s=i[0],a=i[1],o=i[2],r=9.81;if(s*s+a*a+o*o<.01*r*r)return!1;let h=n[0],l=n[1],d=n[2],c=l*o-d*a,p=d*s-h*o,m=h*a-l*s,g=Math.sqrt(c*c+p*p+m*m);if(g<.1)return!1;let u=1/g;c*=u,p*=u,m*=u;let w=1/Math.sqrt(s*s+a*a+o*o);s*=w,a*=w,o*=w;let C=a*m-o*p,f=o*c-s*m,y=s*p-a*c;if(null!=t&&(9==t.length?(t[0]=c,t[1]=p,t[2]=m,t[3]=C,t[4]=f,t[5]=y,t[6]=s,t[7]=a,t[8]=o):16==t.length&&(t[0]=c,t[1]=p,t[2]=m,t[3]=0,t[4]=C,t[5]=f,t[6]=y,t[7]=0,t[8]=s,t[9]=a,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1)),null!=e){let t=1/Math.sqrt(h*h+l*l+d*d),i=(h*C+l*f+d*y)*t,n=(h*s+l*a+d*o)*t;9==e.length?(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=i,e[5]=n,e[6]=0,e[7]=-n,e[8]=i):16==e.length&&(e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=i,e[6]=n,e[8]=0,e[9]=-n,e[10]=i,e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1)}}catch(s){return!1}return!0}getOrientation(t,e){try{9==t.length?(e[0]=Math.atan2(t[1],t[4]),e[1]=Math.asin(-t[7]),e[2]=Math.atan2(-t[6],t[8])):(e[0]=Math.atan2(t[1],t[5]),e[1]=Math.asin(-t[9]),e[2]=Math.atan2(-t[8],t[10]))}catch(i){}return e}}class Zs{constructor(t){this.rotateInfo=t}registerImitateRotateSensorListener(t,e=(t=>{})){if(!Pe.supportMinimumTKVersion("5.0.5")||!Pe.isAndroid())return;if(!KSAdSensorManager.supportSensor(3)||!KSAdSensorManager.supportSensor(5))return;this.imtateRotateHandler=new qs(this.rotateInfo);let i=[],n=[];try{KSAdSensorManager.registerSensorListener(3,-3,(s=>{i=s.values,this.imtateRotateHandler.handleImitateSensorData(i,n,t,e)})),KSAdSensorManager.registerSensorListener(5,-3,(s=>{n=s.values,this.imtateRotateHandler.handleImitateSensorData(i,n,t,e)}))}catch(s){}}unRegisterImitateRotateSensorListener(){Pe.supportMinimumTKVersion("5.0.5")&&Pe.isAndroid()&&(KSAdSensorManager.unregisterSensorListener(3),KSAdSensorManager.unregisterSensorListener(5))}}class Qs{constructor(t){this.isListeningSeneor=!1,this.interactionInfo=t}startSensorListener(t,e){var i,n,s,a;this.isListeningSeneor||(this.isListeningSeneor=!0,(null===(n=null===(i=this.interactionInfo)||void 0===i?void 0:i.rotateInfo)||void 0===n?void 0:n.enable)&&this.startRotateListener(t,e),(null===(a=null===(s=this.interactionInfo)||void 0===s?void 0:s.shakeInfo)||void 0===a?void 0:a.enable)&&this.startShakeListener(t,e))}startRotateListener(t,e){var i,n;if("undefined"!=typeof KSAdSensorManager)if(this.initializeRotateHandler(this.interactionInfo.rotateInfo),this.rotateHandler.beforeMonitor(),KSAdSensorManager.supportSensor(2))try{KSAdSensorManager.registerSensorListener(2,-3,(i=>{try{if(e&&e(this.rotateHandler,this.shakeHandler,!1),this.rotateHandler&&this.rotateHandler.canConvertRotate(i)){t&&this.isListeningSeneor&&t(!1,0,this.rotateHandler.maxRotateContent()),this.stopSensorListener();try{KSAdSystemUtil.startVibrate(200)}catch(n){Je(we(n))}}}catch(n){Je("outerError:"+we(n))}}))}catch(s){}else{if(this.rotateHandler.bidirectionalSwitch)return;(null===(n=null===(i=this.interactionInfo)||void 0===i?void 0:i.rotateInfo)||void 0===n?void 0:n.useImitateRotate)&&(this.sensorImitateRotateUtil=new Zs(this.interactionInfo.rotateInfo),this.sensorImitateRotateUtil.registerImitateRotateSensorListener((e=>{try{if(!be(e)){t&&this.isListeningSeneor&&t(!1,0,e),this.stopSensorListener();try{KSAdSystemUtil.startVibrate(200)}catch(s){Je(we(s))}}}catch(s){Je("outerError:"+we(s))}}),(t=>{e&&t&&t.length>2&&(this.rotateHandler.xDegree=t[0],this.rotateHandler.yDegree=t[1],this.rotateHandler.zDegree=t[2],e(this.rotateHandler,null,!1))})))}}startShakeListener(t,e){if("undefined"!=typeof KSAdSensorManager){this.initializeShakeHandler(),this.shakeHandler.beforeMonitor();try{KSAdSensorManager.registerSensorListener(1,-3,(i=>{e&&e(this.rotateHandler,this.shakeHandler,!0),this.shakeHandler&&this.shakeHandler.canConvertShake(i)&&(KSAdSystemUtil.startVibrate(200),t&&this.isListeningSeneor&&t(!0,this.shakeHandler.maxAcceleration,""),this.stopSensorListener())}))}catch(i){}}}stopSensorListener(){this.isListeningSeneor=!1,this.stopRotateListener(),this.stopShakeListener()}stopRotateListener(){var t,e;"undefined"!=typeof KSAdSensorManager&&(null===(e=null===(t=this.interactionInfo)||void 0===t?void 0:t.rotateInfo)||void 0===e?void 0:e.enable)&&(this.sensorImitateRotateUtil?this.sensorImitateRotateUtil.unRegisterImitateRotateSensorListener():KSAdSensorManager.unregisterSensorListener(2))}stopShakeListener(){var t,e;"undefined"!=typeof KSAdSensorManager&&(null===(e=null===(t=this.interactionInfo)||void 0===t?void 0:t.shakeInfo)||void 0===e?void 0:e.enable)&&KSAdSensorManager.unregisterSensorListener(1)}initializeShakeHandler(){this.shakeHandler=new Js(this.interactionInfo)}initializeRotateHandler(t){this.rotateHandler=new Ys(t)}getRotateHandler(){return this.rotateHandler}getShakeHandler(){return this.shakeHandler}static reportRotateSensorStatus(t){if(Pe.supportMinimumTKVersion("5.0.5")&&Pe.isAndroid())try{!function(t){qe({status:5001,ad_style:t})}(t),KSAdSensorManager.supportSensor(1)||function(t){qe({status:5011,ad_style:t})}(t);let e=!1;KSAdSensorManager.supportSensor(2)||(e=!0,function(t){qe({status:5002,ad_style:t})}(t));let i=!1;KSAdSensorManager.supportSensor(3)||(i=!0,function(t){qe({status:5003,ad_style:t})}(t));let n=!1;KSAdSensorManager.supportSensor(5)||(n=!0,function(t){qe({status:5004,ad_style:t})}(t));let s=!1;KSAdSensorManager.supportSensor(4)||(s=!0,function(t){qe({status:5008,ad_style:t})}(t)),i&&s&&function(t){qe({status:5009,ad_style:t})}(t),i&&n&&function(t){qe({status:5005,ad_style:t})}(t),e&&(i||n)&&function(t){qe({status:5007,ad_style:t})}(t),e&&(i||s)&&function(t){qe({status:5010,ad_style:t})}(t)}catch(e){!function(t,e){qe({status:5006,error_msg:t,ad_style:e})}(we(e),t)}}}class ta extends TKView{constructor(t,e,i,n){super(),this.showAtBottom=!1,this.startPositionFunc=e,this.endPositionFunc=i,this.showAtBottom=n,this.vm=t,this.setupView(),this.setupData(),this.setupActions(),this.vm.elementImpression(),Qs.reportRotateSensorStatus(this.vm.callerContext.adStyle),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"===t&&this.stopActionAnimation(),"pageVisiable"===t&&this.resumeLottieAnimation(),"pageInvisiable"===t&&this.pauseLottieAnimation()})),this.updateDownloadState()}updateDownloadState(){Di(this.vm,this.vm.$attrsPath.downloadState,(t=>{switch(t){case 0:case 1:case 4:case 5:case 6:break;case 2:this.vm.canRotateConvert=!1;break;case 3:this.vm.canRotateConvert=!0}}))}updateDesTest(t){this.vm.isShowRotateAndShakeView()&&this.descView.setText(t)}setupActions(){this.addEventListener("tap",(t=>{this.vm.clickLog(t,this)})),this.vm.isSlideClick()&&jt(this,(()=>{this.vm.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}setupData(){this.vm.isShowRotateAndShakeView()?this.titleView.setText(this.vm.interactionInfo.componentInfo.btnTitle):this.titleView.setText(this.vm.interactionInfo.rotateInfo.title),this.descView.setText(this.vm.getRotateSubtitle())}setupView(){let t={width:168,height:135};1==this.vm.getInteractiveStyleType()&&(t.height=150);const e=this.startPositionFunc(t);this.style={width:168,height:135,left:e.x,top:e.y,position:"absolute",alignItems:"center"},this.rotateContainer=new TKView,this.rotateContainer.style={width:110,height:110,backgroundColor:"#00000064",borderRadius:55,position:"absolute",alignItems:"center"},1==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:150},this.rotateContainer.style={width:96,height:96,borderRadius:48}),this.appendChild(this.rotateContainer),this.setVisibility("hidden"),this.appendRotateView(),this.loadFinish()}loadFinish(){this.bindSensorListener(),this.setVisibility("visible");let t=this;if(this.vm.isShowRotateAndShakeView())return this.vm.rotateShakeUiStyle=this.vm.getBtnStyle(),void this.startShakeAnimation();if(this.showAtBottom)return void this.showAtBottomWithoutAnimation();let e=this.needChangeRotateView()?4300:4700;setTimeout((()=>{Pe.supportMinimumTKVersion("5.0.0")&&this.rotateView.pause(),setTimeout((()=>{Pe.supportMinimumTKVersion("5.0.0")&&this.rotateView.resume(),t.textDisappearAnimation(),t.startChangeShakeStyleAnimation()}),500),setTimeout((()=>{this.addWhiteLine()}),1e3)}),e)}showAtBottomWithoutAnimation(){this.titleContainer.style={opacity:0},this.updateThisFinalStyle(),this.updateRotateContainerFinalFrameStyle(),this.updateRotateContainerFinalBorderStyle()}appendRotateLottieView(){Pe.supportMinimumTKVersion("5.0.0")&&(this.rotateView=new TKLottieImageView,this.setRotateLottieView("image/ksad-video-image/neo_rotate.json",this.rotateView,!0),this.rotateView.style={width:105,height:105,position:"absolute"})}setRotateLottieView(t,e,i){e.setUri(t),e.setLoop(i),i&&setTimeout((()=>{e.play()}),1e3),this.rotateContainer.appendChild(e)}appendRotateView(){this.clipChildren=!0,this.appendRotateLottieView(),this.appendTitleContiner()}appendTitleContiner(){this.titleContainer=new TKView,this.titleContainer.style={width:168,height:49,marginTop:81,justifyContent:"center",alignItems:"center"},1==this.vm.getInteractiveStyleType()&&(this.titleContainer.style={marginTop:106}),this.appendChild(this.titleContainer),this.appendTitleView()}appendTitleView(){this.titleView=new TKText,this.titleView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",fontSize:18,fontWeight:"medium",textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1},(2==this.vm.getInteractiveStyleType()||this.vm.isOriginRotateStyle())&&(this.titleView.style={fontSize:14}),this.titleContainer.appendChild(this.titleView),this.appendDescView()}appendDescView(){this.descView=new TKText,this.descView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",marginTop:19,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1},1==this.vm.getInteractiveStyleType()&&(this.descView.style={marginTop:4}),this.titleContainer.appendChild(this.descView)}textDisappearAnimation(){let t=new TKKeyframeAnimation;t.animType="opacity",t.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}],t.duration=500,this.titleContainer&&this.titleContainer.addAnimation(t,"textDisappear")}needChangeRotateView(){return!0}startChangeShakeStyleAnimation(){this.changeShakeStyleAnimation()}changeShakeStyleAnimation(){this.titleContainer&&(this.titleContainer.removeChild(this.descView),this.removeChild(this.titleContainer));let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.updateThisFinalStyle(),1)]),t.duration=400,t.timingFunction="EaseInEaseOut",this.addAnimation(t,"changeShakeStyleAnimation");let e=new TKKeyframeAnimation;if(e.setAnimations([()=>(this.rotateContainer.style={transform:{scale:1}},0),()=>(this.rotateContainer.style={transform:{scale:.6}},.5),()=>(this.updateRotateContainerFinalFrameStyle(),1)]),e.duration=500,e.timingFunction="EaseInEaseOut",this.rotateContainer.addAnimation(e,"changeShakeStyleAnim2"),2==this.vm.getInteractiveStyleType()||this.vm.isOriginRotateStyle()){let t=new TKKeyframeAnimation,e=0;1!=this.vm.getInteractiveStyleType()&&this.vm.isOriginRotateStyle()&&(e=5),t.setAnimations([()=>(this.rotateView.style={transform:{scale:1}},0),()=>(this.rotateView.style={transform:{scale:1.2}},.5),()=>(this.rotateView.style={transform:{translate:{y:e},scale:1.4}},1)]),t.duration=500,t.timingFunction="EaseInEaseOut",this.rotateView.addAnimation(t,"adapterAnim")}}addWhiteLine(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.updateRotateContainerFinalBorderStyle(),1)]),t.duration=500,t.timingFunction="EaseInEaseOut",this.rotateContainer.addAnimation(t,"changeShakeStyleAnim3")}updateThisFinalStyle(){const t=this.endPositionFunc({width:109,height:46});this.style={width:109,height:46,left:t.x,top:t.y,position:"absolute",justifyContent:"center",alignItems:"center"}}updateRotateContainerFinalFrameStyle(){let t=.45;if((2==this.vm.getInteractiveStyleType()||this.vm.isOriginRotateStyle())&&(t=.37),this.rotateContainer.style={transform:{scale:t,translate:{x:-33,y:0}}},this.showAtBottom){let t=0;1!=this.vm.getInteractiveStyleType()&&this.vm.isOriginRotateStyle()&&(t=5),this.rotateView.style={transform:{translate:{y:t},scale:1.4}}}}updateRotateContainerFinalBorderStyle(){this.rotateContainer.style={borderWidth:1,borderColor:"#FFFFFF"}}stopRotateAnimation(){Pe.supportMinimumTKVersion("5.0.0")&&this.rotateView&&(this.rotateContainer.removeAllAnimation(),this.rotateView.stop())}resumeLottieAnimation(){Pe.supportMinimumTKVersion("5.0.0")&&this.rotateView.resume(),this.shakeView&&this.startShakeAnimation()}pauseLottieAnimation(){Pe.supportMinimumTKVersion("5.0.0")&&this.rotateView.pause(),this.shakeView&&this.stopShakeAnimation()}stopActionAnimation(){this.stopRotateAnimation(),this.stopShakeAnimation()}bindSensorListener(){this.vm.startSensorListener(),_i(this.vm.$attrsPath.isStartSensor,(t=>{this.vm.callerContext.hasShowPlayend&&!this.vm.isShowRotateAndShakeView()||(t?(this.vm.startSensorListener(),this.resumeLottieAnimation()):(this.vm.stopSensorListener(),this.pauseLottieAnimation()))}))}addShakeAnim(){let t=new TKKeyframeAnimation;t.animType="rotationZ";let e=Pe.isAndroid()?.8:1;t.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.25,value:Pe.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.33,value:-Pe.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.5,value:Pe.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.66,value:-Pe.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.83,value:Pe.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.91,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}];t.duration=1200,this.shakeView&&this.shakeView.addAnimation(t,"addShakeRotate")}startShakeAnimation(){this.stopShakeAnimation(),this.addShakeAnim(),this.shaketimer=setInterval((()=>{this.addShakeAnim()}),1200)}stopShakeAnimation(){this.shaketimer&&clearInterval(this.shaketimer),this.shakeView&&this.shakeView.removeAllAnimation()}}class ea extends ta{setupView(){let t={width:168,height:150};2==this.vm.getInteractiveStyleType()&&(t.height=135);const e=this.startPositionFunc(t);this.setViewPosition(e),this.setVisibility("hidden"),this.appendRotateView(),this.loadFinish()}appendRotateLottieView(){this.rotateContainer=new TKView,this.rotateContainer.style={width:96,height:96,backgroundColor:"#00000064",borderRadius:48,position:"absolute",alignItems:"center"},2==this.vm.getInteractiveStyleType()&&(this.rotateContainer.style={width:110,height:110,borderRadius:55}),this.appendChild(this.rotateContainer),Pe.supportMinimumTKVersion("5.0.0")&&(this.rotateView=new TKLottieImageView,this.rotateView.style={width:56,height:56,marginTop:20,position:"absolute"},this.setRotateLottieView("image/ksad-video-image/neo_rotate_style_2.json",this.rotateView,!0),this.arrowView=new TKLottieImageView,this.arrowView.style={top:8,width:80,height:27,position:"absolute"},this.setRotateLottieView("image/ksad-video-image/neo_rotate_arrow.json",this.arrowView,!1),this.vm.rotateInfoCallback=(t,e,i)=>{let n=Math.abs(t)/this.vm.interactionInfo.rotateInfo.x.rotateDegree,s=Math.abs(e)/this.vm.interactionInfo.rotateInfo.y.rotateDegree,a=Math.abs(i)/this.vm.interactionInfo.rotateInfo.z.rotateDegree,o=Math.max(n,s,a);this.arrowView.setProgress(o>1?1:o<0?0:o)})}appendTitleContiner(){this.titleContainer=new TKView,this.titleContainer.style={width:168,height:65,top:106,alignItems:"center"},2==this.vm.getInteractiveStyleType()&&(this.titleContainer.style={top:81}),this.appendChild(this.titleContainer),this.appendTitleView()}appendDescView(){this.descView=new TKText,this.descView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",marginTop:4,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center"},2==this.vm.getInteractiveStyleType()&&(this.descView.style={marginTop:19}),this.titleContainer.appendChild(this.descView)}needChangeRotateView(){return!1}setViewPosition(t){if(this.vm.isShowRotateAndShakeView())switch(this.vm.getBtnPosition()){case 1:this.style={width:168,height:150,left:t.x,top:136,position:"absolute",alignItems:"center"};case 2:this.style={width:168,height:150,left:t.x,bottom:34,position:"absolute",alignItems:"center"}}else this.style={width:168,height:150,left:t.x,top:t.y,position:"absolute",alignItems:"center"};2==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:135})}}class ia extends ta{setupView(){var t;let e={width:168,height:150};2==this.vm.getInteractiveStyleType()&&(e.height=135);const i=this.startPositionFunc(e);this.setViewPosition(i),this.setVisibility("hidden"),this.appendRotateView(),(null===(t=this.vm.interactionInfo.rotateInfo)||void 0===t?void 0:t.enable)&&this.appendArrowiconView(),this.loadFinish()}appendArrowiconView(){let t=new TKImage;t.style={height:48,width:48,position:"absolute",alignItems:"center",justifyContent:"center",marginTop:24,marginStart:25},t.setSrc("image/ksad-video-image/rotate_shake_arrow.png"),this.rotateContainer.appendChild(t),this.arrowTop=new TKImage,this.arrowTop.style={height:7,width:14,position:"absolute",marginTop:16,marginStart:42},this.arrowTop.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowTop),this.arrowBottom=new TKImage,this.arrowBottom.style={height:7,width:14,position:"absolute",marginTop:73,marginStart:42,transform:{rotate:{x:180}}},this.arrowBottom.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowBottom),this.arrowLeft=new TKImage,this.arrowLeft.style={height:7,width:14,position:"absolute",marginTop:43,marginLeft:13,transform:{rotate:{z:-90}}},this.arrowLeft.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowLeft),this.arrowRight=new TKImage,this.arrowRight.style={height:7,width:14,position:"absolute",marginTop:43,marginLeft:71,transform:{rotate:{z:90}}},this.arrowRight.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowRight),2==this.vm.getInteractiveStyleType()&&(t.style={marginTop:17,marginStart:31},this.arrowTop.style={marginTop:9,marginStart:48},this.arrowBottom.style={marginTop:66,marginStart:48},this.arrowLeft.style={marginTop:38,marginLeft:19},this.arrowRight.style={marginTop:38,marginLeft:77})}appendRotateLottieView(){var t;if(this.rotateContainer=new TKView,this.rotateContainer.style={width:96,height:96,backgroundColor:"#00000064",borderRadius:48,position:"absolute"},2==this.vm.getInteractiveStyleType()&&(this.rotateContainer.style={width:110,height:110,borderRadius:55}),this.appendChild(this.rotateContainer),Pe.supportMinimumTKVersion("5.0.0")&&(this.rotateView=new TKLottieImageView),null===(t=this.vm.interactionInfo.rotateInfo)||void 0===t?void 0:t.enable)Pe.supportMinimumTKVersion("5.0.0")&&(this.rotateView.style={width:32,height:32,marginTop:32,marginStart:33,position:"absolute"},2==this.vm.getInteractiveStyleType()&&(this.rotateView.style={marginTop:24,marginStart:39}),this.setRotateLottieView("image/ksad-video-image/neo_rotate_style_3.json",this.rotateView,!0)),this.vm.rotateInfoCallback=(t,e,i)=>{if(this.vm.interactionInfo.rotateInfo){let n=t/this.vm.interactionInfo.rotateInfo.x.rotateDegree,s=e/this.vm.interactionInfo.rotateInfo.y.rotateDegree,a=i/this.vm.interactionInfo.rotateInfo.z.rotateDegree;this.transformCircle(n,s,a)}};else{this.vm.rotateShakeUiStyle=0,this.shakeView=new TKImage,this.shakeView.style={width:44,height:50,marginTop:24,marginLeft:27,position:"absolute"},2==this.vm.getInteractiveStyleType()&&(this.shakeView.style={marginTop:18,marginStart:35}),this.shakeView.setSrc("image/ksad-video-image/rotate_shake_hand.png"),this.rotateContainer.appendChild(this.shakeView);let t=new TKView;t.style={width:"100%",height:"100%",position:"absolute"},this.rotateContainer.appendChild(t),t.addEventListener("tap",(t=>{this.vm.clickLog(t,this)}))}}transformCircle(t,e,i){let n=e;Pe.supportMinimumTKVersion("5.0.0")&&(this.rotateView.style={transform:{translate:{x:10*n,y:10*t}}}),(Math.abs(n)>=.9||Math.abs(t)>=.9)&&!this.vm.isShowConvertState&&(n>=.9?this.arrowRight.setSrc("image/ksad-video-image/rotate_shake_white.png"):n<=-.9&&this.arrowLeft.setSrc("image/ksad-video-image/rotate_shake_white.png"),t>=.9?this.arrowBottom.setSrc("image/ksad-video-image/rotate_shake_white.png"):t<=-.9&&this.arrowTop.setSrc("image/ksad-video-image/rotate_shake_white.png"),this.vm.isShowConvertState=!0)}appendTitleContiner(){this.titleContainer=new TKView,this.titleContainer.style={width:168,height:65,top:106,alignItems:"center"},2==this.vm.getInteractiveStyleType()&&(this.titleContainer.style={width:168,height:65,top:81,alignItems:"center"}),this.appendChild(this.titleContainer),this.appendTitleView()}appendDescView(){this.descView=new TKText,this.descView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",marginTop:4,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center"},2==this.vm.getInteractiveStyleType()&&(this.descView.style={marginTop:19}),this.titleContainer.appendChild(this.descView)}needChangeRotateView(){return!1}setViewPosition(t){switch(this.vm.getBtnPosition()){case 1:this.style={width:168,height:150,left:t.x,top:136,position:"absolute",alignItems:"center"};break;case 2:this.style={width:168,height:150,left:t.x,bottom:34,position:"absolute",alignItems:"center"};break;default:this.style={width:168,height:150,bottom:34,position:"absolute",alignItems:"center"}}2==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:135})}}class na extends TKView{constructor(t,e=null){super(),this.style={flexDirection:"row",alignItems:"center"},this.starArray=new Array;let i=0;for(;i<5;++i){let n=new TKImage;n.style={width:11,height:11,marginRight:4};t>10*i+5?e&&e.starAllIconUrl?n.setSrc(e.starAllIconUrl):ke(n,"icon_ksad_star_all_fe3666.png"):t>10*i?e&&e.starHalfIconUrl?n.setSrc(e.starHalfIconUrl):ke(n,"icon_ksad_star_half_fe3666.png"):e&&e.starGrayIconUrl?n.setSrc(e.starGrayIconUrl):ke(n,"icon_ksad_star_gray_fe3666.png"),this.appendChild(n),this.starArray.push(n)}}}class sa extends TKView{constructor(t){super(),this.vm=t,this.setupView()}setupView(){let e=1==this.vm.callerContext.screenOrientation,i=X(this.vm.callerContext.adInfo)&&this.vm.getAppScore()>30,n=i&&Ie(this.vm.getAppDownloadCountDesc()),s=e?54:100;this.coverImageView=new TKImage,this.style=e?{width:"50%",height:"100%",backgroundColor:"#000000A2",flexDirection:"column",alignItems:"center",justifyContent:"center"}:{width:"100%",height:331,backgroundColor:"#FFFFFFD4",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.containerView=new TKView,this.containerView.style={width:"100%",paddingLeft:48,paddingRight:48,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.appendChild(this.containerView),this.imageView=new TKImage,this.imageView.setSrc(N(this.vm.callerContext.adInfo)),this.imageView.style={width:s,height:s,borderRadius:e?14:24},this.containerView.appendChild(this.imageView),this.titleLabel=new TKText,this.titleLabel.setText(J(this.vm.callerContext.adInfo)),this.titleLabel.style={marginTop:16,width:"100%",fontSize:20,color:e?"#FFFFFF":"#222222",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.containerView.appendChild(this.titleLabel),i&&(this.starView=new na(this.vm.getAppScore()),this.starView.style={marginTop:12},this.starView.addEventListener("tap",(t=>{})),this.containerView.appendChild(this.starView)),n&&(this.downloadCountDescLabel=new TKText,this.downloadCountDescLabel.setText(this.vm.getAppDownloadCountDesc()),this.downloadCountDescLabel.style={marginTop:12,width:"100%",fontSize:e?14:16,color:e?"#FFFFFF":"#666666",textAlign:"center"},this.containerView.appendChild(this.downloadCountDescLabel)),this.subTitleLabel=new TKText,this.subTitleLabel.setText(this.vm.getAdDescription()),this.subTitleLabel.style={marginTop:e?12:16,fontSize:e?14:16,color:e?"#FFFFFF":"#666666",width:"100%",textAlign:"center",textLineClamp:2,textOverflow:"ellipsis"},this.containerView.appendChild(this.subTitleLabel),this.actionBtn=new TKButton,this.actionBtn.setText(Vt(this.vm.callerContext.adInfo)),this.actionBtn.style={marginTop:e?24:32,width:"100%",height:48,borderRadius:24,fontSize:16,backgroundColor:"#FE3666",color:"#FFFFFF"},this.containerView.appendChild(this.actionBtn),this.actionBtn.addEventListener("tap",(e=>{this.vm.convert(1,Te(e,this.actionBtn),t.ACTION_BAR_CLICK)}))}}class aa extends TKView{constructor(t){super(),this.isExpose=!1,this.downloadState=0,this.vm=t,this.setupView(),Di(this.vm,this.vm.$attrsPath.downloadState,(t=>{this.vm.rotateVM.downloadState=t})),ye()?Di(this.vm,this.vm.$attrsPath.focusChangeEvent,(t=>{"windowFocusGet"==t?(this.vm.rotateVM.isStartSensor=!0,this.vm.rotateVM.canRotateConvert=!0):"windowFocusLost"==t&&(this.vm.rotateVM.isStartSensor=!1,this.vm.rotateVM.canRotateConvert=!1)})):Di(this.vm,this.vm.$attrsPath.callerContext.pageFocusAndVisible,(t=>{t?(this.vm.rotateVM.isStartSensor=!0,this.vm.rotateVM.canRotateConvert=!0):(this.vm.rotateVM.isStartSensor=!1,this.vm.rotateVM.canRotateConvert=!1)})),Di(this.vm,this.vm.$attrsPath.canShowAggregation,(t=>{this.parseAgg(this.vm.aggregationCardVM),this.vm.aggregationCardVM.canShowAggregation=t}))}render(){try{return this.webview.render(this.vm.getWebCardEndH5Url()),!0}catch(t){return!1}}show(){if(this.webview){1==this.webview.renderStatus?(this.webview.willShow(),this.endCardView.appendChild(this.webview),this.webview.didShow()):this.setupLocalView();let t=0==this.vm.callerContext.screenOrientation;this.vm.isShowRotatrAndShakeView()&&t&&this.setupRotateView(),this.vm.canShowAggregation&&this.vm.callerContext.adInfo.adConversionInfo.universeAggreEndPage&&t&&setTimeout((()=>{if(this.aggAnim(),!this.isExpose&&this.vm.canShowAggregation){let t=null,e=di.createNeoCommonInstance(this.vm.aggregationCardVM.adInfo);e&&(t={clientExtData:JSON.stringify(e)}),pi.expose(t,this.vm.aggregationCardVM.adResult),this.neoAggCardExposure(),this.isExpose=!0}}),1e3*this.vm.callerContext.adInfo.adConversionInfo.universeAggreEndPageTs)}this.vm.canShowPreLandingPage()&&this.preLandingView.show()}setupView(){this.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.endCardView=new TKView,this.endCardView.style={width:"100%",height:"100%",flexDirection:"row",alignItems:"center",justifyContent:"center",bottomLeftRadius:8,bottomRightRadius:8},this.appendChild(this.endCardView),Pe.supportMinimumTKVersion("5.1.1")&&4==this.vm.callerContext.adInfo.adBaseInfo.aggMidPageAdType&&this.vm.callerContext.adInfo.adConversionInfo.universeAggreEndPage&&0==this.vm.callerContext.screenOrientation&&this.setupAggCardView();let e=new TKImage;if(e.setSrc(this.vm.getVideoFirstFrame()),e.style={width:"100%",height:"100%",resize:"contain",position:"absolute",borderRadius:8},this.endCardView.appendChild(e),this.vm.canShowPreLandingPage()){this.setPreLandingView();try{const t=this.vm.callerContext.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;$e("component_ui_exist","end_card",String(t.endCardInfo.pageId),"pre-landing-page-card")}catch(i){}}else{this.setupWebView();const t=xt("ksad-pre-landingpage-card",this.vm.callerContext.adInfo);2!=this.vm.callerContext.adStyle||be(t)||$e("component_ui_exist","end_card","","pre-landing-page-card",!1)}this.addEventListener("tap",(e=>{this.vm.convert(2,Te(e,this),t.PLAY_END_CALL_CLICK)})),this.vm.supportSlideClick()&&jt(this,(()=>{this.vm.convert(2,{x:0,y:0},t.PLAY_END_CALL_CLICK)}))}setPreLandingView(){let t=new TKView;t.style={width:"100%",height:"100%",position:"absolute"},this.preLandingView=new Gs(this.vm.preFormViewModel),t.appendChild(this.preLandingView),this.endCardView.appendChild(t)}setupWebView(){try{this.webview=new Ts(this.vm.webViewVM),this.webview.style={width:"100%",height:"100%",position:"absolute",left:0,borderRadius:8}}catch(t){console.log("webview error")}}setupLocalView(){this.localPlayEndView=new sa(this.vm),this.endCardView.appendChild(this.localPlayEndView),this.layout(),this.logoView=new Ri(1,this.vm.callerContext.adInfo),this.logoView.style={position:"absolute",left:10,bottom:10},1==this.vm.callerContext.screenOrientation?this.appendChild(this.logoView):this.localPlayEndView.appendChild(this.logoView)}setupRotateView(){const t=t=>{let e=this.vm.callerContext.containerLimit.height-270-t.height,i=(this.vm.callerContext.containerLimit.height-t.height)/2;return e<i&&(e=i),{x:this.vm.callerContext.containerLimit.width/2-t.width/2,y:e}},e=t=>{let e=this.vm.callerContext.containerLimit.height-270-t.height,i=(this.vm.callerContext.containerLimit.height-t.height)/2;return e<i&&(e=i),{x:this.vm.callerContext.containerLimit.width/2-t.width/2,y:e}};1==this.vm.rotateVM.interactionInfo.componentInfo.btnStyle?(this.rotateView=new ea(this.vm.rotateVM,t,e),this.endCardView.appendChild(this.rotateView)):2!=this.vm.rotateVM.interactionInfo.componentInfo.btnStyle&&0!=this.vm.rotateVM.interactionInfo.componentInfo.btnStyle||(this.rotateView=new ia(this.vm.rotateVM,t,e),this.endCardView.appendChild(this.rotateView))}setupAggCardView(){this.style={width:"100%",height:"100%",backgroundColor:"#000000",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.aggCardView=new TKView,this.aggCardView.style={width:"100%",height:"45%",position:"absolute",top:this.vm.callerContext.containerLimit.height-274,opacity:0,flexDirection:"column"},this.aggCardView.addEventListener("tap",(t=>{this.vm.canShowAggregation&&this.vm.aggregationCardVM.handleConvert(1,t)})),this.appendChild(this.aggCardView);let t=new TKImage;t.style={height:17,width:36,position:"absolute",alignSelf:"center",top:15},t.setSrc("image/ksad-video-image/aggregation_end_page_arrow.png"),this.aggCardView.appendChild(t);try{this.vm.aggregationCardVM.aggcardType=this.vm.callerContext.adInfo.adMatrixInfo.adDataV2.neoTKInfo.innerAggEndCardType,this.vm.aggregationCardVM.aggcardType==Pn.AGG_CARD_FANS?this.aggCard=new Nn(this.vm.aggregationCardVM,1):this.vm.aggregationCardVM.aggcardType==Pn.AGG_CARD_SHOP?this.aggCard=new zn(this.vm.aggregationCardVM,1):this.vm.aggregationCardVM.aggcardType==Pn.AGG_CARD_LIVE_ORDER?this.aggCard=new Wn(this.vm.aggregationCardVM,1):this.vm.aggregationCardVM.aggcardType==Pn.AGG_CARD_LIVE&&(this.aggCard=new Hn(this.vm.aggregationCardVM,1)),this.aggCardView.appendChild(this.aggCard),this.aggCard.contentView.style={width:this.vm.callerContext.containerLimit.width,height:"100%",transform:{scale:.85},position:"absolute",top:0}}catch(e){}}aggAnim(){const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.endCardView.style={transform:{translate:{y:0}},opacity:1},0),()=>(this.endCardView.style={transform:{scale:.85,translate:{y:.85*-this.aggCard.getSize().height}},opacity:1},1)]),t.duration=500,t.repeatCount=1,this.endCardView.addAnimation(t,"aggAnim"),setTimeout((()=>{const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.aggCardView.style={transform:{translate:{y:.85*this.aggCard.getSize().height}},opacity:0},0),()=>(this.aggCardView.style={transform:{translate:{y:0}},opacity:1},1)]),t.duration=300,t.repeatCount=1,this.aggCardView.addAnimation(t,"aggAnim1")}),200)}neoAggCardExposure(){let t;switch(function(t){try{return t.adMatrixInfo.adDataV2.neoTKInfo.innerAggEndCardType}catch(e){}return 0}(this.vm.callerContext.adInfo)){case Pn.AGG_CARD_FANS:case Pn.AGG_CARD_LIVE_ORDER:case Pn.AGG_CARD_SHOP:case Pn.AGG_CARD_LIVE:t={elementType:233};let e={actionType:140,payload:JSON.stringify(t),adTemplate:JSON.stringify(this.vm.aggregationCardVM.adImpInfo)};Ne.sendLog(e)}}parseAgg(t){t.adResult&&(t.adImpInfo=t.adResult.impAdInfo[0],t.adInfo=t.adImpInfo.adInfo[0],t.aggregationCardInfo=it(t.adInfo).innerAggregationInfo)}}class oa{constructor(t=5e3){this.mStartTimeoutMS=3e3,this.enable=!1,this.mTimer=0,this.startTimeoutCallback=()=>{},this.mStartTimeoutMS=t}onPlayerPrepare(){this.stopTimer(),this.enable=!0,this.mTimer=setTimeout((()=>{this.enable&&this.startTimeoutCallback&&this.startTimeoutCallback()}),this.mStartTimeoutMS)}onFirstFrame(){this.stopTimer()}stopTimer(){this.mTimer>0&&(clearTimeout(this.mTimer),this.enable=!1,this.mTimer=0)}}class ra{constructor(t,e){this.enable=!0,this.mOnFailedCallback=(t,e)=>{this.isEnable()&&(this.vm.videoPlayFailed(t,e),ri().emit(a,{errorCode:t,errorReason:t}))},this.mOnFinishCallback=()=>{this.isEnable()&&(ri().emit(o,{code:1}),this.vm.videoPlayFinished())},this.mOnFirstFrameCallback=()=>{this.isEnable()&&(this.vm.videoPlayStart(),this.mOuterFirstFrameCallback&&this.mOuterFirstFrameCallback())},this.mOnProgressCallback=(t,e,i)=>{this.isEnable()&&(this.vm.updateVideoProgress(t,e,i),pi.updateVideoPlayStatus("progress",0,"",1e3*t),ri().emit(r,{currentTime:t,avaliableTime:e,totalTime:i}),this.mOuterProgressCallback&&this.mOuterProgressCallback(t,e,i))},this.mOnMuteChangeCallback=t=>{this.isEnable()&&(this.vm.isMuted=t,ri().emit(s,{muted:t}))},this.mOnStatusCallback=t=>{this.isEnable()&&(this.vm.playStatus=t)},this.enable=!0,this.vm=t,this.mName=e}destroy(){this.enable=!1,this.vm=null}isEnable(){return this.enable&&null!=this.vm}}class ha{static initImagePlayer(t,e,i,n){let s=i.getView();n.mOuterProgressCallback=(t,e,i)=>{t%5==0&&ha.playerScaleAnimation(s)};let a=W(e.adInfo);i.setURLs([a]),i.setDuration(e.getVideoDuration()),s.style={width:"100%",height:"100%"},i.setOnProgress(n.mOnProgressCallback),i.setOnFirstFrame(n.mOnFirstFrameCallback),i.setOnFinish(n.mOnFinishCallback),i.setOnFailed(n.mOnFailedCallback),i.setOnStatusCallback(n.mOnStatusCallback),ha.setActions(s,e)}static setActions(e,i){let n=new S;n.material_click_area=2==i.adStyle?"neo_image":"fullscreen_image";const s=i.getActionBarStyle();n.template_show_type=10==s?"picture_template10":"picture_template9",i.isSlideEnable()&&(ye()?jt(e,(()=>{i.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,n)})):e.addEventListener("swipe",(e=>{i.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,n)}))),e.addEventListener("tap",(s=>{const a=Te(s,e);i.convert(3,a,t.CARD_PAGE_CLICK,n)}))}static playerScaleAnimation(t){let e=new TKKeyframeAnimation;e.duration=1600,e.timingFunction="Linear",e.setAnimations([()=>(t.style={transform:{scale:1.1}},.25),()=>(t.style={transform:{scale:1}},.5),()=>(t.style={transform:{scale:1.1}},.75),()=>(t.style={transform:{scale:1}},1)]),t.addAnimation(e,"playerScale")}}var la,da;!function(t){t.IMAGE="image",t.LIVE="live",t.VIDEO="video"}(la||(la={}));class ca{constructor(){try{Pe.supportMinimumTKVersion("5.0.3")&&(this.mDelegate=new TKImagePlayer)}catch(t){}}getView(){return Pe.supportMinimumTKVersion("5.0.3")?this.mDelegate:null}isImagePlayerAvailable(){return!!Pe.supportMinimumTKVersion("5.0.3")&&null!=this.mDelegate}setURLs(t){this.isImagePlayerAvailable()&&this.mDelegate.setURLs(t)}setDuration(t){this.isImagePlayerAvailable()&&this.mDelegate.setDuration(t)}setImageResize(t){this.isImagePlayerAvailable()&&this.mDelegate.setImageResize(t)}setVerticalGravity(t){this.isImagePlayerAvailable()&&this.mDelegate.setVerticalGravity(t)}setHorizontalGravity(t){this.isImagePlayerAvailable()&&this.mDelegate.setHorizontalGravity(t)}play(){this.isImagePlayerAvailable()&&this.mDelegate.play()}pause(){this.isImagePlayerAvailable()&&this.mDelegate.pause()}resume(){this.isImagePlayerAvailable()&&this.mDelegate.resume()}stop(){this.isImagePlayerAvailable()&&this.mDelegate.stop()}setEnableCache(t){this.isImagePlayerAvailable()&&this.mDelegate.setEnableCache(t)}setOnFirstFrame(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnFirstFrame(t)}setOnProgress(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnProgress(t)}setOnFinish(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnFinish(t)}setOnFailed(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnFailed(t)}setOnStatusCallback(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnStatusCallback(t)}}class pa{constructor(t,e){this.mEnableRollbackToImage=!1,this.vm=t,this.mEnableRollbackToImage=e}setupPlayer(t,e){if(this.mEnableRollbackToImage){let e=Qt(de());this.mTimeoutHelper=new oa(e),this.mTimeoutHelper.startTimeoutCallback=()=>{this.rollbackToImage(t)}}this.mRealPlayer=new TKVideoPlayer,this.mVideoPlayerCallbacks=new ra(this.vm,"VideoPlayerCallbacks"),this.mVideoPlayerCallbacks.mOuterFirstFrameCallback=()=>{this.mTimeoutHelper&&this.mTimeoutHelper.onFirstFrame(),re(la.VIDEO),e&&e()},this.initVidePlayer(t,this.mRealPlayer,this.mVideoPlayerCallbacks),this.mTimeoutHelper&&this.mTimeoutHelper.onPlayerPrepare()}initVidePlayer(t,e,i){e.setURL(this.vm.getVideoURL()),e.style={width:"100%",height:"100%"},Pe.supportMinimumTKVersion("4.0.9")&&e.setVideoAdaptStrategy(1),e.prepareToPlay(),e.setMuted(this.vm.isMuted),t.appendChild(e),e.setOnFailed(i.mOnFailedCallback),e.setOnFinish(i.mOnFinishCallback),e.setOnProgress(i.mOnProgressCallback),e.setOnFirstFrame(i.mOnFirstFrameCallback),e.setOnMuteChange(i.mOnMuteChangeCallback),Pe.supportMinimumTKVersion("4.0.9")&&e.setOnStatusCallback(i.mOnStatusCallback)}rollbackToImage(t){let e=this.mRealPlayer;this.mVideoPlayerCallbacks.destroy(),this.mVideoPlayerCallbacks=null,this.mRealPlayer=new ca,this.mImagePlayerCallbacks=new ra(this.vm,"ImagePlayerCallbacks"),ha.initImagePlayer(t,this.vm,this.mRealPlayer,this.mImagePlayerCallbacks),this.mRealPlayer.play(),t.replaceChild(pa.obtainPlayerView(this.mRealPlayer),pa.obtainPlayerView(e)),e.stop(),e=null,this.vm.onDowngrade()}getView(){return pa.obtainPlayerView(this.mRealPlayer)}static obtainPlayerView(t){return t instanceof TKVideoPlayer?t:t instanceof ca?t.getView():null}play(){this.mRealPlayer.play()}pause(){this.mRealPlayer.pause()}resume(){this.mRealPlayer.resume()}stop(){this.mRealPlayer.pause(),this.mRealPlayer.stop()}setForceGetAudioFocus(t){this.mRealPlayer instanceof TKVideoPlayer&&this.mRealPlayer.setForceGetAudioFocus&&this.mRealPlayer.setForceGetAudioFocus(t)}setMuted(t){this.mRealPlayer instanceof TKVideoPlayer&&this.mRealPlayer.setMuted&&this.mRealPlayer.setMuted(t)}setAnimation(t,e){this.mRealPlayer instanceof TKVideoPlayer&&this.mRealPlayer.setAnimation&&this.mRealPlayer.setAnimation(t,e)}}class ma extends TKView{constructor(t){super(),this.vm=t,this.setupView(),this.setupActions(),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"showEnd":this.hasPlay||(this.hasPlay=!0,this.player.play());break;case"pageVisiable":this.resume();break;case"pageInvisiable":this.player.pause();break;case"hideEnd":this.player.stop()}})),Di(this.vm,this.vm.$attrsPath.isMuted,(t=>{this.player.setMuted(t)})),this.player.setForceGetAudioFocus(this.vm.configInfo.appConfig.forceGetAudioFocus)}setAnimation(t,e){Pe.supportMinimumTKVersion("4.0.9")&&this.player.setAnimation(t,e)}setupActions(){let e=new S;e.material_click_area=2==this.vm.adStyle?"neo_video":"fullscreen_video",this.vm.isSlideEnable()&&(jt(this.player.getView(),(()=>{this.vm.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this,(()=>{this.vm.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))),this.player.getView().addEventListener("tap",(i=>{const n=Te(i,this.player.getView());this.vm.convert(3,n,t.CARD_PAGE_CLICK,e)})),this.addEventListener("tap",(i=>{const n=Te(i,this);this.vm.convert(3,n,t.CARD_PAGE_CLICK,e)}))}setupView(){this.style={flexDirection:"row",alignItems:"center",justifyContent:"center"},ye()||(this.currentFrame=new TKImage,this.currentFrame.style={width:"100%",height:"100%",position:"absolute",left:0,top:0,resize:"contain"},this.currentFrame.setSrc(this.vm.getVideoFirstFrame()),this.appendChild(this.currentFrame));let t=function(t,e){try{if(!Pe.supportMinimumTKVersion("5.0.3"))return!1;let i=W(t);return e.abConfig.videoRollbackToImageTimeout>0&&!be(i)}catch(i){return!1}}(this.vm.adInfo,de());this.player=new pa(this.vm,t),this.player.setupPlayer(this,(()=>{this.currentFrame&&this.currentFrame.setVisibility("hidden")}))}resume(){this.vm.isDialogShowing()||this.player.resume()}pause(){this.player.pause()}stop(){this.player.stop()}}class ga extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas(),this.setupActions(),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"pageVisiable":this.vm.isPaused=!1;break;case"pageInvisiable":this.vm.isPaused=!0}})),Di(this.vm,this.vm.$attrsPath.isPaused,(t=>{t?this.vm.timerPaused():this.vm.timerResume()})),Di(this.vm,this.vm.$attrsPath.isShowEnd,(t=>{if(t){const t=this;this.showEndAniamtion((()=>{t.removeAllAnimation(),t.setVisibility("hidden")}))}}))}setupViews(){this.style={top:-66,width:343,height:66,position:"absolute",alignSelf:"center",opacity:0},this.contentContainer=new TKView,this.contentContainer.style={width:"100%",height:"100%",borderRadius:12,padding:14,flexDirection:"row",justifyContent:"space-between",backgroundColor:"#FFFFFFE2",alignItems:"center"},this.appendChild(this.contentContainer),this.iconView=new TKImage,this.iconView.style={width:38,height:38,borderRadius:6},this.contentContainer.appendChild(this.iconView);let t=new TKView;t.style={height:"100%",flexDirection:"column",justifyContent:"center",flexGrow:1,flexShrink:1,paddingLeft:12,paddingRight:7},this.contentContainer.appendChild(t),this.titleText=new TKText,this.titleText.style={height:20,fontSize:15,fontWeight:"500",textOverflow:"ellipsis",textLineClamp:1,color:"#222222",includeFontPadding:!1},t.appendChild(this.titleText),this.descText=new TKText,this.descText.style={top:1,height:16,fontSize:12,fontWeight:"400",textOverflow:"ellipsis",textLineClamp:1,includeFontPadding:!1,color:"#666666"},t.appendChild(this.descText),this.actionButton=new TKButton,this.actionButton.style={width:80,height:32,borderRadius:16,fontSize:12,fontWeight:"500",color:"#FFFFFF",backgroundColor:"#FE3666"},this.contentContainer.appendChild(this.actionButton)}setupDatas(){this.iconView.setSrc(this.vm.getAdIcon()),this.titleText.setText(this.vm.getAdTitle()),this.descText.setText(this.vm.getAdDescription()),this.actionButton.setText(this.vm.getAdActionDesc())}setupActions(){let e=new S;e.template_show_type="push_card",this.contentContainer.addEventListener("tap",(i=>{const n=Te(i,this);this.vm.convert(2,n,t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&jt(this.contentContainer,(()=>{this.vm.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.actionButton.addEventListener("tap",(i=>{const n=Te(i,this);this.vm.convert(1,n,t.CARD_ACTION_BAR_CLICK,e)}))}show(){this.vm.pushCardIsShow||(this.vm.pushCardIsShow=!0,this.vm.reportPlayEndImpression(),this.vm.timerPlay(),this.startAnimation())}startAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={top:this.vm.getTopMargin(),opacity:1},1)]),t.duration=300,this.addAnimation(t,"pushShowAnimation")}showEndAniamtion(t){const e=this;let i=new TKKeyframeAnimation;i.setAnimations([()=>(e.contentContainer.style={opacity:1},0),()=>(e.contentContainer.style={opacity:0},1)]),i.timingFunction="ease-out",i.duration=200,this.contentContainer.addAnimation(i,"pushShowEndAnimation"),i.on("end",(()=>{t&&t()}))}}class ua extends is{constructor(){super()}getName(){return"updateExtraReward"}handleJsCall(t,e,i){const n=JSON.parse(t);if(be(n))i(0,"no data");else{const t=n;this.callback&&this.callback(t),e(null)}}}class wa extends KSAdDialog{constructor(t){super(),this.vm=t,this.registerBridgeHandle(),this.setupView()}setupView(){this.setTemplateInfo(this.vm.getTemplateInfo())}showConfirm(){const t=this;this.show(((e,i)=>{e&&(t.vm.isShow=!0,t.dismissListener())}))}registerBridgeHandle(){this.setOnDismissListener((()=>{console.log("KSAdNeoConfirmView=====++++++ dismiss")}));const t=new Qn,n=new hs(this.vm.adOriginInfo);t.registerBridgeHandler(n);const s=new rs(this.vm.configInfo);t.registerBridgeHandler(s);const a=new ds(le());t.registerBridgeHandler(a);const o=new Cs(this.vm.screenOrientation);t.registerBridgeHandler(o);const r=new Hs;r.closeCallback=()=>{this.dismiss()},t.registerBridgeHandler(r);const h=new os;t.registerBridgeHandler(h);const l=new gs;t.registerBridgeHandler(l);const d=new ls(this.vm.containerLimit);t.registerBridgeHandler(d);const c=new as;t.registerBridgeHandler(c);const p=new cs(this.vm.adStyle);t.registerBridgeHandler(p);const m=new ua;m.callback=t=>{this.vm.hasExtraGiven=!0;let n={extraRewardType:e.adClickReward,extraRewardStatus:i.isRewarded};Ne.updateExtraReward(n)},t.registerBridgeHandler(m),this.registerBridge(t)}dismissListener(){this.setOnDismissListener((()=>{this.vm.isShow=!1,this.vm.needShowBigCard=!this.vm.hasExtraGiven,console.log("KSAdNeoSecondclickView=====++++++ dialog被关闭")}))}}class Ca extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas(),this.setupActions(),this.cardShowAnimation(!0)}setupActions(){this.closeImage.addEventListener("tap",(t=>{this.onCloseTrigger(!0)})),this.contentView.addEventListener("tap",(e=>{this.onViewClick(e,2,t.CARD_OTHERAREA_CLICK)})),this.actionContainerView.addEventListener("tap",(e=>{this.onViewClick(e,1,t.CARD_ACTION_BAR_CLICK)}))}setupDatas(){this.awardLabelText&&this.awardLabelText.setText(this.vm.awardTimeText()),this.titleLabelText&&this.titleLabelText.setText(this.vm.getAutoDialogGiftTitle()),this.descLabelText&&this.descLabelText.setText(this.vm.getAutoDialogGiftDesc()),this.closeImage&&ke(this.closeImage,"icon_ksad_welfare_close.png"),this.setupAdditionDatas()}setupAdditionDatas(){}setupViews(){this.appendMaskView(),this.appendStyleView(),this.appendCloseView()}appendMaskView(){this.style={top:0,width:ae.matchParent,height:ae.matchParent,backgroundColor:"#FFFFFF00",alignItems:"center",justifyContent:"center"},this.maskView=new TKView,this.maskView.style={width:ae.matchParent,height:ae.matchParent,backgroundColor:"#000000CC",alignItems:"center",justifyContent:"center",opacity:0},this.appendChild(this.maskView)}appendStyleView(){}appendCloseView(){this.closeImage=new TKImage,this.closeImage.style={width:27,height:27,bottom:0,resize:"cover",position:"absolute"},this.contentView.appendChild(this.closeImage)}cardShowAnimation(t){const e=t?1:0;let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.maskView.style={opacity:e},1)]),i.duration=400,i.timingFunction="EaseInEaseOut",this.maskView.addAnimation(i,"showWelfareAnim"),this.showTransAnim(t)}showTransAnim(t){let e=t?0:1,i=t?1:0,n=t?.8:1,s=t?1:.8,a=new TKKeyframeAnimation;a.setAnimations([()=>(this.contentView.style={transform:{scale:n},opacity:e},0),()=>(this.contentView.style={transform:{scale:s},opacity:i},1)]),a.duration=400,a.timingFunction="EaseInEaseOut",this.contentView.addAnimation(a,"showWelfareTransAnim"),a.on("end",(()=>{this.onAnimEnd(t)}))}updateCountdown(t){}}class fa extends Ca{setupAdditionDatas(){this.speckleLottieView&&Pe.supportMinimumTKVersion("5.0.0")&&this.speckleLottieView.setUri("image/ksad-video-image/neo_welfare_luminance.json"),this.awardImage&&ke(this.awardImage,"icon_ksad_welfare_countdown_tittle.png"),this.backgroundImage&&ke(this.backgroundImage,"icon_ksad_welfare_redpacket.png"),this.iconImage&&this.vm.hasGiftImage()&&this.iconImage.setUri(this.vm.getAutoDialogGiftImage()),this.priceLabelText&&!this.vm.hasGiftImage()&&this.addHighlightSpan(),this.buttonImage&&ke(this.buttonImage,"icon_ksad_welfare_button.png"),this.actionBarText&&this.actionBarText.setText(this.vm.getActionBarText())}appendStyleView(){const t=new TKView;t.style={alignItems:"center",flexDirection:"column",width:375,height:564,backgroundColor:"#FFFFFF00",position:"absolute"},this.appendChild(t),Pe.supportMinimumTKVersion("5.0.0")&&(this.speckleLottieView=new TKLottieImageView,this.speckleLottieView.style={width:375,height:550,top:0,position:"absolute"},t.appendChild(this.speckleLottieView)),this.contentView=new TKView,this.contentView.style={width:375,height:480,marginTop:52,backgroundColor:"#FFFFFF00",alignItems:"center",flexDirection:"column",opacity:0,transform:{scale:.8}},t.appendChild(this.contentView),this.redPacketContainerView=new TKView,this.redPacketContainerView.style={width:361,height:470,marginTop:10,alignItems:"center",flexDirection:"column"},this.contentView.appendChild(this.redPacketContainerView),this.addAwardText(),this.backgroundImage=new TKImage,this.backgroundImage.style={width:361,height:470,resize:"cover"},this.redPacketContainerView.appendChild(this.backgroundImage),this.attributesView=new TKView;let e=this.vm.hasGiftImage()?189:141,i=this.vm.hasGiftImage()?95:129;this.attributesView.style={width:"100%",height:e,top:i,alignItems:"center",justifyContent:"flex-end",flexDirection:"column",position:"absolute"},this.redPacketContainerView.appendChild(this.attributesView);let n=this.vm.hasGiftImage()?4:13;this.titleLabelText=new TKText,this.titleLabelText.style={maxWidth:261,height:31,marginBottom:n,color:"#5D070C",fontSize:22,fontWeight:"500",textAlign:"center",textLineClamp:1,alignItems:"center",textOverflow:"ellipsis",includeFontPadding:!1,position:"relative"},this.attributesView.appendChild(this.titleLabelText),this.vm.hasGiftImage()?this.appendIconStyle():this.appendPriceStyle(),this.descLabelText=new TKText,this.descLabelText.style={maxWidth:261,height:22,textLineClamp:1,fontSize:16,fontWeight:"400",color:"#AF787A",textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1,position:"relative"},this.attributesView.appendChild(this.descLabelText),this.setupActionBarView()}addAwardText(){const t=new TKView;t.style={width:287,height:54,alignItems:"center",justifyContent:"center",flexDirection:"row",top:0,position:"absolute"},this.contentView.appendChild(t),this.awardImage=new TKImage,this.awardImage.style={width:287,height:54,resize:"cover"},t.appendChild(this.awardImage),this.awardLabelText=new TKText,this.awardLabelText.style={width:39,height:26,left:135,color:"#FFF7E0",fontSize:22,fontWeight:"600",textAlign:"center",textLineClamp:1,alignItems:"center",textOverflow:"ellipsis",includeFontPadding:!1,position:"absolute"},t.appendChild(this.awardLabelText)}appendIconStyle(){this.iconImage=new TKImage,this.iconImage.style={width:130,height:130,resize:"cover",borderRadius:12,marginBottom:3},this.attributesView.appendChild(this.iconImage)}appendPriceStyle(){this.priceLabelText=new TKText,this.priceLabelText.style={maxWidth:261,marginBottom:26,height:53,textLineClamp:1,color:"#F63218",fontSize:22,fontWeight:"500",textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1,position:"relative"},this.attributesView.appendChild(this.priceLabelText)}setupActionBarView(){const t=new TKView;t.style={width:192,height:48,bottom:85,backgroundColor:"#FFFFFF00",position:"absolute"},this.redPacketContainerView.appendChild(t),this.buttonImage=new TKImage,this.buttonImage.style={width:ae.matchParent,height:ae.matchParent,resize:"cover",top:0,position:"absolute"},t.appendChild(this.buttonImage),this.actionContainerView=new TKView,this.actionContainerView.style={width:ae.matchParent,height:ae.matchParent,backgroundColor:"#FFFFFF00",alignItems:"center",justifyContent:"center",flexDirection:"row",overflow:"hidden",top:0},t.appendChild(this.actionContainerView),this.actionBarText=new TKText,this.actionBarText.style={fontSize:16,height:28,fontWeight:"500",color:"#5D070C",textAlign:"center",alignSelf:"center",includeFontPadding:!1,position:"absolute"},this.actionContainerView.appendChild(this.actionBarText)}updateCountdown(t){this.awardLabelText.setText(t+"s")}cardShowAnimation(t){const e=t?1:0;let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.maskView.style={opacity:.5},.5),()=>(this.maskView.style={opacity:e},1)]),i.duration=t?500:250,i.timingFunction="EaseInEaseOut",this.maskView.addAnimation(i,"showWelfareAnim"),setTimeout((()=>{this.showTransAnim(t)}),t?250:0)}showTransAnim(t){let e=t?0:1,i=t?1:0,n=t?.8:1,s=t?1:.8,a=new TKKeyframeAnimation;a.setAnimations([()=>(this.contentView.style={transform:{scale:n},opacity:e},0),()=>(this.contentView.style={transform:{scale:t?1.1:.6},opacity:i},.6),()=>(this.contentView.style={transform:{scale:s}},1)]),a.duration=250,a.timingFunction="EaseInEaseOut",this.contentView.addAnimation(a,"showWelfareTransAnim"),a.on("end",(()=>{!t&&Pe.supportMinimumTKVersion("5.0.0")&&this.speckleLottieView.stop(),this.onAnimEnd(t)})),t&&Pe.supportMinimumTKVersion("5.0.0")&&this.speckleLottieView.play()}addHighlightSpan(){if(null==this.vm.getAutoDialogGiftText())return;if(null==this.vm.getAutoDialogGiftTextHighLight())return void this.priceLabelText.setText(this.vm.getAutoDialogGiftText());const t=this.vm.getAutoDialogGiftText().search(this.vm.getAutoDialogGiftTextHighLight());if(-1==t||!this.vm.getAutoDialogGiftTextHighLight().length)return void this.priceLabelText.setText(this.vm.getAutoDialogGiftText());let e=new TKSpan;const i=new TKSpanItem;i.spanType="fontFamily",i.size=38,i.textStyle="bold",i.start=t,i.end=t+this.vm.getAutoDialogGiftTextHighLight().length,e.addSpan(i),this.priceLabelText.setSpan(this.vm.getAutoDialogGiftText(),e)}}class ya extends Ca{setupAdditionDatas(){this.mCountdownTitleView&&this.mCountdownTitleView.setText(`限时红包 ${this.vm.getAutoDialogStayTime()/1e3}s 后消失`)}appendStyleView(){super.appendStyleView(),this.contentView=new TKView,this.contentView.style={width:279,height:512,backgroundColor:"#FFFFFF00",position:"absolute",alignItems:"center",flexDirection:"column",transform:{scale:.8}},this.maskView.appendChild(this.contentView),this.contentView.appendChild(this.createCountdownTitleView()),this.contentView.appendChild(this.createOnlineEarningView())}setupAdditionActions(){this.closeImage.addEventListener("tap",(()=>{this.onCloseTrigger(!0)}))}updateCountdown(t){this.mCountdownTitleView&&this.mCountdownTitleView.setText(`限时红包 ${t}s 后消失`)}showWithAnimation(){}createCountdownTitleView(){return this.mCountdownTitleView=new TKText,this.mCountdownTitleView.style={color:"#FFFFFF",fontSize:20,width:255,height:26,textAlign:"center",marginBottom:10},this.mCountdownTitleView}createOnlineEarningView(){return this.mRootCard=new TKView,this.mRootCard.style={width:"100%",height:420,borderRadius:10,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.mRootCard.appendChild(this.createBgView()),this.mRootCard.appendChild(this.creativeNameView()),this.mRootCard.appendChild(this.createTipsView()),this.mRootCard.appendChild(this.createAmountAreaView()),this.mRootCard.appendChild(this.createBtnOpenView()),this.mRootCard.appendChild(this.createBottomTipsView()),this.mRootCard}createBgView(){let t=new TKImage;return t.style={width:"100%",height:"100%",position:"absolute",borderRadius:10,left:0,right:0,top:0,bottom:0},ke(t,"bg_red_packet_without_open.png"),t}creativeNameView(){let t=new TKView;t.style={height:20,width:"100%",paddingHorizontal:24,marginTop:24,flexDirection:"row",justifyContent:"center",alignItems:"center"};let e=new TKImage;e.style={width:20,height:20,borderRadius:4,borderColor:"#FFFFFF",borderWidth:.5,marginRight:4},t.appendChild(e),ke(e,this.vm.getAutoDialogRedPacketIcon());let i=new TKText;return i.style={color:"#FAE3B7",fontSize:12,fontWeight:"500"},i.setText(this.vm.getAutoDialogRedPacketTitle()),t.appendChild(i),t}createTipsView(){let t=new TKText;return t.style={color:"#FAE3B7",fontSize:20,marginTop:30,marginBottom:39,includeFontPadding:!1,fontWeight:"medium"},t.setText(this.vm.getAutoDialogRedPacketDesc()),t}createAmountAreaView(){let t=new TKView;t.style={width:"100%",height:67,alignItems:"center",flexDirection:"row",justifyContent:"center"};let e=new TKText;e.style={color:"#FAE3B7",paddingLeft:30,fontSize:56,fontWeight:Pe.isAndroid()?"medium":"600",includeFontPadding:!1},e.setText(this.vm.getAutoDialogRedPacketAmount()),t.appendChild(e);let i=new TKView;i.style={width:52,height:"100%",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start"};let n=new TKView;n.style={height:18,width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center"};let s=new TKImage;s.style={height:18,width:52,resize:"cover",position:"absolute",left:0,top:0},ke(s,"ic_redpacket_badge_bg.png"),n.appendChild(s);let a=new TKText;a.style={height:18,fontSize:10,color:"#EB6552",includeFontPadding:!1,textAlign:"center"},a.setText("最高可得"),n.appendChild(a),i.appendChild(n);let o=new TKText;return o.style={color:"#FAE3B7",marginBottom:10,fontSize:18,includeFontPadding:!1},o.setText("元"),i.appendChild(o),t.appendChild(i),t}createBtnOpenView(){let t=new TKImage;return t.style={width:84,height:84},ke(t,"icon_redpacket_open.png"),this.actionContainerView=new TKView,this.actionContainerView.style={width:84,height:84,position:"absolute",alignSelf:"center",bottom:61},this.actionContainerView.appendChild(t),this.actionContainerView}createBottomTipsView(){let t=new TKText;return t.style={color:"#FAE3B7",fontSize:10,opacity:.4,bottom:5,position:"absolute",alignSelf:"center"},t.setText("*实际福利以活动详情为准"),t}}class Ta extends En{constructor(t){super(),this.mTimerInterval=100,this.mTimerCurrent=0,this.mTimerPaused=!1,this.mHadLogClose=!1,this.vm=t,this.mTotalStayTime=this.vm.getAutoDialogStayTime(),Di(this.vm,this.vm.$attrsPath.mPlayPaused,(t=>{this.mTimerPaused=t}))}onCloseTrigger(t){}handleCardClose(t){if(this.mHadLogClose)return;this.mHadLogClose=!0;let e=t?1:2;this.vm.logAutoDialogClose(e),this.welfareHumanCard.cardShowAnimation(!1),this.onCloseTrigger(t)}handleAdClick(t,e,i){setTimeout((()=>{let n=new S;n.template_show_type=this.vm.obtainTemplateShowType(),k(this.vm.mAdInfo)&&this.vm.componentData&&(n.component_module=E(this.vm.mAdInfo,this.vm.componentData));const s=Te(t,this);pi.convertIfNeeded(1,this.vm.mAdInfo,e,s,i,n)}),500),this.handleCardClose(!0)}showDialog(t){super.showDialog(t),this.setupViews(),this.vm.logAutoDialogImpression()}setupViews(){let t=K.getNeoAutoDialogType(this.vm.mAdInfo);1==t?this.welfareHumanCard=new fa(this.vm):2==t&&(this.welfareHumanCard=new ya(this.vm)),this.welfareHumanCard.onCloseTrigger=t=>{this.handleCardClose(t)},this.welfareHumanCard.onAnimEnd=t=>{t?this.startTimer():this.dismiss()},this.welfareHumanCard.onViewClick=(t,e,i)=>{this.handleAdClick(t,e,i)},this.appendChild(this.welfareHumanCard)}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{if(!this.mTimerPaused)if(this.mTimerCurrent+=this.mTimerInterval,this.mTimerCurrent>this.mTotalStayTime)this.stopTimer(),this.handleCardClose(!1);else if(this.mTimerCurrent<this.mTotalStayTime){let t=Math.ceil((this.mTotalStayTime-this.mTimerCurrent)/1e3).toFixed();this.updateCountdown(t)}}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}updateCountdown(t){this.welfareHumanCard.updateCountdown(t)}updatePlayProgress(t){}}class Ia{constructor(){this.mCurrentStatus="none",this.mLoadFinished=!1,this.mVisible=!1,this.mHadFocus=!1}updateLifecycleStatus(t){"showEnd"==t?(this.mLoadFinished=!0,this.mHadFocus=!0,this.mVisible=!0):"pageVisiable"==t?this.mVisible=!0:"pageInvisiable"!=t&&"hideStart"!=t&&"hideEnd"!=t||(this.mVisible=!1),this.mCurrentStatus=t}updateWindowFocusChangeEvent(t){"windowFocusGet"==t?this.mHadFocus=!0:"windowFocusLost"==t&&(this.mHadFocus=!1)}isVisible(){return this.mLoadFinished&&this.mVisible}isFocusAndVisible(){return this.mLoadFinished&&this.mVisible&&this.mHadFocus}isFocus(){return this.mHadFocus}}class va{constructor(t){this.key=t,this.checkDate()}getCurrentCount(){return console.log("tkloadcontroller currentcount:"+this.currentCount),this.currentCount}increaseCurrentCount(){this.checkDate(),this.currentCount+=1,console.log("tkloadcontroller increase currentcount:"+this.currentCount),u.saveLocal(this.getCountKey(),this.currentCount)}checkDate(){let t=u.getLocalString(this.getDateKey());const e=(new Date).toDateString();console.log("tkloadcontroller t:"+t+":"+e),t!==e?(u.saveLocal(this.getDateKey(),e),u.saveLocal(this.getCountKey(),0),this.currentCount=0):this.currentCount=u.getLocalInt(this.getCountKey())}getDateKey(){return console.log("tkloadcontroller key:"+this.key+"_date"),this.key+"_date"}getCountKey(){return console.log("tkloadcontroller key:"+this.key+"_count"),this.key+"_count"}}!function(t){t[t.SHOW_WHEN_PAUSE=1]="SHOW_WHEN_PAUSE",t[t.SHOW_WHEN_STATE_SWITCH=2]="SHOW_WHEN_STATE_SWITCH"}(da||(da={}));class Va extends fn{constructor(t,e,i,n){super(),this.downloadState=0,this.descText="",this.showPopupView=!1,this.showControlStrategy=null,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.screenOrientation=n;let s=qt(this.adInfo);this.needDownloadingState=!!s&&(3!=e&&2!=e&&1!=e)}onCloseClick(){this.showControlStrategy=da.SHOW_WHEN_PAUSE,qt(this.adInfo)?this.needDownloadingState?this.showControlStrategy=da.SHOW_WHEN_STATE_SWITCH:this.showControlStrategy=da.SHOW_WHEN_PAUSE:$t(this.adInfo)&&(this.showControlStrategy=da.SHOW_WHEN_PAUSE)}pageVisibleChange(t){t&&this.updateState(this.downloadState)}updateDownloadProgress(t){1==t.getDownloadState()&&0==t.getProgress()&&(this.showPopupView=!1),t.getTotalBytes()>0&&(this.downloadProgress=t.getProgress(),this.updateDesc(t.getDownloadState(),t.getProgress()),this.updateState(t.getDownloadState()))}updateDesc(t,e){if(this.needDownloadingState){let i=3==t;this.descText=i?"继续下载应用":`下载中${(100*e).toFixed(0)}%`}else this.descText="继续下载应用"}updateState(t){if(0==t)return void(this.downloadState=t);let e=this.downloadState;if(this.downloadState=t,this.showControlStrategy)this.handleShowControlStrategy(e,this.downloadState);else switch(this.downloadState){case 0:case 1:case 4:case 6:break;case 2:this.needDownloadingState?this.showPopupView=!0:this.showPopupView=!1,3==e&&Ne.showToast(this.getContinueToast());break;case 3:this.needDownloadingState||(this.showPopupView=!0),Ne.showToast(this.getPauseToast());break;case 5:this.showPopupView=!1}}handleShowControlStrategy(t,e){this.showControlStrategy==da.SHOW_WHEN_PAUSE?3==e&&(this.showPopupView=!0,this.showControlStrategy=null):this.showControlStrategy==da.SHOW_WHEN_STATE_SWITCH&&(3==e&&2==t||2==e&&3==t)&&(this.showPopupView=!0,this.showControlStrategy=null)}isDownloadPaused(){return 3==this.downloadState}isNeedShowDownloading(){return this.needDownloadingState}convert(t,e,i,n,s=null,a){pi.convertIfNeeded(t,this.adInfo,e,i,n,s,a)}getDesText(){return this.descText}getContinueToast(){return"继续下载中"}getDeleteToast(){return"取消安装,已删除安装包"}getPauseToast(){return"已暂停下载"}}let Aa="MIUI",ba="FLYME",Sa="SAMSUNG";class xa{static isMiui(){return this.check(Aa)}static check(t){return!!ye()&&(this.init(),this.sName.indexOf(t)>=0)}static init(){const t=KSAdSystemUtil.getBUILD();this.sName||(be(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.build.version.opporom",""))?be(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.vivo.os.version",""))?be(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.build.version.emui",""))?be(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.miui.ui.version.name",""))?be(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.product.system.manufacturer",""))?be(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.smartisan.version",""))?be(this.sVersion=KSAdSystemUtil.getSystemProperty(Sa,""))?(this.sVersion=t.DISPLAY,this.sVersion.toUpperCase().indexOf(ba)>=0?this.sName=ba:(this.sVersion="Unknown",this.sName=t.MANUFACTURER)):this.sName=Sa:this.sName="SMARTISAN":this.sName="OnePlus":this.sName=Aa:this.sName="EMUI":this.sName="VIVO":this.sName="OPPO")}}class La{static openDeeplink(t,e,i){if(Pe.supportMinimumTKVersion("4.0.9")){let n=new KSAdNativeIntent;n.setUrl(t),n.setAction("android.intent.action.VIEW"),Pe.isAndroid()||n.putExtra("KSAdOpenURLOptions","UIApplicationOpenURLOptionUniversalLinksOnly"),Pe.supportMinimumTKVersion("5.0.7")&&n.addFlags(268435456),n.setPageStatusCallback((t=>{e(t)})),this.canOpenDeeplink(n)?(i&&i(),KSAdNativeContext.startPage(n)):e(!1,2)}else e(!1,1)}static canOpenDeeplink(t){if(ye()){const e=KSAdNativeContext.getPackageManager().queryIntentActivities(t,65536);return e&&e.length>0}return!0}}class _a{static isPkgInstalled(t){if(ye()){return!be(KSAdNativeContext.getPackageManager().getPackageInfo(t,0))}return!0}static openApp(t,e){if(!ye())return void(e&&e(!1));if(be(t))return void(e&&e(!1));let i=KSAdNativeContext.getPackageManager().getLaunchIntentForPackage(t);i?(i.addFlags(270532608),i.setPageStatusCallback((t=>{e&&e(t)})),KSAdNativeContext.startPage(i)):e&&e(!1)}}var Da=function(t,e,i,n){return new(i||(i=Promise))((function(s,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function r(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}h((n=n.apply(t,e||[])).next())}))};const Fa="__itemId__",ka="__simpleItemId__";class Ra{static handleDeeplink(t,e,i){var n,s,a,o;return Da(this,void 0,void 0,(function*(){if(!(null===(s=null===(n=t.adInfo)||void 0===n?void 0:n.adConversionInfo)||void 0===s?void 0:s.deeplinkUrl))return void(e&&e(0));let r=this.obtainDeeplinkResult(t);if(be(r)||r.indexOf(" ")>=0)return e&&e(-1),function(t,e,i,n,s){var a,o,r;Ze({category:"ad_client_error_log",biz:ai(null===(a=t.scene)||void 0===a?void 0:a.adStyle),sub_biz:"OTHER",rate:1,tag:"response_biz_error",suffixRatio:"",event_id:e,type:"OTHER",msg:{creative_id:null===(o=t.adInfo)||void 0===o?void 0:o.adBaseInfo.creativeId,llsid:null===(r=t.originAdInfo)||void 0===r?void 0:r.llsid,error_name:n,error_data:s},primaryKey:i})}(t,"response_biz_error_convert","dpLinkError","dpLinkError",r),void ei(t,6,r);ti(t,1,r);let h=this.replaceTSMacro(r,t);h=this.appendParams(h,t);const l=this.getGlobalReportData(h);null===(o=null===(a=t.adInfo)||void 0===a?void 0:a.adBaseInfo)||void 0===o||o.productName;this.openDeeplink(h,((n,s)=>{console.log("tkloadcontroller  dp跳转："+n+" ext:"+l),e&&e(n?1:-1,l),n?ti(t,4,h):ei(t,2==s?2:6,h),this.handleDeepResult(n,t,h,i)}),(()=>{ti(t,3,h)}))}))}static openDeeplink(t,e,i){La.openDeeplink(t,e,i)}static handleDeepResult(t,e,i,n){var s;if(t){if(pi.sendLog(320,{},e.originAdInfo),this.sHasCheckDeeplinkResult)return;let t=Math.abs(null===(s=e.serverConfig)||void 0===s?void 0:s.appConfig.deeplinkCheckSwitch);t>0?(this.sHasCheckDeeplinkResult=!0,setTimeout((()=>{this.sHasCheckDeeplinkResult=!1;if(2===KSAdTKApplication.getCurrentAppState()){const t={deeplinkType:1};pi.sendLog(803,t,e.originAdInfo),ti(e,5,i),n&&n()}}),1e3*t)):n&&n()}else pi.sendLog(321,{},e.originAdInfo)}static obtainDeeplinkResult(t){var e,i,n,s,a,o,r;if(ye())for(let h=0;h<(null===(n=null===(i=null===(e=t.adInfo)||void 0===e?void 0:e.adConversionInfo)||void 0===i?void 0:i.deeplinkConf)||void 0===n?void 0:n.length);++h){const e=t.adInfo.adConversionInfo.deeplinkConf[h];if(!be(e.url)){const i=be(e.areaConf)||0==e.areaConf.length||e.areaConf.indexOf(t.itemClickType)>=0,n=be(e.sceneConf)||0==e.sceneConf.length||e.sceneConf.indexOf(t.clickScene)>=0;if(i&&n)return e.url+(null===(a=null===(s=t.adInfo)||void 0===s?void 0:s.adConversionInfo)||void 0===a?void 0:a.deeplinkExtra)}}return null===(r=null===(o=t.adInfo)||void 0===o?void 0:o.adConversionInfo)||void 0===r?void 0:r.deeplinkUrl}static appendParams(t,e){var i,n;if(e.adInfo.adConversionInfo.isSupportKeepPlaying&&e.currentPlayTime&&(null===(i=null==e?void 0:e.adInfo)||void 0===i?void 0:i.adConversionInfo.keepPlayingBackOffTime)){const i=Math.max(e.currentPlayTime-(null===(n=null==e?void 0:e.adInfo)||void 0===n?void 0:n.adConversionInfo.keepPlayingBackOffTime),0);t=this.appendQueryParam(t,{KWAI_PLAYSTARTTIME:i.toString()})}return 1==e.adInfo.adBaseInfo.universeLiveType&&e.adInfo.advertiserInfo.userId&&e.liveItemId&&(t=this.appendLiveParams(t,e)),(Z(e.adInfo)||Q(e.adInfo)&&e.scene)&&(t=this.appendEcParams(t,e)),t}static appendLiveParams(t,e){var i;if(Pe.supportMinimumTKVersion("5.1.2")){if(!e.adInfo.adConversionInfo.needDeeplinkReplaceAdapta)return t;const n=new KSAdTKFlowUuid;let s=e.liveItemId,a="";return be(s)||(a=n.decryptLongFromBase64(a)),be(a)||be(s)?t.indexOf(Fa)>0||t.indexOf(ka)>0?null===(i=e.adInfo)||void 0===i?void 0:i.adConversionInfo.deeplinkUrl:t:t.replace(Fa,s).replace(ka,a)}return t}static replaceTSMacro(t,e){return t.replace("__TS__",KSAdSystemUtil.getSystemTimeInMs(e.adInfo.adBaseInfo.enableClientProofreadTime).toString())}static appendEcParams(t,e){var i;if(!(null===(i=e.scene)||void 0===i?void 0:i.backUrl))return t;let n=3;return _a.isPkgInstalled("com.smile.gifmaker")&&(n=0),this.appendQueryParam(t,{KWAI_RETURN_BACK:"liveunion_"+e.appId,KWAI_BACKURL:e.scene.backUrl})}static appendQueryParam(t,e){let i="",n="";for(let s in e)n+=s+"="+e[s]+"&";return i=t.indexOf("?")>0?t.endsWith("&")?t+n:t+"&"+n:t+"?"+n,i}static getGlobalReportData(t){const e=t.split("?");if(e.length>=2){const t=e[1].split("&");if(t.length>=1)for(let e in t){const i=t[e].split("=");if(2==i.length&&"universeClientInfo"===i[0]){return decodeURIComponent(i[1])}}}return null}}Ra.sHasCheckDeeplinkResult=!1;let Ba={HUAWEI:"com.huawei.appmarket",OPPO:"com.oppo.market",vivo:"com.bbk.appstore",xiaomi:"com.xiaomi.market",OnePlus:"com.oppo.market",Meizu:"com.meizu.mstore",samsung:"com.sec.android.app.samsungapps",SMARTISAN:"com.smartisanos.appstore",Realme:"com.oppo.market",HONOR:"com.huawei.appmarket"};class Ea{static openAppMarket(t,e,i){var n,s,a,o;let r=null===(n=t.adInfo)||void 0===n?void 0:n.adConversionInfo.marketUrl;if(be(r)||!ye())return ni(t,4,r,"not Android platform or marketUrl is empty",!1,!0),void e(!1);"sumsung"===KSAdSystemUtil.getBUILD().BRAND&&(r="http://apps.samsung.com/appquery/appDetail.as?appId="+(null===(s=t.adInfo)||void 0===s?void 0:s.adBaseInfo.appPackageName));try{if(Pe.supportMinimumTKVersion("5.0.7")){ii(t,1,r,!1,!0);const n=KSAdSystemUtil.getBUILD().BRAND;let s=Ba[n],h=new KSAdNativeIntent;h.setUrl(r),h.setAction("android.intent.action.VIEW"),h.addFlags(268435456);let l=KSAdNativeContext.getPackageManager().queryIntentActivities(h,0);if(!l)return e(!1),void ni(t,4,r,"no match app",!1,!0);for(let d in l){const c=l[d],p=null===(a=null==c?void 0:c.activityInfo)||void 0===a?void 0:a.packageName;if(p===s||this.adaptOs(p,n))return h.setComponentName(p,null===(o=null==c?void 0:c.activityInfo)||void 0===o?void 0:o.name),h.setPageStatusCallback((n=>{if(n)return e(n),pi.sendLog(323,{appStorePageType:0,triggerType:0},t.originAdInfo),ii(t,2,r,!1,!0),void this.checkAppMarketNs(t,r,i);this.openMarketDefault(t,r,e,i)})),void KSAdNativeContext.startPage(h)}return void e(!1)}e(!1),ni(t,4,r,"tk version less than 5.0.7",!1,!0)}catch(h){Qe(h),this.openMarketDefault(t,r,e,i)}}static checkAppMarketNs(t,e,i){var n;let s=Math.abs(null===(n=t.serverConfig)||void 0===n?void 0:n.appConfig.deeplinkCheckSwitch);s>0?setTimeout((()=>{2===KSAdTKApplication.getCurrentAppState()&&ii(t,3,e,!1,!0),i&&i()}),1e3*s):i&&i()}static openMarketDefault(t,e,i,n){if(Pe.supportMinimumTKVersion("5.0.7")){let s=new KSAdNativeIntent;s.setUrl(e),s.setAction("android.intent.action.VIEW"),s.addFlags(268435456),s.setPageStatusCallback((s=>{i(s),s?(pi.sendLog(323,{appStorePageType:0,triggerType:0},t.originAdInfo),ii(t,2,e,!1,!1),ii(t,3,e,!1,!1),n&&n()):ni(t,4,e,"unknown_openMarketDefault",!1,!1)})),KSAdNativeContext.startPage(s)}else i(!1),ni(t,4,e,"tk version less than 5.0.7",!1,!1)}static adaptOs(t,e){return"OPPO"===e&&"com.heytap.market"===t}static openMiAppStore(t,e){var i,n;if(!ye())return void e(!1);const s=null===(i=t.adInfo)||void 0===i?void 0:i.adConversionInfo.marketUrl;ye()&&s&&xa.isMiui()&&4!=(null===(n=t.scene)||void 0===n?void 0:n.adStyle)?(ii(t,1,s,!0,!1),Ra.openDeeplink(s,(i=>{e(i),i?(pi.sendLog(323,{appStorePageType:1,triggerType:0},t.originAdInfo),ii(t,2,s,!0,!1),this.checkAppMarketNs(t,s)):ni(t,4,s,"unknown_openMiAppStore",!0,!1)}),(()=>{}))):e(!1)}static isSupportMiMarket2(){if(!ye()||!xa.isMiui())return!1;if(Pe.supportMinimumTKVersion("6.0.3")){let e=null;try{if(e=KSAdNativeContext.getContentResolver().query("content://com.xiaomi.market.provider.DirectMailProvider",null,null,null,null),null==e||e.isClosed())return console.log("AppMarketHelper: isSupportMiMarket2-----cursor is null"),!1;e.moveToFirst();let t=e.getColumnIndex("support");if(t>=0){return"true"===e.getString(t)}return!1}catch(t){console.log("AppMarketHelper: isSupportMiMarket2-----"+t)}finally{null!=e&&e.close()}}return!1}static isMiMarket2Dp(t){return!(!t.startsWith("market://details")&&!t.startsWith("mimarket://details"))}}class Ka extends fn{constructor(){super(...arguments),this.interactSuccess=void 0,this.playPaused=!1}checkDataValid(){return!!this.adInfo}getIconUrl(){try{let t=this.adInfo.adBaseInfo.appIconUrl;return Ie(t)||(t=this.adInfo.advertiserInfo.portraitUrl),Ie(t)||(t="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),t}catch(t){}return"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}getRewardDuration(){var t;return 1e3*((null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.duration)||10)}getRewardVideoInteractInfo(){return this.adInfo.adMatrixInfo.adDataV2.rewardVideoInteractInfo}getAnswerSuccessMsg(){var t;return(null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.successfulMsg)||"恭喜您可提前获得奖励"}getAnswerErrorMsg(){var t;return(null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.errorMsg)||"互动错误，继续播放视频"}getRewardTitle(){var t,e;return(null===(e=null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.styleInfo)||void 0===e?void 0:e.title)||"答对可提前获得奖励"}getRewardSubTitle(){var t,e;return(null===(e=null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.styleInfo)||void 0===e?void 0:e.subTitle)||"该视频主要讲的是？"}getRewardRightAnswer(){return K.getAdTitle(this.adInfo)}getRewardErrorAnswer(){var t,e;return(null===(e=null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.styleInfo)||void 0===e?void 0:e.errorAnswer)||"石头"}getRedbagLongPressDuraion(){var t,e;return(null===(e=null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.styleInfo)||void 0===e?void 0:e.longPressDurarion)||5}getInteracrStyle(){var t;return(null===(t=this.getRewardVideoInteractInfo())||void 0===t?void 0:t.style)||1}getInteractShowTime(){return Dt(this.adInfo)}}class Pa extends Ka{constructor(t,e){super(),this.lifeStatus="none",this.mLifeCycleHelper=new Ia,this.adInfo=t,this.adStyle=e}getData(t){let e=[];e.push(Ne.getKsAdDataAsync()),e.push(Ne.getDeviceInfoAsync()),e.push(Ne.getKsAdConfigAsync()),e.push(Ne.getContainerLimitAsync()),e.push(Ne.getScreenOrientationAsync()),Promise.all(e).then((e=>{try{const n=e[0].data;if(n)try{this.adInfo=n.impAdInfo[0].adInfo[0],this.adStyle=n.impAdInfo[0].adStyle,oe(this.deviceInfo),t&&t(!0),this.initAfterDataReady()}catch(i){t&&t(!1)}else t&&t(!1)}catch(i){t&&t(!1)}}))}initAfterDataReady(){this.registerLifeStatusListener()}registerLifeStatusListener(){Ne.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&(this.mLifeCycleHelper.updateLifecycleStatus(e),this.checkVisibleChange())}})),Ne.registerFocusListener((t=>{if(t.result&&t.data){const e=t.data.windowFocusEvent;this.mLifeCycleHelper.updateWindowFocusChangeEvent(e),this.checkVisibleChange()}}))}checkVisibleChange(){let t=this.mLifeCycleHelper.isFocusAndVisible();this.playPaused=!t}}class Ma extends fn{constructor(t,e,i,n,s){super(),this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s}updateLifeStatus(t){this.lifeStatus=t}isVertical(){return 0==this.screenOrientation}getLiveButtonTitle(){return be(this.adInfo.adBaseInfo.universeLiveGuideText)?"点击进入直播间":this.adInfo.adBaseInfo.universeLiveGuideText}}class Oa{constructor(){this.downloadStats=0,this.downloadProgress=-1,this.totalBytes=0}static newInstance(t,e,i){let n=new Oa;return n.downloadStats=t,n.downloadProgress=e,n.totalBytes=i,n}obtainActionButtonText(t){let e,i=qt(t);switch(this.downloadStats){case 0:case 1:case 4:e=t.adBaseInfo.adActionDescription;break;case 2:e=i?"暂停":`${(100*this.downloadProgress).toFixed(0)}%`;break;case 3:e="继续下载";break;case 5:e=Ie(t.adBaseInfo.installAppLabel)?t.adBaseInfo.installAppLabel:"点击安装";break;case 6:e=Ie(t.adBaseInfo.openAppLabel)?t.adBaseInfo.openAppLabel:"立即打开"}return e}getProgress(){return this.downloadProgress}getDownloadState(){return this.downloadStats}getTotalBytes(){return this.totalBytes}isDownloadFinish(){return 5==this.downloadStats||6==this.downloadStats}isDownloading(){return 2==this.downloadStats}}class Na extends fn{constructor(){super(...arguments),this.actionText="",this.downloadChangeEvent=new Oa,this.lifeStatus="none",this.hasExtraReward=!1,this.widthDp=0,this.slotId=-1,this.componentData=void 0}obtainScreenWidthDp(){return this.widthDp>0?this.widthDp:375}isScreenPortrait(){return 0==this.screenOrientation}checkDataValid(){return!!this.adInfo}getBottomBarStyle(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.style}catch(t){}return 0}getShortVideoFollowPlaycardStyle(){return this.configInfo.abConfig.shortVideoFollowRewardPlayStyle}isEcFollow(){return Tt(this.adInfo)}getNeoActionBarCardType(){return 2==this.adStyle?K.getNeoActionBarCardType(this.adInfo):3==this.adStyle?K.getFullscreenActionBarCardType(this.adInfo):null}getActionBarStyle(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType}catch(t){}return 0}getLightInteractionType(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionType}catch(t){}return 0}getLightInteractionShowTime(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionShowTime}catch(t){}return 2}getLightInteractionDuration(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionDuration}catch(t){}return 6}getAdAttributeType(){return this.adInfo.adBaseInfo.adAttributeType||0}isDownloadAd(){return 1==this.adInfo.adBaseInfo.adOperationType}getDownloadAppIcon(){let t;try{t=this.adInfo.adBaseInfo.appIconUrl}catch(e){}return Ie(t)||(t="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),t}getAdTitle(){var t;return nt(this.adInfo)&&ui(null===(t=this.adInfo.adProductInfo)||void 0===t?void 0:t.name)?this.adInfo.adProductInfo.name:J(this.adInfo)}getAppScore(){return this.adInfo.adBaseInfo.appScore||0}getAppDownloadCountDesc(){return this.adInfo.adBaseInfo.appDownloadCountDesc||null}getAdDescription(){return this.adInfo.adBaseInfo.appDescription||this.adInfo.adBaseInfo.adDescription||null}getAdActionDesc(){return this.adInfo.adBaseInfo.adActionDescription||""}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}getAdIcon(){var t,e;return nt(this.adInfo)&&Ie(null===(e=null===(t=this.adInfo)||void 0===t?void 0:t.adProductInfo)||void 0===e?void 0:e.icon)?this.adInfo.adProductInfo.icon:N(this.adInfo)}isVerticalMaterial(){let t=G(this.adInfo);return t.width<t.height}getMaterialSize(){return G(this.adInfo)}getVideoDuration(){return Y(this.adInfo)}isAdForLive(){return ft(this.adInfo)}isAddLiveButton(){return 1==this.adInfo.adBaseInfo.universeLiveStyle}isShortLive(){return 6==$(this.adInfo)}isECOrderAd(){return function(t,e){if(nt(e))return!1;let i=!1;try{i=1==t.abConfig.ecRewardAdKwaishopStyle}catch(n){return!1}return i&&Q(e)}(this.configInfo,this.adInfo)}isLiveSubscribe(){return It(this.adInfo)}isClickReward(){return vt(this.adInfo)}isCommercialProductStyle(){return nt(this.adInfo)}getAdTagList(){try{const t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.extraDisplayInfo.exposeTagInfoList;if(t.length>0)return t}catch(t){}return null}getPlayableStyle(){return bt(this.adInfo,this.adStyle,this.screenOrientation)}isHorizontalPlayable(){return 0!=this.getPlayableStyle()&&1==this.screenOrientation}convert(t,e,i,n,s=null,a,o){k(this.adInfo)&&this.componentData&&(s||(s=new S),s.component_module=E(this.adInfo,this.componentData)),pi.convertIfNeeded(t,this.adInfo,e,i,n,s,a,o)}getECOrderData(){return this.mCardModel||(this.mCardModel=Wa.newInstance(this.adInfo)),this.mCardModel}getDirectEcData(){return this.directEcCardModel||(this.directEcCardModel=za.newInstance(this.adInfo,this.configInfo)),this.directEcCardModel}getNormalModel(){return this.normalCardModel||(this.normalCardModel=Ga.newInstance(this.adInfo,this.configInfo.appConfig)),this.normalCardModel}getLiveSubscribeModel(){return null==this.liveSubscribeModel&&(this.liveSubscribeModel=ja.newLiveSubscribeCarInstance(this.adInfo,this.componentData)),this.liveSubscribeModel}getCouponModel(){return this.couponCardModel||(null!=Ua.newInstance(this.adInfo,this.styleType,this.configInfo)?this.couponCardModel=Ua.newInstance(this.adInfo,this.styleType,this.configInfo):this.couponCardModel=new Ua),this.couponCardModel}getKSAdLiveButtonViewModel(){return this.adLiveButtonModel=new Ma(this.adInfo,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation),this.adLiveButtonModel}getCouponBackImageUrl(){return"icon_ksad_video_coupon.png"}supportNewAnimation(){return Pe.supportMinimumTKVersion("4.0.0")}showPlayable(t){pi.clickElement(67),Ne.showPlayable(t)}isDiscountNewStyle(){let t=!1;try{t=1==this.adInfo.adProductInfo.discountStyle}catch(e){}return Pe.isAndroid()||Pe.supportMinimumTKVersion("4.0.3")||(t=!1),0==this.getDiscountType()&&(t=!1),t}isAutoChooseReward(){try{return 1==this.adInfo.adProductInfo.autoChoose}catch(t){}return!1}getAutoChooseRewardCountDown(){try{return this.configInfo.appConfig.interactiveStyleConfig.chooseRewardTime}catch(t){}return 20}getGuideChooseRewardCountDown(){try{return this.configInfo.appConfig.interactiveStyleConfig.superDiscountTime}catch(t){}return 60}getGuideChooseRewardRemainingTime(){try{return this.configInfo.appConfig.interactiveStyleConfig.transitReceiveTime}catch(t){}return 10}getDiscountType(){try{return this.adInfo.adProductInfo.discountType}catch(t){}return 0}enableShowGuidanceRedPacket(){return this.getVideoDuration()-this.getAutoChooseRewardCountDown()>=this.getGuideChooseRewardRemainingTime()}getDiscountInfos(){try{return this.adInfo.adProductInfo.fakeDiscountInfos}catch(t){}return[]}getRedPacketValueString(t){const e=this.getDiscountInfos();if(0==t){if(e.length>1)return e.length>2?e[2]:e[1]}else if(1==t){if(e.length>0)return e[0]}else if(2==t&&e.length>2)return e[1];return""}getRedPacketImageUrl(t,e){let i="";if(t){if(i=1==this.getDiscountType()?"icon_ksad_discounts_red_packet_open_coupon.png":"icon_ksad_discounts_red_packet_open.png",be(this.getRedPacketValueString(e)))return"icon_ksad_discounts_red_packet_open_surprise.png"}else i=1==e?"icon_ksad_discounts_red_packet_close_most.png":"icon_ksad_discounts_red_packet_close.png";return i}setStyleType(t){this.styleType=t}isValidBottomCouponCardInfo(){return null!=this.bottomCouponInfo}getCouponBottomBusinessType(){let t;try{t=null==this.bottomCouponInfo?0:this.bottomCouponInfo.businessType}catch(e){t=0}return t}getCouponBottomDuration(){let t;try{t=null==this.bottomCouponInfo?0:this.bottomCouponInfo.couponDuration}catch(e){t=0}return t}getCouponCardViewBg(){let t;try{t=null==this.bottomCouponInfo?"ksad_bottom_bar_coupon_bg.png":this.bottomCouponInfo.couponIcon}catch(e){t="ksad_bottom_bar_coupon_bg.png"}return Ie(t)||(t="ksad_bottom_bar_coupon_bg.png"),t}getCouponBottomPriceRMB(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.priceTag}catch(e){t=""}return Ie(t)||(t=""),t}getCouponBottomPrice(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.price}catch(e){t=""}return Ie(t)||(t=""),t}getCouponBottomTitle(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.title}catch(e){t=""}return Ie(t)||(t=""),t}getCouponBottomActionBtn(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.actionBarDesc}catch(e){t=""}return Ie(t)||(t=""),t}getProductShortTitle(){let t;try{t=this.adInfo.adProductInfo.shortTitle}catch(e){}return Ie(t)||(t=""),t}getProductSellingPoint(){let t;try{t=this.adInfo.adProductInfo.sellingPoint}catch(e){}return Ie(t)||(t="优惠好物 诚心推荐"),t}getDiscountFinalViewWidth(){return 0==this.screenOrientation?Tachikoma.env.deviceWidth:324}getRedPacketViewSize(t,e){let i=Tachikoma.env.deviceWidth-80;1!=t&&(i=0==this.screenOrientation?Tachikoma.env.deviceWidth-76-60:200);let n=i/3.15,s=1.15*n;return{width:1==e?s:n,height:1==e?s/.77:n/.77}}getDiscountNeoExtData(t){const e=this.getDiscountType();let i=new x;return 1==e?i.neoAwardType="union_coupon":2==e?i.neoAwardType="union_spike":3==e&&(i.neoAwardType="union_discount"),t&&t.length>0&&(i.neoAwardAmount=t.join(",")),i}getDiscountTemplateShowType(t){return 1==t?"neo_award_card_1":2==t?"neo_award_card_2":3==t?"neo_award_card_3":""}reportDiscountViewImpression(t){let e=new S;e.neo_ext_data=this.getDiscountNeoExtData(this.getDiscountInfos()),e.template_show_type=this.getDiscountTemplateShowType(t);let i,n={clientExtData:JSON.stringify(e)};1==t?i=929:2==t?i=930:3==t&&(i=931);let s={actionType:i,payload:JSON.stringify(n)};Ne.sendLog(s)}reportDiscountInitialViewClose(t){let e=new S;e.template_show_type=this.getDiscountTemplateShowType(t);let i={elementType:69,clientExtData:JSON.stringify(e)},n={actionType:141,payload:JSON.stringify(i)};Ne.sendLog(n)}getCouponTemplateShowType(t){return 1==t?"coupon_of_cash_equity":2==t?"coupon_of_no_cash_equity":""}reportEquityCardImpression(t){let e=new S;e.template_show_type=this.getCouponTemplateShowType(t);let i={elementType:16,clientExtData:JSON.stringify(e)},n={actionType:140,payload:JSON.stringify(i)};Ne.sendLog(n)}isDeepVideoStyle(){if(1==this.screenOrientation)return!1;if(be(this.deepVideoModel)&&(this.deepVideoModel=new Ya(this.adInfo)),be(this.deepVideoModel.deepVideoInfo)){try{let t;t=2==this.adStyle?this.adInfo.adMatrixInfo.adDataV2.neoTKInfo.templateId:this.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.templateId;let e=Gt(Lt(t,this.adInfo));if(!be(e)&&e.merchantPlayCardStyle>0)return this.deepVideoModel.deepVideoInfo=e,!0}catch(t){}return!1}return!0}isShowCardDynamicEffects(){return 2==this.adStyle?this.cardDynamicEffects=ct(this.adInfo,12):3==this.adStyle&&(this.cardDynamicEffects=ct(this.adInfo,3)),!be(this.cardDynamicEffects)&&!(2==this.cardDynamicEffects&&!Pe.supportMinimumTKVersion("6.0.0"))}getLiveCutRoomInfo(){return Yt(this.adStyle,this.adInfo)}reportConductCardImpression(t){let e=new S;e.template_show_type=t;let i={elementType:19,clientExtData:JSON.stringify(e)},n={actionType:140,payload:JSON.stringify(i)};Ne.sendLog(n)}getDownloadCardTemplateShowType(){var t,e;return 1==(null===(t=this.downloadCardDataInfo)||void 0===t?void 0:t.style)?"white_download_card":2==(null===(e=this.downloadCardDataInfo)||void 0===e?void 0:e.style)?"black_download_card":void 0}isValidDownloadCardInfo(){return 2==this.adStyle?this.downloadCardDataInfo=dt(this.adInfo,12):3==this.adStyle&&(this.downloadCardDataInfo=dt(this.adInfo,3)),!(be(this.downloadCardDataInfo)||!Ie(this.getAppDownloadCountDesc()))}reportDownloadCardImpression(){let t=new S;t.template_show_type=this.getDownloadCardTemplateShowType(),this.isShowCardDynamicEffects()&&(t.dynamic_show_type=this.cardDynamicEffects);let e={elementType:19,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}reportOptimalCardImpression(){let t=new S;t.template_show_type=this.getOptimalCardShowType(),this.isShowCardDynamicEffects()&&(t.dynamic_show_type=this.cardDynamicEffects);let e={elementType:19,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}getOptimalCardShowType(){switch(this.getActionBarStyle()){case 1:return"basic_smallcard";case 2:return"gradient_card";case 4:return"immersion_bigcard";default:return""}}}class Ha{constructor(t){if(this.hour="0",this.minute="0",this.second="0",t>0){let e=t/1e3;this.hour=Math.floor(e/3600).toString(),e%=3600,this.minute=Math.floor(e/60).toString(),e%=60,this.second=Math.floor(e).toString()}}getFormattedHour(){return this.formatTime(this.hour)}getFormattedMinute(){return this.formatTime(this.minute)}getFormattedSecond(){return this.formatTime(this.second)}formatTime(t){return be(t)?"":t.length>1?t:"0"+t}}class Wa{static newInstance(t){let e,i=new Wa,n=t.adProductInfo,s=n.seckillInfo;return i.hasCounpon=!Se(n.couponList),i.name=be(n.name)?"可爱的广告君":n.name,i.icon=n.icon,i.price=n.price,i.originalPrice=n.originPrice,be(s)||(i.spikeTimestamp=s.endTime,i.spikeSoldStock=s.soldStock,i.spikeOriginalStock=s.originalStock),i.hasSpike=i.spikeTimestamp>0,i.volume=n.volume,i.rating=n.rating,i.btnClickText="立即抢购",i.volume&&i.rating?i.volumeAndRating=i.volume+" | "+i.rating:i.volume?i.volumeAndRating=i.volume:i.rating&&(i.volumeAndRating=i.rating),i.adInfo=t,e=i.hasSpike&&i.hasCounpon?"spikeAndCoupon":i.hasSpike?"spike":i.hasCounpon?"coupon":"noSpikeAndNoCoupon",i.cardStyle=e,i}getSpikeTime(){let t=Date.parse((new Date).toString());return new Ha(this.spikeTimestamp-t)}getAdDesc(){let t;return t=this.hasSpike?"已抢"+this.spikeSoldStock+"/"+this.spikeOriginalStock+"件":be(this.rating)||be(this.volume)?be(this.rating)?be(this.volume)?"":this.volume:this.rating:this.volume+"·"+this.rating,t}getPricePrefix(){let t;return t=this.hasCounpon?"券后价":this.hasSpike?"秒杀价":"惊喜价",t}getHeaderIcon(){return this.hasCounpon?"icon_ksad_ec_order_coupon.png":"icon_ksad_ec_order_gift.png"}getHeaderTips(){return this.hasCounpon?"恭喜你，获取一张优惠券":"恭喜你发现好价，手慢无～"}getCardStyleLog(){let t;if(be(this.cardStyle))return t="5",t;switch(this.cardStyle){case"spikeAndCoupon":t="1";break;case"spike":t="2";break;case"coupon":t="3";break;case"noSpikeAndNoCoupon":t="4";break;default:t="5"}return t}}class za{static newInstance(t,e){let i=new za;i.cardStyle=0|e.appConfig.h5UrlNewStyle;let n=t.adProductInfo;if(i.hasCounpon=!Se(n.couponList),i.hasCounpon){const t=n.couponList[0];i.couponTitle="￥ "+t.displayValue}if(i.name=be(n.name)?"可爱的广告君":n.name,i.icon=n.icon,i.price=Ie(n.price)?n.price:"惊喜价",i.originalPrice=n.originPrice,!Se(n.couponList)){let t=n.couponList[0];i.spikeIntervalMs=1e3,i.spikeTimestamp=Ie(t.leftFetchTime)?Number(t.leftFetchTime):0}return i.hasSpike=i.spikeTimestamp>0&&2==i.cardStyle,i.volume=n.volume,i.rating=n.rating,i.btnClickText="立即抢购",i.volume&&i.rating?i.volumeAndRating=i.volume+" | "+i.rating:i.volume?i.volumeAndRating=i.volume:i.rating&&(i.volumeAndRating=i.rating),i.adInfo=t,i}getSpikeTime(){this.spikeTimestamp<0&&(this.spikeTimestamp=0);const t=new Ha(this.spikeTimestamp);return this.spikeTimestamp-=this.spikeIntervalMs,t}}class Ua{constructor(){this.cardStyle=0,this.delayTime=2}static newInstance(t,e,i){return function(t,e){let i=ot(t,e);if(be(i)||be(i.data))return;let n=JSON.parse(i.data);return be(n.couponInfo)?void 0:(null==n.couponInfo.delayTime&&(n.couponInfo.delayTime=2),n.couponInfo)}(t,e)}}class Ga{bindBaseData(t){this.iconUrl=N(t),this.name=J(t),this.actionText=Vt(t),this.desc=t.adBaseInfo.adDescription}static newInstance(t,e){let i=new Ga;return i.bindBaseData(t),i.extraActionText=e.rewardContentExtraRewardNotClickedDesc,be(i.extraActionText)&&(i.extraActionText="立即点击，可再得1份奖励"),i.extraActionTextClicked=e.rewardContentExtraRewardClickedDesc,be(i.extraActionTextClicked)&&(i.extraActionTextClicked="立即打开"),i}}class ja extends Ga{static newLiveSubscribeCarInstance(t,e){let i=new ja;if(k(t)&&e){let t=B(e);t&&(i.name=t.title,i.desc=t.liveStartTime,i.iconUrl=t.userHeadUrl,i.subscribeCount=this.formatCount(t.bookUserCount))}else{let e=t.adMatrixInfo.adDataV2.merchantLiveReservationInfo;e&&(i.name=e.title,i.desc=e.liveStartTime,i.iconUrl=e.userHeadUrl,i.subscribeCount=this.formatCount(e.bookUserCount))}return i}static formatCount(t){let e="";if(t>=50&&t<1e4)e=t.toFixed(2);else if(t>=1e4){e=(t/1e4).toFixed(1)+"万"}return e}}class Ya{constructor(t){this.deepVideoInfo=void 0,this.adInfo=t}getDeepVideCardStyle(){return this.deepVideoInfo.merchantPlayCardStyle}getDeepVideoTransformTime(){try{if(this.deepVideoInfo.showNewStyleDelaySeconds>0)return this.deepVideoInfo.showNewStyleDelaySeconds}catch(t){}return 5}getDeepVideoGoodsIcon(){return Ie(this.deepVideoInfo.icon)?this.deepVideoInfo.icon:N(this.adInfo)}getDeepVideoGoodsIconlabel(){return this.deepVideoInfo.iconLabel}getDeepVideoGoodsTitle(){return this.deepVideoInfo.itemTitle}getDeepVideoAuthorName(){return this.deepVideoInfo.authorName}isDeepVideoShowLowPrice(){var t;return null!==(t=this.deepVideoInfo.showLowPrice)&&void 0!==t&&t}getDeepVideoPrice(){return this.deepVideoInfo.price}getDeepVideoOrderList(){return this.deepVideoInfo.itemTradeInfoList}getActionBarDesc(){return this.deepVideoInfo.actionBarDesc}isShowComments(){return this.deepVideoInfo.showComments}getCommentList(){try{return this.deepVideoInfo.confCommentList}catch(t){return null}}}class Xa extends Ga{static newLiveCutInstance(t,e){var i;let n=new Xa;n.bindBaseData(t);let s=null==e?void 0:e.neoLiveRoomInfoData;if(be(s))return null;try{if(n.iconUrl=s.authorIconUrl,n.sellerTag=s.sellerTag,be(n.sellerTag)&&(n.sellerTag="优质主播"),n.actionBarDesc=s.actionBarDesc,n.tradeCustomerDesc=s.tradeCustomerDesc,n.watchCount=s.watchCount,s.watchUserIcons){s.watchUserIcons.length<=3?n.watchUserIcons=s.watchUserIcons:(!function(t){let e=t.length;for(let i=0;i<e;i++){let n=De(i,e-1),s=t[i];t[i]=t[n],t[n]=s}}(s.watchUserIcons),n.watchUserIcons=s.watchUserIcons.slice(0,3))}n.tradeTips=new Array;let t=null===(i=s.tradeTips)||void 0===i?void 0:i.length;for(let e=0;e<t;e++){let t=s.tradeTips[e],i=new L;i.buyerImage=t.iconUrl,i.tradeMessage=t.tipsText,n.tradeTips.push(i)}n.liveStatDataDesc=s.liveStatDataDesc,n.actionBarSubTitle=s.actionBarTips,n.desc=s.authorDesc,be(n.desc)&&(n.desc="惊喜多多，快来快来！")}catch(a){return null}return n}}class Ja extends Na{constructor(t,e,i,n,s,a){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.bottomCouponInfo=ht(this.adInfo,12),this.widthDp=ge(a)}}var $a;!function(t){t[t.NEO=0]="NEO",t[t.FULLSCREEN=1]="FULLSCREEN",t[t.LIVE_NEO=2]="LIVE_NEO",t[t.LIVE_FULLSCREEN=3]="LIVE_FULLSCREEN",t[t.IMAGE_NEO=4]="IMAGE_NEO",t[t.IMAGE_FULLSCREEN=5]="IMAGE_FULLSCREEN"}($a||($a={}));class qa extends fn{constructor(t,e,i,n,s,a){super(),this.lifeStatus="none",this.extraGivenStatus=0,this.playableSourceType=0,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a}}class Za extends In{constructor(t,e,i,n,s,a){super(),this.isShow=!1,this.hasShowAggCard=!1,this.isPlayAgain=!1,this.actionText="",this.hasGift=!1,this.isWebViewDidLoad=!1,this.canShowAggregation=!1,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a,this.halfsizeConfirmInfo=et(this.adInfo),this.webViewVM=new qa(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation),this.aggregationCardVM=new Kn(this.adStyle,this.configInfo,s,this.screenOrientation)}updateNeoConfirmActionText(t){be(t)||(this.actionText=t,this.refreshActionDesCallBack&&this.refreshActionDesCallBack(t))}handleAbandon(){this.skipToEndHandler&&this.skipToEndHandler(),this.neoConfirmLeave(),this.closeDialog()}handleContinue(){this.neoConfirmContinue(),this.closeDialog()}handleClose(){Ne.sendLog({actionType:3}),this.closeDialog()}handleConvert(t,e,i){wt(this.adInfo,t)&&(this.closeDialog(),pi.convertIfNeeded(6,this.adInfo,t,e,i,null,{retain_code_type:this.getRetainCodeType()}))}handleGiftCallAction(e){pi.convertIfNeeded(6,this.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_OTHERAREA_CLICK,null,{retain_code_type:this.getRetainCodeType()}),this.closeDialog()}closeDialog(){this.isShow=!1}getCoverUrl(){return this.adInfo.adMaterialInfo.materialFeature[0].coverUrl}getSkipConfirmSwitch(){let t=!0;try{t=null==this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch||this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch}catch(e){}return t}canShowGiftConfirm(){var t;return!!(this.getSkipConfirmSwitch()&&this.hasGift&&(null===(t=this.adInfo.adMatrixInfo.adDataV2.neoTKInfo)||void 0===t?void 0:t.showFinishConfirm))}getLandingPageUrl(t){try{Ne.getLandingPageInfo((e=>{let i=e.data;const n=i?i.landingPageUrl:void 0;Ie(n)?t(n):t(this.adInfo.adConversionInfo.h5Url)}))}catch(e){t(this.adInfo.adConversionInfo.h5Url)}}getTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.endCardInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}getClickText(){var t,e,i;return(null===(e=null===(t=this.halfsizeConfirmInfo)||void 0===t?void 0:t.texts)||void 0===e?void 0:e.adActionDescription)?null===(i=this.halfsizeConfirmInfo)||void 0===i?void 0:i.texts.adActionDescription:"立即获取"}getDec(){return this.adInfo.adBaseInfo.adDescription}getTitleText(){return J(this.adInfo)}getConfirmGiftTipDec(){var t;return null===(t=this.halfsizeConfirmInfo)||void 0===t?void 0:t.confirmFinishTipsDes}getFansCount(){var t,e,i;return(null===(t=this.adInfo.advertiserInfo)||void 0===t?void 0:t.fansCount)/1e4>=1?(null===(e=this.adInfo.advertiserInfo)||void 0===e?void 0:e.fansCount)%1e4<1e3?(this.adInfo.advertiserInfo.fansCount/1e4).toFixed(0)+"万人关注了TA":(this.adInfo.advertiserInfo.fansCount/1e4).toFixed(1)+"万人关注了TA":(null===(i=this.adInfo.advertiserInfo)||void 0===i?void 0:i.fansCount)+"人关注了TA"}getLiveImg(){return this.adInfo.adMaterialInfo.materialFeature[0].coverUrl}getLabelList(){var t;return null===(t=this.halfsizeConfirmInfo)||void 0===t?void 0:t.sellerTag}getwatchingCount(){var t;return null===(t=this.halfsizeConfirmInfo)||void 0===t?void 0:t.watchingCount}neoConfirmContinue(){let t={retain_code_type:this.getRetainCodeType(),elementType:150};this.isScanAggregation()&&(t={retain_code_type:this.getRetainCodeType(),elementType:150,businessSceneType:33});let e={actionType:451,payload:JSON.stringify(t)};Ne.sendLog(e)}neoConfirmLeave(){let t={elementType:151,retain_code_type:this.getRetainCodeType()};this.isScanAggregation()&&(t={retain_code_type:this.getRetainCodeType(),elementType:151,businessSceneType:33});let e={actionType:141,payload:JSON.stringify(t)};Ne.sendLog(e)}getSceneType(){try{if(this.isScanAggregation())return 3}catch(t){}return 0}isScanAggregation(){try{if(1==this.adOriginInfo.adGlobalConfigInfo.neoPageType)return!0}catch(t){}return!1}getScanAggregationRewardTime(){try{return this.adOriginInfo.adGlobalConfigInfo.neoScanAggregationSceneInfo.neoCountDownTime}catch(t){}return gt(this.adInfo)}}const Qa="half_screen_card";class to extends Na{constructor(t,e){super(),this.currentPlaybackTime=0,this.playFailed=!1,this.playFinished=!1,this.webviewDidLoad=!1,this.landingPageDidShow=!1,this.callerContext=t,this.halfplayerCardInfo=function(t,e){let i=ot(t,e);if(be(i)||be(i.data))return;let n=JSON.parse(i.data);return be(n.halfPlayerInfo)?void 0:(null==n.halfPlayerInfo.delayTime&&(n.halfPlayerInfo.delayTime=15e3),n)}(this.callerContext.adInfo,12),this.webViewVM=new qa(this.callerContext.adInfo,e,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit,this.callerContext.screenOrientation)}shouldShowHalfPlayer(){try{return 11==this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType&&(!(this.getCardHeight()<297)&&(!be(this.halfplayerCardInfo)&&(this.halfPlayerInfo=this.halfplayerCardInfo.halfPlayerInfo,this.starStyleInfo=this.halfplayerCardInfo.starStyleInfo,!be(this.halfPlayerInfo)||(this.reportHalfplayerShowEvent("no halfPlayerInfo data"),!1))))}catch(t){this.reportHalfplayerShowEvent(we(t))}return!1}getCardHeight(){let t=this.callerContext.containerLimit.height;return 0==this.callerContext.screenOrientation&&(t=this.callerContext.containerLimit.height/2),t}getCardWidth(){let t=this.callerContext.containerLimit.width;return 1==this.callerContext.screenOrientation&&(t=this.callerContext.containerLimit.width/2),t}getShowLandingPageSwitch(){try{return this.halfPlayerInfo.showLandingPageSwitch}catch(t){}return!1}getShowLandingPageTime(){try{return this.halfPlayerInfo.showLandingPageTime/1e3}catch(t){}return 0}getShowLandingPageH5Url(){try{return this.callerContext.adInfo.adConversionInfo.h5Url}catch(t){}return""}enableShowLandingPage(){return this.getShowLandingPageSwitch()&&this.getShowLandingPageH5Url().length>0}getAppScore(){return this.callerContext.adInfo.adBaseInfo.appScore||0}getAdTagList(){try{const t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.extraDisplayInfo.exposeTagInfoList;if(t.length>0)return t}catch(t){}return null}getAdTitle(){return J(this.callerContext.adInfo)}getAdDesc(){return this.callerContext.adInfo.adBaseInfo.appDescription||this.callerContext.adInfo.adBaseInfo.adDescription||null}getActionBarText(){let t=this.callerContext.adInfo.adBaseInfo.adActionDescription||"立即下载";try{if(console.log("tkloadcontroller isdownload:"+X(this.callerContext.adInfo)),X(this.callerContext.adInfo)){const e=this.halfplayerCardInfo.texts;switch(this.callerContext.downloadState){case 6:t=e.openAppLabel;break;case 5:t=e.installAppLabel;break;default:t=e.adActionDescription}}}catch(e){}return t}getAdIcon(){return N(this.callerContext.adInfo)}getDescribeTextColor(t){return this.halfPlayerInfo.describeTextColor?this.halfPlayerInfo.describeTextColor:t?"#222222":"#666666"}getButtonTextColor(){return this.halfPlayerInfo.buttonTextColor?this.halfPlayerInfo.buttonTextColor:"#FFFFFF"}getTextColor(){return this.halfPlayerInfo.describeTextColor?this.halfPlayerInfo.describeTextColor:"#FE3666"}getBackgroundColor(){return this.halfPlayerInfo.labelBackgroundColor?this.halfPlayerInfo.labelBackgroundColor:"#FFEBF0"}reportCardImpression(){let t=new S;t.template_show_type=Qa;let e={elementType:19,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}reportLandingPageImpression(t){if(!this.webviewDidLoad||!this.landingPageDidShow)return;let e=new S;e.template_show_type=Qa,e.change_duration=t;let i={elementType:215,clientExtData:JSON.stringify(e)},n={actionType:140,payload:JSON.stringify(i)};Ne.sendLog(n)}clickConvert(t,e,i){let n=0,s=0;be(i)||(n=i.position.rawX,s=i.position.rawY);let a=new S;a.template_show_type=Qa,pi.convertIfNeeded(1,this.callerContext.adInfo,t,{x:n,y:s},e,a)}reportHalfplayerShowEvent(t){try{Ze({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:1,suffixRatio:"",event_id:"ad_sdk_neo_halfplayer_monitor",primaryKey:"status",type:"OTHER",msg:{error:t}})}catch(t){}}reportHalfplayerWebviewShowEvent(){try{Ze({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:1,suffixRatio:"",event_id:"ad_sdk_neo_halfplayer_webview_monitor",primaryKey:"status",type:"OTHER",msg:{creative_id:this.callerContext.adInfo.adBaseInfo.creativeId}})}catch(t){}}supportSlideClick(){var t;return(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}}const eo="solid_hand";class io extends fn{constructor(t){super(),this.lifeStatus="none",this.positionLeft=0,this.positionBottom=0,this.isPaused=!1,this.isShowEnd=!1,this.downloadState=0,this.conflictStyleTime=0,this.callerContext=t,this.gestureInfo=function(t){try{return t.adMatrixInfo.adDataV2.gestureInfo}catch(e){}}(this.callerContext.adInfo),this.setupTimerPlayer(),_i(this.$attrsPath.callerContext.lifeStatus,(t=>{this.lifeStatus=t}))}setupTimerPlayer(){this.timerPlayer=new hn(this.getInteractGestureShowTimeMS()),this.timerPlayer.onFinishCallback=()=>{this.isShowEnd=!0}}timerPaused(){this.timerPlayer.paused()}timerResume(){this.timerPlayer.resume()}timerPlay(){this.timerPlayer.play()}hasInteractGesture(){if(!Pe.supportMinimumTKVersion("5.0.0"))return!1;try{if(!be(this.gestureInfo))return!0}catch(t){}return!1}getInteractGestureStyle(){try{if(this.gestureInfo)return this.gestureInfo.gestureStyle}catch(t){}return 1}getInteractGestureStartTimeMS(){try{return Math.max(this.gestureInfo.gestureShowStartTime,this.conflictStyleTime)}catch(t){return Math.max(this.conflictStyleTime,5e3)}}getInteractGestureShowTimeMS(){try{return this.gestureInfo.gestureShowContinueTime}catch(t){return 5e3}}getGestureActionDescription(){try{return this.gestureInfo.gestureActionDescription}catch(t){}return""}reportInteractGestureImpression(){let t=new S;t.template_show_type=eo,t.universe_feature_freq=19;let e={clientExtData:JSON.stringify(t)};pi.exposeElement(190,e)}convert(e){let i=new S;i.template_show_type=eo,pi.convertIfNeeded(1,this.callerContext.adInfo,4,e,t.CARD_SWIPE_CONVERT,i)}handleSlideConvert(e,i,n){let s=new S;s.template_show_type=eo;let a={fingerSwipeType:n};pi.convertIfNeeded(1,this.callerContext.adInfo,4,{x:e,y:i},t.CARD_SWIPE_CONVERT,s,a)}}class no extends fn{constructor(t,e,i,n){super(),this.renderSuccess=!1,this.isCanConvert=!1,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.screenOrientation=n}getValidClickConvertTime(){try{return this.configInfo.appConfig.validClickConvertTime}catch(t){}return 1e3}getPlayableDeeplinkLimitedTimeMs(){try{return this.adInfo.adConversionInfo.playableDeeplinkLimitedTimeMs}catch(t){}return 0}}class so extends fn{constructor(t,e,i,n){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.screenOrientation=n,this.setupData()}setupData(){this.playableVM=new no(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation)}getPlayableUrl(){try{const t=this.adInfo.adConversionInfo.playableUrl;if(Ie(t))return t}catch(t){}return""}}class ao extends fn{constructor(t,e){super(),this.playableFrontTime=0,this.hasShowPlayableFrontView=!1,this.hasTriggerJump=!1,this.currentPlaybackTime=0,this.autoJumpTime=3,this.renderSuccess=!1,this.adInfo=t,this.configInfo=e,this.setupData()}setupData(){this.playableFrontType=0;try{this.configInfo.appConfig.interactionTimeInRewardedVideo>0&&this.configInfo.appConfig.interactionTimeInRewardedVideo<1&&(this.configInfo.abConfig.autoJumpInRewardedVideo?this.playableFrontType=1:this.playableFrontType=2,this.playableFrontTime=Y(this.adInfo)*this.configInfo.appConfig.interactionTimeInRewardedVideo)}catch(t){}}reportPlaybleFrontAciton(t,e){const i={elementType:192,playedDuration:e};pi.log(t,null,i)}showPlayable(t){this.reportPlaybleFrontAciton(141,this.currentPlaybackTime),this.hasTriggerJump=!0,Ne.showPlayable(t)}}var oo;!function(t){t[t.NONE=0]="NONE",t[t.BRIDGE_HANDLER=1]="BRIDGE_HANDLER",t[t.SENSOR_COMPONENT=2]="SENSOR_COMPONENT"}(oo||(oo={}));class ro{static checkShakeRegisterType(t,e){let i=oo.NONE;return t==$a.FULLSCREEN?i=Pe.supportMinimumTKVersion("5.0.9")?oo.SENSOR_COMPONENT:oo.BRIDGE_HANDLER:t==$a.NEO||t==$a.LIVE_NEO||t==$a.IMAGE_NEO?i=oo.SENSOR_COMPONENT:t!=$a.LIVE_FULLSCREEN&&t!=$a.IMAGE_FULLSCREEN||(i=e?Pe.supportMinimumTKVersion("5.0.0")?oo.SENSOR_COMPONENT:oo.NONE:Pe.supportMinimumTKVersion("4.0.9")?oo.SENSOR_COMPONENT:oo.NONE),i}static registerBridgeShake(t){try{Ne.registerShakeListener(t)}catch(e){}}static supportSensor(t){let e=!1;try{e=KSAdSensorManager.supportSensor(t)}catch(i){}return e}static registerSensorListener(t,e,i){try{KSAdSensorManager.registerSensorListener(t,e,i)}catch(n){}}static unregisterSensorListener(t){try{KSAdSensorManager.unregisterSensorListener(t)}catch(e){}}}const ho="neo_rotate_style1",lo="neo_rotate_style2",co="neo_rotate_style3",po="neo_rotate_style4",mo="neo_rotate_style5";class go extends fn{constructor(t,e,i){super(),this.isRotateInitialized=!1,this.isShakeInitialized=!1,this.isStartSensor=!0,this.isListeningRotate=!1,this.canRotateConvert=!0,this.downloadState=0,this.downloadProgressTest="下载中",this.isListeningSeneor=!1,this.mVideoTKScene=$a.NEO,this.slotId=-1,this.componentData=void 0,this.mVideoTKScene=e,this.callerContext=t,i&&(this.slotId=i),this.initializeRotateHandler(),this.enableShakeConvert()&&this.initializeShakeHandler()}enableShowRotate(){if(!this.isRotateInitialized||!Pe.supportMinimumTKVersion("5.0.0"))return!1;try{if(1==this.interactionInfo.interactiveStyle)return!0}catch(t){}return!1}initializeRotateHandler(){if(!this.isRotateInitialized)try{if(k(this.callerContext.adInfo)){let t;t=R(this.callerContext.adInfo,"reward-rotate",this.slotId),t&&(this.interactionInfo=B(t),this.componentData=t),null==t&&(t=R(this.callerContext.adInfo,"reward-end-shake",this.slotId),this.interactionInfo=B(t),this.componentData=t)}else 2==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.neoVideoInfo.interactionInfo),3==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo);this.interactionInfo&&(this.uiStyle=this.interactionInfo.rotateInfo.uiStyle,this.rotateHandler=new Ys(this.interactionInfo.rotateInfo),this.isRotateInitialized=!0)}catch(t){}}startRotateListener(){if(!this.isListeningRotate)if(this.isListeningRotate=!0,this.isListeningSeneor=!0,this.rotateHandler.beforeMonitor(),"undefined"!=typeof KSAdSensorManager&&KSAdSensorManager.supportSensor(2))ro.registerSensorListener(2,-3,(t=>{this.canSplashConvertRotate(t)}));else{if(this.rotateHandler.bidirectionalSwitch)return;let e=this.interactionInfo.rotateInfo;(null==e?void 0:e.useImitateRotate)&&(this.sensorImitateRotateUtil=new Zs(e),this.sensorImitateRotateUtil.registerImitateRotateSensorListener((e=>{try{if(!be(e)&&this.isListeningSeneor&&this.canRotateConvert&&2!=this.downloadState){this.canRotateConvert=!1;let i={splashInteractionRotateAngle:e},n=new S;if(this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:n.template_show_type=co;break;case 2:n.template_show_type=po}else if(2===this.uiStyle)n.template_show_type=lo;else n.template_show_type=ho;n.reward_interactive_style_type=this.getInteractiveStyleType(),pi.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,n,i),KSAdSystemUtil.startVibrate(100),this.stopRotateListener(),this.stopShakeListener()}}catch(i){}}),(t=>{this.rotateInfoCallback&&t&&t.length>2&&this.rotateInfoCallback(t[0],t[1],t[2])})))}}stopRotateListener(){this.isListeningRotate&&(this.isListeningRotate=!1,this.isListeningSeneor=!1,this.isShowConvertState=!1,this.sensorImitateRotateUtil?this.sensorImitateRotateUtil.unRegisterImitateRotateSensorListener():ro.unregisterSensorListener(2))}canSplashConvertRotate(e){try{if(this.rotateInfoCallback&&this.rotateInfoCallback(this.rotateHandler.xDegree,this.rotateHandler.yDegree,this.rotateHandler.zDegree),this.isListeningSeneor&&!be(e)&&!be(e.values)&&this.rotateHandler&&this.canRotateConvert&&this.rotateHandler.canConvertRotate(e)&&2!=this.downloadState){this.canRotateConvert=!1;let e={splashInteractionRotateAngle:this.rotateHandler.maxRotateContent()},i=new S;if(this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:i.template_show_type=co;break;case 2:i.template_show_type=po}else if(2===this.uiStyle)i.template_show_type=lo;else i.template_show_type=ho;i.reward_interactive_style_type=this.getInteractiveStyleType(),k(this.callerContext.adInfo)&&this.componentData&&(i.component_module=E(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),pi.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,i,e),KSAdSystemUtil.startVibrate(100),this.stopRotateListener(),this.stopShakeListener()}}catch(i){}}isSlideClick(){var t;return!!(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}convert(t,e,i,n){if(be(n)&&(n=new S),this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:n.template_show_type=co;break;case 2:n.template_show_type=po;break;case 0:n.template_show_type=mo}else if(2===this.uiStyle)n.template_show_type=lo;else n.template_show_type=ho;k(this.callerContext.adInfo)&&this.componentData&&(n.component_module=E(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),n.reward_interactive_style_type=this.getInteractiveStyleType(),pi.convertIfNeeded(0,this.callerContext.adInfo,t,e,i,n)}elementImpression(){let t=184,e=lo,i=new S;if(this.isShowRotateAndShakeView())switch(t=227,this.rotateShakeUiStyle){case 1:e=co;break;case 2:e=po;break;case 0:e=mo}else if(2===this.uiStyle)e=lo;else e=ho;let n={elementType:t};k(this.callerContext.adInfo)&&this.componentData&&(i.universe_feature_freq=this.componentData.componentId,i.component_module=E(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),i.template_show_type=e,i.reward_interactive_style_type=this.getInteractiveStyleType(),n.clientExtData=JSON.stringify(i),pi.log(140,{x:0,y:0},n)}getRotateSubtitle(){var t;let e="";try{if(console.log("tkloadcontroller isdownload:"+X(this.callerContext.adInfo)),X(this.callerContext.adInfo)){let i=null===(t=this.interactionInfo.rotateInfo)||void 0===t?void 0:t.downloadTexts;switch(this.isShowRotateAndShakeView()&&(i=this.interactionInfo.componentInfo.downloadTexts),this.downloadState){case 6:e=i.openAppLabel;break;case 5:e=i.installAppLabel;break;default:e=i.adActionDescription}}else e=this.isShowRotateAndShakeView()?this.interactionInfo.componentInfo.subTitle:this.interactionInfo.rotateInfo.subTitle}catch(i){}return Ie(e)?"或点击"+e:"或点击立即获取"}initializeShakeHandler(){this.isShakeInitialized||(this.shakeHandler=new Js(this.interactionInfo),this.isShakeInitialized=!0)}startShakeListener(){this.isListeningShake||(this.isListeningShake=!0,this.isListeningSeneor=!0,this.shakeHandler.beforeMonitor(),ro.registerSensorListener(1,-3,(t=>{this.canConvertShake(t)&&(this.convertShake(),this.canRotateConvert=!1,KSAdSystemUtil.startVibrate(200),this.stopShakeListener(),this.stopRotateListener())})))}enableShakeConvert(){try{let t=this.interactionInfo.shakeInfo;return!be(t)&&t.enable}catch(t){}return!1}enableRotateConvert(){if(!Pe.supportMinimumTKVersion("5.0.0"))return!1;try{let t=this.interactionInfo.rotateInfo;return!be(t)&&t.enable}catch(t){}return!1}startSensorListener(){this.enableShakeConvert()&&(Pe.supportMinimumTKVersion("5.0.0")?this.startShakeListener():ro.checkShakeRegisterType(this.mVideoTKScene,!0)==oo.BRIDGE_HANDLER&&ro.registerBridgeShake((t=>{}))),this.enableRotateConvert()&&this.startRotateListener()}stopSensorListener(){this.enableShakeConvert()&&this.stopShakeListener(),this.enableRotateConvert()&&this.stopRotateListener()}stopShakeListener(){this.isListeningShake&&(this.isListeningShake=!1,this.isListeningSeneor=!1,this.isShowConvertState=!1,ro.unregisterSensorListener(1),this.shakeHandler.resetValues())}canConvertShake(t){try{if(this.canRotateConvert&&this.isListeningSeneor&&this.shakeHandler&&this.shakeHandler.canConvertShake(t)&&2!=this.downloadState)return!0}catch(e){}return!1}convertShake(){let e=new S;if(this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:e.template_show_type=co;break;case 2:e.template_show_type=po;break;case 0:e.template_show_type=mo}e.reward_interactive_style_type=this.getInteractiveStyleType(),k(this.callerContext.adInfo)&&this.componentData&&(e.component_module=E(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),pi.convertIfNeeded(0,this.callerContext.adInfo,1,{x:0,y:0},t.SHAKE_ICON_SHACK,e,{splash_shake_acceleration:this.shakeHandler.maxAcceleration})}getBtnPosition(){var t;try{if(this.interactionInfo)return null===(t=this.interactionInfo)||void 0===t?void 0:t.componentInfo.btnPosition}catch(e){return 0}}getBtnStyle(){var t;try{if(this.interactionInfo)return null===(t=this.interactionInfo)||void 0===t?void 0:t.componentInfo.btnStyle}catch(e){return 0}}isShowRotateAndShakeView(){if(!this.isRotateInitialized||!Pe.supportMinimumTKVersion("5.0.0"))return!1;try{if(!k(this.callerContext.adInfo))return Zt(this.callerContext.adInfo,this.callerContext.adStyle);if(7==this.interactionInfo.interactiveStyle)return!0}catch(t){}return!1}getInteractiveStyleType(){try{return this.callerContext.configInfo.abConfig.rewardInteractiveStyleType}catch(t){return 0}}isOriginRotateStyle(){return!this.isShowRotateAndShakeView()&&2!=this.uiStyle}clickLog(e,i){this.isShowRotateAndShakeView()?this.convert(1,Te(e,i),t.ROTATE_SHAKE_BIG_ICON_CLICK):this.convert(1,Te(e,i),t.ROTATE_BIG_ICON_CLICK)}}class uo extends fn{constructor(t,e,i,n,s,a){super(),this.isShow=!1,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a}getTemplateInfo(){try{const t=xt(this.getTemplateId(),this.adInfo);return JSON.stringify(t)}catch(t){}return""}getTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.rewardWebTaskCloseInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}}class wo extends fn{constructor(){super(...arguments),this.isNeedCheck=!1,this.topbarModelType=0,this.needShowPlayEndCloseBtn=0,this.hasCallbackGift=!1,this.isMuted=!1,this.playFailed=!1,this.playFinished=!1,this.currentPlaybackTime=0,this.hasGetDeepGift=!1,this.hasInstallTargetApp=!1,this.hasShowPlayend=!1,this.giveRewardTime=0,this.impressionCheckResult=!0,this.isNeedSeverCheck=!1,this.severCheckState=0}checkDataValid(){return!!this.adInfo}getVideoDuration(){return Y(this.adInfo)}isDownloadAd(){return 1==this.adInfo.adBaseInfo.adOperationType}isShowPrivacy(){return pt(this.adInfo)}isDeepRewardTask(){return 2==this.adInfo.adBaseInfo.taskType||3==this.adInfo.adBaseInfo.taskType}isCloseBtnHide(){try{let t=this.adInfo.adMatrixInfo.tag;if(t)for(let e=0;e<t.length;e++){let i=t[e];if("playEndClose"==i.type&&i.isHide)return!0}}catch(t){}return!1}isRewardVideo(){return 2==this.adStyle||12==this.adStyle}isSkipToCloseAd(){try{return this.isRewardVideo()?this.adInfo.adRewardInfo.rewardVideoEndCardSwitch:this.adInfo.fullScreenVideoInfo.fullScreenEndCardSwitch}catch(t){return!1}}getRewardTime(){return gt(this.adInfo)}isShowSkipRightNow(){return this.isRewardVideo()?Math.min(this.getSkipShowTime(),this.getRewardTime())<=0:this.getSkipShowTime()<=0}getSkipConfirmSwitch(){let t=!0;try{t=null==this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch||this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch}catch(e){}return t}getSkipShowTime(){let t=null;try{if(this.isRewardVideo())try{t=this.adInfo.adRewardInfo.skipShowTime,t<0&&(t=this.getVideoDuration())}catch(e){t=this.configInfo.appConfig.rewardSkipShowTime}else t=this.adInfo.adStyleConfInfo.fullScreenSkipShowTime}catch(e){}return null!=t&&null!=t||(t=5),Math.min(this.getVideoDuration(),t)}getSkipTips(){let t=null;try{t=this.isRewardVideo()?this.configInfo.appConfig.rewardSkipTips:this.configInfo.appConfig.fullscreenSkipTips}catch(e){}return t&&0!=t.length?t:null}getSkipType(){let t=0;try{t=this.isRewardVideo()?this.configInfo.appConfig.rewardSkipType:this.configInfo.appConfig.fullscreenSkipType}catch(e){3==this.adStyle&&(t=1)}return t}getPlayDetailCallDescription(){let t=null;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailTopToolBarInfo.callButtonDescription}catch(e){}return Ie(t)||(t="立即获取"),t}getPlayEndCallDescription(){let t=null;try{this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription.length>0&&(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription)}catch(e){console.log("no adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription returned")}return t}getPlayDetailCallBtnShowTime(){let t=0;try{t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playDetailInfo.detailTopToolBarInfo.callButtonShowTime}catch(e){console.log("no adMatrixInfo.adDataV2.dynamicAdStyleInfo.playDetailInfo.detailTopToolBarInfo.callButtonShowTime returned")}return t}getCloseDelaySeconds(){let t=0;try{t=this.adInfo.adStyleConfInfo.closeDelaySeconds}catch(e){}return t}isDelayShowEndClose(){return this.getCloseDelaySeconds()>0}getTopbarStyle(){if(3!=this.adStyle&&1!=this.adInfo.adBaseInfo.taskType&&4!=this.adInfo.adBaseInfo.taskType&&0!=this.adInfo.adBaseInfo.taskType)return 1;let t=-1;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailTopToolBarInfo.style}catch(e){}return!Pe.supportMinimumVersion("3.3.22","3.3.29")&&t>9?0:t}getResourceRoot(){return"image/ksad-video-top-bar/"}handleOpenURL(t,e){Ne.openURL(t,e)}handleOpenFeedback(){if(this.hasShowFeedback)return void We("您已经提交过反馈了哦~");this.hasShowFeedback=!0,Ne.showTKDialog("ksad-feed-back-card");let t={actionType:141,payload:JSON.stringify({elementType:194,buttonType:4})};Ne.sendLog(t)}handleCallImpressionOnFinish(){}handleCallImpressionOnPlay(){}handleCallClick(t,e){}handleGiftClick(t){}convertForOtherArea(t,e,i,n){}handleSkip(t,e,i){}handleClose(){Ne.closeVideo(!1)}handleMuteChange(t){}handleHasGift(){this.hasCallbackGift||(this.hasCallbackGift=!0,Ne.hasReward(this.severCheckState))}handlePlayEnd(t){Ne.showPlayEnd(t),this.hasShowPlayend=!0}getTaskType(){var t;return null===(t=this.rewardTaskInfo)||void 0===t?void 0:t.taskType}isCovertTask(){return 1==this.getTaskType()}isSlideClick(){var t;return!!(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}getRealAdStyle(){let t=Tachikoma.env.adStyle;return t||(t=this.adStyle),t}}class Co extends wo{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.isNeedCheck=!0,this.additionalInit()}additionalInit(){Pe.supportMinimumTKVersion("4.0.4")||(this.needShowPlayEndCloseBtn=1)}handleClose(){this.handleCloseCallback&&this.handleCloseCallback()}handleSkip(t,e,i){let n=new b;n.closeButtonImpressionTime=i,n.closeButtonClickTime=this.currentPlaybackTime,n.clientTimestamp=ue();let s={elementType:69,extParams:JSON.stringify(n)},a={actionType:141,payload:JSON.stringify(s)};Ne.sendLog(a),this.handleSkipCallback&&this.handleSkipCallback(t,e,i)}handleGiftClick(e){pi.convertIfNeeded(0,this.adInfo,2,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK)}handleCallClick(e,i){pi.convertIfNeeded(0,this.adInfo,1,{x:i.position.rawX,y:i.position.rawY},e?t.PLAY_END_CALL_CLICK:t.PLAY_DETAIL_CALL_CLICK)}handleCallImpressionOnFinish(){pi.exposeElement(17)}handleCallImpressionOnPlay(){pi.exposeElement(18)}handlePlayEnd(t){this.hasShowPlayend=!0}handleMuteChange(t){this.isMuted=t}obtainNeoInteractTime(){this.giveRewardTime=_t(this.adInfo)}convertForOtherArea(t,e,i,n){let s=new S;s.material_click_area="neo_top",pi.convertIfNeeded(1,this.adInfo,e,i,n,s)}}class fo extends fn{constructor(t,e,i,n,s,a,o){super(),this.hasNeo=!1,this.pageLoaded=!1,this.pageLoadedFailed=!1,this.isSlideUp=!1,this.lifeStatus="none",this.slotId=-1,this.componentData=void 0,this.configInfo=n,this.containerLimit=s,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a,o&&(this.slotId=o);const r={width:this.containerLimit.width-2*this.getSideMargin(),height:this.containerLimit.height-this.getTopMargin()};if(k(this.adInfo)&&-1!=this.slotId){let t=R(this.adInfo,"pre-landing-page-card",this.slotId);t&&(this.componentData=t)}this.topBarVM=new Co(this.adInfo,this.adStyle,this.configInfo,r,this.screenOrientation),this.confirmVM=new uo(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,r,this.screenOrientation)}reportPreFormImpression(){let t=new S;if(k(this.adInfo)&&this.componentData){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.endCardInfo.pageId,combination_id:e.endCardInfo.combinationIds,component_id:this.componentData.componentId};t.universe_feature_freq=this.componentData.componentId,t.component_module=JSON.stringify(i),$e("component_ui_show","end_card",String(e.endCardInfo.pageId),"pre-landing-page-card")}else t.universe_feature_freq=5;let e={elementType:204,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}getSideMargin(){return Ce()&&1==this.screenOrientation?48:0}getTopMargin(){return 0==this.screenOrientation&&Ce()?48:20}getPlayEndBgUrl(){return j(z(this.adInfo))}getLandingPageUrl(t){try{Ne.getLandingPageInfo((e=>{let i=e.data;const n=i?i.landingPageUrl:void 0;Ie(n)?t(n):t(this.adInfo.adConversionInfo.h5Url)}))}catch(e){t(this.adInfo.adConversionInfo.h5Url)}}getTopBarTitle(){return J(this.adInfo)}getPlayEndTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.endCardInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}isAppAdvance(){return function(t){var e,i;try{return(null===(i=null===(e=t.adConversionInfo)||void 0===e?void 0:e.deeplinkUrl)||void 0===i?void 0:i.length)>0}catch(n){}return!1}(this.adInfo)}handleAdClick(t,e){if(this.isAppAdvance()){let i=new S;if(k(this.adInfo)&&this.componentData){const t=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let e={page_id:t.endCardInfo.pageId,combination_id:t.endCardInfo.combinationIds,component_id:this.componentData.componentId};i.component_module=JSON.stringify(e),$e("component_ui_click","end_card",String(t.endCardInfo.pageId),"pre-landing-page-card")}let n=0,s=0;be(e)||(n=e.position.rawX,s=e.position.rawY),pi.convertIfNeeded(2,this.adInfo,2,{x:n,y:s},t,i)}else if(!this.isSlideUp){if(this.isSlideUp=!0,k(this.adInfo)&&this.componentData){let e=new S;const i=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let n={page_id:i.endCardInfo.pageId,combination_id:i.endCardInfo.combinationIds,component_id:this.componentData.componentId};e.component_module=JSON.stringify(n),pi.reportClick(this.adInfo,null,{itemClickType:t,renderContainer:1},e),$e("component_ui_click","end_card",String(i.endCardInfo.pageId),"pre-landing-page-card")}else pi.reportClick(this.adInfo,null,{itemClickType:t,renderContainer:1});let e={creativeId:this.adInfo.adBaseInfo.creativeId+"",targetMethod:"adClickCallback",methodParams:"{}"};Ne.adOutCallback(e)}}needShowConfimDialog(){var t,e;return 1==(null===(e=null===(t=this.configInfo)||void 0===t?void 0:t.appConfig)||void 0===e?void 0:e.adLeaveConfirmSwitch)}}class yo extends fn{constructor(t,e,i){super(),this.downloadState=0,this.focusChangeEvent="windowFocusGet",this.lifeStatus="none",this.canShowAggregation=!1,this.callerContext=t,this.adOriginInfo=e,this.webViewVM=new qa(this.callerContext.adInfo,this.adOriginInfo,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit,this.callerContext.screenOrientation),this.rotateVM=new go(this.callerContext,i,10),this.aggregationCardVM=new Kn(this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit,this.callerContext.screenOrientation),this.preFormViewModel=new fo(this.callerContext.adInfo,this.adOriginInfo,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit,this.callerContext.screenOrientation,9)}convert(t,e,i){pi.convertIfNeeded(2,this.callerContext.adInfo,t,e,i)}closeAd(){Ne.close()}playAgainClick(){ri().emit(l,{})}getAppScore(){return this.callerContext.adInfo.adBaseInfo.appScore||0}getAppDownloadCountDesc(){return this.callerContext.adInfo.adBaseInfo.appDownloadCountDesc||null}getVideoFirstFrame(){return j(z(this.callerContext.adInfo))}getAdDescription(){return this.callerContext.adInfo.adBaseInfo.appDescription||this.callerContext.adInfo.adBaseInfo.adDescription||null}getAdActionDesc(){return this.callerContext.adInfo.adBaseInfo.adActionDescription||""}supportSlideClick(){var t;return(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}getWebCardEndH5Url(){return St(this.getTemplateId(),this.callerContext.adInfo)}getTemplateId(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.endCardInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}getPlayAgainEndH5Url(){return St(this.getPlayAgainTemplateId(),this.callerContext.adInfo)}getPlayAgainTemplateId(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.rewardWatchOnceInfo.templateId}catch(t){console.log("TK rewardWatchOnceInfo templateId error")}return""}isShowRotatrAndShakeView(){try{if(!k(this.callerContext.adInfo))return Zt(this.callerContext.adInfo,this.callerContext.adStyle);if(7==this.rotateVM.interactionInfo.interactiveStyle)return!0}catch(t){}return!1}canShowPreLandingPage(){if(2!=this.callerContext.adStyle)return!1;try{if(k(this.callerContext.adInfo)){if(R(this.callerContext.adInfo,"pre-landing-page-card",9))return!0}}catch(t){}return!1}}class To extends fn{constructor(t,e,i){super(),this.lastReportTime=0,this.lifeStatus="none",this.currentPlaybackTime=0,this.playStatus=0,this.playFailed=!1,this.playFinished=!1,this.playStarted=!1,this.isMuted=!1,this.showingDialog=new Set,this.hadDowngrade=!1,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.videoPlayReportSeconds=Ct(this.adInfo)}onDialogShow(t){be(t)||this.showingDialog.add(t)}onDialogDismiss(t){be(t)||this.showingDialog.has(t)&&this.showingDialog.delete(t)}isDialogShowing(){return this.showingDialog.size>0}onDowngrade(){this.hadDowngrade=!0,re(this.obtainRealRenderResult())}getVideoURL(){return U(this.adInfo)}getVideoSize(){return G(this.adInfo)}getVideoDuration(){return Y(this.adInfo)}getVideoFirstFrame(){return j(this.adInfo.adMaterialInfo.materialFeature[0])}isSlideEnable(){var t,e;return!!(null===(e=null===(t=this.adInfo)||void 0===t?void 0:t.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===e?void 0:e.slideClick)}getActionBarStyle(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType}catch(t){}return 0}updateVideoProgress(t,e,i){this.currentPlaybackTime=t;const n=Math.floor(t);if(n!=this.lastReportTime)for(var s=0;s<this.videoPlayReportSeconds.length;s++)if(n==this.videoPlayReportSeconds[s]){this.lastReportTime=this.videoPlayReportSeconds[s];let t=this.obtainClientExtData(null);pi.playNSecond(this.lastReportTime,t);break}}videoPlayFailed(t,e){this.playFailed=!0,pi.updateVideoPlayStatus("failed",t,e)}videoPlayFinished(){this.playFinished||(this.playFinished=!0,Ut(this.adInfo,this.configInfo)&&Ne.callNativeWithCallback("showActivityMiddlePage"),pi.log(400,null,null),pi.updateVideoPlayStatus("end"))}videoPlayStart(){if(this.playStarted)return;this.playStarted=!0;let t=this.obtainClientExtData(null);pi.playStart(t),pi.updateVideoPlayStatus("start")}convert(t,e,i,n){pi.convertIfNeeded(0,this.adInfo,t,e,i,n)}obtainClientExtData(t){let e=t;return null==e&&(e=new S),di.appendNeoExtData(e,this.adInfo,this.configInfo.abConfig,(t=>{t.realRenderResult=this.obtainRealRenderResult()})),e}obtainRealRenderResult(){return this.hadDowngrade?la.IMAGE:la.VIDEO}}class Io extends Object{constructor(t){super(),this.totalBlockDuration=0,this.totalBlockTimes=0,this.maxAllowedBlockDuration=5e3,this.schedulingTimeout=!1,this.currentStatus=0,this.blockCallback=t}updatePlayerStatus(t){this.currentStatus=t,2==t||6==t||3==t||1==t?this.startScheduleTimeout():this.cancelScheduleTimeout()}updateCurrentPlaybackTime(t){(2==this.currentStatus||6==this.currentStatus||3==this.currentStatus||1==this.currentStatus)&&(this.cancelScheduleTimeout(),this.startScheduleTimeout())}startScheduleTimeout(){this.schedulingTimeout||(this.schedulingTimeout=!0,this.blockTimer=setTimeout((()=>{this.handleBlockTimeout()}),this.maxAllowedBlockDuration),this.lastBlockTime=ue())}cancelScheduleTimeout(){if(this.schedulingTimeout&&(this.schedulingTimeout=!1,this.clearBlockTimer(),this.lastBlockTime)){const t=ue()-this.lastBlockTime;t>1e3&&(this.totalBlockDuration+=t,this.totalBlockTimes+=1)}}clearBlockTimer(){this.blockTimer&&clearTimeout(this.blockTimer)}handleBlockTimeout(){this.blockCallback&&this.blockCallback()}}class vo extends fn{constructor(t,e,i,n,s){super(),this.topNavHeight=58,this.lifeStatus="none",this.pushCardIsShow=!1,this.isPaused=!1,this.isShowEnd=!1,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.pushCardInfo=this.getPushCardInfo(),this.setupTimerPlayer()}setupTimerPlayer(){this.timerPlayer=new hn(this.pushCardStayDuration()),this.timerPlayer.onFinishCallback=()=>{this.isShowEnd=!0}}timerPaused(){this.timerPlayer.paused()}timerResume(){this.timerPlayer.resume()}timerPlay(){this.timerPlayer.play()}getTopMargin(){let t=0;return t=0==this.screenOrientation?Ce()?48+this.topNavHeight:20+this.topNavHeight:36,t}getAdIcon(){return N(this.adInfo)}getAdTitle(){return J(this.adInfo)}getAdDescription(){return this.adInfo.adBaseInfo.appDescription||this.adInfo.adBaseInfo.adDescription||null}getAdActionDesc(){return Vt(this.adInfo)}getPushCardInfo(){return function(t,e){let i=ot(t,3==e?3:12),n=null;try{n=JSON.parse(i.data).pushCardInfo}catch(s){}return n}(this.adInfo,this.adStyle)}canPushCard(){return!this.pushCardIsShow&&!be(this.pushCardInfo)}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}pushCardDelayTime(){let t=3e3;!be(this.pushCardInfo)&&this.pushCardInfo.delayTime>0&&(t=this.pushCardInfo.delayTime);const e=Ft(this.adInfo,this.adStyle);return be(e)||(t+=1e3*e.delayTime+(k(this.adInfo)?e.showTime:1e3*e.showTime)),t}pushCardStayDuration(){let t=1e4;return!be(this.pushCardInfo)&&this.pushCardInfo.showDuration>0&&(t=this.pushCardInfo.showDuration),t}convert(t,e,i,n){pi.convertIfNeeded(1,this.adInfo,t,e,i,n)}reportPlayEndImpression(){let t=new S;t.template_show_type="push_card",t.universe_feature_freq=18;let e={elementType:191,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}}class Vo extends fn{checkDataValid(){return!!this.adInfo}getActionBtnContent(){let t="";try{t=this.configInfo.appConfig.rewardContentExtraRewardNotClickedDesc}catch(e){}return be(t)&&(t="立即点击，可再得1份奖励"),t}getClosedelayTime(){let t=3e3;try{t=1e3*this.adInfo.adStyleConfInfo.extraClickPopupShowSecond}catch(e){}return be(t)&&(t=3e3),t}closePage(){}autoClose(){}convert(t,e,i){}}class Ao extends Vo{constructor(t,e,i,n,s,a){super(),this.isShow=!1,this.hasClickBefore=!1,this.hasExtraGiven=!1,this.needShowBigCard=!1,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a}getTemplateInfo(){try{const t=xt(this.getTemplateId(),this.adInfo);return JSON.stringify(t)}catch(t){}return""}getTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.activityTKInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}}class bo extends fn{constructor(t,e,i,n=1,s){if(super(),this.paramValid=!1,this.animMinTime=50,this.dismissCallbackCompleted=!1,this.lastAnimedArray=[],this.slotId=-1,this.componentData=void 0,this.containerSize=t,this.adInfo=e,this.adStyle=i,this.animType=n,this.currentRandomParams=this.getRedPacketRandomParam(),this.initLastAnimedArray(),s&&(this.slotId=s),2==n)this.redPacketInfo=Ot(this.adInfo,this.adStyle);else if(k(this.adInfo)){let t=R(this.adInfo,"red-packet",this.slotId);t&&(this.redPacketInfo=B(t),this.componentData=t)}else this.redPacketInfo=Ft(this.adInfo,this.adStyle)}initLastAnimedArray(){this.lastAnimedArray=[5,2]}getAnimType(){return this.animType}getRowNum(){return 2==this.animType?5:3}getAnimMinTime(){return this.animMinTime}getOriginShowTime(){let t=6;return!be(this.redPacketInfo)&&!be(this.redPacketInfo.showTime)&&this.redPacketInfo.showTime>0&&(t=k(this.adInfo)?this.redPacketInfo.showTime/1e3:this.redPacketInfo.showTime),t}getScaleType(t,e){return this.currentRandomParams[e*this.getRowNum()+t].scaleType}dismissCallbackOnlyOnce(){this.dismissCallbackCompleted||(this.dismissCallbackCompleted=!0,this.dismissCallback&&this.dismissCallback())}enableShowRedPacketView(){return!be(this.redPacketInfo)}getRedPacketViewDelayShowTime(){return be(this.redPacketInfo)?1:k(this.adInfo)?this.redPacketInfo.delayTime/1e3:this.redPacketInfo.delayTime}isShowRedPacketViewRightNow(){return!be(this.redPacketInfo)&&0==this.redPacketInfo.delayTime}checkParam(){return!be(this.redPacketInfo)&&(!Se(this.redPacketInfo.iconUrls)&&(this.paramValid=!0,!0))}isParamValid(){return this.paramValid}getShowTime(t){let e=this.getOriginShowTime();return 2==this.animType||be(this.currentRandomParams[t].iconShowTime)||(e=this.currentRandomParams[t].iconShowTime*this.getTimeCoefficient()),e}getIconDelayTime(t){return Math.floor(this.currentRandomParams[t].delayTime*this.getTimeCoefficient())*this.animMinTime}getDelayTime(){let t=1;return be(this.redPacketInfo)||be(this.redPacketInfo.delayTime)||(t=this.redPacketInfo.delayTime),t}getTimeCoefficient(){return 2==this.animType?1:this.getOriginShowTime()/4*1.1}getRotateTimeCoefficient(){return this.getOriginShowTime()/6}getRotateAnimDelayTime(t){return 2==this.animType||be(this.currentRandomParams[t].rotateDelayTime)?-1:Math.floor(this.currentRandomParams[t].rotateDelayTime*this.getRotateTimeCoefficient())*this.getAnimMinTime()}isCanShowRotateAnim(t){return-1!=this.getRotateAnimDelayTime(t)}getLastAnimIconIndex(){return this.lastAnimedArray[this.currentRandomParamIndex]}getAnimedCount(){return 2==this.animType?15:9}isCanClick(){return this.redPacketInfo.clickSwitch}getRedPacketIconUrl(){let t=Math.floor(Math.random()*this.redPacketInfo.iconUrls.length);return this.redPacketInfo.iconUrls[t]}reportRedPacketImpression(){if(1!=this.animType)return;let t=new S;if(k(this.adInfo)&&this.componentData){t.universe_feature_freq=this.componentData.componentId;const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds,component_id:this.componentData.componentId};t.component_module=JSON.stringify(i)}else t.universe_feature_freq=1;let e={elementType:201,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}convert(t,e,i,n=null,s){if(k(this.adInfo)&&this.componentData){n||(n=new S);const t=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let e={page_id:t.playCardInfo.pageId,combination_id:t.playCardInfo.combinationIds,component_id:this.componentData.componentId};n.component_module=JSON.stringify(e)}pi.convertIfNeeded(0,this.adInfo,t,e,i,n,s)}getRedPacketRandomParam(){let t=[];return t=2==this.animType?[[{delayTime:0,scaleType:.85},{delayTime:4.5,scaleType:.7},{delayTime:8.25,scaleType:.7},{delayTime:13.5,scaleType:1},{delayTime:18,scaleType:.7},{delayTime:2.25,scaleType:.7},{delayTime:7.5,scaleType:1},{delayTime:11.25,scaleType:.85},{delayTime:16.5,scaleType:1},{delayTime:21,scaleType:.85},{delayTime:0,scaleType:.85},{delayTime:4.5,scaleType:.7},{delayTime:9,scaleType:.7},{delayTime:14.25,scaleType:.85},{delayTime:18.75,scaleType:.85}]]:[[{delayTime:5,scaleType:.7,iconShowTime:2},{delayTime:15,rotateDelayTime:10,scaleType:.85,iconShowTime:2},{delayTime:22,scaleType:1,iconShowTime:2},{delayTime:0,rotateDelayTime:16,scaleType:1,iconShowTime:2.3},{delayTime:8,scaleType:.85,iconShowTime:2.5},{delayTime:20,scaleType:.7,iconShowTime:2.5},{delayTime:3,scaleType:.7,iconShowTime:1.9},{delayTime:11,scaleType:.7,iconShowTime:1.9},{delayTime:22,rotateDelayTime:13,scaleType:.85,iconShowTime:1.95}],[{delayTime:0,rotateDelayTime:12,scaleType:1,iconShowTime:2.3},{delayTime:10,scaleType:.85,iconShowTime:2.3},{delayTime:20,rotateDelayTime:16,scaleType:1,iconShowTime:2.7},{delayTime:2,scaleType:.7,iconShowTime:2},{delayTime:12,scaleType:1,iconShowTime:2.3},{delayTime:22,scaleType:.7,iconShowTime:2.1},{delayTime:0,scaleType:.85,iconShowTime:1.8},{delayTime:6,rotateDelayTime:18,scaleType:.85,iconShowTime:2.4},{delayTime:21,scaleType:1,iconShowTime:2.4}]],this.currentRandomParamIndex=Math.floor(Math.random()*t.length),t[this.currentRandomParamIndex]}}class So extends fn{constructor(t,e,i,n){super(),this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.setupData(),this.setupViewModels()}setupData(){this.pendantInfo=function(t,e){let i=null,n=Ht(t,e);return n&&(i=Mt(t,n)),i}(this.adInfo,this.adStyle),this.pendantViewAnimInfo=Ot(this.adInfo,this.adStyle)}setupViewModels(){this.pendantAnimViewModel=new bo(this.containerLimit,this.adInfo,this.adStyle,2)}updateLifeStatus(t){this.lifeStatus=t}enableShowPendant(){return!be(this.getPendantInfo())&&!be(this.getPendantImageUrl())}getPendantInfo(){return this.pendantInfo}getPendantViewAnimInfo(){return this.pendantViewAnimInfo}getPendantTitleText(){try{return this.pendantInfo.guideMsg}catch(t){}return""}getPendantImageUrl(){try{return this.pendantInfo.icon}catch(t){}return""}enableShowGuidanceImage(){try{return 1==this.pendantInfo.gestureType}catch(t){}return!1}getPendantType(){try{return this.pendantInfo.type}catch(t){}return 0}getPendantSize(){return 13==this.adStyle?{width:140,height:140}:{width:184,height:170}}getPendantImageWH(){return 13==this.adStyle?105:150}getPendantTitleFontSize(){return 13==this.adStyle?12:16}getPendantTitleMarginLR(){return this.adStyle,8}getGuidanceImageWH(){return 13==this.adStyle?43:63}getGuidanceImageMarginTop(){return 13==this.adStyle?-this.getGuidanceImageWH()-10:-this.getGuidanceImageWH()-12}getGuidanceImageMarginLeft(){return 13==this.adStyle?this.getGuidanceImageWH()+34:this.getGuidanceImageWH()+42}enableClickPendant(){return wt(this.adInfo,1)}reportPendantImpression(){let t=new S;t.template_show_type=this.getPendantTemplateShowType(),t.universe_feature_freq=2;let e={elementType:13,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}reportPendantClick(e){let i=new S;i.template_show_type=this.getPendantTemplateShowType(),pi.convertIfNeeded(1,this.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK,i)}getPendantTemplateShowType(){return"pendant_active_red_packet"+this.getPendantType()}enableShowPendantClickAnim(){return!be(this.pendantViewAnimInfo)&&!be(this.pendantViewAnimInfo.iconUrls)&&this.pendantViewAnimInfo.iconUrls.length>0}getPendantClickAnimDuration(){return 1300}}class xo extends fn{constructor(t,e){super(),this.hasShown=!1,this.isShowEnd=!1,this.slotId=-1,this.componentData=void 0,this.callerContext=t,e&&(this.slotId=e);if(k(this.callerContext.adInfo)&&-1!=this.slotId){let t=R(this.callerContext.adInfo,"bubble-rain",this.slotId);t&&(this.bubbleRainInfo=B(t),this.componentData=t)}else this.bubbleRainInfo=function(t,e){let i,n=Ht(t,e);if(n){let e=ot(t,n);if(null==e)return;i=JSON.parse(e.data).bubbleRainInfo}return i}(this.callerContext.adInfo,this.callerContext.adStyle)}enableShowBubbleRainView(){return 1!=this.callerContext.screenOrientation&&!be(this.bubbleRainInfo)}enableCountDown(){return 2==this.callerContext.adStyle||3==this.callerContext.adStyle}isSplash(){return 4==this.callerContext.adStyle}getBubbleActionDes(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.bubbleActionDescription)&&void 0!==e?e:"立即开启大促"}getIndustryTopIcon(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.industryTopIcon)&&void 0!==e?e:""}getRedPacketUrl(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.redPacketUrl)&&void 0!==e?e:""}getSpecialRedPacketUrl(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.specialRedPacketUrl)&&void 0!==e?e:""}getRedPacketIndustryIcon(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.redPacketIndustryIcon)&&void 0!==e?e:""}getDelayTime(){var t;const e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.delayTime;return e>0?e:0}getShowTime(){var t;return null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.showTime}reportElementImpression(){let t=new S;if(k(this.callerContext.adInfo)&&this.componentData){t.universe_feature_freq=this.componentData.componentId;const e=this.callerContext.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds,component_id:this.componentData.componentId};t.component_module=JSON.stringify(i)}else t.universe_feature_freq=20;let e={elementType:238};e.clientExtData=JSON.stringify(t),pi.log(140,{x:0,y:0},e)}convert(t,e,i,n=null,s){k(this.callerContext.adInfo)&&this.componentData&&(n||(n=new S),n.component_module=E(this.callerContext.adInfo,this.componentData)),pi.convertIfNeeded(0,this.callerContext.adInfo,t,e,i,n,s)}}class Lo extends fn{constructor(t){super(),this.hasShown=!1,this.callerContext=t,this.setupData()}setupData(){this.giftBoxInfo=Nt(this.callerContext.adInfo,this.callerContext.adStyle)}isVertical(){return 0==this.callerContext.screenOrientation||be(this.callerContext.screenOrientation)}getGiftBoxInfo(){return this.giftBoxInfo}getGiftBoxIconUrls(){try{return this.giftBoxInfo.iconUrls}catch(t){}return[]}getGiftBoxDelayTime(){try{return this.giftBoxInfo.delayTime}catch(t){}return 1e3}getGiftBoxShowTime(){try{return this.giftBoxInfo.showTime}catch(t){}return 6e3}enableShowClickAnimation(){let t=!1;try{t=this.giftBoxInfo.showClickAnimation}catch(e){}return be(this.getClickAnimationLottieUrl())&&(t=!1),Pe.supportMinimumTKVersion("5.0.0")||(t=!1),t}getClickAnimationLottieUrl(){let t="";try{t=this.giftBoxInfo.clickAnimationLottieUrl}catch(e){}return be(t)&&(t=Pe.isAndroid()?"image/ksad-compose-image/GiftBox/ksad_lottie_gift_box_transition_android.json":"image/ksad-compose-image/GiftBox/ksad_lottie_gift_box_transition_ios.json"),t}getSingleBoxGuideText(){return"点击盒子，领取惊喜"}enableShowGiftBox(){const t=this.isVertical()&&!be(this.giftBoxInfo)&&!be(this.getGiftBoxIconUrls())&&this.getGiftBoxIconUrls().length>0;return console.log("giftbox enableshow"+t),t}showMultiBoxViewDirectly(){return!0}reportGiftBoxClick(){pi.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.SURPRISE_BOX_CLICK)}reportGiftBoxImpression(){let t=new S;t.universe_feature_freq=21;let e={elementType:237,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}}class _o extends fn{constructor(){super(...arguments),this.festivalPendantBottom=0,this.currentPlaybackTime=0,this.showRedPacketRain=!1,this.adHasConvert=!1,this.hasShowPlayend=!1}checkDataValid(){return!!this.callerContext.adInfo}setDatas(){this.enableShowRedPacketView()&&this.isShowRedPacketViewRightNow()&&this.updateShowRedPacketRain(0),ri().on(h,(t=>{this.adHasConvert=!0}))}createViewModels(){this.redPacketViewModel=new bo(this.callerContext.containerLimit,this.callerContext.adInfo,this.callerContext.adStyle,1,this.slotId),this.festivalPendantViewModel=new So(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit),this.bubbleRainViewModel=new xo(this.callerContext,this.slotId),this.giftBoxViewModel=new Lo(this.callerContext)}updateShowRedPacketRain(t){this.enableShowRedPacketView()&&(this.showRedPacketRain=t>=this.redPacketViewModel.getRedPacketViewDelayShowTime())}enableInitTopfloorContainer(){return this.enableShowGiftBoxView()||this.enableBubblerainView()||this.enableShowRedPacketView()||this.enableShowFestivalPendantView()}enableBubblerainView(){return this.bubbleRainViewModel.enableShowBubbleRainView()}enableShowRedPacketView(){return this.redPacketViewModel.enableShowRedPacketView()}isShowRedPacketViewRightNow(){return this.redPacketViewModel.isShowRedPacketViewRightNow()}isVertical(){return 0==this.callerContext.screenOrientation}enableShowFestivalPendantView(){return this.isVertical()&&this.festivalPendantViewModel.enableShowPendant()}enableShowGiftBoxView(){return this.giftBoxViewModel.enableShowGiftBox()}getFestivalPendantBottom(){}isNeedNewStyleTop(){return this.isAdForLive()&&this.isAddLiveButton()&&Pe.isAndroid()&&this.isVertical()&&2==this.callerContext.adStyle}isAdForLive(){return ft(this.callerContext.adInfo)}isAddLiveButton(){return 1==this.callerContext.adInfo.adBaseInfo.universeLiveStyle}isValidFestivalPendantBottom(){return!this.hasShowPlayend&&!(this.festivalPendantBottom<=0||this.festivalPendantBottom>=this.callerContext.containerLimit.height-this.festivalPendantViewModel.getPendantSize().height)}}class Do extends _o{constructor(t){super(),this.slotId=4,this.callerContext=t,this.createViewModels(),this.setDatas()}getFestivalPendantBottom(){this.getBottomHeigtCallback&&(this.festivalPendantBottom=this.getBottomHeigtCallback())}}class Fo extends fn{constructor(t,e,i){if(super(),this.componentData=void 0,this.mPlayPaused=!1,this.mAdInfo=t,k(t)){let e=R(t,"reward-dialog-common",5);e&&(this.mNeoAutoDialogData=B(e),this.componentData=e);let i=R(t,"reward-dialog-fund",5);!this.mNeoAutoDialogData&&i&&(this.mNeoAutoDialogData=B(i),this.componentData=i)}else this.mNeoAutoDialogData=Jt(t);this.mShowType=this.obtainTemplateShowType(),this.mContainerLimit=e,this.mScreenOrientation=i}enableShowWelfareCard(){return!!Pe.supportMinimumTKVersion("5.0.0")&&!be(this.mNeoAutoDialogData)}getAutoDialogDelayTime(){try{return k(this.mAdInfo)?this.mNeoAutoDialogData.neoAutoDialogWaitTime:1e3*this.mNeoAutoDialogData.neoAutoDialogWaitTime}catch(t){}return 1e4}getAutoDialogStayTime(){try{return k(this.mAdInfo)?this.mNeoAutoDialogData.neoAutoDialogShowTime:1e3*this.mNeoAutoDialogData.neoAutoDialogShowTime}catch(t){}return 5e3}getAutoDialogHideStyle(){try{return this.mNeoAutoDialogData.neoAutoDialogHideStyle}catch(t){}return 0}getAutoDialogComplianceText(){try{return this.mNeoAutoDialogData.neoAutoDialogComplianceText}catch(t){}return""}getAutoDialogGiftImage(){try{return this.mNeoAutoDialogData.neoAutoDialogGiftPic}catch(t){}return""}getAutoDialogRedPacketTitle(){try{return this.mNeoAutoDialogData.neoAutoDialogRedPacketTitle}catch(t){}return""}getAutoDialogRedPacketIcon(){try{return this.mNeoAutoDialogData.neoAutoDialogRedPacketIcon}catch(t){}return""}getAutoDialogRedPacketAmount(){try{return this.mNeoAutoDialogData.neoAutoDialogRedPacketAmount}catch(t){}return""}getAutoDialogRedPacketDesc(){try{return this.mNeoAutoDialogData.neoAutoDialogRedPacketDesc}catch(t){}return""}logAutoDialogImpression(){let t=new S;t.template_show_type=this.mShowType,k(this.mAdInfo)&&this.componentData&&(t.component_module=E(this.mAdInfo,this.componentData));let e={clientExtData:JSON.stringify(t)};pi.exposeElement(191,e)}logAutoDialogClose(t){let e=new S;e.template_show_type=this.mShowType;let i={elementType:69,adCloseType:t,clientExtData:JSON.stringify(e)};JSON.stringify(i);pi.log(141,null,i)}obtainTemplateShowType(){let t="",e=K.getNeoAutoDialogType(this.mAdInfo);return 1==e?t=be(this.getAutoDialogGiftImage())?"hr_service_without_img":"hr_service_with_img":2==e&&(t="online_earning_red_packet"),t}awardTimeText(){return this.getAutoDialogStayTime()/1e3+"s"}getAutoDialogGiftTitle(){try{return this.mNeoAutoDialogData.neoAutoDialogGiftTitle}catch(t){}return""}getAutoDialogGiftText(){try{return this.mNeoAutoDialogData.neoAutoDialogGiftText}catch(t){}return""}getAutoDialogGiftTextHighLight(){try{return this.mNeoAutoDialogData.neoAutoDialogGiftTextHighLight}catch(t){}return""}getAutoDialogGiftDesc(){try{return this.mNeoAutoDialogData.neoAutoDialogGiftDesc}catch(t){}return""}getActionBarText(){return Vt(this.mAdInfo)}hasGiftImage(){try{return null!=this.getAutoDialogGiftImage()&&this.getAutoDialogGiftImage().length>0}catch(t){}return!1}}class ko{constructor(t,e,i,n,s,a){this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.originContainerLimit=a}getOriginWidth(){return this.originContainerLimit?this.originContainerLimit.width:0}isCurvedScreen(){return this.containerLimit.width/this.containerLimit.height<1.8}getOriginHeight(){return this.originContainerLimit?this.originContainerLimit.height:0}}class Ro extends ko{constructor(t,e,i,n,s,a){super(t,e,i,n,s,a),this.downloadState=0,this.hasShowPlayend=!1,this.pageFocusAndVisible=!0,this.componentSwtich=!1,this.componentSwtich=k(t);let o=0;try{o=t.adMatrixInfo.adDataV2.componentDatas.length}catch(r){}0==o&&this.componentSwtich&&$e("component_ui_empty")}}class Bo extends fn{constructor(t,e,i,n,s){super(),this.itemType=F.videoAd,this.materialType=2,this.isPlaying=!1,this.isFirstPlay=!0,this.isPlayFreed=!1,this.isMute=!1,this.itemHeight=580,this.playerHeight=420,this.isImpression=!1,this.actionText="",this.downloadChangeEvent=new Oa,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.initItemTyle()}initItemTyle(){try{const t=Xt(this.adInfo);switch(t){case F.liveGoods:case F.liveNotGoods:this.materialType=2;break;default:this.materialType=1}this.itemType=t}catch(t){this.itemType=F.videoAd}}muteClick(){this.isMute=!this.isMute,console.log("Aggregation============>声音按钮点击")}convert(t,e,i,n){be(n)&&(n=new S),n.template_show_type=this.getReportItemStyle();let s={elementShowIndex:this.getElementShowIndex(),businessSceneType:33};pi.convertIfNeeded(0,this.adInfo,t,e,i,n,s,{},this.adInfo.adBaseInfo.creativeId)}isApp(){try{return 1==this.adInfo.adBaseInfo.adOperationType}catch(t){return!1}}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}getAdIcon(){return N(this.adInfo)}getAdTitle(){return J(this.adInfo)}getAdDescription(){return this.adInfo.adBaseInfo.appDescription||this.adInfo.adBaseInfo.adDescription||null}getAdActionDesc(){return Vt(this.adInfo)}getVideoFirstFrame(){return j(z(this.adInfo))}getReportItemStyle(){switch(this.itemType){case F.videoPromoteGoods:return"neo_agg_style1";case F.videoPromoteFollow:return"neo_agg_style2";case F.liveGoods:return"neo_agg_style3";case F.liveNotGoods:return"neo_agg_style4"}return"neo_agg_style5"}reportWithShowImpression(){if(this.isImpression)return;this.isImpression=!0;let t=new S;t.template_show_type=this.getReportItemStyle();let e={elementShowIndex:this.getElementShowIndex(),businessSceneType:33,clientExtData:JSON.stringify(t)},i={actionType:1,payload:JSON.stringify(e),creativeId:this.adInfo.adBaseInfo.creativeId};Ne.sendLog(i)}playNSecond(t){let e=new S;e.template_show_type=this.getReportItemStyle();let i={elementShowIndex:this.getElementShowIndex(),businessSceneType:33,photoPlaySecond:t,clientExtData:JSON.stringify(e)},n={actionType:402,payload:JSON.stringify(i),creativeId:this.adInfo.adBaseInfo.creativeId};Ne.sendLog(n)}reportVideoReplay(){let t=new S;t.template_show_type=this.getReportItemStyle();let e={elementShowIndex:this.getElementShowIndex(),businessSceneType:33,clientExtData:JSON.stringify(t)},i={actionType:24,payload:JSON.stringify(e),creativeId:this.adInfo.adBaseInfo.creativeId};Ne.sendLog(i)}isVerticalMaterial(){const t=G(this.adInfo);return!(t.width>=t.height)}getElementShowIndex(){return this.index+1}}class Eo extends Bo{constructor(t,e,i,n,s){super(t,e,i,n,s),this.isFinishLive=!1,this.itemHeight=500}getVideoURL(){return U(this.adInfo)}obtainVideoLiveData(){let t=ot(this.adInfo,12);this.videoLiveData=JSON.parse(t.data)}convert(t,e,i,n){be(n)&&((n=new S).live_room_pattern=V.SIMPLIFIED_LIVE_ROOM_PATTERN),n.template_show_type=this.getReportItemStyle();let s={elementShowIndex:this.index+1,businessSceneType:33};pi.convertIfNeeded(0,this.adInfo,t,e,i,n,s,{},this.adInfo.adBaseInfo.creativeId)}getActionDataDesc(){try{return this.adInfo.adBaseInfo.adActionDescription}catch(t){}return"点击进入快手直播间"}getLiveStatDataDesc(){try{return this.videoLiveData.neoLiveAuthorInfoData.liveStatDataDesc}catch(t){}return"看了这么久，还不去看看？"}getLabelList(){var t,e,i,n;if(null===(e=null===(t=this.videoLiveData)||void 0===t?void 0:t.neoLiveAuthorInfoData)||void 0===e?void 0:e.sellerTagList)return null===(n=null===(i=this.videoLiveData)||void 0===i?void 0:i.neoLiveAuthorInfoData)||void 0===n?void 0:n.sellerTagList}getLivenNumber(){var t,e;return(null===(t=this.videoLiveData)||void 0===t?void 0:t.watchingCount)?null===(e=this.videoLiveData)||void 0===e?void 0:e.watchingCount:"直播中"}}class Ko extends Bo{constructor(t,e,i,n,s){super(t,e,i,n,s),this.lastReportTime=0;const a=this.containerLimit.width;this.itemType==F.videoPromoteGoods?this.isVerticalMaterial()?(this.itemHeight=610,this.playerHeight=420):(this.playerHeight=a/375*188,this.itemHeight=this.playerHeight+190):this.isVerticalMaterial()?(this.itemHeight=580,this.playerHeight=420):(this.playerHeight=a/375*188,this.itemHeight=this.playerHeight+162),this.videoPlayReportSeconds=Ct(this.adInfo)}getVideoURL(){return U(this.adInfo)}isVerticalMaterial(){const t=G(this.adInfo);return!(t.width>=t.height)}getFansCount(){var t,e,i;return(null===(t=this.adInfo.advertiserInfo)||void 0===t?void 0:t.fansCount)/1e4>=1?(null===(e=this.adInfo.advertiserInfo)||void 0===e?void 0:e.fansCount)%1e4<1e3?(this.adInfo.advertiserInfo.fansCount/1e4).toFixed(0)+"万人关注了TA":(this.adInfo.advertiserInfo.fansCount/1e4).toFixed(1)+"万人关注了TA":(null===(i=this.adInfo.advertiserInfo)||void 0===i?void 0:i.fansCount)+"人关注了TA"}updateVideoProgress(t){const e=Math.floor(t);if(e!=this.lastReportTime)for(var i=0;i<this.videoPlayReportSeconds.length;i++)if(e==this.videoPlayReportSeconds[i]){this.lastReportTime=this.videoPlayReportSeconds[i],this.playNSecond(this.lastReportTime);break}}showGoodsPrice(){if(Ie(this.getGoodsPrice())&&Ie(this.getGoodsOriginPrice())){const t=Number(this.getGoodsPrice());if(t>0&&t<=20)return!0}return!1}getGoodsPrice(){try{return this.adInfo.adProductInfo.price}catch(t){}return""}getGoodsOriginPrice(){try{return this.adInfo.adProductInfo.originPrice}catch(t){}return""}}class Po extends fn{constructor(t,e,i,n,s){super(),this.countDownTime=0,this.currentPlaybackTime=0,this.canTouchCheck=!1,this.hasCallbackGift=!1,this.isUserTouch=!1,this.maxAllowedDuration=5,this.adInfo=t,this.configInfo=e,this.containerLimit=i,this.sceneInfo=n,this.countDownTime=n.neoCountDownTime,this.canTouchCheck=s,this.setupMaxTime()}setupMaxTime(){try{this.maxAllowedDuration=this.sceneInfo.noActionTime}catch(t){this.maxAllowedDuration=5}}countDown(){console.log("Aggregation============>开始倒计时"),0!==this.countDownTime&&(this.startUserTouchTiming(),this.countDownTimer||(this.countDownTimer=setInterval((()=>{this.countDownTime--,this.currentPlaybackTime++,this.countDownTime<=0&&(this.clearCountDownTimer(),this.handleHasGift())}),1e3)))}pause(){console.log("Aggregation============>倒计时暂停"),this.clearCountDownTimer()}cancelCountDown(){this.clearCountDownTimer()}clearCountDownTimer(){this.countDownTimer&&(clearTimeout(this.countDownTimer),this.countDownTimer=void 0)}handleHasGift(){this.hasCallbackGift||(this.hasCallbackGift=!0)}startUserTouchTiming(){this.canTouchCheck&&(this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout((()=>{this.noTouchEvent()}),1e3*this.maxAllowedDuration))}noTouchEvent(){this.touchTimer&&(clearTimeout(this.touchTimer),this.touchTimer=void 0),this.cancelCountDown(),this.isUserTouch=!1}isTouchCountDown(){try{return this.sceneInfo.neoCountDownNeedSwipeTrigger}catch(t){}return!1}}class Mo extends Vo{constructor(t,e,i,n,s,a){super(),this.listData=[],this.isMute=!1,this.scrollHeight=0,this.hasCallbackGift=!1,this.lifeStatus="none",this.ecAdIndex=-1,this.listHeight=0,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a,this.isMute=this.getIsMute(),this.initDatas(),this.neoWidgetVM=new Po(t,n,s,e.adGlobalConfigInfo.neoScanAggregationSceneInfo,this.canTouchCheck()),this.sceneStartTime=ue()}initDatas(){if(Se(this.adOriginInfo.impAdInfo))return;let t=0;for(let e=0;e<this.adOriginInfo.impAdInfo.length;e++){const i=this.adOriginInfo.impAdInfo[e].adInfo[0],n=this.getItemMaterialType(i);if((K.isOriginLiveAd(i)||2==n)&&!ye())continue;if(2==H(i))continue;let s;s=2==n?new Eo(i,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation):new Ko(i,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation),5!=s.itemType&&(this.ecAdIndex=t),s.isMute=this.isMute,s.index=t,0==t&&(s.itemHeight+=135),t++,this.scrollHeight+=s.itemHeight,this.listData.push(s)}}updateDownloadChangEvent(t){if(this.listData&&this.listData.length>0)for(let e of this.listData)e.downloadChangeEvent=t,e.downloadPopupVM.updateDownloadProgress(t)}getItemMaterialType(t){switch(Xt(t)){case F.liveGoods:case F.liveNotGoods:return 2;default:return 1}}getIsMute(){try{if(this.adOriginInfo.adGlobalConfigInfo.neoScanAggregationSceneInfo.mute)return this.adOriginInfo.adGlobalConfigInfo.neoScanAggregationSceneInfo.mute}catch(t){}return!1}exposureCheck(t){const e=t*(this.scrollHeight-this.containerLimit.height)+64,i=e+this.containerLimit.height;let n=0;for(let s=0;s<this.listData.length;s++){const t=n+this.listData[s].itemHeight;this.itemExposure(e,i,n,t)>=.3&&this.listData[s].reportWithShowImpression(),n+=this.listData[s].itemHeight}}getIndexWithProgress(t){let e=t*(this.scrollHeight-this.listHeight);ye()&&(e=this.getAndroidSceneStart(t));const i=e+this.listHeight;let n=0,s=0,a=0;for(let o=0;o<this.listData.length;o++){const t=n+this.listData[o].itemHeight,r=this.itemExposure(e,i,n,t);if(r>=s&&(s=r,a=o),n+=this.listData[o].itemHeight,0==a&&1==s)return a}return a}itemExposure(t,e,i,n){const s=n-i;return i>e||n<t?0:i<=t?n<e?(n-t)/s:(e-i)/s:n<=e?i>t?1:(n-t)/s:i<e?(e-i)/s:0}getAndroidAverageHeight(){let t=0,e=0;for(let i=this.firstVisiblePosition;i<=this.lastVisiblePosition;i++)t+=this.listData[i].itemHeight,e++;return e>0?t/e:0}getAndroidSceneStart(t){const e=this.getAndroidAverageHeight(),i=t*(e*this.listData.length-this.listHeight),n=Math.max(i-e*this.firstVisiblePosition,0);let s=0;for(let a=0;a<this.firstVisiblePosition;a++)s+=this.listData[a].itemHeight;return s+n}isTouchCountDown(){try{return this.adOriginInfo.adGlobalConfigInfo.neoScanAggregationSceneInfo.neoCountDownNeedSwipeTrigger}catch(t){}return!1}isFingerGuide(){try{return this.adOriginInfo.adGlobalConfigInfo.neoScanAggregationSceneInfo.guidSwipezShowMore}catch(t){}return!1}canTouchCheck(){if(this.listData.length<2)return!1;try{return this.adOriginInfo.adGlobalConfigInfo.neoScanAggregationSceneInfo.noActionStopCountDown}catch(t){}return!1}videoPlayStart(){this.playStarted||(this.playStarted=!0,pi.log(399,null,null),pi.updateVideoPlayStatus("start"))}reportSoundClick(){let t={elementType:this.isMute?32:33,businessSceneType:33};pi.log(141,null,t)}reportAdClose(){let t=0;for(let i=0;i<this.listData.length;i++)this.listData[i].isImpression&&t++;let e={businessSceneType:33,duration:this.neoWidgetVM.currentPlaybackTime,adImpressionAmount:t};pi.log(3,null,e);!function(t,e,i){Ze({category:"ad_client_apm_log",biz:"AD_REWARD",tag:"AD_REWARD",sub_biz:"OTHER",rate:1,suffixRatio:"",event_id:"ad_sdk_scan_aggregation_show",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{scene_status:4,duration_ms:t,user_stay_duration:e,impression_count:i}})}(ue()-this.sceneStartTime,this.neoWidgetVM.currentPlaybackTime,t)}reportSceneLoadFinish(){const t=ue()-this.sceneStartTime;var e,i;e=t,i=this.listData.length,Ze({category:"ad_client_apm_log",biz:"AD_REWARD",tag:"AD_REWARD",sub_biz:"OTHER",rate:1,suffixRatio:"",event_id:"ad_sdk_scan_aggregation_show",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{scene_status:3,cache_time_ms:e,load_count:i}})}isShowEcPrivacyView(){return this.ecAdIndex>=0}}class Oo extends wo{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.isNeedCheck=!0,this.additionalInit()}additionalInit(){Pe.supportMinimumVersion("3.3.19","3.3.26")&&Ne.registerDeepRewardListener((t=>{this.hasGetDeepGift=t.data&&t.data.hasDeepReward})),Pe.supportMinimumVersion("3.3.20","3.3.27")&&Pe.isAndroid()&&this.isDownloadAd()&&He((t=>{t.data&&1==t.data.hasInstalled&&2==this.adStyle&&(this.hasInstallTargetApp=!0,this.handleSkipCallback&&!this.hasShowPlayend&&this.handleSkipCallback(!1,!1,0))})),Pe.supportMinimumTKVersion("4.0.4")||(this.needShowPlayEndCloseBtn=1)}handleClose(){this.handleCloseCallback&&this.handleCloseCallback()}handleSkip(t,e,i){let n=new b;n.closeButtonImpressionTime=i,n.closeButtonClickTime=this.currentPlaybackTime,n.clientTimestamp=ue();let s={elementType:69,extParams:JSON.stringify(n)},a={actionType:141,payload:JSON.stringify(s)};Ne.sendLog(a),this.handleSkipCallback&&this.handleSkipCallback(t,e,i)}handleGiftClick(e){pi.convertIfNeeded(0,this.adInfo,2,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK)}handleCallClick(e,i){pi.convertIfNeeded(0,this.adInfo,1,{x:i.position.rawX,y:i.position.rawY},e?t.PLAY_END_CALL_CLICK:t.PLAY_DETAIL_CALL_CLICK)}handleCallImpressionOnFinish(){pi.exposeElement(17)}handleCallImpressionOnPlay(){pi.exposeElement(18)}handlePlayEnd(t){this.hasShowPlayend=!0}handleMuteChange(t){this.isMuted=t}obtainNeoInteractTime(){this.giveRewardTime=_t(this.adInfo)}convertForOtherArea(t,e,i,n){let s=new S;s.material_click_area="neo_top",pi.convertIfNeeded(1,this.adInfo,e,i,n,s)}}class No extends fn{constructor(t,e,i=null){super(),this.reportFreQ=!1,this.clickType=0,this.getActionBarRect=()=>({x:0,y:0,width:0,height:0}),this.callerContext=t,this.industryInfo=e,be(i)?this.templateShowType=this.obtainTemplateShowType():this.templateShowType=i}obtainTemplateShowType(){let t="ecommerce_coupon";if(this.industryInfo){switch(this.industryInfo.merchantStyleType){case I.PRODUCT:t="benefit_card_item";break;case I.COUPON:t="ecommerce_coupon";break;case I.EVENT:t="benefit_card_activity";break;case I.DEFAULT:t="benefit_card_default"}}return t}updateProgressListener(t){if(t.result&&Pe.isSupportDownloadProgressListen()&&X(this.callerContext.adInfo)){const{status:e,progress:i,totalBytes:n}=t.data,s=Number((100*i).toFixed(0))>100?"100":(100*i).toFixed(0);switch(e){case 0:case 1:case 4:this.actionBarText=this.callerContext.adInfo.adBaseInfo.adActionDescription;break;case 2:this.actionBarText=`${s}%`;break;case 3:this.actionBarText="继续下载";break;case 5:this.actionBarText=Ie(this.callerContext.adInfo.adBaseInfo.installAppLabel)?this.callerContext.adInfo.adBaseInfo.installAppLabel:"点击安装";break;case 6:this.actionBarText=Ie(this.callerContext.adInfo.adBaseInfo.openAppLabel)?this.callerContext.adInfo.adBaseInfo.openAppLabel:"立即打开"}}}isCouponLegacy(){return!1}getBottomTipsText(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.riskPromptText)||"具体活动或金额以实际活动为准"}supportHorizontal(){return!1}enableShowCard(){return!be(this.industryInfo)}getRightsCardStayTime(){var t,e;let i=7;try{let n=null!==(e=null===(t=this.industryInfo)||void 0===t?void 0:t.rightsCardShowTime)&&void 0!==e?e:7e3;i=Math.ceil(n/1e3)}catch(n){}return i}enableInteractCard(){return this.getInteractShowTime()>0}getInteractShowTime(){var t,e;return null!==(e=null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardShowTime)&&void 0!==e?e:2e3}getInteractTitle(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardTitle)||""}getInteractSubTitle(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardSubTitle)||""}getInteractIcon(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardIcon)||""}getInteractCustomerInfo(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardCustomer)||[]}getDelayShowTime(){var t,e;let i=5;try{let n=null!==(e=null===(t=this.industryInfo)||void 0===t?void 0:t.delayTime)&&void 0!==e?e:2e3;i=Math.ceil(n/1e3)}catch(n){i=5}return i}isVertical(){return 0==this.callerContext.screenOrientation}isSplashScene(){return 4==this.callerContext.adStyle}isInterstitialScene(){return 13==this.callerContext.adStyle}logInteractionImp(){let t=new S;t.template_show_type="interaction_card_ecom";let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}logInteractionClick(t){let e=new S;e.click_area=t,e.template_show_type="interaction_card_ecom";let i={elementType:191,clientExtData:JSON.stringify(e)},n={actionType:141,payload:JSON.stringify(i)};Ne.sendLog(n)}logRightsImp(t,e){let i=new S;i.template_show_type=t,this.reportFreQ||(i.universe_feature_freq=e),this.reportFreQ=!0;let n={elementType:191,clientExtData:JSON.stringify(i)},s={actionType:140,payload:JSON.stringify(n)};Ne.sendLog(s)}convert(t,e,i,n){let s=new S;return s.template_show_type=this.templateShowType,pi.convertIfNeeded(1,this.callerContext.adInfo,e,t,i,s,n)}logSplashCardImpression(){if(this.isSplashScene()){let t={elementType:239};pi.log(140,null,t)}}}class Ho{}class Wo extends No{constructor(t,e){super(t,e),this.couponInfo=this.industryInfo,this.actionBarText=this.callerContext.adInfo.adBaseInfo.adActionDescription,this.mScreenWidthDp=ge(le()),this.mScreenScaleX=this.mScreenWidthDp/414}getCardSize(){let t=new Ho;return t.width=Math.ceil(406*this.mScreenScaleX),t.height=Math.ceil(372*t.width/406),t}getRootBgColor(){return null}getCouponBarSize(){let t=new Ho;return t.width=Math.ceil(264*this.mScreenScaleX),t.height=Math.ceil(92*t.width/264),t.left=Math.ceil((this.mScreenWidthDp-t.width)/2),t.bottom=Math.ceil(68*t.height/92),t}getFullCardBgUrl(){return"ec_card_coupon_anim_bg.png"}getFullCardHeight(){return 497*this.mScreenWidthDp/414}getRightsCardTitle(){return""}needCouponBarBg(){return!0}getBottomTipsMarginBottom(){return Math.ceil(45*this.mScreenScaleX)}getBottomImageViewName(){return null}useLegacyAnim(){return!1}getBgUrl(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardBgUrl)||""}getUserIcon(){return""}getTitleDesc(){return""}getCouponTitle(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardTitle)||""}getCouponDesc(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardDescription)||""}getPriceAmount(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardAmount)||""}enableAnimation(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle||4==this.callerContext.adStyle}enableShowCloseView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowCountDownView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowActionbarView(){return 13!=this.callerContext.adStyle}enableHandBreathAnim(){return!0}getActionbarDesc(){return this.couponInfo.merchantCardActionDescription||"立即领取"}logECCardImpression(){let t=new S;t.template_show_type="ecommerce_coupon";let e={clientExtData:JSON.stringify(t)};pi.exposeElement(191,e)}}class zo extends Wo{constructor(t){var e;super(t,null),this.merchantCardInfo=kt(this.callerContext.adInfo,this.callerContext.adStyle),this.actionBarText=(null===(e=this.merchantCardInfo)||void 0===e?void 0:e.merchantCardActionDescription)||"立即领取"}getCardSize(){let t=new Ho;return t.width=263,t.height=273,t}getRootBgColor(){return"#00000099"}getCouponBarSize(){let t=new Ho;return t.width=211,t.height=69,t.left=31,t.bottom=38,t}getFullCardBgUrl(){return null}supportHorizontal(){return!0}getRightsCardTitle(){return"恭喜获得"}needCouponBarBg(){return!1}getBottomTipsText(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.riskPromptText)||"具体活动或金额以实际活动为准"}getBottomImageViewName(){return"ec_card_view_bg.png"}useLegacyAnim(){return!0}getBgUrl(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardBgUrl)||""}getUserIcon(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardUserIcon)||""}getTitleDesc(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardTitleDescription)||""}getCouponTitle(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardTitle)||""}getCouponDesc(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardDescription)||""}getPriceAmount(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardAmount)||""}getRightsCardStayTime(){let t=10;try{t=Math.ceil(this.merchantCardInfo.merchantCardStayTime/1e3)}catch(e){t=10}return t}getDelayShowTime(){let t=5;try{t=Math.ceil(this.merchantCardInfo.merchantCardShowTime/1e3)}catch(e){t=5}return t}enableInteractCard(){return!1}isCouponLegacy(){return!be(this.merchantCardInfo)}enableShowCard(){return!be(this.merchantCardInfo)}enableAnimation(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle||4==this.callerContext.adStyle}enableShowCloseView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowCountDownView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowActionbarView(){return 13!=this.callerContext.adStyle}enableHandBreathAnim(){return!1}getActionbarDesc(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardActionDescription)||"立即领取"}}class Uo extends No{constructor(t,e,i,n){super(t,e,i),this.needShowSellingText=!1,this.frqType=n,this.productInfo=this.industryInfo}getActionbarDesc(){return this.callerContext.adInfo.adBaseInfo.adActionDescription}getShowTime(){var t,e;return null!==(e=null===(t=this.productInfo)||void 0===t?void 0:t.showTime)&&void 0!==e?e:6e3}getRightsCardTitle(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardTitle)||""}getRightsCardProductTags(){var t,e;const i=new Array;return null===(e=null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardProductTags)||void 0===e||e.forEach((t=>{if(!be(t)){let e={text:t,url:"",canClick:!1};i.push(e)}})),i.slice(0,3)||[]}logProductRightsImp(){super.logRightsImp(this.templateShowType,this.frqType)}isHasTags(){return this.getRightsCardProductTags()&&this.getRightsCardProductTags().length>0}getRightsCardCustomImageUrl(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardCustomImageUrl)||""}getRightsCardCustomContent(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardCustomContent)||""}getRightsCardSellingPoint(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.sellingPoint)||""}getRightsCardAction(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardAction)||""}getRightsCardSecKillTime(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardSecKillTime)||0}getRightsCardProductIconDesc(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardProductIconDesc)||""}getPrice(){var t;let e=be(this.getOriginPrice())?"":"惊爆价格";return(null===(t=this.productInfo)||void 0===t?void 0:t.price)||e}getOriginPrice(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.originPrice)||""}isOnlyHasOriginPrice(){var t;return!be(this.getOriginPrice())&&be(null===(t=this.productInfo)||void 0===t?void 0:t.price)}}class Go extends No{constructor(t,e){super(t,e),this.activityInfo=this.industryInfo,this.actionBarText=this.callerContext.adInfo.adBaseInfo.adActionDescription,this.mScreenWidthDp=ge(le()),this.mScreenScaleX=this.mScreenWidthDp/414}getLottieSize(){let t=this.mScreenWidthDp/500,e=new Ho;return e.width=Math.ceil(500*t),e.height=Math.ceil(515*e.width/500),e}getTitleSize(){let t=new Ho;return t.width=Math.ceil(414*this.mScreenScaleX),t.height=Math.ceil(187*t.width/414),t}getButtonSize(){let t=new Ho;return t.width=Math.ceil(190*this.mScreenScaleX),t.height=Math.ceil(48*t.width/190),t.borderRadius=Math.ceil(t.height/2),t}getWidgetSize(){let t=new Ho;return t.width=Math.ceil(248*this.mScreenScaleX),t.height=Math.ceil(54*t.width/248),t}getCardViewSize(){let t=new Ho;return t.width=Math.ceil(250*this.mScreenScaleX),t.height=Math.ceil(372*t.width/250),t.borderRadius=Math.ceil(24*t.height/372),t}getCardBgSize(){let t=new Ho;return t.width=Math.ceil(414*this.mScreenScaleX),t.height=Math.ceil(497*t.width/414),t}getFullCardHeight(){return 700*this.mScreenScaleX}getHandViewSideLength(){return 90*this.mScreenScaleX}getBottomTipsMarginBottom(t){return Math.ceil(this.mScreenScaleX*t)}getCardMarginTop(t){return Math.ceil(this.mScreenScaleX*t)}getCardMarginRight(t){return Math.ceil(this.mScreenScaleX*t)}getFullCardBgUrl(){return"ec_card_coupon_anim_bg.png"}getRightsCardTitle(){var t;return(null===(t=this.activityInfo)||void 0===t?void 0:t.rightsCardTitle)||""}getRightsCardCustomImageUrl(){var t;return(null===(t=this.activityInfo)||void 0===t?void 0:t.rightsCardCustomImageUrl)||""}getRightsCardAction(){var t;return(null===(t=this.activityInfo)||void 0===t?void 0:t.rightsCardAction)||""}getActionbarDesc(){return""}}class jo extends fn{constructor(t){if(super(),this.cardCreateSuccess=!1,this.callerContext=t,this.ecIndustryInfo=Rt(this.callerContext.adInfo,this.callerContext.adStyle),be(this.ecIndustryInfo)){let t=Kt(this.callerContext.adInfo,this.callerContext.adStyle),e=this.callerContext.adInfo.adProductInfo;this.ecIndustryInfo=K.newDeepVideoInteractCardInfo(e,t)}if(be(this.ecIndustryInfo))this.rightsCardVM=new zo(t);else{switch(this.ecIndustryInfo.merchantStyleType){case I.COUPON:this.rightsCardVM=new Wo(t,this.ecIndustryInfo);break;case I.EVENT:this.rightsCardVM=new Go(t,this.ecIndustryInfo);break;case I.PRODUCT:this.rightsCardVM=new Uo(t,this.ecIndustryInfo,"benefit_card_item",25);break;case I.PRODUCT_DEEP_VIDEO:let e=new Uo(t,this.ecIndustryInfo,"internal_circulation_item",29);e.needShowSellingText=!0,this.rightsCardVM=e;break;case I.DEFAULT:this.rightsCardVM=new Go(t,this.ecIndustryInfo)}}}updateProgressListener(t){this.rightsCardVM&&this.rightsCardVM.updateProgressListener(t)}getRightsCardVM(){return this.rightsCardVM}isLegacyVM(){return be(this.ecIndustryInfo)}isVertical(){return 0==this.callerContext.screenOrientation}logCloseReport(t,e){let i=new S;i.template_show_type=e;let n={elementType:69,adCloseType:t,clientExtData:JSON.stringify(i)};pi.log(141,null,n)}enableInteract(){return this.rightsCardVM.enableInteractCard()}enableShowCard(){return this.rightsCardVM.enableShowCard()}cardLoadSuccess(){return this.cardCreateSuccess&&this.enableShowCard()}getDelayShowTime(){return this.rightsCardVM.getDelayShowTime()}getRightsCardStayTime(){return this.rightsCardVM.getRightsCardStayTime()}enableAnimation(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle||4==this.callerContext.adStyle}enableShowCloseView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowCountDownView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowActionbarView(){return 13!=this.callerContext.adStyle}getActionbarDesc(){return this.rightsCardVM.getActionbarDesc()}}class Yo extends fn{constructor(){super(...arguments),this.shakeRegistered=!1,this.hadExposeShakeElement=!1,this.rotateRegistered=!1,this.slotId=-1,this.componentData=void 0}needShowShakeUI(){return!1}getShakeSubtitle(){return""}getAccelerationThreshold(){return 7}enableShakeConvert(){let t=this.getShakeInfo();return!be(t)&&t.enable}enableRotateConvert(){if(!Pe.supportMinimumTKVersion("5.0.0"))return!1;let t=this.getRotateInfo();return!be(t)&&t.enable}getRotateInfo(){let t=null;return this.interactionInfo&&(t=this.interactionInfo.rotateInfo),t}getShakeInfo(){let t=null;return this.interactionInfo&&(t=this.interactionInfo.shakeInfo),t}getInteractionInfoInfo(){if(k(this.callerContext.adInfo))return this.interactionInfo;try{2==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.neoVideoInfo.interactionInfo),3==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo)}catch(t){}return this.interactionInfo}startListenSensor(){this.enableShakeConvert()&&this.listenShakeSensor(),this.enableRotateConvert()&&this.listenRotateSensor()}stopListenSensor(){this.enableShakeConvert()&&this.stopListenShake(),this.enableRotateConvert()&&this.stopListenRotate()}listenShakeSensor(){if(this.lastSensor=new Array,this.lastSensor[0]=0,this.lastSensor[1]=0,this.lastSensor[2]=0,this.shakeRegistered||(this.shakeRegistered=!0,ro.registerSensorListener(1,-3,(e=>{try{if(!be(e)&&!be(e.values)&&this.shakeRegistered){e=this.shakeNoiseReduction(e);let i,n=Math.sqrt(e.values[0]*e.values[0]+e.values[1]*e.values[1]+e.values[2]*e.values[2]);if(Math.abs(n-9.81)<=.05)return;if(this.lastSensor=e.values,zt(this.getShakeInfo())?(i=this.bidirectionalRotateShakeUtil.bidireationShakeConvert(e.values),n=Math.max(Math.max(Math.abs(e.values[0]),Math.abs(e.values[1])),Math.abs(e.values[2]))):i=n>=this.getAccelerationThreshold(),this.callerContext.pageFocusAndVisible&&i){this.stopListenSensor(),Pe.supportMinimumTKVersion("5.0.0")&&KSAdSystemUtil.startVibrate(100);let e={splash_shake_acceleration:n},i={reward_interactive_style_type:this.getInteractiveStyleType()};this.callerContext.componentSwtich&&(i.component_module=E(this.callerContext.adInfo,this.componentData)),pi.convertIfNeeded(0,this.callerContext.adInfo,1,{x:0,y:0},t.SHAKE_ICON_SHACK,i,e)}}}catch(i){}}))),!this.hadExposeShakeElement){this.hadExposeShakeElement=!0;let t=new S,e={elementType:185};k(this.callerContext.adInfo)&&this.componentData&&(t.universe_feature_freq=this.componentData.componentId,t.component_module=E(this.callerContext.adInfo,this.componentData)),t.reward_interactive_style_type=this.getInteractiveStyleType(),e.clientExtData=JSON.stringify(t),pi.log(140,{x:0,y:0},e)}}listenRotateSensor(){if(this.rotateHandler||(this.rotateHandler=new Ys(this.getRotateInfo())),this.rotateHandler.beforeMonitor(),!this.rotateRegistered)if(this.rotateRegistered=!0,"undefined"!=typeof KSAdSensorManager&&KSAdSensorManager.supportSensor(2))ro.registerSensorListener(2,-3,(e=>{try{if(!be(e)&&!be(e.values)&&this.rotateHandler&&this.rotateRegistered&&this.callerContext.pageFocusAndVisible&&this.rotateHandler.canConvertRotate(e)){this.stopListenSensor();let e={splashInteractionRotateAngle:this.rotateHandler.maxRotateContent()},i={reward_interactive_style_type:this.getInteractiveStyleType()};k(this.callerContext.adInfo)&&this.componentData&&(i.component_module=E(this.callerContext.adInfo,this.componentData)),pi.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,i,e),KSAdSystemUtil.startVibrate(100)}}catch(i){}}));else{if(this.rotateHandler.bidirectionalSwitch)return;let e=this.getRotateInfo();(null==e?void 0:e.useImitateRotate)&&(this.sensorImitateRotateUtil=new Zs(e),this.sensorImitateRotateUtil.registerImitateRotateSensorListener((e=>{try{if(!be(e)&&this.rotateRegistered&&this.callerContext.pageFocusAndVisible){this.stopListenSensor();let i={splashInteractionRotateAngle:e},n={reward_interactive_style_type:this.getInteractiveStyleType()};pi.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,n,i),KSAdSystemUtil.startVibrate(100)}}catch(i){}})))}}stopListenRotate(){this.rotateRegistered&&(this.rotateRegistered=!1,this.sensorImitateRotateUtil?this.sensorImitateRotateUtil.unRegisterImitateRotateSensorListener():ro.unregisterSensorListener(2))}stopListenShake(){this.shakeRegistered&&(this.shakeRegistered=!1,ro.unregisterSensorListener(1))}shakeNoiseReduction(t){let e=.6;return 0==this.lastSensor[0]&&0==this.lastSensor[1]&&0==this.lastSensor[2]&&(e=1),this.lastSensor[0]=e*t.values[0]+(1-e)*this.lastSensor[0],this.lastSensor[1]=e*t.values[1]+(1-e)*this.lastSensor[1],this.lastSensor[2]=e*t.values[2]+(1-e)*this.lastSensor[2],t.values[0]=this.lastSensor[0],t.values[1]=this.lastSensor[1],t.values[2]=this.lastSensor[2],t}getInteractiveStyleType(){try{return this.callerContext.configInfo.abConfig.rewardInteractiveStyleType}catch(t){return 0}}isSlideClick(){var t;return!!(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}convert(t,e,i,n){}}class Xo extends Yo{constructor(t,e){super(),this.callerContext=t,e&&(this.slotId=e);try{if(k(this.callerContext.adInfo)){let t=R(this.callerContext.adInfo,"reward-shake",this.slotId);t&&(this.interactionInfo=B(t),this.componentData=t)}else this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.neoVideoInfo.interactionInfo}catch(i){}this.bidirectionalRotateShakeUtil=new Xs(this.getInteractionInfoInfo())}needShowShakeUI(){try{return!!this.enableShakeConvert()&&(!!ro.supportSensor(1)&&2==this.interactionInfo.interactiveStyle)}catch(t){}return!1}getShakeSubtitle(){let t="";try{if(console.log("tkloadcontroller isdownload:"+X(this.callerContext.adInfo)),X(this.callerContext.adInfo)){const e=this.interactionInfo.actionBarInfo.downloadTexts;switch(this.callerContext.downloadState){case 6:t=e.openAppLabel;break;case 5:t=e.installAppLabel;break;default:t=e.adActionDescription}}else t=this.interactionInfo.shakeInfo.subtitle}catch(e){}return Ie(t)?"或点击"+t:""}getAccelerationThreshold(){return Wt(this.interactionInfo)}convert(t,e,i,n){n||(n=new S),k(this.callerContext.adInfo)&&this.componentData&&(n.component_module=E(this.callerContext.adInfo,this.componentData)),n.material_click_area="neo_mid",n.reward_interactive_style_type=this.getInteractiveStyleType(),pi.convertIfNeeded(3,this.callerContext.adInfo,t,e,i,n)}}class Jo extends fn{constructor(t){super(),this.clickType=0,this.reportFreQ=!1,this.callerContext=t,this.gameIndustryInfo=Et(this.callerContext.adInfo,this.callerContext.adStyle)}enableShowGameCard(){return!be(this.gameIndustryInfo)&&0==this.callerContext.screenOrientation}getDelayTime(){var t,e;return null!==(e=null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.delayTime)&&void 0!==e?e:3e3}enableShowWidget(){var t,e;return null!==(e=null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardTransformSwitch)&&void 0!==e&&e}enableCopy(){return!(ye()||!Pe.supportMinimumTKVersion("5.0.0"))||!!Pe.supportMinimumTKVersion("5.1.6")}enableInteractCard(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardShowTime)>0}getInteractShowTime(){var t,e;return null!==(e=null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardShowTime)&&void 0!==e?e:3e3}getInteractTitle(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardTitle)||""}getInteractSubTitle(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardSubTitle)||""}getInteractIcon(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardIcon)||""}getInteractCustomerInfo(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardCustomer)||[]}getRightsShowTime(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardShowTime)||3e3}getRightsCardTitle(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardTitle)||""}getRightsIconLis(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardIconList)||[]}getRightsCardCode(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardCode)||""}getRightsCardCodeDesc(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardCodeDesc)||""}getRightsCardAction(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardAction)||""}getRightsGiftStyle(){return this.getRightsIconLis().length>1?1:0}copyRightsCode(){this.enableCopy()&&KSAdPasteboard.copyToPasteboard(this.getRightsCardCode(),1,(t=>{console.log("tkloadcontroller ====+++++pasteboardName"+t)}))}convert(t,e,i,n){pi.convertIfNeeded(1,this.callerContext.adInfo,e,t,i,n)}logCloseReport(t){let e=new S;e.template_show_type="gameindustry";let i={elementType:69,adCloseType:t,clientExtData:JSON.stringify(e)};pi.log(141,null,i)}logRightsImp(){let t=new S;t.template_show_type="benefit_card",this.reportFreQ||(t.universe_feature_freq=22),this.reportFreQ=!0;let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}logInteractionImp(){let t=new S;t.template_show_type="interaction_card",this.reportFreQ||(t.universe_feature_freq=22),this.reportFreQ=!0;let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}logInteractionClick(t){let e=new S;e.click_area=t,e.template_show_type="interaction_card";let i={elementType:191,clientExtData:JSON.stringify(e)},n={actionType:141,payload:JSON.stringify(i)};Ne.sendLog(n)}logWidgetImp(){let t=new S;t.template_show_type="pendant_card";let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}}class $o extends fn{constructor(t,e,i,n,s,a,o,r){super(),this.downloadStatus=0,this.lifeStatus="none",this.hasReportShow=!1,this.showTimerPaused=!1,this.currentTimerValue=0,this.timerInterval=1e3,this.closeType=0,this.tipDes="s后为你打开，展示更多精彩",this.isCardRender=!1,this.focusChangeEvent="windowFocusLost",this.slotId=-1,this.componentData=void 0,this.instalActivateCard=void 0,this.callerContext=t,this.adInfo=e,this.adStyle=n,this.configInfo=s,this.containerLimit=a,this.screenOrientation=o,this.showTimeMs=this.getShowTime(),this.currentTimerValue=this.showTimeMs,r&&(this.slotId=r);if(k(this.callerContext.adInfo)&&-1!=this.slotId){let t=R(this.callerContext.adInfo,"installed-active",this.slotId);t&&(this.componentData=t,this.instalActivateCard=B(t))}}updateLifeStatus(t){"showEnd"!=t||this.hasReportShow||!this.adInfo.adMatrixInfo.adDataV2.installedActivateInfo&&!this.componentData||(this.hasReportShow=!0,this.reportElementPv(),this.startCountDown()),"pageVisiable"==t?this.showTimerPaused=!1:"pageInvisiable"==t?this.showTimerPaused=!0:"hideEnd"==t&&this.stopCountDown(),this.lifeStatus=t}startCountDown(){this.stopCountDown(),this.countDownTimer=setInterval((()=>{this.showTimerPaused||(this.currentTimerValue=this.currentTimerValue-this.timerInterval,this.currentTimerValue<=0&&this.closeAndConvert(2,1,t.AUTO_CLICK_OTHER_AREA,null))}),this.timerInterval)}stopCountDown(){this.countDownTimer&&clearTimeout(this.countDownTimer)}getAppIconUrl(){return this.instalActivateCard||(this.instalActivateCard=tt(this.adInfo)),(be(this.instalActivateCard)?null:this.instalActivateCard.adAppUrl)||"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}getAdName(){return this.instalActivateCard||(this.instalActivateCard=tt(this.adInfo)),be(this.instalActivateCard)?"":this.instalActivateCard.adTitle}getBtnText(){let t="立即打开";this.instalActivateCard||(this.instalActivateCard=tt(this.adInfo));let e=be(this.instalActivateCard)?t:this.instalActivateCard.adActionDescription;return be(e)?t:e}getShowTime(){this.instalActivateCard||(this.instalActivateCard=tt(this.adInfo));let t=be(this.instalActivateCard)?5e3:this.instalActivateCard.displayDuration;return be(t)?5e3:t}showOnTop(){let t=!0;this.instalActivateCard||(this.instalActivateCard=tt(this.adInfo));let e=be(this.instalActivateCard)?t:this.instalActivateCard.displayLocation;return be(e)?t:1==e}isBtnRedStyle(){let t=!0;this.instalActivateCard||(this.instalActivateCard=tt(this.adInfo));let e=be(this.instalActivateCard)?t:this.instalActivateCard.btnStyle;return be(e)?t:1==e}reportElementPv(){let t=new S;if(k(this.callerContext.adInfo)&&this.componentData){const e=this.callerContext.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds,component_id:this.componentData.componentId};t.universe_feature_freq=this.componentData.componentId,t.component_module=JSON.stringify(i)}else t.universe_feature_freq=8;t.auto_pop_area=this.showOnTop()?1:0,t.card_source_type=1;let e={clientExtData:JSON.stringify(t)};pi.exposeElement(16,e)}closeAndConvert(t,e,i,n){this.closeType=t,this.stopCountDown();let s=new S;if(s.auto_pop_area=this.showOnTop()?1:0,s.card_source_type=1,k(this.callerContext.adInfo)&&this.componentData){const t=this.callerContext.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let e={page_id:t.playCardInfo.pageId,combination_id:t.playCardInfo.combinationIds,component_id:this.componentData.componentId};s.component_module=JSON.stringify(e)}pi.convertIfNeeded(4,this.adInfo,e,n,i,s)}onlyClose(){this.closeType=1,this.stopCountDown();let t=new S;t.auto_pop_area=this.showOnTop()?1:0,t.card_source_type=1;let e={clientExtData:JSON.stringify(t)};pi.log(713,null,e)}notifyAdClose(){Ne.close()}}class qo extends $o{getData(t){let e=[];e.push(Ne.getKsAdDataAsync()),e.push(Ne.getDeviceInfoAsync()),e.push(Ne.getKsAdConfigAsync()),e.push(Ne.getContainerLimitAsync()),e.push(Ne.getScreenOrientationAsync()),Promise.all(e).then((e=>{const i=e[0].data,n=e[1].data,s=e[2].data,a=e[3].data,o=e[4].data;try{this.adInfo=i.impAdInfo[0].adInfo[0],this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=o.screenOrientation,oe(this.deviceInfo),this.additionalInit()}catch(r){}this.deviceInfo=n,this.configInfo=s,this.containerLimit=a,this.screenOrientation=o.screenOrientation,t&&t(!0)}))}additionalInit(){this.showTimeMs=this.getShowTime(),this.currentTimerValue=this.showTimeMs,this.isCardRender=!0,this.registerLifeStatusListener()}registerLifeStatusListener(){Ne.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&this.updateLifeStatus(e)}}))}isCompoentUI(){return!(!k(this.adInfo)||!this.componentData)}}class Zo extends fn{constructor(t,e,i,n,s){if(super(),this.lifeStatus="none",this.styleDataInfo=void 0,this.slotId=-1,this.componentData=void 0,this.needShowFlag=!0,this.cardTopMargin=0,this.cardBottomMargin=0,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.styleType=n,s&&(this.slotId=s),k(this.adInfo)){let t=R(this.adInfo,"auto-call-app",this.slotId);t&&(this.styleDataInfo=B(t),this.componentData=t)}else this.styleDataInfo=lt(this.adInfo,this.styleType);this.adDefaultMaterialType=H(this.adInfo)}isValidSDKVersion(){return!!Pe.supportMinimumTKVersion("4.0.6")}isValidCardInfo(){return null!=this.styleDataInfo}shouldShowAutoCallAppCard(t=void 0){this.isValidCardInfo()?t&&t(!0):t&&t(!1)}setConverted(t){this.convertNotify&&this.convertNotify(t)}closeAutoCall(){this.closeAutoCallCallback&&this.closeAutoCallCallback()}enableShowAutoCallOnInInterstitial(){return!!(this.isValidSDKVersion()&&this.needShowFlag&&this.isValidCardInfo())}updateLifeStatus(t){this.lifeStatus=t}}class Qo extends fn{constructor(t,e){super(),this.currentPlaybackTime=0,this.callerContext=t,this.styleType=e,this.liveCouponInfo=this.obtainVideoLiveData()}obtainVideoLiveData(){try{let t=ot(this.callerContext.adInfo,this.styleType),e=JSON.parse(t.data);if(!be(e)&&!be(e.liveCouponInfo))return e.liveCouponInfo}catch(t){}return null}isLiveCouponPopUpEnable(){let t=!1;if(be(this.liveCouponInfo)||0!=this.callerContext.screenOrientation)return t;try{let e=this.liveCouponInfo.innerLiveCouponStyle;t=1==e||3==e}catch(e){}return t}isLiveCouponBottomCardEnable(){let t=!1;if(be(this.liveCouponInfo)||0!=this.callerContext.screenOrientation)return t;try{let e=this.liveCouponInfo.innerLiveCouponStyle;t=2==e||3==e}catch(e){}return t}supportSlideClick(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.slideClick}catch(t){return!1}}getShopImage(){try{return this.callerContext.adInfo.adBaseInfo.appIconUrl}catch(t){}return""}getShopName(){try{return this.callerContext.adInfo.adBaseInfo.appName}catch(t){}return""}getCouponTitle(){try{return this.liveCouponInfo.couponTitle}catch(t){}return""}getCouponAmount(){try{return this.liveCouponInfo.couponAmount}catch(t){}return 0}getCouponCondition(){try{return this.liveCouponInfo.couponCondition}catch(t){}return""}getCouponSubTitle(){try{return this.liveCouponInfo.couponSubTitle}catch(t){}return"直播限时补贴"}getCouponActionDesc(){try{return this.liveCouponInfo.couponActionDesc}catch(t){}return"去领取"}getCouponExpireTime(){try{return this.liveCouponInfo.couponExpireTime}catch(t){}return""}getCouponDelayTime(){try{let t=this.liveCouponInfo.delayTime;return Math.ceil(t/1e3)}catch(t){}return 8}getCouponShowTime(){try{return this.liveCouponInfo.showTime}catch(t){}return 5e3}getNumberStringDigits(t){return null==t?0:t.indexOf(".")>=0?t.length-1:t.length}convert(t,e,i,n=null,s){pi.convertIfNeeded(1,this.callerContext.adInfo,t,e,i,n,s)}logCloseReport(t,e){let i=new S;i.template_show_type=e;let n={elementType:69,adCloseType:t,clientExtData:JSON.stringify(i)};pi.log(141,null,n)}impressionReport(t,e){let i=new S;i.template_show_type=e;let n={elementType:t,clientExtData:JSON.stringify(i)},s={actionType:140,payload:JSON.stringify(n)};Ne.sendLog(s)}}class tr extends fn{constructor(t){super(),this.callerContext=t,this.socialCardInfo=Bt(this.callerContext.adInfo,this.callerContext.adStyle),this.mScreenWidthDp=ge(le()),this.mScreenScaleX=this.mScreenWidthDp/414}enableShowSocialCard(){return!be(this.socialCardInfo)&&0==this.callerContext.screenOrientation}getCardSize(){let t=new Ho;return t.width=Math.ceil(382*this.mScreenScaleX),t.height=Math.ceil(510*t.width/382),t.borderRadius=32,t}getPictureFrameSize(){let t=new Ho;return t.width=Math.ceil(288*this.mScreenScaleX),t.height=Math.ceil(408*t.width/288),t}getPictureSize(){let t=new Ho;return t.width=Math.ceil(246*this.mScreenScaleX),t.height=Math.ceil(370*t.width/246),t}getActionBarSize(){let t=new Ho;return t.width=Math.ceil(357*this.mScreenScaleX),t.height=Math.ceil(50*t.width/357),t.borderRadius=t.height,t.left=Math.ceil(25*this.mScreenScaleX)/2,t}getGapDistance(t){return Math.ceil(this.mScreenScaleX*t)}getSocialCardDelayTime(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.delayTime}getSocialCardShowTime(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.showTime}getSocialCardStyle(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardStyle}getSocialCardDialogTitle(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardDialogTitle}getSocialCardDialogDescTitle(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardDialogDesc}getSocialCardBgImageUrl(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardBgUrl}getSocialCardTagText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardTag}getSocialCardDescText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardDesc}getSocialCardActionBarText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardActionText}getSocialCardLiveTagText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardLiveTag}getSocialCardMatchTagText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardMatchTag}hasLiveTag(){return Ie(this.getSocialCardLiveTagText())}getSocialPhoneIcon(){return"icon_ksad_social_phone.json"}getCardcloseIconImageSrc(){return"icon_ksad_social_close.png"}getSocialCallLottieSrc(){return"icon_ksad_social_call.json"}getSocialSweepImg(){return"icon_ksad_social_strong_sweep.png"}obtainTagText(t){let e=new Array,i={text:t,url:"",canClick:!1};return e.push(i),e}supportSlideClick(){var t;return(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}logECCardImpression(){let t=new S;t.template_show_type=this.templateShowType;let e={clientExtData:JSON.stringify(t)};pi.exposeElement(191,e)}logCloseReport(t){let e=new S;e.template_show_type=this.templateShowType;let i={elementType:69,adCloseType:t,clientExtData:JSON.stringify(e)};pi.log(141,null,i)}convert(t,e,i,n){let s=new S;return s.template_show_type=this.templateShowType,pi.convertIfNeeded(1,this.callerContext.adInfo,e,t,i,s,n)}}class er extends fn{constructor(){super(),this.hasReportShow=!1,this.lifeStatus="none",this.actionText="",this.isMuted=!1,this.downloadState=0,this.impressionCheckResult=!0,this.hasInteractReward=!1,this.mLifeCycleHelper=new Ia,this.canShowAggregation=!1,this.autoShowStroeKitControl=new va("KSAdAutoStoreKitKey"),this.neoInteractCountController=new va("KSAdNeoIneractCountKey")}getData(t){let e=[];e.push(Ne.getKsAdDataAsync()),e.push(Ne.getDeviceInfoAsync()),e.push(Ne.getKsAdConfigAsync()),e.push(Ne.getContainerLimitAsync()),e.push(Ne.getScreenOrientationAsync()),e.push(ze()),Promise.all(e).then((e=>{try{const i=e[0].data,n=e[2].data,s=e[3].data,a=e[4].data;this.deviceInfo=e[1].data,this.adOriginInfo=i,this.adInfo=i.impAdInfo[0].adInfo[0],this.posId=i.impAdInfo[0].posId,this.adStyle=i.impAdInfo[0].adStyle,this.isMuted=e[5].data.muted||!1,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a.screenOrientation,oe(this.deviceInfo),this.additionalInit(),t&&t(!0)}catch(i){console.log("tkloadcontroller getdata failed:"+i.message+" "+i.stack),t&&t(!1)}}))}additionalInit(){const t={width:this.containerLimit.width-2*this.getSideMargin(),height:this.containerLimit.height-this.getTopMargin()},e={width:this.containerLimit.width,height:this.containerLimit.height};this.callerContext=new Ro(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation,e),this.topBarVM=new Oo(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.shakeVM=new Xo(this.callerContext,3),this.bottomBarVM=new Ja(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation,this.deviceInfo),this.playerVM=new To(this.adInfo,this.adStyle,this.configInfo),this.playableCardVM=new so(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.playableFrontVM=new ao(this.adInfo,this.configInfo),this.playEndCardVM=new yo(this.callerContext,this.adOriginInfo,$a.NEO),this.confirmVM=new Za(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.neoInteractVM=new Pa(this.adInfo,this.adStyle),this.secondclickVM=new Ao(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.topFloorVM=new Do(this.callerContext),this.rotateVM=new go(this.callerContext,$a.NEO,3),this.neoAutoDialogVM=new Fo(this.adInfo,this.containerLimit,this.screenOrientation),this.ecCardViewModel=new jo(this.callerContext),this.gameCardViewModel=new Jo(this.callerContext),this.socialCardViewModel=new tr(this.callerContext),this.interactGestureVM=new io(this.callerContext),this.downloadPopupVM=new Va(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.installActivateVM=new qo(this.callerContext,this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation,6),this.autocallVM=new Zo(this.adInfo,this.adStyle,this.configInfo,12,7),this.liveCouponVM=new Qo(this.callerContext,12),this.isScanAggregation()&&(this.scanAggregationVM=new Mo(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation)),this.pushCardVM=new vo(this.adInfo,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation);Pe.isAndroid()||this.containerLimit.width,Pe.isAndroid()||this.containerLimit.height;this.halfPlayerVM=new to(this.callerContext,this.adOriginInfo);const i=this;this.blockRecorder=new Io((()=>{i.topBarVM.playFinished=!0})),this.topBarVM.isMuted=this.isMuted,this.topBarVM.posId=this.posId,this.playerVM.isMuted=this.isMuted,Di(this.playerVM,this.playerVM.$attrsPath.currentPlaybackTime,(t=>{this.topBarVM.currentPlaybackTime=t,this.playableFrontVM.currentPlaybackTime=t,this.confirmVM.currentPlaybackTime=t,this.halfPlayerVM.currentPlaybackTime=t,this.topFloorVM.currentPlaybackTime=t,this.blockRecorder.updateCurrentPlaybackTime(t)})),Di(this.playerVM,this.playerVM.$attrsPath.playFailed,(t=>{this.topBarVM.playFailed=t,this.halfPlayerVM.playFailed=t})),Di(this.playerVM,this.playerVM.$attrsPath.playFinished,(t=>{this.topBarVM.playFinished=t,this.halfPlayerVM.playFinished=t,this.playEndCardVM.preFormViewModel&&(this.playEndCardVM.preFormViewModel.hasNeo=t)})),Di(this.topBarVM,this.topBarVM.$attrsPath.isMuted,(t=>{this.playerVM.isMuted=t})),Pe.supportMinimumTKVersion("4.0.4")&&Di(this.topBarVM,this.topBarVM.$attrsPath.hasShowPlayend,(t=>{t&&(this.topBarVM.needShowPlayEndCloseBtn=this.topBarVM.isCloseBtnHide()?2:1,console.log("jky needShowPlayEndCloseBtn: "+this.topBarVM.needShowPlayEndCloseBtn))})),Di(this.playerVM,this.playerVM.$attrsPath.playStatus,(t=>{this.blockRecorder.updatePlayerStatus(t)})),Di(this.confirmVM,this.confirmVM.$attrsPath.isShow,(t=>{t?this.playerVM.onDialogShow(this.confirmVM):this.playerVM.onDialogDismiss(this.confirmVM),this.callerContext.pageFocusAndVisible=!t,this.checkVisibleChange(),this.pushCardVM.isPaused=t,this.interactGestureVM.isPaused=t})),_i(this.confirmVM.$attrsPath.hasShowAggCard,(t=>{t&&this.adInfo.adConversionInfo.universeAggreRetainPopUps&&this.adInfo.adConversionInfo.universeAggreEndPage&&0==this.screenOrientation&&(this.playEndCardVM.canShowAggregation=!t)})),Di(this.secondclickVM,this.secondclickVM.$attrsPath.isShow,(t=>{t?this.playerVM.onDialogShow(this.secondclickVM):this.playerVM.onDialogDismiss(this.secondclickVM),this.callerContext.pageFocusAndVisible=!t,this.rotateVM.canRotateConvert=!t,this.pushCardVM.isPaused=t,this.interactGestureVM.isPaused=t})),Di(this.secondclickVM,this.secondclickVM.$attrsPath.needShowBigCard,(t=>{this.bottomBarVM.hasExtraReward=t})),this.registerLifeStatusListener(),this.registerProgressListener(),this.registerSceneChangeListener(),this.registerBackPressedListener()}registerBackPressedListener(){Ne.registerBackPressed((t=>{null!=this.backPressedCallback&&this.backPressedCallback()}))}registerSceneChangeListener(){Ne.registerSceneChangeListener((t=>{t.data&&1==t.data.scene&&(this.topBarVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0)}))}registerProgressListener(){this.updateActionText(this.adInfo.adBaseInfo.adActionDescription||"立即下载"),Pe.isSupportDownloadProgressListen()&&X(this.adInfo)&&Ne.registerProgressListener((t=>{if(this.ecCardViewModel&&this.ecCardViewModel.updateProgressListener(t),console.log("jky KSAdTKBridge.registerProgressListener: param: "+JSON.stringify(t)),t.result){this.playEndCardVM.webViewVM.currentDownloadProgress=t.data;const{status:e,progress:i,totalBytes:n}=t.data;this.callerContext.downloadState=e,this.downloadState=e,this.rotateVM.downloadState=e,this.playEndCardVM.downloadState=e,0==this.installActivateVM.downloadStatus&&6==e&&(this.installActivateVM.hasReportShow=!0),this.installActivateVM.downloadStatus=e;let s=Oa.newInstance(e,i,n);if(this.mLifeCycleHelper.isFocus()&&this.downloadPopupVM.updateDownloadProgress(s),2===e)this.pushCardVM.isShowEnd||(this.pushCardVM.isShowEnd=!0);let a=s;this.bottomBarVM.downloadChangeEvent=a;let o=this.bottomBarVM.downloadChangeEvent.obtainActionButtonText(this.adInfo);this.updateActionText(o)}}))}registerLifeStatusListener(){Ne.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&this.updateLifeStatus(e)}})),Ne.registerFocusListener((t=>{if(t.result&&t.data){const e=t.data.windowFocusEvent;this.mLifeCycleHelper.updateWindowFocusChangeEvent(e),this.playEndCardVM.focusChangeEvent=e,this.installActivateVM.focusChangeEvent=e,this.checkVisibleChange()}}))}isScanAggregation(){if(!Pe.supportMinimumTKVersion("5.0.6"))return!1;try{if(1==this.adOriginInfo.adGlobalConfigInfo.neoPageType)return!0}catch(t){}return!1}updateActionText(t){this.bottomBarVM.actionText=t,this.confirmVM&&this.confirmVM.updateNeoConfirmActionText(t)}updateLifeStatus(t){var e,i,n,s,a;if("showEnd"==t&&!this.hasReportShow){this.hasReportShow=!0;let t=null,o=di.createNeoCommonInstance(this.adInfo);o&&(t={clientExtData:JSON.stringify(o)}),this.isScanAggregation()||pi.expose(t),this.callerContext.componentSwtich&&this.reportPlayCardImpression(),Pe.supportMinimumTKVersion("5.1.1")&&4==this.adInfo.adBaseInfo.aggMidPageAdType&&(this.adInfo.adConversionInfo.universeAggreRetainPopUps||this.adInfo.adConversionInfo.universeAggreEndPage)&&0==this.screenOrientation&&this.requestAggregationAdInfo(),Pe.supportMinimumTKVersion("5.0.1")&&(null===(i=null===(e=this.adInfo.adRewardInfo)||void 0===e?void 0:e.callBackStrategyInfo)||void 0===i?void 0:i.impressionCheckMs)>0&&(null===(n=this.adInfo.adRewardInfo)||void 0===n?void 0:n.rewardTime)>5&&this.topBarVM.isNeedCheck&&this.adInfo.adConversionInfo.callbackUrlInfo&&setTimeout((()=>{this.checkExposure()}),null===(a=null===(s=this.adInfo.adRewardInfo)||void 0===s?void 0:s.callBackStrategyInfo)||void 0===a?void 0:a.impressionCheckMs)}this.mLifeCycleHelper.updateLifecycleStatus(t),this.lifeStatus=t,this.bottomBarVM.lifeStatus=t,this.playerVM.lifeStatus=t,this.confirmVM.lifeStatus=t,this.playEndCardVM.lifeStatus=t,this.scanAggregationVM&&(this.scanAggregationVM.lifeStatus=t),this.pushCardVM.lifeStatus=t,this.callerContext.lifeStatus=t,this.playEndCardVM.preFormViewModel.lifeStatus=t,this.mLifeCycleHelper.updateLifecycleStatus(t),this.checkVisibleChange()}checkVisibleChange(){let t=this.mLifeCycleHelper.isFocusAndVisible();t&&!this.playerVM.isDialogShowing()?(this.callerContext.pageFocusAndVisible=!0,this.rotateVM.canRotateConvert=!0,this.rotateVM.isStartSensor=!0):(this.callerContext.pageFocusAndVisible=!1,this.rotateVM.canRotateConvert=!1,this.rotateVM.isStartSensor=!1),this.neoInteractVM.playPaused=!t,this.neoAutoDialogVM.mPlayPaused=!t}checkExposure(){this.exposeNetwork=new TKNetwork,this.exposeNetwork.isAddCommonParameters=1,this.exposeNetwork.method="POST",this.exposeNetwork.url="/rest/e/v3/open/checkReward";var t=JSON.parse(this.adInfo.adConversionInfo.callbackUrlInfo);t.checkType=1;const e={callbackUrlInfo:JSON.stringify(t),impInfo:[{posId:this.posId,adNum:1,adStyle:2}]};try{var i=JSON.parse(JSON.stringify(this.adInfo.serverExt));be(i)||(delete i._tkmvvm_observed,delete i.nativeID,e.serverExt=i)}catch(s){}this.exposeNetwork.params=e,Ye(1,this.adInfo);const n=ue();this.exposeNetwork.request(((t,e)=>{const i=ue()-n;if(!e)try{const e=JSON.parse(t).data,n=JSON.parse(e);1!=n.result&&(this.topBarVM.impressionCheckResult=!1),Xe(1,this.adInfo,i,n.result,n.errorMsg)}catch(s){}}))}requestAggregationAdInfo(){this.aggNetwork=new TKNetwork,this.aggNetwork.isAddCommonParameters=1,this.aggNetwork.method="POST",this.aggNetwork.url="/rest/e/v3/open/univ";const t={impInfo:[{posId:this.posId,adNum:1,adStyle:2}],aggregateRequestType:4,aggMidPageExcludeCreativeIds:[this.adInfo.adBaseInfo.creativeId]};try{var e=JSON.parse(JSON.stringify(this.adInfo.serverExt));be(e)||(delete e._tkmvvm_observed,delete e.nativeID,t.serverExt=e)}catch(i){}this.aggNetwork.params=t,Ye(1,this.adInfo),this.aggNetwork.request(((t,e)=>{if(!e)try{const e=JSON.parse(t).data,i=JSON.parse(e);this.adInfo.adConversionInfo.universeAggreRetainPopUps&&(this.confirmVM.aggregationCardVM.adResult=i,this.confirmVM.canShowAggregation=!0),this.adInfo.adConversionInfo.universeAggreEndPage&&(this.playEndCardVM.aggregationCardVM.adResult=i,this.playEndCardVM.canShowAggregation=!0),1!=i.result&&(this.playEndCardVM.canShowAggregation=!1,this.confirmVM.canShowAggregation=!1)}catch(i){this.playEndCardVM.canShowAggregation=!1,this.confirmVM.canShowAggregation=!1}}))}showPlayEnd(){this.updateLifeStatus("showEnd"),this.topBarVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0}getSideMargin(){return Ce()&&1==this.screenOrientation?48:0}getTopMargin(){return 0==this.screenOrientation&&Ce()?48:20}getVideoDuration(){let t=0;try{let e=this.adInfo;const i=e.adMaterialInfo.materialFeature.length>0?e.adMaterialInfo.materialFeature[0]:null;i&&(t=i.videoDuration,0==t&&(t=i.videoDurationMs/1e3))}catch(e){}return t}checkDataValid(){return!!this.adInfo}setNeedCloseNeo(){Ne.needCloseNeo(!0)}handleGiftClick(){pi.convertIfNeeded(1,this.adInfo,2,{x:0,y:0},t.PLAY_END_GIFT_CLICK)}handleClose(t){yt(this.adInfo)&&pi.reportLivePlaySecond(this.playerVM.currentPlaybackTime),Ne.closeVideo(t)}updateExtraGivenStatus(){this.secondclickVM.hasClickBefore?this.playEndCardVM.webViewVM.extraGivenStatus=2:this.secondclickVM.hasExtraGiven?this.playEndCardVM.webViewVM.extraGivenStatus=1:this.playEndCardVM.webViewVM.extraGivenStatus=3}showShakeAndRotateDirectlyAtBottom(){return this.topFloorVM.enableShowGiftBoxView()}isValidPlayable(){return At(this.adInfo,this.screenOrientation)}isPlayableRenderSuccess(){return this.playableCardVM.playableVM.renderSuccess}playableOrientationNotMatch(){try{if(!Ie(this.adInfo.adConversionInfo.playableUrl))return!1;const t=this.adInfo.adConversionInfo.playableStyleInfo.playableOrientation;if(0==this.screenOrientation&&2==t||1==this.screenOrientation&&1==t)return!0}catch(t){}return!1}canShowNeoInteract(){if(1==this.screenOrientation)return!1;let t=function(t){let e=gt(t);if(Dt(t)+_t(t)>e)return!1;try{return t.adStyleConfInfo.rewardVideoInteractSwitch&&!be(t.adMatrixInfo.adDataV2.rewardVideoInteractInfo.templateId)}catch(i){return!1}}(this.adInfo);if(!t)return!1;let e=function(t){try{let e=t.adMatrixInfo.adDataV2.rewardVideoInteractInfo.intervalShow;return be(e)||e<0?3:e}catch(e){return 3}}(this.adInfo);if(0==e)return!0;let i=function(t){try{let e=t.adMatrixInfo.adDataV2.rewardVideoInteractInfo.dayMaxLimit;return be(e)||e<0?2:e}catch(e){return 2}}(this.adInfo),n=this.neoInteractCountController.getCurrentCount();return!(n>i)&&(t&&n%(e+1)==0)}saveInteractCurrentCount(){this.neoInteractCountController.increaseCurrentCount()}canAutoShowH5LandingPage(){try{return 1!=this.adInfo.adBaseInfo.adOperationType&&this.adInfo.adConversionInfo.h5Url.length>0&&0==this.adInfo.adConversionInfo.deeplinkUrl.length&&!Pe.isAndroid()&&this.adInfo.adRewardInfo.showLandingPage&&!this.isClickReward()}catch(t){}return!1}autoShowH5LandingPage(){Ne.showLandingPage(!0)}canAutoShowAndroidMarket(){if(!Pe.supportMinimumTKVersion("5.0.9"))return!1;try{const t=this.adInfo.adBaseInfo.appPackageName;if(Pe.isAndroid()&&X(this.adInfo)&&this.adInfo.adConversionInfo.autoJumpAppMarketSwitch&&!_a.isPkgInstalled(t))return!0}catch(t){}return!1}openAppMarket(){pi.reportClick(this.adInfo,null,{itemClickType:t.AUTO_CLICK_OTHER_AREA,renderContainer:1,triggerType:8});let e=new hi(this.adOriginInfo,this.deviceInfo,this.configInfo);Ea.openMiAppStore(e,(t=>{t||Ea.openAppMarket(e,(t=>{}))}))}canAutoShowStoreKit(){try{if(!Pe.isAndroid()&&X(this.adInfo)&&this.adInfo.adConversionInfo.appDownloadUrl.length>0&&this.adInfo.adConversionInfo.autoJumpStoreKitSwitch&&!this.isClickReward())return!0}catch(t){}return!1}autoShowStoreKit(){pi.convertIfNeeded(1,this.adInfo,1,{x:0,y:0},t.NEO_AUTO_SHOW_STOREKIT)}isClickReward(){return vt(this.adInfo)}hasAutoDialog(){return K.hasNeoAutoDialog(this.adInfo)}isSlideEnable(){var t,e;return!!(null===(e=null===(t=this.adInfo)||void 0===t?void 0:t.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===e?void 0:e.slideClick)}getRewardPlayerStyle(){try{return 11==this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType&&this.halfPlayerVM.shouldShowHalfPlayer()?2:1}catch(t){}return 1}reportPlayEndImpression(){let t=new S;if((this.canAutoShowAndroidMarket()||this.canAutoShowStoreKit())&&(t.universe_feature_freq=16),this.callerContext.componentSwtich){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.endCardInfo.pageId,combination_id:e.endCardInfo.combinationIds};t.template_show_type="combination",t.component_module=JSON.stringify(i)}let e={elementType:87,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}reportPlayCardImpression(){let t=new S;if(this.callerContext.componentSwtich){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds};t.component_module=JSON.stringify(i)}let e={elementType:244,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}}class ir extends TKView{constructor(){super(),this.setupViews()}setupViews(){this.style={width:137,height:24,borderRadius:12,borderColor:"#FFFBD799",borderWidth:.5,backgroundColor:"#EB003866"},this.infoText=new TKText,this.infoText.style={width:"100%",height:"100%",fontSize:14,fontWeight:"500",color:"#FFFDE8",textAlign:"center"},this.appendChild(this.infoText)}bindViewModel(t){this.vm||(this.vm=t,Di(this.vm,this.vm.$attrsPath.countDownTime,(t=>{this.infoText.setText("浏览"+t+"s可领奖励")})),Di(this.vm,this.vm.$attrsPath.hasCallbackGift,(t=>{t&&this.infoText.setText("已获得奖励")})))}}class nr extends TKView{constructor(){super()}updateDatas(t){}}class sr extends TKView{constructor(){super(),this.setupViews()}setupViews(){this.style={width:"100%",flexDirection:"column"};let e=new TKView;e.style={width:"100%",height:48,borderRadius:25,backgroundColor:"#FE3666",flexDirection:"row",justifyContent:"center",alignItems:"center"},this.appendChild(e),e.addEventListener("tap",(e=>{this.vm&&this.vm.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)}));let i=new vn;i.style={marginLeft:2,justifyContent:"center",transform:{scale:1.2}},i.setLineSize(8,1),e.appendChild(i),this.desView=new TKText,this.desView.style={height:23,textLineSpace:1,fontSize:15,color:"#FFFFFF",backgroundColor:"#FE3666",marginStart:3},e.appendChild(this.desView)}updateDatas(e){this.vm=e,this.addEventListener("tap",(e=>{this.vm&&this.vm.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.desView.setText(this.vm.getActionDataDesc())}}class ar extends TKView{constructor(t,e){super(),this.vm=t,this.videoData=e,this.setupViews()}setupViews(){var t;this.style={width:"100%",height:122,marginTop:4,borderRadius:4};let e=new TKImage;e.style={width:"100%",height:122,borderRadius:4,backgroundColor:"#FE3666"},e.setSrc(null===(t=this.videoData)||void 0===t?void 0:t.imageUrl),this.appendChild(e),this.priceText=new TKText,this.priceText.style={width:"100%",paddingTop:8,paddingStart:8,paddingBottom:4,fontSize:15,position:"absolute",bottom:0,bottomRightRadius:4,bottomLeftRadius:4,color:"#FFFFFF",gradientBgColor:"90, #00000080 0, #00000000 1"},this.priceText.setText(" "+this.videoData.price),this.appendChild(this.priceText)}setPriceVis(t){t?this.priceText.setVisibility("visible"):this.priceText.setVisibility("hidden")}}class or extends TKView{constructor(e){super(),this.vm=e,this.setupViews(),this.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)}))}setupViews(){var t,e,i;if(this.style={width:"100%",height:"100%",paddingStart:6,flexDirection:"column"},this.liveCartInfoList=null===(e=null===(t=this.vm.videoLiveData)||void 0===t?void 0:t.neoLiveCartDetailData)||void 0===e?void 0:e.liveCartInfoList,this.liveCartInfoList){let t=null===(i=this.liveCartInfoList)||void 0===i?void 0:i.length;t<=2&&(this.style={alignItems:"center",justifyContent:"center"}),t>2?this.addShopItem():2==t?(this.addShopItem(),this.addTwoItem()):(this.addShopItem(),this.addOneItem())}else this.setFinishView()}addShopItem(){let e=!1,i=this.liveCartInfoList.length>3?3:this.liveCartInfoList.length;for(let n=0;n<i;n++){let s=new ar(this.vm,this.liveCartInfoList[n]);e||(s.style={width:"100%",height:122,marginTop:0}),this.appendChild(s),s.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),e=!0,1==i&&s.setPriceVis(!1)}}addOneItem(){let t=new TKView;t.style={width:100,height:100,marginTop:8,alignItems:"center"};let e=new TKImage;e.style={width:122,height:60},e.setSrc("image/ksad-video-image/scan_aggregation/neo_live_shop_one.png");let i=new TKText;i.style={marginTop:8,color:"#000000",fontSize:15,textLineClamp:2,textAlign:"center",fontWeight:"500"},i.setText(this.liveCartInfoList[0].title);let n=new TKText;n.style={marginTop:2,marginStart:36,position:"absolute",color:"#FFFFFF",fontWeight:"500"},n.setText(this.liveCartInfoList[0].price),this.appendChild(i),this.appendChild(t),t.appendChild(e),t.appendChild(n)}addTwoItem(){let e=new TKView;e.style={width:122,height:122,marginTop:4,backgroundColor:"#EBECEF",borderRadius:4,alignItems:"center",justifyContent:"center"};let i=new TKText;i.setText("点击查看");let n=new TKText;n.setText("更多商品"),e.appendChild(i),e.appendChild(n),this.appendChild(e),e.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}))}setFinishView(){var e;if((null===(e=this.liveCartInfoList)||void 0===e?void 0:e.length)>0)return;let i=new TKView;i.style={width:"100%",height:"100%",borderRadius:4,position:"absolute",alignItems:"center",flexDirection:"column"};let n=new TKView;n.style={width:"100%",height:"100%",alignItems:"center"};let s=new TKImage;s.style={height:48,width:48,borderRadius:24,marginTop:125},s.setSrc(N(this.vm.adInfo)),s.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),n.appendChild(s);let a=new TKText;a.style={color:"#000000",fontSize:15,maxWidth:100,textLineSpace:2,textAlign:"center",marginTop:8,fontWeight:"500"},a.setText(J(this.vm.adInfo)),n.appendChild(a),n.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));let o=new TKView;o.style={height:20,marginTop:13,flexDirection:"row",justifyContent:"center",alignItems:"center"};let r=this.vm.getLabelList();if(!be(r)){const t=r.length>2?2:r.length;for(let e=0;e<t;e++){let t=new TKText;t.style={height:18,maxWidth:60,color:"#FE3666",backgroundColor:"#FE36661A",borderRadius:4,marginStart:4,padding:4,textAlign:"center",fontSize:10,textLineClamp:1},t.setText(r[e].toString()),o.appendChild(t)}}o.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));let h=new TKView;h.style={width:"100%",height:"100%",backgroundColor:"#FFFFFF",position:"absolute",borderRadius:4},i.appendChild(h),i.appendChild(n),n.appendChild(o),this.appendChild(i)}}class rr extends ra{constructor(t){super(t,"LivePlayerCallbacks"),this.mOnProgressCallback=(t,e,i)=>{this.isEnable()&&(this.liveVM.timerPaused||(ri().emit(r,{currentTime:t,avaliableTime:e,totalTime:i}),this.vm.updateVideoProgress(t,e,i),pi.updateLivePlayStatus("progress",0,"",1e3*t)))},this.mOnLiveShopInfoCallback=t=>{if(!this.isEnable())return;let e=JSON.parse(t);var i;be(e)||(this.liveVM.shopCardChangeType=e.changeType),be(e)||1!=e.shopCardType||(this.liveVM.currentProductInfo=e.itemInfo,i=this.liveVM.currentProductInfo,Ne.callNativeWithCallback("updateLiveCurrentShopInfo",i))},this.mOnLiveEndCallback=t=>{this.isEnable()&&this.mOuterLiveEndCallback&&this.mOuterLiveEndCallback(t)},this.mOnLiveMessageDataCallback=t=>{if(!this.isEnable())return;let e=JSON.parse(t);this.liveVM.liveMessage=e},this.liveVM=t}}class hr{constructor(t,e,i){this.mEnableRollbackToImage=!1,this.liveEndTimer=0,this.liveEndProgress=1,this.totalCountTime=-1,this.vm=t,this.liveVideoCardVM=e,this.mEnableRollbackToImage=i}static wrapInitLivePlayer(t,e,i){t&&(Pe.supportMinimumTKVersion("6.0.1")?t.initWithUserInfo(e,""+K.getAuthorId(i),K.getLiveStreamId(i),K.getLiveServiceToken(i),K.getLiveUserId(i)):t.initAdLivePlayer(e,""+K.getAuthorId(i),K.getLiveStreamId(i)))}setupPlayer(t,e,i){if(this.mEnableRollbackToImage){let e=Qt(de());this.mTimeoutHelper=new oa(e),this.mTimeoutHelper.startTimeoutCallback=()=>{this.rollbackToImage(t)}}Pe.supportMinimumTKVersion("5.0.0")&&(this.mRealPlayer=new TKLivePlayer,this.mRealPlayer.style={width:i?"100%":e,height:"100%"},this.mLivePlayerCallbacks=new rr(this.vm),this.mLivePlayerCallbacks.mOuterFirstFrameCallback=()=>{this.setMuted(this.vm.isMuted),this.mTimeoutHelper&&this.mTimeoutHelper.onFirstFrame(),re(la.LIVE)},this.initLivePlayer(t,this.mRealPlayer,this.mLivePlayerCallbacks),this.mTimeoutHelper&&this.mTimeoutHelper.onPlayerPrepare())}rollbackToImage(t){let e=this.mRealPlayer;this.mLivePlayerCallbacks.destroy(),this.mLivePlayerCallbacks=null,this.mRealPlayer=new ca,this.mImagePlayerCallbacks=new ra(this.vm,"ImagePlayerCallbacks"),ha.initImagePlayer(t,this.vm,this.mRealPlayer,this.mImagePlayerCallbacks),this.mRealPlayer.play(),t.replaceChild(hr.obtainPlayerView(this.mRealPlayer),hr.obtainPlayerView(e)),e.stop(),e=null,this.vm.onDowngrade()}static obtainPlayerView(t){return t instanceof TKLivePlayer?t:t instanceof ca?t.getView():null}initLivePlayer(t,e,i){t.appendChild(e),hr.wrapInitLivePlayer(e,this.vm.deviceInfo.appId,this.vm.adInfo),e.setOnMuteChange((t=>{this.liveVideoCardVM.topBarVM.isMuted=t})),e.setForceGetAudioFocus(this.vm.configInfo.appConfig.forceGetAudioFocus),e.setOnFirstFrame(i.mOnFirstFrameCallback),e.setOnFailed(i.mOnFailedCallback),e.setOnLiveShopInfo(i.mOnLiveShopInfoCallback),e.setOnProgress(i.mOnProgressCallback),e.setOnFinish(i.mOnFinishCallback),i.mOuterLiveEndCallback=t=>{setTimeout((()=>{let e=JSON.parse(t);this.vm.livePushEndInfo=e,this.vm.isLiveEnd=!0,this.startLiveEndTimer()}),300)},e.setOnLiveEnd(i.mOnLiveEndCallback),e.setOnLiveMessageData(i.mOnLiveMessageDataCallback)}startLiveEndTimer(){this.stopLiveEndTimer(),this.liveEndTimer=setInterval((()=>{this.vm.timerPaused||(this.vm.updateVideoProgress(this.liveEndProgress,0,0),this.liveEndProgress==this.totalCountTime&&this.vm.isLiveEnd&&this.vm.videoPlayFinished(),this.liveEndProgress++)}),1e3)}stopLiveEndTimer(){this.liveEndTimer&&clearInterval(this.liveEndTimer),this.liveEndTimer=0}pause(){var t;this.vm.timerPaused=!0,null===(t=this.mRealPlayer)||void 0===t||t.pause()}resume(){var t;this.vm.timerPaused=!1,null===(t=this.mRealPlayer)||void 0===t||t.resume()}stop(){var t;this.vm.timerPaused=!0,null===(t=this.mRealPlayer)||void 0===t||t.stop()}setMuted(t){this.mRealPlayer instanceof TKLivePlayer&&this.mRealPlayer.setMuted&&this.mRealPlayer.setMuted(t)}}class lr extends TKView{constructor(){super(),this.style={backgroundColor:"#000000",borderRadius:4},Pe.supportMinimumTKVersion("5.0.0")&&(this.livePlayView=new TKLivePlayer,this.livePlayView.style={width:"100%",height:"100%",borderRadius:4,position:"absolute"},this.appendChild(this.livePlayView)),this.setupLiveCoverView(),this.setClickContainer()}setClickContainer(){this.clickContainer=new TKView,this.clickContainer.style={width:"100%",height:"100%",position:"absolute"},this.appendChild(this.clickContainer)}initLivePlayer(e){this.vm=e,Pe.supportMinimumTKVersion("5.0.0")&&(hr.wrapInitLivePlayer(this.livePlayView,le().appId,this.vm.adInfo),this.livePlayView.setMuted(!0)),this.setupCallback(),this.setupFollowView(),this.addEventListener("tap",(e=>{this.vm&&this.vm.convert(3,{x:e.position.rawX,y:e.position.rawY},t.CARD_PAGE_CLICK)})),this.initSoundView(),this.bindview()}setupLiveCoverView(){this.style={width:"100%",height:"100%",borderRadius:4},this.setupLiveImgView(this.vm)}setupLiveImgView(t){this.liveImgContainer=new TKView,this.liveImgContainer.style={width:"100%",height:"100%",borderRadius:4},this.appendChild(this.liveImgContainer);let e=new vs(15);e.style={right:-10,bottom:16,width:50,height:170,position:"absolute",opacity:1},e.startAnimation(),this.liveImgContainer.appendChild(e);let i=new TKImage;i.style={height:28,width:28,right:8,bottom:8,position:"absolute"},i.setSrc("image/ksad-video-top-bar/icon_ksad_confirm_live.png"),this.liveImgContainer.appendChild(i)}setupCallback(){this.livePlayView&&Pe.supportMinimumTKVersion("5.0.0")&&(this.livePlayView.setOnFirstFrame((()=>{this.vm&&(this.vm.isPlaying||this.livePlayView.pause())})),this.livePlayView.setOnFinish((()=>{})),this.livePlayView.setOnProgress(((t,e,i)=>{})),this.livePlayView.setOnMuteChange((t=>{})),this.livePlayView.setOnFailed((()=>{this.vm&&(this.vm.isFinishLive=!0)})),this.livePlayView.setOnLiveEnd((t=>{this.vm.isFinishLive=!0})),this.livePlayView.setOnLiveShopInfo((t=>{})),this.livePlayView.setOnLiveMessageData((t=>{})))}setFinishView(){let t=new TKView;t.style={width:"100%",height:"100%",borderRadius:4,position:"absolute",alignItems:"center"};let e=new TKBlurImage;e.style={width:"100%",height:"100%",borderRadius:4,position:"absolute"};let i=new TKView;i.style={width:"100%",height:"100%",alignItems:"center"};let n=new TKText;n.style={color:"#FFFFFF",fontSize:14,marginTop:100},n.setText("直播已结束"),i.appendChild(n);let s=new TKImage;s.style={height:48,width:48,borderRadius:24,marginTop:38},s.setSrc(N(this.vm.adInfo)),i.appendChild(s);let a=new TKText;a.style={color:"#FFFFFF",fontSize:14,maxWidth:100,textLineSpace:2,textAlign:"center",marginTop:8},a.setText(J(this.vm.adInfo)),i.appendChild(a);let o=new TKView;o.style={width:"100%",height:"100%",backgroundColor:"#000000B3",position:"absolute",borderRadius:4},e.setBlurRadius(10),e.setSrc(j(this.vm.adInfo.adMaterialInfo.materialFeature[0])),t.appendChild(e),t.appendChild(o),t.appendChild(i),this.appendChild(t)}setupFollowView(){this.fansInfoContainer=new TKView,this.fansInfoContainer.style={top:8,left:8,backgroundColor:"#30303099",height:24,borderRadius:12,paddingEnd:6,position:"absolute",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.liveImgContainer.appendChild(this.fansInfoContainer);let t=new jn(this.vm.adInfo,20,3);t.style={width:64,height:20},this.fansInfoContainer.appendChild(t),this.fansInfoText=new TKText,this.fansInfoText.style={flexShrink:1,height:"100%",color:"#FFFFFFFC",fontSize:10,textLineClamp:1,textAlign:"center",includeFontPadding:!1},this.fansInfoText.setText(this.vm.getLivenNumber()),this.fansInfoContainer.appendChild(this.fansInfoText)}initSoundView(){this.soundView=new Ei,this.soundView.style={width:24,height:24,position:"absolute",top:8,right:8,borderRadius:12,borderWidth:1,borderColor:"#FFFFFF33",backgroundColor:"#30303099"},this.soundView.setImageSize({width:18,height:18}),this.liveImgContainer.appendChild(this.soundView),this.soundView.addEventListener("tap",(t=>{ri().emit(d,{})}))}bindview(){Di(this.vm,this.vm.$attrsPath.isMute,(t=>{this.livePlayView&&Pe.supportMinimumTKVersion("5.0.0")&&this.livePlayView.setMuted(t),t?this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_mute.png"):this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_sound.png")}))}resume(){this.livePlayView&&Pe.supportMinimumTKVersion("5.0.0")&&(this.livePlayView.resume(),this.vm&&(this.vm.isMute?this.livePlayView.setMuted(!0):this.livePlayView.setMuted(!1)))}pause(){this.livePlayView&&Pe.supportMinimumTKVersion("5.0.0")&&this.livePlayView.pause()}stop(){this.livePlayView&&Pe.supportMinimumTKVersion("5.0.0")&&this.livePlayView.stop()}setMuted(t){this.livePlayView&&Pe.supportMinimumTKVersion("5.0.0")&&this.livePlayView.setMuted(t)}}class dr extends nr{constructor(){super(),this.setupViews()}setupViews(){this.style={width:"100%",height:"100%",paddingBottom:12,paddingRight:12,paddingLeft:12},this.baseRadiusContainer=new TKView,this.baseRadiusContainer.style={width:"100%",height:490,padding:8,backgroundColor:"#FFFFFF",borderRadius:8,flexDirection:"column"},this.appendChild(this.baseRadiusContainer);let e=new TKView;e.style={width:"100%",height:416,flexDirection:"column"};let i=new TKView;i.style={width:"100%",height:373,flexDirection:"row"},e.appendChild(i),this.baseRadiusContainer.appendChild(e),this.leftView=new TKView,this.leftView.style={width:"65%",height:373},this.liveDetailView=new lr,this.leftView.appendChild(this.liveDetailView),i.appendChild(this.leftView),this.rightView=new TKView,this.rightView.style={width:"35%",height:373},i.appendChild(this.rightView),this.desView=new TKText,this.desView.style={marginTop:12,textLineSpace:1,fontSize:15,color:"#222222",fontWeight:"400"},this.desView.addEventListener("tap",(e=>{this.vm&&this.vm.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_RECOMMEND_REASON_CLICK)})),e.appendChild(this.desView),this.bottomView=new TKView,this.bottomView.style={width:"100%"},this.actionView=new sr,this.bottomView.appendChild(this.actionView),this.baseRadiusContainer.appendChild(this.bottomView),this.clickContainer=new TKView,this.clickContainer.style={width:"100%",height:"100%",position:"absolute"},this.appendChild(this.clickContainer)}updateDatas(t){if(!this.vm){this.vm=t,Di(this.vm,this.vm.$attrsPath.isFinishLive,(t=>{t&&(this.liveDetailView.setFinishView(),this.liveDesView&&this.liveDesView.setFinishView())})),Di(this.vm,this.vm.$attrsPath.isPlaying,(t=>{t?this.liveDetailView&&this.liveDetailView.resume():this.liveDetailView&&this.liveDetailView.pause()})),Di(this.vm,this.vm.$attrsPath.isPlayFreed,(t=>{t&&this.liveDetailView&&this.liveDetailView.stop()}));let e=ot(this.vm.adInfo,12);this.vm.videoLiveData=JSON.parse(e.data),this.liveDesView=new or(this.vm),this.rightView.appendChild(this.liveDesView),this.liveDetailView.initLivePlayer(t),this.actionView.updateDatas(t),this.desView.setText(this.vm.getLiveStatDataDesc())}}}class cr extends nr{constructor(){super(),this.setupViews(),this.addBaseAction()}setupViews(){this.style={width:"100%",paddingLeft:12,paddingRight:12,paddingBottom:12},this.contentView=new TKView,this.contentView.style={width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:16,borderRadius:8,backgroundColor:"#FFFFFF",flexDirection:"column"},this.appendChild(this.contentView),this.initPlayer(),this.initInfoView(),this.initActionBar(),this.initSoundView(),this.addEventListener("tap",(e=>{this.vm&&this.vm.convert(3,{x:e.position.rawX,y:e.position.rawY},t.CARD_PAGE_CLICK)}))}initPlayer(){this.player=new TKVideoPlayer,this.player.setEnableCache(!0),this.player.style={width:"100%",borderRadius:ye()?8:4},this.contentView.appendChild(this.player),this.player.setOnFailed(((t,e)=>{})),this.player.setOnFinish((()=>{this.replayVideo()})),this.player.setOnProgress(((t,e,i)=>{this.vm.updateVideoProgress(t)})),this.player.setOnFirstFrame((()=>{this.vm&&(this.vm.isFirstPlay=!1)}))}replayVideo(){Pe.supportMinimumTKVersion("5.0.5")&&(this.player.replay(),ye()||this.player.play(),this.vm&&this.vm.reportVideoReplay())}initSoundView(){this.soundView=new Ei,this.soundView.style={width:24,height:24,position:"absolute",top:16,right:16,borderRadius:12,borderWidth:1,borderColor:"#FFFFFF33",backgroundColor:"#30303099"},this.soundView.setImageSize({width:18,height:18}),this.contentView.appendChild(this.soundView),this.soundView.addEventListener("tap",(t=>{ri().emit(d,{})}))}initInfoView(){this.infoContainer=new TKView,this.infoContainer.style={width:"100%",flexGrow:1,flexDirection:"row",alignItems:"center"},this.contentView.appendChild(this.infoContainer),this.iconView=new TKImage,this.iconView.style={width:48,height:48,borderRadius:12},this.infoContainer.appendChild(this.iconView),this.infoRightContainer=new TKView,this.infoRightContainer.style={height:48,width:"100%",flexShrink:1,flexDirection:"column",justifyContent:"space-between",paddingLeft:8,paddingRight:8,paddingBottom:4,paddingTop:2},this.infoContainer.appendChild(this.infoRightContainer),this.titleText=new TKText,this.titleText.style={width:"100%",height:19,fontSize:15,fontWeight:"500",color:"#222222"},this.infoRightContainer.appendChild(this.titleText),this.descText=new TKText,this.descText.style={width:"100%",height:14,fontSize:12,color:"#222222"},this.infoRightContainer.appendChild(this.descText)}initActionBar(){this.actionBtn=new TKButton,this.actionBtn.style={fontSize:15,fontWeight:"500",color:"#FFFFFF",backgroundColor:"#FE3666",borderRadius:24,height:48,width:"100%"},this.contentView.appendChild(this.actionBtn)}refreshViews(){if(!this.vm)return;const t=0==this.vm.index?this.vm.itemHeight-131:this.vm.itemHeight;if(this.style={height:t},this.player.style={height:this.vm.playerHeight},this.vm.isVerticalMaterial()&&(this.blurBg||(this.blurBg=new TKBlurImage,this.blurBg.style={position:"absolute",left:8,top:8,width:"100%",height:this.vm.playerHeight,borderRadius:4},ye()?this.blurBg.setBlurRadius(15):this.blurBg.setBlurRadius(10),this.blurBg.setSrc(this.vm.getVideoFirstFrame()),this.contentView.insertBefore(this.blurBg,this.player))),this.coverImage||(this.coverImage=new TKImage,this.coverImage.style={borderRadius:this.vm.isVerticalMaterial()?0:4,width:this.vm.playerHeight*(this.vm.isVerticalMaterial()?9/16:16/9),height:this.vm.playerHeight,resize:"contain",position:"absolute",alignSelf:"center",top:8},this.coverImage.enabled=!1,this.contentView.insertBefore(this.coverImage,this.player),this.coverImage.setSrc(this.vm.getVideoFirstFrame())),this.iconView.setSrc(this.vm.getAdIcon()),this.titleText.setText(this.vm.getAdTitle()),this.descText.setText(this.vm.getAdDescription()),this.actionBtn.setText(this.vm.getAdActionDesc()),this.vm.isMute?this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_mute.png"):this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_sound.png"),ye()&&this.vm.isApp()&&!this.privacyView&&this.vm.itemType==F.videoAd){const t=.9*(this.vm.containerLimit.width-70)-8;this.privacyView=new Sn(this.vm.adInfo,this.vm.screenOrientation,t,"#FFFFFF00","#FFFFFF","1 1 1 #0000004D"),this.privacyView.style={position:"absolute",width:"90%",left:8,top:8},this.privacyView.clickCallback=(t,e)=>{Ne.openURL(t,e)},this.contentView.appendChild(this.privacyView)}}updateDatas(t){this.vm||(this.vm=t,this.player.setURL(this.vm.getVideoURL()),this.player.prepareToPlay(),Di(this.vm,this.vm.$attrsPath.isPlaying,(t=>{t?(this.player.setMuted(this.vm.isMute),this.vm.isFirstPlay?this.player.play():ye()?this.player.resume():this.player.play()):this.player.pause()})),Di(this.vm,this.vm.$attrsPath.isMute,(t=>{this.player&&this.player.setMuted(t),t?this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_mute.png"):this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_sound.png")})),Di(this.vm,this.vm.$attrsPath.isPlayFreed,(t=>{t&&this.player&&this.player.stop()}))),this.refreshViews()}addBaseAction(){this.player.addEventListener("tap",(e=>{this.vm&&this.vm.convert(3,{x:e.position.rawX,y:e.position.rawY},t.CARD_PAGE_CLICK)})),this.iconView.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.descText.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),this.infoContainer.addEventListener("tap",(e=>{this.vm&&this.vm.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_OTHERAREA_CLICK)})),this.actionBtn.addEventListener("tap",(e=>{this.vm&&this.vm.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)}))}}class pr extends cr{setupFollowView(){this.fansInfoContainer=new TKView,this.fansInfoContainer.style={top:16,left:16,backgroundColor:"#30303099",height:24,borderRadius:12,position:"absolute",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.contentView.appendChild(this.fansInfoContainer);let t=new jn(this.vm.adInfo,20,3);t.style={width:64,height:20,marginLeft:3},this.fansInfoContainer.appendChild(t),this.fansInfoText=new TKText,this.fansInfoText.style={flexShrink:1,marginRight:8,height:"100%",color:"#FFFFFFFC",fontSize:10,textLineClamp:1,textAlign:"center",includeFontPadding:!1},this.fansInfoText.setText(this.vm.getFansCount()),this.fansInfoContainer.appendChild(this.fansInfoText)}updateDatas(t){this.vm||(this.vm=t,this.player.setURL(this.vm.getVideoURL()),this.player.prepareToPlay(),Di(this.vm,this.vm.$attrsPath.isPlaying,(t=>{t?(this.player.setMuted(this.vm.isMute),this.vm.isFirstPlay?this.player.play():ye()?this.player.resume():this.player.play()):this.player.pause()})),Di(this.vm,this.vm.$attrsPath.isMute,(t=>{this.player&&this.player.setMuted(t),t?this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_mute.png"):this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_sound.png")})),Di(this.vm,this.vm.$attrsPath.isPlayFreed,(t=>{t&&this.player&&this.player.stop()})),this.showFansInfo()),this.refreshViews()}showFansInfo(){this.vm.adInfo&&this.setupFollowView(),this.iconView.style={borderRadius:24},this.infoRightContainer.style={paddingTop:4}}}class mr extends cr{updateDatas(t){this.vm||(this.vm=t,this.player.setURL(this.vm.getVideoURL()),this.player.prepareToPlay(),Di(this.vm,this.vm.$attrsPath.isPlaying,(t=>{t?(this.player.setMuted(this.vm.isMute),this.vm.isFirstPlay?this.player.play():ye()?this.player.resume():this.player.play()):this.player.pause()})),Di(this.vm,this.vm.$attrsPath.isMute,(t=>{this.player&&this.player.setMuted(t),t?this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_mute.png"):this.soundView.setImageSrc("image/ksad-video-top-bar/icon_ksad_sound.png")})),Di(this.vm,this.vm.$attrsPath.isPlayFreed,(t=>{t&&this.player&&this.player.stop()})),this.showGoodsInfo()),this.refreshViews()}showGoodsInfo(){if(this.iconView.style={width:78,height:78,borderRadius:3},this.vm.showGoodsPrice()){this.infoRightContainer.style={height:78},this.descText.style={visibility:"hidden"};let t=new TKImage;t.style={width:232,height:34,position:"absolute",bottom:17,left:15},t.setSrc("image/ksad-video-image/scan_aggregation/scan_aggregation_video_goods.png"),this.infoRightContainer.appendChild(t);let e=new TKText;e.style={width:70,height:13,fontSize:10,color:"#666666",position:"absolute",left:0,bottom:2,textAlign:"center"},this.infoRightContainer.appendChild(e),e.setText("￥"+this.vm.getGoodsOriginPrice());let i=new TKView;i.style={width:65,height:21,position:"absolute",left:100,top:28,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.infoRightContainer.appendChild(i);let n=new TKText;n.style={height:"100%",fontSize:10,fontWeight:"500",color:"#FFFFFF",textAlign:"center"},i.appendChild(n),n.setText("￥");let s=new TKText;s.style={height:"100%",fontSize:15,fontWeight:"500",color:"#FFFFFF",textAlign:"center"},i.appendChild(s),s.setText(this.vm.getGoodsPrice());let a=new TKText;a.style={width:44,height:14,fontSize:10,color:"#FE3665",textAlign:"center",position:"absolute",left:112,bottom:2},a.setText("限时低价"),this.infoRightContainer.appendChild(a)}}}class gr extends nr{constructor(){super(),this.setupViews()}setupViews(){this.style={width:"100%"},this.sceneBg=new TKImage,this.sceneBg.style={width:"100%"},ke(this.sceneBg,"scan_aggregation_bg2.png"),this.appendChild(this.sceneBg),this.topTitleBg=new TKImage,this.topTitleBg.style={width:170,height:36,position:"absolute",alignSelf:"center",top:50},ke(this.topTitleBg,"scan_aggregation_top_title.png"),this.appendChild(this.topTitleBg),this.topInfo=new ir,this.topInfo.style={position:"absolute",alignSelf:"center",top:93},this.appendChild(this.topInfo)}updateDatas(t){if(!this.vm){this.vm=t,this.style={height:t.itemHeight};let e=.605*this.vm.containerLimit.width;if(this.sceneBg.style={height:e},2==this.vm.materialType)this.contentView=new dr;else switch(t.itemType){case F.videoPromoteGoods:this.contentView=new mr;break;case F.videoPromoteFollow:this.contentView=new pr;break;default:this.contentView=new cr}this.contentView.style={width:"100%",top:131,position:"absolute"},this.appendChild(this.contentView),this.contentView.updateDatas(t),this.layout()}}}class ur extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),Di(this.vm,this.vm.$attrsPath.countDownTime,(t=>{this.countDownLabel.setText(t+"s")})),Di(this.vm,this.vm.$attrsPath.hasCallbackGift,(t=>{t&&(this.countDownLabel.setText("已完成"),this.showEndAnimation())})),this.vm.isTouchCountDown()&&this.countDownLabel.setText("滑动领取")}setupViews(){this.style={width:54,height:60};let t=new TKView;t.style={width:46,height:46,borderRadius:23,borderWidth:2,borderColor:"#FFFFFF4D",position:"absolute",top:3,left:4,padding:2};let e=new TKView;e.style={width:"100%",height:"100%",backgroundColor:"#30303099",borderRadius:21},t.appendChild(e),this.appendChild(t),this.icon=new TKImage,this.icon.style={width:"100%",height:"100%"},this.icon.setSrc("image/ksad-video-image/scan_aggregation/scan_aggregation_widget.png"),this.appendChild(this.icon);let i=new TKView;i.style={width:48,height:16,borderRadius:8,gradientBgColor:"0,#FFE484, FFC700 0.08",position:"absolute",left:3,bottom:5},this.appendChild(i),this.countDownLabel=new TKText,this.countDownLabel.style={width:"100%",height:"100%",textAlign:"center",textLineClamp:1,fontSize:10,color:"#5E0900"},i.appendChild(this.countDownLabel)}showEndAnimation(){let t=new TKKeyframeAnimation;this.countDownLabel.style={transform:{scale:1}},t.setAnimations([()=>(this.countDownLabel.style={transform:{scale:1.5}},.5),()=>(this.countDownLabel.style={transform:{scale:1}},1)]),t.duration=500,this.countDownLabel.addAnimation(t,"titleAnimation"),t.on("end",(()=>{this.showIconAnimation()}))}showIconAnimation(){let t=new TKKeyframeAnimation;this.icon.style={transform:{scale:1}},t.setAnimations([()=>(this.icon.style={transform:{scale:1.5}},1)]),t.duration=500,this.icon.addAnimation(t,"giftIconAnimation");let e=new TKKeyframeAnimation;this.style={opacity:1},e.setAnimations([()=>(this.style={opacity:0},1)]),e.duration=500,this.addAnimation(e,"opacityAnimation")}}class wr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.showProgress()}setupViews(){this.style={width:"100%",height:"100%",backgroundColor:"#151515",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.setupContent()}setupContent(){this.contentContainer=new TKView,this.contentContainer.style={width:242,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.contentContainer);let t=new TKImage;t.style={width:180,height:180,opacity:0},t.setSrc("image/ksad-video-image/scan_aggregation/scan_aggregation_loadbg.png"),this.contentContainer.appendChild(t);let e=new TKText;e.style={fontSize:16,color:"#FFFFFF",width:"100%",height:30,textAlign:"center"},e.setText("等一下，奖励准备中..."),this.contentContainer.appendChild(e),this.setupprogressView(),this.gitfAnimation(t)}setupprogressView(){let t=new TKView;t.style={marginTop:6,width:"100%",height:18,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.contentContainer.appendChild(t);let e=new TKView;e.style={width:158,height:14,borderColor:"#FFFFFF4D",borderWidth:1,backgroundColor:"#FFFFFF00",borderRadius:7,paddingLeft:2,paddingRight:2,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},t.appendChild(e),this.progressView=new TKView,this.progressView.style={width:"0%",height:10,borderRadius:5,gradientBgColor:"0,FF9F0E, FE3666"},e.appendChild(this.progressView),this.progressText=new TKText,this.progressText.style={fontSize:16,color:"#FFFFFF96",height:18,marginLeft:6,width:42},this.progressText.setText("0%"),t.appendChild(this.progressText)}gitfAnimation(t){const e=new TKKeyframeAnimation;t.style={transform:{scale:.8},opacity:0},e.setAnimations([()=>(t.style={transform:{scale:1},opacity:1},1)]),e.timingFunction="ease-out",e.duration=300,t.addAnimation(e,"giftAnimation")}showProgress(){this.updateProgress(0)}updateProgress(t){let e=1,i=10;t>80?(e=50,i=80):t>50&&(e=40,i=60);const n=De(e,i);setTimeout((()=>{(t+=1)>=100?this.didLoad():this.updateProgress(t);const e=t+"%";this.progressText.setText(e),this.progressView.style={width:e}}),n)}didLoad(){setTimeout((()=>{this.onLoadFinsh&&this.onLoadFinsh()}),200)}}class Cr extends TKView{constructor(t){if(super(),this.sceneStarTime=0,this.currentIndex=0,this.isSceneStartEnd=!1,this.neoVM=t,this.sceneVM=t.scanAggregationVM,this.sceneStarTime=ue(),this.setupViews(),this.setBackPressedCallback(),this.loaderView){const t=this;this.loaderView.onLoadFinsh=()=>{t.startScene(),t.sceneVM.isLoaded=!0}}}startScene(){"pageVisiable"!=this.neoVM.lifeStatus&&"showEnd"!=this.neoVM.lifeStatus||(this.isSceneStartEnd=!0,this.contentView.removeChild(this.loaderView),this.setupWidget(),this.setupPrivacyView(),this.sceneVM.isTouchCountDown()||this.sceneVM.neoWidgetVM.countDown(),this.sceneVM.isFingerGuide()&&this.showFingerGuide(),this.sceneVM.listData[this.currentIndex]&&(this.sceneVM.listData[this.currentIndex].isPlaying=!0),this.sceneVM.reportSceneLoadFinish())}setupViews(){this.style={backgroundColor:"#EFEFEF",width:"100%",height:"100%"},this.contentView=new TKView,this.contentView.style={position:"absolute",left:0,right:0,top:0,bottom:0,flexDirection:"row",justifyContent:"center",alignContent:"center",width:"100%",height:"100%"},this.appendChild(this.contentView),this.setupListView(),this.setupLoaderView(),this.setupNavigation(),this.setupCloseView(),this.setupConfirm(),Di(this.neoVM.confirmVM,this.neoVM.confirmVM.$attrsPath.isShow,(t=>{t?this.onPlayStatusChange(1):this.onPlayStatusChange(2)})),Di(this.sceneVM.neoWidgetVM,this.sceneVM.neoWidgetVM.$attrsPath.hasCallbackGift,(t=>{t&&Ne.hasReward(0)})),Di(this.sceneVM.neoWidgetVM,this.sceneVM.neoWidgetVM.$attrsPath.currentPlaybackTime,(t=>{this.neoVM.confirmVM.currentPlaybackTime=t,t>0&&this.sceneVM.videoPlayStart()})),Di(this.neoVM,this.neoVM.$attrsPath.lifeStatus,(t=>{"hideEnd"==t&&this.onPageDestroy(),"pageVisiable"==t&&(this.isSceneStartEnd?this.onPlayStatusChange(2):this.startScene()),"pageInvisiable"==t&&this.onPlayStatusChange(1)})),Di(this.sceneVM.neoWidgetVM,this.sceneVM.neoWidgetVM.$attrsPath.isUserTouch,(t=>{t&&(this.sceneVM.neoWidgetVM.countDown(),this.fingerLottieView&&Pe.supportMinimumTKVersion("5.0.0")&&this.fingerLottieView.stop(),this.fingerContainer&&(this.fingerContainer.style={visibility:"hidden"}))})),ri().on(d,(t=>{this.sceneVM.isMute=!this.sceneVM.isMute;for(let e=0;e<this.sceneVM.listData.length;e++){this.sceneVM.listData[e].isMute=this.sceneVM.isMute}this.sceneVM.reportSoundClick()}))}setupWidget(){this.widget=new ur(this.sceneVM.neoWidgetVM),this.widget.style={position:"absolute",top:this.neoVM.containerLimit.height/2,right:22},this.widget.addEventListener("tap",(t=>{})),this.contentView.appendChild(this.widget)}showFingerGuide(){this.fingerContainer=new TKView,this.fingerContainer.throughHitTest=!0,this.fingerContainer.style={position:"absolute",bottom:0,height:443,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.fingerContainer.enabled=!1,this.contentView.appendChild(this.fingerContainer);let t=new TKImage;if(t.style={width:"100%",height:"100%",position:"absolute"},t.setSrc("image/ksad-video-image/scan_aggregation/scan_aggregation_fingerbg.png"),this.fingerContainer.appendChild(t),Pe.supportMinimumTKVersion("5.0.0")){this.fingerLottieView=new TKLottieImageView,this.fingerLottieView.style={width:74,height:190},this.fingerContainer.appendChild(this.fingerLottieView),this.fingerLottieView.setUri("bundle://image/ksad-image-video-card/finger_swipe_vertical.json"),this.fingerLottieView.play();let t=this;this.fingerLottieView.onAnimationEnd((()=>{t.fingerContainer.style={visibility:"hidden"}}))}}setupConfirm(){this.confirmDialog=new bs(this.neoVM.confirmVM),this.appendChild(this.confirmDialog),this.confirmDialog.setVisibility("hidden");const t=this;this.neoVM.confirmVM.handleSkipCallback=(e,i,n)=>{t.confirmDialog.dismiss()}}setupPrivacyView(){if(this.sceneVM.isShowEcPrivacyView()){const t=this.neoVM.containerLimit.width-30;this.privacyView=new Sn(this.sceneVM.listData[this.sceneVM.ecAdIndex].adInfo,this.neoVM.screenOrientation,t,"#EFEFEF","#A3A3A399"),this.privacyView.style={position:"absolute",width:"100%",left:0,bottom:0},this.privacyView.clickCallback=(t,e)=>{Ne.openURL(t,e)},this.contentView.appendChild(this.privacyView)}}setBackPressedCallback(){this.neoVM.backPressedCallback=()=>{!be(this.confirmDialog)&&this.confirmDialog.vm.isShow||(this.sceneVM.hasCallbackGift,this.backClick())}}setupListView(){if(Pe.supportMinimumTKVersion("5.0.0")){this.listView=new ListView(!1),this.listView.style={width:"100%",height:"100%"},this.listView.getItemsType=t=>{const e=[];for(let i=0;i<t.length;i++){const n=t[i];e.push(this.sceneVM.listData[n].index)}return e},this.listView.createView=t=>this.getItemView(t),this.listView.bindData=(t,e,i)=>this.bindData(t,e,i),this.listView.getItemsLayout=t=>{let e=[];for(let i=0;i<t.length;i++)e.push({length:this.sceneVM.listData[i].itemHeight});return e},this.listView.setFooter(this.getFooter()),this.listView.onProgressUpdated=t=>{this.sceneVM.listHeight=this.listView.getSize().height,this.progress!=t&&(this.progress=t,this.changeNavWithProgress(t),this.sceneVM.exposureCheck(t))},this.listView.onScrollStateChanged=t=>{if("idle"==t){const t=this.sceneVM.getIndexWithProgress(this.progress);this.playVideoWithIndex(t),this.sceneVM.canTouchCheck()&&(console.log("Aggregation============>无操作计时"),this.sceneVM.neoWidgetVM.startUserTouchTiming())}"dragging"==t&&(this.sceneVM.neoWidgetVM.isUserTouch||(this.sceneVM.neoWidgetVM.isUserTouch=!0))},this.listView.onVisibleItemsChanged=(t,e)=>{this.sceneVM.firstVisiblePosition=t,this.sceneVM.lastVisiblePosition=e},this.listView.clipChildren=!0,this.listView.scrollEnabled=!0,this.listView.showScrollIndicator=!0,this.listView.bounces=!0,this.listView.scrollEventThrottle=1,this.contentView.appendChild(this.listView);for(let t=0;t<this.sceneVM.listData.length;t++)this.listView.notifyItemInserted(t)}}setupLoaderView(){this.loaderView=new wr(this.sceneVM),this.loaderView.style={width:"100%",height:"100%",position:"absolute",top:0,left:0},this.contentView.appendChild(this.loaderView)}setupNavigation(){this.navContainer=new TKView,this.navContainer.style={position:"absolute",width:"100%",height:44+this.neoVM.getTopMargin(),backgroundColor:"#FFFFFF",opacity:0},this.appendChild(this.navContainer);let t=new TKView;t.style={width:"100%",height:44,position:"absolute",left:0,top:this.neoVM.getTopMargin(),flexDirection:"row",justifyContent:"center",alignItems:"center"},this.navContainer.appendChild(t);let e=new TKText;e.style={fontSize:17,color:"#222222"},e.setText("逛逛领奖励"),t.appendChild(e);let i=new TKView;i.style={width:44,height:"100%",left:0,position:"absolute",flexDirection:"row",justifyContent:"center",alignItems:"center"},t.appendChild(i),this.navContainer.addEventListener("tap",(t=>{})),i.addEventListener("tap",(t=>{this.backClick()}));let n=new TKImage;n.style={width:9.5,height:17},n.setSrc("image/ksad-video-image/scan_aggregation/left_arrow_black.png"),i.appendChild(n)}setupCloseView(){this.closeBtn=new TKView,this.closeBtn.style={width:50,height:50,top:this.neoVM.getTopMargin(),position:"absolute",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.closeBtn),this.closeBtn.addEventListener("tap",(t=>{this.backClick()}));let t=new TKImage;t.style={width:28,height:28},t.enabled=!1,t.setSrc("image/ksad-video-image/scan_aggregation/scan_aggregation_back.png"),this.closeBtn.appendChild(t)}getItemView(t){const e=this.sceneVM.listData[t];if(0==t){let t=new gr;return t.topInfo.bindViewModel(this.sceneVM.neoWidgetVM),t}if(2==e.materialType)return new dr;switch(e.itemType){case F.videoPromoteGoods:return new mr;case F.videoPromoteFollow:return new pr;default:return new cr}}bindData(t,e,i){t.updateDatas(this.sceneVM.listData[i])}playVideoWithIndex(t){-1!==t&&(this.sceneVM.listData[t].isPlaying||(this.playerPause(),this.sceneVM.listData[t].isPlaying=!0,this.currentIndex=t))}changeNavWithProgress(t){if(!this.sceneVM.neoWidgetVM.isUserTouch)return;let e=20*t;e<0&&(e=0),e>1&&(e=1),this.navContainer.style={opacity:e},this.closeBtn.style={opacity:1-e}}backClick(){this.neoVM.topBarVM.getSkipConfirmSwitch()&&!this.sceneVM.neoWidgetVM.hasCallbackGift?(this.confirmDialog.showDialog(this),this.confirmDialog.skipToEndHandler=()=>{Ne.skipVideo(!1,!1,this.sceneVM.neoWidgetVM.countDownTime,0),this.sceneVM.reportAdClose(),this.neoVM.handleClose(!1)}):(this.sceneVM.reportAdClose(),this.neoVM.handleClose(!1))}onPlayStatusChange(t){this.sceneVM.isLoaded&&(1==t&&(console.log("Aggregation==============>视频暂停"),this.playerPause(),this.sceneVM.neoWidgetVM.pause()),2!=t||"pageVisiable"!=this.neoVM.lifeStatus&&"showEnd"!=this.neoVM.lifeStatus||this.neoVM.confirmVM.isShow||(console.log("Aggregation==============>视频播放"),this.sceneVM.listData[this.currentIndex].isPlaying=!0,this.sceneVM.neoWidgetVM.countDown()))}onPageDestroy(){this.sceneVM.neoWidgetVM.cancelCountDown(),this.stopPlayer()}playerPause(){for(let t=0;t<this.sceneVM.listData.length;t++){this.sceneVM.listData[t].isPlaying=!1}}stopPlayer(){for(let t=0;t<this.sceneVM.listData.length;t++){this.sceneVM.listData[t].isPlayFreed=!0}}getFooter(){let t=new TKView,e=20;+this.sceneVM.isShowEcPrivacyView()&&(e+=50),t.style={width:"100%",height:e};let i=new TKText;return i.style={fontSize:10,color:"#666666",textAlign:"center"},i.setText("已经到底了"),t.appendChild(i),t}}class fr extends TKView{constructor(){super(),this.throughHitTest=!0,this.enabled=!1,this.setupViews()}setupViews(){this.setupBreathAnim(),this.setupHandAnim()}setupHandAnim(){this.style={width:"100%",height:"100%"},this.clipChildren=!1,this.handView=new TKImage,this.handView.style={width:120,height:120,top:0,bottom:0,position:"absolute"},ke(this.handView,"interact_card_hand.png"),this.appendChild(this.handView);const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.handView.style={transform:{translate:{x:10,y:10}}},.5),()=>(this.handView.style={transform:{translate:{x:0,y:0}}},1)]),t.duration=1e3,t.repeatCount=Number.MAX_SAFE_INTEGER,this.handView.addAnimation(t,"handAnimation")}setupBreathAnim(){this.gestureBreathAnimView=new TKView,this.gestureBreathAnimView.style={position:"absolute",marginTop:5,width:70,height:70},this.gestureBreathAnimView.clipChildren=!1,this.appendChild(this.gestureBreathAnimView),this.breathBackground=new TKView,this.breathBackground.style={position:"absolute",borderRadius:11,backgroundColor:"#FFFFFF",opacity:.5,width:22,height:22,top:23,left:23},this.gestureBreathAnimView.appendChild(this.breathBackground),this.breathAnim=new TKView,this.breathAnim.style={position:"absolute",borderRadius:11,backgroundColor:"#FFFFFF",opacity:.2,width:22,height:22,top:23,left:23},this.gestureBreathAnimView.appendChild(this.breathAnim);const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.breathAnim.style={transform:{scale:2.3}},.5),()=>(this.breathAnim.style={transform:{scale:1}},1)]),t.duration=1e3,t.repeatCount=Number.MAX_SAFE_INTEGER,this.breathAnim.addAnimation(t,"handBreathAnimation")}clearHandClick(){this.handView.setVisibility("hidden"),this.breathAnim.setVisibility("hidden"),this.breathBackground.setVisibility("hidden"),this.handView.removeAllAnimation(),this.breathAnim.removeAllAnimation()}}class yr extends TKView{constructor(t){super(),this.animRunCount=1,this.isShowCurrentView=!0,this.upMoveAnimTimer=0,this.downMoveAnimTimer=0,this.infos=t,this.setupViews(),this.setupData(),this.startTopTagViewgMoveAnimation(),this.startDownTagViewMoveAnimation()}setupData(){this.upTagText.setText(this.infos[0]),this.downTagText.setText(this.infos[1])}setupViews(){this.contentView=new TKView,this.contentView.style={position:"absolute",width:"100%",height:30,flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:24},this.appendChild(this.contentView);let t=new TKImage;t.style={width:244,height:30,position:"absolute"},ke(t,"interact_card_lamp_bg.png"),this.contentView.appendChild(t),this.setUpTagView()}setUpTagView(){let t=new TKView;t.style={width:"100%",height:27,alignItems:"center"},this.upTagText=new TKText,this.upTagText.style={position:"absolute",top:0,color:"#FFF2DD70",fontSize:12,fontWeight:"500",includeFontPadding:!1,textAlign:"center",width:180,height:27,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.upTagText),this.downTagText=new TKText,this.downTagText.style={color:"#FFF2DD70",fontSize:12,position:"absolute",top:27,includeFontPadding:!1,fontWeight:"500",textAlign:"center",width:180,height:27,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.downTagText),this.contentView.appendChild(t)}startTopTagViewgMoveAnimation(){var t;if((null===(t=this.infos)||void 0===t?void 0:t.length)<=1)return;let e=this;this.downMoveAnimTimer=setInterval((()=>{let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(e.upTagText.style={top:e.isShowCurrentView?0:27},0),()=>(e.upTagText.style={top:e.isShowCurrentView?-27:0},1)]),t.on("end",(()=>{e.upTagText.style={top:e.isShowCurrentView?27:0}})),e.upTagText.addAnimation(t,"tagTextTranslateAnimation")}),2e3)}startDownTagViewMoveAnimation(){var t;if((null===(t=this.infos)||void 0===t?void 0:t.length)<=1)return;let e=this;this.upMoveAnimTimer=setInterval((()=>{let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(e.downTagText.style={top:e.isShowCurrentView?27:0},0),()=>(e.downTagText.style={top:e.isShowCurrentView?0:-27},1)]),t.on("end",(()=>{e.downTagText.style={top:e.isShowCurrentView?0:27},e.handleAnimEnd()})),e.downTagText.addAnimation(t,"tagDownTextTranslateAnimation")}),2e3)}handleAnimEnd(){setTimeout((()=>{this.animRunCount++,this.isShowCurrentView=!this.isShowCurrentView,this.isShowCurrentView?this.downTagText.setText(this.infos[this.animRunCount%this.infos.length]):this.upTagText.setText(this.infos[this.animRunCount%this.infos.length])}),1e3)}clearAnim(){this.upMoveAnimTimer&&clearInterval(this.upMoveAnimTimer),this.downMoveAnimTimer&&clearInterval(this.downMoveAnimTimer),this.downTagText.removeAllAnimation(),this.upTagText.removeAllAnimation()}}class Tr extends TKView{constructor(t){super(),this.isClick=!1,this.hasInteracted=!1,this.vm=t,this.vm.logInteractionImp(),this.setupViews(),this.showBaseAnim(this),this.showCardAnim(this.leftCardView,this.rightCardView),this.setupActions();const e=this;this.timePlay=new hn(this.vm.getInteractShowTime()),this.timePlay.onFinishCallback=()=>{e.isClick||e.clickAction(0,3),this.isClick=!0},this.timePlay.play(),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&e.onDismiss(),"pageVisiable"==t&&e.timePlay&&e.timePlay.resume(),"pageInvisiable"==t&&e.timePlay&&e.timePlay.paused()}))}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",position:"absolute"};let t=new TKView;t.style={width:"100%",height:540,alignItems:"center"},this.appendChild(t),this.titleContentView=new TKView,this.titleContentView.style={width:382,height:87,top:12,justifyContent:"center",alignItems:"center"},t.appendChild(this.titleContentView);let e=new TKImage;e.style={width:382,height:87,position:"absolute"},ke(e,"interact_card_title_bg.png"),this.titleContentView.appendChild(e);let i=new TKText;i.style={width:320,height:45,color:"#FBE5C3",fontSize:32,textLineClamp:1,textOverflow:"clip",textAlign:"center",fontWeight:"600"},Ie(this.vm.getInteractTitle())?i.setText(this.vm.getInteractTitle()):i.setText("翻卡领取专属奖励"),this.titleContentView.appendChild(i),this.subTitleContentView=new TKView,this.subTitleContentView.style={width:224,height:45,top:-7,flexDirection:"row",justifyContent:"center",alignItems:"center"},t.appendChild(this.subTitleContentView);let n=new TKImage;ke(n,"interact_card_subtitle_left.png"),n.style={width:32,height:6,right:8},this.subTitleContentView.appendChild(n);let s=new TKText;s.style={width:208,height:45,color:"#FBE5C3",fontSize:16,textLineClamp:1,textOverflow:"clip",textAlign:"center"},Ie(this.vm.getInteractSubTitle())?s.setText(this.vm.getInteractSubTitle()):s.setText("点击任意卡片获取奖励"),this.subTitleContentView.appendChild(s);let a=new TKImage;ke(a,"interact_card_subtitle_right.png"),a.style={width:32,height:6,left:8},this.subTitleContentView.appendChild(a),this.cardBaseView=new TKView,this.cardBaseView.style={marginTop:5,width:"100%",height:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",position:"absolute"},t.appendChild(this.cardBaseView);let o=new TKView;o.style={width:"100%",height:"100%",position:"absolute",alignItems:"center",justifyContent:"center",flexDirection:"row"},this.cardBaseView.appendChild(o),this.leftLightView=new TKView,this.leftLightView.style={height:265,width:180,shadow:"0 0 10 #FFF4CD44",borderRadius:14,visibility:"hidden"},o.appendChild(this.leftLightView),this.rightLightView=new TKView,this.rightLightView.style={marginStart:12,height:265,width:180,shadow:"0 0 10 #FFF4CD44"},o.appendChild(this.rightLightView),Pe.supportMinimumTKVersion("5.0.0")&&(this.leftCardBaseView=new RoundRectView,this.leftCardBaseView.style={height:261,width:174,borderRadius:22},this.leftCardView=new TKImage,this.leftCardView.style={height:261,width:174},this.leftSweepView=new TKImage,this.leftSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1"},this.cardBaseView.appendChild(this.leftCardBaseView),this.leftCardBaseView.appendChild(this.leftCardView),this.leftCardBaseView.appendChild(this.leftSweepView),this.rightCardBaseView=new RoundRectView,this.rightCardBaseView.style={marginStart:18,height:261,width:174,borderRadius:22},this.rightCardView=new TKImage,this.rightCardView.style={height:261,width:174},this.rightSweepView=new TKImage,this.rightSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1",visibility:"hidden"},this.cardBaseView.appendChild(this.rightCardBaseView),this.rightCardBaseView.appendChild(this.rightCardView),this.rightCardBaseView.appendChild(this.rightSweepView)),Ie(this.vm.getInteractIcon())?(this.leftLightView.setVisibility("hidden"),this.leftSweepView.setVisibility("hidden"),this.rightLightView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.leftCardView.setSrc(this.vm.getInteractIcon()),this.rightCardView.setSrc(this.vm.getInteractIcon())):(this.leftLightView.setVisibility("visible"),this.leftSweepView.setVisibility("visible"),this.rightLightView.setVisibility("visible"),this.sweepAnimation(),setTimeout((()=>{this.rightSweepView.setVisibility("visible"),this.sweepRightAnimation()}),800),this.leftCardView.setSrc("image/ksad-video-image/interact_card_bg_left.png"),this.rightCardView.setSrc("image/ksad-video-image/interact_card_bg_right.png")),setTimeout((()=>{this.handAndBreatheView=new fr;let t=this.cardBaseView.getSize().width-100;this.isClick||(this.handAndBreatheView.style={width:120,height:120,left:t,top:290,position:"absolute"},this.cardBaseView.appendChild(this.handAndBreatheView))}),668),this.lampAndCloseContentView=new TKView,this.lampAndCloseContentView.style={marginTop:300,width:"100%",height:110,alignItems:"center"},t.appendChild(this.lampAndCloseContentView),this.vm.getInteractCustomerInfo().length&&(this.tagView=new yr(this.vm.getInteractCustomerInfo()),this.tagView.style={width:"100%",height:40},this.lampAndCloseContentView.appendChild(this.tagView)),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={marginTop:18,width:40,height:40,opacity:.6},this.lampAndCloseContentView.appendChild(this.closeView)}setupActions(){this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose(1),this.timePlay&&this.timePlay.stop()})),this.leftCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,this.clickAction(0,1))})),this.rightCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,Ie(this.vm.getInteractIcon())||(this.vm.clickType=1),this.clickAction(1,2))}))}clickAction(t,e){this.leftSweepView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.vm.logInteractionClick(e),0==t?this.clickCardAnim(this.leftCardBaseView,this.rightCardView,t,this.leftLightView,this.rightLightView):this.clickCardAnim(this.rightCardBaseView,this.leftCardView,t,this.rightLightView,this.leftLightView),this.clickBaseAnim(this.titleContentView,this.subTitleContentView,this.lampAndCloseContentView)}showBaseAnim(t){let e=new TKKeyframeAnimation;e.duration=15,e.timingFunction="linear",e.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:1},1)]),t.addAnimation(e,"leftShowAnimation")}showCardAnim(t,e){let i=new TKKeyframeAnimation;i.duration=250,i.timingFunction="linear",i.setAnimations([()=>(t.style={opacity:0,left:-150},0),()=>(t.style={left:0,opacity:1},1)]),t.addAnimation(i,"leftShowAnimation");let n=new TKKeyframeAnimation;n.duration=250,n.timingFunction="linear",n.setAnimations([()=>(e.style={opacity:0,left:150},0),()=>(e.style={opacity:1,left:0},1)]),e.addAnimation(n,"rightShowAnimation");let s=new TKKeyframeAnimation;s.duration=250,s.timingFunction="linear",s.setAnimations([()=>(this.leftLightView.style={opacity:0,left:-150},0),()=>(this.leftLightView.style={left:0,opacity:1},1)]),this.leftLightView.addAnimation(s,"leftLightShowAnimation");let a=new TKKeyframeAnimation;a.duration=250,a.timingFunction="linear",a.setAnimations([()=>(this.rightLightView.style={opacity:0,left:150},0),()=>(this.rightLightView.style={opacity:1,left:0},1)]),this.rightLightView.addAnimation(a,"rightLightShowAnimation")}clickCardAnim(t,e,i,n,s){if(this.handAndBreatheView&&this.handAndBreatheView.setVisibility("hidden"),!Ie(this.vm.getInteractIcon())){let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(n.style={},0),()=>(n.style={top:-5,left:1==i?-96:96,transform:{scale:1.4}},1)]),n.addAnimation(t,"lightAnimation");let e=new TKKeyframeAnimation;e.duration=100,e.timingFunction="linear",e.setAnimations([()=>(s.style={opacity:1},0),()=>(s.style={opacity:0},1)]),s.addAnimation(e,"closelightAnimation")}let a=new TKKeyframeAnimation;a.duration=500,a.timingFunction="linear",a.setAnimations([()=>(t.style={},0),()=>(t.style={top:-5,left:1==i?-96:96,transform:{scale:1.4}},1)]),t.addAnimation(a,"cardMoveAnimation");let o=new TKKeyframeAnimation;o.duration=100,o.timingFunction="linear",o.setAnimations([()=>(e.style={opacity:1},0),()=>(e.style={opacity:0},1)]),e.addAnimation(o,"cardDismissAnimation"),a.on("end",(()=>{this.interactCallback&&!this.hasInteracted&&(this.interactCallback(),this.hasInteracted=!0)}))}clickBaseAnim(t,e,i){let n=new TKKeyframeAnimation;n.duration=15,n.timingFunction="linear",n.setAnimations([()=>(t.style={opacity:1},e.style={opacity:1},i.style={opacity:1},0),()=>(t.style={opacity:0},e.style={opacity:0},i.style={opacity:0},1)]),t.addAnimation(n,"clickBaseAnimation")}sweepAnimation(){this.leftSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.leftSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.leftSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1e3,t.repeatCount=1,t.timingFunction="Linear",this.leftSweepView.addAnimation(t,"sweep")}),1500)}sweepRightAnimation(){this.rightSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.rightSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.rightSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1200,t.repeatCount=1,t.timingFunction="Linear",this.rightSweepView.addAnimation(t,"sweep")}),1500)}onDismiss(){this.removeAllAnimation(),this.tagView&&this.tagView.clearAnim(),this.handAndBreatheView&&this.handAndBreatheView.removeAllAnimation(),this.rightCardBaseView&&this.rightCardBaseView.removeAllAnimation(),this.leftCardBaseView&&this.leftCardBaseView.removeAllAnimation(),this.rightCardView&&this.rightCardView.removeAllAnimation(),this.leftCardView&&this.leftCardView.removeAllAnimation(),this.rightSweepView&&this.rightSweepView.removeAllAnimation(),this.leftSweepView&&this.leftSweepView.removeAllAnimation(),this.leftLightView&&this.leftLightView.removeAllAnimation(),this.rightLightView&&this.rightLightView.removeAllAnimation(),this.handAndBreatheView&&this.handAndBreatheView.clearHandClick(),this.timePlay&&this.timePlay.stop()}}class Ir{constructor(){this.tagViewStyle=0,this.height=18,this.tagBorderRadius=2,this.tagFontSize=12,this.tagFontWeight="normal",this.customBackgroundColor="#FFFFFF",this.customTextColor="#FE3666",this.customShadowColor="",this.tagPadding=8,this.tagDividerSize=8}static create(t){return Object.assign(new Ir,t)}}class vr extends TKView{constructor(t,e){if(super(),t&&t.length>0){e||(e=new Ir),this.style={flexDirection:"row",alignItems:"center",flexWrap:"wrap",height:e.height};let i=new TKView;i.style={display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap",height:e.height,overflow:"hidden"},i.clipChildren=!0,this.appendChild(i),this.tagArray=new Array;let n=t.length>3?3:t.length,s="#FFFFFF",a="#FE3666",o="#FE3666",r="normal",h="";1==e.tagViewStyle&&(s="#FFE1E8",a="#FFFFFF00",o="#FE3666",r="medium"),2==e.tagViewStyle&&(s="#FFFFFF",a="#666666",o="#666666",r="normal"),3==e.tagViewStyle&&(s=e.customBackgroundColor,a="#FFFFFF00",o=e.customTextColor,r="normal",h=e.customShadowColor);let l=0;for(;l<n;++l){let r=new TKText;r.style={backgroundColor:s,textAlign:"center",height:e.height,paddingLeft:e.tagPadding,paddingRight:e.tagPadding,marginRight:l==n-1?0:e.tagDividerSize,color:o,borderWidth:1,fontSize:e.tagFontSize,fontWeight:e.tagFontWeight,borderColor:a,borderRadius:e.tagBorderRadius},r.setText(t[l].text),Ie(h)&&(r.style={shadow:h}),i.appendChild(r)}}}}class Vr extends TKView{constructor(t){super(),this.spikeTimer=0,this.vm=t,this.seckillTime=this.vm.getRightsCardSecKillTime(),this.setupViews(),this.setupActions()}setupActions(){this.cardTitleText.setText(this.vm.getRightsCardTitle()),this.productIconImg.setSrc(this.vm.getRightsCardCustomImageUrl()),this.iconTagText.setText(this.vm.getRightsCardProductIconDesc()),this.sellingPointText&&this.sellingPointText.setText(this.vm.getRightsCardSellingPoint()),this.customContentText.setText(this.vm.getRightsCardCustomContent()),be(this.vm.getPrice())||(ke(this.priceBg,"product_card_price_curve.png"),this.priceTitleText.setText("超值低价"),this.priceText.setText(this.vm.getPrice())),be(this.vm.getOriginPrice())||this.origninPriceText.setText("¥"+this.vm.getOriginPrice())}setupViews(){if(this.style={alignItems:"center",justifyContent:"center"},this.container=new TKView,this.container.style={height:316,width:208,top:this.titleTopDis(),flexDirection:"column",alignItems:"center",justifyContent:"flex-start",position:"absolute"},this.appendChild(this.container),this.cardTitleText=new TKText,this.cardTitleText.style={width:"100%",height:28,fontSize:20,textLineClamp:1,color:"#FE3666",marginTop:0,alignItems:"center",fontWeight:"500",textOverflow:"clip",textAlign:"center"},this.container.appendChild(this.cardTitleText),this.productIconView=new TKView,this.productIconView.style={height:this.productIconLength(),width:this.productIconLength(),borderRadius:4,backgroundColor:"#FFFFFF",marginTop:this.productIconDis(),alignItems:"flex-start",justifyContent:"center"},this.container.appendChild(this.productIconView),this.productIconImg=new TKImage,this.productIconImg.style={height:this.productIconLength(),width:this.productIconLength(),borderRadius:4},this.productIconView.appendChild(this.productIconImg),this.iconTagView=new TKView,this.iconTagView.style={width:30,height:20,left:0,top:0,topLeftRadius:4,bottomRightRadius:4,backgroundColor:"#FE3666",alignItems:"center",justifyContent:"center",position:"absolute"},this.productIconView.appendChild(this.iconTagView),this.iconTagText=new TKText,this.iconTagText.style={width:30,height:20,fontSize:11,textLineClamp:1,color:"#FEFFFF",alignItems:"center",textOverflow:"ellipsis",textAlign:"center"},this.iconTagView.appendChild(this.iconTagText),this.container.appendChild(this.createProductTitleArea(this.vm.needShowSellingText)),this.vm.isHasTags()&&this.setupTagView(),be(this.vm.getPrice())||this.setupPriceView(),this.vm.getRightsCardSecKillTime()){const t=new TKView;t.style={height:372,width:248,flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",position:"absolute"},this.appendChild(t),this.setupSeckillView(t)}}createProductTitleArea(t){console.log("jky createProductTitleArea: "+t);let e=new TKView;return e.style={width:"100%",flexDirection:"column",justifyContent:"center"},t?(e.style={height:42},this.sellingPointText=new TKText,this.sellingPointText.style={width:"100%",height:"auto",fontSize:14,textLineClamp:1,color:"#881B00",alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},this.customContentText=new TKText,this.customContentText.style={width:"100%",height:"auto",fontSize:14,textLineClamp:1,color:"#881B00",alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},e.appendChild(this.sellingPointText),e.appendChild(this.customContentText)):(e.style={height:22,marginTop:8},this.customContentText=new TKText,this.customContentText.style={width:"100%",height:22,fontSize:16,textLineClamp:1,color:"#881B00",alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},e.appendChild(this.customContentText)),e}setupTagView(){Ir.create({tagViewStyle:1,height:24,tagBorderRadius:4,tagFontSize:11}),this.tagView=new vr(this.vm.getRightsCardProductTags(),Ir.create({tagViewStyle:1,height:24,tagBorderRadius:4,tagFontSize:11,tagPadding:4,tagDividerSize:8})),this.tagView.style={marginTop:8},this.container.appendChild(this.tagView)}setupPriceView(){this.priceContainer=new TKView,this.priceContainer.style={height:74,width:188,marginTop:this.vm.isHasTags()?12:24,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.container.appendChild(this.priceContainer),this.container.clipChildren=!1,this.priceBg=new TKImage,this.priceBg.style={height:74,width:188},this.priceContainer.appendChild(this.priceBg),this.priceTitleText=new TKText,this.priceTitleText.style={width:"100%",height:15,fontSize:12,textLineClamp:1,color:"#FE3666",top:0,alignItems:"center",fontWeight:"500",textOverflow:"ellipsis",textAlign:"center",position:"absolute"},this.priceContainer.appendChild(this.priceTitleText),this.priceView=new TKView,this.priceView.style={maxWidth:"100%",height:36,backgroundColor:"#FFFFFF",borderColor:"#FE3666",borderWidth:1,borderRadius:100,top:19,flexDirection:"row",position:"absolute",paddingLeft:8,paddingRight:8},this.priceContainer.appendChild(this.priceView),this.vm.isOnlyHasOriginPrice()||(this.priceTag=new TKText,this.priceTag.style={width:16,height:16,top:14,fontSize:16,textLineClamp:1,includeFontPadding:!1,color:"#FE3666",fontWeight:"600"},this.priceTag.setText("¥"),this.priceView.appendChild(this.priceTag));let t=this.vm.isOnlyHasOriginPrice()?18:26;this.priceText=new TKText,this.priceText.style={height:28,fontSize:t,top:4,textLineClamp:1,color:"#FE3666",alignItems:"center",includeFontPadding:!1,fontWeight:"600",textOverflow:"clip",textAlign:"center"},this.priceView.appendChild(this.priceText),be(this.vm.getOriginPrice())||this.setupOriginPriceView()}setupOriginPriceView(){this.origninPriceText=new TKText,this.origninPriceText.style={width:54,height:17,fontSize:12,textLineClamp:1,color:"#9C9C9C",left:0,bottom:0,alignItems:"center",textOverflow:"clip",textAlign:"center",position:"absolute"},this.priceContainer.appendChild(this.origninPriceText)}setupSeckillView(t){const e={height:16,width:16,marginRight:6,color:"#FE3665",backgroundColor:"#FFFFFF",textAlign:"center",borderRadius:2,fontSize:12,includeFontPadding:!1,textLineClamp:1},i=new TKView;i.style={width:"100%",paddingStart:12,height:34,top:0,position:"absolute",flexDirection:"row",justifyContent:"space-between"},t.appendChild(i);let n=new TKView;n.style={width:"100%",height:"100%",flexDirection:"row",alignItems:"center"},i.appendChild(n);const s=new TKImage;s.style={width:66,height:14},n.appendChild(s),ke(s,"product_card_seckill_icon.png");const a=new TKText;a.style={width:38,height:16,fontSize:12,marginLeft:4,textLineClamp:1,color:"#FFFFFF",alignItems:"center",fontWeight:"500",textOverflow:"ellipsis",textAlign:"center"},n.appendChild(a),a.setText("距结束"),this.spikeHourText=new TKText,this.spikeHourText.style=e,n.appendChild(this.spikeHourText),this.spikeMinuteText=new TKText,this.spikeMinuteText.style=e,n.appendChild(this.spikeMinuteText),this.spikeSecondText=new TKText,this.spikeSecondText.style=e,n.appendChild(this.spikeSecondText),0!=this.spikeTimer&&clearInterval(this.spikeTimer),this.updateSpikeText(),this.spikeTimer=setInterval((()=>{this.updateSpikeText()}),1e3)}updateSpikeText(){let t=new Ha(this.seckillTime);this.seckillTime=this.seckillTime-1e3,this.spikeHourText.setText(t.getFormattedHour()),this.spikeMinuteText.setText(t.getFormattedMinute()),this.spikeSecondText.setText(t.getFormattedSecond())}productIconLength(){return be(this.vm.getPrice())?156:132}productIconDis(){return be(this.vm.getPrice())?20:8}titleTopDis(){return this.vm.getRightsCardSecKillTime()?106:90}}class Ar extends TKView{constructor(t){super(),this.actionBarSize={width:186,height:48},this.startDismissCalled=!1,this.vm=t,this.setupViews()}setupViews(){this.style={height:"100%",width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute"},this.setupContainer();const t=this;_i(this.vm.$attrsPath.callerContext.lifeStatus,(e=>{"hideEnd"==e&&t.onDismiss(2)}))}showRightsDialogCard(){const t=this;this.titleBg.style={opacity:0},this.titleText.style={opacity:0},this.actionBarView.style={opacity:0},this.closeView.style={opacity:0},this.showCardAnimation((()=>{t.titleAndBottomShow(),t.cricleAnimation(),t.cardAppearCallback&&t.cardAppearCallback()})),this.vm.logProductRightsImp(),this.setupActions(),this.startDismissCalled=!1}showCardAnimation(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.cardView.style={transform:{scale:.02}},0),()=>(this.cardView.style={transform:{scale:1.15}},1)]),e.duration=250,e.timingFunction="0.19 0.81 1 1",this.cardView.addAnimation(e,"cardContentAnim");const i=this;e.on("end",(()=>{t&&t();let e=new TKKeyframeAnimation;e.setAnimations([()=>(i.cardView.style={transform:{scale:1.15}},0),()=>(i.cardView.style={transform:{scale:1}},1)]),e.duration=330,e.timingFunction="0.19 0.54 0.58 1",i.cardView.addAnimation(e,"cardScaleAnim"),e.on("end",(()=>{}))}))}titleAndBottomShow(){this.titleBg.style={opacity:1},this.titleText.style={opacity:1},this.actionBarView.style={opacity:1},this.closeView.style={opacity:.6}}cricleAnimation(){Pe.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080));let t=new fr;t.style={width:90,height:90,right:(this.vm.callerContext.containerLimit.width-this.actionBarSize.width)/2-30,bottom:39,position:"absolute"},this.containerView.appendChild(t)}addSweepAnimation(){if(this.sweepView&&this.actionBarView.removeChild(this.sweepView),Pe.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:48,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=34;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,opacity:1,position:"absolute"},this.sweepView.appendChild(this.sweepImage),ke(this.sweepImage,"icon_ksad_extra_reward_sweep.png"),this.actionBarView.appendChild(this.sweepView),this.sweepImage.addAnimation(zi(540,this.actionBarSize.width+t),"anim")}}setupContainer(){this.containerView=new TKView,this.containerView.style={width:"100%",height:700,flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute"},this.containerView.clipChildren=!1,this.appendChild(this.containerView),this.setupContentView(this.containerView),this.setupTitleView(this.containerView),this.setupCardView(this.contentView),this.setupActionbar(this.contentView),this.setupTipsView(this.containerView),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={bottom:0,width:40,height:40,opacity:0,resize:"contain",position:"absolute"},this.containerView.appendChild(this.closeView)}setupContentView(t){this.contentView=new TKView,this.contentView.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},t.appendChild(this.contentView)}setupTitleView(t){const e=new TKView;e.style={width:414,height:187,top:0,position:"absolute"},t.appendChild(e),this.titleBg=new TKImage,this.titleBg.style={width:414,height:187,top:0,position:"absolute"},ke(this.titleBg,"product_card_title_bg.png"),e.appendChild(this.titleBg),this.titleText=new TKText,this.titleText.style={color:"#FFFCF7",top:70,position:"absolute",fontWeight:"600",fontSize:32,height:45,width:"100%",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.titleText.setText("限时"+this.vm.getRightsCardStayTime()+"秒后消失"),e.appendChild(this.titleText)}setupCardView(t){this.cardView=new TKView,this.cardView.style={top:124,width:414,height:497,position:"absolute"},t.appendChild(this.cardView),this.cardBgView=new TKImage,this.cardBgView.style={top:0,width:414,height:497,position:"absolute"},this.vm.getRightsCardSecKillTime()?ke(this.cardBgView,"product_card_seckill.png"):ke(this.cardBgView,"product_card_usual.png"),this.cardView.appendChild(this.cardBgView),this.cardContent=new Vr(this.vm),this.cardContent.clipChildren=!1,this.cardContent.style={top:0,width:414,height:497,position:"absolute"},this.cardView.appendChild(this.cardContent)}setupTipsView(t){let e=this.vm.getBottomTipsText();if(be(e))return;let i=new TKText;i.style={width:"100%",height:15,fontSize:10,color:"#FFF9F9",opacity:.5,includeFontPadding:!1,fontWeight:"400",textAlign:"center",position:"absolute",bottom:42},i.setText(e),this.contentView.appendChild(i)}setupActionbar(t){this.actionBarView=new TKView,this.actionBarView.style={bottom:65,width:186,height:48,borderRadius:24,position:"absolute"},this.actionBarView.clipChildren=!0,t.appendChild(this.actionBarView);let e=new TKImage;e.style={width:"100%",height:"100%",position:"absolute"},ke(e,"product_card_button.png"),this.actionBarView.appendChild(e),this.actionBarText=new TKText,this.actionBarText.style={color:"#FFFFFF",width:"90%",height:"100%",alignSelf:"center",fontWeight:"600",fontSize:20,position:"absolute",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLetterSpace:1.5},this.actionBarText.setText(this.vm.getRightsCardAction()),this.actionBarView.appendChild(this.actionBarText)}setupActions(){this.actionBarView.addEventListener("tap",(e=>{const i=Te(e,this.actionBarView);let n=new S;n.template_show_type="benefit_card_item",this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),this.cardContent.addEventListener("tap",(e=>{const i=Te(e,this.actionBarView);let n=new S;n.template_show_type="benefit_card_item",this.vm.convert(i,2,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),this.closeView.addEventListener("tap",(t=>{this.onDismiss(2)}))}onDismiss(t){this.startDismissCalled||(this.startDismissCallback&&this.startDismissCallback(this.contentView,t),this.removeAllAnimation(),this.sweepTimer&&clearInterval(this.sweepTimer),this.startDismissCalled=!0)}updateCountdown(t){this.titleText&&this.titleText.setText(`限时${t}秒后消失`)}}class br{static addCardShowAnimation(t,e){let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={transform:{scale:.02}},0),()=>(t.style={transform:{scale:1.15}},1)]),i.duration=230,i.timingFunction="0.19 0.81 1 1",t.addAnimation(i,"cardContentAnim");i.on("end",(()=>{e&&e();let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={transform:{scale:1.15}},0),()=>(t.style={transform:{scale:1}},1)]),i.duration=380,i.timingFunction="0.19 0.54 0.58 1",t.addAnimation(i,"cardScaleAnim")}))}static addCouponLegacyCardShowAnimation(t,e){let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={transform:{scale:0},opacity:0},0),()=>(t.style={transform:{scale:1},opacity:1},1)]),i.duration=600,i.timingFunction="linear",i.on("end",(()=>{e&&e()})),t.addAnimation(i,"ecShowAnimation")}}class Sr extends TKView{constructor(t){super(),this.closeCallbackCalled=!1,this.vm=t,this.setupView(),this.setupAction(),this.fitHorizontalScreenView(),this.vm.getActionBarRect=()=>({x:this.actionbarView.getOrigin().x,y:this.actionbarView.getOrigin().y,width:169,height:48}),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&this.sweepTimer&&clearInterval(this.sweepTimer)}))}setupView(){this.setupRootView(),this.setupCountDownView(),this.setupBgView(),this.setupCardInfoView(),this.setupCouponInfoView(),this.setupTipsView(),this.setupBottomContainerView(),this.tryReportImpression()}setupAction(){this.actionbarView&&this.actionbarView.addEventListener("tap",(e=>{const i=Te(e,this.actionbarView);this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK)&&this.vm.enableShowCloseView()&&this.onCloseClick&&this.handleCloseClick(3)})),this.closeImage&&this.closeImage.addEventListener("tap",(t=>{this.handleCloseClick(1)})),this.vm.isSplashScene()||this.vm.isInterstitialScene()||this.bgContainerView.addEventListener("tap",(e=>{const i=Te(e,this.bgContainerView);let n=this.vm.convert(i,2,t.CARD_OTHERAREA_CLICK);console.log(`jky click bgContainerView shouldConvert: ${n}`),n&&this.onCloseClick&&this.handleCloseClick(3)}))}handleCloseClick(t){this.closeCallbackCalled||(this.onCloseClick&&(this.onCloseClick(this.bgContainerView,t),this.closeCallbackCalled=!0),this.removeAllAnimation(),this.sweepTimer&&clearInterval(this.sweepTimer))}setupRootView(){this.actionBarSize=this.getActionBarSize(),this.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"};let t=this.vm.getRootBgColor();t&&(this.style={backgroundColor:t}),this.rootContainerView=new TKView,this.rootContainerView.style={width:"100%",height:"auto",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingBottom:this.vm.useLegacyAnim()?52:0,paddingTop:this.vm.useLegacyAnim()?0:80};let e=this.vm.getFullCardBgUrl();if(!be(e)){let t=new TKImage;t.style={width:"100%",height:this.vm.getFullCardHeight(),position:"absolute",left:0,top:80,right:0},ke(t,e),this.rootContainerView.appendChild(t)}this.vm.useLegacyAnim()&&this.vm.enableShowCloseView()&&(this.rootContainerView.style={transform:{scale:0},opacity:0}),this.appendChild(this.rootContainerView)}setupCountDownView(){if(!this.vm.enableShowCountDownView())return;let t=new TKView;t.style={shadow:"0 0 26 #FFDF8E99"},this.countDownTextView=new TKText,this.countDownTextView.style={fontSize:22,marginBottom:8,fontWeight:"600",color:Pe.isAndroid()?"#FFE296":"#FFF7E0",gradientTextColor:"270,FFFFFF,FFE296"},t.appendChild(this.countDownTextView),this.countDownTextView.setText("限时福利 "+this.vm.getRightsCardStayTime()+"s 后消失"),this.rootContainerView.appendChild(t)}setupBgView(){let t=this.vm.getCardSize();this.bgContainerView=new TKView,this.bgContainerView.style={width:t.width,height:t.height,flexDirection:"column",alignItems:"center"},this.rootContainerView.appendChild(this.bgContainerView),this.bgImageView=new TKImage,this.bgImageView.style={width:"100%",height:"100%",bottomLeftRadius:60,bottomRightRadius:60},this.bgImageView.setSrc(this.vm.getBgUrl()),this.bgContainerView.appendChild(this.bgImageView),this.setupIPView();let e=this.vm.getBottomImageViewName();be(e)||(this.bgBottomImageView=new TKImage,this.bgBottomImageView.style={width:273,height:263,position:"absolute",left:0,top:0},ke(this.bgBottomImageView,e),this.bgContainerView.appendChild(this.bgBottomImageView))}setupCardInfoView(){this.cardInfoView=new TKView,this.cardInfoView.style={position:"absolute",left:40,width:84,top:34,flexDirection:"column"},this.bgContainerView.appendChild(this.cardInfoView),this.cardTitleText=new TKText,this.cardTitleText.style={fontSize:20,fontWeight:"900",color:"#FFFFFF"},this.cardTitleText.setText(this.vm.getRightsCardTitle()),this.cardInfoView.appendChild(this.cardTitleText),this.cardDescText=new TKText,this.cardDescText.style={color:"#FFFFFF",fontSize:11,marginTop:2,width:"100%",textLineClamp:1,textOverflow:"ellipsis"},this.cardDescText.setText(this.vm.getTitleDesc()),this.cardInfoView.appendChild(this.cardDescText)}setupIPView(){let t=this.vm.getUserIcon();be(t)||(this.ipImageView=new TKImage,this.ipImageView.style={position:"absolute",right:12,top:1,width:134,height:134},this.ipImageView.setSrc(t),this.bgContainerView.appendChild(this.ipImageView))}setupCouponInfoView(){let t=this.vm.getCouponBarSize();if(this.couponInfoView=new TKView,this.couponInfoView.style={position:"absolute",left:t.left,bottom:t.bottom,width:t.width,height:t.height,flexDirection:"row",alignItems:"center"},this.vm.needCouponBarBg()){let e=new TKImage;e.style={width:t.width,height:t.height,position:"absolute",left:0,right:0,bottom:0},ke(e,"ec_card_coupon_bar.png"),this.couponInfoView.appendChild(e)}this.bgContainerView.appendChild(this.couponInfoView),this.priceView=new TKView,this.priceView.style={paddingLeft:8,height:69,width:"33%",marginRight:-4,flexDirection:"row",alignItems:"center",justifyContent:"center"},this.couponInfoView.appendChild(this.priceView);const e=this.getMeatureSize(this.vm.isVertical()?30:20);this.priceSymbolText=new TKText,this.priceSymbolText.style={fontSize:16,fontWeight:"500",color:"#FFFFFF",marginTop:(30==e?8:6)*e/30},this.priceSymbolText.setText("￥"),this.priceView.appendChild(this.priceSymbolText),this.priceText=new TKText,this.priceText.style={fontSize:e,color:"#FFFFFF",fontWeight:"600",width:"auto",textLineClamp:1,textOverflow:"ellipsis"},this.priceText.setText(this.vm.getPriceAmount()),this.priceView.appendChild(this.priceText),this.couponDescView=new TKView,this.couponDescView.style={flexDirection:"column",height:69,width:"64%",paddingRight:10,justifyContent:"center"},this.couponInfoView.appendChild(this.couponDescView),this.couponTitleText=new TKText,this.couponTitleText.style={fontSize:15,color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",fontWeight:"600"},this.couponTitleText.setText(this.vm.getCouponTitle()),this.couponDescView.appendChild(this.couponTitleText),this.couponDescText=new TKText,this.couponDescText.style={fontSize:10,color:"#FFFFFF",marginTop:4,textLineClamp:1,textOverflow:"ellipsis"},this.couponDescText.setText(this.vm.getCouponDesc()),this.couponDescView.appendChild(this.couponDescText)}setupTipsView(){let t=this.vm.getBottomTipsText();if(be(t))return;let e=new TKText;e.style={maxWidth:"273",height:"15",fontSize:10,color:"#EB220B",opacity:.5,includeFontPadding:!1,textAlign:"center",position:"absolute",bottom:this.vm.getBottomTipsMarginBottom()},e.setText(t),this.bgContainerView.appendChild(e)}setupActionbarView(){this.vm.enableShowActionbarView()&&(this.actionbarView=new TKView,this.actionbarView.style={width:169,height:48,borderRadius:this.actionBarSize.height/2,marginTop:16},this.bottomContainerView.appendChild(this.actionbarView),this.actionbarBgImageView=new TKImage,this.actionbarBgImageView.style={width:169,height:48},ke(this.actionbarBgImageView,"ec_card_actionbar_bg.png"),this.actionbarView.appendChild(this.actionbarBgImageView),this.actionbarText=new TKText,this.actionbarText.style={position:"absolute",left:0,top:-1,fontWeight:"600",width:169,height:48,paddingLeft:10,paddingRight:10,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center",color:"#FFFFFF",fontSize:20},this.actionbarView.appendChild(this.actionbarText),1==this.vm.callerContext.adInfo.adBaseInfo.adOperationType?Li(this.actionbarText,"text",this.vm.$attrsPath.actionBarText):this.actionbarText.setText(this.vm.getActionbarDesc()))}setupBottomContainerView(){this.bottomContainerView=new TKView,this.bottomContainerView.style={width:"100%",height:114,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.setupActionbarView(),this.setupCloseView(),this.vm.useLegacyAnim()?this.tryShowSweepAnimation():this.switchTitleAndBottom(!1),this.rootContainerView.appendChild(this.bottomContainerView)}tryShowSweepAnimation(){if(this.vm.enableAnimation()&&(Pe.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),2e3)),this.vm.enableHandBreathAnim())){let t=new fr;t.style={width:110,height:110,top:0,right:(this.vm.callerContext.containerLimit.width-this.actionBarSize.width)/2-40,position:"absolute"},this.bottomContainerView.appendChild(t)}}addSweepAnimation(){if(this.sweepView&&this.actionbarView.removeChild(this.sweepView),Pe.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:this.actionBarSize.height,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=128*this.actionBarSize.height/60;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,position:"absolute"},this.sweepView.appendChild(this.sweepImage),ke(this.sweepImage,"ksad_light.png"),this.actionbarView.appendChild(this.sweepView),this.sweepImage.addAnimation(zi(1e3,this.actionBarSize.width+t),"anim")}}setupCloseView(){this.vm.enableShowCloseView()&&(this.closeImage=new TKImage,this.closeImage.style={width:40,height:40,marginTop:10},ke(this.closeImage,"ec_card_close.png"),this.bottomContainerView.appendChild(this.closeImage))}show(){this.vm.useLegacyAnim()?br.addCouponLegacyCardShowAnimation(this.rootContainerView,this.cardAnimFinish):br.addCardShowAnimation(this.bgContainerView,(()=>{this.switchTitleAndBottom(!0),this.tryShowSweepAnimation(),this.cardAnimFinish&&this.cardAnimFinish()})),this.vm.logRightsImp("ecommerce_coupon",27),this.closeCallbackCalled=!1}switchTitleAndBottom(t){this.countDownTextView.style={opacity:t?1:0},this.actionbarView.style={opacity:t?1:0},this.closeImage.style={opacity:t?.6:0}}updateCountdown(t){this.countDownTextView&&this.countDownTextView.setText(`限时福利 ${t}s 后消失`)}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:54,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(54,2).height>1.5*t){if((t-=2)<=18)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}tryReportImpression(){this.vm.logSplashCardImpression()}getActionBarSize(){return{width:169,height:48}}fitHorizontalScreenView(){}}class xr extends Sr{constructor(t){super(t)}fitHorizontalScreenView(){this.rootContainerView.style={paddingBottom:0},this.bgContainerView.style={width:181,height:175},this.bgImageView.style={width:181,height:175},this.bgBottomImageView.style={width:181,height:175},this.countDownTextView&&(this.countDownTextView.style={fontSize:16,marginBottom:4}),this.cardInfoView.style={left:26,top:26,width:60},this.cardTitleText.style={fontSize:14},this.cardDescText.style={fontSize:8},this.ipImageView.style={width:83,height:83,right:8,top:1},this.couponInfoView.style={left:21,bottom:25,width:140,height:46},this.priceView.style={paddingLeft:4,height:40},this.priceSymbolText.style={fontSize:10,marginRight:-2},this.priceText.style={width:32},this.couponDescView.style={height:40},this.couponTitleText.style={fontSize:10},this.couponDescText.style={fontSize:7,marginTop:2},this.actionbarView&&(this.actionbarView.style={width:113,height:32,marginTop:10},this.actionbarBgImageView.style={width:113,height:32},this.actionbarText.style={width:113,height:32,fontSize:14},this.closeImage&&(this.closeImage.style={width:32,height:32,marginTop:6}))}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:32,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(32,2).height>1.5*t){if((t-=2)<=12)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}getActionBarSize(){return{width:112,height:32}}}class Lr extends TKView{constructor(t){super(),this.startDismissCalled=!1,this.vm=t,this.setupViews(),this.setupActions(),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.onDismiss(2))}))}setupViews(){this.setupRootView(),this.setupCountDownView(),this.setupBgView(),this.setupCardInfoView(),this.setupTipsView(),this.setupActionbarView(),this.setupCloseView()}setupRootView(){this.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"absolute"},this.contentView=new TKView,this.contentView.style={width:"100%",height:this.vm.getFullCardHeight(),flexDirection:"column",alignItems:"center",justifyContent:"center"},this.appendChild(this.contentView),this.contentView.clipChildren=!1,this.wrapperView=new TKView,this.wrapperView.style={width:"100%",height:this.vm.getFullCardHeight(),flexDirection:"column",alignItems:"center",justifyContent:"center"},this.contentView.appendChild(this.wrapperView),this.wrapperView.clipChildren=!1;const t=new TKView;t.style={width:"100%",marginTop:0,height:this.vm.getBottomTipsMarginBottom(52)},this.appendChild(t)}setupCountDownView(){let t=this.vm.getTitleSize();const e=new TKView;e.style={width:t.width,height:t.height,top:0,alignItems:"center",justifyContent:"center",position:"absolute"},this.wrapperView.appendChild(e),this.titleBg=new TKImage,this.titleBg.style={width:t.width,height:t.height,position:"absolute"},ke(this.titleBg,"product_card_title_bg.png"),e.appendChild(this.titleBg),this.titleText=new TKText,this.titleText.style={color:"#FFFCF7",position:"absolute",fontWeight:"600",fontSize:32,height:45,width:"100%",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.titleText.setText("限时"+this.vm.getRightsCardStayTime()+"秒后消失"),e.appendChild(this.titleText)}setupBgView(){let t=this.vm.getCardBgSize();this.containerView=new TKView,this.containerView.style={width:t.width,height:t.height,flexDirection:"column",top:this.vm.getCardMarginTop(124),position:"absolute",left:0,right:0,alignItems:"center",justifyContent:"center"},this.contentView.appendChild(this.containerView);let e=this.vm.getFullCardBgUrl();be(e)||(this.cardBgView=new TKImage,this.cardBgView.style={width:"100%",height:"100%",position:"absolute"},ke(this.cardBgView,e),this.containerView.appendChild(this.cardBgView));let i=this.vm.getWidgetSize();const n=new TKImage;n.style={width:i.width,height:i.height,top:this.vm.getCardMarginTop(11),position:"absolute"},ke(n,"ec_activity_automaton.png"),this.containerView.appendChild(n);let s=this.vm.getCardViewSize();this.cardView=new TKImage,this.cardView.style={width:s.width,height:s.height,borderRadius:s.borderRadius,position:"absolute"},this.cardView.setSrc(this.vm.getRightsCardCustomImageUrl()),this.containerView.appendChild(this.cardView)}setupCardInfoView(){this.rightCardTitleText=new TKText,this.rightCardTitleText.style={width:200,fontSize:20,fontWeight:"500",color:"#FFFCF1",height:28,top:this.vm.getCardMarginTop(91),textAlign:"center",textLineClamp:1,textOverflow:"clip",position:"absolute"},this.rightCardTitleText.setText(this.vm.getRightsCardTitle()),this.containerView.appendChild(this.rightCardTitleText)}setupTipsView(){let t=this.vm.getBottomTipsText();if(be(t))return;let e=new TKText;e.style={width:"100%",height:15,fontSize:10,color:"#FFF9F9",opacity:.5,includeFontPadding:!1,fontWeight:"400",textAlign:"center",position:"absolute",bottom:this.vm.getBottomTipsMarginBottom(42)},e.setText(t),this.containerView.appendChild(e)}setupActionbarView(){this.actionBarView=new TKView,this.actionBarView.style={width:this.vm.getButtonSize().width,height:this.vm.getButtonSize().height,borderRadius:this.vm.getButtonSize().borderRadius,bottom:this.vm.getBottomTipsMarginBottom(64),position:"absolute"},this.contentView.appendChild(this.actionBarView),this.actionBarView.clipChildren=!1;let t=new TKImage;t.style={width:"100%",height:"100%",position:"absolute"},ke(t,"product_card_button.png"),this.actionBarView.appendChild(t),this.actionBarText=new TKText,this.actionBarText.style={color:"#FFFFFF",width:"90%",height:"100%",alignSelf:"center",fontWeight:"600",fontSize:20,position:"absolute",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLetterSpace:1.5},this.actionBarText.setText(this.vm.getRightsCardAction()),this.actionBarView.appendChild(this.actionBarText)}setupCloseView(){this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={bottom:0,width:40,height:40,opacity:0,resize:"contain",position:"absolute"},this.wrapperView.appendChild(this.closeView)}showRightsDialogCard(t,e){const i=this;this.titleBg.style={opacity:0},this.titleText.style={opacity:0},this.actionBarView.style={opacity:0},this.closeView.style={opacity:0},br.addCardShowAnimation(this.containerView,(()=>{i.titleAndBottomShow(),i.cricleAnimation(),i.cardAppearCallback&&i.cardAppearCallback()})),this.showType=t,this.vm.logRightsImp(this.showType,e),this.startDismissCalled=!1}titleAndBottomShow(){this.titleBg.style={opacity:1},this.titleText.style={opacity:1},this.actionBarView.style={opacity:1},this.closeView.style={opacity:.6}}cricleAnimation(){Pe.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080));let t=new fr,e=(this.vm.callerContext.containerLimit.width-Number(this.vm.getButtonSize().width))/2-25;t.style={width:this.vm.getHandViewSideLength(),height:this.vm.getHandViewSideLength(),right:e,bottom:40,position:"absolute"},this.contentView.appendChild(t)}addSweepAnimation(){if(this.sweepView&&this.actionBarView.removeChild(this.sweepView),Pe.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.vm.getButtonSize().width,height:this.vm.getButtonSize().height,borderRadius:this.vm.getButtonSize().borderRadius,left:0,top:0,position:"absolute"};const t=34;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.vm.getButtonSize().height,left:-t,top:0,opacity:1,position:"absolute"},this.sweepView.appendChild(this.sweepImage),ke(this.sweepImage,"icon_ksad_extra_reward_sweep.png"),this.actionBarView.appendChild(this.sweepView);let e=t+Number(this.vm.getButtonSize().width);this.sweepImage.addAnimation(zi(540,e),"anim")}}setupActions(){wt(this.vm.callerContext.adInfo,1)&&this.actionBarView.addEventListener("tap",(e=>{const i=Te(e,this.actionBarView);let n=new S;n.template_show_type=this.showType,this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),wt(this.vm.callerContext.adInfo,2)&&this.containerView.addEventListener("tap",(e=>{const i=Te(e,this.containerView);let n=new S;n.template_show_type=this.showType,this.vm.convert(i,2,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),this.closeView.addEventListener("tap",(t=>{this.onDismiss(1)}))}updateCountdown(t){this.titleText&&this.titleText.setText(`限时${t}秒后消失`)}onDismiss(t){this.startDismissCalled||(this.startDismissCallback&&this.startDismissCallback(this.contentView,t),this.removeAllAnimation(),this.sweepTimer&&clearInterval(this.sweepTimer),this.startDismissCalled=!0)}}class _r extends TKView{constructor(t){super(),this.vm=t,_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"==t&&this.timePlay&&this.timePlay.resume(),"pageInvisiable"==t&&this.timePlay&&this.timePlay.paused()})),Pe.supportMinimumTKVersion("5.0.0")&&this.initViews()}initViews(){this.style={width:"100%",height:"100%",backgroundColor:"#00000099",alignContent:"center",alignItems:"center",justifyContent:"center"},this.containerView=new TKView,this.containerView.style={width:"100%",height:"100%",alignContent:"center",alignItems:"center",justifyContent:"center"},this.appendChild(this.containerView),Pe.supportMinimumTKVersion("5.0.0")&&(this.lottieView1=new TKLottieImageView,this.lottieView1.style={width:500,height:515,opacity:0,position:"absolute"},this.containerView.appendChild(this.lottieView1),this.lottieView1.setUri(Fe("ecIndustry_interact_atmosphere_lottie1.json")),this.lottieView2=new TKLottieImageView,this.lottieView2.style={width:500,height:515,opacity:0,position:"absolute"},this.containerView.appendChild(this.lottieView2),this.lottieView2.setUri(Fe("ecIndustry_interact_atmosphere_lottie2.json")))}showECIndustCard(){this.vm.enableInteractCard()?this.showInteractCard():this.showRightsCard()}showInteractCard(){this.interactView=new Tr(this.vm),this.containerView.appendChild(this.interactView),this.interactView.callbackClose=this.callbackClose,this.interactView.interactCallback=()=>{this.dismissAnim(),this.lottieView1.style={opacity:1},this.lottieView1.play();const t=this;this.lottieView1.onAnimationEnd((()=>{t.removeChild(t.lottieView1),t.lottieView2.style={opacity:1},t.lottieView2.play(),t.lottieView2.setLoop(!0)}))}}dismissAnim(){const t=new TKImage;t.style={width:324,height:445,opacity:0,position:"absolute"},this.containerView.appendChild(t),ke(t,"ecIndustry_interact_gold_card.png");let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={transform:{scale:1.14},opacity:1},1)]),e.duration=330,e.timingFunction="linear",t.addAnimation(e,"goldViewOpacityAnim"),e.on("end",(()=>{let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={opacity:0},1)]),e.duration=170,e.timingFunction="linear",t.addAnimation(e,"goldViewDismissAnim"),this.showRightsCard()}));const i=this;let n=new TKKeyframeAnimation;n.setAnimations([()=>(i.interactView.style={transform:{scale:1.106},opacity:1},.76),()=>(i.interactView.style={transform:{scale:1.127},opacity:0},.91),()=>(i.interactView.style={transform:{scale:1.14},opacity:0},1)]),n.duration=330,n.timingFunction="linear",i.interactView.addAnimation(n,"dissmissAnim"),n.on("end",(()=>{i.removeChild(i.interactView)}))}showRightsCard(){if(this.vm.industryInfo){switch(this.vm.industryInfo.merchantStyleType){case I.COUPON:this.showCouponCard();break;case I.EVENT:this.showActivityCard("benefit_card_activity",26);break;case I.PRODUCT:case I.PRODUCT_DEEP_VIDEO:this.showProductCard();break;case I.DEFAULT:this.showActivityCard("benefit_card_default",28)}}else this.vm.isCouponLegacy()&&this.showCouponCard();this.startTimer()}startTimer(){this.timePlay=new hn(1e3*this.vm.getRightsCardStayTime()),this.timePlay.setTimerInterval(1e3),this.timePlay.onFinishCallback=()=>{this.productView?this.productView.onDismiss(2):this.activityView?this.activityView.onDismiss(2):this.ecCardView?this.ecCardView.handleCloseClick(2):this.callbackClose&&this.callbackClose(2),this.timePlay&&this.timePlay.stop()},this.timePlay.countDownCallback=t=>{this.updateCountdown(t.toFixed())}}updateCountdown(t){this.ecCardView&&this.ecCardView.updateCountdown(t),this.productView&&this.productView.updateCountdown(t),this.activityView&&this.activityView.updateCountdown(t)}showProductCard(){if(this.productView)return;let t=this.vm;this.productView=new Ar(t),this.containerView.appendChild(this.productView);const e=this;this.productView.startDismissCallback=(t,i)=>{e.dismissCardAnimation(t,"productDismiss",(()=>{e.callbackClose&&e.callbackClose(i)}))},this.productView.showRightsDialogCard(),this.productView.cardAppearCallback=()=>{this.timePlay.play()}}showCouponCard(){if(this.ecCardView)return;let t=this.vm;t.isVertical()?this.ecCardView=new Sr(t):this.ecCardView=new xr(t);const e=this;this.ecCardView.onCloseClick=(t,i)=>{e.dismissCardAnimation(t,"productDismiss",(()=>{e.callbackClose&&e.callbackClose(i)}))},this.containerView.appendChild(this.ecCardView),this.ecCardView.cardAnimFinish=()=>{this.timePlay.play()},this.ecCardView.show()}showActivityCard(t,e){if(this.activityView)return;let i=this.vm;this.activityView=new Lr(i),this.lottieView1&&(this.lottieView1.style={width:i.getLottieSize().width,height:i.getLottieSize().height}),this.lottieView2&&(this.lottieView2.style={width:i.getLottieSize().width,height:i.getLottieSize().height}),this.containerView.appendChild(this.activityView);const n=this;this.activityView.startDismissCallback=(t,e)=>{n.dismissCardAnimation(t,"activityViewDismiss",(()=>{n.callbackClose&&n.callbackClose(e)}))},this.activityView.showRightsDialogCard(t,e),this.activityView.cardAppearCallback=()=>{this.timePlay.play()}}dismissCardAnimation(t,e,i){this.lottieView2.stop(),this.removeChild(this.lottieView2);let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{translate:{y:8}}},1)]),n.duration=250,n.timingFunction="0.42 0 0.58 1",t.addAnimation(n,e),n.on("end",(()=>{let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{translate:{y:-16.7}},opacity:1},.333),()=>(t.style={transform:{translate:{y:-50}},opacity:0},1)]),n.duration=300,n.timingFunction="0.42 0 0.58 1";const s=e+"ScaleAnim";t.addAnimation(n,s),n.on("end",(()=>{i&&i()}))}))}}class Dr extends TKView{constructor(t){super(),this.vm=t,this.setupView(),this.setupAction(),this.fitHorizontalScreenView(),this.vm.getActionBarRect=()=>({x:this.actionbarView.getOrigin().x,y:this.actionbarView.getOrigin().y,width:169,height:48}),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&this.sweepTimer&&clearInterval(this.sweepTimer)}))}setupView(){this.setupRootView(),this.setupCountDownView(),this.setupBgView(),this.setupCardInfoView(),this.setupCouponInfoView(),this.setupActionbarView(),this.setupCloseView(),this.tryReportImpression()}setupAction(){this.actionbarView&&this.actionbarView.addEventListener("tap",(e=>{const i=Te(e,this.actionbarView);this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK),this.vm.enableShowCloseView()&&this.onCloseClick&&this.onCloseClick(3)})),this.closeImage&&this.closeImage.addEventListener("tap",(t=>{this.onCloseClick&&this.onCloseClick(1)})),this.vm.isSplashScene()||this.vm.isInterstitialScene()||this.bgContainerView.addEventListener("tap",(e=>{const i=Te(e,this.bgContainerView);this.vm.convert(i,2,t.CARD_OTHERAREA_CLICK),this.onCloseClick&&this.onCloseClick(3)}))}setupRootView(){this.actionBarSize=this.getActionBarSize(),this.style={width:"100%",height:"100%",backgroundColor:"#00000099",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.rootContainerView=new TKView,this.rootContainerView.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingBottom:52},this.vm.enableShowCloseView()&&(this.rootContainerView.style={transform:{scale:0},opacity:0}),this.appendChild(this.rootContainerView)}setupCountDownView(){if(!this.vm.enableShowCountDownView())return;let t=new TKView;t.style={shadow:"0 0 26 #FFDF8E99"},this.countDownTextView=new TKText,this.countDownTextView.style={fontSize:22,marginBottom:8,fontWeight:"600",color:Pe.isAndroid()?"#FFE296":"#FFF7E0",gradientTextColor:"270,FFFFFF,FFE296"},t.appendChild(this.countDownTextView),this.countDownTextView.setText("限时福利 "+this.vm.getRightsCardStayTime()+"s 后消失"),this.rootContainerView.appendChild(t)}setupBgView(){this.bgContainerView=new TKView,this.bgContainerView.style={width:273,height:263,flexDirection:"column",alignItems:"center"},this.rootContainerView.appendChild(this.bgContainerView),this.bgImageView=new TKImage,this.bgImageView.style={width:273,height:263,bottomLeftRadius:60,bottomRightRadius:60},this.bgImageView.setSrc(this.vm.getBgUrl()),this.bgContainerView.appendChild(this.bgImageView),this.setupIPView(),this.bgBottomImageView=new TKImage,this.bgBottomImageView.style={width:273,height:263,position:"absolute",left:0,top:0},ke(this.bgBottomImageView,this.vm.getBottomImageViewName()),this.bgContainerView.appendChild(this.bgBottomImageView),this.setupTipsView()}setupTipsView(){let t=this.vm.getBottomTipsText();if(be(t))return;let e=new TKText;e.style={maxWidth:"249",height:"15",fontSize:10,color:"#B8AB3B",includeFontPadding:!1,textAlign:"center",position:"absolute",bottom:10},e.setText(t),this.bgContainerView.appendChild(e)}setupCardInfoView(){this.cardInfoView=new TKView,this.cardInfoView.style={position:"absolute",left:40,width:84,top:34,flexDirection:"column"},this.bgContainerView.appendChild(this.cardInfoView),this.cardTitleText=new TKText,this.cardTitleText.style={fontSize:20,fontWeight:"900",color:"#FFFFFF"},this.cardTitleText.setText("恭喜获得"),this.cardInfoView.appendChild(this.cardTitleText),this.cardDescText=new TKText,this.cardDescText.style={color:"#FFFFFF",fontSize:11,marginTop:2,width:"100%",textLineClamp:1,textOverflow:"ellipsis"},this.cardDescText.setText(this.vm.getTitleDesc()),this.cardInfoView.appendChild(this.cardDescText)}setupIPView(){this.ipImageView=new TKImage,this.ipImageView.style={position:"absolute",right:12,top:1,width:134,height:134},this.ipImageView.setSrc(this.vm.getUserIcon()),this.bgContainerView.appendChild(this.ipImageView)}setupCouponInfoView(){this.couponInfoView=new TKView,this.couponInfoView.style={position:"absolute",left:31,bottom:38,width:211,height:69,flexDirection:"row",alignItems:"center"},this.bgContainerView.appendChild(this.couponInfoView),this.priceView=new TKView,this.priceView.style={paddingLeft:8,height:69,width:"36%",flexDirection:"row",alignItems:"center"},this.couponInfoView.appendChild(this.priceView);const t=this.getMeatureSize(this.vm.isVertical()?30:20);this.priceSymbolText=new TKText,this.priceSymbolText.style={fontSize:16,fontWeight:"500",color:"#FFFFFF",marginRight:-4,marginTop:(30==t?8:6)*t/30},this.priceSymbolText.setText("￥"),this.priceView.appendChild(this.priceSymbolText),this.priceText=new TKText,this.priceText.style={fontSize:t,color:"#FFFFFF",fontWeight:"600",width:54,textLineClamp:1,textOverflow:"ellipsis"},this.priceText.setText(this.vm.getPriceAmount()),this.priceView.appendChild(this.priceText),this.couponDescView=new TKView,this.couponDescView.style={flexDirection:"column",height:69,width:"64%",paddingRight:10,justifyContent:"center"},this.couponInfoView.appendChild(this.couponDescView),this.couponTitleText=new TKText,this.couponTitleText.style={fontSize:15,color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",fontWeight:"600"},this.couponTitleText.setText(this.vm.getCouponTitle()),this.couponDescView.appendChild(this.couponTitleText),this.couponDescText=new TKText,this.couponDescText.style={fontSize:10,color:"#FFFFFF",marginTop:4,textLineClamp:1,textOverflow:"ellipsis"},this.couponDescText.setText(this.vm.getCouponDesc()),this.couponDescView.appendChild(this.couponDescText)}setupActionbarView(){this.vm.enableShowActionbarView()&&(this.actionbarView=new TKView,this.actionbarView.style={width:169,height:48,borderRadius:this.actionBarSize.height/2,marginTop:16},this.rootContainerView.appendChild(this.actionbarView),this.actionbarBgImageView=new TKImage,this.actionbarBgImageView.style={width:169,height:48},ke(this.actionbarBgImageView,"ec_card_actionbar_bg.png"),this.actionbarView.appendChild(this.actionbarBgImageView),this.actionbarText=new TKText,this.actionbarText.style={position:"absolute",left:0,top:-1,fontWeight:"600",width:169,height:48,paddingLeft:10,paddingRight:10,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center",color:"#FFFFFF",fontSize:20},this.actionbarView.appendChild(this.actionbarText),1==this.vm.callerContext.adInfo.adBaseInfo.adOperationType?Li(this.actionbarText,"text",this.vm.$attrsPath.actionBarText):this.actionbarText.setText(this.vm.getActionbarDesc()),this.tryShowSweepAnimation())}tryShowSweepAnimation(){this.vm.enableAnimation()&&Pe.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),2e3))}addSweepAnimation(){if(this.sweepView&&this.actionbarView.removeChild(this.sweepView),Pe.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:this.actionBarSize.height,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=128*this.actionBarSize.height/60;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,position:"absolute"},this.sweepView.appendChild(this.sweepImage),ke(this.sweepImage,"ksad_light.png"),this.actionbarView.appendChild(this.sweepView),this.sweepImage.addAnimation(zi(1e3,this.actionBarSize.width+t),"anim")}}setupCloseView(){this.vm.enableShowCloseView()&&(this.closeImage=new TKImage,this.closeImage.style={width:40,height:40,marginTop:10},ke(this.closeImage,"ec_card_close.png"),this.rootContainerView.appendChild(this.closeImage))}show(){this.startShowAnimation()}updateCountdown(t){this.countDownTextView&&this.countDownTextView.setText(`限时福利 ${t}s 后消失`)}startShowAnimation(){let t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.rootContainerView.style={transform:{scale:0},opacity:0},0),()=>(t.rootContainerView.style={transform:{scale:1},opacity:1},1)]),e.duration=600,e.timingFunction="linear",this.rootContainerView.addAnimation(e,"ecShowAnimation")}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:54,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(54,2).height>1.5*t){if((t-=2)<=18)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}tryReportImpression(){this.vm.logSplashCardImpression()}getActionBarSize(){return{width:169,height:48}}fitHorizontalScreenView(){}}class Fr extends Dr{constructor(t){super(t)}fitHorizontalScreenView(){this.rootContainerView.style={paddingBottom:0},this.bgContainerView.style={width:181,height:175},this.bgImageView.style={width:181,height:175},this.bgBottomImageView.style={width:181,height:175},this.countDownTextView&&(this.countDownTextView.style={fontSize:16,marginBottom:4}),this.cardInfoView.style={left:26,top:26,width:60},this.cardTitleText.style={fontSize:14},this.cardDescText.style={fontSize:8},this.ipImageView.style={width:83,height:83,right:8,top:1},this.couponInfoView.style={left:21,bottom:25,width:140,height:46},this.priceView.style={paddingLeft:4,height:40},this.priceSymbolText.style={fontSize:10,marginRight:-2},this.priceText.style={width:32},this.couponDescView.style={height:40},this.couponTitleText.style={fontSize:10},this.couponDescText.style={fontSize:7,marginTop:2},this.actionbarView&&(this.actionbarView.style={width:113,height:32,marginTop:10},this.actionbarBgImageView.style={width:113,height:32},this.actionbarText.style={width:113,height:32,fontSize:14},this.closeImage&&(this.closeImage.style={width:32,height:32,marginTop:6}))}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:32,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(32,2).height>1.5*t){if((t-=2)<=12)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}getActionBarSize(){return{width:112,height:32}}}class kr extends En{constructor(t){super(),this.mTimerInterval=100,this.mTimerCurrent=0,this.mTimerPaused=!1,this.showLegacyView=!1,this.vm=t,this.mTotalStayTime=1e3*this.vm.getRightsCardStayTime(),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"!=t&&"pageInvisiable"!=t||(this.mTimerPaused="pageVisiable"!=t)}))}initView(){if(Pe.supportMinimumTKVersion("5.0.0")){this.vm.getRightsCardVM();this.showLegacyView=this.vm.isLegacyVM(),this.showLegacyView?this.setupOldCouponView():this.setupViews()}}showDialog(t){this.isShowing()||null==this.ecCardView&&this.showLegacyView||(null!=this.interactView||this.showLegacyView)&&(super.showDialog(t),this.showLegacyView?(this.ecCardView.show(),this.couponVM.logECCardImpression(),this.startTimer()):this.interactView.showECIndustCard())}setupOldCouponView(){this.couponVM=this.vm.getRightsCardVM(),this.vm.isVertical()?this.ecCardView=new Dr(this.couponVM):this.ecCardView=new Fr(this.couponVM),this.ecCardView.onCloseClick=t=>{this.callbackCloseTrigger(t)},this.vm.cardCreateSuccess=null!=this.ecCardView,this.appendChild(this.ecCardView)}setupViews(){let t=this.vm.getRightsCardVM();t&&(this.vm.isVertical()||t.supportHorizontal())&&(this.interactView=new _r(this.vm.getRightsCardVM())),this.vm.cardCreateSuccess=null!=this.interactView,this.interactView&&(this.interactView=new _r(this.vm.getRightsCardVM()),this.interactView.callbackClose=t=>{this.callbackCloseTrigger(t)},this.appendChild(this.interactView))}callbackCloseTrigger(t){this.vm.logCloseReport(t,this.vm.getRightsCardVM().templateShowType),this.onCloseTrigger&&this.onCloseTrigger()}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{if(!this.mTimerPaused)if(this.mTimerCurrent+=this.mTimerInterval,this.mTimerCurrent>this.mTotalStayTime)this.stopTimer(),this.callbackCloseTrigger(2);else if(this.mTimerCurrent<this.mTotalStayTime){let t=Math.ceil((this.mTotalStayTime-this.mTimerCurrent)/1e3).toFixed();this.updateCountdown(t)}}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}updateCountdown(t){this.ecCardView.updateCountdown(t)}}const Rr="rights_bg_animation_circle.png",Br="rights_card_gift.png";class Er extends TKView{constructor(t){super(),this.actionBarSize={width:235,height:48},this.vm=t,this.setupViews()}setupViews(){this.style={height:"100%",width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute"},this.setupContainer();const t=this;_i(this.vm.$attrsPath.callerContext.lifeStatus,(e=>{"hideEnd"==e&&t.onDismiss(),"pageVisiable"==e&&t.timePlay&&t.timePlay.resume(),"pageInvisiable"==e&&t.timePlay&&t.timePlay.paused()}))}showWidget(){this.titleText.style={opacity:0},this.titleBg.style={opacity:0},this.lightImage.style={opacity:0},this.cardBgView.style={opacity:0},this.closeView.style={opacity:0},Pe.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080));let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.cardContent.style={transform:{scale:1}},0),()=>(this.cardContent.style={transform:{scale:.6}},1)]),t.duration=350,t.timingFunction="linear",this.cardContent.addAnimation(t,"cardAnim");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.actionBarView.style={transform:{scale:1,translate:{y:0}}},0),()=>(this.actionBarView.style={transform:{scale:.8,translate:{y:-143}}},1)]),e.duration=350,e.timingFunction="linear",this.actionBarView.addAnimation(e,"buttonAnim");const i=this;e.on("end",(()=>{let t=this.vm.getRightsCardCodeDesc()+this.vm.getRightsCardCode();Ie(t)||(t=this.vm.getRightsCardAction()),i.actionBarText.setText(t)}))}showRightsDialogCard(){const t=this;this.timePlay=new hn(this.vm.getRightsShowTime()),this.timePlay.onFinishCallback=()=>{t.callbackClose&&t.callbackClose(2),t.onDismiss()},this.timePlay.play(),this.titleBg.style={opacity:0},this.titleText.style={opacity:0},this.actionBarView.style={opacity:0},this.cardContent.style={transform:{scale:.3,translate:{y:120}}},this.showCardAnimation((()=>{t.titleAndBottomShow(),t.cricleAnimation()})),setTimeout((()=>{this.showBubbleBg()}),140),this.vm.logRightsImp(),this.setupActions(),this.vm.copyRightsCode()}showCardAnimation(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.cardContent.style={transform:{scale:.2,translate:{y:120}}},0),()=>(this.cardContent.style={transform:{scale:1.03,translate:{y:0}}},1)]),e.duration=250,e.timingFunction="linear",this.cardContent.addAnimation(e,"cardContentAnim");const i=this;e.on("end",(()=>{t&&t();let e=new TKKeyframeAnimation;e.setAnimations([()=>(i.cardContent.style={transform:{scale:1.03}},0),()=>(i.cardContent.style={transform:{scale:.96}},.5),()=>(i.cardContent.style={transform:{scale:1}},1)]),e.duration=400,e.timingFunction="linear",i.cardContent.addAnimation(e,"cardScaleAnim"),e.on("end",(()=>{}))}))}showBubbleBg(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.cardBgView.style={opacity:0},0),()=>(this.cardBgView.style={opacity:.5},1)]),t.duration=150,t.timingFunction="linear",this.cardBgView.addAnimation(t,"bubbleAnim")}titleAndBottomShow(){this.titleBg.style={opacity:1},this.titleText.style={opacity:1},this.actionBarView.style={opacity:1}}cricleAnimation(){Pe.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080)),this.lightHalfTimer&&clearInterval(this.lightHalfTimer),this.addHalfLightAnimation(this.lightHalfImage,.2),this.lightHalfTimer=setInterval((()=>{this.addHalfLightAnimation(this.lightHalfImage,.2)}),1200),this.lightTimer&&clearInterval(this.lightTimer),this.addLightAnimation(this.lightImage,1),this.lightTimer=setInterval((()=>{this.addLightAnimation(this.lightImage,1)}),1200),this.bubbleTimer&&clearInterval(this.bubbleTimer),this.addBubbleAnimation(),this.bubbleTimer=setInterval((()=>{this.addBubbleAnimation()}),1200);let t=new fr;t.style={width:90,height:90,right:(this.vm.callerContext.containerLimit.width-this.actionBarSize.width)/2-30,bottom:41,position:"absolute"},this.containerView.appendChild(t)}addBubbleAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.cardBgView.style={opacity:.5},0),()=>(this.cardBgView.style={opacity:1},.66),()=>(this.cardBgView.style={opacity:.5},1)]),t.duration=1200,t.timingFunction="linear",this.cardBgView.addAnimation(t,"bubbleCricleAnim")}addLightAnimation(t,e){t.style={opacity:0,transform:{scale:.2}};let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:e},.05),()=>(t.style={opacity:e},.77),()=>(t.style={opacity:0},1)]),i.duration=1100,i.timingFunction="linear",t.addAnimation(i,"opacityAnim"+e);let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{scale:.2}},0),()=>(t.style={transform:{scale:1.25}},1)]),n.duration=1100,n.timingFunction="linear",t.addAnimation(n,"scaleAnim"+e)}addHalfLightAnimation(t,e){t.style={opacity:0,transform:{scale:.2}};let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:e},.05),()=>(t.style={opacity:e},.77),()=>(t.style={opacity:0},1)]),i.duration=800,i.timingFunction="linear",t.addAnimation(i,"opacityAnim"+e);let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{scale:.2}},0),()=>(t.style={transform:{scale:1.25}},1)]),n.duration=800,n.timingFunction="linear",t.addAnimation(n,"scaleAnim"+e)}addSweepAnimation(){if(this.sweepView&&this.actionBarView.removeChild(this.sweepView),Pe.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:48,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=34;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,opacity:1,position:"absolute"},this.sweepView.appendChild(this.sweepImage),ke(this.sweepImage,"icon_ksad_extra_reward_sweep.png"),this.actionBarView.appendChild(this.sweepView),this.sweepImage.addAnimation(zi(540,this.actionBarSize.width+t),"anim")}}setupContainer(){this.containerView=new TKView,this.containerView.style={width:"100%",height:572,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.containerView.clipChildren=!1,this.appendChild(this.containerView),this.setupTitleView(this.containerView),this.setupCardBgView(this.containerView),this.setupCardView(this.containerView),this.setupActionbar(this.containerView),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={marginTop:28,width:40,height:40,opacity:.6,resize:"contain"},this.containerView.appendChild(this.closeView)}setupTitleView(t){const e=(this.vm.callerContext.containerLimit.height-572-256)/2+45;this.titleBg=new TKImage,this.titleBg.style={width:460,height:256,top:e+(Ce()?10:0),left:(this.vm.callerContext.containerLimit.width-460)/2,position:"absolute"},ke(this.titleBg,"rights_title_bg2.png"),this.insertBefore(this.titleBg,t),this.titleText=new TKText,this.titleText.style={color:"#FFFCF7",fontWeight:"600",fontSize:32,height:45,width:"100%",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.titleText.setText(this.vm.getRightsCardTitle()),t.appendChild(this.titleText)}setupCardBgView(t){const e=(this.vm.callerContext.containerLimit.width-406)/2;this.cardBgView=new TKImage,this.cardBgView.style={left:e,top:66,width:406,height:416,position:"absolute",opacity:0},ke(this.cardBgView,"rights_bg_bubble.png"),t.appendChild(this.cardBgView),this.lightHalfImage=new TKImage,this.lightHalfImage.style={left:(this.vm.callerContext.containerLimit.width-390)/2,top:72,width:390,height:390,opacity:0,position:"absolute"},ke(this.lightHalfImage,Rr),t.appendChild(this.lightHalfImage),this.lightImage=new TKImage,this.lightImage.style={left:(this.vm.callerContext.containerLimit.width-300)/2,top:117,width:300,height:300,opacity:0,position:"absolute"},ke(this.lightImage,Rr),t.appendChild(this.lightImage)}setupCardView(t){this.cardContent=new TKView,this.cardContent.clipChildren=!1,this.cardContent.style={marginTop:26,width:238,height:357},t.appendChild(this.cardContent);let e=new TKImage;e.style={left:-88,top:-42,width:414,height:441,opacity:.5,position:"absolute"},ke(e,"rights_card_bg_shadow2.png"),this.cardContent.appendChild(e);let i=new TKImage;i.style={width:"100%",height:"100%",position:"absolute"},ke(i,0==this.vm.clickType?"rights_card_bg2.png":"rights_card_bg_blue2.png"),this.cardContent.appendChild(i);let n=new TKImage;n.style={left:-59.5,bottom:-80,width:348,height:299,position:"absolute"},ke(n,0==this.vm.clickType?"rights_card_bg_halo2.png":"rights_card_bg_blue_halo2.png"),this.cardContent.appendChild(n);let s=new TKView;if(s.style={width:"100%",position:"absolute",alignSelf:"center",flexDirection:"row",justifyContent:"center",alignItems:"center"},this.cardContent.appendChild(s),0==this.vm.getRightsGiftStyle()){s.style={marginTop:Ie(this.vm.getRightsCardCode())?96:113,height:168};let t=new TKImage;ke(t,0==this.vm.clickType?"rights_card_gift_bg.png":"rights_card_gift_bg_blue.png"),t.style={width:168,height:168,alignSelf:"center",position:"absolute"},s.appendChild(t);let e,i=this.vm.getRightsIconLis();i.length>0&&(e=i[0]);let n=new TKImage;n.setSrc(e?e.cardIcon:Br),n.style={width:168,height:168,borderRadius:8,alignSelf:"center",position:"absolute"},s.appendChild(n)}else{s.style={marginTop:126,height:86,width:202};const t=this.vm.getRightsIconLis(),e=t.length>3?3:t.length;for(let i=0;i<e;i++){let e;t.length>i&&(e=t[i]);let n=new TKView;n.style={marginLeft:i>0?8:0,width:56,height:86},s.appendChild(n);let a=new TKImage;ke(a,0==this.vm.clickType?"rights_multi_num.png":"rights_multi_num_blue.png"),a.style={width:56,height:86,position:"absolute"},n.appendChild(a);let o=new TKImage;o.setSrc(e?e.cardIcon:Br),o.style={marginTop:14,width:56,height:56,alignSelf:"center",position:"absolute"},n.appendChild(o);let r=Ie(e.cardIconDesc)?e.cardIconDesc:"x1",h=new TKText;h.style={fontSize:11,fontWeight:"500",color:"#FFFFFF",height:15.5,width:"100%",textAlign:"center",position:"absolute",bottom:0,textLineClamp:1,textOverflow:"ellipsis"},h.setText(r),n.appendChild(h)}}if(Ie(this.vm.getRightsCardCode())){let t=new TKView;t.style={top:270,height:48,width:"100%",position:"absolute",flexDirection:"column",justifyContent:"space-between",alignItems:"center"},this.cardContent.appendChild(t);let e=new TKImage;e.style={width:168,height:8.5},ke(e,0==this.vm.clickType?"rights_card_line.png":"rights_card_line_blue.png"),t.appendChild(e);let i=new TKView;if(i.style={height:26,marginBottom:5,marginLeft:this.vm.enableCopy()?20:0,flexDirection:"row",justifyContent:"flex-start",alignItems:"flex-end"},t.appendChild(i),this.codeText=new TKText,this.codeText.style={maxWidth:"80%",fontSize:14,fontWeight:"400",color:0==this.vm.clickType?"#DE8029":"#569FAF",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.codeText.text=this.vm.getRightsCardCodeDesc()+this.vm.getRightsCardCode(),i.appendChild(this.codeText),this.vm.enableCopy()){let t=new TKView;t.style={marginLeft:3,width:36,height:"100%",flexDirection:"column",justifyContent:"flex-start"},i.appendChild(t);let e=new TKText;e.style={width:36,height:15,fontSize:8.5,fontWeight:"500",color:0==this.vm.clickType?"#DE8029":"#569FAF",backgroundColor:0==this.vm.clickType?"#F8E1AB":"#C6E8EF",textAlign:"center",topLeftRadius:7.5,topRightRadius:7.5,bottomRightRadius:7.5},e.text="已复制",t.appendChild(e)}}}setupActionbar(t){this.actionBarView=new TKView,this.actionBarView.style={marginTop:28,width:235,height:48,borderRadius:24},this.actionBarView.clipChildren=!0,t.appendChild(this.actionBarView);let e=new TKImage;e.style={width:"100%",height:"100%",position:"absolute"},ke(e,0==this.vm.clickType?"rights_button2.png":"rights_button_blue2.png"),this.actionBarView.appendChild(e),this.actionBarText=new TKText,this.actionBarText.style={color:"#FFFFFF",width:"90%",height:"100%",alignSelf:"center",fontWeight:"600",fontSize:20,position:"absolute",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLetterSpace:1.5},this.actionBarText.setText(this.vm.getRightsCardAction()),this.actionBarView.appendChild(this.actionBarText)}setupActions(){this.actionBarView.addEventListener("tap",(e=>{const i=Te(e,this.actionBarView);let n=new S;n.template_show_type="benefit_card",this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK,n),this.callbackClose&&this.callbackClose(3),this.onDismiss()})),this.cardContent.addEventListener("tap",(e=>{const i=Te(e,this.actionBarView);let n=new S;n.template_show_type="benefit_card",this.vm.convert(i,2,t.CARD_ACTION_BAR_CLICK,n),this.callbackClose&&this.callbackClose(3),this.onDismiss()})),this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose(2),this.onDismiss()}))}onDismiss(){this.removeAllAnimation(),this.timePlay&&this.timePlay.stop(),this.sweepTimer&&clearInterval(this.sweepTimer),this.lightTimer&&clearInterval(this.lightTimer),this.lightHalfTimer&&clearInterval(this.lightHalfTimer),this.bubbleTimer&&clearInterval(this.bubbleTimer)}}class Kr extends TKView{constructor(t){super(),this.isClick=!1,this.hasInteracted=!1,this.vm=t,this.vm.logInteractionImp(),this.setupViews(),this.showBaseAnim(this),this.showCardAnim(this.leftCardView,this.rightCardView),this.setupActions();const e=this;this.timePlay=new hn(this.vm.gameIndustryInfo.interactiveCardShowTime),this.timePlay.onFinishCallback=()=>{e.isClick||e.clickAction(0,3),this.isClick=!0},this.timePlay.play(),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&e.onDismiss(),"pageVisiable"==t&&e.timePlay&&e.timePlay.resume(),"pageInvisiable"==t&&e.timePlay&&e.timePlay.paused()}))}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",position:"absolute"};let t=new TKView;t.style={width:"100%",height:540,alignItems:"center"},this.appendChild(t),this.titleContentView=new TKView,this.titleContentView.style={width:382,height:87,top:12,justifyContent:"center",alignItems:"center"},t.appendChild(this.titleContentView);let e=new TKImage;e.style={width:382,height:87,position:"absolute"},ke(e,"interact_card_title_bg.png"),this.titleContentView.appendChild(e);let i=new TKText;i.style={width:"100%",height:45,color:"#FBE5C3",fontSize:32,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",fontWeight:"600"},i.setText(this.vm.getInteractTitle()),this.titleContentView.appendChild(i),this.subTitleContentView=new TKView,this.subTitleContentView.style={width:"100%",height:45,top:-7,flexDirection:"row",justifyContent:"center",alignItems:"center"},t.appendChild(this.subTitleContentView);let n=new TKImage;ke(n,"interact_card_subtitle_left.png"),n.style={width:32,height:6,right:8},this.subTitleContentView.appendChild(n);let s=new TKText;s.style={width:208,height:45,color:"#FBE5C3",fontSize:16,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center"},s.setText(this.vm.getInteractSubTitle()),this.subTitleContentView.appendChild(s);let a=new TKImage;ke(a,"interact_card_subtitle_right.png"),a.style={width:32,height:6,left:8},this.subTitleContentView.appendChild(a),this.cardBaseView=new TKView,this.cardBaseView.style={marginTop:5,width:"100%",height:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",position:"absolute"},t.appendChild(this.cardBaseView);let o=new TKView;o.style={width:"100%",height:"100%",position:"absolute",alignItems:"center",justifyContent:"center",flexDirection:"row"},this.cardBaseView.appendChild(o),this.leftLightView=new TKView,this.leftLightView.style={height:265,width:180,shadow:"0 0 10 #FFF4CD44",borderRadius:14,visibility:"hidden"},o.appendChild(this.leftLightView),this.rightLightView=new TKView,this.rightLightView.style={marginStart:12,height:265,width:180,shadow:"0 0 10 #FFF4CD44"},o.appendChild(this.rightLightView),this.leftCardBaseView=new TKView,this.leftCardBaseView.style={height:261,width:174},this.leftCardView=new TKImage,this.leftCardView.style={height:261,width:174},this.leftSweepView=new TKImage,this.leftSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1"},this.cardBaseView.appendChild(this.leftCardBaseView),this.leftCardBaseView.appendChild(this.leftCardView),this.leftCardBaseView.appendChild(this.leftSweepView),this.rightCardBaseView=new TKView,this.rightCardBaseView.style={marginStart:18,height:261,width:174},this.rightCardView=new TKImage,this.rightCardView.style={height:261,width:174},this.rightSweepView=new TKImage,this.rightSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1",visibility:"hidden"},this.cardBaseView.appendChild(this.rightCardBaseView),this.rightCardBaseView.appendChild(this.rightCardView),this.rightCardBaseView.appendChild(this.rightSweepView),Ie(this.vm.getInteractIcon())?(this.leftLightView.setVisibility("hidden"),this.leftSweepView.setVisibility("hidden"),this.rightLightView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.leftCardView.setSrc(this.vm.getInteractIcon()),this.rightCardView.setSrc(this.vm.getInteractIcon())):(this.leftLightView.setVisibility("visible"),this.leftSweepView.setVisibility("visible"),this.rightLightView.setVisibility("visible"),this.sweepAnimation(),setTimeout((()=>{this.rightSweepView.setVisibility("visible"),this.sweepRightAnimation()}),800),this.leftCardView.setSrc("image/ksad-video-image/interact_card_bg.png"),this.rightCardView.setSrc("image/ksad-video-image/interact_card_bg_blue.png")),setTimeout((()=>{this.handAndBreatheView=new fr,this.isClick||(this.handAndBreatheView.style={width:120,height:120,right:-20,top:290,position:"absolute"},this.cardBaseView.appendChild(this.handAndBreatheView))}),668),this.lampAndCloseContentView=new TKView,this.lampAndCloseContentView.style={marginTop:300,width:"100%",height:110,alignItems:"center"},t.appendChild(this.lampAndCloseContentView),this.tagView=new yr(this.vm.getInteractCustomerInfo()),this.tagView.style={width:"100%",height:40},this.lampAndCloseContentView.appendChild(this.tagView),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={marginTop:18,width:40,height:40,opacity:.6},this.lampAndCloseContentView.appendChild(this.closeView)}setupActions(){this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose(1),this.timePlay&&this.timePlay.stop()})),this.leftCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,this.clickAction(0,1))})),this.rightCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,Ie(this.vm.getInteractIcon())||(this.vm.clickType=1),this.clickAction(1,2))}))}clickAction(t,e){this.leftSweepView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.vm.logInteractionClick(e),0==t?this.clickCardAnim(this.leftCardBaseView,this.rightCardView,t,this.leftLightView,this.rightLightView):this.clickCardAnim(this.rightCardBaseView,this.leftCardView,t,this.rightLightView,this.leftLightView),this.clickBaseAnim(this.titleContentView,this.subTitleContentView,this.lampAndCloseContentView)}showBaseAnim(t){let e=new TKKeyframeAnimation;e.duration=15,e.timingFunction="linear",e.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:1},1)]),t.addAnimation(e,"leftShowAnimation")}showCardAnim(t,e){let i=new TKKeyframeAnimation;i.duration=250,i.timingFunction="linear",i.setAnimations([()=>(t.style={opacity:0,left:-150},0),()=>(t.style={left:0,opacity:1},1)]),t.addAnimation(i,"leftShowAnimation");let n=new TKKeyframeAnimation;n.duration=250,n.timingFunction="linear",n.setAnimations([()=>(e.style={opacity:0,left:150},0),()=>(e.style={opacity:1,left:0},1)]),e.addAnimation(n,"rightShowAnimation");let s=new TKKeyframeAnimation;s.duration=250,s.timingFunction="linear",s.setAnimations([()=>(this.leftLightView.style={opacity:0,left:-150},0),()=>(this.leftLightView.style={left:0,opacity:1},1)]),this.leftLightView.addAnimation(s,"leftLightShowAnimation");let a=new TKKeyframeAnimation;a.duration=250,a.timingFunction="linear",a.setAnimations([()=>(this.rightLightView.style={opacity:0,left:150},0),()=>(this.rightLightView.style={opacity:1,left:0},1)]),this.rightLightView.addAnimation(a,"rightLightShowAnimation")}clickCardAnim(t,e,i,n,s){if(this.handAndBreatheView&&this.handAndBreatheView.setVisibility("hidden"),!Ie(this.vm.getInteractIcon())){let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(n.style={},0),()=>(n.style={left:1==i?-99:99,transform:{scale:1.35}},1)]),n.addAnimation(t,"lightAnimation");let e=new TKKeyframeAnimation;e.duration=100,e.timingFunction="linear",e.setAnimations([()=>(s.style={opacity:1},0),()=>(s.style={opacity:0},1)]),s.addAnimation(e,"closelightAnimation")}let a=new TKKeyframeAnimation;a.duration=500,a.timingFunction="linear",a.setAnimations([()=>(t.style={},0),()=>(t.style={left:1==i?-99:99,transform:{scale:1.35}},1)]),t.addAnimation(a,"cardMoveAnimation");let o=new TKKeyframeAnimation;o.duration=100,o.timingFunction="linear",o.setAnimations([()=>(e.style={opacity:1},0),()=>(e.style={opacity:0},1)]),e.addAnimation(o,"cardDismissAnimation"),a.on("end",(()=>{this.interactCallback&&!this.hasInteracted&&(this.interactCallback(),this.hasInteracted=!0)}))}clickBaseAnim(t,e,i){let n=new TKKeyframeAnimation;n.duration=15,n.timingFunction="linear",n.setAnimations([()=>(t.style={opacity:1},e.style={opacity:1},i.style={opacity:1},0),()=>(t.style={opacity:0},e.style={opacity:0},i.style={opacity:0},1)]),t.addAnimation(n,"clickBaseAnimation")}sweepAnimation(){this.leftSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.leftSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.leftSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1e3,t.repeatCount=1,t.timingFunction="Linear",this.leftSweepView.addAnimation(t,"sweep")}),1500)}sweepRightAnimation(){this.rightSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.rightSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.rightSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1200,t.repeatCount=1,t.timingFunction="Linear",this.rightSweepView.addAnimation(t,"sweep")}),1500)}onDismiss(){this.removeAllAnimation(),this.tagView&&this.tagView.clearAnim(),this.handAndBreatheView&&this.handAndBreatheView.removeAllAnimation(),this.rightCardBaseView&&this.rightCardBaseView.removeAllAnimation(),this.leftCardBaseView&&this.leftCardBaseView.removeAllAnimation(),this.rightCardView&&this.rightCardView.removeAllAnimation(),this.leftCardView&&this.leftCardView.removeAllAnimation(),this.rightSweepView&&this.rightSweepView.removeAllAnimation(),this.leftSweepView&&this.leftSweepView.removeAllAnimation(),this.leftLightView&&this.leftLightView.removeAllAnimation(),this.rightLightView&&this.rightLightView.removeAllAnimation(),this.handAndBreatheView&&this.handAndBreatheView.clearHandClick(),this.timePlay&&this.timePlay.stop()}}class Pr extends TKView{constructor(t){super(),this.vm=t,this.style={width:"100%",height:"100%",backgroundColor:"#00000099"}}showGameIndustCard(){this.vm.enableInteractCard()?this.showInteractCard():this.showRightsCard()}showInteractCard(){const t=this;this.interactView=new Kr(this.vm),this.appendChild(this.interactView),this.interactView.callbackClose=this.callbackClose,this.interactView.interactCallback=()=>{let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.interactView.style={opacity:0},1)]),e.duration=70,e.timingFunction="linear",t.interactView.addAnimation(e,"dissmissAnim"),e.on("end",(()=>{t.removeChild(t.interactView)})),t.showRightsCard()}}showRightsCard(){this.rightsView||(this.rightsView=new Er(this.vm),this.appendChild(this.rightsView),this.rightsView.callbackClose=this.callbackClose,this.rightsView.showRightsDialogCard())}}class Mr extends En{constructor(t){super(),this.vm=t,this.setupViews()}showDialog(t){this.isShowing()||(super.showDialog(t),this.cardView.showGameIndustCard())}setupViews(){this.cardView=new Pr(this.vm),this.appendChild(this.cardView);const t=this;this.cardView.callbackClose=e=>{t.callbackCloseTrigger(e)}}callbackCloseTrigger(t){this.vm.logCloseReport(t),this.onCloseTrigger&&this.onCloseTrigger(t)}}class Or extends TKView{constructor(e,i,n){super(),this.vm=e,this.endPositionFunc=i,this.setupViews(),this.vm.logWidgetImp(),this.addEventListener("tap",(e=>{let i=new S;i.template_show_type="pendant_card",this.vm.convert({x:e.position.rawX,y:e.position.rawY},1,t.CARD_ACTION_BAR_CLICK,i),this.callbackClose&&this.callbackClose(),this.onDismiss()}))}setupViews(){this.style={width:357,height:588,alignSelf:"center",position:"absolute",top:(this.vm.callerContext.containerLimit.height-588)/2},this.rightsView=new Er(this.vm),this.rightsView.enabled=!1,this.appendChild(this.rightsView),this.rightsView.showWidget(),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={top:-2,right:7,width:20,height:20,position:"absolute"},this.appendChild(this.closeView),this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose()}));let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.rightsView.style={width:357,height:588,transform:{scale:1,translate:{x:0,y:0}}},0),()=>(this.rightsView.style={width:300,height:280,transform:{scale:.4,translate:{x:-102,y:-68}}},1)]),t.duration=350,t.timingFunction="linear",this.rightsView.addAnimation(t,"scaleAnim");const e=this.endPositionFunc({width:96,height:120});let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.style={left:e.x,top:e.y,height:120,width:96},1)]),i.duration=350,i.timingFunction="linear",this.addAnimation(i,"moveAnim")}onDismiss(){this.removeAllAnimation()}}class Nr extends Bi{constructor(t){super(),this.vm=t,this.startTransY=this.vm.showOnTop()?-40:40,this.setStyle(),this.setUpView(),this.setData(),this.setAction()}setStyle(){this.style={backgroundColor:"#FFFFFF",position:"absolute",flexDirection:"row",alignItems:"center",opacity:0,transform:{translate:{y:this.startTransY}}},0==this.vm.screenOrientation?this.vm.showOnTop()?this.style={height:78,top:8,left:8,right:8,borderRadius:12}:this.style={height:94,left:0,bottom:0,right:0,topLeftRadius:12,topRightRadius:12}:this.vm.showOnTop()?this.style={width:482,height:78,top:8,borderRadius:12}:this.style={width:482,height:78,bottom:8,borderRadius:12}}setUpView(){this.appiconView=new TKImage,this.appiconView.style={width:46,height:46,marginLeft:12,borderRadius:8},this.appendChild(this.appiconView);let t=new TKView;t.style={width:"100%",height:"100%",marginLeft:8,flexShrink:1,flexDirection:"column",justifyContent:"center"},this.appNameView=new TKText,this.appNameView.style={width:"100%",flexWrap:"no-wrap",textLineClamp:1,fontWeight:"medium",textOverflow:"ellipsis",color:"#222222",fontSize:15},t.appendChild(this.appNameView),this.descView=new TKText,this.descView.style={width:"100%",flexWrap:"no-wrap",textLineClamp:1,textOverflow:"ellipsis",marginTop:4,color:"#66666699",fontSize:12},t.appendChild(this.descView),this.appendChild(t),this.btnView=new TKText;let e=this.vm.isBtnRedStyle()?"#FE3666":"#F5F5F5",i=this.vm.isBtnRedStyle()?"#FFFFFF":"#222222";this.btnView.style={width:88,height:36,marginLeft:12,marginRight:28,backgroundColor:e,borderRadius:100,color:i,fontWeight:"medium",fontSize:12,textAlign:"center"},this.appendChild(this.btnView),this.closeView=new TKImage,this.closeView.style={width:10,height:10,position:"absolute",top:12,right:12},this.appendChild(this.closeView)}setData(){this.appiconView.setSrc(this.vm.getAppIconUrl()),this.appNameView.setText(this.vm.getAdName()),Di(this.vm,this.vm.$attrsPath.currentTimerValue,(t=>{t>0&&this.descView.setText(t/1e3+this.vm.tipDes)})),this.btnView.setText(this.vm.getBtnText()),ke(this.closeView,"ksad_installed_activate_close_icon.png")}setAction(){this.addEventListener("tap",(e=>{const i=Te(e,this);this.vm.closeAndConvert(1,2,t.CARD_OTHERAREA_CLICK,i)})),this.btnView.addEventListener("tap",(e=>{const i=Te(e,this);this.vm.closeAndConvert(1,1,t.ACTION_BAR_CLICK,i)})),this.closeView.addEventListener("tap",(()=>{this.vm.onlyClose()}))}showCardViewAnim(t){let e=new TKKeyframeAnimation;e.duration=t,e.timingFunction="EaseOut",e.setAnimations([()=>(this.style={transform:{translate:{y:this.startTransY}},opacity:0},0),()=>(this.style={transform:{translate:{y:0}},opacity:1},1)]),this.addAnimation(e,"cardShow")}hideCardViewAnim(t,e,i){let n;n=1==t?0:this.startTransY;let s=new TKKeyframeAnimation;s.duration=e,s.timingFunction="EaseOut",s.setAnimations([()=>(this.style={transform:{translate:{y:0}},opacity:1},0),()=>(this.style={transform:{translate:{y:n}},opacity:0},1)]),s.on("end",(()=>{i&&(this.setVisibility("hidden"),i())})),this.addAnimation(s,"cardClose")}updateButtonText(t){this.btnView.setText(t)}}class Hr extends Bi{constructor(t){super(),this.showAnimDuration=600,this.hideAnimDuration=300,this.vm=t,this.setStyle(),this.setUpView(),this.setAction()}setStyle(){this.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",visibility:"hidden"}}setUpView(){this.vm.showOnTop()||0!=this.vm.screenOrientation||(this.bgMaskView=new TKView,this.bgMaskView.style={gradientBgColor:"90, 000000CC 0, 00000000 1",width:"100%",height:149,position:"absolute",bottom:0,left:0,opacity:0},this.appendChild(this.bgMaskView)),this.cardView=new Nr(this.vm),this.appendChild(this.cardView)}setAction(){this.vm.isCardRender?Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"pageVisiable"==t&&6==this.vm.downloadStatus&&(this.setVisibility("visible"),this.cardView.showCardViewAnim(this.showAnimDuration),this.showMaskViewAnim(this.bgMaskView),this.vm.hasReportShow||(this.vm.hasReportShow=!0,this.vm.reportElementPv(),this.vm.startCountDown()))})):Di(this.vm,this.vm.$attrsPath.focusChangeEvent,(t=>{this.vm.hasReportShow||"windowFocusGet"!=t||6!=this.vm.downloadStatus||!this.vm.adInfo.adMatrixInfo.adDataV2.installedActivateInfo&&!this.vm.componentData||(this.setVisibility("visible"),this.cardView.showCardViewAnim(this.showAnimDuration),this.showMaskViewAnim(this.bgMaskView),this.vm.hasReportShow||(this.vm.hasReportShow=!0,this.vm.reportElementPv(),this.vm.startCountDown()))})),Di(this.vm,this.vm.$attrsPath.closeType,(t=>{2!=t&&1!=t||(this.hideMaskViewAnim(this.bgMaskView),this.cardView.hideCardViewAnim(t,this.hideAnimDuration,(()=>{this.vm.notifyAdClose()})))})),Di(this.vm,this.vm.$attrsPath.downloadStatus,(t=>{6==this.vm.downloadStatus&&this.cardView.updateButtonText("立即打开")}))}showMaskViewAnim(t){if(!t)return;let e=new TKKeyframeAnimation;e.duration=this.showAnimDuration,e.timingFunction="EaseOut",e.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:1},1)]),t.addAnimation(e,"cardShow")}hideMaskViewAnim(t){if(!t)return;let e=new TKKeyframeAnimation;e.duration=this.hideAnimDuration,e.timingFunction="EaseOut",e.setAnimations([()=>(t.style={opacity:1},0),()=>(t.style={opacity:0},1)]),t.addAnimation(e,"cardHide")}}class Wr extends _n{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.vm.isDeepRewardTask()?this.hasDeepReward?this.countDownLabel.setText("已获得全部奖励"):this.hasReward?this.countDownLabel.setText("已获得奖励1/2"):4==this.actionState?this.countDownLabel.setText("未获得奖励"):this.countDownLabel.setText(this.leftTime+"s后获得奖励1"):this.countDownLabel.setText(this.leftTime+""),this.layout())}updateActionBarStateInner(t,e=!1){switch(t){case 0:this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class zr extends _n{getCountDownHasBg(){return!0}getSmallGiftView(){let t=new TKImage;return t.style={marginLeft:5,width:18,height:18,marginRight:5},t.setSrc(this.vm.getResourceRoot()+"icon_ksad_gift_small.png"),t}getCloseBtn(){let t=super.getCloseBtn();return 4==this.actionState||(t.style={marginLeft:0,marginRight:0,backgroundColor:"#00000000"}),t}getSkipBtn(){let t=super.getSkipBtn(),e=8;return this.actionState>=4&&(e=12),t.style={paddingLeft:e,paddingRight:12,marginRight:0,marginLeft:0,backgroundColor:"#00000000"},t}getSkipTips(){return"跳过"}getRightContainer(){let t=super.getRightContainer();return t.style={backgroundColor:"#30303099",borderRadius:14,marginRight:16},t}shouldShowNormalCallBtn(){return!1}showCallSep(){this.callSep&&this.callSep.setVisibility("visible")}updateActionBarStateInner(t,e){this.rightContainer.style=4==t?{backgroundColor:"#00000000"}:{backgroundColor:"#30303099"}}}class Ur extends zr{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+"秒后可领取奖励"),this.layout())}getCountDownLabel(){let t=super.getCountDownLabel();return t.style={width:118},t}getCallBtn(){if(4==this.actionState)return super.getCallBtn();const t=new TKView;t.style={height:Ln,flexDirection:"row",justifyContent:"center",alignItems:"center"};let e=new TKImage;e.style={width:20,height:20,marginLeft:5,marginRight:4},e.src=this.vm.getResourceRoot()+"icon_ksad_gift_small.png",t.appendChild(e),t.addEventListener("tap",(t=>{}));let i=this.getCountDownLabel();t.appendChild(i),this.countDownLabel=i,this.updateCountDownText();let n=new TKView;return n.setBackgroundColor("#FFFFFF33"),n.style={width:.5,height:12,marginLeft:8},n.setVisibility("hidden"),this.callSep=n,t.appendChild(n),t}getSkipBtn(){let t=super.getSkipBtn(),e=8;return this.actionState>1&&(e=12),t.style={paddingLeft:e,paddingRight:12,marginRight:0,marginLeft:0,backgroundColor:"#00000000"},t}updateActionBarStateInner(t,e=!1){switch(super.updateActionBarStateInner(t,e),t){case 0:this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.callContainer.appendChild(this.getCallBtn());break;case 1:this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class Gr extends zr{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+"秒后可领取奖励"),this.layout())}getCountDownLabel(){let t=super.getCountDownLabel();return t.style={width:118},t}hasFeedbackBtn(){return!0}getSkipBtn(){let t=super.getSkipBtn(),e=8;return this.actionState>1&&(e=12),t.style={paddingLeft:e,paddingRight:12,marginRight:0,marginLeft:0,backgroundColor:"#00000000"},t}getCallBtn(){if(4==this.actionState)return super.getCallBtn();const t=new TKView;t.style={height:Ln,flexDirection:"row",justifyContent:"center",alignItems:"center"};let e=new TKImage;e.style={width:20,height:20,marginLeft:5,marginRight:4},e.src=this.vm.getResourceRoot()+"icon_ksad_gift_small.png",t.appendChild(e),t.addEventListener("tap",(t=>{}));let i=this.getCountDownLabel();t.appendChild(i),this.countDownLabel=i,this.updateCountDownText();let n=new TKView;return n.setBackgroundColor("#FFFFFF33"),n.style={width:.5,height:12,marginLeft:8},n.setVisibility("hidden"),this.callSep=n,t.appendChild(n),t}updateActionBarStateInner(t,e=!1){switch(super.updateActionBarStateInner(t,e),t){case 0:this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.callContainer.appendChild(this.getCallBtn());break;case 1:this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn()),this.callContainer.appendChild(this.getCallBtn()),this.showCallSep();break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 4:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCloseBtn())}}}class jr extends _n{getHasGuideBar(){return!0}hasFeedbackBtn(){return!0}updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCloseBtn())}}}class Yr extends _n{updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.leftContainer.appendChild(this.getSkipBtn()),this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 2:case 3:this.leftContainer.appendChild(this.getSkipBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.hasReward&&this.rightContainer.appendChild(this.getGiftBtn());break;case 4:{this.leftContainer.appendChild(this.getCloseBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.hasReward&&this.rightContainer.appendChild(this.getGiftBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class Xr extends _n{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+"秒后可领取奖励"),this.layout())}getCountDownBtn(){return this.countDownBtn=new TKView,this.countDownBtn.style={height:Ln,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},this.getCountDownHasBg()&&(this.countDownBtn.style={borderRadius:14,backgroundColor:"#30303099"}),this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={marginLeft:12,marginRight:12},this.countDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.countDownBtn}updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class Jr extends _n{updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class $r extends zr{getCallBtn(){if(4==this.actionState)return super.getCallBtn();this.callBtn=new TKView,this.callBtn.style={height:Ln,flexDirection:"row",justifyContent:"center",alignItems:"center"};let t=new TKImage;t.style={width:20,height:20,marginLeft:5,marginRight:4},t.src=this.vm.getResourceRoot()+"icon_ksad_gift_small.png",this.callBtn.appendChild(t),this.actionState<4&&(this.callLabel=new TKText,this.callLabel.style={fontSize:14,color:"#FFFFFF",marginRight:8},this.callBtn.appendChild(this.callLabel),this.callLabel.setText("观看完视频可获取奖励")),this.callBtn.addEventListener("tap",(t=>{}));let e=new TKView;return e.setBackgroundColor("#FFFFFF33"),e.style={width:.5,height:12},e.setVisibility("hidden"),this.callSep=e,this.callBtn.appendChild(e),this.callBtn}updateActionBarStateInner(t,e=!1){switch(super.updateActionBarStateInner(t,e),t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class qr{static initializeTopBar(t){let e=null;if(t.callerContext.componentSwtich){const i=1;if(R(t.callerContext.adInfo,"top-bar1",i))return e=new Wr(t.topBarVM),e;if(R(t.callerContext.adInfo,"top-bar11",i))return e=new Ur(t.topBarVM),e}else switch(t.topBarVM.getTopbarStyle()){case 3:e=new Yr(t.topBarVM);break;case 5:e=new Xr(t.topBarVM);break;case 7:e=new Jr(t.topBarVM);break;case 9:e=new $r(t.topBarVM);break;case 11:e=new Ur(t.topBarVM);break;case 13:e=new Gr(t.topBarVM);break;case 15:e=new jr(t.topBarVM);break;default:e=new Wr(t.topBarVM)}return e||(e=new Wr(t.topBarVM)),e}}class Zr extends fn{constructor(){super(...arguments),this.currentPlaybackTime=0,this.playFailed=!1,this.playFinished=!1,this.autocallHasConverted=!1}checkDataValid(){return!!this.callerContext.adInfo}getRewardTime(){return gt(this.callerContext.adInfo)}getLightInteractionType(){try{const t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionType;if(!be(t))return t}catch(t){}return 0}getLightInteractionShowTime(){let t=2;try{t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionShowTime}catch(e){}return t||2}getLightInteractionDuration(){let t=6;try{t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionDuration}catch(e){}return t||6}getAdAttributeType(){try{return this.callerContext.adInfo.adBaseInfo.adAttributeType}catch(t){}return 0}getActionBarStyle(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType}catch(t){}return 0}getMiddleCardType(){var t,e,i,n,s,a;try{if(2==this.callerContext.adStyle){let n=null===(i=null===(e=null===(t=this.callerContext.adInfo.adMatrixInfo)||void 0===t?void 0:t.adDataV2)||void 0===e?void 0:e.neoTKInfo)||void 0===i?void 0:i.middleCardType;if(!be(n))return n}else if(3==this.callerContext.adStyle){let t=null===(a=null===(s=null===(n=this.callerContext.adInfo.adMatrixInfo)||void 0===n?void 0:n.adDataV2)||void 0===s?void 0:s.fullScreenInfo)||void 0===a?void 0:a.middleCardType;if(!be(t))return t}}catch(o){}return null}isClickReward(){return vt(this.callerContext.adInfo)}isDownloadComplaince(){let t=1==this.callerContext.screenOrientation;return!(!pt(this.callerContext.adInfo)||!t)}isValidCardInfo(){return null!=lt(this.callerContext.adInfo,1)}isValidPlayable(){if(!Ie(this.callerContext.adInfo.adConversionInfo.playableUrl))return!1;let t=this.callerContext.adInfo.adConversionInfo.playableStyleInfo.playableOrientation;return!(0==this.callerContext.screenOrientation&&2==t||1==this.callerContext.screenOrientation&&1==t)}isBrowseTask(){return 1!=this.callerContext.adInfo.adBaseInfo.taskType&&0!=this.callerContext.adInfo.adBaseInfo.taskType}getLiveCutRoomInfo(){return Yt(this.callerContext.adStyle,this.callerContext.adInfo)}isValideTime(){return!(gt(this.callerContext.adInfo)<=mt(lt(this.callerContext.adInfo,1)))}isValidSDKVersion(){return!!Pe.supportMinimumTKVersion("3.0.2")}shouldShowAutoCallAppCard(t=void 0){if(!this.isValidSDKVersion())return!1;if(2!=this.callerContext.adStyle)return!1;if(this.isDownloadComplaince())return!1;if(this.isValidCardInfo())if(this.isValidPlayable())t&&t(!1);else{if(!this.isBrowseTask())return!!this.isValideTime()&&void(t&&t(!0));t&&t(!1)}else t&&t(!1)}isSlideClick(){var t;return!!(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}convert(t,e,i,n){}isFansLive(){try{let t=this.callerContext.configInfo.abConfig.shortVideoFollowRewardPlayStyle;if(Pe.supportMinimumVersion("3.3.26","3.3.30")&&4==t&&Tt(this.callerContext.adInfo))return!0}catch(t){}return!1}}class Qr extends fn{constructor(t,e,i,n,s,a){super(),this.lifeStatus="none",this.cardTopMargin=0,this.cardBottomMargin=0,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.styleType=n,this.containerLimit=s,this.screenOrientation=a,this.setupData()}setupData(){this.couponWidgetInfo=function(t,e){let i=ot(t,e);if(null!=i)return JSON.parse(i.data).couponWidgetInfo}(this.adInfo,this.styleType)}isValidSDKVersion(){return!(!Pe.isAndroid()||!Pe.supportMinimumTKVersion("4.0.8"))}isValidCardInfo(){return null!=this.couponWidgetInfo}isHasGuideHandle(){return 1==this.couponWidgetInfo.gestureType}isSecondIcon(){return 1==this.couponWidgetInfo.showSecondIconType}isShowRightTop(){return 1==this.couponWidgetInfo.type||1==this.screenOrientation}getCouponWidgetInfoBusinessType(){return this.couponWidgetInfo.businessType}getCardWidth(){return 100}getCardHeight(){return 140}getIconImageWidth(){return 100}getIconImageHeight(){return 100}getGuidanceImageWH(){return 54}getGuidanceImageMarginTop(){return this.getCardHeight()-this.getGuidanceImageWH()-15}getGuidanceImageMarginLeft(){return this.getCardWidth()-this.getGuidanceImageWH()}getCouponGuideMsgText(){try{return this.couponWidgetInfo.guideMsg}catch(t){}return""}getCouponPriceText(){try{return this.couponWidgetInfo.price}catch(t){}return""}getCouponPriceTagText(){try{return this.couponWidgetInfo.priceTag}catch(t){}return""}getCouponFirstIconUrlText(){try{return this.couponWidgetInfo.firstIcon}catch(t){}return""}getCouponSecondIconUrlText(){try{return this.couponWidgetInfo.secondIcon}catch(t){}return""}reportCouponClick(e){let i=new S,n=new x;n.couponType=this.getCouponWidgetInfoBusinessType(),i.neo_ext_data=n,pi.convertIfNeeded(1,this.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK,i)}reportCouponImpression(){let t=new S,e=new x;e.couponType=this.getCouponWidgetInfoBusinessType(),t.neo_ext_data=e;let i={elementType:13,clientExtData:JSON.stringify(t)},n={actionType:140,payload:JSON.stringify(i)};Ne.sendLog(n)}}class th extends Zr{constructor(t){super(),this.callerContext=t,this.couponWidgetVM=new Qr(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.configInfo,1,this.callerContext.containerLimit,this.callerContext.screenOrientation)}convert(t,e,i,n){n||(n=new S),n.material_click_area="neo_mid",pi.convertIfNeeded(3,this.callerContext.adInfo,t,e,i,n)}}class eh extends _o{constructor(t){super(),this.callerContext=t,this.createViewModels(),this.setDatas()}getFestivalPendantBottom(){this.festivalPendantBottom=this.getBottomHeigtCallback()}}class ih extends Na{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.bottomCouponInfo=ht(this.adInfo,3)}getAdActionDesc(){return Vt(this.adInfo)}}class nh extends In{constructor(t,e,i,n,s,a){super(),this.isShow=!1,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a}getTemplateInfo(){try{const t=xt(this.getTemplateId(),this.adInfo);return JSON.stringify(t)}catch(t){}return""}getTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.confirmTKInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}}class sh extends wo{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.isNeedCheck=!0,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.additionalInit()}additionalInit(){Pe.supportMinimumVersion("3.3.20","3.3.27")&&Pe.isAndroid()&&this.isDownloadAd()&&He((t=>{t.data&&1==t.data.hasInstalled&&2==this.adStyle&&(this.hasInstallTargetApp=!0,this.handleSkipCallback&&this.handleSkipCallback(!1,!1,0))})),Pe.supportMinimumTKVersion("4.0.4")||(this.needShowPlayEndCloseBtn=1)}handleClose(){this.handleCloseCallback&&this.handleCloseCallback()}handleSkip(t,e,i){let n=new b;n.closeButtonImpressionTime=i,n.closeButtonClickTime=this.currentPlaybackTime,n.clientTimestamp=ue();let s={elementType:69,extParams:JSON.stringify(n)},a={actionType:141,payload:JSON.stringify(s)};Ne.sendLog(a),this.handleSkipCallback&&this.handleSkipCallback(t,e,i)}handleGiftClick(e){pi.convertIfNeeded(1,this.adInfo,2,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK)}handleCallClick(e,i){pi.convertIfNeeded(1,this.adInfo,1,{x:i.position.rawX,y:i.position.rawY},e?t.PLAY_END_CALL_CLICK:t.PLAY_DETAIL_CALL_CLICK)}handleCallImpressionOnFinish(){pi.exposeElement(17)}handleCallImpressionOnPlay(){pi.exposeElement(18)}handlePlayEnd(t){this.hasShowPlayend=!0}handleMuteChange(t){this.isMuted=t}convertForOtherArea(t,e,i,n){let s=new S;s.material_click_area=2==this.adStyle?"neo_top":"fullscreen_top",pi.convertIfNeeded(1,this.adInfo,e,i,n,s)}}class ah extends Yo{constructor(t){super(),this.callerContext=t,this.fullscreenShakeControl=new va("KSAdFullscreenShakeKey");try{this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo}catch(e){}this.bidirectionalRotateShakeUtil=new Xs(this.getInteractionInfoInfo())}getVideoTKScene(){return $a.FULLSCREEN}getPlayableStyle(){return bt(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.screenOrientation)}needShowShakeUI(){var t,e;try{return!!this.interactionInfo&&(!!this.enableShakeConvert()&&(3==this.callerContext.adStyle&&(2==this.interactionInfo.interactiveStyle&&(0==this.getPlayableStyle()&&(6!=(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo)||void 0===t?void 0:t.detailWebCardInfo.cardType)&&5!=(null===(e=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo)||void 0===e?void 0:e.detailWebCardInfo.cardType)&&(console.log("tkloadcontroller shakecount:"+this.callerContext.configInfo.abConfig.fullScreenShakeMaxCount+";"+(this.fullscreenShakeControl.getCurrentCount()>=this.callerContext.configInfo.abConfig.fullScreenShakeMaxCount)),!(this.fullscreenShakeControl.getCurrentCount()>=this.callerContext.configInfo.abConfig.fullScreenShakeMaxCount)))))))}catch(i){}return!1}getShakeSubtitle(){let t="";try{if(console.log("tkloadcontroller isdownload:"+X(this.callerContext.adInfo)),X(this.callerContext.adInfo)){const e=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo.actionBarInfo.downloadTexts;switch(this.callerContext.downloadState){case 6:t=e.openAppLabel;break;case 5:t=e.installAppLabel;break;default:t=e.adActionDescription}}else t=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo.shakeInfo.subtitle}catch(e){}return Ie(t)?"或点击"+t:""}getAccelerationThreshold(){return Wt(this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo)}startListenSensor(){this.fullscreenShakeControl.increaseCurrentCount();let t=this.getVideoTKScene()==$a.FULLSCREEN;!Pe.supportMinimumTKVersion("5.0.8")&&t?ro.registerBridgeShake(null):super.startListenSensor()}convert(t,e,i,n){n||(n=new S),n.material_click_area="fullscreen_mid",n.reward_interactive_style_type=this.getInteractiveStyleType(),pi.convertIfNeeded(3,this.callerContext.adInfo,t,e,i,n)}}class oh extends ah{needShowShakeUI(){try{if(!this.enableShakeConvert())return!1;if(!ro.supportSensor(1))return!1}catch(t){}return super.needShowShakeUI()}getVideoTKScene(){return $a.IMAGE_FULLSCREEN}}class rh extends Zr{constructor(t){super(),this.callerContext=t,this.couponWidgetVM=new Qr(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.configInfo,1,this.callerContext.containerLimit,this.callerContext.screenOrientation)}convert(t,e,i,n){n||(n=new S),n.material_click_area="fullscreen_mid",pi.convertIfNeeded(3,this.callerContext.adInfo,t,e,i,n)}}class hh extends fn{constructor(){super(),this.hasReportShow=!1,this.lifeStatus="none",this.actionText="",this.downloadState=0,this.mLifeCycleHelper=new Ia,this.autoShowStroeKitControl=new va("KSAdAutoStoreKitKey")}getData(t){let e=[];e.push(Ne.getKsAdDataAsync()),e.push(Ne.getDeviceInfoAsync()),e.push(Ne.getKsAdConfigAsync()),e.push(Ne.getContainerLimitAsync()),e.push(Ne.getScreenOrientationAsync()),Promise.all(e).then((e=>{try{const i=e[0].data,n=e[1].data,s=e[2].data,a=e[3].data,o=e[4].data;this.adOriginInfo=i,this.adInfo=i.impAdInfo[0].adInfo[0],this.posId=i.impAdInfo[0].posId,this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=o.screenOrientation,this.configInfo=s,this.containerLimit=a,this.screenOrientation=o.screenOrientation,oe(n),this.additionalInit(),t&&t(!0)}catch(i){t&&t(!1)}}))}additionalInit(){const t={width:this.containerLimit.width-2*this.getSideMargin(),height:this.containerLimit.height-this.getTopMargin()};this.callerContext=new Ro(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation);const e=2==this.adStyle?3:-1,i=2==this.adStyle?7:-1;this.topBarVM=new sh(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.topBarVM.posId=this.posId,2==this.adStyle?(this.middleCardVM=new th(this.callerContext),this.shakeVM=new Xo(this.callerContext,e)):(this.middleCardVM=new rh(this.callerContext),this.shakeVM=new oh(this.callerContext));let n=3==this.adStyle?$a.IMAGE_FULLSCREEN:$a.IMAGE_NEO;this.rotateVM=new go(this.callerContext,n,e),this.bottomBarVM=new ih(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.playerVM=new To(this.adInfo,this.adStyle,this.configInfo),this.playableCardVM=new so(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.playEndCardVM=new yo(this.callerContext,this.adOriginInfo,n),this.autocallVM=new Zo(this.adInfo,this.adStyle,this.configInfo,16,i),2==this.adStyle?this.topFloorVM=new Do(this.callerContext):this.topFloorVM=new eh(this.callerContext),this.confirmVM=new nh(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.downloadPopupVM=new Va(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.neoAutoDialogVM=new Fo(this.adInfo,this.containerLimit,this.screenOrientation),this.ecCardViewModel=new jo(this.callerContext),this.gameCardViewModel=new Jo(this.callerContext),this.socialCardViewModel=new tr(this.callerContext),this.installActivateVM=new qo(this.callerContext,this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation,6),Di(this.playerVM,this.playerVM.$attrsPath.currentPlaybackTime,(t=>{this.topBarVM.currentPlaybackTime=t,this.topFloorVM.currentPlaybackTime=t,this.confirmVM.currentPlaybackTime=t})),Di(this.playerVM,this.playerVM.$attrsPath.playFailed,(t=>{this.topBarVM.playFailed=t,this.middleCardVM.playFailed=t})),Di(this.playerVM,this.playerVM.$attrsPath.playFinished,(t=>{this.topBarVM.playFinished=t})),Di(this.topBarVM,this.topBarVM.$attrsPath.isMuted,(t=>{this.playerVM.isMuted=t})),Di(this.confirmVM,this.confirmVM.$attrsPath.isShow,(t=>{t?this.playerVM.onDialogShow(this.confirmVM):this.playerVM.onDialogDismiss(this.confirmVM),this.callerContext.pageFocusAndVisible=!t,this.checkVisibleChange()})),Di(this.topBarVM,this.topBarVM.$attrsPath.hasShowPlayend,(t=>{t&&Ne.getPlayEndType((t=>{if(t&&t.data){const e=t.data.playEndType;this.topBarVM.needShowPlayEndCloseBtn=this.topBarVM.isCloseBtnHide()&&1==e?2:1}else this.topBarVM.needShowPlayEndCloseBtn=1}))})),this.registerLifeStatusListener(),this.registerProgressListener(),this.registerSceneChangeListener()}registerSceneChangeListener(){Ne.registerSceneChangeListener((t=>{t.data&&1==t.data.scene&&(this.topBarVM.hasShowPlayend=!0,this.topFloorVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0)}))}registerProgressListener(){this.updateActionText(this.adInfo.adBaseInfo.adActionDescription||"立即下载"),Pe.isSupportDownloadProgressListen()&&X(this.adInfo)&&Ne.registerProgressListener((t=>{if(this.ecCardViewModel&&this.ecCardViewModel.updateProgressListener(t),t.result){const{status:e,progress:i,totalBytes:n}=t.data;Number((100*i).toFixed(0))>100||(100*i).toFixed(0);this.playEndCardVM.webViewVM.currentDownloadProgress=t.data,this.callerContext.downloadState=e,this.downloadState=e,this.rotateVM.downloadState=e,this.playEndCardVM.downloadState=e;let s=Oa.newInstance(e,i,n);this.mLifeCycleHelper.isFocus()&&this.downloadPopupVM.updateDownloadProgress(s),this.bottomBarVM.downloadChangeEvent=s;let a=this.bottomBarVM.downloadChangeEvent.obtainActionButtonText(this.adInfo);this.updateActionText(a)}}))}registerLifeStatusListener(){Ne.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&this.updateLifeStatus(e)}})),Ne.registerFocusListener((t=>{if(t.result&&t.data){const e=t.data.windowFocusEvent;this.mLifeCycleHelper.updateWindowFocusChangeEvent(e),this.playEndCardVM.focusChangeEvent=e,this.checkVisibleChange()}}))}updateActionText(t){this.bottomBarVM.actionText=t}updateLifeStatus(t){var e,i,n,s,a;if("showEnd"==t&&!this.hasReportShow){this.hasReportShow=!0;let t=null,o=di.createImageCommonInstance(this.adStyle,this.adInfo);o&&(t={clientExtData:JSON.stringify(o)}),pi.expose(t),this.callerContext.componentSwtich&&this.reportPlayCardImpression(),Pe.supportMinimumTKVersion("5.0.1")&&(null===(i=null===(e=this.adInfo.adRewardInfo)||void 0===e?void 0:e.callBackStrategyInfo)||void 0===i?void 0:i.impressionCheckMs)>0&&(null===(n=this.adInfo.adRewardInfo)||void 0===n?void 0:n.rewardTime)>5&&this.topBarVM.isNeedCheck&&this.adInfo.adConversionInfo.callbackUrlInfo&&setTimeout((()=>{this.checkExposure()}),null===(a=null===(s=this.adInfo.adRewardInfo)||void 0===s?void 0:s.callBackStrategyInfo)||void 0===a?void 0:a.impressionCheckMs)}this.lifeStatus=t,this.bottomBarVM.lifeStatus=t,this.playerVM.lifeStatus=t,this.playEndCardVM.lifeStatus=t,this.callerContext.lifeStatus=t,this.mLifeCycleHelper.updateLifecycleStatus(t),this.checkVisibleChange()}checkVisibleChange(){let t=this.mLifeCycleHelper.isFocusAndVisible();t&&!this.playerVM.isDialogShowing()?(this.callerContext.pageFocusAndVisible=!0,this.rotateVM.canRotateConvert=!0,this.rotateVM.isStartSensor=!0):(this.callerContext.pageFocusAndVisible=!1,this.rotateVM.canRotateConvert=!1,this.rotateVM.isStartSensor=!1),this.neoAutoDialogVM.mPlayPaused=!t}getSideMargin(){return Ce()&&1==this.screenOrientation?48:0}getTopMargin(){return 0==this.screenOrientation&&Ce()?48:20}getAroundImageVideoSize(){let t={width:0,height:0};const e=this.containerLimit;if(e.height-=this.getTopMargin(),1==this.screenOrientation){let i=this.isVerticalMaterial()?9*(this.getTopMargin()+e.height)/16:e.width/2,n=this.isVerticalMaterial()?this.getTopMargin()+e.height:9*i/16;t.width=i,t.height=n}else{let i=this.isVerticalMaterial()?.525*e.width:e.width,n=this.isVerticalMaterial()?16*i/9:9*i/16;t.width=i,t.height=n}return t}setNeedCloseNeo(){Ne.needCloseNeo(!0)}isVerticalMaterial(){let t=G(this.adInfo);return t.width<t.height}hasWaveAnimation(){var t;try{let e=Lt(this.adInfo.adMatrixInfo.adDataV2.videoImageTKInfo.templateId,this.adInfo),i=JSON.parse(e.data);if(!be(i))return null!==(t=1==i.isSweepLightAnimation)&&void 0!==t&&t}catch(e){return!1}}isValidPlayable(){return At(this.adInfo,this.screenOrientation)}isPlayableRenderSuccess(){return this.playableCardVM.playableVM.renderSuccess}isShowSkipRightNow(){let t=null;try{t=this.adInfo.adStyleConfInfo.fullScreenSkipShowTime}catch(e){}return null!=t&&null!=t||(t=5),t<=0}checkExposure(){this.exposeNetwork=new TKNetwork,this.exposeNetwork.isAddCommonParameters=1,this.exposeNetwork.method="POST",this.exposeNetwork.url="/rest/e/v3/open/checkReward";var t=JSON.parse(this.adInfo.adConversionInfo.callbackUrlInfo);t.checkType=1;const e={callbackUrlInfo:JSON.stringify(t),impInfo:[{posId:this.posId,adNum:1,adStyle:2}]};try{var i=JSON.parse(JSON.stringify(this.adInfo.serverExt));be(i)||(delete i._tkmvvm_observed,delete i.nativeID,e.serverExt=i)}catch(s){}this.exposeNetwork.params=e,Ye(1,this.adInfo);const n=ue();this.exposeNetwork.request(((t,e)=>{const i=ue()-n;if(!e)try{const e=JSON.parse(t).data,n=JSON.parse(e);1!=n.result&&(this.topBarVM.impressionCheckResult=!1),Xe(1,this.adInfo,i,n.result,n.errorMsg)}catch(s){}}))}showPlayEnd(){this.updateLifeStatus("showEnd"),this.topBarVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0}onAdClose(t){Ne.closeVideo(t)}playableOrientationNotMatch(){try{if(!Ie(this.adInfo.adConversionInfo.playableUrl))return!1;const t=this.adInfo.adConversionInfo.playableStyleInfo.playableOrientation;if(0==this.screenOrientation&&2==t||1==this.screenOrientation&&1==t)return!0}catch(t){}return!1}canAutoShowStoreKit(){try{if(!Pe.isAndroid()&&X(this.adInfo)&&this.adInfo.adConversionInfo.appDownloadUrl.length>0&&this.adInfo.adConversionInfo.autoJumpStoreKitSwitch)return!0}catch(t){}return!1}autoShowStoreKit(){pi.convertIfNeeded(1,this.adInfo,1,{x:0,y:0},t.NEO_AUTO_SHOW_STOREKIT)}reportPlayEndImpression(){let t=new S;if(this.canAutoShowStoreKit()&&(t.universe_feature_freq=16),this.callerContext.componentSwtich){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.endCardInfo.pageId,combination_id:e.endCardInfo.combinationIds};t.template_show_type="combination",t.component_module=JSON.stringify(i)}let e={elementType:87,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}reportCardImpression(t){let e=new S;e.template_show_type=10==t?"picture_template10":"picture_template9";let i={elementType:19,clientExtData:JSON.stringify(e)},n={actionType:140,payload:JSON.stringify(i)};Ne.sendLog(n)}hasAutoDialog(){return K.hasNeoAutoDialog(this.adInfo)}showShakeAndRotateDirectlyAtBottom(){return this.topFloorVM.enableShowGiftBoxView()}reportPlayCardImpression(){let t=new S;if(this.callerContext.componentSwtich){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds};t.component_module=JSON.stringify(i)}let e={elementType:244,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}}class lh extends Na{constructor(t,e,i,n,s,a){super(),this.tradeCustomerViewWidth=197,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.deviceInfo=n,this.containerLimit=s,this.screenOrientation=a,this.bottomCouponInfo=ht(this.adInfo,3),this.videoLiveData=this.obtainVideoLiveData();let o=ge(this.deviceInfo),r=function(t){if(null==t)return-1;let e=t.screenHeight;return ye()&&(e=Tachikoma.px2Dp(e)),e}(this.deviceInfo);r>o?(this.screenWidthDp=o,this.screenHeightDp=r):(this.screenHeightDp=o,this.screenWidthDp=r)}obtainVideoLiveData(){let t=ot(this.adInfo,14);return JSON.parse(t.data)}getLiveCartCustomerData(){var t;return null===(t=this.videoLiveData.neoLiveCartCustomerData)||void 0===t?void 0:t.tradeCustomerDesc}needShowLiveCartCustomerData(){return!be(this.getLiveCartCustomerData())}needShowProductList(){return!be(this.videoLiveData.neoLiveCartDetailData)&&!be(this.videoLiveData.neoLiveCartDetailData.liveCartInfoList)&&this.videoLiveData.neoLiveCartDetailData.liveCartInfoList.length>=2}needShowAuthorInfoCard(){return!this.needShowProductList()&&!be(this.videoLiveData.neoLiveAuthorInfoData)}getAuthorIconUrl(){let t="";try{t=this.videoLiveData.neoLiveAuthorInfoData.authorIconUrl}catch(e){}try{be(t)&&(t=this.videoLiveData.neoLiveCartDetailData.authorIconUrl)}catch(e){}try{be(t)&&(t=this.adInfo.adBaseInfo.appIconUrl)}catch(e){}return t}getAuthorName(){return K.liveGetAuthorName(this.videoLiveData,this.adInfo)}getLiveDesc(){return K.liveGetLiveDesc(this.videoLiveData,this.adInfo)}getCardAppearanceDelayTime(){var t;let e,i=null===(t=this.videoLiveData.neoLiveAuthorInfoData)||void 0===t?void 0:t.cardAppearanceDelayTime;return e=be(i)||i<=0?3e4:1e3*i,2==this.adStyle?e:e/2}getProductListAppearanceDelayTime(){var t;let e,i=null===(t=this.videoLiveData.neoLiveCartDetailData)||void 0===t?void 0:t.cardAppearanceDelayTime;return e=be(i)||i<=0?3e4:1e3*i,2==this.adStyle?e:e/2}getCardStayTimeMS(){var t;let e,i=null===(t=this.videoLiveData.neoLiveAuthorInfoData)||void 0===t?void 0:t.cardDelayTime;return e=be(i)||i<=0?5e3:1e3*i,e}getActionBarBtnText(){return Vt(this.adInfo)}getScreenWidthDp(){return this.screenWidthDp}getScreenHeightDp(){return this.screenHeightDp}getLiveroomGuideMsgType(){try{return this.videoLiveData.neoLiveAuthorInfoData.liveroomGuideMsgType}catch(t){}return 0}getProductInfoList(){try{return this.videoLiveData.neoLiveCartDetailData.liveCartInfoList}catch(t){return}}getActionBarCardType(){let t=7;try{t=this.adInfo.adMatrixInfo.adDataV2.actionBarInfo.cardType}catch(e){}return t}getLiveCartItemServiceDesc(){try{return this.videoLiveData.neoLiveCartDetailData.liveCartItemServiceDesc}catch(t){return""}}getAdActionDesc(){return Vt(this.adInfo)}getProductItemIdList(){try{let t=this.videoLiveData.neoLiveCartDetailData.liveCartInfoList,e=t.length,i=[];for(let n=0;n<e;n++)i[n]=t[n].itemId;return i}catch(t){}return null}getLiveStatDataDesc(){try{return this.videoLiveData.neoLiveAuthorInfoData.liveStatDataDesc}catch(t){}return"看了这么久，还不去看看？"}addClickConvert(t,e,i,n,s){t.addEventListener("tap",(a=>{console.log("jky KSAdLiveVideoBottomViewModel addClickConvert click: "+i);const o=Te(a,t);k(this.adInfo)&&this.componentData&&(s||(s=new S),s.component_module=E(this.adInfo,this.componentData)),pi.convertIfNeeded(1,this.adInfo,e,o,i,s,n)}))}logElementImpression(t,e,i){let n={elementType:t,clientExtData:JSON.stringify(e)};be(i)||Object.assign(n,i);let s={actionType:140,payload:JSON.stringify(n)};Ne.sendLog(s)}logElementClick(t,e,i){let n={elementType:t};be(i)||Object.assign(n,i),be(e)||Object.assign(n,e);let s={actionType:141,payload:JSON.stringify(n)};Ne.sendLog(s)}}class dh extends fn{constructor(t,e,i,n,s,a){super(),this.currentPlaybackTime=0,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a,this.videoLiveData=this.obtainVideoLiveData()}convert(t,e,i){pi.convertIfNeeded(1,this.adInfo,t,e,i)}getAuthorIconUrl(){let t="";try{t=this.videoLiveData.neoLiveAuthorInfoData.authorIconUrl}catch(e){}try{be(t)&&(t=this.videoLiveData.neoLiveCartDetailData.authorIconUrl)}catch(e){}try{be(t)&&(t=this.adInfo.adBaseInfo.appIconUrl)}catch(e){}return t}obtainVideoLiveData(){let t=ot(this.adInfo,14);return JSON.parse(t.data)}getAuthorName(){let t="";try{t=this.videoLiveData.neoLiveAuthorInfoData.authorName,be(t)&&(t=this.videoLiveData.neoLiveCartDetailData.authorName)}catch(e){}return t}getLiveLikeCount(){try{return this.livePushEndInfo.displayLikeUserCount}catch(t){}return null}getLiveAudienceCount(){try{return this.livePushEndInfo.displayWatchingUserCount}catch(t){}return null}getLiveDuration(){try{if(this.livePushEndInfo.liveDuration)return function(t){let e,i,n,s=Math.floor(t/36e5%24),a=Math.floor(t/6e4%60),o=Math.floor(t/1e3%60);return n=s<10?"0"+s:""+s,i=a<10?"0"+a:""+a,e=o<10?"0"+o:""+o,n+":"+i+":"+e}(this.livePushEndInfo.liveDuration)}catch(t){}return""}getLiveDesc(){try{return this.videoLiveData.neoLiveCartDetailData.liveDesc}catch(t){}return""}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}getRewardTime(){return gt(this.adInfo)}}class ch extends To{constructor(t,e,i,n){super(t,e,i),this.currentProductInfo=void 0,this.shopCardChangeType=void 0,this.shopCardType=void 0,this.liveMessage=void 0,this.isLiveEnd=!1,this.isLiveFinsh=!1,this.timerPaused=!1,this.adInfo=t,this.configInfo=i,this.deviceInfo=n,this.adStyle=e}isReward(){return 2==this.adStyle}obtainRealRenderResult(){return this.hadDowngrade?la.IMAGE:la.LIVE}getTotalCountTime(){return 3==this.adStyle?30:gt(this.adInfo)}getAppId(){return this.deviceInfo.appId}getAuthorId(){return K.getAuthorId(this.adInfo)}getLiveStreamId(){return K.getLiveStreamId(this.adInfo)}}class ph extends wo{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.isNeedCheck=!0,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.additionalInit()}additionalInit(){Pe.supportMinimumVersion("3.3.19","3.3.26")&&Ne.registerDeepRewardListener((t=>{this.hasGetDeepGift=t.data&&t.data.hasDeepReward})),Pe.supportMinimumVersion("3.3.20","3.3.27")&&Pe.isAndroid()&&this.isDownloadAd()&&He((t=>{t.data&&1==t.data.hasInstalled&&2==this.adStyle&&(this.hasInstallTargetApp=!0,this.handleSkipCallback&&this.handleSkipCallback(!1,!1,0))})),Pe.supportMinimumTKVersion("4.0.4")||(this.needShowPlayEndCloseBtn=1)}handleClose(){this.handleCloseCallback&&this.handleCloseCallback()}handleSkip(t,e,i){let n=new b;n.closeButtonImpressionTime=i,n.closeButtonClickTime=this.currentPlaybackTime,n.clientTimestamp=ue();let s={elementType:69,extParams:JSON.stringify(n)},a={actionType:141,payload:JSON.stringify(s)};Ne.sendLog(a),this.handleSkipCallback&&this.handleSkipCallback(t,e,i)}handleGiftClick(e){pi.convertIfNeeded(1,this.adInfo,2,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK)}handleCallClick(e,i){pi.convertIfNeeded(1,this.adInfo,1,{x:i.position.rawX,y:i.position.rawY},e?t.PLAY_END_CALL_CLICK:t.PLAY_DETAIL_CALL_CLICK)}handleCallImpressionOnFinish(){pi.exposeElement(17)}handleCallImpressionOnPlay(){pi.exposeElement(18)}handlePlayEnd(t){this.hasShowPlayend=!0}handleMuteChange(t){this.isMuted=t}convertForOtherArea(t,e,i,n){let s=new S;s.material_click_area=2==this.adStyle?"neo_live_top":"fullscreen_live_top",pi.convertIfNeeded(1,this.adInfo,e,i,n,s)}}class mh extends ah{needShowShakeUI(){try{if(!this.enableShakeConvert())return!1;if(!ro.supportSensor(1))return!1}catch(t){}return super.needShowShakeUI()}getVideoTKScene(){return $a.LIVE_FULLSCREEN}}class gh extends fn{constructor(){super(),this.hasReportShow=!1,this.lifeStatus="none",this.mLifeCycleHelper=new Ia,this.actionText="",this.isMuted=!1,this.downloadState=0}getData(t){let e=[];e.push(Ne.getKsAdDataAsync()),e.push(Ne.getDeviceInfoAsync()),e.push(Ne.getKsAdConfigAsync()),e.push(Ne.getContainerLimitAsync()),e.push(Ne.getScreenOrientationAsync()),e.push(ze()),Promise.all(e).then((e=>{try{const i=e[0].data;this.deviceInfo=e[1].data;const n=e[2].data,s=e[3].data,a=e[4].data;this.adOriginInfo=i,this.posId=i.impAdInfo[0].posId,this.adInfo=i.impAdInfo[0].adInfo[0],this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=a.screenOrientation,this.isMuted=e[5].data.muted||!1,this.configInfo=n,this.containerLimit=s,oe(this.deviceInfo),this.additionalInit(),t&&t(!0)}catch(i){console.log("jky KSAdLiveVideoCardViewModel getData catch error: "+i),t&&t(!1)}}))}additionalInit(){const t={width:this.containerLimit.width-2*this.getSideMargin(),height:this.containerLimit.height-this.getTopMargin()},e=2==this.adStyle?3:-1,i=2==this.adStyle?7:-1;this.callerContext=new Ro(this.adInfo,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation),this.topBarVM=new ph(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),2==this.adStyle?(this.middleCardVM=new th(this.callerContext),this.shakeVM=new Xo(this.callerContext)):(this.middleCardVM=new rh(this.callerContext),this.shakeVM=new mh(this.callerContext));let n=3==this.adStyle?$a.LIVE_FULLSCREEN:$a.LIVE_NEO;this.rotateVM=new go(this.callerContext,n,e),this.bottomBarVM=new lh(this.adInfo,this.adStyle,this.configInfo,this.deviceInfo,t,this.screenOrientation),this.playerVM=new ch(this.adInfo,this.adStyle,this.configInfo,this.deviceInfo),this.autocallVM=new Zo(this.adInfo,this.adStyle,this.configInfo,3,i),this.confirmVM=new Za(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.playEndCardVM=new yo(this.callerContext,this.adOriginInfo,n),this.liveEndVM=new dh(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.topFloorVM=new Do(this.callerContext),this.downloadPopupVM=new Va(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.interactGestureVM=new io(this.callerContext),this.ecCardViewModel=new jo(this.callerContext),this.neoAutoDialogVM=new Fo(this.adInfo,this.containerLimit,this.screenOrientation),this.liveCouponVM=new Qo(this.callerContext,14),this.socialCardViewModel=new tr(this.callerContext),this.topBarVM.isMuted=this.isMuted,this.topBarVM.posId=this.posId,this.playerVM.isMuted=this.isMuted,Di(this.playerVM,this.playerVM.$attrsPath.currentPlaybackTime,(t=>{this.topBarVM.currentPlaybackTime=t,this.confirmVM.currentPlaybackTime=t,this.middleCardVM.currentPlaybackTime=t,this.liveEndVM.currentPlaybackTime=t,this.liveCouponVM.currentPlaybackTime=t})),Di(this.playerVM,this.playerVM.$attrsPath.playFailed,(t=>{this.topBarVM.playFailed=t,this.middleCardVM.playFailed=t})),Di(this.playerVM,this.playerVM.$attrsPath.playFinished,(t=>{this.topBarVM.playFinished=t,this.middleCardVM.playFinished=t})),Di(this.topBarVM,this.topBarVM.$attrsPath.isMuted,(t=>{this.playerVM.isMuted=t})),Pe.supportMinimumTKVersion("4.0.4")&&Di(this.topBarVM,this.topBarVM.$attrsPath.hasShowPlayend,(t=>{t&&(this.topBarVM.needShowPlayEndCloseBtn=this.topBarVM.isCloseBtnHide()?2:1)})),Di(this.confirmVM,this.confirmVM.$attrsPath.hasShowAggCard,(t=>{t&&this.adInfo.adConversionInfo.universeAggreRetainPopUps&&this.adInfo.adConversionInfo.universeAggreEndPage&&0==this.screenOrientation&&(this.playEndCardVM.canShowAggregation=!t)})),this.registerLifeStatusListener(),this.registerProgressListener(),this.registerSceneChangeListener(),this.registerBackPressedListener()}registerBackPressedListener(){Ne.registerBackPressed((t=>{null!=this.backPressedCallback&&this.backPressedCallback()}))}registerSceneChangeListener(){Ne.registerSceneChangeListener((t=>{t.data&&1==t.data.scene&&(this.topBarVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0)}))}registerProgressListener(){this.updateActionText(this.adInfo.adBaseInfo.adActionDescription||"立即下载"),Pe.isSupportDownloadProgressListen()&&X(this.adInfo)&&Ne.registerProgressListener((t=>{if(this.ecCardViewModel&&this.ecCardViewModel.updateProgressListener(t),t.result){this.playEndCardVM.webViewVM.currentDownloadProgress=t.data;const{status:e,progress:i,totalBytes:n}=t.data,s=Number((100*i).toFixed(0))>100?"100":(100*i).toFixed(0);let a;switch(this.callerContext.downloadState=e,this.downloadState=e,this.rotateVM.downloadState=e,this.playEndCardVM.downloadState=e,this.mLifeCycleHelper.isFocus()&&(this.downloadPopupVM.downloadState=e),e){case 0:case 1:case 4:a=this.adInfo.adBaseInfo.adActionDescription;break;case 2:a=`${s}%`;break;case 3:a="继续下载";break;case 5:a=Ie(this.adInfo.adBaseInfo.installAppLabel)?this.adInfo.adBaseInfo.installAppLabel:"点击安装";break;case 6:a=Ie(this.adInfo.adBaseInfo.openAppLabel)?this.adInfo.adBaseInfo.openAppLabel:"立即打开"}this.updateActionText(a)}}))}registerLifeStatusListener(){Ne.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&this.updateLifeStatus(e)}})),Ne.registerFocusListener((t=>{if(t.result&&t.data){const e=t.data.windowFocusEvent;this.mLifeCycleHelper.updateWindowFocusChangeEvent(e),this.playEndCardVM.focusChangeEvent=e,this.checkShakeVM()}}))}updateActionText(t){this.bottomBarVM.actionText=t}updateLifeStatus(t){var e,i,n,s,a;if("showEnd"==t&&!this.hasReportShow){this.hasReportShow=!0;let t=null,o=di.createLiveCommonInstance(this.adStyle,this.adInfo);o&&(t={clientExtData:JSON.stringify(o)}),pi.expose(t),this.callerContext.componentSwtich&&this.reportPlayCardImpression(),Pe.supportMinimumTKVersion("5.0.1")&&(null===(i=null===(e=this.adInfo.adRewardInfo)||void 0===e?void 0:e.callBackStrategyInfo)||void 0===i?void 0:i.impressionCheckMs)>0&&(null===(n=this.adInfo.adRewardInfo)||void 0===n?void 0:n.rewardTime)>5&&this.topBarVM.isNeedCheck&&this.adInfo.adConversionInfo.callbackUrlInfo&&setTimeout((()=>{this.checkExposure()}),null===(a=null===(s=this.adInfo.adRewardInfo)||void 0===s?void 0:s.callBackStrategyInfo)||void 0===a?void 0:a.impressionCheckMs),Pe.supportMinimumTKVersion("5.1.1")&&4==this.adInfo.adBaseInfo.aggMidPageAdType&&(this.adInfo.adConversionInfo.universeAggreRetainPopUps||this.adInfo.adConversionInfo.universeAggreEndPage)&&0==this.screenOrientation&&this.requestAggregationAdInfo()}this.lifeStatus=t,this.bottomBarVM.lifeStatus=t,this.playerVM.lifeStatus=t,this.confirmVM.lifeStatus=t,this.playEndCardVM.lifeStatus=t,this.callerContext.lifeStatus=t,this.mLifeCycleHelper.updateLifecycleStatus(t),this.checkShakeVM()}checkShakeVM(){this.mLifeCycleHelper.isFocusAndVisible()&&!this.playerVM.isDialogShowing()?(this.callerContext.pageFocusAndVisible=!0,this.rotateVM.canRotateConvert=!0,this.rotateVM.isStartSensor=!0):(this.callerContext.pageFocusAndVisible=!1,this.rotateVM.canRotateConvert=!1,this.rotateVM.isStartSensor=!1)}checkExposure(){this.exposeNetwork=new TKNetwork,this.exposeNetwork.isAddCommonParameters=1,this.exposeNetwork.method="POST",this.exposeNetwork.url="/rest/e/v3/open/checkReward";var t=JSON.parse(this.adInfo.adConversionInfo.callbackUrlInfo);t.checkType=1;const e={callbackUrlInfo:JSON.stringify(t),impInfo:[{posId:this.posId,adNum:1,adStyle:2}]};try{var i=JSON.parse(JSON.stringify(this.adInfo.serverExt));be(i)||(delete i._tkmvvm_observed,delete i.nativeID,e.serverExt=i)}catch(s){}this.exposeNetwork.params=e,Ye(1,this.adInfo);const n=ue();this.exposeNetwork.request(((t,e)=>{const i=ue()-n;if(!e)try{const e=JSON.parse(t).data,n=JSON.parse(e);1!=n.result&&(this.topBarVM.impressionCheckResult=!1),Xe(1,this.adInfo,i,n.result,n.errorMsg)}catch(s){}}))}requestAggregationAdInfo(){this.aggNetwork=new TKNetwork,this.aggNetwork.isAddCommonParameters=1,this.aggNetwork.method="POST",this.aggNetwork.url="/rest/e/v3/open/univ";const t={impInfo:[{posId:this.posId,adNum:1,adStyle:2}],aggregateRequestType:4,aggMidPageExcludeCreativeIds:[this.callerContext.adInfo.adBaseInfo.creativeId]};try{var e=JSON.parse(JSON.stringify(this.callerContext.adInfo.serverExt));be(e)||(delete e._tkmvvm_observed,delete e.nativeID,t.serverExt=e)}catch(i){}this.aggNetwork.params=t,Ye(1,this.adInfo),this.aggNetwork.request(((t,e)=>{if(!e)try{const e=JSON.parse(t).data,i=JSON.parse(e);this.callerContext.adInfo.adConversionInfo.universeAggreRetainPopUps&&(this.confirmVM.aggregationCardVM.adResult=i,this.confirmVM.canShowAggregation=!0),this.callerContext.adInfo.adConversionInfo.universeAggreEndPage&&(this.playEndCardVM.aggregationCardVM.adResult=i,this.playEndCardVM.canShowAggregation=!0),1!=i.result&&(this.playEndCardVM.canShowAggregation=!1,this.confirmVM.canShowAggregation=!1)}catch(i){this.playEndCardVM.canShowAggregation=!1,this.confirmVM.canShowAggregation=!1}}))}isScreenPortrait(){return 0==this.screenOrientation}showPlayEnd(){this.updateLifeStatus("showEnd"),this.topBarVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0}getSideMargin(){return Ce()&&1==this.screenOrientation?48:0}getTopMargin(){return Ce()&&0==this.screenOrientation?48:0}getVideoDuration(){let t=0;try{let e=this.adInfo;const i=e.adMaterialInfo.materialFeature.length>0?e.adMaterialInfo.materialFeature[0]:null;i&&(t=i.videoDuration,0==t&&(t=i.videoDurationMs/1e3))}catch(e){}return t}checkDataValid(){return!!this.adInfo}setNeedCloseNeo(){Ne.needCloseNeo(!0)}handleGiftClick(e){pi.convertIfNeeded(1,this.adInfo,2,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK)}handleClose(t){yt(this.adInfo)&&pi.reportLivePlaySecond(this.playerVM.currentPlaybackTime),Ne.closeVideo(t)}reportWithShowImpression(t=!1){Ne.sendLog({actionType:1})}isSlideEnable(){var t,e;return!!(null===(e=null===(t=this.adInfo)||void 0===t?void 0:t.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===e?void 0:e.slideClick)}showShakeAndRotateDirectlyAtBottom(){return this.topFloorVM.enableShowGiftBoxView()}hasAutoDialog(){return K.hasNeoAutoDialog(this.adInfo)}reportPlayCardImpression(){let t=new S;if(this.callerContext.componentSwtich){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds};t.component_module=JSON.stringify(i)}let e={elementType:244,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}reportPlayEndImpression(){let t=new S;if(this.callerContext.componentSwtich){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.endCardInfo.pageId,combination_id:e.endCardInfo.combinationIds};t.template_show_type="combination",t.component_module=JSON.stringify(i)}let e={elementType:87,clientExtData:JSON.stringify(t)};pi.log(140,null,e)}}class uh extends TKView{constructor(t){super(),this.cardDynamicAllowed=!1,this.vm=t}getHeight(){return 0}stopActionAnimation(){}pauseActionAnimation(){}resumeActionAnimation(){}convert(t,e,i){this.vm.convert(1,t,e,i)}addContainerTranslateYAction(t,e,i,n=500){let s=new TKKeyframeAnimation;s.animType="position",s.keyframes=[{percent:0,value:{x:0,y:t},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:e},easing:"EaseInEaseOut"}],s.duration=n,this.addAnimation(s,i)}addContainerAlphaAction(t,e,i=500){let n=new TKKeyframeAnimation;n.animType="opacity",n.keyframes=[{percent:0,value:t!=ye()?1:0,easing:"EaseInEaseOut"},{percent:1,value:t?1:0,easing:"EaseInEaseOut"}],t&&n.on("end",(t=>{this.reportImpressionCallback()})),n.duration=i,this.addAnimation(n,e)}anteversionEffect(t,e,i){let n=new TKKeyframeAnimation,s=.8*t.getSize().width;n.setAnimations([()=>(t.style={transform:{rotate:{x:-15,y:0,z:0},perspective:s}},.225),()=>(t.style={transform:{rotate:{x:4,y:0,z:0},perspective:s}},.4375),()=>(t.style={transform:{rotate:{x:-4,y:0,z:0},perspective:s}},.7125),()=>(t.style={transform:{rotate:{x:0,y:0,z:0},perspective:s}},1)]),n.duration=800,n.timingFunction="linear",t.addAnimation(n,"anteversionAnim"),n.on("end",(()=>{Pe.supportMinimumTKVersion("5.0.0")&&setTimeout((()=>{this.addCardDynamicSweepAnimation(t,e,i)}),270)}))}breatheEffect(t,e,i){this.animationCardView?this.animationCardView=t:(this.animationCardView=new TKView,this.animationCardView.style=i,this.insertBefore(this.animationCardView,t));let n=Ui(this.animationCardView,1.04,500,1,this.vm.supportNewAnimation());this.animationCardView.addAnimation(n,"breatheEffect1");const s=this;n.on("end",(()=>{s.breatheEffect2(this.animationCardView,e,i)}))}breatheEffect2(t,e,i){let n=Ui(t,1.03,500,1,this.vm.supportNewAnimation());t.addAnimation(n,"breatheEffect2");const s=this;n.on("end",(()=>{Pe.supportMinimumTKVersion("5.0.0")?setTimeout((()=>{s.addCardDynamicSweepAnimation(t,e,i)}),270):setTimeout((()=>{s.breatheEffect(t,e,i)}),500)}))}addCardDynamicSweepAnimation(t,e,i){if(this.sweepLightView&&e&&e.removeChild(this.sweepLightView),Pe.supportMinimumTKVersion("5.0.0")){this.sweepLightView=new RoundRectView,this.sweepLightView.style={left:0,right:0,top:0,bottom:0,borderRadius:e.style.borderRadius,position:"absolute"},this.sweepLightView.throughHitTest=!0,e&&e.appendChild(this.sweepLightView);const n=e.getSize(),s=204*n.height/80;this.sweepLightImage=new TKImage,this.sweepLightImage.style={width:s,height:n.height,left:-s,top:0,position:"absolute"},ke(this.sweepLightImage,"ksad_video_bottom_sweep_light.png"),this.sweepLightView.appendChild(this.sweepLightImage);let a=zi(500,Number(n.width)+2*s);this.sweepLightImage.addAnimation(a,"sweepAnim");const o=this;a.on("end",(()=>{o.addCardDynamicEffects(t,e,i)}))}}addCardDynamicEffects(t,e,i){if(this.vm.isShowCardDynamicEffects()){const n=this;setTimeout((()=>{1==n.vm.cardDynamicEffects&&n.breatheEffect(t,e,i),2==n.vm.cardDynamicEffects&&n.anteversionEffect(t,e,i),n.cardDynamicAllowed=!0}),600)}}showActionBarAnim(){}onGetMiddleMarginBottom(t){return Number(this.getHeight())}}class wh extends TKView{constructor(t){super(),this.size=t,this.borderRadius=t.borderRadius,this.style={width:this.size.width,height:this.size.height,top:0,left:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius,position:"absolute"},Pe.supportMinimumTKVersion("5.0.0")&&(this.canvasView=new Canvas2DView,this.canvasView.style={width:"100%",height:"100%",borderRadius:this.borderRadius},this.canvasView.layerType=1,this.appendChild(this.canvasView),this.roundRectPaint=new Paint,this.roundRectPaint.setColor("FFFFFF30"),this.maskRectPath=new Path,this.maskRectPaint=new Paint,this.maskRectPaint.setColor("#FFFFFF00"),this.maskRectPaint.setPorterDuffMode(0))}setProgress(t){if(!t)return;if(t>1||t<0)return;if(!this.canvasView)return;if(!this.getSize())return;let e=this.getSize().width,i=this.getSize().height;if(e<=0||i<0)return;const n=this,s=t*e;this.canvasView.onDraw=t=>{t.save();const a={x:0,y:0,width:e,height:i};let o=i/2,r=Math.min(n.borderRadius,o);t.drawRoundRect(a,r,r,n.roundRectPaint),n.maskRectPath.reset(),n.maskRectPath.addRect({x:s,y:a.y,width:a.width,height:a.height}),t.drawPath(n.maskRectPath,n.maskRectPaint),t.restore()},this.canvasView.requestDraw()}setProgressColor(t){Pe.supportMinimumTKVersion("5.0.0")&&this.roundRectPaint.setColor(t)}}class Ch extends TKView{constructor(t,e,i=null,n=null){super(),this.opType=0,this.supportShowPause=!1,this.downloadProgressBar=null,this.containerConfig=e,this.style={width:this.containerConfig.width,height:this.containerConfig.height,right:this.containerConfig.right,flexDirection:"column",borderRadius:this.containerConfig.borderRadius,backgroundColor:this.containerConfig.backgroundColor||"#FE3666"},this.supportShowPause=qt(t),this.supportShowPause&&(this.setupDownloadProgressView(),n&&n(this.downloadProgressBar)),this.setupActionButton(),i&&i(this.normalActionButton),this.setupCover()}setupDownloadProgressView(){this.downloadProgressBar=new wh(this.containerConfig),this.downloadProgressBar.style={backgroundColor:this.containerConfig.backgroundColor},this.downloadProgressBar.setProgressColor("#FFFFFF4D"),this.appendChild(this.downloadProgressBar)}setupActionButton(){this.normalActionButton=new TKButton,this.normalActionButton.style={fontSize:14,color:"#FFFFFF",backgroundColor:"#FFFFFF00",left:0,top:0,right:0,bottom:0,textAlign:"center",position:"absolute"},this.appendChild(this.normalActionButton)}setupCover(){this.coverView=new TKView,this.coverView.style={position:"absolute",backgroundColor:"#FFFFFF00",left:0,right:0,top:0,bottom:0},this.appendChild(this.coverView)}setOnTapListener(t){t&&this.coverView&&this.coverView.addEventListener("tap",t)}setOnSwipeListener(t){t&&this.coverView&&this.coverView.addEventListener("swipe",t)}setDownloadChange(t){console.log("jky AdActionButtonView setDownloadChange: "+JSON.stringify(t));let e=t.getProgress();this.downloadProgressBar&&e>=0&&(this.downloadProgressBar.setProgress(e),this.downloadProgressBar.style={visibility:0==e?"hidden":"visible"}),t.isDownloadFinish()&&this.downloadProgressBar&&this.downloadProgressBar.setVisibility("hidden")}setText(t){t&&this.normalActionButton&&this.normalActionButton.setText(t)}}class fh extends uh{constructor(e){super(e);let i=1==this.vm.screenOrientation;this.logoView=new Ri(1,this.vm.adInfo);const n=new TKView;this.style={width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:0},this.logoView.style={marginLeft:12,marginBottom:6},n.style={backgroundColor:"#FFFFFF",height:90,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},i&&(this.style={width:this.vm.containerLimit.height+20,paddingLeft:16,paddingRight:16,paddingBottom:16},this.logoView.style={marginLeft:0,marginBottom:6},n.style={paddingLeft:12,paddingRight:12,borderRadius:12}),this.appendChild(this.logoView),this.appendChild(n);const s=new TKView;s.style={flexDirection:"row",flexShrink:1},n.appendChild(s);let a=0;this.vm.isDownloadAd()&&(this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12},this.appIcon.setSrc(this.vm.getAdIcon()),s.appendChild(this.appIcon),a=12);const o=new TKView;if(o.style={marginLeft:a,height:58,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"stretch",flexWrap:"no-wrap",flexShrink:1,marginRight:16},s.appendChild(o),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,color:"#222222",flexWrap:"no-wrap",textLineClamp:1,textOverflow:"ellipsis"},o.appendChild(this.nameLabel),this.vm.isDownloadAd()){this.nameLabel.setText(this.vm.getAdTitle());const e=new TKView;if(e.style={flexDirection:"column"},o.appendChild(e),this.vm.getAppScore()>=30||Ie(this.vm.getAppDownloadCountDesc())){if(this.vm.getAppScore()>=30){const i=this.vm.getAppScore();this.scoreView=new na(i),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),e.appendChild(this.scoreView)}if(Ie(this.vm.getAppDownloadCountDesc())){let i=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(i=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",marginLeft:0,marginTop:5},this.downloadCountLabel.setText(i),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),e.appendChild(this.downloadCountLabel)}}else this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}))}else this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),o.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));this.rightContainer=new TKView,n.appendChild(this.rightContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:89,height:46,borderRadius:4},(t=>{t.style={fontSize:16}})),this.actionBtn.style={paddingLeft:20,paddingRight:20,marginTop:20,marginBottom:20,marginLeft:5,marginRight:5},_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.rightContainer.appendChild(this.actionBtn),this.rightContainer.clipChildren=!1;const r=new TKView;r.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.rightContainer.appendChild(r),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),r.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),n.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(r,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(n,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation(),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}startActionAnimation(){this.animationAllowed=!0,setTimeout((()=>{if(!this.animationAllowed)return;let t=new TKKeyframeAnimation;t.animType="rotationZ",t.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.11,value:-Pe.getRotateSemiCircle()/9,easing:"EaseInEaseOut"},{percent:.22,value:Pe.getRotateSemiCircle()/4.5,easing:"EaseInEaseOut"},{percent:.33,value:-Pe.getRotateSemiCircle()/4.5,easing:"EaseInEaseOut"},{percent:.44,value:Pe.getRotateSemiCircle()/4.5,easing:"EaseInEaseOut"},{percent:.55,value:-Pe.getRotateSemiCircle()/6,easing:"EaseInEaseOut"},{percent:.66,value:Pe.getRotateSemiCircle()/9,easing:"EaseInEaseOut"},{percent:.77,value:-Pe.getRotateSemiCircle()/12,easing:"EaseInEaseOut"},{percent:.88,value:Pe.getRotateSemiCircle()/18,easing:"EaseInEaseOut"},{percent:.95,value:-Pe.getRotateSemiCircle()/36,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}];t.duration=1500,t.delay=500,t.on("end",(e=>{e?this.addActionRotateAnim(t):setTimeout((()=>{this.addActionRotateAnim(t)}),1500)})),this.addActionRotateAnim(t)}),1e3)}addActionRotateAnim(t){this.animationAllowed&&this.actionBtn.addAnimation(t,"rotate")}stopActionAnimation(){this.animationAllowed=!1,this.actionBtn&&this.actionBtn.removeAllAnimation()}getDefaultHeight(){return 0==this.vm.screenOrientation?112:128}getHeight(){return this.hasInteract?this.limitSize.height:this.getDefaultHeight()}}class yh extends TKView{constructor(t,e){super(),this.itemWidth=2,this.animStopped=!1,e&&e>0&&(this.itemWidth=e),this.itemHeight=t[0],this.mWaveItemHeight=t,this.setupViews()}setupViews(){this.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:13,height:24},this.waveItem1=this.createWaveItemView(),this.waveItem2=this.createWaveItemView(),this.waveItem3=this.createWaveItemView(),this.appendChild(this.waveItem1),this.appendChild(this.waveItem2),this.appendChild(this.waveItem3)}createWaveItemView(){let t=new TKView;return t.style={width:this.itemWidth,height:this.itemHeight,borderRadius:1,backgroundColor:"#FFFFFF"},t}startWaveAnimation(){this.waveItem1.addAnimation(this.createWaveItemAnim(this.waveItem1,[this.mWaveItemHeight[2],this.mWaveItemHeight[1],this.mWaveItemHeight[2]]),"wave"),this.waveItem2.addAnimation(this.createWaveItemAnim(this.waveItem2,[this.mWaveItemHeight[0],this.mWaveItemHeight[2],this.mWaveItemHeight[0]]),"wave"),this.waveItem3.addAnimation(this.createWaveItemAnim(this.waveItem3,[this.mWaveItemHeight[1],this.mWaveItemHeight[0],this.mWaveItemHeight[1]]),"wave")}createWaveItemAnim(t,e){if(be(e)||e.length<3)return null;let i=new TKKeyframeAnimation;return i.setAnimations([()=>(t.style={height:e[0]},0),()=>(t.style={height:e[1]},.5),()=>(t.style={height:e[2]},1)]),i.duration=600,i.repeatCount=-1,i.timingFunction="EaseOut",i.on("start",(()=>{this.animStopped&&t.removeAnimation("wave")})),i}}class Th extends TKView{constructor(t){super(),this.mTipsText="点击进入快手直播间",be(t)||(this.mTipsText=t),this.setupViews(),setTimeout((()=>{this.mWaveView.startWaveAnimation()}),500)}setupViews(){this.style={height:46,width:188,borderRadius:23,borderWidth:1,paddingHorizontal:12,borderColor:"#FFFFFF66",backgroundColor:"#0000004D",flexDirection:"row",justifyContent:"center",alignSelf:"center",alignItems:"center"},this.mWaveView=new yh([5,9,13]),this.appendChild(this.mWaveView),this.mTipsView=new TKText,this.mTipsView.style={height:"100%",flexBasis:100,flexGrow:1,flexShrink:1,color:"#FFFFFF",fontSize:16,marginLeft:6,includeFontPadding:!1,textAlign:"center"},this.mTipsView.setText(this.mTipsText),this.appendChild(this.mTipsView)}}class Ih extends TKView{constructor(){super(),this.mIconContainerSize=40,this.mIconSize=36,this.setupViews()}setupViews(){this.style={width:this.mIconContainerSize,height:this.mIconContainerSize+2,flexDirection:"column",alignItems:"center",justifyContent:"flex-start"};let t=new TKView;t.style={width:this.mIconContainerSize,height:this.mIconContainerSize,borderRadius:this.mIconContainerSize/2,borderColor:"#FE3666",borderWidth:1,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.mIconView=new TKImage,this.mIconView.style={width:this.mIconSize,height:this.mIconSize,borderRadius:this.mIconSize/2,alignSelf:"center"},t.appendChild(this.mIconView),this.appendChild(t),this.mLivingLabel=new TKText,this.mLivingLabel.style={fontSize:10,color:"#FFFFFF",backgroundColor:"#FE3666",height:14,borderRadius:7,paddingHorizontal:4,textAlign:"center",includeFontPadding:!1,position:"absolute",bottom:0},this.mLivingLabel.setText("直播中"),this.appendChild(this.mLivingLabel)}setIconUrl(t){this.mIconView&&t&&this.mIconView.setSrc(t)}}class vh extends uh{constructor(t,e){super(t),this.mTotalHeight=275,this.mLiveCutModel=e,this.setupViews(),this.mCardView.bindView(this.mLiveCutModel)}static newInstance(t){if(be(t))return null;let e=t.getLiveCutRoomInfo();if(be(e))return null;let i=Xa.newLiveCutInstance(t.adInfo,e);return be(i)?null:new vh(t,i)}setupViews(){this.style={width:"100%",height:this.mTotalHeight,gradientBgColor:"270,00000000,0000003D,00000099",flexDirection:"column"},vh.addAdClickEvent(this,t.CARD_BLANK_AREA_CLICK,3,this.vm),this.mClickEnterLiveRoom=new Th,this.appendChild(this.mClickEnterLiveRoom),this.appendChild(this.createCardView())}createCardView(){return this.mCardView=new Vh(this.vm),this.mCardView}getHeight(){return this.mTotalHeight}static addAdClickEvent(e,i,n,s){if(be(e))return;let a=di.createVideoCommonInstance(s.adStyle,s.adInfo);var o,r;e.addEventListener("tap",(t=>{s.convert(1,n,{x:t.position.rawX,y:t.position.rawY},i,a)})),o=s.adInfo,(null===(r=null==o?void 0:o.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===r?void 0:r.slideClick)&&jt(e,(()=>{s.convert(1,n,{x:0,y:0},t.CARD_SWIPE_CONVERT,a)}))}}class Vh extends TKView{constructor(t){super(),this.mCardSlideUpValue=68,this.vm=t,this.mScreenDp=t.obtainScreenWidthDp(),this.setupViews(),setTimeout((()=>{this.showActionBar()}),5e3)}showActionBar(){this.startUpSlideAnimation(this,(()=>{setTimeout((()=>{this.startActionBarTransAnimation(this.mActionBarView)}),500)}))}bindView(t){this.mTopTipsView&&t.sellerTag&&this.mTopTipsView.setText(t.sellerTag),this.mNameView&&t.name&&this.mNameView.setText(t.name),this.mDescView&&t.desc&&this.mDescView.setText(t.desc),this.mActionBarIconView&&t.iconUrl&&this.mActionBarIconView.setIconUrl(t.iconUrl),this.mActionBarTitleView&&t.liveStatDataDesc&&this.mActionBarTitleView.setText(t.liveStatDataDesc),this.mActionBarSubTitleView&&t.actionBarSubTitle&&this.mActionBarSubTitleView.setText(t.actionBarSubTitle),this.mActionBarButton&&t.actionBarDesc&&this.mActionBarButton.setText(t.actionBarDesc)}setupViews(){this.style={height:187,width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-end",paddingHorizontal:16,paddingBottom:20,marginTop:this.mCardSlideUpValue},this.appendChild(this.createTopTipsContainer()),this.appendChild(this.createContentContainer()),this.appendChild(this.createActionBar())}createTopTipsContainer(){let t=new TKView;t.style={height:20,width:"100%",flexDirection:"row",alignItems:"center",marginBottom:8};let e=new TKView;e.style={height:20,width:62,backgroundColor:"#FE3666",borderRadius:4,flexDirection:"row",justifyContent:"center",alignItems:"center"};let i=new TKImage;i.style={width:12,height:12,marginRight:2},ke(i,"icon_ksad_white_shopping_cart2.png"),e.appendChild(i);let n=new TKText;return n.style={color:"#FFFFFF",fontSize:12,includeFontPadding:!1,textAlign:"center"},n.setText("直播中"),e.appendChild(n),t.appendChild(e),this.mTopTipsView=new TKText,this.mTopTipsView.style={height:20,backgroundColor:"#FFFFFF",opacity:.9,color:"#222222",borderRadius:4,marginLeft:8,textAlign:"center",fontSize:12,includeFontPadding:!1,paddingHorizontal:5},t.appendChild(this.mTopTipsView),t}createContentContainer(){let t=new TKView;return t.style={flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between"},this.mNameView=new TKText,this.mNameView.style={color:"#FFFFFF",fontSize:17,includeFontPadding:!1,textLineClamp:1,marginBottom:8,textOverflow:"ellipsis"},t.appendChild(this.mNameView),this.mDescView=new TKText,this.mDescView.style={color:"#FFFFFFE5",fontSize:14,width:"100%",includeFontPadding:!1,textLineClamp:2},t.appendChild(this.mDescView),t}createActionBar(){this.mActionBarView=new TKView,this.mActionBarView.style={width:"100%",height:"56",borderRadius:12,marginTop:12,paddingLeft:8,paddingRight:10,backgroundColor:"#FFFFFF33",marginLeft:0-this.mScreenDp,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},vh.addAdClickEvent(this.mActionBarView,t.CARD_OTHERAREA_CLICK,2,this.vm),this.mActionBarIconView=new Ih,this.mActionBarView.appendChild(this.mActionBarIconView);let e=new TKView;return e.style={flexDirection:"column",flexBasis:100,flexShrink:1,flexGrow:1,height:"100%",justifyContent:"center",alignItems:"flex-start",paddingLeft:13,paddingRight:17},this.mActionBarTitleView=new TKText,this.mActionBarTitleView.style={fontSize:14,textLineClamp:1,color:"#FFFFFF",fontWeight:"medium",marginBottom:2,textOverflow:"ellipsis"},e.appendChild(this.mActionBarTitleView),this.mActionBarSubTitleView=new TKText,this.mActionBarSubTitleView.style={fontSize:10,opacity:.7,textLineClamp:1,color:"#FFFFFF",textOverflow:"ellipsis"},e.appendChild(this.mActionBarSubTitleView),this.mActionBarView.appendChild(e),this.mActionBarButton=new TKText,this.mActionBarButton.style={height:36,borderRadius:18,backgroundColor:"#FE3666",textAlign:"center",fontSize:14,paddingHorizontal:19,color:"#FFFFFF"},this.mActionBarView.appendChild(this.mActionBarButton),vh.addAdClickEvent(this.mActionBarButton,t.CARD_ACTION_BAR_CLICK,1,this.vm),this.mActionBarView}startUpSlideAnimation(t,e){let i=new TKBasicAnimation;i.duration=300,i.on("end",e),i.timingFunction="ease-out",i.setEndValue((()=>{t.style={transform:{translate:{y:-this.mCardSlideUpValue}}}})),t.addAnimation(i,"upSlideAnimation")}startActionBarTransAnimation(t){let e=new TKBasicAnimation;e.duration=500,e.timingFunction="ease-out",e.setEndValue((()=>{t.style={transform:{translate:{x:this.mScreenDp}}}})),t.addAnimation(e,"leftTransAnimation")}}class Ah extends TKView{constructor(t){super(),this.mPlusOneImages=new Array,this.animStopped=!1,this.style={flexDirection:"row",height:70,width:31,justifyContent:"center",alignItems:"flex-end"},this.mPlusOneContainer=this.createPlusOneContainer(),this.appendChild(this.mPlusOneContainer);let e=this;setTimeout((()=>{e.startPlusOneAnim()}),t)}stopAnimation(){this.animStopped=!0}createPlusOneContainer(){let t=new TKView;t.style={opacity:0,height:12,width:15,flexDirection:"column",justifyContent:"flex-end",alignItems:"center"};let e=this.createPlusOneView(),i=this.createPlusOneView(),n=this.createPlusOneView(),s=this.createPlusOneView();return this.mPlusOneImages.push(e,i,n,s),t.appendChild(e),t.appendChild(i),t.appendChild(n),t.appendChild(s),t}createPlusOneView(){let t=new TKImage;return t.style={width:0,height:0,opacity:0,position:"absolute",bottom:0,alignSelf:"center",resize:"contain"},ke(t,"icon_ksad_plus_one.png"),t}startPlusOneAnim(){if(this.animStopped||be(this.mPlusOneContainer))return;let t=new TKBasicAnimation;t.duration=400,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mPlusOneContainer.style={width:31,opacity:1,height:70}}));let e=this.mPlusOneImages.length;for(let n=0;n<e;n++){let t=this.mPlusOneImages[n],e=new TKKeyframeAnimation;e.duration=400,e.timingFunction="EaseOut",e.setAnimations([()=>(t.style={width:31,height:24,opacity:1},1)]),t.addAnimation(e,"imgScale")}this.mPlusOneContainer.addAnimation(t,"plusOneScale");let i=this;t.on("end",(()=>{for(let t=0;t<e;t++){let n=i.mPlusOneImages[t],s=new TKKeyframeAnimation;s.duration=500,s.setAnimations([()=>(n.style={height:12,width:15,opacity:1,transform:{translate:{y:-44}}},1)]),setTimeout((()=>{n.addAnimation(s,"plusOneUp")}),250*t),t==e-1&&s.on("end",(()=>{i.mPlusOneImages.splice(0,e),i.removeChild(i.mPlusOneContainer),i.mPlusOneContainer=null,i.mPlusOneContainer=i.createPlusOneContainer(),i.appendChild(i.mPlusOneContainer),setTimeout((()=>{i.startPlusOneAnim()}),500)}))}}))}}function bh(t,e,i){let n=new TKView;n.style={height:64,width:e};let s=new TKView;s.style={width:"100%",paddingHorizontal:10,height:24,flexDirection:"row",alignItems:"center",borderRadius:12,position:"absolute",bottom:0,left:0,gradientBgColor:"0,#FFB31973,#FFB31999"};let a=new TKImage;a.style={width:"15",height:"18",marginRight:4},ke(a,"icon_ksad_yellow_shooping_cart.png"),s.appendChild(a);let o=new TKText;o.style={color:"#FFFFFF",fontSize:12},o.setText(t),s.appendChild(o);let r=new Ah(i);return r.style={position:"absolute",right:24,bottom:0},n.appendChild(s),n.appendChild(r),n}class Sh extends TKView{constructor(t){super(),this.stopRolling=!1,this.mItemTradeInfoList=t,be(this.mItemTradeInfoList)||this.setupViews()}setupViews(){this.style={width:"100%",height:"100%"}}startRolling(){if(this.stopRolling)return;if(be(this.mItemTradeInfoList))return;let t=this.mItemTradeInfoList.length;this.itemList=new Array;for(let e=0;e<t;e++){let t=this.mItemTradeInfoList[e];this.itemList.push(this.addRollingTipsItemView(t,e))}this.startChildAnimation()}addRollingTipsItemView(t,e){let i=this.mItemTradeInfoList.length,n=new xh(t,i-e);return n.style={position:"absolute",left:0,bottom:-Sh.itemHeight,alignSelf:"center",height:Sh.itemHeight},this.appendChild(n),n}startChildAnimation(){let t=this.mItemTradeInfoList.length;for(let e=0;e<t;e++)setTimeout((()=>{this.itemList[e].slideUpAnimation()}),e*Sh.upSlideDuration)}}Sh.upSlideDuration=800,Sh.itemHeight=24;class xh extends TKView{constructor(t,e){super(),this.upSlideStep=1,this.mInnerSlipUpCallback=()=>{this.upSlideStep>this.maxSlideUpCount||this.slideUpAnimation()},this.mTradeInfo=t,this.maxSlideUpCount=e,this.setupViews()}setupViews(){this.style={flexDirection:"row",justifyContent:"center",alignItems:"center",height:Sh.itemHeight,paddingVertical:2,opacity:0};let t=new TKView;t.style={flexDirection:"row",justifyContent:"flex-start",alignItems:"center",backgroundColor:"#00000066",height:"100%",paddingHorizontal:7,borderRadius:10};let e=new TKImage;e.style={width:12,height:12,borderRadius:8,marginRight:4},e.setSrc(this.mTradeInfo.buyerImage),t.appendChild(e);let i=new TKText;i.style={fontSize:12,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",color:"#FFDC84",includeFontPadding:!1},i.setText(this.mTradeInfo.tradeMessage),t.appendChild(i),this.appendChild(t)}slideUpAnimation(){this.removeAllAnimation();let t=new TKKeyframeAnimation;t.duration=Sh.upSlideDuration,t.timingFunction="EaseOut",t.on("end",this.mInnerSlipUpCallback),t.setAnimations([()=>(this.style={opacity:1,transform:{translate:{y:0-this.upSlideStep*Sh.itemHeight}}},600/Sh.upSlideDuration),()=>(this.style={opacity:1},1)]),this.addAnimation(t,"upSlide"),this.upSlideStep++}}class Lh extends uh{constructor(t,e){super(t),this.mTotalHeight=275,this.mAnimationDelay=1e3,this.mLiveCutModel=e,this.setupViews(),setTimeout((()=>{this.mLiveEmojiAnimation.startAnimation(),this.mCardView.startAllAnimation()}),this.mAnimationDelay)}static newInstance(t){if(be(t))return null;let e=t.getLiveCutRoomInfo();if(be(e))return null;let i=Xa.newLiveCutInstance(t.adInfo,e);return be(i)?null:new Lh(t,i)}setupViews(){this.style={width:"100%",height:this.mTotalHeight},vh.addAdClickEvent(this,t.CARD_BLANK_AREA_CLICK,2,this.vm),this.mClickEnterLiveRoom=new Th,this.appendChild(this.mClickEnterLiveRoom);let e=new TKView;e.style={flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end",paddingHorizontal:16,paddingBottom:20},this.mCardView=new _h(this.vm,this.mLiveCutModel,this.mAnimationDelay),e.appendChild(this.mCardView),e.appendChild(this.createEmojiViewContainer()),this.appendChild(e)}createEmojiViewContainer(){let e=new TKView;e.style={width:36,height:170,flexDirection:"column",justifyContent:"flex-end",alignItems:"center"},this.mLiveEmojiAnimation=new vs(0),this.mLiveEmojiAnimation.style={width:36,height:170},vh.addAdClickEvent(this.mLiveEmojiAnimation,t.ACTIONBAR_ICON_CLICK,2,this.vm),e.appendChild(this.mLiveEmojiAnimation);let i=new TKImage;return i.style={width:36,height:36,position:"absolute",bottom:0},ke(i,"icon_ksad_ec_round_white_like.png"),e.appendChild(i),e}getHeight(){return this.mTotalHeight}}class _h extends TKView{constructor(t,e,i){super(),this.mTradeFlyAnimationDuration=300,this.vm=t,this.mOuterAnimationDelay=i,this.mLiveCutModel=e,this.mScreenDp=t.obtainScreenWidthDp(),this.setupView()}setupView(){this.style={flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-end",paddingRight:28,flexBasis:200,flexGrow:1,flexShrink:1};let t=this.mOuterAnimationDelay+this.mTradeFlyAnimationDuration+500;this.mTradeCustomView=bh(this.mLiveCutModel.tradeCustomerDesc,197,t),this.mTradeCustomView.style={marginLeft:0-this.mScreenDp},this.appendChild(this.mTradeCustomView),this.appendChild(this.createTradeTipsView()),this.appendChild(this.createInputArea())}startAllAnimation(){this.tradeCustomViewFly(),this.startTipsRolling()}tradeCustomViewFly(){let t=new TKBasicAnimation;t.duration=this.mTradeFlyAnimationDuration,t.setEndValue((()=>{this.mTradeCustomView.style={transform:{translate:{x:this.mScreenDp}}}})),this.mTradeCustomView.addAnimation(t,"leftFlyAnimation")}startTipsRolling(){this.rolllingTipsView.startRolling()}createTradeTipsView(){return this.rolllingTipsView=new Sh(this.mLiveCutModel.tradeTips),this.rolllingTipsView.style={height:48,marginTop:8,marginBottom:8},vh.addAdClickEvent(this.rolllingTipsView,t.ACTIONBAR_ICON_COMMENT_CLICK,2,this.vm),this.rolllingTipsView}createInputArea(){let e=new TKView;e.style={width:"100%",height:36,borderRadius:18,borderColor:"#FFFFFF99",borderWidth:1,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingLeft:18,paddingRight:10};let i=new TKText;i.style={color:"#FFFFFFCC",fontSize:14},i.setText("快来和主播聊聊天");let n=new TKImage;return n.style={width:22,height:22},ke(n,"icon_ksad_small_face.png"),e.appendChild(i),e.appendChild(n),vh.addAdClickEvent(e,t.ACTIONBAR_ICON_COMMENT_CLICK,2,this.vm),e}}class Dh extends TKView{constructor(t){super(),this.vm=t,this.isVertical=this.vm.isVertical(),this.size=this.isVertical?{width:188,height:46}:{width:98,height:24},this.setupView(),this.setupAction(),this.setupData();const e=this;Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"showStart"===t&&e.startAnimation()}))}setupView(){this.style={position:"absolute",width:this.size.width+30,height:this.size.height+20,justifyContent:"center",alignItems:"center"},this.buttonView=new TKView,this.buttonView.style={position:"absolute",width:this.size.width,height:this.size.height,backgroundColor:"#0000004D",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:.5*this.size.height,alignSelf:"center"},this.appendChild(this.buttonView),this.containerView=new TKView,this.containerView.style={flexDirection:"row",width:this.size.width,height:this.size.height,justifyContent:"center",alignItems:"center"},this.appendChild(this.containerView),this.iconView=new Fh(this.vm),this.containerView.appendChild(this.iconView),this.titleText=new TKText,this.titleText.style={color:"#FFFFFF",fontSize:this.isVertical?16:10,fontWeight:"medium",marginLeft:6},this.containerView.appendChild(this.titleText)}setupData(){this.titleText.setText(this.vm.getLiveButtonTitle())}setupAction(){const t=this;this.addEventListener("tap",(e=>{t.clickCallback&&t.clickCallback(e)}))}startAnimation(){if(this.isAnimating)return;this.isAnimating=!0,this.iconView.startAnimation();const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.buttonView.style={transform:{scale:1.02}},.6),()=>(t.buttonView.style={transform:{scale:1}},1)]),e.duration=1100,e.repeatCount=Number.MAX_SAFE_INTEGER,this.buttonView.addAnimation(e,"buttonViewAnimation")}}class Fh extends TKView{constructor(t){super(),this.vm=t,this.isVertical=this.vm.isVertical(),this.size=this.isVertical?{width:13,height:13}:{width:9,height:8},this.setupView()}setupView(){this.style={width:this.size.width,height:this.size.height,flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"},this.firstVerticalBar=this.createVerticalBar(this.size.height),this.appendChild(this.firstVerticalBar),this.secondVerticalBar=this.createVerticalBar(this.size.height-8),this.appendChild(this.secondVerticalBar),this.thirdVerticalBar=this.createVerticalBar(this.size.height-4),this.appendChild(this.thirdVerticalBar)}startAnimation(){const t=this.createVerticalBarAnimation(this.firstVerticalBar,this.size.height-4,this.size.height);this.firstVerticalBar.addAnimation(t,"firstVerticalBarAnimation");const e=this.createVerticalBarAnimation(this.secondVerticalBar,this.size.height,this.size.height-8);this.secondVerticalBar.addAnimation(e,"secondVerticalBarAnimation");const i=this.createVerticalBarAnimation(this.thirdVerticalBar,this.size.height-8,this.size.height-4);this.thirdVerticalBar.addAnimation(i,"thirdVerticalBarAnimation")}createVerticalBar(t){const e=new TKView;return e.style={width:this.vm.isVertical()?2:1,height:t,backgroundColor:"#FFFFFF",borderRadius:1},e}createVerticalBarAnimation(t,e,i){const n=new TKKeyframeAnimation;return n.setAnimations([()=>(t.style={height:e},.5),()=>(t.style={height:i},1)]),n.timingFunction="ease-in-out",n.duration=600,n.repeatCount=Number.MAX_SAFE_INTEGER,n}}class kh extends uh{constructor(t){super(t),this.setupViews(),this.setDatas(),this.bindEvent()}setupViews(){if(this.cardWidth=0==this.vm.screenOrientation?this.vm.containerLimit.width:375,this.style={width:this.cardWidth,flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:14,left:0},this.bottomContainer=new TKView,this.bottomContainer.style={width:"100%",height:320,flexDirection:"row"},this.appendChild(this.bottomContainer),this.iconImg=new TKImage,this.iconImg.style={width:48,height:48,borderColor:"#FFFFFF",borderWidth:1,borderRadius:24,marginLeft:16,marginRight:10,marginBottom:this.vm.adInfo.adBaseInfo.haveBeenFollowed?12:0,alignSelf:"flex-end"},this.bottomContainer.appendChild(this.iconImg),this.vm.adInfo.adBaseInfo.haveBeenFollowed){let t=new TKView;t.style={position:"absolute",bottom:0,left:16,width:48,height:17,borderRadius:8.5,backgroundColor:"#FFFFFF",flexDirection:"column",alignItems:"center",justifyContent:"center"};let e=new TKText;e.style={fontSize:10,color:"#222222"},e.setText("你的关注"),t.appendChild(e),this.bottomContainer.appendChild(t)}this.rightCardViewContainer=new TKView,this.rightCardViewContainer.style={position:"absolute",bottom:0,left:74,width:this.cardWidth-90,flexDirection:"column",opacity:0},this.rightCardView=new TKView,this.rightCardView.style={width:"100%",flexDirection:"column",backgroundColor:"#FFFFFF",bottomRightRadius:10,topLeftRadius:10,topRightRadius:10},this.vm.isAdForLive()&&0==this.vm.screenOrientation&&this.appendTextAndProductClickView(),this.vm.isAdForLive()&&0==this.vm.screenOrientation&&this.vm.isAddLiveButton()&&Pe.isAndroid()&&(this.adLiveButton=new Dh(this.vm.getKSAdLiveButtonViewModel()),this.adLiveButton.style={width:"100%",alignSelf:"auto",marginTop:60},this.adLiveButton.startAnimation(),this.adLiveButton.clickCallback=e=>{const i=Te(e,this.adLiveButton);this.convert(1,i,t.LIVE_BUTTON_CLICK)},this.bottomContainer.appendChild(this.adLiveButton)),this.appendAdLogo(),this.rightCardViewContainer.appendChild(this.rightCardView),this.bottomContainer.appendChild(this.rightCardViewContainer),this.appendRightCardTitleView(),this.appendLineView(),this.vm.isValidBottomCouponCardInfo()?(this.appendRightCouponCardView(),this.rightCardViewContainer.style={opacity:1}):(this.appendRightCardDescView(),this.appendActionBarView(),this.startScaleAnimation())}appendTextAndProductClickView(){let t=new TKView;t.style={width:this.cardWidth-24,position:"absolute",left:16,bottom:150,height:170,flexDirection:"row"},this.leftTextClickView=new TKView,this.leftTextClickView.style={width:243,height:170},this.rightProductClickView=new TKView,this.rightProductClickView.style={width:this.cardWidth-24-243,height:170},t.appendChild(this.leftTextClickView),t.appendChild(this.rightProductClickView),this.bottomContainer.appendChild(t)}appendAdLogo(){this.ksadLogoView=new Ri(1,this.vm.adInfo),this.ksadLogoView.style={height:16,marginBottom:4,alignSelf:"flex-end"},this.rightCardViewContainer.appendChild(this.ksadLogoView)}appendRightCardTitleView(){let t=new TKView;t.style={height:32,width:"100%",flexDirection:"row",alignItems:"center"},this.titleText=new TKText,this.titleText.style={color:"#222222",fontSize:14,textLineClamp:1,maxWidth:"92%",paddingLeft:16,paddingRight:4,textOverflow:"ellipsis",fontWeight:"medium"},t.appendChild(this.titleText),this.liveIcon=new vn,t.appendChild(this.liveIcon),this.rightCardView.appendChild(t)}appendLineView(){let t=new TKView;t.style={height:1,width:"100%",flexDirection:"row",alignItems:"center",backgroundColor:"#F6F6F6"},this.rightCardView.appendChild(t)}appendRightCardDescView(){this.descView=new TKText,this.descView.style={marginLeft:16,marginRight:16,textLineClamp:2,textOverflow:"ellipsis",fontSize:12,color:"#666666",textLineHeight:20,marginTop:8,marginBottom:8},this.rightCardView.appendChild(this.descView)}appendActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={height:0,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row",opacity:0},this.rightCardView.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"33%",height:36,backgroundColor:"#FFD7E0",flexDirection:"row",alignItems:"center",topLeftRadius:18,bottomLeftRadius:18,justifyContent:"center"},this.leftActionBarIcon=new TKImage,this.leftActionBarIcon.style={width:17,height:17},this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:14,color:"#FE3666",fontWeight:"medium"},this.leftActionBar.appendChild(this.leftActionBarIcon),this.leftActionBar.appendChild(this.leftActionBarText),this.middleIcon=new TKImage,this.middleIcon.style={width:"9%",height:36},ke(this.middleIcon,"icon_ksad_live_actionbar.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"58%",height:36,topRightRadius:18,bottomRightRadius:18,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarIcon=new TKImage,this.rightActionBarIcon.style={width:17,height:17},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:14,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.rightActionBar.appendChild(this.rightActionBarIcon),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(this.middleIcon),this.actionBarView.appendChild(this.rightActionBar)}appendRightCouponCardView(){this.couponCardView=new TKView,this.couponCardView.style={height:60,width:this.cardWidth-122,marginLeft:16,marginRight:16,marginTop:10,marginBottom:10,position:"absolute"},this.rightCardView.appendChild(this.couponCardView),this.couponCardViewBg=new TKImage,this.couponCardViewBg.style={position:"absolute",top:0,left:0,height:60,borderRadius:4,width:this.cardWidth-122},this.couponCardView.appendChild(this.couponCardViewBg),this.priceLayout=new TKView,this.priceLayout.style={height:60,width:65,position:"absolute",top:0,justifyContent:"center",alignContent:"center",alignItems:"center",flexDirection:"row"},this.couponCardPriceTxt=new TKText,this.couponCardPriceTxt.style={fontSize:20,color:"#FFFFFF",height:60,justifyContent:"center",textAlign:"center",fontWeight:"medium"},this.priceLayout.appendChild(this.couponCardPriceTxt),this.couponCardView.appendChild(this.priceLayout),this.couponCardDesView=new TKView,this.couponCardDesView.style={position:"absolute",left:79,flexDirection:"column",justifyContent:"center",alignContent:"center",height:60,width:90},this.couponCardTitle=new TKText,this.couponCardTitle.style={fontSize:13,color:"#FFFFFF",height:18,fontWeight:"medium",textAlign:"left"},this.couponCardTitle.setText("超值优惠券"),this.couponCardDesView.appendChild(this.couponCardTitle),this.couponCardDurationTxt=new TKText,this.couponCardDurationTxt.style={fontSize:12,color:"#FFFFFF",height:15,opacity:.7,textAlign:"left"},this.couponCardDesView.appendChild(this.couponCardDurationTxt),this.couponCardView.appendChild(this.couponCardDesView),this.couponCardActionBtn=new TKText,this.couponCardActionBtn.style={right:9,top:17,width:62,height:26,backgroundColor:"#FFFFFF",fontSize:12,color:"#FF3A30",alignItems:"center",borderRadius:13,alignContent:"flex-end",justifyContent:"center",textAlign:"center",position:"absolute"},this.couponCardView.appendChild(this.couponCardActionBtn),this.reportCouponImpression()}createFontSizeSpanItem(t,e){const i=new TKSpanItem;return i.spanType="absoluteSize",i.color="#FFFFFF",i.size=12,i.start=t,i.end=e,i}setDatas(){if(this.iconImg.setSrc(this.vm.getAdIcon()),this.titleText.setText(this.vm.getAdTitle()),this.vm.isValidBottomCouponCardInfo()){let t;ke(this.couponCardViewBg,this.vm.getCouponCardViewBg()),t=this.vm.getCouponBottomPriceRMB()+this.vm.getCouponBottomPrice();const e=this.createFontSizeSpanItem(0,this.vm.getCouponBottomPriceRMB().length),i=new TKSpan;i.addSpan(e),this.couponCardPriceTxt.setSpan(t,i),this.couponCardActionBtn.setText(this.vm.getCouponBottomActionBtn()),this.couponCardTitle.setText(this.vm.getCouponBottomTitle()),this.couponCardDuration=1e3*this.vm.getCouponBottomDuration(),this.couponCardDurationTxt.setText(ut(this.couponCardDuration)+"后失效"),this.startShowTimer()}else this.descView.setText(this.vm.adInfo.adBaseInfo.adDescription),this.vm.adInfo.adBaseInfo.haveBeenFollowed?(ke(this.leftActionBarIcon,"icon_ksad_collected.png"),this.leftActionBarText.setText("感兴趣")):(ke(this.leftActionBarIcon,"icon_ksad_live_follow.png"),this.leftActionBarText.setText("关注")),ke(this.rightActionBarIcon,"icon_ksad_live_look.png"),this.rightActionBarText.setText(this.vm.adInfo.adBaseInfo.adActionDescription)}bindEvent(){this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.isValidBottomCouponCardInfo()?this.couponCardView.addEventListener("tap",(e=>{let i=new S,n=new x;n.couponType=this.vm.getCouponBottomBusinessType(),i.neo_ext_data=n,pi.convertIfNeeded(1,this.vm.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK,i)})):(this.leftActionBar.addEventListener("tap",(e=>{let i=new S;i.follows_status=this.vm.adInfo.adBaseInfo.haveBeenFollowed?2:1,pi.convertIfNeeded(1,this.vm.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.CARD_LEFT_ACTION_BAR_CLICK,i)})),this.rightActionBar.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.ACTION_BAR_CLICK)})),this.leftTextClickView&&this.leftTextClickView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.ACTIONBAR_ICON_COMMENT_CLICK)}))),this.rightProductClickView&&this.rightProductClickView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.ACTIONBAR_ICON_CLICK)})),this.adLiveButton&&this.adLiveButton.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.LIVE_BUTTON_CLICK)}))}startScaleAnimation(){setTimeout((()=>{const t=this.getScaleAnimation(this.rightCardViewContainer);this.rightCardViewContainer.addAnimation(t,"scaleAnimation")}),500)}startTransAnimation(){const t=this.getTransformAnimation(this.rightCardViewContainer);this.rightCardViewContainer.addAnimation(t,"tkKeyframeAnimation")}showActionBarAnimation(){const t=this.getShowActionBarAnimation(this.actionBarView);this.actionBarView.addAnimation(t,"showActionBarAnimation")}startActionBarOpacityAnimation(){const t=this.getOpacityActionBarAnimation(this.actionBarView);this.actionBarView.addAnimation(t,"opacityActionBarAnimation"),t.on("end",(t=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}))}getScaleAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={transform:{translate:{x:-t.getSize().width/2/2,y:t.getSize().height/2/2},scale:.5},opacity:.1},1)]),e.duration=100,e.on("end",(()=>{this.startTransAnimation()})),e}getTransformAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={transform:{translate:{x:0,y:0},scale:1},opacity:1},1)]),e.duration=300,e.on("end",(()=>{setTimeout((()=>{this.showActionBarAnimation()}),2e3)})),e}getShowActionBarAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={height:46,paddingBottom:10},1)]),e.duration=300,e.on("end",(()=>{this.startActionBarOpacityAnimation()})),e}getOpacityActionBarAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={opacity:1},1)]),e.duration=300,e.on("end",(()=>{})),e}getHeight(){return 334}startShowTimer(){this.stopShowTimer(),this.showTimer=setInterval((()=>{let t=this.couponCardDuration;this.couponCardDuration=t-10,this.couponCardDuration<=0?this.stopShowTimer():this.couponCardDurationTxt.setText(ut(this.couponCardDuration)+"后失效")}),10)}stopShowTimer(){this.showTimer&&clearInterval(this.showTimer),this.showTimer=0}stopActionAnimation(){this.liveIcon&&this.liveIcon.stopLiveViewAnimation(),this.vm.isValidBottomCouponCardInfo()&&this.stopShowTimer()}reportCouponImpression(){let t=new S,e=new x;e.couponType=this.vm.getCouponBottomBusinessType(),t.neo_ext_data=e;let i={elementType:16,clientExtData:JSON.stringify(t)},n={actionType:140,payload:JSON.stringify(i)};Ne.sendLog(n)}onGetMiddleMarginBottom(t){return t?super.onGetMiddleMarginBottom(t):108}}class Rh extends uh{constructor(t){super(t),this.bigHeight=194,this.smallHeight=146,this.cardHeight=142,this.cardHeightSmall=94,this.animStopped=!1,this.btnHeight=36,this.isPortrait=0==this.vm.screenOrientation;let e=Eh.createInstance(this.vm.adInfo);this.style={height:this.getHeight(),width:this.isPortrait?Pe.isAndroid()?"100%":this.vm.containerLimit.width:375,flexDirection:"column",justifyContent:"flex-end",alignSelf:"flex-end",paddingBottom:16,paddingLeft:16,paddingRight:16},this.appendChild(this.createHeadView(this.vm.adInfo,e)),this.mCardView=this.createCardView(e),this.appendChild(this.mCardView),setTimeout((()=>{this.startTransHeadView()}),2e3)}createHeadView(e,i){let n=new TKView;n.style={height:36,width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"};let s=new TKView;return s.style={height:28,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",backgroundColor:"#00000080",borderRadius:4,marginBottom:-28,paddingRight:12,opacity:0},Rh.addClickConvert(this.vm.adInfo,s,2,t.CARD_FOLLOW_NUM),this.fansListView=new jn(this.vm.adInfo,20,3),this.fansListView.style={width:60,height:20},this.fansCountView=new TKText,this.fansCountView.style={fontSize:12,color:"#FFFFFFFC"},this.fansCountView.setText(i.fansCountText),s.appendChild(this.fansListView),s.appendChild(this.fansCountView),this.mHeadFansView=s,n.appendChild(s),this.logoView=new Ri(1,e),this.logoView.style={height:14,marginBottom:4},n.appendChild(this.logoView),n}createCardView(e){let i=new TKView;if(i.style={width:"100%",height:this.cardHeightSmall,borderRadius:12,paddingLeft:12,paddingTop:11,paddingRight:16,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"space-between"},i.appendChild(this.createBodyView(e)),this.mCardBtnsView=this.createBtnsView(e),i.appendChild(this.mCardBtnsView),e.isLive){let t=new TKText;t.style={fontSize:10,color:"#FFFFFF",backgroundColor:"#FE3666",height:14,topLeftRadius:7,topRightRadius:7,bottomRightRadius:7,position:"absolute",top:12,left:50,paddingHorizontal:5,textAlign:"center"},t.setText("直播"),i.appendChild(t)}return Rh.addClickConvert(this.vm.adInfo,i,2,t.CARD_OTHERAREA_CLICK),i}startTransHeadView(){let t=new TKBasicAnimation;t.setEndValue((()=>{this.mHeadFansView.style={opacity:1,transform:{translate:{y:-36}}}})),t.timingFunction="EaseOut",t.duration=300,t.on("end",(()=>{setTimeout((()=>{this.switchToBigCard()}),3e3)})),this.mHeadFansView.addAnimation(t,"headFansTrans")}switchToBigCard(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.mCardBtnsView.style={opacity:1},1)]),t.duration=300,t.timingFunction="EaseOut";let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.mCardView.style={height:this.cardHeight},1)]),e.duration=300,e.timingFunction="EaseOut",this.mCardBtnsView.addAnimation(t,"btnOpacity"),this.mCardView.addAnimation(e,"cardSwitch")}startLiveBorderAnima(t){let e=new TKKeyframeAnimation;t.style={opacity:0,transform:{scale:1}},e.setAnimations([()=>(t.style={opacity:1,transform:{scale:1.16}},.5),()=>(t.style={opacity:0,transform:{scale:1.35}},1)]),e.duration=500,t.addAnimation(e,"borderWave")}createBodyView(e){let i=new TKView;return i.style={width:"100%",height:70,marginBottom:8,flexDirection:"row"},this.iconArea=new TKView,this.iconArea.style={width:70,height:70,marginRight:3,flexDirection:"column",justifyContent:"center",alignItems:"center"},Rh.addClickConvert(this.vm.adInfo,this.iconArea,2,t.CARD_ICON_CLICK),e.isLive&&(this.mIconBorder=new TKView,this.mIconBorder.style={opacity:0,width:52,height:52,borderColor:"#FE3666",borderWidth:1,borderRadius:26,position:"absolute"},this.iconArea.appendChild(this.mIconBorder),this.animateTimer=setInterval((()=>{this.startLiveBorderAnima(this.mIconBorder)}),1e3)),this.iconView=new TKImage,this.iconView.style={width:52,height:52,borderRadius:26,position:"absolute"},this.iconView.setSrc(e.icon),this.iconArea.appendChild(this.iconView),i.appendChild(this.iconArea),this.textContainer=new TKView,this.textContainer.style={height:"60",maxWidth:227,marginTop:4,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start"},this.nameView=new TKText,this.nameView.style={width:"100%",fontSize:16,textAlign:"left",fontWeight:"medium",color:"#000000",textLineClamp:1,textOverflow:"ellipsis"},this.nameView.setText(e.name),Rh.addClickConvert(this.vm.adInfo,this.nameView,2,t.CARD_ICON_NAME_CLICK),this.textContainer.appendChild(this.nameView),this.descView=new TKText,this.descView.style={width:"100%",textLineClamp:2,fontSize:12,color:"#666666",textOverflow:"ellipsis"},this.descView.setText(e.desc),Rh.addClickConvert(this.vm.adInfo,this.descView,2,t.CARD_ICON_COMMENT_CLICK),this.textContainer.appendChild(this.descView),i.appendChild(this.textContainer),i}createBtnsView(e){this.btnsView=new TKView,this.btnsView.style={height:this.btnHeight,width:"100%",opacity:0,marginBottom:16,flexDirection:"row"},Rh.addClickConvert(this.vm.adInfo,this.btnsView,1,t.CARD_ACTION_BAR_CLICK);let i=this.btnHeight/2;return this.detailContainer=new TKView,this.detailContainer.style={height:"100%",width:"35%",backgroundColor:"#FFD7E0",topLeftRadius:i,bottomLeftRadius:i,flexDirection:"row",justifyContent:"center",paddingLeft:6},this.btnDetail=new TKText,this.btnDetail.style={height:"100%",fontSize:14,textAlign:"center",color:"#FE3666",textLineClamp:1},this.btnDetail.setText(e.btnDetail),this.detailContainer.appendChild(this.btnDetail),this.dividerImage=new TKImage,this.dividerImage.style={width:"8%",height:"100%"},ke(this.dividerImage,"icon_ec_follow_btns.png"),this.followContainer=new TKView,this.followContainer.style={height:"100%",width:"57%",backgroundColor:"#FE3666",topRightRadius:i,bottomRightRadius:i,paddingRight:11},this.followArea=new TKView,this.followArea.style={justifyContent:"center",flexDirection:"row",alignItems:"center",height:"100%",width:"100%"},this.btnFollow=new TKText,this.btnFollow.style={fontSize:14,textLineClamp:1,textAlign:"center",color:"#FFFFFF",width:"100%"},this.btnFollow.setText(Vt(this.vm.adInfo)),this.followArea.appendChild(this.btnFollow),this.followContainer.appendChild(this.followArea),(new TKView).style={width:11,height:"100%"},Rh.addClickConvert(this.vm.adInfo,this.detailContainer,1,t.ACTION_BAR_CLICK),Rh.addClickConvert(this.vm.adInfo,this.followContainer,1,t.ACTION_BAR_CLICK),this.btnsView.appendChild(this.detailContainer),this.btnsView.appendChild(this.dividerImage),this.btnsView.appendChild(this.followContainer),this.btnsView}static addClickConvert(t,e,i,n){e.addEventListener("tap",(e=>{pi.convertIfNeeded(1,t,i,e.position,n,null)}))}getHeight(){return this.bigHeight}stopActionAnimation(){this.animStopped=!0,this.animateTimer&&clearInterval(this.animateTimer),be(this.mIconBorder)||this.mIconBorder.removeAllAnimation()}}class Bh extends uh{constructor(t){super(t),this.cardHeight=210,this.toolsButtonSize=32,this.itemHeight=8,this.itemHeightHight=14,this.animStopped=!1,this.mPlusOneImages=new Array,this.isPortrait=0==this.vm.screenOrientation;let e=Eh.createInstance(this.vm.adInfo);this.style={flexDirection:"row",height:this.getHeight(),width:Pe.isAndroid()?"100%":this.vm.containerLimit.width};let i=new TKView;i.style={width:"100%",height:193,position:"absolute",bottom:0,left:0,right:0,gradientBgColor:"90,00000099,00000000"},this.appendChild(i),this.appendChild(this.createCardArea(e)),e.isLive||this.appendChild(this.createRightToolButtons(e)),setTimeout((()=>{this.startAnim()}),500)}createCardArea(e){if(this.cardArea=new TKView,this.cardArea.style={width:e.isLive?"100%":"78%",height:this.getHeight(),justifyContent:e.isLive?"space-between":"flex-end",flexDirection:"column",paddingTop:e.isLive?64:0},Rh.addClickConvert(this.vm.adInfo,this.cardArea,2,t.CARD_OTHERAREA_CLICK),e.isLive){let t=this.createLiveLabel();this.cardArea.appendChild(t)}let i=new TKView;return this.mCardView=i,i.style={width:"100%",height:this.cardHeight,alignSelf:"flex-end",justifyContent:"space-between",flexDirection:"column",marginBottom:-52,paddingLeft:12,paddingRight:12,paddingBottom:16},this.mHeadView=this.createCardHeadView(e),i.appendChild(this.mHeadView),i.appendChild(this.createCardBodyView(e)),this.mBtnsView=this.createCardBtnsView(e),i.appendChild(this.mBtnsView),this.cardArea.appendChild(i),this.cardArea}startAnim(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.mHeadView.style={transform:{translate:{x:375}}},1)]),t.duration=300,t.timingFunction="EaseOut",t.on("end",(()=>{this.animStopped||(setTimeout((()=>{this.startCardUpAnim()}),5e3),this.startPlusOneAnim())})),this.mHeadView.addAnimation(t,"headTrans")}startCardUpAnim(){if(this.animStopped)return;let t=new TKKeyframeAnimation;t.duration=300,t.timingFunction="EaseOut",t.setAnimations([()=>(this.mCardView.style={transform:{translate:{y:-52}}},1)]);let e=new TKKeyframeAnimation;e.duration=300,e.timingFunction="EaseOut",e.setAnimations([()=>(this.mBtnsView.style={opacity:1},1)]),this.mCardView.addAnimation(t,"cardUp"),this.mBtnsView.addAnimation(t,"btnsAlpha")}startPlusOneAnim(){if(this.animStopped||be(this.mPlusOneView))return;let t=new TKKeyframeAnimation;t.duration=300,t.timingFunction="EaseOut",t.setAnimations([()=>(this.mPlusOneView.style={width:31,opacity:1,height:70},1)]);let e=this.mPlusOneImages.length;for(let i=0;i<e;i++){let t=this.mPlusOneImages[i],e=new TKKeyframeAnimation;e.duration=300,e.timingFunction="EaseOut",e.setAnimations([()=>(t.style={width:31,height:24,opacity:1},1)]),t.addAnimation(e,"imgScale")}this.mPlusOneView.addAnimation(t,"plusOneScale"),t.on("end",(()=>{for(let t=0;t<e;t++){let i=this.mPlusOneImages[t],n=new TKKeyframeAnimation;n.duration=500,n.setAnimations([()=>(i.style={height:12,width:15,opacity:0,transform:{translate:{y:-44}}},1)]),setTimeout((()=>{i.addAnimation(n,"plusOneUp")}),250*t),t==e-1&&n.on("end",(()=>{this.mPlusOneImages.splice(0,e),this.mHeadView.removeChild(this.mPlusOneView),this.mPlusOneView=null,this.mPlusOneView=this.createPlusOneContainer(),this.mHeadView.appendChild(this.mPlusOneView),setTimeout((()=>{this.startPlusOneAnim()}),500)}))}}))}createPlusOneContainer(){let t=new TKView;t.style={opacity:0,height:12,width:15,bottom:8,right:61,position:"absolute",flexDirection:"column",justifyContent:"flex-end",alignItems:"center"};let e=this.createPlusOneView(),i=this.createPlusOneView(),n=this.createPlusOneView(),s=this.createPlusOneView();return this.mPlusOneImages.push(e,i,n,s),t.appendChild(e),t.appendChild(i),t.appendChild(n),t.appendChild(s),t}createPlusOneView(){let t=new TKImage;return t.style={width:0,height:0,opacity:0,position:"absolute",bottom:0,right:0,resize:"contain"},ke(t,"icon_ksad_plus_one.png"),t}createLiveLabel(){let t=new TKView;t.style={width:"100%",height:30,justifyContent:"center",alignItems:"center",flexDirection:"row"};let e={width:2,height:this.itemHeight,backgroundColor:"#FFFFFF"},i=new TKView;i.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:16,height:24};let n=new TKView;n.style=e;let s=new TKView;s.style=e;let a=new TKView;a.style=e,i.appendChild(n),i.appendChild(s),i.appendChild(a),t.appendChild(i);let o=new TKText;o.style={color:"#FFFFFF",fontSize:20,textAlign:"center",paddingLeft:8,paddingRight:8},o.setText("当前正在直播"),t.appendChild(o);let r=new TKView;r.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:16,height:24};let h=new TKView;h.style=e;let l=new TKView;l.style=e;let d=new TKView;return d.style=e,r.appendChild(h),r.appendChild(l),r.appendChild(d),t.appendChild(r),n.addAnimation(this.createWaveItemAnim(n,1),"wave"),s.addAnimation(this.createWaveItemAnim(s,2),"wave"),a.addAnimation(this.createWaveItemAnim(a,3),"wave"),d.addAnimation(this.createWaveItemAnim(d,1),"wave"),l.addAnimation(this.createWaveItemAnim(l,2),"wave"),h.addAnimation(this.createWaveItemAnim(h,3),"wave"),t}createWaveItemAnim(t,e){let i=new TKKeyframeAnimation;return i.setAnimations([()=>(t.style={height:this.itemHeight},.25*(e-1)),()=>(t.style={height:this.itemHeightHight},.25*e),()=>(t.style={height:this.itemHeight},1)]),i.duration=1200,i.repeatCount=-1,i.timingFunction="EaseOut",i.on("start",(()=>{this.animStopped&&t.removeAnimation("wave")})),i}createCardHeadView(e){let i=new TKView;if(i.style={height:"70",marginLeft:-375,width:e.isLive?"78%":"100%",flexDirection:"column",justifyContent:"flex-end"},this.headView=new TKView,this.headView.style={width:"100%",height:28,borderRadius:14,gradientBgColor:"0,FE366600,FE3666",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},Rh.addClickConvert(this.vm.adInfo,this.headView,2,t.CARD_FOLLOW_NUM),this.fansListView=new jn(this.vm.adInfo,20,3),this.fansListView.style={width:60,height:20,marginRight:8},this.fansCountView=new TKText,this.fansCountView.style={fontSize:12,color:"#FFFFFF"},this.fansCountView.setText(e.fansCountText),this.plusOneView=null,this.needShowPlusOneLabel()){this.plusOneView=new TKView,this.plusOneView.style={height:20,width:44,borderRadius:10,backgroundColor:"#FFFFFF",flexDirection:"row",justifyContent:"center",alignItems:"center",position:"absolute",right:4};let t=new TKText;t.style={fontSize:10,color:"#FE3666",marginRight:2},t.setText("我要"),this.iconPlusOne=new TKImage,this.iconPlusOne.style={height:9,width:11},ke(this.iconPlusOne,"icon_ksad_plus_one_pink.png"),this.plusOneView.appendChild(t),this.plusOneView.appendChild(this.iconPlusOne)}return this.headView.appendChild(this.fansListView),this.headView.appendChild(this.fansCountView),null!=this.plusOneView&&this.headView.appendChild(this.plusOneView),i.appendChild(this.headView),this.needShowPlusOneAnima()&&(this.mPlusOneView=this.createPlusOneContainer(),i.appendChild(this.mPlusOneView)),i}createCardBodyView(e){let i=new TKView;i.style={flexDirection:"column",width:"100%"};let n=new TKView;return n.style={flexDirection:"row",width:"100%",alignItems:"center"},this.nameView=new TKText,this.nameView.style={fontSize:15,color:"#FFFFFF",fontWeight:"bold",textAlign:"center",includeFontPadding:!1,marginBottom:5},this.nameView.setText("@"+e.name),n.appendChild(this.nameView),Rh.addClickConvert(this.vm.adInfo,this.nameView,2,t.CARD_ICON_NAME_CLICK),this.logoView=new Ri(0,this.vm.adInfo,12),this.logoView.style={height:12,opacity:.4,marginLeft:8},n.appendChild(this.logoView),i.appendChild(n),this.descView=new TKText,this.descView.style={fontSize:14,color:"#FFFFFF",fontWeight:"normal",textLineClamp:2,textOverflow:"ellipsis",textAlign:"left"},this.descView.setText(e.desc),i.appendChild(this.descView),Rh.addClickConvert(this.vm.adInfo,this.descView,2,t.CARD_ICON_COMMENT_CLICK),i}createCardBtnsView(e){this.btnsView=new TKView,this.btnsView.style={height:36,width:"100%",flexDirection:"row",justifyContent:"space-between"},Rh.addClickConvert(this.vm.adInfo,this.btnsView,1,t.CARD_ACTION_BAR_CLICK),this.btnDetailArea=new TKView,this.btnDetailArea.style={height:"100%",width:"48%",backgroundColor:"#FFFFFF",borderRadius:18,flexDirection:"row",alignItems:"center",justifyContent:"center"},this.btnDetail=new TKText,this.btnDetail.style={height:"100%",color:"#FE3666",textAlign:"center"},this.btnDetail.setText(e.btnDetail),this.btnDetailArea.appendChild(this.btnDetail),this.btnsView.appendChild(this.btnDetailArea),this.followContainer=new TKView,this.followContainer.style={height:"100%",width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:"#FE3666",borderRadius:18},this.btnFollow=new TKText,this.btnFollow.style={height:"100%",color:"#FFFFFF",textAlign:"center"},this.btnFollow.setText(Vt(this.vm.adInfo)),this.followContainer.appendChild(this.btnFollow);let i=new TKView;return i.style={height:"100%",width:"48%"},i.appendChild(this.followContainer),this.btnsView.appendChild(i),this.btnsView}createRightToolButtons(e){this.toolsArea=new TKView,this.toolsArea.style={flexDirection:"column",height:"100%",width:"22%",justifyContent:"space-between",alignItems:"center",paddingBottom:22},Rh.addClickConvert(this.vm.adInfo,this.toolsArea,1,t.CARD_ICON_CLICK);let i=this.createAvatarView(e);return this.toolsArea.appendChild(i),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_heart.png","点赞")),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_comment.png","评论")),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_favor.png","收藏")),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_share.png","分享")),this.toolsArea}newToolsIcon(t,e){return this.toolBtn=new TKView,this.toolBtn.style={flexDirection:"column",width:"100%",alignItems:"center"},this.image=new TKImage,this.image.style={padding:2,width:this.toolsButtonSize,height:this.toolsButtonSize},this.image.setSrc(t),ke(this.image,t),this.toolBtn.appendChild(this.image),this.titleView=new TKText,this.titleView.style={fontSize:10,textAlign:"center",color:"#FFFFFF"},this.titleView.setText(e),this.toolBtn.appendChild(this.titleView),this.toolBtn}createAvatarView(t){let e=new TKView;e.style={width:44,height:52,flexDirection:"column",alignItems:"center"},this.avatarImage=new TKImage,this.avatarImage.style={width:44,height:44,borderRadius:22,borderColor:"#FFFFFF",borderWidth:1},this.avatarImage.setSrc(t.icon),e.appendChild(this.avatarImage);let i=new TKView;return i.style={height:16,width:26,backgroundColor:"#FE3666",borderRadius:8,flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",bottom:0},this.addImgae=new TKImage,this.addImgae.style={height:10,width:10,alignSelf:"center"},ke(this.addImgae,"icon_ksad_add_white_no_margin.png"),i.appendChild(this.addImgae),e.appendChild(i),e}needShowPlusOneLabel(){let t=this.vm.configInfo.abConfig.shortVideoFollowRewardAnimationStyle;return 0==t||2==t}needShowPlusOneAnima(){let t=this.vm.configInfo.abConfig.shortVideoFollowRewardAnimationStyle;return 0==t||1==t}getHeight(){return 318}stopActionAnimation(){this.animStopped=!0}}class Eh{constructor(){this.btnDetail="了解更多",this.fansCountText="100万人关注了ta"}static createInstance(t){let e=new Eh;return e.name=K.getAdTitle(t),e.desc=t.adBaseInfo.adDescription,be(e.desc)&&(e.desc=""),e.icon=K.getIconUrl(t),e.isLive=t.adBaseInfo.isAccountLive,e.fansCountText=st(t)+"人关注了Ta",e}}class Kh extends uh{constructor(t){super(t),this.bottomBgColor="90,#00000080,#00000000",0==this.vm.screenOrientation?this.style={width:"100%",height:"100%"}:this.style={width:"50%",height:"100%",position:"absolute",right:0,bottom:0},this.setupViews()}setupViews(){let t=new TKView;t.style={width:"100%",height:193,gradientBgColor:this.bottomBgColor,position:"absolute",bottom:0},this.appendChild(t),this.initDailogSmallCard(),this.initDailogBigCard(),this.initBottomUI(),setTimeout((()=>{this.showSmallDialog()}),500)}initBottomUI(){let e=new TKView;e.style={height:68,width:"100%",padding:16,left:0,bottom:0,position:"absolute",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.appendChild(e);let i=new TKView;i.style={flexGrow:1,height:36,marginRight:8,borderRadius:18,backgroundColor:"#FFFFFF32",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",alignContent:"center"},e.appendChild(i),this.fansListView=new jn(this.vm.adInfo,24,4),this.fansListView.style={width:86,height:24,marginLeft:6},i.appendChild(this.fansListView);let n=new TKText;n.style={fontSize:12,color:"#FFFFFF",marginLeft:-3,marginRight:8,height:34,textAlign:"center"},n.setText(st(this.vm.adInfo)+"人关注了Ta"),i.appendChild(n),this.coverButton=new TKButton,this.coverButton.style={width:110,height:36,borderRadius:18,backgroundColor:"#FE3666",fontSize:14,color:"#FFFFFF"},this.coverButton.setText(this.vm.adInfo.adBaseInfo.adActionDescription),e.appendChild(this.coverButton),i.addEventListener("tap",(e=>{const i=Te(e,this);this.convert(2,i,t.CARD_FOLLOW_NUM)})),this.coverButton.addEventListener("tap",(e=>{const i=Te(e,this);this.convert(1,i,t.CARD_ACTION_BAR_CLICK)}))}initDailogSmallCard(){this.dialogSmallContainer=this.initDailogCardUI(!1),this.appendChild(this.dialogSmallContainer),this.dialogSmallContainer.addEventListener("tap",(e=>{const i=Te(e,this);this.convert(2,i,t.CARD_OTHERAREA_CLICK)}))}initDailogBigCard(){this.dialogBigContainer=this.initDailogCardUI(!0),this.appendChild(this.dialogBigContainer),this.dialogBigContainer.addEventListener("tap",(e=>{const i=Te(e,this);this.convert(2,i,t.CARD_OTHERAREA_CLICK)}))}initDailogCardUI(t){let e=new TKView;e.style={position:"absolute",height:t?88:60,width:"100%",paddingLeft:16,paddingRight:68,top:120,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",opacity:0};let i=new TKView;i.style={height:"100%",width:44},e.appendChild(i);let n=new TKImage;n.style={width:44,height:44,borderColor:"#FFFFFF",borderWidth:1,borderRadius:22};let s=this.vm.adInfo.adBaseInfo.appIconUrl;Ie(s)||(s="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),n.setSrc(s),i.appendChild(n);let a=new TKView;a.style={position:"absolute",width:26,height:16,borderRadius:8,backgroundColor:"#FE3666",left:9,top:34,flexDirection:"row",justifyContent:"center",alignItems:"center"},i.appendChild(a);let o=new TKImage;o.style={width:12,height:12},ke(o,"icon_ksad_fans_follow.png"),a.appendChild(o);let r=new TKView;r.style={height:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",flexGrow:1},e.appendChild(r);let h=new TKView;h.style={width:"100%",height:16,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},r.appendChild(h);let l=new TKView;l.style={height:"100%",maxWidth:"80%",marginLeft:12},h.appendChild(l);let d=this.vm.adInfo.adBaseInfo.appName;Ie(d)||(d=K.getAdTitle(this.vm.adInfo));let c=new TKText;c.style={fontSize:12,height:"100%",width:"100%",color:"#00000030",position:"absolute",marginTop:1,marginLeft:1,textLineClamp:1,textOverflow:"ellipsis"},c.setText(d),l.appendChild(c);let p=new TKText;p.style={fontSize:12,height:"100%",color:"#FFFFFF",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},p.setText(d),l.appendChild(p),this.vm.adInfo.adBaseInfo.isAccountLive&&(t?(this.liveIcon=new vn,this.liveIcon.style={marginLeft:4,marginRight:4},h.appendChild(this.liveIcon)):(this.liveIconSmall=new vn,this.liveIconSmall.style={marginLeft:4,marginRight:4},h.appendChild(this.liveIconSmall)));let m=new TKText;m.style={color:"#FFFFFF80",fontSize:12,marginLeft:4,textAlign:"center"},m.setText("刚刚"),h.appendChild(m);let g=new TKView;g.style={marginTop:4,height:t?66:40,width:"100%",paddingRight:16,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},r.appendChild(g);let u=new TKView;u.style={width:7,height:"100%",marginLeft:5},g.appendChild(u);let w=new TKImage;if(w.style={width:7,height:14,position:"absolute",top:10},ke(w,"icon_ksad_fans_triangle.png"),u.appendChild(w),t){let t=new TKView;t.style={height:"100%",width:"100%",borderRadius:8,paddingLeft:15,paddingRight:15,backgroundColor:"#FFFFFF"},g.appendChild(t);let e=new TKText;e.style={fontSize:14,textLineClamp:2,textLineSpace:4,textOverflow:"ellipsis",color:"#222222",width:"100%",height:"100%",textAlign:"center"},e.setText(this.vm.adInfo.adBaseInfo.adDescription),t.appendChild(e);let i=new Ri(0,this.vm.adInfo);i.style={height:16,position:"absolute",right:4,bottom:4},r.appendChild(i)}else{let t=new TKView;t.style={height:"100%",borderRadius:8,backgroundColor:"#FFFFFF"},g.appendChild(t);let e=new TKText;e.style={fontSize:14,color:"#222222",height:20,marginTop:10,marginBottom:10,marginLeft:15,marginRight:10},e.setText("快来关注我吧"),t.appendChild(e)}return e}stopActionAnimation(){this.dialogSmallContainer.removeAllAnimation(),this.dialogBigContainer.removeAllAnimation(),this.liveIcon.stopLiveViewAnimation(),this.liveIconSmall.stopLiveViewAnimation(),this.fansListView.stopActionAnimation()}showSmallDialog(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.dialogSmallContainer.style={top:106,opacity:1},1)]),t.duration=300,t.on("end",(()=>{setTimeout((()=>{this.showBigDialog()}),2e3)})),this.dialogSmallContainer.addAnimation(t,"showSmallAniamtion")}showBigDialog(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.dialogSmallContainer.style={top:0,opacity:0},1)]),t.duration=500,this.dialogSmallContainer.addAnimation(t,"hideSmallAniamtion");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.dialogBigContainer.style={top:78,opacity:1},1)]),e.duration=500,this.dialogBigContainer.addAnimation(e,"showbigAniamtion")}getHeight(){return 234}}class Ph extends TKView{constructor(){super(),this.tag1=new Mh(1),this.appendChild(this.tag1),this.tag2=new Mh(2),this.appendChild(this.tag2),this.tag3=new Mh(3),this.appendChild(this.tag3),this.tag4=new Mh(4),this.appendChild(this.tag4),this.starAnimation()}starAnimation(){this.tagShow(this.tag1),this.animationAllowed=!0}stopActionAnimation(){this.animationAllowed=!1,this.tag1&&this.tag1.removeAllAnimation(),this.tag2&&this.tag2.removeAllAnimation(),this.tag3&&this.tag3.removeAllAnimation(),this.tag4&&this.tag4.removeAllAnimation()}cycleAnimation(){this.animationAllowed&&(90==this.tag1.status?(this.tag1.status=60,this.tag2.status=90,this.tag3.status=0,this.tag4.status=36):60==this.tag1.status?(this.tag1.status=36,this.tag2.status=60,this.tag3.status=90,this.tag4.status=0):36==this.tag1.status?(this.tag1.status=0,this.tag2.status=36,this.tag3.status=60,this.tag4.status=90):0==this.tag1.status&&(this.tag1.status=90,this.tag2.status=0,this.tag3.status=36,this.tag4.status=60),this.tag1.updateCurrentTop(),this.tag2.updateCurrentTop(),this.tag3.updateCurrentTop(),this.tag4.updateCurrentTop(),setTimeout((()=>{this.cycleAnimation()}),800))}tagShow(t){t.updateCurrentTop(),setTimeout((()=>{t==this.tag1&&(this.tag1.status=60,this.tagShow(this.tag2),this.tag1.updateCurrentTop()),t==this.tag2&&(this.tag2.status=60,this.tag1.status=36,this.tagShow(this.tag3),this.tag1.updateCurrentTop(),this.tag2.updateCurrentTop()),t==this.tag3&&(this.tag3.status=60,this.tag1.status=0,this.tag2.status=36,this.tag1.updateCurrentTop(),this.tag2.updateCurrentTop(),this.tag3.updateCurrentTop(),this.tagShow(this.tag4)),t==this.tag4&&this.cycleAnimation()}),800)}}class Mh extends TKView{constructor(t){switch(super(),this.isShow=!1,this.style={height:20,borderRadius:10,position:"absolute",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",backgroundColor:"#00000060",top:90,opacity:0},this.leftIcon=new TKImage,this.leftIcon.style={width:16,height:16,marginLeft:8},this.appendChild(this.leftIcon),this.contentText=new TKText,this.contentText.style={height:"100%",marginLeft:3,marginRight:8,fontSize:12,color:"#FFDC84",textAlign:"center"},this.appendChild(this.contentText),t){case 1:ke(this.leftIcon,"icon_ksad_fans_live_car.png"),this.contentText.setText("好物推荐超低折扣");break;case 2:ke(this.leftIcon,"icon_ksad_fans_live_heart.png"),this.contentText.setText("宠粉主播");break;case 3:ke(this.leftIcon,"icon_ksad_fans_live_gift.png"),this.contentText.setText("进入直播间送惊喜");break;case 4:ke(this.leftIcon,"icon_ksad_fans_live_grass.png"),this.contentText.setText("种草达人")}}updateCurrentTop(){let t=90,e=90;if(60==this.status)t=60,e=36;else if(36==this.status)t=36,e=0,this.tagHideAnimation();else{if(0==this.status)return this.style={top:90},void this.layout();t=90,e=60,this.tagShowAnimation()}let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.style={top:t},0),()=>(this.style={top:e},1)]),i.duration=800,this.addAnimation(i,"updateTopAniamtion")}tagShowAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={opacity:0},0),()=>(this.style={opacity:1},1)]),t.duration=800,this.addAnimation(t,"showAniamtion")}tagHideAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={opacity:1},0),()=>(this.style={opacity:0},1)]),t.duration=800,this.addAnimation(t,"hideAniamtion")}}class Oh extends uh{constructor(t){super(t),this.setupViews(),this.reloadDataInfo(),this.bindEvent()}setupViews(){this.style={width:"100%",height:"100%"},this.initLiveUI(),this.initBottomCardUI(),this.initAniamteUI(),setTimeout((()=>{this.changeAnimation()}),2400)}initLiveUI(){this.liveContainer=new TKView,this.liveContainer.style={position:"absolute",height:132,width:"100%",left:16,top:90,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"},this.appendChild(this.liveContainer),this.liveTopImage=new TKImage,this.liveTopImage.style={width:123,height:52,position:"absolute",top:5},ke(this.liveTopImage,"icon_ksad_fans_live.png"),this.liveTagListView=new Ph,this.liveTagListView.style={width:"100%",height:100,top:30},this.liveContainer.appendChild(this.liveTagListView),this.liveContainer.appendChild(this.liveTopImage)}initBottomCardUI(){this.bottomContainer=new TKView,this.bottomContainer.style={position:"absolute",width:"100%",height:100,bottom:0,left:-500},this.appendChild(this.bottomContainer),this.ksadLogoView=new Ri(1,this.vm.adInfo),this.ksadLogoView.style={height:16,position:"absolute",right:16,top:0},this.bottomContainer.appendChild(this.ksadLogoView);let t=new TKView;t.style={position:"absolute",width:"100%",height:94,bottom:0,padding:16},this.bottomContainer.appendChild(t);let e=new TKView;e.style={width:"100%",height:"100%",borderRadius:12,backgroundColor:"#00000060",flexDirection:"row",justifyContent:"space-between",padding:12},t.appendChild(e),this.appIcon=new TKImage,this.appIcon.style={width:20,height:20,borderRadius:10},e.appendChild(this.appIcon),this.descText=new TKText,this.descText.style={color:"#FFFFFF",fontSize:14,flexShrink:2,paddingLeft:8,paddingRight:4,width:"100%",textLineSpace:4,textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descText),this.coverBtn=new TKButton,this.coverBtn.style={width:73,height:33,borderRadius:16.5,backgroundColor:"#FFFFFF32",fontSize:14,color:"#FFFFFF"},e.appendChild(this.coverBtn)}initAniamteUI(){this.imageAnimationView=new vs(15),this.imageAnimationView.style={width:73,height:170,position:"absolute",right:32,opacity:0},this.appendChild(this.imageAnimationView)}reloadDataInfo(){try{let t=this.vm.adInfo,e=t.adBaseInfo.appIconUrl;Ie(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),this.appIcon.setSrc(e),this.descText.setText(t.adBaseInfo.adDescription),this.coverBtn.setText(t.adBaseInfo.adActionDescription)}catch(t){}}bindEvent(){this.liveContainer.addEventListener("tap",(e=>{const i=Te(e,this);this.convert(2,i,t.CARD_RECOMMEND_REASON_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{const i=Te(e,this);this.convert(2,i,t.CARD_OTHERAREA_CLICK)})),this.coverBtn.addEventListener("tap",(e=>{const i=Te(e,this);this.convert(1,i,t.CARD_ACTION_BAR_CLICK)}))}stopActionAnimation(){this.liveTagListView.stopActionAnimation(),this.imageAnimationView.stopActionAnimation()}changeAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.liveContainer.style={top:10},1)]),t.duration=1e3,this.liveContainer.addAnimation(t,"liveContainerAniamtion"),setTimeout((()=>{this.showBottomAnimation()}),500)}showBottomAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.bottomContainer.style={left:0},1)]),t.duration=500,t.on("end",(()=>{setTimeout((()=>{this.coverButtomAnimation()}),2e3)})),this.bottomContainer.addAnimation(t,"bottomContainerAniamtion")}coverButtomAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.coverBtn.style={backgroundColor:"#FE3666"},1)]),t.duration=500,t.on("end",(()=>{setTimeout((()=>{this.showImageAnimation()}),2e3)})),this.coverBtn.addAnimation(t,"coverAniamtion")}showImageAnimation(){this.imageAnimationView.style={opacity:1},this.imageAnimationView.startAnimation()}getHeight(){return 218}}class Nh extends TKView{constructor(t){super(),this.mTimer=-1,this.mCurrentIndex=0,this.stopRolling=!1,this.mEndCallback=t=>{this.removeChild(t),this.mCurrentIndex++,this.startRolling()},this.mItemTradeInfoList=t,this.setupViews(),this.startRolling()}setupViews(){this.style={width:"100%",height:"100%"}}startRolling(){if(this.stopRolling||!this.mItemTradeInfoList)return;let t=this.mCurrentIndex%this.mItemTradeInfoList.length,e=this.mItemTradeInfoList[t];be(e)||this.addRollingTipsItemView(e,this.mEndCallback)}addRollingTipsItemView(t,e){this.tipItemView=new Hh(t,e),this.tipItemView.style={position:"absolute",top:36,left:0,alignSelf:"center",width:143,height:24},this.appendChild(this.tipItemView),this.tipItemView.startRollAnimation()}}class Hh extends TKView{constructor(t,e){super(),this.mTradeInfo=t,this.mOnRollEnd=e,this.setupViews()}setupViews(){this.style={flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:"#00000080",borderColor:"#FFFFFF33",height:24,paddingHorizontal:4,borderWidth:1,borderRadius:4,opacity:0};let t=new TKImage;t.style={width:16,height:16,borderRadius:8,marginRight:4},t.setSrc(this.mTradeInfo.buyerImage),this.appendChild(t);let e=new TKText;e.style={fontSize:12,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",color:"#FFFFFF"},e.setText(this.mTradeInfo.tradeMessage),this.appendChild(e)}startRollAnimation(){let t=1600,e=new TKKeyframeAnimation;e.duration=t;let i=this;e.on("end",(()=>{this.mOnRollEnd&&this.mOnRollEnd(i)})),e.setAnimations([()=>(this.style={opacity:0,transform:{translate:{y:0}}},0),()=>(this.style={opacity:1,transform:{translate:{y:-10}}},.1875),()=>(this.style={opacity:1},.8125),()=>(this.style={opacity:0,transform:{scale:.9,translate:{y:-30}}},1)]),this.addAnimation(e,"rollAnimation")}}class Wh extends uh{constructor(t){super(t),this.bottomBgColor="90,#000000D0,#00000000",this.setupSubviews(),this.addActions()}setupSubviews(){this.style={width:"100%",height:224,position:"absolute",bottom:0};let t=new TKView;t.style={width:"100%",height:"100%",gradientBgColor:this.bottomBgColor,position:"absolute",bottom:0},this.appendChild(t);let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",position:"absolute",paddingBottom:16,paddingLeft:16,paddingRight:16,bottom:0},this.appendChild(e),this.rolllingTipsView=new Nh(this.vm.deepVideoModel.getDeepVideoOrderList()),this.rolllingTipsView.style={flexBasis:160,height:60,flexShrink:1,flexGrow:1},e.appendChild(this.rolllingTipsView);let i=new TKView;i.style={width:"100%",height:20,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},e.appendChild(i),this.nameLabel=new TKText,this.nameLabel.style={fontSize:15,color:"#FEFFFE"},this.nameLabel.setText("@"+this.vm.deepVideoModel.getDeepVideoAuthorName()),i.appendChild(this.nameLabel),this.logoView=new Ri(0,this.vm.adInfo),this.logoView.style={marginLeft:10},i.appendChild(this.logoView),this.descLabel=new TKText,this.descLabel.style={marginTop:5,fontSize:14,color:"#FEFFFE",textLineClamp:2,textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel)}addActions(){let e=this.vm.deepVideoModel.getDeepVideCardStyle(),i=new S;i.merchant_play_card_style=e,this.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_OTHERAREA_CLICK,i)})),this.nameLabel.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK,i)})),this.descLabel.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK,i)})),this.rolllingTipsView.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_TROLLEY_ICON_CLICK,i)})),this.vm.supportSlideClick()&&(jt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.descLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.rolllingTipsView,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}}class zh extends uh{constructor(t){super(t),this.isAnimation=!1,this.setupSubviews(),this.refreshDatas(),this.addActions()}setupSubviews(){this.style={width:"100%",height:312,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",position:"absolute",paddingLeft:16,paddingRight:16,paddingBottom:16,bottom:0};let t=new TKView;t.style={width:120,height:120,marginTop:32,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(t),this.goodsImage=new TKImage,this.goodsImage.style={width:120,height:120,backgroundColor:"#FF0000",borderRadius:8},t.appendChild(this.goodsImage),this.goodsLabel=new TKText,this.goodsLabel.style={width:84,height:21,fontSize:12,textAlign:"center",color:"#FFFFFF",backgroundColor:"#00000080",position:"absolute",top:1,left:1,topLeftRadius:8,bottomRightRadius:8},t.appendChild(this.goodsLabel),this.goodsTitle=new TKText,this.goodsTitle.style={marginTop:16,fontSize:16,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},this.appendChild(this.goodsTitle),this.appendActionBarView(),this.logoView=new Ri(0,this.vm.adInfo),this.logoView.style={position:"absolute",bottom:16,left:12},this.appendChild(this.logoView)}appendActionBarView(){this.actionBarContainer=new TKView,this.actionBarContainer.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.actionBarContainer),this.vm.deepVideoModel.isDeepVideoShowLowPrice()?this.appendDoubleActionBarView():(this.actionBarView=new TKView,this.actionBarView.style={height:48,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.actionBarContainer.appendChild(this.actionBarView),this.rightActionBar=new TKView,this.rightActionBar.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.actionBarView.appendChild(this.rightActionBar),this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText))}appendDoubleActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={marginTop:16,height:48,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row"},this.actionBarContainer.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"58%",height:48,backgroundColor:"#FFE5EBFF",flexDirection:"row",alignItems:"center",topLeftRadius:24,bottomLeftRadius:24,justifyContent:"center"};let t=new TKText;t.style={fontSize:16,color:"#FE3666",fontWeight:"medium"},t.setText("抢购价￥"),this.leftActionBar.appendChild(t),this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:28,color:"#FE3666",fontWeight:"medium",marginBottom:5},this.leftActionBar.appendChild(this.leftActionBarText);let e=new TKImage;e.style={width:"9%",height:48},ke(e,"direct_ec_sep.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"33%",height:48,topRightRadius:24,bottomRightRadius:24,paddingRight:25,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(e),this.actionBarView.appendChild(this.rightActionBar)}refreshDatas(){this.goodsLabel.setText(this.vm.deepVideoModel.getDeepVideoGoodsIconlabel()),this.goodsImage.setSrc(this.vm.deepVideoModel.getDeepVideoGoodsIcon()),this.goodsTitle.setText(this.vm.deepVideoModel.getDeepVideoGoodsTitle()),this.leftActionBarText&&this.leftActionBarText.setText(this.vm.deepVideoModel.getDeepVideoPrice()),this.rightActionBarText.setText(this.vm.deepVideoModel.getActionBarDesc())}addActions(){let e=new S;e.merchant_play_card_style=1,this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.goodsImage.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.goodsLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.goodsTitle.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.rightActionBar.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&(jt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsImage,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsTitle,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}showActionBarAnim(){this.isAnimation||(this.isAnimation=!0,Wi(1e3,this.actionBarView,(()=>{this.isAnimation=!1})))}}class Uh extends uh{constructor(t){super(t),this.isAnimation=!1,this.setupSubviews(),this.refreshDatas(),this.addActions()}setupSubviews(){this.style={width:"100%",height:308,flexDirection:"column",justifyContent:"flex-start",alignItems:"center",position:"absolute",paddingLeft:16,paddingRight:16,paddingBottom:16,bottom:0};let t=new TKView;t.style={width:120,height:120,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(t),this.goodsImage=new TKImage,this.goodsImage.style={width:120,height:120,borderWidth:1,borderColor:"#FFFFFF",borderRadius:8},t.appendChild(this.goodsImage),this.goodsLabel=new TKText,this.goodsLabel.style={width:84,height:21,fontSize:12,color:"#FFFFFF",backgroundColor:"#00000080",position:"absolute",textAlign:"center",top:1,left:1,topLeftRadius:8,bottomRightRadius:8},t.appendChild(this.goodsLabel),this.goodsTitle=new TKText,this.goodsTitle.style={marginTop:16,fontSize:16,color:"#FFFFFF",textLineClamp:2,textOverflow:"ellipsis"},this.appendChild(this.goodsTitle),this.appendActionBarView(),this.logoView=new Ri(0,this.vm.adInfo),this.logoView.style={position:"absolute",bottom:16,left:12},this.appendChild(this.logoView)}appendActionBarView(){this.actionBarContainer=new TKView,this.actionBarContainer.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.actionBarContainer),this.vm.deepVideoModel.isDeepVideoShowLowPrice()?this.appendDoubleActionBarView():(this.actionBarView=new TKView,this.actionBarView.style={height:80,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.actionBarContainer.appendChild(this.actionBarView),this.rightActionBar=new TKView,this.rightActionBar.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.actionBarView.appendChild(this.rightActionBar),this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText))}appendDoubleActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={marginTop:16,height:48,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row"},this.actionBarContainer.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"58%",height:48,backgroundColor:"#FFFFFF32",flexDirection:"row",alignItems:"center",topLeftRadius:24,bottomLeftRadius:24,justifyContent:"center"};let t=new TKText;t.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},t.setText("抢购价￥"),this.leftActionBar.appendChild(t),this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:28,color:"#FFFFFF",fontWeight:"medium",marginBottom:5},this.leftActionBar.appendChild(this.leftActionBarText);let e=new TKImage;e.style={width:"9%",height:48,marginLeft:.5},ke(e,"deepvide_style3_sep.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"33%",height:48,topRightRadius:24,bottomRightRadius:24,paddingRight:25,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(e),this.actionBarView.appendChild(this.rightActionBar)}refreshDatas(){this.goodsLabel.setText(this.vm.deepVideoModel.getDeepVideoGoodsIconlabel()),this.goodsImage.setSrc(this.vm.deepVideoModel.getDeepVideoGoodsIcon()),this.goodsTitle.setText(this.vm.deepVideoModel.getDeepVideoGoodsTitle()),this.leftActionBarText&&this.leftActionBarText.setText(this.vm.deepVideoModel.getDeepVideoPrice()),this.rightActionBarText.setText(this.vm.deepVideoModel.getActionBarDesc())}addActions(){let e=new S;e.merchant_play_card_style=2,this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.goodsImage.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.goodsLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.goodsTitle.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.rightActionBar.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&(jt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsImage,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsTitle,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}showActionBarAnim(){this.isAnimation||(this.isAnimation=!0,Wi(1e3,this.actionBarView,(()=>{this.isAnimation=!1})))}}class Gh extends uh{constructor(t){super(t),this.isAnimation=!1,this.setupSubviews(),this.refreshDatas(),this.addActions()}setupSubviews(){this.style={width:"100%",height:224,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",position:"absolute",paddingLeft:40,paddingRight:40,paddingBottom:16,bottom:0};let t=new TKView;t.style={marginTop:12,width:"100%",height:50,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.appendChild(t),this.goodsImage=new TKImage,this.goodsImage.style={width:50,height:50,borderWidth:1,borderColor:"#FFFFFF",borderRadius:8},t.appendChild(this.goodsImage),this.goodsTitle=new TKText,this.goodsTitle.style={marginLeft:8,fontSize:24,color:"#FFFFFF",flexShrink:1,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.goodsTitle),this.goodsDesc=new TKText,this.goodsDesc.style={marginTop:8,fontSize:14,color:"#FFFFFF",textAlign:"left",textLineClamp:2,textOverflow:"ellipsis"},this.appendChild(this.goodsDesc),this.appendActionBarView(),this.logoView=new Ri(0,this.vm.adInfo),this.logoView.style={position:"absolute",bottom:16,left:12},this.appendChild(this.logoView)}appendActionBarView(){this.actionBarContainer=new TKView,this.actionBarContainer.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.actionBarContainer),this.vm.deepVideoModel.isDeepVideoShowLowPrice()?this.appendDoubleActionBarView():(this.actionBarView=new TKView,this.actionBarView.style={height:80,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.actionBarContainer.appendChild(this.actionBarView),this.rightActionBar=new TKView,this.rightActionBar.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.actionBarView.appendChild(this.rightActionBar),this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText))}appendDoubleActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={marginTop:16,height:48,width:"100%",flexDirection:"row"},this.actionBarContainer.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"58%",height:48,backgroundColor:"#FFFFFF32",flexDirection:"row",alignItems:"center",topLeftRadius:24,bottomLeftRadius:24,justifyContent:"center"};let t=new TKText;t.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},t.setText("抢购价￥"),this.leftActionBar.appendChild(t),this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:28,color:"#FFFFFF",fontWeight:"medium",marginBottom:5},this.leftActionBar.appendChild(this.leftActionBarText);let e=new TKImage;e.style={width:"9%",height:48},ke(e,"deepvide_style3_sep.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"33%",height:48,topRightRadius:24,bottomRightRadius:24,paddingRight:25,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(e),this.actionBarView.appendChild(this.rightActionBar)}refreshDatas(){this.goodsImage.setSrc(this.vm.deepVideoModel.getDeepVideoGoodsIcon()),this.goodsTitle.setText(this.vm.deepVideoModel.getDeepVideoGoodsTitle()),this.goodsDesc.setText(this.vm.getAdDescription()),this.leftActionBarText&&this.leftActionBarText.setText(this.vm.deepVideoModel.getDeepVideoPrice()),this.rightActionBarText.setText(this.vm.deepVideoModel.getActionBarDesc())}addActions(){let e=new S;e.merchant_play_card_style=3,this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.goodsImage.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.goodsDesc.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.goodsTitle.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.rightActionBar.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&(jt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsImage,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsDesc,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.goodsTitle,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}showActionBarAnim(){this.isAnimation||(this.isAnimation=!0,Wi(1e3,this.actionBarView,(()=>{this.isAnimation=!1})))}}class jh extends uh{constructor(t){super(t),this.deepVideoStyle=1,this.deepVideoStyle=this.vm.deepVideoModel.getDeepVideCardStyle(),this.setupSubviews(),this.reportCardImpression()}setupSubviews(){this.style={width:"100%",height:this.getHeight(),flexDirection:"column",justifyContent:"flex-end",position:"relative",flexWrap:"no-wrap"},this.baseView=new Wh(this.vm),this.appendChild(this.baseView),this.vm.deepVideoModel.getActionBarDesc(),3==this.deepVideoStyle?this.styleView=new Gh(this.vm):2==this.deepVideoStyle?this.styleView=new Uh(this.vm):this.styleView=new zh(this.vm),this.styleView.style={opacity:0,visibility:"hidden"},this.appendChild(this.styleView)}reportCardImpression(){let t=new S;t.merchant_play_card_style=this.deepVideoStyle;let e={clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}getHeight(){return 3==this.deepVideoStyle?224:2==this.deepVideoStyle?308:312}getVideoHeight(){return 3==this.deepVideoStyle?244:2==this.deepVideoStyle?268:332}getVideoTop(){return 3==this.deepVideoStyle||2==this.deepVideoStyle?60:0}getVideoRadius(){return 3==this.deepVideoStyle||2==this.deepVideoStyle?8:0}transfromBottomBar(){this.styleView.style={visibility:"visible"};let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.baseView.style={opacity:1},0),()=>(this.baseView.style={opacity:0},1)]),t.duration=300,t.timingFunction="EaseInEaseOut",t.on("end",(t=>{this.baseView.style={visibility:"hidden"},2==this.deepVideoStyle?setTimeout((()=>{this.showGoodsInfoView()}),200):this.showGoodsInfoView()})),this.baseView.addAnimation(t,"baseViewAnim")}showGoodsInfoView(){let t=new TKKeyframeAnimation;if(t.setAnimations([()=>(this.styleView.style={opacity:0},0),()=>(this.styleView.style={opacity:1},1)]),t.duration=300,t.timingFunction="EaseInEaseOut",this.styleView.addAnimation(t,"styleViewAnim"),3!=this.deepVideoStyle){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.styleView.style={top:100},0),()=>(this.styleView.style={top:0},1)]),t.duration=300,t.timingFunction="EaseInEaseOut",this.styleView.addAnimation(t,"styleMoveAnim")}}showActionBarAnim(){this.styleView&&this.styleView.showActionBarAnim()}}class Yh extends uh{constructor(t){super(t),this.spikeTimeBgColor="315,#FF8000,#FF0A43",this.spikeTimeStyle={height:"16",width:"16",gradientBgColor:this.spikeTimeBgColor,color:"#FFFFFF",textAlign:"center",borderRadius:2,fontSize:12,includeFontPadding:!1,textLineClamp:1},this.spikeTimer=0,this.isPortrait=0==this.vm.screenOrientation,this.realCardHeight=this.vm.getECOrderData().hasSpike?216:219,this.isPortrait||(this.realCardHeight=this.realCardHeight-24),this.style={height:this.getHeight(),width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:this.isPortrait?"column":"row-reverse",justifyContent:this.isPortrait?"flex-start":"space-between",paddingLeft:16,paddingRight:16},this.appendChild(this.createKsAdLogoView(this.vm.adInfo));let e=this.isPortrait?"100%":375;this.card=new TKView,this.card.style={width:e,height:175,marginTop:8,flexDirection:"column",backgroundColor:"#FFFFFF",borderRadius:12},this.vm.getECOrderData().hasSpike?this.card.appendChild(this.createSpikeHeaderView(this.vm.getECOrderData())):(this.card.appendChild(this.createNormalHeaderBgView()),this.card.appendChild(this.createNormalHeaderView(this.vm.getECOrderData()))),this.card.appendChild(this.createBodyView(this.vm.getECOrderData())),this.card.appendChild(this.createFooterView(this.vm.getECOrderData())),this.appendChild(this.card)}createKsAdLogoView(t){this.ksadLogoView=new Ri(1,t),this.ksadLogoView.style={height:16,marginBottom:this.isPortrait?0:20};let e=new TKView;return e.appendChild(this.ksadLogoView),e.style={height:this.isPortrait?16:"100%",width:this.isPortrait?"100%":"25%",marginRight:16,alignItems:"flex-end",flexDirection:"column-reverse"},e}createNormalHeaderView(e){this.header=new TKView,this.header.style={flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",paddingLeft:12,height:30};let i=new TKView;return i.style={height:"16",marginTop:11,flexDirection:"row",alignItems:"center",paddingRight:6},this.couponIcon=new TKImage,this.couponIcon.style={width:14,height:e.hasCounpon?11:14.5,marginRight:5},ke(this.couponIcon,e.getHeaderIcon()),i.appendChild(this.couponIcon),this.couponTips=new TKText,this.couponTips.setText(e.getHeaderTips()),this.couponTips.style={color:"#FF5000",fontSize:12},i.appendChild(this.couponTips),this.header.appendChild(i),this.kwaiLogoView=new TKImage,this.kwaiLogoView.style={width:20,height:20},ke(this.kwaiLogoView,"icon_ksad_kwai_logo.png"),this.header.appendChild(this.kwaiLogoView),this.addClickConvert(this.header,2,t.CARD_OTHERAREA_CLICK),this.header}createNormalHeaderBgView(){let t=new TKImage;return ke(t,"icon_ksad_ec_order_coupon_header_bg.png"),t.style={position:"absolute",left:0,right:0,top:0,height:90,width:"100%"},t}createSpikeHeaderView(e){this.header=new TKView,this.header.style={flexDirection:"row",justifyContent:"space-between",paddingLeft:12,height:26};let i=new TKImage;ke(i,"icon_ksad_ec_order_header_bg.png"),i.style={position:"absolute",height:"100%",left:0,right:0,top:0,topLeftRadius:12,topRightRadius:12},this.header.appendChild(i);let n=new TKView;n.style={height:"100%",paddingBottom:2,paddingTop:2,flexDirection:"row",alignItems:"center",paddingRight:6},this.spikeIcon=new TKImage,this.spikeIcon.style={width:61,height:12},ke(this.spikeIcon,"icon_ksad_spike.png"),n.appendChild(this.spikeIcon);let s=new TKView;s.style={width:.5,height:11,backgroundColor:"#FF500080",marginLeft:5,marginRight:5},n.appendChild(s);let a=new TKText;return a.setText("距结束"),a.style={color:"#FF5000",fontSize:12,marginRight:2},n.appendChild(a),this.spikeHourText=new TKText,this.spikeHourText.style=this.spikeTimeStyle,n.appendChild(this.spikeHourText),n.appendChild(this.createTimeDivider()),this.spikeMinuteText=new TKText,this.spikeMinuteText.style=this.spikeTimeStyle,n.appendChild(this.spikeMinuteText),n.appendChild(this.createTimeDivider()),this.spikeSecondText=new TKText,this.spikeSecondText.style=this.spikeTimeStyle,n.appendChild(this.spikeSecondText),0!=this.spikeTimer&&clearInterval(this.spikeTimer),this.spikeTimer=setInterval((()=>{let t=e.getSpikeTime();this.spikeHourText.setText(t.getFormattedHour()),this.spikeMinuteText.setText(t.getFormattedMinute()),this.spikeSecondText.setText(t.getFormattedSecond())}),1e3),this.header.appendChild(n),this.kwaiLogoView=new TKImage,this.kwaiLogoView.style={width:20,height:20},ke(this.kwaiLogoView,"icon_ksad_kwai_logo.png"),this.header.appendChild(this.kwaiLogoView),this.addClickConvert(this.header,2,t.CARD_OTHERAREA_CLICK),this.header}createBodyView(e){this.bodyView=new TKView,this.bodyView.style={height:64,width:"100%",paddingLeft:12,paddingRight:12,marginTop:6,flexDirection:"row"},this.productIcon=new TKImage,this.productIcon.style={width:64,height:64,borderRadius:4,marginRight:8},this.bodyView.appendChild(this.productIcon),this.productIcon.setSrc(e.icon);let i=new TKView;i.style={height:"100%",flexShrink:1,flexDirection:"column"},this.adNameText=new TKText,this.adNameText.style={color:"#222222",fontSize:15,textLineClamp:1,textOverflow:"ellipsis"},this.adNameText.setText(e.name),i.appendChild(this.adNameText),this.adDescText=new TKText,this.adDescText.style={color:"#9C9C9C",fontSize:12,marginTop:4,textLineClamp:1,textOverflow:"ellipsis"},this.adDescText.setText(e.getAdDesc()),i.appendChild(this.adDescText),this.priceContainer=new TKView,this.priceContainer.style={flexDirection:"row",alignItems:"flex-end",height:24},this.pricePrefix=new TKText,this.pricePrefix.setText(e.getPricePrefix()),this.pricePrefix.style={fontSize:12,color:"#FE3666",marginRight:4,textAlign:"center"},this.priceContainer.appendChild(this.pricePrefix);let n=new TKText;n.setText("¥"),n.style={fontSize:14,color:"#FE3666",marginRight:2,textAlign:"center"},this.priceContainer.appendChild(n),this.priceCurrent=new TKText,this.priceCurrent.setText(e.price),this.priceCurrent.style={fontSize:20,color:"#FE3666",marginRight:6,textAlign:"center"},this.priceContainer.appendChild(this.priceCurrent);let s=e.originalPrice;return be(s)||(this.priceOriginal=new TKText,this.priceOriginal.setText("¥"+s),this.priceOriginal.style={fontSize:13,color:"#C6C6C6",textDecoration:"line-through",textAlign:"center"},this.priceContainer.appendChild(this.priceOriginal)),i.appendChild(this.priceContainer),this.bodyView.appendChild(i),this.addClickConvert(this.bodyView,2,t.CARD_OTHERAREA_CLICK),this.bodyView}createFooterView(e){let i=new TKView;return i.style={paddingLeft:18,paddingRight:18},this.btnClick=new TKButton,this.btnClick.setText(e.btnClickText),this.btnClick.style={height:48,width:"100%",marginTop:15,fontSize:15,color:"#FFFFFF",backgroundColor:"#FE3666",borderRadius:30},this.addClickConvert(this.btnClick,1,t.CARD_ACTION_BAR_CLICK),i.appendChild(this.btnClick),i}getHeight(){return this.realCardHeight}createTimeDivider(){let t=new TKText;return t.setText(":"),t.style={fontSize:12,height:16,textAlign:"center",color:"#FF5000",marginLeft:2,marginRight:2,includeFontPadding:!1},t}addClickConvert(t,e,i){t.addEventListener("tap",(n=>{let s={template_show_type:this.vm.getECOrderData().getCardStyleLog()};const a=Te(n,t);this.vm.convert(1,e,a,i,s)}))}}class Xh extends uh{constructor(t){super(t),this.logoAreaHeight=20,this.cardMargin=12,this.cardMarginLandscape=16,this.smallCardHeight=78,this.bigCardHeight=142,this.horizontalCardWidth=351,this.mBtnAnimaCanceled=!1,this.isPortrait=0==this.vm.screenOrientation;let e=this.getHeight();this.isPortrait?this.style={height:e,width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"space-between",paddingLeft:this.cardMargin,paddingRight:this.cardMargin,paddingBottom:this.cardMargin}:this.style={height:e,width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"row-reverse",justifyContent:"space-between",paddingLeft:this.cardMarginLandscape,paddingRight:this.cardMarginLandscape,paddingBottom:this.cardMarginLandscape},Di(this.vm,this.vm.$attrsPath.hasExtraReward,(t=>{t&&this.switchToBigCard()})),this.isPortrait||this.appendChild(this.createKsAdLogoView(this.vm.adInfo)),this.mCardView=this.createExtraCard(this.vm.getNormalModel()),this.appendChild(this.mCardView)}createExtraCard(t){let e=new TKView;return e.style={height:"100%",width:this.isPortrait?"100%":this.horizontalCardWidth},this.mSmallCardView=this.createExtraSmallCard(t),e.appendChild(this.mSmallCardView),this.mBigCardView=this.createExtraBigCard(t),e}switchToBigCard(){this.mCardView.appendChild(this.mBigCardView),this.layout();let t=new TKBasicAnimation;t.setEndValue((()=>{this.mSmallCardView.style={transform:{translate:{y:25}},opacity:0}})),t.duration=500,t.timingFunction="EaseInEaseOut";let e=new TKBasicAnimation;e.setEndValue((()=>{this.mBigCardView.style={transform:{translate:{y:-25}},opacity:1}})),e.duration=500,e.timingFunction="EaseInEaseOut",this.mSmallCardView.addAnimation(t,"smallTransform"),this.mBigCardView.addAnimation(e,"bigTransform");let i=new TKBasicAnimation;i.setEndValue((()=>{this.mSweepView.style={transform:{translate:{x:400}}}})),i.duration=1e3,i.timingFunction="Linear",i.on("end",(()=>{this.mHandDownView.style={opacity:1},this.startBigCardBtnAnim()})),setTimeout((()=>{this.mSweepView.addAnimation(i,"sweep")}),700)}switchToSmall(){let t=new TKBasicAnimation;t.setEndValue((()=>{this.mSmallCardView.style={transform:{translate:{y:0}},opacity:1}})),t.duration=500,t.timingFunction="EaseInEaseOut";let e=new TKBasicAnimation;e.setEndValue((()=>{this.mBigCardView.style={transform:{translate:{y:0}},opacity:0}})),e.duration=500,e.timingFunction="EaseInEaseOut",this.mSmallCardView.addAnimation(t,"smallTransformVisible"),this.mBigCardView.addAnimation(e,"bigTransformGone"),e.on("end",(()=>{this.mCardView.removeChild(this.mBigCardView)}))}startBigCardBtnAnim(){if(this.mBtnAnimaCanceled)return;let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.mExtraBtn.style={transform:{scale:1}},0),()=>(this.mExtraBtn.style={transform:{scale:1}},.5),()=>(this.mExtraBtn.style={transform:{scale:.9}},.75),()=>(this.mExtraBtn.style={transform:{scale:1}},1)]),t.duration=400,t.on("end",(()=>{this.startBigCardBtnAnim()}));let e=new TKKeyframeAnimation;e.duration=400,e.setAnimations([()=>(this.mHandDownView.style={transform:{translate:{y:0}}},0),()=>(this.mHandDownView.style={transform:{translate:{y:10}}},.5),()=>(this.mHandDownView.style={transform:{translate:{y:0}}},1)]),this.mExtraBtn.addAnimation(t,"scale"),this.mHandDownView.addAnimation(e,"handTrans")}stopActionAnimation(){this.mBtnAnimaCanceled=!0,this.mSweepView&&this.mSweepView.removeAllAnimation(),this.mExtraBtn&&this.mExtraBtn.removeAllAnimation()}createExtraBigCard(e){let i=new TKView;i.nativeID="bigCard",i.style={width:"100%",flexDirection:"column",justifyContent:"space-around",padding:12,height:this.bigCardHeight,backgroundColor:"#FFFFFF",borderRadius:8},i.appendChild(this.createContentView(e,!0)),this.addClickConvert(i,2,t.CARD_BLANK_AREA_CLICK,!0);let n=new TKView;n.style={width:"100%",height:48},n.nativeID="btnContainer",this.addClickConvert(n,1,t.CARD_ACTION_BAR_CLICK,!0),this.mExtraBtn=new TKText,this.mExtraBtn.style={position:"absolute",textAlign:"center",left:0,right:0,width:"100%",height:48,backgroundColor:"#FE3666",borderRadius:24,fontSize:16,color:"#FFFFFF"},this.mExtraBtn.enabled=!1,this.mExtraBtn.setText(e.extraActionText),this.mSweepView=new TKImage,this.mSweepView.style={height:48,width:34,position:"absolute",left:-34},ke(this.mSweepView,"icon_ksad_extra_reward_sweep.png"),n.appendChild(this.mExtraBtn),n.appendChild(this.mSweepView),i.appendChild(n),this.mHandDownView=new TKImage,this.mHandDownView.style={height:75,width:69,position:"absolute",top:32,right:15,opacity:0},ke(this.mHandDownView,"icon_ksad_hand_down.png"),i.appendChild(this.mHandDownView);let s=new TKView;return s.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"space-between",bottom:-25,left:0,right:0,opacity:0,position:"absolute"},this.isPortrait&&s.appendChild(this.createKsAdLogoView(this.vm.adInfo)),s.appendChild(i),this.addClickConvert(i,2,t.CARD_BLANK_AREA_CLICK,!0),s}createExtraSmallCard(e){let i=new TKView;i.style={width:"100%",height:this.smallCardHeight,backgroundColor:"#FFFFFF",borderRadius:8,padding:10,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},i.nativeID="smallCard",i.appendChild(this.createContentView(e,!1)),this.addClickConvert(i,2,t.CARD_BLANK_AREA_CLICK,!1);let n=new TKButton;n.style={height:36,paddingHorizontal:18,backgroundColor:"#FE3666",borderRadius:18,fontSize:14,textAlign:"center",color:"#FFFFFF"},n.setText(e.actionText),n.nativeID="btnOpen",this.addClickConvert(n,1,t.CARD_ACTION_BAR_CLICK,!1),i.appendChild(n);let s=new TKView;return s.style={height:this.isPortrait?this.smallCardHeight+this.logoAreaHeight:this.smallCardHeight,width:"100%",flexDirection:"column",justifyContent:"space-between",bottom:0,left:0,right:0,position:"absolute"},this.isPortrait&&s.appendChild(this.createKsAdLogoView(this.vm.adInfo)),s.appendChild(i),s}createKsAdLogoView(t){return this.ksadLogoView=new Ri(1,t),this.ksadLogoView.style={height:14,alignSelf:"flex-end"},this.ksadLogoView}createContentView(e,i){let n=new TKView;n.style={height:58,flexDirection:"row"};let s=new TKImage;s.style={height:58,width:58,borderRadius:12},s.nativeID="iconView:"+i,this.addClickConvert(s,2,t.CARD_ICON_CLICK,i),n.appendChild(s);let a=new TKView;a.style={height:58,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",marginLeft:12,paddingTop:3,paddingBottom:3,maxWidth:169};let o=new TKText;o.style={fontSize:17,fontWeight:"medium",color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},o.nativeID="nameView:"+i;let r=new TKText;return r.style={fontSize:14,color:"#666666",textLineClamp:1,textOverflow:"ellipsis"},r.nativeID="descView:"+i,this.addClickConvert(o,2,t.CARD_ICON_NAME_CLICK,i),this.addClickConvert(r,2,t.CARD_ICON_COMMENT_CLICK,i),a.appendChild(o),a.appendChild(r),n.appendChild(a),s.setSrc(e.iconUrl),o.setText(e.name),r.setText(e.desc),n}addClickConvert(t,n,s,a){t.addEventListener("tap",(o=>{let r=null,h=wt(this.vm.adInfo,n);if(console.log("CurrentExtraRewardHolder addClickConvert shouldConvert: "+h+", isExtraReward: "+a+", viewID: "+t.nativeID),a&&h){let t={extraRewardType:e.adClickReward,extraRewardStatus:i.isRewarded};Ne.updateExtraReward(t),setTimeout((()=>{this.stopActionAnimation(),this.mExtraBtn.setText(this.vm.getNormalModel().extraActionTextClicked),this.mHandDownView.style={opacity:0}}),500),r={businessSceneType:22},setTimeout((()=>{this.switchToSmall()}),300)}this.vm.convert(1,n,o.position,s,null,r)}))}getHeight(){return this.isPortrait?this.bigCardHeight+this.cardMargin+this.logoAreaHeight:this.bigCardHeight+this.cardMarginLandscape}}class Jh extends uh{constructor(t,e){super(t),this.spikeTimer=0,this.limitWidth=e,this.setupViews(),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"showEnd":case"pageVisiable":this.startCountDown();break;case"hideEnd":case"pageInvisiable":this.stopCountDown()}}))}createSpikeView(){const t=new TKView;if(t.style={width:"100%",height:30,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",position:"absolute",top:0,left:0},this.spikeIcon=new TKImage,this.spikeIcon.style={width:74,height:14,marginLeft:8,marginRight:7},ke(this.spikeIcon,"direct_ec_spike.png"),t.appendChild(this.spikeIcon),this.vm.directEcCardModel.hasSpike){const e={height:16,borderRadius:2,backgroundColor:"#FFFFFF4C",color:"#FFFFFFFF",fontSize:11,fontWeight:"bold",textAlign:"center"},i={fontSize:12,fontWeight:"bold",marginLeft:2,marginRight:2,color:"#FFFFFF"};let n=this.vm.directEcCardModel.getSpikeTime();this.spikeHourText=new TKText,this.spikeHourText.style=e,this.spikeHourText.setText(n.getFormattedHour()),t.appendChild(this.spikeHourText);const s=new TKText;s.style=i,s.setText(":"),t.appendChild(s),this.spikeMinuteText=new TKText,this.spikeMinuteText.style=e,this.spikeMinuteText.setText(n.getFormattedMinute()),t.appendChild(this.spikeMinuteText);const a=new TKText;a.style=i,a.setText(":"),t.appendChild(a),this.spikeSecondText=new TKText,this.spikeSecondText.style=e,this.spikeSecondText.setText(n.getFormattedSecond()),t.appendChild(this.spikeSecondText)}return this.headerSoldText=new TKText,this.headerSoldText.style={textAlign:"right",flexGrow:1,fontSize:12,color:"#FFFFFF"},t.appendChild(this.headerSoldText),t}startCountDown(){if(!this.vm.directEcCardModel.hasSpike||!this.showSpike)return;this.stopCountDown();const t=()=>{let t=this.vm.directEcCardModel.getSpikeTime();this.spikeHourText.setText(t.getFormattedHour()),this.spikeMinuteText.setText(t.getFormattedMinute()),this.spikeSecondText.setText(t.getFormattedSecond())};this.spikeTimer=setInterval(t,1e3),t()}stopCountDown(){this.vm.directEcCardModel.hasSpike&&this.showSpike&&0!=this.spikeTimer&&(clearInterval(this.spikeTimer),this.spikeTimer=0)}updatePriceAndSold(){this.headerSoldText?(Ie(this.vm.directEcCardModel.volume)&&Li(this.headerSoldText,"text",this.vm.$attrsPath.directEcCardModel.volume),Ie(this.vm.directEcCardModel.rating)&&Li(this.soldText,"text",this.vm.$attrsPath.directEcCardModel.rating)):Ie(this.vm.directEcCardModel.volumeAndRating)&&Li(this.soldText,"text",this.vm.$attrsPath.directEcCardModel.volumeAndRating);const t=this.vm.directEcCardModel.price,e=t.toString().split("."),i="￥"+t;let n="";e.length>=1&&(n=e[0]);let s=new TKSpan;const a=new TKSpanItem;a.spanType="absoluteSize",a.size=12,a.start=0,a.end=1,s.addSpan(a);const o=new TKSpanItem;o.spanType="absoluteSize",o.size=16,o.start=1,o.end=1+n.length,s.addSpan(o);const r=new TKSpanItem;r.spanType="absoluteSize",r.size=12,r.start=1+n.length,r.end=i.length,s.addSpan(r),this.priceText.setSpan(i,s);const h=this.vm.directEcCardModel.originalPrice;if(Ie(h)){const t="￥"+h,e=new TKSpan,i=new TKSpanItem;i.spanType="strikeThrough",i.start=0,i.end=t.length,e.addSpan(i),this.originPriceText.setSpan(t,e)}}createPriceView(t){const e=new TKView;return e.style={flexDirection:"row",alignItems:t?"center":"flex-end",justifyContent:"flex-start",width:"100%"},this.priceText=new TKText,this.priceText.style={color:"#FE3666",fontWeight:"medium"},e.appendChild(this.priceText),this.originPriceText=new TKText,this.originPriceText.style={color:"#9C9C9C",fontSize:12,fontWeight:"normal",marginLeft:4,alignSelf:"center"},e.appendChild(this.originPriceText),e}setupViews(){this.vm.getDirectEcData(),this.cardDelayShowTime=3,this.vm.directEcCardModel.cardStyle=0,this.vm.directEcCardModel.hasSpike=!0,this.showSpike=2==this.vm.directEcCardModel.cardStyle;const e=1==this.vm.screenOrientation;switch(this.vm.directEcCardModel.cardStyle){case 1:this.cardHeight=103,this.growthHeight=48;break;case 2:this.cardHeight=134,this.growthHeight=50;break;default:this.cardHeight=105,this.growthHeight=50}this.totalHeight=1==this.vm.screenOrientation?this.cardHeight+this.growthHeight+12:this.cardHeight+this.growthHeight+12+16+8,this.style={width:"100%",height:this.totalHeight,flexDirection:"column",justifyContent:"flex-start",alignItems:e?"flex-end":"flex-start",position:"relative",paddingLeft:12,paddingRight:12,paddingBottom:12,flexWrap:"no-wrap"},this.logoView=new Ri(1,this.vm.adInfo);const i={right:12,position:"absolute"};e?i.bottom=16:i.top=this.growthHeight,this.logoView.style=i,this.appendChild(this.logoView),this.borderContainer=new TKView,this.borderContainer.style={width:e?351:"100%",height:this.cardHeight,bottom:12,left:12,flexDirection:"column",paddingLeft:this.showSpike?4:0,paddingRight:this.showSpike?4:0,paddingBottom:this.showSpike?5:0,borderRadius:11,position:"absolute"},this.showSpike&&(this.borderContainer.style={gradientBgColor:"315,#FF8000,#FF0A43"}),this.appendChild(this.borderContainer),this.vm.supportSlideClick()&&jt(this.borderContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.showSpike&&this.borderContainer.appendChild(this.createSpikeView()),this.infoContainer=new TKView,this.infoContainer.style={backgroundColor:"#FFFFFF",height:this.showSpike?this.cardHeight-35:this.cardHeight,width:"100%",top:this.showSpike?30:0,left:this.showSpike?4:0,right:this.showSpike?4:0,padding:8,borderRadius:8,flexDirection:"column",justifyContent:"space-between",position:"absolute",alignItems:"flex-start"},this.borderContainer.appendChild(this.infoContainer);const n=new TKView;if(n.style={flexDirection:"row",width:"100%",height:85,position:"relative"},this.infoContainer.appendChild(n),this.productIcon=new TKImage,this.productIcon.style={width:85,height:85,position:"absolute",top:0,left:0,borderRadius:6,marginRight:8},this.productIcon.setSrc(this.vm.getAdIcon()),n.appendChild(this.productIcon),this.vm.directEcCardModel.hasCounpon&&1!=this.vm.directEcCardModel.cardStyle){const t=new TKImage;t.style={width:43,height:17,bottom:3,left:3,position:"absolute"},n.appendChild(t),ke(t,"direct_ec_coupon_bg.png");const e=new TKText;e.style={width:17,height:17,fontSize:10,fontWeight:"medium",textAlign:"center",position:"absolute",left:3,bottom:3,color:"#FFFFFF"},e.setText("券"),n.appendChild(e);const i=new TKText;i.style={width:25,height:17,fontSize:10,fontWeight:"medium",textAlign:"center",position:"absolute",left:19,bottom:3,color:"#FFFFFF",minimumTextScaleFactor:.5},n.appendChild(i),Li(i,"text",this.vm.$attrsPath.directEcCardModel.couponTitle,"")}const s=new TKView;if(s.style={height:85,right:0,left:93,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",flexShrink:1,position:"absolute"},n.appendChild(s),this.nameLabel=new TKText,this.nameLabel.style={height:20,fontSize:16,fontWeight:"bold",color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},s.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:2,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),s.appendChild(this.descLabel),this.soldText=new TKText,this.soldText.style={fontSize:12,color:"#9C9C9C",flexGrow:1,textAlign:"right"},1!=this.vm.directEcCardModel.cardStyle){const t=this.createPriceView(!1);s.appendChild(t),t.appendChild(this.soldText)}else s.appendChild(this.soldText);if(this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={width:"100%",height:40,opacity:0,flexDirection:"row"},this.infoContainer.appendChild(this.bottomBtnContainer),1==this.vm.directEcCardModel.cardStyle){const e=24;this.leftActionBar=new TKView,this.leftActionBar.style={width:205/(331-e)*(this.limitWidth-e-44),height:38,backgroundColor:"#FFE5EBFF",topLeftRadius:19,bottomLeftRadius:19,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",paddingLeft:16};const i=this.createPriceView(!0);this.leftActionBar.appendChild(i),this.middleIcon=new TKImage,this.middleIcon.style={width:e,height:38,resize:"stretch",overflow:"hidden"},this.middleIcon.clipChildren=!0,ke(this.middleIcon,"direct_ec_sep.png"),this.rightActionBar=new TKButton,this.rightActionBar.style={width:(126-e)/(331-e)*(this.limitWidth-e-44),height:38,topRightRadius:18,bottomRightRadius:18,gradientBgColor:"158,#FF7E26FF,#FE3666FF",flexDirection:"row",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"bold",textAlign:"center",color:"#FFFFFF"},Li(this.rightActionBar,"text",this.vm.$attrsPath.actionText),this.bottomBtnContainer.appendChild(this.leftActionBar),this.bottomBtnContainer.appendChild(this.middleIcon),this.bottomBtnContainer.appendChild(this.rightActionBar),this.leftActionBar.addEventListener("tap",(e=>{const i=Te(e,this.leftActionBar);this.convert(1,i,t.ACTION_BAR_CLICK)})),this.rightActionBar.addEventListener("tap",(e=>{const i=Te(e,this.leftActionBar);this.convert(1,i,t.ACTION_BAR_CLICK)})),this.vm.supportSlideClick()&&(jt(this.leftActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}else this.actionBtn=new TKButton,this.actionBtn.style={fontSize:15,fontWeight:"bold",color:"#FFFFFF",backgroundColor:"#FE3666",borderRadius:22,height:"100%",width:"100%",textAlign:"center"},Li(this.actionBtn,"text",this.vm.$attrsPath.actionText),this.bottomBtnContainer.appendChild(this.actionBtn),this.actionBtn.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.ACTION_BAR_CLICK)})),this.vm.supportSlideClick()&&jt(this.actionBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)}));this.updatePriceAndSold(),this.startActionAnimation();const a=this;this.borderContainer.addEventListener("tap",(e=>{const i=Te(e,a);this.convert(2,i,t.ACTIONBAR_ICON_OTHER_AREA_CLICK)})),this.addEventListener("tap",(e=>{const i=Te(e,a);this.convert(2,i,t.ACTIONBAR_ICON_OTHER_AREA_CLICK)}))}startActionAnimation(){let t=this;setTimeout((()=>{t.animationAllowed=!0,t.animationAllowed&&t.addActionTranslateAnim()}),1e3*this.cardDelayShowTime)}addActionTranslateAnim(){this.updateHeight(this.borderContainer,this.cardHeight+this.growthHeight,"translate"),this.updateHeight(this.infoContainer,this.showSpike?this.cardHeight+this.growthHeight-35:this.cardHeight+this.growthHeight,"translate"),this.updateOpacity(this.bottomBtnContainer,1,"bottomBtnContainerOpacity"),0==this.vm.screenOrientation&&this.updateTop(this.logoView,0,"logoViewTop")}updateHeight(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={height:e}})),s.duration=n,t&&t.addAnimation(s,i)}updateOpacity(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={opacity:e}})),s.duration=n,t&&t.addAnimation(s,i)}updateTop(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={top:e}})),s.duration=n,t&&t.addAnimation(s,i)}stopActionAnimation(){this.animationAllowed=!1,this&&this.removeAllAnimation()}getHeight(){return this.totalHeight}}class $h extends uh{constructor(e){super(e),this.style={width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:0};const i=new TKView;i.style={backgroundColor:"#00000000",height:68,width:"100%",paddingLeft:12,paddingRight:12,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.appendChild(i);const n=new TKProgressBar;n.style={backgroundColor:"#FF9BB3",width:"100%",height:44,cornerRadius:22,indeterminate:!1};const s=new TKProgressBar;s.style={backgroundColor:"#FE3666",width:"100%",height:44,cornerRadius:22,position:"absolute",left:12,top:12};const a=new TKText;a.style={fontSize:16,fontWeight:"bold",color:"#FFFFFF",width:"100%",height:44,textAlign:"center",position:"absolute",top:12,left:12},i.appendChild(n),i.appendChild(s),i.appendChild(a),Li(a,"text",this.vm.$attrsPath.actionText),s.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),n.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),i.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}getHeight(){return 68}}class qh extends uh{constructor(e){super(e),this.style={width:Pe.isAndroid()?"100%":e.containerLimit.width,height:this.getHeight(),flexDirection:"row",justifyContent:"center",alignItems:"flex-end"},this.nativeID="KSAdLiveSubscribeBar",this.weakCard=this.createWeakCard(),this.addClickConvert(this.weakCard,1,t.CARD_ACTION_BAR_CLICK),this.appendChild(this.weakCard),this.ksadLogoView=new Ri(1,this.vm.adInfo,16),this.ksadLogoView.style={position:"absolute",bottom:16,right:16},this.appendChild(this.ksadLogoView),this.liveSubscribeCard=this.createBigCard(),this.appendChild(this.liveSubscribeCard),setTimeout((()=>{this.showAndHideWeakCard(this.weakCard,(()=>{this.showBigCard(this.liveSubscribeCard,this.ksadLogoView)}))}),500)}getHeight(){return 186}stopActionAnimation(){this.animateTimer&&clearInterval(this.animateTimer),this.liveLabelView.removeAllAnimation()}showBigCard(t,e){let i=new TKBasicAnimation;i.duration=500,i.timingFunction="EaseOut",i.setEndValue((()=>{t.style={transform:{translate:{y:-178}}}}));let n=new TKBasicAnimation;n.duration=500,n.timingFunction="EaseOut",n.setEndValue((()=>{e.style={transform:{translate:{y:-154}}}})),t.addAnimation(i,"showCard"),this.vm.isScreenPortrait()&&e.addAnimation(n,"logoUp"),this.animateTimer=setInterval((()=>{this.liveLabelView.startRotate()}),800)}showAndHideWeakCard(t,e){let i=new TKBasicAnimation;i.duration=500,i.timingFunction="EaseOut",i.setEndValue((()=>{t.style={transform:{translate:{y:-44}}}}));let n=new TKBasicAnimation;n.duration=500,n.timingFunction="EaseOut",n.setEndValue((()=>{t.style={transform:{translate:{y:0}}}})),i.on("end",(()=>{setTimeout((()=>{t.addAnimation(n,"end")}),2500)})),n.on("end",e),t.addAnimation(i,"show")}createWeakCard(){let t=new TKView;t.style={position:"absolute",left:16,bottom:-28,flexDirection:"row",width:193,height:28,backgroundColor:"#00000080",paddingHorizontal:8,borderRadius:4,justifyContent:"space-between",alignItems:"center"};let e=new TKText;e.style={color:"#FFFFFF",fontSize:8,height:12,width:22,textAlign:"center",backgroundColor:"#FE3666FF",borderRadius:2},e.setText("预告"),t.appendChild(e);let i=new TKText;i.style={color:"#FFFFFF",fontSize:12,textAlign:"center",width:97,textLineClamp:1,textOverflow:"ellipsis"},i.setText(this.vm.getLiveSubscribeModel().name),t.appendChild(i);let n=new TKView;n.style={width:1,height:12,backgroundColor:"#FFFFFF66",marginHorizontal:8},t.appendChild(n);let s=new TKText;return s.setText("感兴趣"),s.style={color:"#FFFFFF",fontSize:12,textAlign:"center"},t.appendChild(s),t}createBigCard(){let e=new TKView;e.style={height:146,flexDirection:"column",justifyContent:"space-between",position:"absolute",bottom:-162,paddingHorizontal:12,paddingBottom:12,paddingTop:6,left:16,right:16,backgroundColor:"#FFFFFF",borderRadius:12},this.vm.isScreenPortrait()||(e.style={width:343});let i=this.newKwaiLogoView();e.appendChild(i);let n=this.newContentView();this.addClickConvert(n,2,t.CARD_OTHERAREA_CLICK),e.appendChild(n);let s=this.newActionButton("100%",48,Vt(this.vm.adInfo));return this.addClickConvert(s,1,t.CARD_ACTION_BAR_CLICK),e.appendChild(s),this.addClickConvert(e,2,t.CARD_OTHERAREA_CLICK),e}newActionButton(t,e,i){let n=new TKButton;return n.style={width:t,height:e,borderRadius:e/2,backgroundColor:"#FE3666FF",color:"#FFFFFFFF",fontSize:14,textAlign:"center"},n.setText(i),n}newKwaiLogoView(){let t=new TKImage;return t.style={width:20,height:20,topRightRadius:10,bottomLeftRadius:10,position:"absolute",top:0,right:0},ke(t,"icon_ksad_kwai_logo.png"),t}newContentView(){let t=new TKView;t.style={flexDirection:"column",justifyContent:"center",alignItems:"flex-start"};let e=new TKText;e.style={color:"#222222FF",fontSize:16,fontWeight:"medium",marginBottom:4};let i=new TKView;i.style={flexDirection:"row",justifyContent:"flex-start",alignItems:"center",height:21};let n=new TKImage;n.style={width:16,height:16},ke(n,"icon_ksad_clock.png");let s=new TKText;s.style={color:"#666666FF",fontSize:12},i.appendChild(n),i.appendChild(s),e.setText(this.vm.getLiveSubscribeModel().name),s.setText(this.vm.getLiveSubscribeModel().desc),t.appendChild(e),t.appendChild(i);let a=new TKView;a.style={width:"100%",height:80,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"};let o=this.newUserIconView();return a.appendChild(o),a.appendChild(t),a}newUserIconView(){let t=new TKView;t.style={width:68,height:80,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"};let e=new TKImage;return e.style={width:60,height:60,borderRadius:30,borderWidth:1,borderColor:"#FE3666"},e.setSrc(this.vm.getLiveSubscribeModel().iconUrl),this.liveLabelView=new Zh,t.appendChild(e),t.appendChild(this.liveLabelView),t}addClickConvert(t,e,i){t.addEventListener("tap",(n=>{console.log("KSAdLiveSubscribe click: "+i);const s=Te(n,t);this.vm.convert(1,e,s,i)}))}}class Zh extends TKView{constructor(){super(),this.halfPeriodDuration=100,this.halfPeriodDegree=8,this.newLiveLabelView()}startRotate(){this.rotateAnimation=new TKKeyframeAnimation,this.rotateAnimation.duration=800,this.rotateAnimation.timingFunction="EaseOut",this.rotateAnimation.setAnimations([()=>(this.setStyle(this,this.halfPeriodDegree),.125),()=>(this.setStyle(this,-2*this.halfPeriodDegree),.375),()=>(this.setStyle(this,2*this.halfPeriodDegree),.625),()=>(this.setStyle(this,-2*this.halfPeriodDegree),.875),()=>(this.setStyle(this,this.halfPeriodDegree),1)]),this.addAnimation(this.rotateAnimation,"rotate")}newLiveLabelView(){let t=new TKText;t.setText("直播"),t.style={height:14,width:30,fontSize:10,textAlign:"center",color:"#FFFFFF",backgroundColor:"#FE3666",topLeftRadius:8,topRightRadius:8,bottomRightRadius:8};this.style={width:60,height:28,position:"absolute",flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-start",top:5,right:0},this.appendChild(t)}setStyle(t,e){t.style={transform:{rotate:e}}}}class Qh extends uh{constructor(t){super(t),this.webviewHasAdded=!1,this.halfPlayerVM=t,this.setupViews(),this.setupDatas(),this.setupActions(),this.halfPlayerVM.reportCardImpression(),Di(this.halfPlayerVM,this.halfPlayerVM.$attrsPath.callerContext.lifeStatus,(t=>{"showEnd"===t&&this.loop(),"hideEnd"===t&&this.stopLoop(),"pageVisiable"===t&&this.loop(),"pageInvisiable"===t&&this.stopLoop()})),Di(this.halfPlayerVM,this.halfPlayerVM.$attrsPath.currentPlaybackTime,(t=>{this.currentPlaybackTime=t,t>=this.halfPlayerVM.getShowLandingPageTime()&&this.halfPlayerVM.enableShowLandingPage()&&(this.halfPlayerVM.webviewDidLoad?this.addShowLandingPageAnimation():this.halfPlayerVM.reportHalfplayerWebviewShowEvent())}))}setupActions(){this.contentView.addEventListener("tap",(e=>{this.halfPlayerVM.clickConvert(2,t.CARD_OTHERAREA_CLICK,e)})),this.titleLabel.addEventListener("tap",(e=>{this.halfPlayerVM.clickConvert(2,t.CARD_ICON_NAME_CLICK,e)})),this.descLabel.addEventListener("tap",(e=>{this.halfPlayerVM.clickConvert(2,t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBarView.addEventListener("tap",(e=>{this.halfPlayerVM.clickConvert(2,t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&jt(this,(()=>{this.halfPlayerVM.clickConvert(2,t.CARD_SWIPE_CONVERT,null)}))}setupDatas(){this.appIcon.setSrc(this.halfPlayerVM.getAdIcon()),this.titleLabel.setText(this.halfPlayerVM.getAdTitle()),this.descLabel.setText(this.halfPlayerVM.getAdDesc()),this.actionBarText.setText(this.halfPlayerVM.getActionBarText()),ke(this.sweepView,"icon_ksad_half_play_sweep_image.png"),this.backgroundImage&&this.backgroundImage.setSrc(this.halfPlayerVM.halfPlayerInfo.backgroundImageUrl),this.buttonImage&&this.buttonImage.setSrc(this.halfPlayerVM.halfPlayerInfo.buttonImageUrl),this.scoreHeart&&ke(this.scoreHeart,"icon_ksad_half_play_default_heart.png")}setupViews(){this.style={width:this.halfPlayerVM.getCardWidth(),height:this.halfPlayerVM.getCardHeight(),right:0,bottom:0,backgroundColor:"#FFFFFF",alignItems:"center",justifyContent:"center"},this.setupLandingPage(),this.setupCardBackgroundView(),this.contentView=new TKView,this.contentView.style={width:"100%",height:"100%",top:0,position:"absolute",alignItems:"center",justifyContent:"center",flexDirection:"column"},this.appendChild(this.contentView),this.containerView=new TKView,this.containerView.style={width:302,height:300,alignItems:"center",justifyContent:"center",flexDirection:"column"},this.contentView.appendChild(this.containerView),this.appIconContainer=new TKView,this.appIconContainer.style={width:82,height:82,marginTop:0,borderRadius:18,borderColor:"#FFFFFF99",borderWidth:1,alignItems:"center",justifyContent:"center",overflow:"hidden"},this.containerView.appendChild(this.appIconContainer),this.appIcon=new TKImage,this.appIcon.style={width:80,height:80,resize:"cover",borderRadius:18},this.appIconContainer.appendChild(this.appIcon),this.titleLabel=new TKText,this.titleLabel.style={width:302,fontSize:24,textLineClamp:1,height:29,color:this.halfPlayerVM.getDescribeTextColor(!0),marginTop:20,alignItems:"center",fontWeight:"500",textOverflow:"ellipsis",textAlign:"center"},this.containerView.appendChild(this.titleLabel),this.setupStarAndTagView(),this.descLabel=new TKText,this.descLabel.style={width:302,height:24,textLineClamp:1,fontSize:17,color:this.halfPlayerVM.getDescribeTextColor(!1),marginTop:16,alignItems:"center",textOverflow:"ellipsis",textAlign:"center"},this.containerView.appendChild(this.descLabel),this.setupActionBarView(),this.logoView=new Ri(0,this.halfPlayerVM.callerContext.adInfo),this.logoView.style={position:"absolute",bottom:14,left:10},this.appendChild(this.logoView)}setupStarAndTagView(){let t=this.vm.getAdTagList();if(this.hasTags=t&&t.length>0,this.hasScore=this.vm.getAppScore()>=30,this.scoreTagContainer=new TKView,this.scoreTagContainer.style={flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",height:this.hasTags?40:12,marginTop:8},this.containerView.appendChild(this.scoreTagContainer),this.hasScore){const t=this.vm.getAppScore();this.scoreView=new na(t,this.halfPlayerVM.starStyleInfo),this.scoreView.style={width:75,height:12,top:0},this.scoreTagContainer.appendChild(this.scoreView)}else this.scoreHeart=new TKImage,this.scoreHeart.style={width:64,height:12,top:0},this.scoreTagContainer.appendChild(this.scoreHeart);this.hasTags&&(Ir.create({tagViewStyle:3,height:18,tagBorderRadius:4,tagFontSize:10,customBackgroundColor:this.halfPlayerVM.getBackgroundColor(),customTextColor:this.halfPlayerVM.getTextColor()}),this.tagView=new vr(t,Ir.create({tagViewStyle:3,height:18,tagBorderRadius:4,tagFontSize:10,customBackgroundColor:this.halfPlayerVM.getBackgroundColor(),customTextColor:this.halfPlayerVM.getTextColor()})),this.tagView.style={marginTop:10,height:18},this.scoreTagContainer.appendChild(this.tagView))}setupActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={width:302,height:48,marginTop:32,borderRadius:25,backgroundColor:"#FE3666",alignItems:"center",justifyContent:"center",position:"relative"},this.containerView.appendChild(this.actionBarView),this.setupActionBarBackgroundView(),this.actionContainerView=new TKView,this.actionContainerView.style={width:"100%",height:"100%",top:0,alignItems:"center",justifyContent:"center",flexDirection:"row",overflow:"hidden",position:"absolute"},this.actionBarView.appendChild(this.actionContainerView),this.actionBarText=new TKText,this.actionBarText.style={fontSize:16,height:22,fontWeight:"medium",color:this.halfPlayerVM.getButtonTextColor(),textAlign:"center",alignSelf:"center",includeFontPadding:!1,position:"absolute"},this.actionContainerView.appendChild(this.actionBarText),this.sweepView=new TKImage,this.sweepView.style={width:143,height:"100%",left:-143,resize:"contain",visibility:"hidden"},this.actionContainerView.appendChild(this.sweepView)}setupCardBackgroundView(){this.halfPlayerVM.halfPlayerInfo.backgroundImageUrl&&(this.backgroundImage=new TKImage,this.backgroundImage.style={width:"100%",height:"100%",resize:"cover"},this.appendChild(this.backgroundImage))}setupActionBarBackgroundView(){this.halfPlayerVM.halfPlayerInfo.buttonImageUrl&&(this.buttonImage=new TKImage,this.buttonImage.style={width:"100%",height:"100%",borderRadius:25,resize:"cover"},this.actionBarView.style={backgroundColor:"#FFFFFF00"},this.actionBarView.appendChild(this.buttonImage))}addSweepAnimation(){this.sweepView.removeAllAnimation();const t=this;let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.sweepView.style={left:-143,visibility:"hidden"},0),()=>(t.sweepView.style={left:375,visibility:"visible"},1)]),e.duration=1500,e.timingFunction="linear",this.sweepView.addAnimation(e,"sweepAnim")}loop(){this.addSweepAnimation(),this.swipeAnimaLoopTimer||(this.swipeAnimaLoopTimer=setInterval((()=>{this.addSweepAnimation()}),1700))}stopLoop(){this.swipeAnimaLoopTimer&&(clearInterval(this.swipeAnimaLoopTimer),this.swipeAnimaLoopTimer=void 0),this.sweepView.removeAllAnimation()}setupLandingPage(){if(this.halfPlayerVM.enableShowLandingPage())try{this.webview=new Ts(this.halfPlayerVM.webViewVM),this.webview.style={width:"100%",height:"100%",position:"absolute",left:0,top:0,opacity:0},this.webview.setDeeplinkEnabled(!1),this.appendChild(this.webview),this.webview.render(this.halfPlayerVM.getShowLandingPageH5Url()),this.webview.setOnFinishListener((()=>{console.log("KSAdBaseWebView=====++++++ load finish"),this.halfPlayerVM.webviewDidLoad=!0,this.currentPlaybackTime>=this.halfPlayerVM.getShowLandingPageTime()&&this.addShowLandingPageAnimation()}))}catch(t){console.log("webview error")}}addShowLandingPageAnimation(){if(this.webviewHasAdded)return;this.webviewHasAdded=!0,this.removeAll(),this.webviewContainer=new TKView,this.webviewContainer.style={width:"100%",height:"100%",top:0,position:"absolute",alignItems:"center",justifyContent:"center",flexDirection:"column"},this.appendChild(this.webviewContainer),this.webviewContainer.appendChild(this.webview),this.clickView=new TKView,this.clickView.style={width:"100%",height:"100%",top:0,position:"absolute",alignItems:"center",justifyContent:"center",flexDirection:"column"},this.webviewContainer.appendChild(this.clickView),this.clickView.addEventListener("tap",(e=>{this.halfPlayerVM.clickConvert(2,t.COMMON_CARD_CLICK,e)})),this.vm.supportSlideClick()&&jt(this.clickView,(()=>{this.halfPlayerVM.clickConvert(2,t.CARD_SWIPE_CONVERT,null)}));let e=new TKBasicAnimation;e.setStartValue((()=>{this.webview.style={opacity:0}})),e.setEndValue((()=>{this.webview.style={opacity:1}})),e.duration=300,this.webview.addAnimation(e,"landingPageOpacityAnimation"),e.on("end",(()=>{this.halfPlayerVM.landingPageDidShow=!0,this.halfPlayerVM.reportLandingPageImpression(this.currentPlaybackTime)}))}getHeight(){return this.halfPlayerVM.getCardHeight()}onGetMiddleMarginBottom(t){return t?this.getHeight():0}}class tl extends uh{constructor(e){super(e),this.style={width:"100%",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",paddingLeft:16,paddingRight:16,paddingBottom:16},this.logoView=new Ri(1,this.vm.adInfo),this.logoView.style={marginLeft:0,marginBottom:6},this.bottomContainer=new TKView,this.bottomContainer.style={width:"100%",backgroundColor:"#FFFFFF",height:82,paddingLeft:12,paddingRight:12,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:12},1==this.vm.screenOrientation&&(this.style={width:this.vm.containerLimit.height+20}),this.appendChild(this.logoView),this.appendChild(this.bottomContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),this.bottomContainer.appendChild(this.appIcon);let i=new TKView;if(i.style={height:55,width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",flexWrap:"no-wrap",flexShrink:1},this.bottomContainer.appendChild(i),this.nameLabel=new TKText,this.nameLabel.style={fontSize:15,color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},i.appendChild(this.nameLabel),this.vm.isDownloadAd()){this.nameLabel.setText(this.vm.getAdTitle());const e=new TKView;if(e.style={flexDirection:"column"},i.appendChild(e),this.vm.getAppScore()>=30||Ie(this.vm.getAppDownloadCountDesc())){if(this.vm.getAppScore()>=30){const i=this.vm.getAppScore();this.scoreView=new na(i),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),e.appendChild(this.scoreView)}if(Ie(this.vm.getAppDownloadCountDesc())){let i=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(i=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",marginLeft:0,marginTop:5},this.downloadCountLabel.setText(i),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),e.appendChild(this.downloadCountLabel)}}else this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}))}else this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),i.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));this.actionBtn=new Ch(this.vm.adInfo,{borderRadius:18,height:36,width:88}),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomContainer.appendChild(this.actionBtn),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),this.actionBtn.setOnTapListener((e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.nameLabel&&jt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.descLabel&&jt(this.descLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.actionBtn&&jt(this.actionBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.bottomContainer&&jt(this.bottomContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback(),this.addCardDynamic(),this.vm.reportOptimalCardImpression()}getHeight(){return 120}addCardDynamic(){if(this.bottomContainer&&this.actionBtn){const t=this.bottomContainer.style;t.bottom=16,t.left=16,t.position="absolute",this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtn,t):this.addCardDynamicEffects(this.bottomContainer,this.actionBtn,t)}}stopActionAnimation(){this.pauseActionAnimation()}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&this.addCardDynamic()}}class el extends uh{constructor(e){super(e);let i=1==this.vm.screenOrientation;this.cardDelayShowTime=3,this.cardHeight=130,this.style={width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16,bottom:-56},i&&(this.style={width:this.vm.containerLimit.height+20}),this.bottomContainerConver=new TKView,this.bottomContainerConver.style={opacity:0,backgroundColor:"#FFFFFF",position:"absolute",borderRadius:12,left:0,right:0,height:this.cardHeight,bottom:-146},this.bottomContainer=new TKView,this.bottomContainer.style={height:this.cardHeight+16,width:"100%",paddingBottom:16,borderRadius:12,paddingLeft:12,paddingRight:12,paddingTop:12,marginTop:4,flexDirection:"column",alignItems:"flex-start"},this.appendChild(this.bottomContainer),this.bottomContainer.appendChild(this.bottomContainerConver);const n=new TKView;n.style={flexDirection:"row",width:"100%"},this.bottomContainer.appendChild(n),this.textContainer=new TKView,this.textContainer.style={width:"100%",height:58,justifyContent:"center",paddingLeft:70,flexDirection:"column"},n.appendChild(this.textContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),n.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={width:"100%",height:24,alignItems:"center",flexDirection:"row"},this.logoView=new Ri(0,this.vm.adInfo),this.logoView.style={marginLeft:10},this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,textAlign:"center",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",flexShrink:1},this.nameContainer.appendChild(this.nameLabel),this.nameContainer.appendChild(this.logoView),this.textContainer.appendChild(this.nameContainer),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={marginTop:4,textLineClamp:1,fontSize:14,color:"#FFFFFF",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),this.textContainer.appendChild(this.descLabel),this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={marginTop:8,flexDirection:"column",justifyContent:"center",width:"100%",height:40,alignItems:"center",opacity:0},this.bottomContainer.appendChild(this.bottomBtnContainer),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={backgroundColor:"#FFFFFF",opacity:.2,justifyContent:"center",height:40,width:"100%",borderRadius:20},this.bottomBtnContainer.appendChild(this.actionBtnContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:"100%",height:40,borderRadius:20}),this.actionBtn.style={position:"absolute",left:0,right:0,top:0,bottom:0},_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomBtnContainer.appendChild(this.actionBtn),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),this.actionBtn.setOnTapListener((e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.actionBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.bottomContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation(),this.vm.reportOptimalCardImpression()}startActionAnimation(){setTimeout((()=>{this.animationAllowed=!0,this.animationAllowed&&this.addActionTranslateAnim()}),1e3*this.cardDelayShowTime),Pe.isAndroid()||this.vm.supportNewAnimation()||this.resetIOSFrame()}resetIOSFrame(){setTimeout((()=>{this.style={bottom:0},this.bottomContainerConver.style={height:this.cardHeight+16,bottom:15}}),1e3*this.cardDelayShowTime+4500)}addActionTranslateAnim(){this.vm.supportNewAnimation()?this.updateBottom(this,-48,"translate"):this.addTranslateAction(this,Pe.isAndroid()?0:8,Pe.isAndroid()?-48:8,"translate");let t=new TKKeyframeAnimation;t.animType="opacity",t.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}],t.duration=500,t.on("end",(t=>{setTimeout((()=>{this.actionBtnContainer.style={backgroundColor:"#FE3666"},this.addActionAlphaAnim(this.actionBtnContainer,Pe.isAndroid()?.2:1,1,"actionBtnContainerColorOpacity",500,1500,(t=>{this.addActionInfoAndBgChangeAnim()}))}),1500)})),this.bottomBtnContainer.addAnimation(t,"bottomBtnContainerOpacity")}updateAppInfoColor(){this.nameLabel.style={color:"#222222"},this.descLabel.style={color:"#666666"},this.logoView.setTitleColor("#D3D3D3"),this.nameContainer.style={width:"100%",height:24,alignItems:"center",flexDirection:"row"},this.textContainer.style={width:"100%",height:58,justifyContent:"center",paddingLeft:70,flexDirection:"column"}}addActionInfoAndBgChangeAnim(){this.vm.supportNewAnimation()?(this.updateBottom(this,-56,"infotranslate"),this.updateBottom(this.bottomContainerConver,-162,"bottomContainerConverTranslate")):(this.addTranslateAction(this,Pe.isAndroid()?-48:0,Pe.isAndroid()?-56:0,"infotranslate"),this.addTranslateAction(this.bottomContainerConver,0,Pe.isAndroid()?-162:0,"bottomContainerConverTranslate",500)),this.addActionAlphaAnim(this.bottomContainerConver,Pe.isAndroid()?0:1,1,"cardOpacity"),setTimeout((()=>{this.updateAppInfoColor(),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300),setTimeout((()=>{this.addCardDynamic()}),500)}addActionAlphaAnim(t,e,i,n,s=500,a=0,o=void 0){let r=new TKKeyframeAnimation;r.animType="opacity",r.keyframes=[{percent:0,value:e,easing:"EaseInEaseOut"},{percent:1,value:i,easing:"EaseInEaseOut"}],r.duration=s,r.on("end",(t=>{o&&setTimeout((()=>{o(t)}),a)})),t&&t.addAnimation(r,n)}addTranslateAction(t,e,i,n,s=500){let a=new TKKeyframeAnimation;a.animType="position",a.keyframes=[{percent:0,value:{x:0,y:e},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:i},easing:"EaseInEaseOut"}],a.duration=s,t&&t.addAnimation(a,n)}updateBottom(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={transform:{translate:{y:e}}}})),s.duration=n,t&&t.addAnimation(s,i)}stopActionAnimation(){this.animationAllowed=!1,this&&this.removeAllAnimation(),this.pauseActionAnimation()}addCardDynamic(){if(this.bottomContainer&&this.actionBtn){const t=this.bottomContainer.style;this.bottomContainerConver.clipChildren=!1,t.bottom=16,t.left=16,t.position="absolute",t.height=this.cardHeight,t.backgroundColor="#FFFFFF",this.clipChildren=!1,this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtn,t):this.addCardDynamicEffects(this.bottomContainer,this.actionBtn,t)}}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&this.addCardDynamic()}getHeight(){return this.cardHeight+20}}class il extends uh{constructor(e){super(e),this.moveHeight=-80;let i=1==this.vm.screenOrientation;this.cardDelayShowTime=5,this.style={width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:-80},this.logoView=new Ri(1,this.vm.adInfo),this.logoView.style={marginLeft:12,marginBottom:12};const n=new TKView;n.style={backgroundColor:"#FFFFFF",height:80,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},i&&(this.moveHeight=-96,this.style={width:this.vm.containerLimit.height+20,paddingLeft:16,paddingRight:16,paddingBottom:16,bottom:-96},this.logoView.style={marginLeft:0,marginBottom:6},n.style={paddingLeft:12,paddingRight:12,borderRadius:12}),this.appendChild(this.logoView),this.appendChild(n);const s=new TKView;s.style={flexDirection:"row",flexShrink:1},n.appendChild(s);this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),s.appendChild(this.appIcon);const a=new TKView;if(a.style={marginLeft:12,height:55,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"center",flexWrap:"no-wrap",flexShrink:1,marginRight:8},s.appendChild(a),this.nameLabel=new TKText,this.nameLabel.style={fontSize:15,color:"#222222",flexWrap:"no-wrap",textLineClamp:1,textOverflow:"ellipsis"},a.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.vm.isDownloadAd()){this.nameLabel.setText(this.vm.getAdTitle());const e=new TKView;if(e.style={flexDirection:"column"},a.appendChild(e),this.vm.getAppScore()>=30||Ie(this.vm.getAppDownloadCountDesc())){if(this.vm.getAppScore()>=30){const i=this.vm.getAppScore();this.scoreView=new na(i),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),e.appendChild(this.scoreView)}if(Ie(this.vm.getAppDownloadCountDesc())){let i=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(i=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",marginLeft:0,marginTop:5},this.downloadCountLabel.setText(i),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),e.appendChild(this.downloadCountLabel)}}else this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}))}else this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),a.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));this.rightContainer=new TKView,this.rightContainer.style={flexDirection:"column",justifyContent:"center",alignItems:"center"},n.appendChild(this.rightContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:88,height:36,borderRadius:18}),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.rightContainer.appendChild(this.actionBtn);const o=new TKView;o.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.rightContainer.appendChild(o),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),o.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),n.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(o,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(n,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation()}startActionAnimation(){const t=this.vm.supportNewAnimation();setTimeout((()=>{if(this.animationAllowed=!0,!this.animationAllowed)return;let e=null;if(t){const t=new TKBasicAnimation;t.setEndValue((()=>{this.style={transform:{translate:{y:this.moveHeight}}}})),e=t}else{const t=new TKKeyframeAnimation;t.animType="position",t.keyframes=[{percent:0,value:{x:0,y:0},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:Pe.isAndroid()?this.moveHeight:0},easing:"EaseInEaseOut"}],e=t}e.duration=500,this.addActionTranslateAnim(e)}),1e3*this.cardDelayShowTime),Pe.isAndroid()||t||this.resetIOSFrame()}resetIOSFrame(){setTimeout((()=>{this.style={bottom:0}}),1e3*this.cardDelayShowTime+500)}addActionTranslateAnim(t){this&&(this.addAnimation(t,"translate"),t.on("end",(t=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()})))}getHeight(){return 0==this.vm.screenOrientation?108:118}}class nl extends uh{constructor(e){super(e),this.cardDelayShowTime=5;let i=1==this.vm.screenOrientation,n=this.vm.getAdTagList();this.hasTags=n&&n.length>0,this.hasScore=this.vm.getAppScore()>=30,this.hasDownloadCountDesc=X(this.vm.adInfo)&&Ie(this.vm.getAppDownloadCountDesc())&&this.vm.isValidDownloadCardInfo(),this.cardHeight=this.hasScore||this.hasTags?156:136,this.style={width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16,bottom:-1*(this.cardHeight+16)},i&&(this.style={width:this.vm.containerLimit.height+20}),this.logoView=new Ri(1,this.vm.adInfo),this.logoView.style={marginBottom:10},this.appendChild(this.logoView),this.bottomContainer=new TKView,this.bottomContainer.style={backgroundColor:"#FFFFFF",height:this.cardHeight,width:"100%",paddingLeft:12,paddingRight:12,paddingTop:12,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,borderRadius:12},this.appendChild(this.bottomContainer);const s=new TKView;s.style={flexDirection:"row",width:"100%",position:"relative"},this.bottomContainer.appendChild(s);const a=new TKView;if(a.style={width:"100%",height:58,paddingLeft:70,flexDirection:"column",justifyContent:"space-around"},s.appendChild(a),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),s.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={fontSize:21,color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},a.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),this.hasScore||this.hasTags||this.hasDownloadCountDesc){let e=!1;const i=new TKView;if(i.style={flexDirection:"row",width:"100%",height:18,marginTop:6,position:"relative"},a.appendChild(i),this.hasDownloadCountDesc){let e=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(e=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",left:0,bottom:1.5,marginRight:6,flexGrow:1},this.downloadCountLabel.setText(e),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),i.appendChild(this.downloadCountLabel)}else if(this.hasScore){e=!0;const n=this.vm.getAppScore();this.scoreView=new na(n),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),this.scoreView.style={width:75,position:"absolute",left:0,bottom:3.5},i.appendChild(this.scoreView)}this.hasTags&&(this.tagView=new vr(n),this.tagView.style={paddingLeft:e?80:0},i.appendChild(this.tagView)),this.bottomContainer.appendChild(this.descLabel)}else a.appendChild(this.descLabel);this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={flexDirection:"column",justifyContent:"center",width:"100%",height:40,marginBottom:12,alignItems:"center"},this.bottomContainer.appendChild(this.bottomBtnContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:"100%",height:40,borderRadius:20}),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomBtnContainer.appendChild(this.actionBtn);const o=new TKView;o.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.bottomBtnContainer.appendChild(o),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),o.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(o,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),jt(this.bottomContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation(),this.vm.reportOptimalCardImpression()}startActionAnimation(){const t=this.vm.supportNewAnimation();setTimeout((()=>{if(this.animationAllowed=!0,!this.animationAllowed)return;let e=null;if(t){const t=new TKBasicAnimation;t.setEndValue((()=>{this.style={transform:{translate:{y:-1*(this.cardHeight+16)}}}})),e=t}else{const t=new TKKeyframeAnimation;t.animType="position",t.keyframes=[{percent:0,value:{x:0,y:0},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:Pe.isAndroid()?-(this.cardHeight+16):0},easing:"EaseInEaseOut"}],e=t}e.duration=800,this.addActionTranslateAnim(e)}),1e3*this.cardDelayShowTime),Pe.isAndroid()||t||this.resetIOSFrame()}resetIOSFrame(){setTimeout((()=>{this.style={bottom:0}}),1e3*this.cardDelayShowTime+800)}addActionTranslateAnim(t){this&&(this.addAnimation(t,"translate"),t.on("end",(t=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback(),this.addCardDynamic()})))}getHeight(){return this.cardHeight+16+10+16}addCardDynamic(){if(this.bottomContainer&&this.actionBtn){const t=this.bottomContainer.style;t.bottom=0,t.left=16,t.position="absolute",this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtn,t):this.addCardDynamicEffects(this.bottomContainer,this.actionBtn,t)}}stopActionAnimation(){this.pauseActionAnimation()}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&this.addCardDynamic()}}class sl extends uh{constructor(t){super(t),this.animationAllowed=!1,this.cardHeight=152,this.setupViews(),this.setupData(),this.setupActions(),this.setupAnimation(),this.vm.reportConductCardImpression(this.getTemplateShowType()),_i(this.vm.$attrsPath.lifeStatus,(t=>{this.lifeStatus=t,"pageVisiable"==t&&this.resumeAnim(),"pageInvisiable"==t&&this.pauseAnim(),"hideEnd"==t&&this.stopAnim()}))}setupViews(){this.style={width:this.getWidth(),height:this.getHeight(),flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",position:"absolute",bottom:0,paddingLeft:12,paddingRight:12,paddingBottom:8},this.bottomContainer=new TKView,this.bottomContainer.style={height:110,width:"100%",opacity:0,flexDirection:"column",alignItems:"flex-start"},this.appendChild(this.bottomContainer),this.appInfoContainer=new TKView,this.appInfoContainer.style={top:this.getTopDistance(),position:"absolute",flexDirection:"row",width:"100%"},this.bottomContainer.appendChild(this.appInfoContainer),this.textContainer=new TKView,this.textContainer.style={width:"100%",height:58,justifyContent:"center",paddingLeft:70,flexDirection:"column"},this.appInfoContainer.appendChild(this.textContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:1},this.appInfoContainer.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={width:"100%",height:21,alignItems:"center",flexDirection:"row"},this.textContainer.appendChild(this.nameContainer),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,fontWeight:"500",textAlign:"left",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",marginRight:8,flexShrink:2,flexGrow:2},this.nameContainer.appendChild(this.nameLabel),this.logoView=new Ri(0,this.vm.adInfo),this.nameContainer.appendChild(this.logoView),this.descLabel=new TKText,this.descLabel.style={marginTop:8,textLineClamp:1,fontSize:14,color:"#FFFFFFCC",textOverflow:"ellipsis"},this.textContainer.appendChild(this.descLabel),this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={bottom:0,position:"absolute",flexDirection:"column",justifyContent:"center",width:"100%",height:40,alignItems:"center",opacity:0},this.bottomContainer.appendChild(this.bottomBtnContainer),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={backgroundColor:"#FFFFFF",opacity:.2,justifyContent:"center",height:40,width:"100%",borderRadius:20},this.bottomBtnContainer.appendChild(this.actionBtnContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:"100%",height:40,right:0,borderRadius:20,backgroundColor:"#FFFFFF00"}),this.actionBtn.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.bottomBtnContainer.appendChild(this.actionBtn),Pe.supportMinimumTKVersion("5.0.0")&&(this.sweepView=new RoundRectView,this.sweepView.style={left:0,right:0,top:0,bottom:0,borderRadius:20,position:"absolute"},this.sweepView.throughHitTest=!0,this.bottomBtnContainer.appendChild(this.sweepView))}setupData(){ke(this.appIcon,this.vm.getAdIcon()),this.nameLabel.setText(this.vm.getAdTitle()),Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)}))}setupActions(){let e=new S;e.template_show_type=this.getTemplateShowType(),this.appIcon&&this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.nameLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.actionBtn,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}setupAnimation(){setTimeout((()=>{this.animationAllowed||(this.animationAllowed=!0,this.addAlphaAnim(this.bottomContainer,"opacityAnimation",(t=>{this.cardTranslateAnim(),this.addBottomActionAlphaAnim()}),250,750))}),4e3)}addAlphaAnim(t,e,i=void 0,n=0,s=0,a=0,o=1,r="#FFFFFF00",h="#FFFFFF00"){if("hideEnd"==this.lifeStatus)return;if(!n)return t.style={opacity:o,backgroundColor:h},void(i&&setTimeout((()=>{i(!0)}),s));let l=new TKBasicAnimation;l.timingFunction="Linear",l.setStartValue((()=>{t.style={opacity:a,backgroundColor:r}})),l.setEndValue((()=>{t.style={opacity:o,backgroundColor:h}})),l.duration=n,l.on("end",(t=>{i&&setTimeout((()=>{i(t)}),s)})),t&&t.addAnimation(l,e)}addBottomActionAlphaAnim(){this.addAlphaAnim(this.bottomBtnContainer,"bottomOpacityAnimation",(t=>{this.addActionColorAlphaAnim(),setTimeout((()=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300)}),330,670)}addActionColorAlphaAnim(){this.addAlphaAnim(this.actionBtnContainer,"colorAlphaAnimation",(t=>{this.addActionScaleAnim()}),400,3670,.2,1,"#FFFFFF","#FE3666")}cardTranslateAnim(){if("hideEnd"==this.lifeStatus)return;const t=new TKBasicAnimation;t.setEndValue((()=>{this.appInfoContainer.style={transform:{translate:{y:-52}}}})),t.duration=400,this.appInfoContainer.addAnimation(t,"translate")}addActionScaleAnim(){let t=Ui(this.bottomBtnContainer,.95,500,2,this.vm.supportNewAnimation());this.bottomBtnContainer.addAnimation(t,"actionBtnScale"),t.on("end",(()=>{Pe.supportMinimumTKVersion("5.0.0")?this.addSweepAnim():setTimeout((()=>{this.addActionScaleAnim()}),1e3)}))}addSweepAnim(){this.sweepImage&&this.sweepView&&this.sweepView.removeChild(this.sweepImage);const t=this.bottomBtnContainer.getSize(),e=204*t.height/80;this.sweepImage=new TKImage,this.sweepImage.style={width:e,height:t.height,left:-e,top:0,position:"absolute"},ke(this.sweepImage,"ksad_video_bottom_sweep_light.png"),this.sweepView&&this.sweepView.appendChild(this.sweepImage);let i=zi(500,Number(t.width)+2*e);this.sweepImage.addAnimation(i,"sweepAnim"),i.on("end",(()=>{setTimeout((()=>{this.addActionScaleAnim()}),1e3)}))}stopActionAnimation(){this.animationAllowed=!1,this&&this.removeAllAnimation()}getHeight(){return this.cardHeight}getWidth(){return 0==this.vm.screenOrientation?this.vm.containerLimit.width:this.vm.containerLimit.height}getTopDistance(){return 52}getTemplateShowType(){return"gradient_weak_card"}pauseAnim(){this.sweepImage&&this.sweepView&&this.sweepImage.removeAllAnimation(),this.bottomBtnContainer&&this.bottomBtnContainer.removeAllAnimation()}resumeAnim(){this.bottomBtnContainer&&this.addActionScaleAnim()}stopAnim(){this.pauseAnim(),this.removeAllAnimation()}}class al extends sl{setupAnimation(){this.animationAllowed||(this.animationAllowed=!0,this.addAlphaAnim(this.bottomContainer,"opacityAnimation",(t=>{this.addBottomActionAlphaAnim()})))}addBottomActionAlphaAnim(){this.addAlphaAnim(this.bottomBtnContainer,"bottomOpacityAnimation",(t=>{this.addActionColorAlphaAnim(),setTimeout((()=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300)}))}addActionColorAlphaAnim(){this.addAlphaAnim(this.actionBtnContainer,"colorAlphaAnimation",(t=>{this.addActionScaleAnim()}),0,4e3,.2,1,"#FFFFFF","#FE3666")}getTopDistance(){return 0}getTemplateShowType(){return"continued_weak_card"}}class ol extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData(),this.setupActions()}setupViews(){this.style={width:"100%",height:116,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appIconContainer=new TKView,this.appIconContainer.style={top:0,width:58,height:58,borderRadius:12,borderColor:"#FFFFFF",borderWidth:1,position:"absolute"},this.appendChild(this.appIconContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12,top:0,left:0,position:"absolute"},this.appIconContainer.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={width:"100%",height:21,top:66,alignItems:"center",justifyContent:"center",position:"absolute"},this.appendChild(this.nameContainer),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,color:"#FFFFFF",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"500"},this.nameContainer.appendChild(this.nameLabel),this.textContainer=new TKView,this.textContainer.style={width:"100%",height:21,bottom:0,position:"absolute",alignItems:"center",justifyContent:"center"},this.appendChild(this.textContainer),this.descLabel=new TKText,this.descLabel.style={fontSize:14,color:"#FFFFFFCC",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"400"},this.textContainer.appendChild(this.descLabel)}setupData(){ke(this.appIcon,this.vm.getAdIcon()),this.nameLabel.setText(this.vm.getAdTitle()),Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,"")}setupActions(){let e=new S;e.template_show_type=this.getTemplateShowType(),this.appIcon&&this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.nameLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.descLabel,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}getTemplateShowType(){return"info_arc_card"}}class rl extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData()}setupViews(){this.style={width:"100%",height:22,justifyContent:"center",alignItems:"center"},this.actionBarLabel=new TKText,this.actionBarLabel.style={fontSize:16,color:"#FFFFFF99",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"500"},this.appendChild(this.actionBarLabel)}setupData(){this.actionBarLabel.setText(this.getAdActionDesc())}getAdActionDesc(){return"上滑或点击"+Vt(this.vm.adInfo)}getTemplateShowType(){return"all_arc_card"}}class hl extends uh{constructor(t){super(t),this.animationAllowed=!1,this.cardType=this.vm.getActionBarStyle(),this.setupViews(),this.setupDatas(),this.setupActions(),this.setupAnimation(),this.vm.reportConductCardImpression(this.templateShowType),_i(this.vm.$attrsPath.lifeStatus,(t=>{this.lifeStatus=t,"pageVisiable"==t&&this.resumeAnim(),"pageInvisiable"==t&&this.pauseAnim(),"hideEnd"==t&&this.stopAnim()}))}setupViews(){this.style={width:this.getWidth(),height:this.getHeight(),flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",bottom:-this.getHeight()},this.setupSubViews()}setupSubViews(){let t;this.arcViewContainer=new TKView,this.arcViewContainer.style={width:"100%",height:this.getArcViewHeight(),bottom:0,justifyContent:"center",alignItems:"center",position:"absolute"},this.appendChild(this.arcViewContainer),Pe.supportMinimumTKVersion("5.0.0")&&(this.arcView=new TKLottieImageView,this.arcView.style={width:this.getArcViewWidth(),height:"100%",bottom:0,position:"absolute"},ye()||this.arcView.setResize("center"),this.arcViewContainer.appendChild(this.arcView)),this.arrowViewContainer=new TKView,this.arrowViewContainer.style={width:"100%",height:33,top:this.arrowViewTop(),opacity:0,justifyContent:"center",alignItems:"center",position:"absolute"},this.appendChild(this.arrowViewContainer),Pe.supportMinimumTKVersion("5.0.0")&&(this.arrowView=new TKLottieImageView,this.arrowView.style={width:23,height:33},this.arrowViewContainer.appendChild(this.arrowView)),this.isElementCard()&&(this.callText=new TKText,this.callText.style={width:"100%",height:"17",top:76,fontSize:12,color:"#FFFFFF99",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"500",position:"absolute"},this.appendChild(this.callText),this.callText.setText("上滑或点击"+Vt(this.vm.adInfo))),this.actionbarView=new TKView,this.actionbarView.style={width:"100%",height:"100%",top:0,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16},this.appendChild(this.actionbarView),t=this.isElementCard()?new ol(this.vm):new rl(this.vm),this.templateShowType=t.getTemplateShowType(),t.style={width:"100%",top:this.getPaddingTop()},this.actionbarView.appendChild(t),this.logoView=new Ri(1,this.vm.adInfo),this.logoView.style={left:16,bottom:16,position:"absolute"},this.appendChild(this.logoView)}setupDatas(){Pe.supportMinimumTKVersion("5.0.0")&&(this.isElementCard()?this.arcView.setUri(Fe("neo_info_element_arc_style.json")):this.arcView.setUri(Fe("neo_all_arc_element_style.json")),this.arrowView.setUri(Fe("neo_arc_arrow.json")))}setupActions(){let e=new S;e.template_show_type=this.templateShowType,this.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&jt(this,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))}setupAnimation(){setTimeout((()=>{this.cardTranslateAnim()}),4e3)}addTranslateAnim(t,e,i,n=void 0,s=500,a=500){if("hideEnd"==this.lifeStatus)return;let o=new TKBasicAnimation;o.timingFunction="Linear",o.setEndValue((()=>{t.style={transform:{translate:{y:i}}}})),o.duration=a,o.on("end",(t=>{n&&setTimeout((()=>{n(t)}),s)})),t&&t.addAnimation(o,e)}cardTranslateAnim(){this.addTranslateAnim(this,"arcCardTranslate",-this.getHeight(),(t=>{this.arrowAlphaAnim(),this.arrowTranslateUpAnim(),this.arcView.play(),this.arcView.setLoop(!0),setTimeout((()=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300)}))}arrowTranslateUpAnim(){this.addTranslateAnim(this.arrowViewContainer,"arrowTranslateUp",-9,(t=>{this.arrowTranslateDownAnim()}),0)}arrowTranslateDownAnim(){this.addTranslateAnim(this.arrowViewContainer,"arrowTranslateUp",0,(t=>{this.arrowView.play(),this.arrowView.setLoop(!0)}),800)}arrowAlphaAnim(){let t=new TKBasicAnimation;t.timingFunction="Linear",t.setStartValue((()=>{this.arrowViewContainer.style={opacity:0}})),t.setEndValue((()=>{this.arrowViewContainer.style={opacity:1}})),t.duration=500,this.arrowViewContainer.addAnimation(t,"arrowViewOpacity")}pauseAnim(){this.arcView&&this.arcView.pause(),this.arrowView&&this.arrowView.pause()}resumeAnim(){this.arcView&&this.arcView.resume(),this.arrowView&&this.arrowView.resume()}stopAnim(){this.arcView&&this.arcView.stop(),this.arrowView&&this.arrowView.stop(),this.arcViewContainer&&this.arcViewContainer.removeAllAnimation(),this.arrowViewContainer&&this.arrowViewContainer.removeAllAnimation(),this.removeAllAnimation()}getWidth(){return this.vm.containerLimit.width}getHeight(){return this.isElementCard()?263:150}getArcViewWidth(){return this.isElementCard()?700:550}getArcViewHeight(){return this.isElementCard()?263:150}arrowViewTop(){return this.isElementCard()?44:38}getPaddingTop(){return this.isElementCard()?106:79}isElementCard(){return 15===this.cardType}}class ll extends TKView{constructor(t){super(),this.hasTags=!1,this.vm=t,this.setupViews(),this.setupData(),this.setupActions()}setupViews(){this.style={width:"100%",height:40,flexDirection:"row"},this.appIcon=new TKImage,this.appIcon.style={width:40,height:40,marginLeft:0,borderRadius:4},this.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={flexDirection:"column",justifyContent:"center",alignItems:"flex-start",width:204,height:40,marginLeft:8},this.appendChild(this.nameContainer),this.setupNameContainer(),this.logoView=new Ri(0,this.vm.adInfo),this.logoView.style={right:0,bottom:0,position:"absolute"},this.appendChild(this.logoView)}setupNameContainer(){var t;let e=null===(t=this.vm.getAdTagList())||void 0===t?void 0:t.slice(0,2);this.hasTags=!be(e)&&e&&e.length>0,this.nameLabel=new TKText,this.nameLabel.style={fontSize:this.hasTags?14:17,fontWeight:"500",textAlign:"left",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",marginLeft:0,shadow:"1 1 1 #000000CC"},this.nameContainer.appendChild(this.nameLabel),this.hasTags&&(this.tagView=new vr(e,Ir.create({tagViewStyle:3,height:20,tagBorderRadius:4,tagFontSize:10,customBackgroundColor:"#FFFFFF33",customTextColor:"#FFFFFF",customShadowColor:"1 1 1 #00000040"})),this.tagView.style={marginTop:2},this.nameContainer.appendChild(this.tagView))}setupData(){ke(this.appIcon,this.vm.getAdIcon()),this.nameLabel.setText(this.vm.getAdTitle())}setupActions(){let e=new S;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.appIcon&&this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon&&jt(this.appIcon,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.nameLabel&&jt(this.nameLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}}class dl extends uh{constructor(t){super(t),this.vm=t,this.setupViews(),this.setupData(),this.setupActions(),setTimeout((()=>{this.cardDynamicEffectsCallback&&this.cardDynamicEffectsCallback(this.actionBtn,this.style)}),500)}setupViews(){this.style={width:"100%",height:124,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",borderRadius:8,bottom:16,position:"absolute",gradientBgColor:"0, #FFE8ED 0, #FFFFFF 1",borderWidth:.5,borderColor:"#FFFFFF33"},this.bottomContainer=new TKView,this.bottomContainer.style={marginLeft:0,marginTop:13,height:48,width:"100%",flexDirection:"row",alignItems:"center"},this.appendChild(this.bottomContainer),this.downloadInfoContainer=new TKView,this.downloadInfoContainer.style={marginLeft:0,marginTop:0,paddingLeft:11,paddingRight:4,height:48,width:88,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.downloadInfoContainer),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={marginLeft:0,marginTop:0,width:"100%",fontSize:20,fontWeight:"500",textAlign:"center",color:"#222222",textLineClamp:1,textOverflow:"ellipsis",flexShrink:2},this.downloadInfoContainer.appendChild(this.downloadCountLabel),this.downloadToastContainer=new TKView,this.downloadToastContainer.style={marginTop:4,marginLeft:0,height:15,width:"100%",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.downloadInfoContainer.appendChild(this.downloadToastContainer),this.downloadDescLabel=new TKText,this.downloadDescLabel.style={fontSize:10,textAlign:"center",color:"#666666",textLineClamp:1,flexShrink:1},this.downloadToastContainer.appendChild(this.downloadDescLabel),this.toastView=new TKView,this.toastView.style={width:14,height:10,marginLeft:0},this.downloadToastContainer.appendChild(this.toastView),this.toastTag=new TKImage,this.toastTag.style={width:10,height:10,marginLeft:0},this.toastView.appendChild(this.toastTag),this.splitView=new TKView,this.splitView.style={marginLeft:0,marginTop:0,width:1,height:48,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.splitView);const t=new TKView;t.style={marginLeft:0,marginTop:0,width:"100%",height:24,gradientBgColor:"270,#FFFFFF00 0, #6A6A6A66 1"},this.splitView.appendChild(t);let e=new TKView;e.style={marginLeft:0,marginTop:0,width:"100%",height:24,flexGrow:1,gradientBgColor:"270,#6A6A6A66 0, #FFFFFF00 1"},this.splitView.appendChild(e),this.textContainer=new TKView,this.textContainer.style={width:294,height:"100%",paddingRight:11,paddingLeft:11,flexShrink:1,justifyContent:"center",alignItems:"center"},this.bottomContainer.appendChild(this.textContainer),this.descLabel=new TKText,this.descLabel.style={width:"100%",textLineClamp:2,fontSize:14,color:"#222222",textAlign:"left",textOverflow:"ellipsis"},this.textContainer.appendChild(this.descLabel),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={justifyContent:"center",marginTop:14,paddingLeft:11,paddingRight:11,height:36,width:"100%",borderRadius:100},this.appendChild(this.actionBtnContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:"100%",height:"100%",right:0,borderRadius:100,backgroundColor:"#FE3666"}),this.actionBtnContainer.appendChild(this.actionBtn)}setupData(){var t;ke(this.toastTag,"ksad_download_card_toast_icon.png"),this.downloadCountLabel.setText(this.vm.getAppDownloadCountDesc()),Li(this.downloadDescLabel,"text",null===(t=this.vm.$attrsPath.downloadCardDataInfo)||void 0===t?void 0:t.appDownloadDescText,""),Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)}))}setupActions(){let e=new S;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.downloadInfoContainer&&this.downloadInfoContainer.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK,e)})),this.descLabel&&this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn&&this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.toastView&&this.toastView.addEventListener("tap",(t=>{var e;We(null===(e=this.vm.downloadCardDataInfo)||void 0===e?void 0:e.toastText)})),this.vm.supportSlideClick()&&(this.downloadInfoContainer&&jt(this.downloadInfoContainer,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.descLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.actionBtn,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}}class cl extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData(),this.setupActions(),setTimeout((()=>{this.cardDynamicEffectsCallback&&this.cardDynamicEffectsCallback(this.actionBtn,this.style)}),500)}setupViews(){this.style={width:"100%",height:124,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",borderRadius:8,bottom:0,position:"absolute"},this.bottomContainer=new TKView,this.bottomContainer.style={marginLeft:0,marginTop:13,height:48,width:"100%",flexDirection:"row",alignItems:"center"},this.appendChild(this.bottomContainer),this.downloadInfoContainer=new TKView,this.downloadInfoContainer.style={marginLeft:0,marginTop:0,paddingLeft:11,paddingRight:4,height:48,width:88,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.downloadInfoContainer),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={marginLeft:0,marginTop:0,width:"100%",fontSize:20,fontWeight:"500",textAlign:"center",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",flexShrink:2},this.downloadInfoContainer.appendChild(this.downloadCountLabel),this.downloadToastContainer=new TKView,this.downloadToastContainer.style={marginTop:4,marginLeft:0,height:15,width:"100%",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.downloadInfoContainer.appendChild(this.downloadToastContainer),this.downloadDescLabel=new TKText,this.downloadDescLabel.style={fontSize:10,textAlign:"center",color:"#FFFFFF99",textLineClamp:1,flexShrink:1},this.downloadToastContainer.appendChild(this.downloadDescLabel),this.toastView=new TKView,this.toastView.style={width:14,height:10,marginLeft:0},this.downloadToastContainer.appendChild(this.toastView),this.toastTag=new TKImage,this.toastTag.style={width:10,height:10,marginLeft:0},this.toastView.appendChild(this.toastTag),this.splitView=new TKView,this.splitView.style={marginLeft:0,marginTop:0,width:1,height:48,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.splitView);const t=new TKView;t.style={marginLeft:0,marginTop:0,width:"100%",height:24,gradientBgColor:"270,#FFFFFF00 0, #FFFFFF66 1"},this.splitView.appendChild(t);let e=new TKView;e.style={marginLeft:0,marginTop:0,width:"100%",height:24,flexGrow:1,gradientBgColor:"270,#FFFFFF66 0, #FFFFFF00 1"},this.splitView.appendChild(e),this.textContainer=new TKView,this.textContainer.style={width:294,height:"100%",paddingRight:11,paddingLeft:11,justifyContent:"center",flexShrink:1,alignItems:"center"},this.bottomContainer.appendChild(this.textContainer),this.descLabel=new TKText,this.descLabel.style={width:"100%",textLineClamp:2,fontSize:14,color:"#FFFFFF",textAlign:"left",textOverflow:"ellipsis"},this.textContainer.appendChild(this.descLabel),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={justifyContent:"center",marginTop:14,paddingLeft:11,paddingRight:11,height:36,width:"100%",borderRadius:100},this.appendChild(this.actionBtnContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:"100%",height:"100%",right:0,borderRadius:100,backgroundColor:"#FE3666"}),this.actionBtnContainer.appendChild(this.actionBtn)}setupData(){var t;ke(this.toastTag,"ksad_download_card_toast_icon_black.png"),this.downloadCountLabel.setText(this.vm.getAppDownloadCountDesc()),Li(this.downloadDescLabel,"text",null===(t=this.vm.$attrsPath.downloadCardDataInfo)||void 0===t?void 0:t.appDownloadDescText,""),Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)}))}setupActions(){let e=new S;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.downloadInfoContainer&&this.downloadInfoContainer.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK,e)})),this.descLabel&&this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn&&this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.toastView&&this.toastView.addEventListener("tap",(t=>{var e;We(null===(e=this.vm.downloadCardDataInfo)||void 0===e?void 0:e.toastText)})),this.vm.supportSlideClick()&&(this.downloadInfoContainer&&jt(this.downloadInfoContainer,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.descLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),jt(this.actionBtn,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}}class pl extends uh{constructor(t){var e;super(t),this.vm=t,this.cardStyle=null===(e=this.vm.downloadCardDataInfo)||void 0===e?void 0:e.style,this.setupViews(),this.setupActions(),this.vm.reportDownloadCardImpression()}addCardDynamic(t){this.cardContentView&&this.actionBtnAnimation&&(this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtnAnimation,this.styleAnimation):this.addCardDynamicEffects(t,this.actionBtnAnimation,this.styleAnimation))}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&(this.containerView?this.addCardDynamic(this.containerView):this.addCardDynamic(this.cardContentView))}stopActionAnimation(){this.pauseActionAnimation()}setupViews(){this.style={width:this.getWidth(),height:188,paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",paddingBottom:16},this.setupSubViews()}setupSubViews(){this.titleContentView=new ll(this.vm),this.titleContentView.style={top:0,position:"absolute"},this.appendChild(this.titleContentView),this.setupCardContent()}setupActions(){let e=new S;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&jt(this,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))}setupCardContent(){if(1==this.cardStyle)this.cardContentView=new dl(this.vm),this.appendChild(this.cardContentView),this.cardContentView.cardDynamicEffectsCallback=(t,e)=>{this.actionBtnAnimation=t,this.styleAnimation=e,this.addCardDynamic(this.cardContentView)};else{this.containerView=new TKView,this.containerView.style={width:"100%",height:124,bottom:16,borderRadius:8,position:"absolute"},this.appendChild(this.containerView);const t=new TKImage;t.style={width:"100%",height:"100%",borderRadius:8},ke(t,"ksad_outermost_bg_img.png"),this.containerView.appendChild(t),this.cardContentView=new cl(this.vm),this.containerView.appendChild(this.cardContentView),this.cardContentView.cardDynamicEffectsCallback=(t,e)=>{if(e.bottom=16,this.actionBtnAnimation=t,this.styleAnimation=e,1==this.vm.cardDynamicEffects){this.animationCardView=new TKView,this.animationCardView.style=e,this.insertBefore(this.animationCardView,this.containerView);const t=new TKImage;t.style={width:"100%",height:"100%",borderRadius:8},ke(t,"ksad_outermost_bg_img.png"),this.animationCardView.appendChild(t)}this.addCardDynamic(this.containerView)}}}getHeight(){return 188}getWidth(){return 0==this.vm.screenOrientation?this.vm.containerLimit.width:this.vm.containerLimit.height}}class ml{static createNormalBottomBarView(t,e){const i=t.getActionBarStyle();let n=null;if(t.isValidDownloadCardInfo()&&X(t.adInfo)&&t.downloadCardDataInfo.style)return n=new pl(t),n;switch(i){case 1:n=new tl(t);break;case 2:n=new el(t);break;case 3:n=new il(t);break;case 4:n=new nl(t);break;case 13:n=new sl(t);break;case 12:n=new al(t);break;case 14:case 15:0!=t.screenOrientation||X(t.adInfo)||(n=new hl(t))}return null==n&&e&&(n=e()),n}}class gl extends uh{constructor(t){super(t),this.stopAnimation=!1,this.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#FFFFFF"},this.setupSubviews(),this.addActions(),this.showShakeAnimation()}setupSubviews(){if(this.extraDisplayInfos=this.vm.getAdTagList(),this.hasTags=this.extraDisplayInfos&&this.extraDisplayInfos.length>0,this.hasScore=this.vm.getAppScore()>=30,this.logoView=new Ri(0,this.vm.adInfo),this.logoView.style={position:"absolute",bottom:30,right:30},this.appendChild(this.logoView),this.bottomContainer=new TKView,this.bottomContainer.style={height:"100%",width:"100%",paddingLeft:12,paddingRight:12,paddingTop:12,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:16,borderRadius:12},this.appendChild(this.bottomContainer),this.appIcon=new TKImage,this.appIcon.style={width:54,height:54,borderRadius:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),this.bottomContainer.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={marginTop:16,fontWeight:"medium",fontSize:20,height:30,color:"#222222",textLineClamp:1,textOverflow:"ellipsis",minimumTextScaleFactor:.5},this.bottomContainer.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={marginTop:16,textLineClamp:2,fontSize:14,color:"#666666",maxWidth:264,textAlign:"center",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),this.hasScore){const e=this.vm.getAppScore();this.scoreView=new na(e),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),this.scoreView.style={marginTop:13,width:75},this.bottomContainer.appendChild(this.scoreView)}this.hasTags&&(Ir.create({tagViewStyle:2}),this.tagView=new vr(this.extraDisplayInfos,Ir.create({tagViewStyle:2})),this.tagView.style={marginTop:13},this.bottomContainer.appendChild(this.tagView)),this.bottomContainer.appendChild(this.descLabel),this.actionBtn=new Ch(this.vm.adInfo,{borderRadius:24,height:48,width:264},(t=>{t.style={fontSize:16}})),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomContainer.appendChild(this.actionBtn)}addActions(){let e=new S;e.template_show_type="picture_template10",this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.scoreView&&this.scoreView.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_APP_STORE_CLICK,e)})),this.tagView&&this.tagView.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_RECOMMEND_REASON_CLICK,e)})),this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.nameLabel.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_ICON_NAME_CLICK,e)})),this.descLabel.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_ICON_COMMENT_CLICK,e)})),this.scoreView&&this.scoreView.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_APP_STORE_CLICK,e)})),this.tagView&&this.tagView.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_RECOMMEND_REASON_CLICK,e)})),this.actionBtn.setOnSwipeListener((i=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_OTHERAREA_CLICK,e)})))}showShakeAnimation(){this.stopAnimation||setTimeout((()=>{Wi(1e3,this.actionBtn,(()=>{this.showShakeAnimation()}))}),600)}stopActionAnimation(){this.stopAnimation=!0}getHeight(){return 120}onGetMiddleMarginBottom(t){return 0}}class ul extends uh{constructor(t){super(t),this.stopAnimation=!1,this.bottomCardHeight=120,this.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.setupSubviews(),this.addActions()}setupSubviews(){this.contentContainer=new TKView,this.contentContainer.style={position:"absolute",width:"100%",opacity:0,top:60,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.contentContainer),this.descLabel=new TKText,this.descLabel.style={marginTop:16,maxWidth:295,textLineClamp:2,fontSize:16,color:"#666666",textAlign:"center",textOverflow:"ellipsis"},this.contentContainer.appendChild(this.descLabel),Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription);let t=new TKView;t.style={width:"100%",height:88,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.contentContainer.appendChild(t),this.actionBtn=new Ch(this.vm.adInfo,{borderRadius:24,height:48,width:295},(t=>{t.style={fontSize:16}})),this.vm.isVerticalMaterial()||(this.actionBtn.style={marginTop:80},t.style={height:200}),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),t.appendChild(this.actionBtn)}addActions(){let e=new S;e.template_show_type="picture_template10",this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&(this.descLabel.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn.setOnSwipeListener((i=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_OTHERAREA_CLICK,e)})))}showActionBarAnim(){let t=new TKKeyframeAnimation;t.duration=800,t.timingFunction="EaseIn",t.setAnimations([()=>(this.contentContainer.style={opacity:1,top:0},1)]),this.contentContainer.addAnimation(t,"animationScale"),t.on("end",(()=>{this.showShakeAnimation()}))}showShakeAnimation(){this.stopAnimation||setTimeout((()=>{Wi(1e3,this.actionBtn,(()=>{this.showShakeAnimation()}))}),600)}stopActionAnimation(){this.stopAnimation=!0}getHeight(){return this.setHeightCallback&&(this.bottomCardHeight=this.setHeightCallback()),this.bottomCardHeight}}class wl extends TKView{constructor(t){super(),this.vm=t,this.setupViews()}setupViews(){this.style={height:88,marginHorizontal:16,marginBottom:16,backgroundColor:"#FFFFFF",borderRadius:12,paddingLeft:70,paddingRight:12,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},this.mTextAreaView=this.createTextAreaView(),this.appendChild(this.mTextAreaView),this.mActionBtn=this.createActionBtn(),this.vm.addClickConvert(this.mActionBtn,1,t.CARD_ACTION_BAR_CLICK),this.appendChild(this.mActionBtn),this.vm.addClickConvert(this,2,t.CARD_OTHERAREA_CLICK),this.appendChild(this.createLogoView())}createTextAreaView(){let e=new TKView;e.style={paddingHorizontal:8,flexBasis:141,flexGrow:1,flexShrink:1,flexDirection:"column",justifyContent:"space-between"};let i=new TKText;i.style={color:"#222222",fontSize:16,includeFontPadding:!1,marginBottom:8,fontWeight:"medium",textLineClamp:1,textOverflow:"ellipsis"},i.setText(this.vm.getAuthorName()),this.vm.addClickConvert(i,1,t.CARD_ICON_NAME_CLICK);let n=new TKText;return n.style={color:"#666666",fontWeight:"medium",includeFontPadding:!1,fontSize:14,textLineClamp:2,textOverflow:"ellipsis"},n.setText(this.vm.getLiveDesc()),this.vm.addClickConvert(n,1,t.CARD_ICON_COMMENT_CLICK),e.appendChild(i),e.appendChild(n),e}createActionBtn(){let t=new TKText;return t.style={width:102,height:36,borderRadius:18,backgroundColor:"#FE3666",color:"#FFFFFF",fontSize:14,textAlign:"center"},t.setText(this.vm.getActionBarBtnText()),t}createLogoView(){let t=new Ri(0,this.vm.adInfo,12);return t.style={position:"absolute",opacity:.4,bottom:6,right:6},t}}class Cl extends TKView{constructor(t){super(),this.cardMargin=16,this.cardHeight=207,this.vm=t,this.setupViews()}setupViews(){this.style={height:this.getTotalHeight(),width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",position:"absolute"},this.appendChild(this.createCardView())}getTotalHeight(){return this.cardHeight+this.cardMargin}getCardWidth(){return 0==this.vm.screenOrientation?this.vm.getScreenWidthDp()-2*this.cardMargin:343}getCardTop(){return 223}createCardView(){let e=new TKView,i=this.getCardWidth();e.style={height:this.cardHeight,width:i,flexDirection:"column",backgroundColor:"#FFFFFF",borderRadius:12,padding:2};let n=new TKView;n.style={width:"100%",height:"100%",gradientBgColor:"90,#FFFFFF00,FE36660D"},e.appendChild(n),e.appendChild(this.createTextArea()),e.appendChild(this.createActionBtn());let s=new TKImage;return ke(s,"icon_ksad_live_author_card_close.png"),s.style={width:24,height:24,position:"absolute",top:8,right:8},s.addEventListener("tap",(t=>{this.authorCloseClickCallback&&this.authorCloseClickCallback()})),e.appendChild(s),this.vm.addClickConvert(e,2,t.GUIDE_ENTER_LIVE_CLICK,null,{click_area:2}),e}createTextArea(){let t=new TKView;t.style={width:"100%",position:"absolute",top:49,alignSelf:"center"};let e=new TKText;e.style={height:28,marginHorizontal:15,color:"#222222",alignSelf:"center",fontSize:16,fontWeight:"medium",textLineClamp:1,marginBottom:6,textOverflow:"ellipsis",textAlign:"center"},e.setText(this.vm.getAuthorName());let i=new TKText;return i.style={color:"#222222",alignSelf:"center",fontSize:16,textLineClamp:2,marginHorizontal:46,textOverflow:"ellipsis",textAlign:"center"},i.setText(this.vm.getLiveStatDataDesc()),t.appendChild(e),t.appendChild(i),t}createActionBtn(){let e=new TKView;e.style={width:256,height:46,flexDirection:"row",justifyContent:"center",alignItems:"center",borderRadius:23,backgroundColor:"#FE3666",position:"absolute",bottom:16,alignSelf:"center"};let i=new TKImage;i.style={width:13,height:13,marginRight:6},ke(i,"icon_ksad_live_wave.png");let n=new TKText;return n.style={color:"#FFFFFF",fontSize:16},n.setText(this.vm.getAdActionDesc()),e.appendChild(i),e.appendChild(n),this.vm.addClickConvert(e,1,t.CARD_ACTION_BAR_CLICK,(()=>{this.vm.logElementClick(209,{click_area:1})})),e}}class fl extends TKView{constructor(t,e){super(),this.listData=new Array,this.vm=t,this.livePlayerVM=e,Pe.supportMinimumTKVersion("5.0.0")&&(this.setupViews(),this.initData())}initData(){this.bindListData(null),Di(this.livePlayerVM,this.livePlayerVM.$attrsPath.currentProductInfo,(t=>{be(t)||this.bindListData(t)})),Di(this.livePlayerVM,this.livePlayerVM.$attrsPath.shopCardChangeType,(t=>{be(t)||3!=t&&1!=t||this.listFirstIsCurrent()&&this.productListView.removeItem(0)}))}bindListData(t){if(console.log("jky bindListData:"),0==this.listData.length){this.createListData(t);let e=JSON.stringify(this.listData);this.productListView.updateList(e)}else if(!be(t)){let e=this.listData.length<=3,i=new Tl(e?yl.CURRENT_PRODUCT_WITH_DETAIL:yl.CURRENT_PRODUCT,this.vm,t);if(this.listData[0]=i,this.listFirstIsCurrent()){let t=this;this.productListView.removeItem(0),this.productListView.insertItem(JSON.stringify(i),0),this.transXList(-50,(()=>{t.transXList(0)}))}else this.productListView.insertItem(JSON.stringify(i),0)}}listFirstIsCurrent(){if(null==this.listData||0==this.listData.length)return!1;let t=this.listData[0].itemType;return t==yl.CURRENT_PRODUCT||t==yl.CURRENT_PRODUCT_WITH_DETAIL}transXList(t,e){let i=new TKBasicAnimation;i.setEndValue((()=>{this.productListView.style={transform:{translate:{x:t}}}})),i.duration=500,i.timingFunction="ease-out",i.on("end",e),this.productListView.addAnimation(i,"transXAnim")}createListData(t){let e=this.vm.getProductInfoList();if(be(e))return;let i=e.length,n=i<=2;be(t)||this.listData.push(new Tl(n?yl.CURRENT_PRODUCT_WITH_DETAIL:yl.CURRENT_PRODUCT,this.vm,t));for(let a=0;a<i;a++){let t=e[a];this.listData.push(new Tl(n?yl.NORMAL_PRODUCT_WITH_DETAIL:yl.NORMAL_PRODUCT,this.vm,t))}let s=new Tl(yl.SEE_MORE,this.vm);this.listData.push(s)}setupViews(){this.style={height:100,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"flex-start"},this.createNativeListView()}createNativeListView(){Pe.supportMinimumTKVersion("5.0.0")&&(this.productListView=new TKLiveProductListView,this.productListView.style={width:"100%",height:100,flexBasis:239,flexGrow:1,flexShrink:1},this.productListView.setOnScrollListener((()=>{this.vm.convert(1,2,{x:0,y:0},t.GOODS_ITEM_CARD_SLIDE_CLICK)})),this.productListView.setOnItemClickListener((e=>{let i=this.getItemIdByPosition(e);this.vm.convert(1,2,{x:0,y:0},t.GOODS_ITEM_CARD_CLICK,{item_id:i},null,{liveItemId:i})})),this.appendChild(this.productListView))}getItemIdByPosition(t){if(be(this.listData))return"";if(t>=0&&t<this.listData.length){return this.listData[t].itemId}return""}}var yl;!function(t){t[t.CURRENT_PRODUCT=1]="CURRENT_PRODUCT",t[t.NORMAL_PRODUCT=2]="NORMAL_PRODUCT",t[t.CURRENT_PRODUCT_WITH_DETAIL=3]="CURRENT_PRODUCT_WITH_DETAIL",t[t.NORMAL_PRODUCT_WITH_DETAIL=4]="NORMAL_PRODUCT_WITH_DETAIL",t[t.SEE_MORE=5]="SEE_MORE"}(yl||(yl={}));class Tl{constructor(t,e,i){this.itemType=t,t==yl.SEE_MORE?this.imgUrl=Fe("icon_ksad_product_see_more.png"):(this.productName=null==i?void 0:i.title,this.productDesc=null==i?void 0:i.serviceType,this.productPrice=null==i?void 0:i.price,this.imgUrl=null==i?void 0:i.imageUrl,this.itemId=null==i?void 0:i.itemId,be(this.productDesc)&&(this.productDesc=e.getLiveCartItemServiceDesc()),!be(this.productPrice)&&this.productPrice.startsWith("¥")&&(this.productPrice=this.productPrice.replace("¥","")))}}class Il extends TKView{constructor(t,e){super(),this.cardHeight=144,this.productInfoCardWidth=100,this.hadShowProductList=!1,this.hideAnimDuration=500,this.vm=t,this.livePlayerVM=e,Di(this.livePlayerVM,this.livePlayerVM.$attrsPath.currentPlaybackTime,(t=>{this.onUpdateProgress(1e3*t)})),this.needShowProductList=this.vm.needShowProductList(),this.productListShowTime=this.vm.getProductListAppearanceDelayTime(),this.setupViews()}setupViews(){this.style={height:this.cardHeight,marginLeft:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center"};let e=this.vm.getScreenWidthDp();this.listTransX=e-116,this.appendChild(this.createLiveMessages()),this.currentProductCard=this.createCurrentProductCard(),this.appendChild(this.currentProductCard),this.needShowProductList&&(this.productListCard=new fl(this.vm,this.livePlayerVM),this.productListCard.style={opacity:0,position:"absolute",bottom:0,right:0-this.listTransX},this.appendChild(this.productListCard)),this.updateCurrentProduct(this.livePlayerVM.currentProductInfo),Di(this.livePlayerVM,this.livePlayerVM.$attrsPath.currentProductInfo,(t=>{console.log("jky update currentProductInfo: "+t),this.updateCurrentProduct(t)})),this.vm.addClickConvert(this,2,t.CARD_OTHERAREA_CLICK)}onUpdateProgress(t){if(this.needShowProductList&&!this.hadShowProductList&&this.productListCard&&t>=this.productListShowTime){this.hadShowProductList=!0,this.showProductList(),this.hideLiveRoom();let t=this.vm.getProductItemIdList();be(this.livePlayerVM.currentProductInfo)||(t=[this.livePlayerVM.currentProductInfo.itemId].concat(t)),console.log("jky showProductList productItems: "+JSON.stringify(t)),this.vm.logElementImpression(208,{item_id_list:JSON.stringify(t)})}}hideLiveRoom(){let t=new TKBasicAnimation;t.setEndValue((()=>{this.currentProductCard.style={opacity:0,transform:{translate:{y:44}}}})),t.duration=this.hideAnimDuration,t.timingFunction="EaseOut";let e=new TKBasicAnimation;e.setEndValue((()=>{this.liveMessageView.style={opacity:0}})),e.duration=this.hideAnimDuration,e.timingFunction="EaseOut",this.currentProductCard.addAnimation(t,"hideCurrentProduct"),this.liveMessageView.addAnimation(e,"hideLiveMessage")}showProductList(){let t=new TKKeyframeAnimation;t.duration=1e3,t.timingFunction="EaseOut",t.setAnimations([()=>(this.productListCard.style={opacity:1},.5),()=>(this.productListCard.style={transform:{translate:{x:0-this.listTransX}}},.5)]),t.on("end",(()=>{this.productListShowAnimCallback&&this.productListShowAnimCallback()})),this.productListCard.addAnimation(t,"showList")}createLiveMessages(){let e=new TKView;e.style={height:"100%",flexBasis:239,flexGrow:1,flexShrink:1};let i=new TKView;i.style={height:"100%",width:"100%"},this.vm.addClickConvert(i,2,t.ACTIONBAR_ICON_COMMENT_CLICK),Pe.supportMinimumTKVersion("5.0.0")&&(this.tmpLiveView=new TkLiveMessage,this.tmpLiveView.enabled=!1,this.tmpLiveView.style={height:"100%",width:"100%",position:"absolute",left:0,top:0,right:0},e.appendChild(this.tmpLiveView)),e.appendChild(i);const n=this;return Di(this.livePlayerVM,this.livePlayerVM.$attrsPath.liveMessage,(t=>{!be(t)&&n.tmpLiveView&&n.tmpLiveView.addLiveMessage(t)})),this.liveMessageView=e,this.liveMessageView}updateCurrentProduct(t){be(t)?this.currentProductCard.setVisibility("hidden"):(this.currentProductCard.setVisibility("visible"),this.currentProductImg.setSrc(t.imageUrl),this.currentProductTitleView.setText(t.title),this.currentProductPriceView.setText(t.price)),this.layout()}createCurrentProductCard(){let e=new TKView,i=this.productInfoCardWidth;e.style={width:i,height:"100%",backgroundColor:"#FFFFFF",borderRadius:4,marginRight:16,marginLeft:5,flexGrow:0,flexShrink:0,flexDirection:"column",justifyContent:"flex-end",alignItems:"center"},this.currentProductImg=new TKImage,this.currentProductImg.style={borderRadius:4,width:i-2,height:i-2,alignSelf:"center",top:0,position:"absolute"},this.currentProductTitleView=new TKText,this.currentProductTitleView.style={color:"#666666",marginHorizontal:8,marginTop:1,fontSize:12,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"};let n=function(){let t=new TKView;t.style={width:42,height:14,backgroundColor:"#00000033",bottomRightRadius:4,topLeftRadius:4,flexDirection:"row",justifyContent:"center",alignItems:"center"};let e=new TKImage;e.style={width:8,height:8,marginRight:3};let i=new TKText;return i.style={color:"#FFFFFF",fontSize:8,textAlign:"center"},i.setText("讲解中"),ke(e,"icon_ksad_live_current_label.png"),t.appendChild(e),t.appendChild(i),t}();return n.style={position:"absolute",left:1,top:2},e.appendChild(this.currentProductImg),e.appendChild(this.currentProductTitleView),e.appendChild(this.createPriceLabelView()),e.appendChild(n),this.vm.addClickConvert(e,2,t.ACTIONBAR_ICON_CLICK),e}createPriceLabelView(){let t=new TKView;t.style={width:this.productInfoCardWidth-2,height:20,backgroundColor:"#FE3666",borderRadius:4,marginTop:4,marginBottom:1,alignSelf:"center",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingLeft:4,paddingRight:8};let e=new TKView;e.style={width:1,height:12,backgroundColor:"#FFFFFF90",position:"absolute",right:28,alignSelf:"center"};let i=new TKView;i.style={flexDirection:"row",alignItems:"flex-end"};let n=new TKText;n.style={fontSize:8,color:"#FFFFFF",paddingBottom:1},n.setText("¥"),i.appendChild(n),this.currentProductPriceView=new TKText,this.currentProductPriceView.style={color:"#FFFFFF",fontSize:13,includeFontPadding:!1},i.appendChild(this.currentProductPriceView);let s=new TKImage;return s.style={width:14,height:14},ke(s,"icon_ksad_live_grab.png"),t.appendChild(i),t.appendChild(e),t.appendChild(s),t}}class vl extends uh{constructor(t,e){super(t),this.iconAreaWidth=62,this.iconAreaHeight=66,this.iconAreaLeft=24,this.iconAreaBottom=27,this.authorCardShowTime=0,this.authorCardStayTime=5e3,this.showAuthorCardDuration=500,this.isAuthorCardShowCalled=!1,this.isAuthorCardHideCalled=!1,this.liveBottomVM=t,this.livePlayerVM=e,Di(this.livePlayerVM,this.livePlayerVM.$attrsPath.currentPlaybackTime,(t=>{this.onUpdateProgress(1e3*t)})),this.initData(),this.setupViews()}getHeight(){return this.liveBottomVM.needShowLiveCartCustomerData()?330:270}onUpdateProgress(t){if(t>=this.authorCardShowTime&&!this.isAuthorCardShowCalled&&this.authorCardShowTime>0&&this.needShowAuthorCard&&!be(this.authorInfoCard)){this.isAuthorCardShowCalled=!0,this.authorInfoCard.setVisibility("visible"),this.showAuthorInfoCard((()=>{let t=this.liveBottomVM.getLiveroomGuideMsgType();this.liveBottomVM.logElementImpression(209,{is_valid_returned:t})}));let t=(this.liveBottomVM.getScreenWidthDp()-this.iconAreaWidth)/2-this.iconAreaLeft,e=this.authorInfoCard.getTotalHeight()-this.iconAreaHeight/2-this.iconAreaBottom;this.moveIconAnim(t,e)}!this.isAuthorCardHideCalled&&t>=this.authorCardShowTime+this.authorCardStayTime+this.showAuthorCardDuration&&this.resetAuthorInfo()}resetAuthorInfo(){this.authorInfoCard&&(this.isAuthorCardHideCalled=!0,this.hideAuthorInfoCard(),this.moveIconAnim(0,0))}initData(){this.needShowAuthorCard=this.liveBottomVM.needShowAuthorInfoCard(),this.authorCardStayTime=this.liveBottomVM.getCardStayTimeMS(),this.authorCardShowTime=this.liveBottomVM.getCardAppearanceDelayTime()}setupViews(){this.style={width:this.liveBottomVM.isScreenPortrait()?"100%":375,height:this.getHeight(),flexDirection:"column",justifyContent:"flex-end"};let e=this.liveBottomVM.getAuthorIconUrl();this.mIconAreaView=function(t,e,i){let n=new TKView;n.style={height:i,width:e};let s=new TKView;s.style={width:e,height:e,borderWidth:1,backgroundColor:"#FFFFFF",borderColor:"#FE3666",borderRadius:e/2,flexDirection:"column",justifyContent:"center",alignItems:"center"};let a=e-6,o=new TKImage;o.style={width:a,height:a,alignSelf:"center",borderRadius:a/2},o.setSrc(t),s.appendChild(o);let r=new TKText;return r.style={width:46,height:16,backgroundColor:"#FE3666",borderRadius:23,fontSize:9,includeFontPadding:!1,color:"#FFFFFF",textAlign:"center",position:"absolute",bottom:0,alignSelf:"center"},r.setText("直播中"),n.appendChild(s),n.appendChild(r),n}(e,this.iconAreaWidth,this.iconAreaHeight),this.mIconAreaView.style={position:"absolute",left:this.iconAreaLeft,bottom:this.iconAreaBottom},this.liveBottomVM.addClickConvert(this.mIconAreaView,1,t.CARD_ICON_CLICK),this.liveRoomCard=new TKView,this.liveRoomCard.style={width:"100%",flexDirection:"column",justifyContent:"space-between",position:"absolute",bottom:0};let i=this.liveBottomVM.getLiveCartCustomerData();if(!be(i)){let e=1e3,n=0==this.liveBottomVM.screenOrientation,s=this.liveBottomVM.tradeCustomerViewWidth,a=n?s+16:26;this.mTradeCustomerView=bh(i,s,e+300),this.mTradeCustomerView.style={marginLeft:16,marginBottom:10,left:0-a,opacity:n?1:0},this.liveRoomCard.appendChild(this.mTradeCustomerView),this.liveBottomVM.addClickConvert(this.mTradeCustomerView,2,t.ITEM_HOT_BUY_STYLE_CLICK),setTimeout((()=>{this.showTradeCustomer(a),this.liveBottomVM.logElementImpression(210,null)}),e)}this.productInfoCard=new Il(this.liveBottomVM,this.livePlayerVM),this.mTradeCustomerView&&(this.productInfoCard.productListShowAnimCallback=()=>{this.moveDownTradeCustomerView()}),this.liveRoomCard.appendChild(this.productInfoCard),this.actionBar=new wl(this.liveBottomVM),this.actionBar.style={marginTop:12},this.liveRoomCard.appendChild(this.actionBar),this.appendChild(this.liveRoomCard),this.needShowAuthorCard&&(this.authorInfoCard=new Cl(this.liveBottomVM),this.authorInfoCard.style={opacity:0},this.authorInfoCard.setVisibility("hidden"),this.authorInfoCard.authorCloseClickCallback=()=>{this.resetAuthorInfo(),this.liveBottomVM.logElementClick(69)},this.appendChild(this.authorInfoCard)),this.appendChild(this.mIconAreaView),this.liveBottomVM.addClickConvert(this,2,t.CARD_OTHERAREA_CLICK)}showTradeCustomer(t){let e=new TKBasicAnimation;e.duration=300,e.timingFunction="ease-out",e.setEndValue((()=>{this.mTradeCustomerView.style={opacity:1,transform:{translate:{x:t}}}})),this.mTradeCustomerView.addAnimation(e,"transXShow")}moveIconAnim(t,e){let i=new TKBasicAnimation;i.setEndValue((()=>{this.mIconAreaView.style={transform:{translate:{y:0-e,x:t}}}})),i.timingFunction="EaseOut",i.duration=this.showAuthorCardDuration,this.mIconAreaView.addAnimation(i,"show")}showAuthorInfoCard(t){if(!this.authorInfoCard)return;let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.authorInfoCard.style={opacity:0},.3),()=>(this.authorInfoCard.style={opacity:1},1)]),e.on("end",t),e.timingFunction="EaseOut",e.duration=this.showAuthorCardDuration,this.authorInfoCard.addAnimation(e,"show")}hideAuthorInfoCard(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.authorInfoCard.style={opacity:0},.7),()=>(this.authorInfoCard.style={opacity:0},1)]),t.duration=this.showAuthorCardDuration,t.timingFunction="EaseOut",t.on("end",(()=>{this.authorInfoCard.setVisibility("hidden")})),this.authorInfoCard.addAnimation(t,"show")}moveDownTradeCustomerView(){let t=new TKBasicAnimation;t.setEndValue((()=>{this.mTradeCustomerView.style={transform:{translate:{y:44}}}})),t.duration=500,t.timingFunction="EaseOut",this.mTradeCustomerView.addAnimation(t,"transY")}onGetMiddleMarginBottom(t){return t?super.onGetMiddleMarginBottom(t):108}}class Vl extends uh{constructor(t){super(t),this.liveBottomVM=t,this.setupViews()}getHeight(){return this.liveBottomVM.needShowLiveCartCustomerData()?244:184}setupViews(){let e=this.vm.isScreenPortrait();this.style={width:e?"100%":375,height:this.getHeight(),flexDirection:"column",justifyContent:"flex-end"};let i=this.liveBottomVM.getLiveCartCustomerData();if(!be(i)){let n=1e3,s=this.liveBottomVM.tradeCustomerViewWidth,a=e?s+16:26,o=bh(i,s,n+300);o.style={marginLeft:16,marginBottom:10,left:0-a,opacity:e?1:0},this.appendChild(o),setTimeout((()=>{this.showTradeCustomer(o,a),this.liveBottomVM.logElementImpression(210,null)}),n),this.liveBottomVM.addClickConvert(o,2,t.ITEM_HOT_BUY_STYLE_CLICK)}this.appendChild(this.createLiveLabelView()),this.appendChild(this.createCardView()),this.liveBottomVM.addClickConvert(this,2,t.CARD_OTHERAREA_CLICK)}showTradeCustomer(t,e){let i=new TKBasicAnimation;i.duration=300,i.timingFunction="ease-out",i.setEndValue((()=>{t.style={opacity:1,transform:{translate:{x:e}}}})),t.addAnimation(i,"transXShow")}createLiveLabelView(){let t=new TKView;t.style={height:28,width:58,marginLeft:16,alignSelf:"flex-start"};let e=new TKImage;e.style={position:"absolute",width:"100%",height:"100%"},ke(e,"ksad_icon_live_author_label.png");let i=new TKText;return i.style={height:23,width:"100%",textAlign:"center",fontSize:12,color:"#FFFFFF"},i.setText("直播中"),t.appendChild(e),t.appendChild(i),t}createCardView(){let e=new TKView;e.style={height:150,width:"100%",paddingHorizontal:16,paddingTop:7,gradientBgColor:"270,00000000, 00000080",flexDirection:"column",justifyContent:"flex-start",alignItems:"center"};let i=new TKView;i.style={width:"100%",height:62,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"};let n=this.createAuthorIconView();i.appendChild(n),this.liveBottomVM.addClickConvert(n,1,t.CARD_ICON_CLICK);let s=new TKView;s.style={paddingVertical:7,height:"100%",flexGrow:1,marginLeft:8,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",flexShrink:1};let a=new TKText;a.style={width:"100%",color:"#FFFFFF",fontSize:16,textLineClamp:1,fontWeight:"medium",textOverflow:"ellipsis"},this.liveBottomVM.addClickConvert(a,1,t.CARD_ICON_NAME_CLICK);let o=new TKText;o.style={width:"100%",color:"#FFFFFF",fontSize:14,textLineClamp:1,flexGrow:1,flexShrink:1,textOverflow:"ellipsis"},this.liveBottomVM.addClickConvert(a,1,t.CARD_ICON_COMMENT_CLICK);let r=new Ri(3,this.liveBottomVM.adInfo,16);r.style={height:16,marginLeft:4};let h=new TKView;h.style={height:20,width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},h.appendChild(o),h.appendChild(r),s.appendChild(a),s.appendChild(h),a.setText(this.liveBottomVM.getAuthorName()),o.setText(this.liveBottomVM.getAdDescription()),i.appendChild(s);let l=new TKText;return l.style={backgroundColor:"#FE3666",color:"#FFFFFF",height:48,marginTop:8,width:"100%",textAlign:"center",borderRadius:24},l.setText(this.liveBottomVM.getActionBarBtnText()),e.appendChild(i),e.appendChild(l),e}createAuthorIconView(){let t=new TKView;t.style={borderColor:"#FE3666",borderWidth:1,width:62,height:62,borderRadius:31,flexDirection:"column",justifyContent:"center",alignItems:"center"};let e=new TKImage;return e.style={width:56,height:56,borderRadius:28,alignSelf:"center"},e.setSrc(this.liveBottomVM.getAuthorIconUrl()),t.appendChild(e),t}}class Al extends uh{constructor(t){super(t),this.cardDelayShowTime=5,this.extraDisplayInfos=this.vm.getAdTagList(),this.hasTags=this.extraDisplayInfos&&this.extraDisplayInfos.length>0;const e=1==this.vm.screenOrientation;this.style={width:Pe.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16,bottom:0},e&&(this.style={width:this.vm.containerLimit.height+20}),this.cardHeight=136+(this.hasTags?16:0),this.setupCardStyle(),this.actionCover=new TKView,this.actionCover.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.bottomBtnContainer.appendChild(this.actionCover),this.addActions()}setupCardStyle(){this.logoView=new Ri(1,this.vm.adInfo),this.logoView.style={marginBottom:10},this.appendChild(this.logoView),this.bottomContainer=new TKView,this.bottomContainer.style={backgroundColor:"#FFFFFF",height:this.cardHeight,width:"100%",paddingLeft:12,paddingRight:12,paddingTop:12,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,borderRadius:12},this.appendChild(this.bottomContainer);const e=new TKView;e.style={flexDirection:"row",width:"100%",position:"relative"},this.bottomContainer.appendChild(e);const i=new TKView;if(i.style={height:58,paddingLeft:70,flexGrow:1,flexDirection:"column",justifyContent:"space-around"},e.appendChild(i),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),e.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={fontSize:16,fontWeight:"medium",color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},i.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Li(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),this.hasTags){const t=new TKView;t.style={flexDirection:"row",width:"100%",height:18,marginTop:6,position:"relative"},i.appendChild(t),this.tagView=new vr(this.extraDisplayInfos,Ir.create({tagViewStyle:0,height:18,tagBorderRadius:2,tagFontSize:10})),t.appendChild(this.tagView),this.descLabel.style={marginTop:8,marginBottom:8},this.bottomContainer.appendChild(this.descLabel)}else i.appendChild(this.descLabel);this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={flexDirection:"column",justifyContent:"center",width:"100%",height:40,marginBottom:12,alignItems:"center"},this.bottomContainer.appendChild(this.bottomBtnContainer),this.actionBtn=new Ch(this.vm.adInfo,{width:"100%",height:40,borderRadius:22}),_i(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),_i(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomBtnContainer.appendChild(this.actionBtn)}addActions(){let e=new S;e.template_show_type="picture_template9",this.appIcon&&this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.actionCover.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.bottomContainer.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_BLANK_AREA_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon&&this.appIcon.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.nameLabel.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.actionCover.addEventListener("swipe",(i=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.bottomContainer.addEventListener("swipe",(i=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}getHeight(){return this.cardHeight+16+10+16}}class bl extends TKView{constructor(t){super(),this.hasExposured=!1,this.width=0,this.vm=t,this.setupViews(),this.setupActions(),this.hasExposured||(this.hasExposured=!0,this.vm.impressionReport(19,"coupon_card"))}setupViews(){this.width=this.vm.callerContext.containerLimit.width;let t=Pe.isAndroid();this.style={height:168,width:"100%",alignSelf:"center",paddingTop:4,paddingLeft:11,paddingRight:11,marginBottom:12},this.couponShopContainer=new TKView,this.couponShopContainer.style={width:"100%",height:32,flexDirection:"row"},this.appendChild(this.couponShopContainer),this.couponShopImage=new TKImage,this.couponShopImage.style={width:32,height:32,borderRadius:8},ke(this.couponShopImage,this.vm.getShopImage()),this.couponShopContainer.appendChild(this.couponShopImage),this.couponShopName=new TKText,this.couponShopName.style={width:280,height:23,maxWidth:this.width-62,fontWeight:"500",color:"#FFFFFF",fontSize:17,textAlign:"left",textLineClamp:1,textOverflow:"ellipsis",alignSelf:"center",textLineHeightClamp:23,marginLeft:8,textShadow:"1 1 1 #00000033"},this.couponShopName.setText(this.vm.getShopName()),this.couponShopContainer.appendChild(this.couponShopName),this.couponBackgroundContainer=new TKView,this.couponBackgroundContainer.style={height:44+this.adaptedSize(),width:this.width-22,borderRadius:8,marginTop:8,paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:8,backgroundColor:"#222222CC",flexDirection:"column",alignItems:"center"},this.appendChild(this.couponBackgroundContainer),this.couponTitleContainer=new TKView,this.couponTitleContainer.style={height:20,width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.couponBackgroundContainer.appendChild(this.couponTitleContainer),this.couponTitleText=new TKText,this.couponTitleText.style={width:"auto",height:20,maxWidth:this.width-104,fontWeight:"400",color:"#FFFFFF",fontSize:t?15:14,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22},this.couponTitleText.setText(this.vm.getCouponTitle()),this.couponTitleContainer.appendChild(this.couponTitleText),this.logoView=new Ri(3,this.vm.callerContext.adInfo),this.couponTitleContainer.appendChild(this.logoView),this.couponSecondaryContainer=new TKView,this.couponSecondaryContainer.style={width:this.width-38,height:this.adaptedSize(),top:8,flexDirection:"row",justifyContent:"space-between"},this.couponBackgroundContainer.appendChild(this.couponSecondaryContainer),this.couponSecondaryBackground=new TKImage,this.couponSecondaryBackground.style={width:this.width-38,height:this.adaptedSize(),borderRadius:6,top:0,position:"absolute"},ke(this.couponSecondaryBackground,"live_coupon_bottombar_background.png"),this.couponSecondaryContainer.appendChild(this.couponSecondaryBackground),this.couponMessageContainer=new TKView,this.couponMessageContainer.style={width:"100%",height:43,alignSelf:"center",flexDirection:"row"},this.couponSecondaryContainer.appendChild(this.couponMessageContainer),this.couponAmountContainer=new TKView,this.couponAmountContainer.style={width:92,height:43,flexDirection:"row",justifyContent:"center"},this.couponMessageContainer.appendChild(this.couponAmountContainer);let e=this.vm.getNumberStringDigits(this.vm.getCouponAmount().toString());this.couponAmountSymbol=new TKText,this.couponAmountSymbol.style={width:14,height:e>3?30:36,top:7,fontWeight:t?"400":"500",fontStyle:"normal",color:"#5F1C00",fontSize:21,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22},this.couponAmountSymbol.setText("¥"),this.couponAmountContainer.appendChild(this.couponAmountSymbol),this.couponAmountNum=new TKText,this.couponAmountNum.style={width:"auto",height:43,maxWidth:78,fontWeight:t?"400":"medium",fontStyle:"normal",color:"#5F1C00",fontSize:e>3?26:36,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:36},this.couponAmountNum.setText(this.vm.getCouponAmount().toString()),this.couponAmountContainer.appendChild(this.couponAmountNum),this.couponTextContainer=new TKView,this.couponTextContainer.style={height:43,width:this.width-104*(this.width-38)/376-130,flexDirection:"column",alignItems:"center"},this.couponMessageContainer.appendChild(this.couponTextContainer),this.couponConditionNum=new TKText,this.couponConditionNum.style={width:"100%",height:21,top:3,fontWeight:t?"400":"500",fontStyle:"normal",color:"#5F1C00",fontSize:15,textAlign:"left",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22},this.couponConditionNum.setText(this.vm.getCouponCondition()),this.couponTextContainer.appendChild(this.couponConditionNum),this.couponCouponExpireTime=new TKText,this.couponCouponExpireTime.style={width:"100%",height:15,top:5,fontWeight:"400",fontStyle:"normal",color:"#A99187",fontSize:11,textAlign:"left",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:10},this.couponCouponExpireTime.setText(this.vm.getCouponExpireTime()),this.couponTextContainer.appendChild(this.couponCouponExpireTime),this.couponActionDescText=new TKText,this.couponActionDescText.style={width:104*(this.width-38)/376,height:43,fontWeight:t?"400":"500",fontStyle:"normal",color:"#5F1C00",fontSize:15,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:24},this.couponActionDescText.setText(this.vm.getCouponActionDesc()),this.couponMessageContainer.appendChild(this.couponActionDescText)}setupActions(){let e=new S;e.template_show_type="coupon_card",this.couponShopImage&&this.couponShopImage.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.couponShopName&&this.couponShopName.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.couponActionDescText&&this.couponActionDescText.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&jt(this,(()=>{this.vm.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))}getHeight(){return 180}adaptedSize(){return 80*(this.width-38)/376}}class Sl extends uh{constructor(t,e,i){super(t),this.cardHeight=324,this.liveBottomVM=t,this.livePlayerVM=e,this.liveCouponVm=i,this.setupViews()}setupViews(){this.style={width:"100%",height:this.cardHeight,flexDirection:"column",justifyContent:"flex-end"},this.productInfoCard=new Il(this.liveBottomVM,this.livePlayerVM),this.appendChild(this.productInfoCard),this.liveCouponBottomCard=new bl(this.liveCouponVm),this.appendChild(this.liveCouponBottomCard)}getHeight(){return this.cardHeight}}class xl extends uh{constructor(t,e){super(t),this.cardHeight=180,this.vm=t,this.liveCouponVm=e,this.setupViews()}setupViews(){this.style={width:"100%",height:this.cardHeight,flexDirection:"column",justifyContent:"flex-end"},this.liveCouponBottomCard=new bl(this.liveCouponVm),this.appendChild(this.liveCouponBottomCard)}getHeight(){return this.cardHeight}}class Ll{static initializeBottomBar(t,e){const i={position:"absolute",bottom:0,left:t.getSideMargin(),right:t.getSideMargin()};let n;if(t instanceof er&&(n=this.getVideoBottomCard(t,i)),t instanceof hh&&(n=this.getImageBottomCard(t,i)),t instanceof gh&&(n=this.getLiveBottomCard(t,i,e)),!n){n=new fh(t.bottomBarVM);let e=n.getHeight();i.height=e}return e.style=i,e.appendChild(n),n}static getVideoBottomCard(t,e){e.bottom=0,e.left=t.getSideMargin(),e.right=t.getSideMargin();const i=t.bottomBarVM;let n;if(t.callerContext.componentSwtich){let e=R(t.callerContext.adInfo,"bottom-card-fade",2);e&&(i.componentData=e,n=new el(i));let s=R(t.callerContext.adInfo,"bottom-card-reservation",2);!n&&s&&(i.componentData=s,n=new qh(i));let a=R(t.callerContext.adInfo,"bottom-card-follow",2);!n&&a&&(i.componentData=a,n=new Rh(i));let o=R(t.callerContext.adInfo,"bottom-card-live-cut",2);!n&&o&&(i.componentData=o,n=new kh(i)),n&&this.reportBottomBarImpression(t.callerContext.adInfo,i.componentData)}else{let s=i.getNeoActionBarCardType();if(console.log("jky tkloadcontroller setup bottom neoActionBarCardType: "+s),t.liveCouponVM.isLiveCouponBottomCardEnable())n=new xl(i,t.liveCouponVM);else if(s==_.LIVE_CUT3_STYLE1&&0==t.screenOrientation)n=vh.newInstance(i);else if(s==_.LIVE_CUT3_STYLE2&&0==t.screenOrientation)n=Lh.newInstance(i);else if(i.isShortLive())n=new kh(i);else if(Pe.supportMinimumVersion("3.3.26","3.3.30")&&i.isEcFollow()){switch(i.getShortVideoFollowPlaycardStyle()){case 1:console.log("tkloadcontroller 2"),n=new Rh(i);break;case 2:console.log("tkloadcontroller 3"),0==t.screenOrientation&&(n=new Bh(i));break;case 3:console.log("tkloadcontroller 4"),n=new Kh(i);break;case 4:console.log("tkloadcontroller 5"),0==t.screenOrientation&&(n=new Oh(i))}}else if(i.isDeepVideoStyle()){n=new jh(i)}else i.isECOrderAd()?(console.log("tkloadcontroller 6"),n=new Yh(i)):t.isClickReward()?n=new Xh(i):i.isCommercialProductStyle()?(console.log("tkloadcontroller 7"),n=new Jh(i,t.containerLimit.width-2*t.getSideMargin())):i.isAdForLive()?Pe.supportMinimumVersion("3.3.19","3.3.26")&&!Pe.supportMinimumVersion("3.3.22","3.3.29")?(console.log("tkloadcontroller 9"),n=new $h(i)):n=new kh(i):i.isLiveSubscribe()?n=new qh(i):t.halfPlayerVM.shouldShowHalfPlayer()&&(n=new Qh(t.halfPlayerVM),1==t.screenOrientation&&(e.left=t.containerLimit.width/2+t.getSideMargin()));n||(n=ml.createNormalBottomBarView(i,(()=>new fh(i))))}if(n){let t=n.getHeight();e.height=t}return n}static getImageBottomCard(t,e){const i=t.bottomBarVM,n=i.getActionBarStyle(),s=1==t.screenOrientation;let a;if(t.callerContext.componentSwtich){let n=R(t.callerContext.adInfo,"bottom-card-pic-hand",2);if(!a&&n)if(i.componentData=n,s)a=new gl(i),e.left=t.containerLimit.width/2+t.getSideMargin(),e.top=t.getTopMargin(),e.width="50%",e.height="100%";else{const n=t.containerLimit;n.height-=t.getTopMargin();const s=t.getAroundImageVideoSize().height;a=new ul(i);let o=2*t.getTopMargin()+n.height-((n.height-s)/2+s);e.height=o,e.width="100%",e.bottom=t.isVerticalMaterial()?0:30}a&&this.reportBottomBarImpression(t.callerContext.adInfo,i.componentData)}else{if(10==n)if(s)a=new gl(i),e.left=t.containerLimit.width/2+t.getSideMargin(),e.top=t.getTopMargin(),e.width="50%",e.height="100%";else{const n=t.containerLimit;n.height-=t.getTopMargin();const s=t.getAroundImageVideoSize().height;a=new ul(i);let o=2*t.getTopMargin()+n.height-((n.height-s)/2+s);e.height=o,e.width="100%",e.bottom=t.isVerticalMaterial()?0:30}t.reportCardImpression(n)}if(!a){a=new Al(i);let t=a.getHeight();e.height=t}return a}static getLiveBottomCard(t,e,i){let n;const s=t.bottomBarVM;if(e={position:"absolute",bottom:0,left:t.getSideMargin(),right:t.getSideMargin(),flexDirection:"row",justifyContent:0==t.screenOrientation?"center":"flex-end"},t.callerContext.componentSwtich){let e=R(t.callerContext.adInfo,"bottom-card-live-stream",2);!n&&e&&(s.componentData=e,n=new vl(s,t.playerVM)),n&&this.reportBottomBarImpression(t.callerContext.adInfo,s.componentData)}else{let e=s.getActionBarCardType();n=t.liveCouponVM.isLiveCouponBottomCardEnable()?new Sl(s,t.playerVM,t.liveCouponVM):8==e?new vl(s,t.playerVM):new Vl(s)}return e.height=n.getHeight(),i.style=e,n||(n=new Vl(s)),n}static reportBottomBarImpression(t,e){let i=new S;const n=t.adMatrixInfo.adDataV2.styleComponentInfo;let s={page_id:n.playCardInfo.pageId,combination_id:n.playCardInfo.combinationIds,component_id:e.componentId};i.component_module=JSON.stringify(s);let a={elementType:19};a.clientExtData=JSON.stringify(i),pi.log(140,{x:0,y:0},a)}}class _l extends TKView{constructor(t,e="#FFFFFF",i={width:264,height:48}){super(),this.showNumber=0,this.progressViewUpdate=!1,this.vm=t,this.hasAutoConverted=!1,this.isShowing=!1,this.color=e,this.progressViewSize=i,this.vm.convertNotify=t=>{this.setConverted(t)},this.vm.closeAutoCallCallback=()=>{this.cardDismiss()},this.setupViews(),this.setupActions()}setupActions(){this.addEventListener("tap",(t=>{})),this.closeBtn.addEventListener("tap",(t=>{this.reportCloseBtnTapped(),this.cardDismiss()}));const t=this,e=13==this.vm.adStyle&&2==this.vm.adDefaultMaterialType;Di(this.vm,this.vm.$attrsPath.lifeStatus,(i=>{"showStart"==i?e&&t.startShowTimer():"hideEnd"==i?e&&t.stopShowTimer():"pageInvisiable"==i&&t.clearProgressTimer()}))}setupViews(){const t=this.oneLineStyle(),e=this.getCardWidth(),i=this.getCardHeight();this.style={right:15,height:i,width:e,flexDirection:"row",justifyContent:"space-between",alignItems:"center",position:"absolute",borderRadius:8,borderWidth:1,borderColor:"#FFFFFF66",visibility:"hidden"},this.isTopAutoCallAppCard()?this.style={top:0!=this.vm.cardTopMargin?this.vm.cardTopMargin:60}:this.style={bottom:0!=this.vm.cardBottomMargin?this.vm.cardBottomMargin:15};const n=new TKView;n.style={top:1,left:1,bottom:1,right:1,height:i-2,width:e-2,position:"absolute",borderRadius:8,backgroundColor:"#30303099"},this.appendChild(n),this.appIcon=new TKImage,this.appIcon.style={width:this.getAppIconWH(),height:this.getAppIconWH(),borderRadius:8,borderWidth:1,borderColor:"#EAEAEAFF",marginLeft:t?8:11,marginBottom:t?8:11,marginTop:t?8:11},this.appIcon.setSrc(this.getAppIconUrl()),this.appendChild(this.appIcon);const s=new TKView;s.style={marginLeft:8,marginRight:8,width:126,height:t?18:34,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"center",flexWrap:"no-wrap",flexShrink:1},this.appendChild(s),this.titleLabel=new TKText,this.titleLabel.style={fontSize:14,color:"#FFFFFF",flexWrap:"no-wrap",textLineClamp:1,width:"100%",textOverflow:"ellipsis"},this.titleLabel.setText(String(mt(this.vm.styleDataInfo))+this.getTitle()),s.appendChild(this.titleLabel),t||(this.subTtileLabel=new TKText,this.subTtileLabel.style={fontSize:12,color:"#FFFFFF99",flexWrap:"no-wrap",textLineClamp:1,width:"100%",textOverflow:"ellipsis"},this.subTtileLabel.setText(this.getSubTitle()),s.appendChild(this.subTtileLabel)),this.closeBtn=new TKButton,this.closeBtn.style={marginRight:9,width:53,height:24,fontSize:12,textAlign:"center",backgroundColor:"#00000000",color:"#FFFFFFB3",borderRadius:12,borderWidth:1,borderColor:"#FFFFFF4D"},this.closeBtn.setText(this.getButtonTitle()),this.appendChild(this.closeBtn)}setConverted(t){this.converted=t,t&&this.cardDismiss()}refreshCardLayout(){this.isShowing&&(this.style={right:15})}handlePlayFailed(){this.cardDismiss()}handlePlayFinished(){this.autoConvertIfNeed()}handlePlayTime(t){const e=Y(this.vm.adInfo);let i=Math.floor(t/1e3),n=this.getCardBeginShowTime()/1e3,s=(this.getCardShowTime()+this.getCardBeginShowTime())/1e3,a=13==this.vm.adStyle||e>n+5||K.isOriginLiveAd(this.vm.adInfo);a=!(!a||i!=n||!this.shouldShowCard());let o=s-i<1?1:s-i;if(2==this.vm.adStyle&&(s=gt(this.vm.adInfo),o=s-i<1?1:s-i,a=!!(o==this.getCardShowTime()/1e3||this.isShowHalfPlay()&&o<this.getCardShowTime()/1e3)),a&&(this.isShowing||(this.isShowing=!0,this.addTranslateAction(),13==this.vm.adStyle&&Ne.cardImpression(),ri().emit(c,{}),this.reportCardImpression())),this.isShowing)if(i>=s)this.autoConvertIfNeed();else{const t=this.isShowHalfPlay()?this.getAdTitle():"";this.titleLabel.setText(o+this.getTitle()+t),this.isShowHalfPlay()&&(this.updateProgress(o),this.progressViewUpdate=!0)}}isShowHalfPlay(){return!1}updateProgress(t){if(this.progressViewUpdate)return;if(!this.progressView)return;const e=this.getCardShowTime();let i=e-1e3*t;const n=this;this.progressTimer=setInterval((()=>{i+=100,i>e?n.clearProgressTimer():n.progressView.setProgress(i/e)}),100)}clearProgressTimer(){this.progressTimer&&(this.progressViewUpdate=!1,clearTimeout(this.progressTimer))}startShowTimer(){this.stopShowTimer(),this.showTimer=setInterval((()=>{this.showNumber++,this.handlePlayTime(500*this.showNumber)}),500)}stopShowTimer(){this.showNumber=0,this.showTimer&&clearInterval(this.showTimer),this.showTimer=0}getCardStyle(){let t=0;return t=this.vm.styleDataInfo.cardStyle,t}getCardHeight(){let t=60;return this.oneLineStyle()&&(t=47),t}getCardWidth(){let t=253;return this.oneLineStyle()&&(t=243),t}getAppIconWH(){let t=39;return this.oneLineStyle()&&(t=32),t}getAppIconUrl(){var t;let e=null;return e=null===(t=this.vm.styleDataInfo)||void 0===t?void 0:t.adAppUrl,Ie(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}getTitle(){let t=null;return t=this.vm.styleDataInfo.title,Ie(t)||(t="s后打开"),t}getAdTitle(){let t=null;return t=this.vm.styleDataInfo.adTitle,Ie(t)||(t="可爱的广告君"),t}getSubTitle(){let t=null;return t=this.vm.styleDataInfo.subTitle,Ie(t)||(t="可查看更多精彩"),t}getButtonTitle(){let t=null;return t=this.vm.styleDataInfo.buttonTitle,Ie(t)||(t="不用了"),t}oneLineStyle(){let t=!1,e=this.getCardStyle();return 1!=e&&3!=e||(t=!0),t}addTranslateAction(){this.style={right:-this.getCardWidth(),visibility:"visible"},this.animPosition={x:-this.getCardWidth()-15,y:0,z:0};let t=new TKBasicAnimation;t.duration=300,t.animValue={position:this.animPosition},t.on("end",(()=>{this.animateFinishCallback&&(this.animateFinishCallback(),this.animateFinishCallback=null)})),this.addAnimation(t,"translate")}isTopAutoCallAppCard(){let t=this.vm.styleDataInfo.cardStyle;return null==t&&(t=0),1==t||0==t}shouldShowCard(){return!this.converted}getCardShowTime(){let t=2==this.vm.adStyle?3e3:5e3;try{let e=this.vm.styleDataInfo.autoOpenTime;return(e<=0||null==e)&&(e=t),e}catch(e){return t}}getCardBeginShowTime(){let t=13==this.vm.adStyle?5e3:1e4;try{let e=this.vm.styleDataInfo.beginShowTime;return(e<=0||null==e)&&(e=t),e}catch(e){return t}}reportCardImpression(){let t=new S;if(t.template_show_type="auto_evocation_"+this.vm.styleDataInfo.cardStyle,k(this.vm.adInfo)&&this.vm.componentData){t.universe_feature_freq=this.vm.componentData.componentId;const e=this.vm.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds,component_id:this.vm.componentData.componentId};t.component_module=JSON.stringify(i)}else t.universe_feature_freq=13;let e={elementType:191,businessSceneType:10,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};Ne.sendLog(i)}reportCloseBtnTapped(){let t=new S;t.template_show_type="auto_evocation_"+this.vm.styleDataInfo.cardStyle;let e={elementType:69,businessSceneType:10,clientExtData:JSON.stringify(t)},i={actionType:141,payload:JSON.stringify(e)};Ne.sendLog(i)}autoConvertIfNeed(){if(!this.hasAutoConverted&&!this.converted&&this.isShowing){let e={},i=new S;this.externalClientExtData&&(i=this.externalClientExtData),i.template_show_type="auto_evocation_"+this.vm.styleDataInfo.cardStyle,k(this.vm.adInfo)&&this.vm.componentData&&(i.component_module=E(this.vm.adInfo,this.vm.componentData)),e.clientExtData=JSON.stringify(i),pi.convertWithTypeIfNeededNew(this.vm.adInfo,1,{x:0,y:0},t.AUTO_CLICK_OTHER_AREA,8,e),this.hasAutoConverted=!0,this.converted=!0,this.cardDismiss()}}cardDismiss(){this.isShowing=!1,this.stopShowTimer(),this.dismissCallback&&(this.dismissCallback(),this.dismissCallback=null)}setExternalClientExtData(t){this.externalClientExtData=t}}class Dl extends En{constructor(t,e){super(),this.closeCalled=!1,this.hasExposured=!1,this.mTimerInterval=100,this.mTimerCurrent=0,this.mTimerPaused=!1,this.vm=t,this.mTotalStayTime=this.vm.getCouponShowTime(),this.onCloseTrigger=e,this.setupViews(),this.setupActions(),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"!=t&&"pageInvisiable"!=t||(this.mTimerPaused="pageVisiable"!=t)}))}showDialog(t){this.isShowing()||(super.showDialog(t),this.startTimer(),this.hasExposured||(this.vm.impressionReport(191,"coupon_card"),this.hasExposured=!0))}setupViews(){let t=this.vm.callerContext.containerLimit.height,e=Pe.isAndroid();this.blackBg=new TKView,this.blackBg.style={height:"100%",width:"100%",backgroundColor:"#00000099",position:"absolute"},this.appendChild(this.blackBg),this.livePopUpCouponView=new TKView,this.livePopUpCouponView.style={height:350,width:240,top:(t-350)/2,alignItems:"center",position:"absolute"},this.appendChild(this.livePopUpCouponView),this.couponBackground=new TKImage,this.couponBackground.style={height:350,width:240,borderRadius:18},ke(this.couponBackground,"live_coupon_main_background.png"),this.livePopUpCouponView.appendChild(this.couponBackground),this.couponShopContainer=new TKView,this.couponShopContainer.style={width:"auto",height:28,top:14,flexDirection:"row",position:"absolute"},this.livePopUpCouponView.appendChild(this.couponShopContainer),this.couponShopImage=new TKImage,this.couponShopImage.style={width:28,height:28,borderRadius:36},ke(this.couponShopImage,this.vm.getShopImage()),this.couponShopContainer.appendChild(this.couponShopImage),this.couponShopName=new TKText,this.couponShopName.style={width:"auto",height:22,maxWidth:135,fontWeight:e?"300":"400",color:"#FFFFFF",fontSize:15,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",alignSelf:"center",textLineHeightClamp:22,marginLeft:6},this.couponShopName.setText(this.vm.getShopName()),this.couponShopContainer.appendChild(this.couponShopName),this.couponTitleText=new TKText,this.couponTitleText.style={width:"auto",height:22,maxWidth:180,top:50,fontWeight:e?"400":"500",color:"#FFFFFF",fontSize:17,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22,position:"absolute"},this.couponTitleText.setText(this.vm.getCouponTitle()),this.livePopUpCouponView.appendChild(this.couponTitleText),this.couponSecondaryContainer=new TKView,this.couponSecondaryContainer.style={width:220,height:256,top:84,alignItems:"center",position:"absolute"},this.livePopUpCouponView.appendChild(this.couponSecondaryContainer),this.couponAmountContainer=new TKView,this.couponAmountContainer.style={width:"auto",height:72,maxWidth:220,top:15,flexDirection:"row",position:"absolute"},this.couponSecondaryContainer.appendChild(this.couponAmountContainer),this.couponAmountSymbol=new TKText,this.couponAmountSymbol.style={height:45,top:21,fontWeight:"600",fontStyle:"normal",color:"#5F1C00",fontSize:32,textAlign:"center",textLineClamp:1,textLineHeightClamp:32},this.couponAmountSymbol.setText("¥"),this.couponAmountContainer.appendChild(this.couponAmountSymbol),this.couponAmountNum=new TKText,this.couponAmountNum.style={width:"auto",height:72,maxWidth:190,top:2,fontWeight:"700",fontStyle:"normal",color:"#5F1C00",fontSize:60,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:60},this.couponAmountNum.setText(this.vm.getCouponAmount().toString()),this.couponAmountContainer.appendChild(this.couponAmountNum),this.couponConditionNum=new TKText,this.couponConditionNum.style={width:"auto",height:21,maxWidth:180,top:98,fontWeight:"400",fontStyle:"normal",color:"#A99187",fontSize:13,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22,position:"absolute"},this.couponConditionNum.setText(this.vm.getCouponCondition()),this.couponSecondaryContainer.appendChild(this.couponConditionNum),this.couponCouponExpireTime=new TKText,this.couponCouponExpireTime.style={width:"auto",height:18,maxWidth:180,top:120,fontWeight:"400",fontStyle:"normal",color:"#A99187",fontSize:13,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22,position:"absolute"},this.couponCouponExpireTime.setText(this.vm.getCouponExpireTime()),this.couponSecondaryContainer.appendChild(this.couponCouponExpireTime),this.couponButton=new TKView,this.couponButton.style={width:170,height:46,borderRadius:36,top:170,backgroundColor:"#FF2027",position:"absolute",alignItems:"center"},this.couponSecondaryContainer.appendChild(this.couponButton),this.couponActionDescText=new TKText,this.couponActionDescText.style={width:"auto",height:24,maxWidth:130,top:11,fontWeight:"600",fontStyle:"normal",color:"#FFFFFF",fontSize:16,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:24},this.couponActionDescText.setText(this.vm.getCouponActionDesc()),this.couponButton.appendChild(this.couponActionDescText),this.livePopUpCouponCloseBtn=new TKImage,this.livePopUpCouponCloseBtn.style={height:40,width:40,top:(t+350)/2+24,position:"absolute"},ke(this.livePopUpCouponCloseBtn,"live_coupon_close_btn.png"),this.appendChild(this.livePopUpCouponCloseBtn)}setupActions(){let e=new S;e.template_show_type="coupon_card",this.livePopUpCouponView&&this.livePopUpCouponView.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e),this.onCloseTrigger&&this.onCloseTrigger()})),this.couponButton&&this.couponButton.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e),this.onCloseTrigger&&this.onCloseTrigger()})),this.livePopUpCouponCloseBtn&&this.livePopUpCouponCloseBtn.addEventListener("tap",(t=>{this.handleCloseCallback(1)}))}handleCloseCallback(t){this.closeCalled||(this.closeCalled=!0,this.vm.logCloseReport(t,"coupon_card"),this.onCloseTrigger&&this.onCloseTrigger())}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{this.mTimerPaused||(this.mTimerCurrent+=this.mTimerInterval,this.mTimerCurrent>this.mTotalStayTime&&(this.stopTimer(),this.handleCloseCallback(2)))}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}}class Fl extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas(),this.setupActions()}setupActions(){if(this.actionBarContainer){const e=this;this.actionBarContainer.addEventListener("tap",(i=>{const n=Te(i,this);e.vm.convert(n,1,t.CARD_ACTION_BAR_CLICK)&&e.clickCloseCallback&&e.clickCloseCallback&&e.clickCloseCallback(3)})),this.vm.supportSlideClick()&&jt(this.actionBarContainer,(()=>{e.vm.convert({x:0,y:0},1,t.CARD_SWIPE_CONVERT)&&e.clickCloseCallback&&e.clickCloseCallback&&e.clickCloseCallback(3)}))}}setupDatas(){this.cardTagText.setText(this.vm.getSocialCardTagText()),this.cardDescText.setText(this.vm.getSocialCardDescText()),this.actionBarText.setText(this.vm.getSocialCardActionBarText())}setupViews(){this.style={alignItems:"flex-start",justifyContent:"flex-start",height:this.vm.getGapDistance(149),width:"100%",flexDirection:"column",bottom:this.vm.getGapDistance(20),position:"absolute"},this.clipChildren=!1;const t=new TKView;if(t.style={height:24,width:"100%",paddingLeft:12,marginTop:0,flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start"},this.appendChild(t),this.vm.hasLiveTag()){let e=this.vm.obtainTagText(this.vm.getSocialCardLiveTagText());this.cardLiveTagView=new vr(e,Ir.create({tagViewStyle:3,height:24,tagBorderRadius:4,tagFontSize:12,customBackgroundColor:"#FE3666",customTextColor:"#FFFFFF",tagPadding:6,tagDividerSize:4,tagFontWeight:ye()?"400":"500"})),t.appendChild(this.cardLiveTagView)}let e=this.vm.obtainTagText(this.vm.getSocialCardMatchTagText());this.cardMatchTagView=new vr(e,Ir.create({tagViewStyle:3,height:24,tagBorderRadius:4,tagFontSize:12,customBackgroundColor:"#FFFFFF4D",customTextColor:"#FFFFFF",tagPadding:6,tagDividerSize:4,tagFontWeight:ye()?"400":"500"})),this.cardMatchTagView.style={marginLeft:this.vm.hasLiveTag()?6:0},t.appendChild(this.cardMatchTagView),this.cardTagText=new TKText,this.cardTagText.style={height:31,fontSize:22,textLineClamp:1,color:"#FFFFFF",alignItems:"flex-start",marginLeft:12,marginTop:this.vm.getGapDistance(4),fontWeight:ye()?"500":"600",textOverflow:"ellipsis",textAlign:"center",textShadow:"0 0 5 #00000040",includeFontPadding:!1},this.appendChild(this.cardTagText),this.cardDescText=new TKText,this.cardDescText.style={height:20,fontSize:14,textLineClamp:1,color:"#FFFFFFB3",marginTop:this.vm.getGapDistance(5),marginLeft:12,alignItems:"flex-start",fontWeight:ye()?"400":"500",textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1},this.appendChild(this.cardDescText),Pe.supportMinimumTKVersion("5.0.0")?this.actionBarContainer=new RoundRectView:this.actionBarContainer=new TKView,this.actionBarContainer.style={height:this.vm.getActionBarSize().height,width:this.vm.getActionBarSize().width,borderRadius:this.vm.getActionBarSize().borderRadius,marginTop:this.vm.getGapDistance(11),marginLeft:this.vm.getActionBarSize().left,backgroundColor:"#FFFFFF4D",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.appendChild(this.actionBarContainer),Pe.supportMinimumTKVersion("5.0.0")&&(this.phoneIconLottie=new TKLottieImageView,this.phoneIconLottie.style={height:33,width:31},this.actionBarContainer.appendChild(this.phoneIconLottie),this.phoneIconLottie.setUri(Fe(this.vm.getSocialPhoneIcon()))),this.actionBarText=new TKText,this.actionBarText.style={height:22,fontSize:16,textLineClamp:1,color:"#FFFFFF",marginLeft:5,alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},this.actionBarContainer.appendChild(this.actionBarText)}addSweepAnim(){if(!Pe.supportMinimumTKVersion("5.0.0"))return;this.strongSweepImage&&this.actionBarContainer&&this.actionBarContainer.removeChild(this.strongSweepImage);const t=this.actionBarContainer.getSize(),e=714*t.height/50;this.strongSweepImage=new TKImage,this.strongSweepImage.style={width:e,height:t.height,left:-e,top:0,position:"absolute"},ke(this.strongSweepImage,this.vm.getSocialSweepImg()),this.actionBarContainer&&this.actionBarContainer.insertBefore(this.strongSweepImage,this.phoneIconLottie);let i=zi(1e3,e);this.strongSweepImage.addAnimation(i,"strongSweepAnim")}startLottie(){this.phoneIconLottie&&(this.phoneIconLottie.play(),this.phoneIconLottie.setLoop(!0)),setTimeout((()=>{this.addSweepAnim()}),4e3)}stopLottie(){this.phoneIconLottie&&this.phoneIconLottie.stop()}resumeLottie(){this.phoneIconLottie&&this.phoneIconLottie.resume()}pauseLottie(){this.phoneIconLottie&&this.phoneIconLottie.pause()}}class kl extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas(),this.setupActions()}setupActions(){if(this.closeImg){const t=this;this.closeImg.addEventListener("tap",(e=>{t.clickCloseCallback&&t.clickCloseCallback(1)}))}}setupDatas(){this.dialogTitle.setText(this.vm.getSocialCardDialogTitle()),this.dialogDescTitle.setText(this.vm.getSocialCardDialogDescTitle()),this.iconImg.setSrc(this.vm.getSocialCardBgImageUrl()),ke(this.closeImg,this.vm.getCardcloseIconImageSrc())}setupViews(){this.style={alignItems:"flex-start",justifyContent:"flex-start",flexDirection:"row",height:this.vm.getGapDistance(55),width:"100%",paddingLeft:12,paddingRight:12,top:this.vm.getGapDistance(20),position:"absolute"},this.iconImg=new TKImage,this.iconImg.style={height:this.vm.getGapDistance(55),width:this.vm.getGapDistance(55),borderRadius:30,borderWidth:1,borderColor:"#FFFFFFCC",resize:"cover"},this.appendChild(this.iconImg),this.titleContainer=new TKView,this.titleContainer.style={width:"100%",height:"100%",marginLeft:10,flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:1},this.appendChild(this.titleContainer),this.dialogTitle=new TKText,this.dialogTitle.style={width:"100%",height:28,fontSize:20,textLineClamp:1,color:"#FFFFFF",marginTop:0,marginLeft:0,alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textShadow:"0 0 5 #0000004D",includeFontPadding:!1},this.titleContainer.appendChild(this.dialogTitle),this.descTitleContainer=new TKView,this.descTitleContainer.style={width:"100%",height:20,marginBottom:0,alignItems:"center",flexDirection:"row"},this.titleContainer.appendChild(this.descTitleContainer),this.dialogDescTitle=new TKText,this.dialogDescTitle.style={height:20,fontSize:14,textLineClamp:1,color:"#FFFFFFCC",marginLeft:0,alignItems:"center",fontWeight:"400",textOverflow:"ellipsis",textShadow:"0 0 5 #0000004D",flexShrink:1,includeFontPadding:!1},this.descTitleContainer.appendChild(this.dialogDescTitle),Pe.supportMinimumTKVersion("5.0.0")&&(this.socialCallLottie=new TKLottieImageView,this.socialCallLottie.style={width:20,height:20,marginLeft:4},this.socialCallLottie.setUri(Fe(this.vm.getSocialCallLottieSrc()))),this.descTitleContainer.appendChild(this.socialCallLottie),this.closeImg=new TKImage,this.closeImg.style={height:24,width:24,marginTop:0,marginRight:8,marginLeft:8},this.appendChild(this.closeImg)}startLottie(){this.socialCallLottie&&(this.socialCallLottie.play(),this.socialCallLottie.setLoop(!0))}stopLottie(){this.socialCallLottie&&this.socialCallLottie.stop()}resumeLottie(){this.socialCallLottie&&this.socialCallLottie.resume()}pauseLottie(){this.socialCallLottie&&this.socialCallLottie.pause()}}class Rl extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas();const e=this;this.cardTopView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)},this.cardBottomView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)}}setupViews(){this.style={alignItems:"center",justifyContent:"center",flexDirection:"column",width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius},this.clipChildren=!ye(),this.cardBgImg=new TKImage,this.cardBgImg.style={width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius,resize:"cover",top:0,position:"absolute"},this.appendChild(this.cardBgImg),this.cardMaskTopView=new TKView,this.cardMaskTopView.style={width:this.vm.getCardSize().width,height:this.vm.getGapDistance(85),top:0,gradientBgColor:"90,#00000000,#000000A6",topRightRadius:this.vm.getCardSize().borderRadius,topLeftRadius:this.vm.getCardSize().borderRadius,position:"absolute"},this.appendChild(this.cardMaskTopView),this.cardMaskBottomView=new TKView,this.cardMaskBottomView.style={width:this.vm.getCardSize().width,height:this.vm.getGapDistance(200),bottom:0,gradientBgColor:"270,#00000000,#000000A6",bottomRightRadius:this.vm.getCardSize().borderRadius,bottomLeftRadius:this.vm.getCardSize().borderRadius,position:"absolute"},this.appendChild(this.cardMaskBottomView),this.cardTopView=new kl(this.vm),this.appendChild(this.cardTopView),this.cardBottomView=new Fl(this.vm),this.appendChild(this.cardBottomView)}setupDatas(){this.cardBgImg.setSrc(this.vm.getSocialCardBgImageUrl())}startLottie(){this.cardTopView.startLottie(),this.cardBottomView.startLottie()}stopLottie(){this.cardTopView.stopLottie(),this.cardBottomView.stopLottie()}resumeLottie(){this.cardTopView.resumeLottie(),this.cardBottomView.resumeLottie()}pauseLottie(){this.cardTopView.pauseLottie(),this.cardBottomView.pauseLottie()}}class Bl extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas();const e=this;this.cardTopView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)},this.cardBottomView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)}}setupViews(){this.style={alignItems:"center",justifyContent:"center",flexDirection:"column",width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius},this.clipChildren=!1,this.cardBgImg=new TKImage,this.cardBgImg.style={top:0,position:"absolute",width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius,resize:"cover"},this.appendChild(this.cardBgImg),this.cardFrameDownView=this.getCardFrameView(),this.cardFrameDownView.style={top:this.vm.getGapDistance(85),transform:{translate:{y:16,x:-16},rotate:{z:-4}},position:"absolute"},this.appendChild(this.cardFrameDownView),this.cardFrameUpView=this.getCardFrameView(),this.cardFrameUpView.style={top:this.vm.getGapDistance(85),position:"absolute"},this.appendChild(this.cardFrameUpView),this.cardMaskImg=new TKImage,this.cardMaskImg.style={width:this.vm.getCardSize().width,height:this.vm.getGapDistance(244),bottom:0,bottomRightRadius:this.vm.getCardSize().borderRadius,bottomLeftRadius:this.vm.getCardSize().borderRadius,position:"absolute",resize:"cover"},this.appendChild(this.cardMaskImg),this.cardTopView=new kl(this.vm),this.appendChild(this.cardTopView),this.cardBottomView=new Fl(this.vm),this.appendChild(this.cardBottomView)}getCardFrameView(){let t=new TKView;t.style={width:this.vm.getPictureFrameSize().width,height:this.vm.getPictureFrameSize().height,alignItems:"center",justifyContent:"center",flexDirection:"column"},t.clipChildren=!0;let e=new TKImage;e.style={position:"absolute",width:this.vm.getPictureSize().width,height:this.vm.getPictureSize().height,transform:{rotate:{z:3},translate:{y:-2,x:-2}}},t.appendChild(e),e.setSrc(this.vm.getSocialCardBgImageUrl());let i=new TKImage;return i.style={top:0,position:"absolute",width:"100%",height:"100%"},t.appendChild(i),ke(i,"icon_ksad_social_picture_frame.png"),t}setupDatas(){ke(this.cardBgImg,"icon_ksad_social_planb_bg.png"),ke(this.cardMaskImg,"icon_ksad_social_planb_mask.png")}startLottie(){this.cardTopView.startLottie(),this.cardBottomView.startLottie()}stopLottie(){this.cardTopView.stopLottie(),this.cardBottomView.stopLottie()}resumeLottie(){this.cardTopView.resumeLottie(),this.cardBottomView.resumeLottie()}pauseLottie(){this.cardTopView.pauseLottie(),this.cardBottomView.pauseLottie()}}class El extends TKView{constructor(t){super(),this.playSoundCount=0,this.hasClosed=!1,this.hasShow=!1,this.vm=t,this.setupViews(),this.setupActions();const e=this;this.startTimer(),_i(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&e.closeCard(0),"pageVisiable"==t&&e.resume(),"pageInvisiable"==t&&e.paused()}))}setupActions(){const e=this;this.cardView.addEventListener("tap",(i=>{const n=Te(i,e);e.vm.convert(n,2,t.CARD_OTHERAREA_CLICK)&&e.callbackClose&&e.closeCard(3)})),this.vm.supportSlideClick()&&jt(this.cardView,(()=>{e.vm.convert({x:0,y:0},2,t.CARD_SWIPE_CONVERT)&&e.callbackClose&&e.closeCard(3)}))}setupViews(){this.style={alignItems:"center",justifyContent:"center",flexDirection:"column",width:"100%",height:"100%",backgroundColor:"#00000080"},2==this.vm.getSocialCardStyle()?(this.vm.templateShowType="social_card2",this.cardView=new Bl(this.vm),this.appendChild(this.cardView)):(this.vm.templateShowType="social_card1",this.cardView=new Rl(this.vm),this.appendChild(this.cardView)),this.cardView.clickCloseCallback=t=>{this.closeCard(t)}}startTimer(){this.timePlay=new hn(this.vm.getSocialCardShowTime()),this.timePlay.setTimerInterval(1e3);const t=this;this.timePlay.onFinishCallback=()=>{t.closeCard(2)}}closeCard(t){this.hasClosed||(0!=t&&this.socialCardDismiss(t),this.stopSound(),this.hasClosed=!0,this.cardView.stopLottie(),this.timePlay&&this.timePlay.stop())}addPhoneSound(){if(!Pe.supportMinimumTKVersion("5.0.0"))return;const t=this;KSAdSystemUtil.loadSound("https://p1-lm.adkwai.com/udata/pkg/ks-ad-ssp/social_ringtone.mp3",(e=>{El.playSoundId=e,t.playPhoneSound()}))}playPhoneSound(){be(El.playSoundId)||this.hasClosed||ye()&&3==this.playSoundCount||(this.playSoundCount++,KSAdSystemUtil.playSound(El.playSoundId,(()=>{})),setTimeout((()=>{this.playPhoneSound()}),2520))}stopSound(){be(El.playSoundId)||(KSAdSystemUtil.stopSound(El.playSoundId),El.playSoundId=void 0)}socialCardShow(){this.addDialogOpacityAnimation(this,0,1,"dialogShowOpacityAnim");const t=this;this.addDialogTranslateAnimation(this.cardView,15,"dialogShowTranslateAnim",(()=>{t.cardView.startLottie(),ye()?t.addPhoneSound():setTimeout((()=>{t.addPhoneSound()}),540),t.timePlay.play(),t.vm.logECCardImpression(),this.hasShow=!0}))}socialCardDismiss(t){const e=this;this.addDialogTranslateAnimation(this.cardView,23,"dialogDismissTranslateDownAnim",(()=>{e.dismissTranslateUp(t)}))}dismissTranslateUp(t){this.addDialogTranslateAnimation(this.cardView,-40,"dialogDismissTranslateUpAnim");const e=this;setTimeout((()=>{e.addDialogOpacityAnimation(this,1,0,"dialogDismissOpacityAnim",(()=>{e.callbackClose&&e.callbackClose(t)}))}),100)}addDialogOpacityAnimation(t,e,i,n,s=void 0){let a=new TKKeyframeAnimation;a.setAnimations([()=>(t.style={opacity:e},0),()=>(t.style={opacity:i},1)]),a.duration=200,a.timingFunction="linear",t.addAnimation(a,n),a.on("end",(()=>{s&&s()}))}addDialogTranslateAnimation(t,e,i,n=void 0){let s=new TKKeyframeAnimation;s.setAnimations([()=>(t.style={transform:{translate:{y:e}}},1)]),s.duration=200,s.timingFunction="linear",t.addAnimation(s,i),s.on("end",(()=>{n&&n()}))}resume(){this.hasShow&&(this.cardView.resumeLottie(),this.addPhoneSound(),this.timePlay&&this.timePlay.resume())}paused(){this.hasClosed||(this.cardView.pauseLottie(),this.stopSound(),this.timePlay&&this.timePlay.paused())}}El.playSoundId=void 0;class Kl extends En{constructor(t){super(),this.vm=t,this.setupViews()}showDialog(t){this.isShowing()||(super.showDialog(t),this.cardView.socialCardShow())}setupViews(){this.cardView=new El(this.vm),this.appendChild(this.cardView);const t=this;this.cardView.callbackClose=e=>{t.callbackCloseTrigger(e)}}callbackCloseTrigger(t){this.vm.logCloseReport(t),this.onCloseTrigger&&this.onCloseTrigger(t)}}(new class extends mi{constructor(){super(),this.isDefaultBottombar=!1,this.isDeepVideoTrans=!1,this.vm=new er}render(){if(this.renderCalled)return!1;this.renderCalled=!0;try{this.vm.getData((t=>{var e;if(t)try{e=rt(this.vm.adInfo,12),ie=e,this.vm.isScanAggregation()?(Ze({category:"ad_client_apm_log",biz:"AD_REWARD",tag:"AD_REWARD",sub_biz:"OTHER",rate:1,suffixRatio:"",event_id:"ad_sdk_scan_aggregation_show",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{scene_status:2}}),this.initScanAggregation()):this.setupViews(),Tachikoma.render(this.rootView),this.updateRenderStatus(1,"")}catch(i){this.updateRenderStatus(0,we(i))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,we(t))}return!0}initScanAggregation(){let t=new Cr(this.vm);t.style={width:"100%",height:"100%"},this.rootView.appendChild(t)}setupViews(){this.baseRootContainer=new TKView,this.baseRootContainer.style={width:"100%",height:"100%"},this.setupBaseContainer(),this.rootView.appendChild(this.baseRootContainer),this.contentView=new TKView,this.contentView.style={position:"absolute",left:0,right:0,top:0,bottom:0,flexDirection:"row",justifyContent:"center",alignContent:"center"},this.baseRootContainer.appendChild(this.contentView),this.setBackPressedCallback(),this.setupPlayEndCard(),this.setupBlurBgIfNeeded(),this.setupPlayer(),this.setupBottomBar(),this.setupAdLogoIfNeeded(),this.setupTopBar(),this.setupDownloadPopup(),this.setupConfirm(),this.setupTopFloorView(),this.setupShakeView(),this.setupRotateView(),this.setupAutoCallView(),this.setupNeoInteractView(),this.setupInstallTip(),this.vm.isClickReward()&&this.setupSecondClick(),this.vm.liveCouponVM.isLiveCouponPopUpEnable()?this.setupLiveCouponPopUpView():(this.vm.hasAutoDialog()&&0==this.vm.screenOrientation&&this.setupAutoDialog(),this.vm.ecCardViewModel.enableShowCard()&&this.setupECCardDialog(),this.vm.gameCardViewModel.enableShowGameCard()&&this.setupGameCardDialog()),this.vm.socialCardViewModel.enableShowSocialCard()&&this.setupSocialCardDialog(),Di(this.vm.topBarVM,this.vm.topBarVM.$attrsPath.hasCallbackGift,(t=>{t&&(this.vm.confirmVM.hasGift=t,console.log("NEO======>激励视频获得奖励"),vt(this.vm.adInfo)&&!this.vm.secondclickVM.hasClickBefore&&this.vm.adInfo.adRewardInfo.rewardTime<this.vm.getVideoDuration()&&this.secondclickDialog.showConfirm())})),Di(this.vm.topBarVM,this.vm.topBarVM.$attrsPath.hasShowPlayend,(t=>{t&&(this.vm.topFloorVM.hasShowPlayend=!0,this.vm.callerContext.hasShowPlayend=!0,this.onShowPlayEndCard())})),this.vm.playEndCardVM.preFormViewModel&&Di(this.vm.playEndCardVM.preFormViewModel,this.vm.playEndCardVM.preFormViewModel.$attrsPath.isSlideUp,(t=>{t?this.topbar.setVisibility("hidden"):this.topbar.setVisibility("visible")})),Di(this.vm.playerVM,this.vm.playerVM.$attrsPath.playStarted,(t=>{t&&(console.log("NEO====>启播成功"),this.vm.isValidPlayable()&&this.setupPlayable(),this.playendCard.render(),this.vm.isValidPlayable()&&this.playableCard.render())})),Di(this.vm.playerVM,this.vm.playerVM.$attrsPath.currentPlaybackTime,(t=>{let e=this.vm.bottomBarVM;if(!this.isDeepVideoTrans&&e.isDeepVideoStyle()){if(t>e.deepVideoModel.getDeepVideoTransformTime()){let t=this.bottombar;this.videoChange(t.getVideoHeight(),t.getVideoTop(),t.getVideoRadius()),t.transfromBottomBar(),this.isDeepVideoTrans=!0,this.setupDanmakuView()}}if(this.vm.canShowNeoInteract()){t>this.vm.neoInteractVM.getInteractShowTime()&&this.showInteract()}if(this.autoDialogView&&this.vm.hasAutoDialog()){1e3*t>this.vm.neoAutoDialogVM.getAutoDialogDelayTime()&&(this.rootView.getSize().height>0&&(this.vm.neoAutoDialogVM.mContainerLimit.height=this.rootView.getSize().height),this.showAutoDialog())}if(this.ecCardDialogView&&this.vm.ecCardViewModel.cardLoadSuccess()){let e=this.vm.ecCardViewModel.getDelayShowTime();console.log(`jky ecinteract currentPlaybackTime: ${t} ecCardShowTime: ${e}`),t>e&&this.showECCardDialog()}if(this.gameCardDialogView&&this.vm.gameCardViewModel.enableShowGameCard()){1e3*t>this.vm.gameCardViewModel.getDelayTime()&&this.showGameCardDialog()}if(this.liveCouponPopUpView){t>this.vm.liveCouponVM.getCouponDelayTime()&&this.showliveCouponPopUp()}if(this.socialCardDialogView&&this.vm.socialCardViewModel.enableShowSocialCard()&&this.vm.callerContext.pageFocusAndVisible){1e3*t>this.vm.socialCardViewModel.getSocialCardDelayTime()&&this.showSocialCardDialog()}if(this.vm.interactGestureVM.hasInteractGesture()&&0==this.vm.screenOrientation){let e=this.vm.interactGestureVM.conflictStyleTime;if(this.vm.shakeVM.needShowShakeUI()&&(this.vm.interactGestureVM.conflictStyleTime=Math.max(e,4600)),this.vm.rotateVM.enableShowRotate()&&(this.vm.interactGestureVM.conflictStyleTime=Math.max(e,4700)),this.vm.topFloorVM.enableShowRedPacketView()){const t=this.vm.topFloorVM.redPacketViewModel.getOriginShowTime()+this.vm.topFloorVM.redPacketViewModel.getDelayTime();this.vm.interactGestureVM.conflictStyleTime=Math.max(e,1e3*t)}1e3*t>this.vm.interactGestureVM.getInteractGestureStartTimeMS()&&!this.vm.interactGestureVM.hasSetupView&&(this.setupInteractGesture(),this.vm.interactGestureVM.hasSetupView=!0)}e.isDeepVideoStyle()&&t>30&&this.bottombar.showActionBarAnim(),this.canShowPushCard(t)&&this.showPushCard()})),Di(this.vm.confirmVM,this.vm.confirmVM.$attrsPath.isShow,(t=>{t?this.onPlayStatusChange(1):this.onPlayStatusChange(2)})),Di(this.vm.secondclickVM,this.vm.secondclickVM.$attrsPath.isShow,(t=>{t?this.onPlayStatusChange(1):this.onPlayStatusChange(2)})),Di(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"hideEnd"==t?(this.bottombar&&this.bottombar.stopActionAnimation(),this.bottomCouponBar&&this.bottomCouponBar.stopActionAnimation(),this.shakeView&&this.shakeView.stopActionAnimation()):"pageVisiable"==t?(this.resumeVideoPlayer(),this.bottombar&&this.bottombar.resumeActionAnimation()):"pageInvisiable"==t&&(this.playerView.pause(),this.bottombar&&this.bottombar.pauseActionAnimation())})),Di(this.vm.neoInteractVM,this.vm.neoInteractVM.$attrsPath.interactSuccess,(t=>{null!=t&&(this.vm.callerContext.pageFocusAndVisible=!0,t&&this.vm.topBarVM.obtainNeoInteractTime(),this.switchNeoInteractVisibility(!1),this.resumeVideoPlayer())})),ri().on(h,(t=>{this.vm.topBarVM.hasCallbackGift?this.vm.secondclickVM.hasExtraGiven=!0:this.vm.secondclickVM.hasClickBefore=!0,this.vm.callerContext.pageFocusAndVisible=!1,this.vm.rotateVM.canRotateConvert=!1})),ri().on(c,(t=>{this.vm.pushCardVM.isShowEnd=!0}))}setupInstallTip(){this.vm.installActivateVM&&this.vm.installActivateVM.isCompoentUI()&&(this.installActivate=new Hr(this.vm.installActivateVM),this.baseRootContainer.appendChild(this.installActivate))}setupBaseContainer(){this.vm.isSlideEnable()&&jt(this.baseRootContainer,(()=>{pi.convertIfNeeded(1,this.vm.adInfo,3,{x:0,y:0},t.CARD_SWIPE_CONVERT,null)})),this.baseRootContainer.addEventListener("tap",(e=>{const i=Te(e,this.baseRootContainer);pi.convertIfNeeded(1,this.vm.adInfo,3,i,t.CARD_PAGE_CLICK,null)}))}setupAdLogoIfNeeded(){this.vm.bottomBarVM.isHorizontalPlayable()&&(this.adLogo=new Ri(1,this.vm.adInfo),this.adLogo.style={position:"absolute",left:this.vm.getSideMargin()+10,bottom:10},this.contentView.appendChild(this.adLogo))}setupDanmakuView(){let e=this.vm.bottomBarVM.deepVideoModel.getCommentList();this.vm.bottomBarVM.deepVideoModel.isShowComments()&&!be(e)&&(this.mDanmakuView=new ks(e),this.mDanmakuView.style={position:"absolute",width:"100%",height:100,top:80,left:0,right:0},this.baseRootContainer.appendChild(this.mDanmakuView),this.mDanmakuView.startRoll(),this.mDanmakuView.addEventListener("tap",(e=>{let i=new S;this.vm.bottomBarVM.deepVideoModel?i.merchant_play_card_style=this.vm.bottomBarVM.deepVideoModel.getDeepVideCardStyle():i.merchant_play_card_style=0,this.vm.bottomBarVM.convert(1,3,{x:e.position.rawX,y:e.position.rawY},t.CARD_ITEM_BULLET_CLICK,i)})))}setupBlurBgIfNeeded(){if(this.vm.bottomBarVM.isDeepVideoStyle()||this.vm.bottomBarVM.isHorizontalPlayable()||this.halfPlayerShouldShow()){this.blurBg=new TKBlurImage,this.blurBg.style={position:"absolute",left:this.vm.getSideMargin(),right:this.vm.getSideMargin(),top:this.vm.getTopMargin(),bottom:0};let t=this.halfPlayerShouldShow()?40:10;if(this.blurBg.setBlurRadius(t),this.blurBg.setSrc(this.vm.playerVM.getVideoFirstFrame()),this.contentView.appendChild(this.blurBg),this.halfPlayerShouldShow()){let t=0==this.vm.screenOrientation;this.blackBg=new TKImage,this.blackBg.style={backgroundColor:"#000000",position:"absolute",left:this.vm.getSideMargin(),right:this.vm.getSideMargin(),top:this.vm.getTopMargin(),bottom:0,opacity:.3},this.contentView.appendChild(this.blackBg),t?(this.blurBg.style={bottom:this.vm.callerContext.getOriginHeight()/2-this.vm.getTopMargin()/2},this.blackBg.style={bottom:this.vm.callerContext.getOriginHeight()/2-this.vm.getTopMargin()/2}):(this.blurBg.style={right:this.vm.callerContext.getOriginWidth()/2},this.blackBg.style={right:this.vm.callerContext.getOriginWidth()/2})}this.vm.bottomBarVM.isDeepVideoStyle()&&(this.blurBg.style={opacity:0},this.blackBg=new TKImage,this.blackBg.style={backgroundColor:"#00000080",position:"absolute",left:this.vm.getSideMargin(),right:this.vm.getSideMargin(),top:this.vm.getTopMargin(),bottom:0,opacity:0},this.contentView.appendChild(this.blackBg))}}setupPlayer(){console.log("=====+++++ setup player"),this.playerView=new ma(this.vm.playerVM);let t,e={position:"absolute"},i=0==this.vm.screenOrientation;const n=this.vm.bottomBarVM.getMaterialSize(),s=this.vm.containerLimit;s.height-=this.vm.getTopMargin(),s.width-=2*this.vm.getSideMargin();let a=s.width,o=s.height,r=s.width;this.vm.bottomBarVM.isHorizontalPlayable()?(t=0,a=s.width/2,r=a):this.halfPlayerShouldShow()?i?o=this.vm.callerContext.getOriginHeight()/2-this.vm.getTopMargin()/2:a=this.vm.callerContext.getOriginWidth()/2-this.vm.getSideMargin():t=s.width>s.height&&n.width>n.height||s.width<s.height&&n.width<n.height?2:0,e.width=a,e.height=o,e.left=this.vm.getSideMargin(),e.top=this.vm.getTopMargin(),this.playerView.style=e,this.contentView.appendChild(this.playerView)}setupTopBar(){let t=qr.initializeTopBar(this.vm);if(this.topbar=t,this.baseRootContainer.appendChild(this.topbar),this.topbar.updateActionBarState(this.vm.topBarVM.isShowSkipRightNow()?1:0),this.topbar.style={position:"absolute",top:this.vm.getTopMargin(),left:this.vm.getSideMargin(),right:this.vm.getSideMargin()},this.vm.topBarVM.handleSkipCallback=(t,e,i)=>{this.onSkip(t,e,i)},this.vm.topBarVM.handleCloseCallback=()=>{this.vm.handleClose(!1)},this.topbar.hasFeedbackBtn()){let t={elementType:194,buttonType:4},e={actionType:140,payload:JSON.stringify(t)};Ne.sendLog(e)}}setupNeoInteractView(){if(this.vm.canShowNeoInteract()){let t=this.vm.neoInteractVM.getInteractShowTime();this.neoInteractView=new Hi(this.vm.neoInteractVM),this.baseRootContainer.appendChild(this.neoInteractView),t>0?this.switchNeoInteractVisibility(!1):this.showInteract()}}showInteract(){this.vm.hasInteractReward||this.vm.topBarVM.hasShowPlayend||(this.vm.hasInteractReward=!0,this.switchNeoInteractVisibility(!0),this.neoInteractView.startLifeTimer(),this.withDialogShow(this.neoInteractView),this.vm.saveInteractCurrentCount())}withDialogShow(t){this.vm.playerVM.onDialogShow(t),this.vm.callerContext.pageFocusAndVisible=!1,this.vm.checkVisibleChange(),this.playerView.pause()}showAutoDialog(){null!=this.autoDialogView&&(this.autoDialogView.isShowing()||(this.autoDialogView.showDialog(this.rootView),this.withDialogShow(this.autoDialogView)))}hideAutoDialog(){this.vm.playerVM.onDialogDismiss(this.autoDialogView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.autoDialogView=null}showECCardDialog(){this.ecCardDialogView.showDialog(this.rootView),this.withDialogShow(this.ecCardDialogView)}hideECCardDialog(){null!=this.ecCardDialogView&&(this.ecCardDialogView.dismiss(),this.vm.playerVM.onDialogDismiss(this.ecCardDialogView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.ecCardDialogView=null)}showGameCardDialog(){this.gameCardDialogView.showDialog(this.rootView),this.withDialogShow(this.gameCardDialogView)}hideGameCardDialog(){this.gameCardDialogView&&(this.gameCardDialogView.dismiss(),this.vm.playerVM.onDialogDismiss(this.gameCardDialogView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.gameCardDialogView=null)}showliveCouponPopUp(){null!=this.liveCouponPopUpView&&(this.liveCouponPopUpView.showDialog(this.rootView),this.withDialogShow(this.liveCouponPopUpView))}hideLiveCouponPopUpView(){null!=this.liveCouponPopUpView&&(this.liveCouponPopUpView.dismiss(),this.vm.playerVM.onDialogDismiss(this.liveCouponPopUpView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.liveCouponPopUpView=null)}showSocialCardDialog(){this.socialCardDialogView.showDialog(this.rootView),this.withDialogShow(this.socialCardDialogView)}hideSocialCardDialog(){this.socialCardDialogView&&(this.socialCardDialogView.dismiss(),this.vm.playerVM.onDialogDismiss(this.socialCardDialogView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.socialCardDialogView=null)}withDialogHide(){this.vm.mLifeCycleHelper.isVisible()&&(this.vm.checkVisibleChange(),this.resumeVideoPlayer())}setupRotateView(){if(this.vm.rotateVM.enableShowRotate()){let t=0==this.vm.screenOrientation,e=0;e=this.bottomCouponBar?Math.max(this.bottombar.onGetMiddleMarginBottom(t),this.bottomCouponBar.onGetMiddleMarginBottom(t)):this.bottombar.onGetMiddleMarginBottom(t);let i=t?.98:.9,n=ye()||t&&!Ce()?this.vm.containerLimit.height-this.vm.getTopMargin():this.vm.containerLimit.height;const s=e=>{let i=this.vm.containerLimit.height-270-e.height,n=this.vm.getSideMargin()+this.vm.containerLimit.width/2-e.width/2,s=(this.vm.containerLimit.height+this.vm.getTopMargin()-e.height)/2;return i<s&&(i=s),t&&this.halfPlayerShouldShow()&&(i=((this.vm.callerContext.getOriginHeight()-this.vm.getTopMargin())/2-e.height)/2+this.vm.getTopMargin()),!t&&this.halfPlayerShouldShow()&&(n=(this.vm.callerContext.getOriginWidth()/2-this.vm.getSideMargin()-e.width)/2+this.vm.getSideMargin()),{x:n,y:i}},a=s=>{let a=n*i-e;return this.halfPlayerShouldShow()&&(a=t?(this.vm.callerContext.getOriginHeight()+this.vm.getTopMargin())/2-16-46:this.vm.callerContext.getOriginHeight()-16-46),{x:18+this.vm.getSideMargin(),y:a}},o=this.vm.showShakeAndRotateDirectlyAtBottom();2==this.vm.rotateVM.uiStyle?this.rotateView=new ea(this.vm.rotateVM,s,a,o):this.rotateView=new ta(this.vm.rotateVM,s,a,o),this.baseRootContainer.appendChild(this.rotateView)}}setupAutoCallView(){this.vm.autocallVM.shouldShowAutoCallAppCard((t=>{if(t){let t=0==this.vm.screenOrientation;this.vm.autocallVM.cardTopMargin=this.topbar.expcetedHeight+this.vm.getTopMargin()+10,this.vm.autocallVM.cardBottomMargin=this.bottombar.onGetMiddleMarginBottom(t)+20,this.autocallView=new _l(this.vm.autocallVM),this.autoCallCardAdded=!0,this.contentView.appendChild(this.autocallView),this.contentView.layout(),this.autocallView.dismissCallback=()=>{this.autoCallCardAdded&&(this.contentView.removeChild(this.autocallView),this.autocallView=null,this.autoCallCardAdded=!1)},ri().on(o,(t=>{null!=this.autocallView&&this.autocallView.handlePlayFinished()})),ri().on(r,(t=>{null!=this.autocallView&&this.autocallView.handlePlayTime(1e3*t.currentTime)})),ri().on(a,(t=>{null!=this.autocallView&&this.autocallView.handlePlayFailed()})),ri().on(h,(t=>{null!=this.autocallView&&this.autocallView.setConverted(!0)}))}else this.autocallView=null,this.autoCallCardAdded=!1}))}setupShakeView(){if(this.vm.shakeVM.needShowShakeUI()){let t=0==this.vm.screenOrientation,e=0;e=this.bottomCouponBar?Math.max(this.bottombar.onGetMiddleMarginBottom(t),this.bottomCouponBar.onGetMiddleMarginBottom(t)):this.bottombar.onGetMiddleMarginBottom(t);let i=t?.98:.9,n=ye()||t&&!Ce()?this.vm.containerLimit.height-this.vm.getTopMargin():this.vm.containerLimit.height;const s=this.vm.showShakeAndRotateDirectlyAtBottom();this.shakeView=new Bs(this.vm.shakeVM,(i=>{let n=this.vm.containerLimit.height/2-i.height/2,s=this.vm.getSideMargin()+this.vm.containerLimit.width/2-i.width/2;return!this.halfPlayerShouldShow()&&n>this.vm.containerLimit.height-e-16-i.height&&(n=this.vm.containerLimit.height-e-16-i.height),t&&this.halfPlayerShouldShow()&&(n=((this.vm.callerContext.getOriginHeight()-this.vm.getTopMargin())/2-i.height)/2+this.vm.getTopMargin()),!t&&this.halfPlayerShouldShow()&&(s=(this.vm.callerContext.getOriginWidth()/2-this.vm.getSideMargin()-i.width)/2+this.vm.getSideMargin()),{x:s,y:n}}),(s=>{let a=n*i-e;return this.halfPlayerShouldShow()&&(a=t?(this.vm.callerContext.getOriginHeight()+this.vm.getTopMargin())/2-16-46:this.vm.callerContext.getOriginHeight()-16-46),{x:18+this.vm.getSideMargin(),y:a}}),s),this.baseRootContainer.appendChild(this.shakeView)}}setupDownloadPopup(){!this.vm.isScanAggregation()&&$t(this.vm.adInfo)&&(this.downloadPopup=new ki(this.vm.downloadPopupVM,this.rootView))}setupInteractGesture(){this.vm.interactGestureVM.hasInteractGesture()&&(this.interactGesture=new Fs(this.vm.interactGestureVM,this.contentView,this.bottomContainer))}setupConfirm(){this.confirmDialog=new bs(this.vm.confirmVM),this.rootView.appendChild(this.confirmDialog),this.confirmDialog.setVisibility("hidden");const t=this;this.vm.confirmVM.handleSkipCallback=(e,i,n)=>{t.confirmDialog.dismiss(),t.onSkip(e,i,n)}}setupPlayable(){this.playableCard=new Os(this.vm.playableCardVM),this.playableCard.style={width:"100%",height:"100%",position:"absolute",left:0},this.playendCard.appendChild(this.playableCard),this.playendCard.layout(),this.playableCard.setVisibility("hidden")}setupPlayEndCard(){this.playendCard=new aa(this.vm.playEndCardVM),this.playendCard.style={position:"absolute",width:"100%",height:"100%",left:0},this.baseRootContainer.appendChild(this.playendCard),this.playendCard.setVisibility("hidden")}setupTopFloorView(){this.vm.topFloorVM.enableInitTopfloorContainer()&&(this.topFloorView=new un(this.vm.topFloorVM),this.topFloorView.style={position:"absolute",top:0,left:0},this.rootView.appendChild(this.topFloorView),this.vm.topFloorVM.getBottomHeigtCallback=()=>(this.vm.autocallVM.shouldShowAutoCallAppCard((t=>{if(t)return this.bottombar.getHeight()+50})),this.vm.shakeVM.needShowShakeUI()||this.vm.rotateVM.enableShowRotate()?this.bottombar.getHeight()+50:this.bottombar.getHeight()))}setupSecondClick(){this.secondclickDialog=new wa(this.vm.secondclickVM)}setupBottomBar(){this.bottomContainer=new TKView,this.bottombar=Ll.initializeBottomBar(this.vm,this.bottomContainer),this.contentView.appendChild(this.bottomContainer),this.bottomContainer.appendChild(this.bottombar)}setupAutoDialog(){this.vm.neoAutoDialogVM.enableShowWelfareCard()&&(this.autoDialogView=new Ta(this.vm.neoAutoDialogVM),this.autoDialogView.onCloseTrigger=t=>{this.hideAutoDialog()})}setupECCardDialog(){this.ecCardDialogView=new kr(this.vm.ecCardViewModel),this.ecCardDialogView.initView(),this.ecCardDialogView.onCloseTrigger=()=>{this.hideECCardDialog()}}setupLiveCouponPopUpView(){this.liveCouponPopUpView=new Dl(this.vm.liveCouponVM,(()=>{this.hideLiveCouponPopUpView()}))}setupGameCardDialog(){const t=this;this.gameCardDialogView=new Mr(this.vm.gameCardViewModel),this.gameCardDialogView.onCloseTrigger=e=>{2==e&&t.vm.gameCardViewModel.enableShowWidget()&&t.showGameWidget(),t.hideGameCardDialog()}}setupSocialCardDialog(){const t=this;this.socialCardDialogView=new Kl(this.vm.socialCardViewModel),this.socialCardDialogView.onCloseTrigger=e=>{t.hideSocialCardDialog()}}showGameWidget(){this.gameWidget=new Or(this.vm.gameCardViewModel,(t=>{let e=0==this.vm.screenOrientation,i=this.bottombar.onGetMiddleMarginBottom(e),n=this.vm.containerLimit.height+this.vm.getTopMargin();return this.shakeView&&(n-=50),this.rotateView&&(n-=50),{x:this.vm.getSideMargin(),y:n-i-t.height}})),this.contentView.appendChild(this.gameWidget);const t=this;this.gameWidget.callbackClose=()=>{t.contentView.removeChild(t.gameWidget)}}setBackPressedCallback(){this.vm.backPressedCallback=()=>{!be(this.confirmDialog)&&this.confirmDialog.vm.isShow||(this.vm.topBarVM.hasShowPlayend?this.vm.playEndCardVM.preFormViewModel&&this.vm.playEndCardVM.preFormViewModel.isSlideUp?ye()&&this.vm.playEndCardVM.preFormViewModel.backPressedCallback&&this.vm.playEndCardVM.preFormViewModel.backPressedCallback():this.vm.handleClose(!1):this.vm.topBarVM.hasCallbackGift&&this.topbar.onSkipClick())}}showPushCard(){this.pushCard=new ga(this.vm.pushCardVM),this.rootView.appendChild(this.pushCard),this.pushCard.show()}resumeVideoPlayer(){this.playerView.resume()}canShowPushCard(t){return!!this.vm.pushCardVM.canPushCard()&&!(t<this.vm.pushCardVM.pushCardDelayTime()/1e3)}switchNeoInteractVisibility(t){this.neoInteractView&&(t?this.vm.playerVM.onDialogShow(this.neoInteractView):this.vm.playerVM.onDialogDismiss(this.neoInteractView),this.neoInteractView.setVisibility(t?"visible":"hidden"))}onSkip(t,e,i){return t=t||this.vm.confirmVM.canShowGiftConfirm(),this.switchNeoInteractVisibility(!1),t?(this.confirmDialog.showDialog(this.rootView),void(this.confirmDialog.skipToEndHandler=()=>{Ne.skipVideo(t||!1,e||!1,i||0,this.vm.topBarVM.currentPlaybackTime),this.vm.topBarVM.isSkipToCloseAd()?(this.playerView.stop(),this.vm.handleClose(!0)):this.vm.showPlayEnd()})):(Ne.skipVideo(t||!1,e||!1,i||0,this.vm.topBarVM.currentPlaybackTime),this.vm.topBarVM.isSkipToCloseAd()?(this.playerView.stop(),void this.vm.handleClose(!0)):void this.vm.showPlayEnd())}onPlayStatusChange(t){1==t&&this.playerView.pause(),2!=t||"pageVisiable"!=this.vm.lifeStatus&&"showEnd"!=this.vm.lifeStatus||this.resumeVideoPlayer()}onShowPlayEndCard(){let t=!0;try{if(si(1),this.vm.topBarVM.needShowPlayEndCloseBtn=1,this.playerView.stop(),this.contentView.setVisibility("hidden"),this.shakeView&&(this.vm.shakeVM.stopListenSensor(),this.shakeView.setVisibility("hidden")),this.rotateView&&(this.vm.rotateVM.stopRotateListener(),this.rotateView.setVisibility("hidden")),this.mDanmakuView&&(this.mDanmakuView.stop(),this.mDanmakuView.setVisibility("hidden")),this.pushCard&&(this.vm.pushCardVM.isShowEnd=!0),this.vm.reportPlayEndImpression(),this.playendCard.setVisibility("visible"),this.vm.isValidPlayable()&&this.vm.isPlayableRenderSuccess())return this.playableCard.setVisibility("visible"),void this.playableCard.show();if(this.vm.playableOrientationNotMatch()){let t={creativeId:this.vm.adInfo.adBaseInfo.creativeId},e={actionType:10208,payload:JSON.stringify(t)};Ne.sendCommonLog(e)}if(this.vm.canAutoShowH5LandingPage())return void this.vm.autoShowH5LandingPage();this.vm.canAutoShowStoreKit()&&(this.vm.setNeedCloseNeo(),this.vm.autoShowStoreKit(),this.vm.playEndCardVM.canShowAggregation=!1),this.vm.canAutoShowAndroidMarket()&&(this.vm.openAppMarket(),this.vm.playEndCardVM.canShowAggregation=!1),vt(this.vm.adInfo)&&this.vm.updateExtraGivenStatus(),this.playendCard.show()}catch(e){t=!1,si(3,we(e))}finally{t&&si(2)}}videoChange(t,e,i){const n=Number(this.contentView.getSize().height),s=Number(this.contentView.getSize().width),a=n-t-e,o=a*(9/16),r=e+this.vm.getTopMargin(),h=this;this.blackBg.style={opacity:1},setTimeout((()=>{if(ye()){const t=new TKBasicAnimation;t.setStartValue((()=>{this.playerView.style={width:s,height:n}})),t.setEndValue((()=>{h.playerView.style={width:o,height:a,borderRadius:i,top:r,left:(s-o)/2}})),t.timingFunction="ease-in-out",t.duration=500,h.playerView.addAnimation(t,"VideoAnimation")}else{const t=this,e=500;t.playerView.setAnimation(e,(()=>{t.playerView.style={width:o,height:a,borderRadius:i,top:r,left:(s-o)/2}}))}const t=new TKKeyframeAnimation;t.setAnimations([()=>(h.blurBg.style={opacity:0},0),()=>(h.blurBg.style={opacity:1},1)]),t.duration=500,this.blurBg.addAnimation(t,"animationBlurImage")}),300)}halfPlayerShouldShow(){return this.vm.halfPlayerVM.shouldShowHalfPlayer()}}).render()})();
//# sourceMappingURL=ksad-neo-video-card.878.js.map