(()=>{"use strict";class t{static saveLocal(t,e){if("undefined"!=typeof TKLocalStorage&&st.supportMinimumTKVersion("4.0.0"))try{(new TKLocalStorage).set(t,e)}catch(i){}}static getLocalString(t){if("undefined"!=typeof TKLocalStorage&&st.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return e.toString()}catch(e){}return null}static getLocalInt(t){if("undefined"!=typeof TKLocalStorage&&st.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Number.parseInt(e.toString())}catch(e){}return 0}static getLocalBoolean(t){if("undefined"!=typeof TKLocalStorage&&st.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Boolean(e.toString)}catch(e){}return!1}}let e=null;const i="TKResIndexKey";class a{constructor(){var e,a,n;this.defaultHost="p1-lm.adukwai.com",this.currentIndex=0;let s=null===(n=null===(a=null===(e=F())||void 0===e?void 0:e.appConfig)||void 0===a?void 0:a.idc)||void 0===n?void 0:n.tkres;s&&0!=s.length||(s=["p1-lm.adukwai.com","p2-lm.adukwai.com"]),this.resList=s;let r=t.getLocalInt(i);r>s.length&&(r=0),this.currentIndex=r}static getInstance(){return e||(e=new a),e}getCurrentHost(){return this.currentIndex>=this.resList.length?this.defaultHost:this.resList[this.currentIndex]}markUrlFail(e){if(!(e.indexOf(this.getCurrentHost())<0||"undefined"!=typeof KSAdTKNetworkManager&&0==KSAdTKNetworkManager.getCurrentNetworkType())){const e=this.currentIndex;this.currentIndex=++this.currentIndex%this.resList.length,this.currentIndex!==e&&t.saveLocal(i,this.currentIndex)}}}var n,s;!function(t){t.START="start",t.CENTRT="center",t.END="end"}(n||(n={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(s||(s={}));var r,o,l;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.PRODUCT=1]="PRODUCT",t[t.EVENT=2]="EVENT",t[t.COUPON=3]="COUPON",t[t.PRODUCT_DEEP_VIDEO=4]="PRODUCT_DEEP_VIDEO"}(r||(r={}));class h{}h.UNKNOWN_DOWNLOAD_SOURCE=0,h.FROM_LANDING_PAGE=1,h.FROM_DIRECT_INSTALLATION=2;!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(o||(o={}));class d{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(l||(l={}));class c{}var p,C,u;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(p||(p={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(C||(C={})),function(t){t[t.unkonwn=0]="unkonwn",t[t.videoPromoteFollow=1]="videoPromoteFollow",t[t.videoPromoteGoods=2]="videoPromoteGoods",t[t.liveGoods=3]="liveGoods",t[t.liveNotGoods=4]="liveNotGoods",t[t.videoAd=5]="videoAd"}(u||(u={}));function g(t,e,i){if(console.log("tkloadcontroller target componentName:"+e+" slotId:"+i),$(e)&&!Q(i))try{const a=t.adMatrixInfo.adDataV2.componentDatas.length;for(let n=0;n<a;n++){let a=t.adMatrixInfo.adDataV2.componentDatas[n];if(a.componentName==e&&a.slotId==i)return a}}catch(a){}}class m{static isClickReward(t,e){try{let i=!0;if(st.isAndroid()&&!Q(e)&&(i=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&i)return!0}catch(i){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(i){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){try{return t.advertiserInfo.userId||0}catch(e){return 0}}static getLiveStreamId(t){try{return t.adBaseInfo.liveStreamId||""}catch(e){return""}}static getLiveServiceToken(t){try{return t.adConversionInfo.liveServiceToken||""}catch(e){return""}}static getLiveUserId(t){try{return t.adConversionInfo.liveVisitorId||0}catch(e){return 0}}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!Q(e)&&m.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),Q(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=$(e)?e:t.advertiserInfo.rawUserName}catch(i){}return e=$(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(Q(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return Q(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=L(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let i="";try{i=t.neoLiveAuthorInfoData.authorName}catch(a){}try{Q(i)&&(i=t.neoLiveCartDetailData.authorName)}catch(a){}try{Q(i)&&(i=e.adBaseInfo.appName)}catch(a){}return i}static liveGetLiveDesc(t,e){let i="";try{i=t.neoLiveCartDetailData.liveDesc}catch(a){}try{Q(i)&&(i=t.neoLiveAuthorInfoData.liveDesc)}catch(a){}try{Q(i)&&(i=t.adDescription)}catch(a){}try{Q(i)&&(i=e.adBaseInfo.adDescription)}catch(a){}return i}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!Q(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!Q(e))return e}catch(e){}return null}static getNeoAutoDialogType(t){var e;if(function(t){try{const e=t.adMatrixInfo.adDataV2.styleComponentInfo;if(e&&e.styleComponentFlag)return!0}catch(e){}return!1}(t)){if(g(t,"reward-dialog-common",5))return 1;if(g(t,"reward-dialog-fund",5))return 2}else try{let i=0;if(m.isOriginLiveAd(t))i=null===(e=t.adMatrixInfo.adDataV2.videoLiveTKInfo)||void 0===e?void 0:e.neoAutoDialogType;else{let e=w(t);i=1==e?t.adMatrixInfo.adDataV2.neoTKInfo.neoAutoDialogType:2==e?t.adMatrixInfo.adDataV2.videoImageTKInfo.neoAutoDialogType:0}1!=i&&2!=i&&(i=0);let a=function(t){if(null==t)return null;try{let e=null;if(m.isOriginLiveAd(t))e=A(t,14);else{let i=w(t);2==i?e=A(t,16):1==i&&(e=A(t,12))}if(e){let i=N(e,t);return JSON.parse(i.data).neoAutoDialog}}catch(e){}return null}(t);return 1==i&&Q(a.neoAutoDialogGiftPic)&&Q(a.neoAutoDialogGiftTitle)&&(i=0),i}catch(i){}return 0}static hasNeoAutoDialog(t){let e=m.getNeoAutoDialogType(t);return!Q(e)&&0!=e}static newDeepVideoInteractCardInfo(t,e){if(Q(t)||Q(e))return null;let i;if(i=JSON.parse(JSON.stringify(Object.assign(t,e))),i.merchantStyleType=r.PRODUCT_DEEP_VIDEO,i.interactiveCardShowTime=0,i.rightsCardCustomImageUrl=t.icon,i.rightsCardCustomContent=t.name,i.rightsCardProductIconDesc="热卖",Q(t.rating))i.rightsCardProductTags=t.serviceInfoList;else{let e=[t.rating];i.rightsCardProductTags=e.concat(t.serviceInfoList)}return i}}function f(t,e){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;let i=null;if(e)for(let a=0;a<t.impAdInfo.length;++a){let n=t.impAdInfo[a];if(n.adInfo.length>0&&n.adInfo[0].adBaseInfo.creativeId==e){i=n;break}}return i||(i=t.impAdInfo[0]),i}function I(t){var e;return(null===(e=null==t?void 0:t.adInfo)||void 0===e?void 0:e.length)>0?t.adInfo[0]:null}function T(t){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;const e=t.impAdInfo[0];return(null==e?void 0:e.adInfo)&&0!=e.adInfo.length?e.adInfo[0]:null}function w(t){try{return t.adMaterialInfo.materialFeature[0].featureType}catch(e){}return 0}function _(t){try{return!$(t.firstFrame)||t.firstFrame.includes(".kpg")||t.firstFrame.includes(".webp")?$(t.coverUrl)?t.coverUrl:t.coverUrl||t.materialUrl||"":t.firstFrame}catch(e){}return""}function v(t){try{return t.adMaterialInfo.materialFeature[0].videoDuration}catch(e){}return 0}function y(t){let e=null;try{switch(t.adBaseInfo.adOperationType){case 1:e=t.adBaseInfo.appName;break;case 2:e=t.adBaseInfo.productName}$(e)||(e=t.advertiserInfo.rawUserName)}catch(i){}return e||"可爱的广告君"}function S(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function A(t,e){let i;try{switch(e){case 1:i=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId;break;case 12:i=t.adMatrixInfo.adDataV2.neoTKInfo.templateId;break;case 3:i=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId;break;case 2:i=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId;break;case 4:i=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId;break;case 6:case 9:i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId;break;case 5:i=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId;break;case 7:i=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId;break;case 10:i=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId;break;case 11:i=t.adMatrixInfo.adDataV2.pushTKInfo.templateId;break;case 13:i=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId;break;case 14:i=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId;break;case 15:i=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId;break;case 16:i=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId;break;case 100:i=t.adMatrixInfo.adDataV2.complianceCardInfo.templateId;break;case 101:i=t.adMatrixInfo.adDataV2.downloadConfirmCardInfo.templateId;break;case 17:i=t.adMatrixInfo.adDataV2.feedTKCardInfo.templateId;break;default:i=void 0}}catch(a){i=void 0}return i}function L(t,e){let i=A(t,e);if(console.log("tkloadcontroller target templateid:"+i),!$(i))return;const a=t.adMatrixInfo.adDataV2.templateDatas.length;for(let n=0;n<a;n++){let e=t.adMatrixInfo.adDataV2.templateDatas[n];if(e.templateId==i)return e}}function k(t,e){let i=A(t,e);if(!i)return null;console.log("tkloadcontroller   get template is:"+i);const a=t.adMatrixInfo.styles.templates.length;for(let n=0;n<a;n++){let e=t.adMatrixInfo.styles.templates[n];if((null==e?void 0:e.templateId)==i)return e}return null}function b(t){const e=t.adMaterialInfo.materialFeature.length>0?t.adMaterialInfo.materialFeature[0]:null;if(e){let a=e.videoDuration;0==a&&(a=e.videoDurationMs/1e3);let n=a;try{n=t.adRewardInfo.rewardTime}catch(i){}return n?0==a?n:Math.min(a,n):a}return-1}function D(t,e){let i=!0;if(1==t.adBaseInfo.adOperationType)try{let a=t.downloadSafeInfo.complianceInfo;if(console.log("tkloadcontroller   download ad:"+JSON.stringify(a)),null!=a)switch(e){case 1:i=3!=a.actionBarType;break;case 2:i=3!=a.describeBarType;break;case 3:i=3!=a.materialJumpType;break;default:i=!0}}catch(a){i=!0}else try{let a=t.unDownloadConf.unDownloadRegionConf;if(console.log("tkloadcontroller   h5 ad:"+JSON.stringify(a)+", clickArea: "+e),null!=a)switch(e){case 1:i=1!=a.actionBarType;break;case 2:i=1!=a.describeBarType;break;case 3:i=1!=a.materialJumpType;break;default:i=!0}console.log("tkloadcontroller   h5 ad:"+i)}catch(a){i=!0}return i}function E(t){return m.isOriginLiveAd(t)||function(t){return 7==S(t)}(t)}function N(t,e){try{let i=e.adMatrixInfo.adDataV2.templateDatas;for(let e=0;e<i.length;e++){let a=i[e];if(a&&t==a.templateId)return a}}catch(i){}}var R=null,B=null,O=null,V=null,K=null;function P(t){console.log("tkloadcontroller  save global device info:"+JSON.stringify(t)),R=t}function M(){return K}function x(){return R}function F(){return B}function W(){return V}function U(){const t=Tachikoma.env.styleTemplate;return t?JSON.parse(t):null}function G(t,e){e=e||U(),t=t||T(W());const i=null==e?void 0:e.templateId,a=null==e?void 0:e.templateVersionCode,n=null==t?void 0:t.adTKGrayConfig,s=i+"#"+a;return(null==n?void 0:n.get(s))||0}function H(){return Date.parse((new Date).toString())}function J(t){return t instanceof Error?t.message+":"+t.stack:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function Y(){var t;return!z()&&(null===(t=Tachikoma.env.safeAreaInsets)||void 0===t?void 0:t.bottom)>0}function j(){return!Q(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function z(){return"Android"===Tachikoma.env.platform}function $(t){return"string"==typeof t&&t.length>0}function X(){return R?R.tkVersion:Tachikoma.env.tkVersion||Tachikoma.env.TKVersion}function q(){return R?R.SDKVersion:Tachikoma.env.SDKVersion}function Z(){return R?R.sdkType:Tachikoma.env.sdkType}function Q(t){return null===t||null==t||""===t}new class{};class tt{constructor(t,e,i){this.name=t,this.object=e,this.parent=i,this.children=new Map}addChildren(t,e){this.children.set(t,e)}}function et(t,e,i){if(t){e||(e=new tt("root",t)),i||(i=new Set),i.add(t);for(const a in t){const n=typeof t[a],s=t[a];if("object"==n&&!a.includes("$")&&s){s.nativeID||(s.nativeID=a);const t=new tt(a,s,e);if(e.addChildren(a,t),i.has(s)){const e=[];e.push(t);let i=t,a=!1;for(;i.parent;)if(i=i.parent,e.push(i),i.object===t.object){a=!0;break}if(a){let t="执行出错：发生循环引用\n";for(let a=e.length-1;a>=0;--a)i=e[a],t+=i.name+":"+i.object+"\n";throw new Error(t)}}et(s,t,i)}}}}function it(){return 1==Tachikoma.env.isDebug}function at(t){let e=t;return e.indexOf("/")>=0||t.startsWith("http")||(e="https://"+a.getInstance().getCurrentHost()+"/kos/nlav111362/ksad/"+t),e}function nt(t,e){!function(t,e,i){if(t&&e){const n=at(e);t.setImageLoadCallback&&!Q(n)&&n.startsWith("http")&&t.setImageLoadCallback((t=>{a.getInstance().markUrlFail(n),i&&i(t)})),t.setSrc(n)}}(t,e,null)}class st{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||st.supportMinimumTKVersion("5.0.4")}static isSupportDownloadDel(){return this.isAndroid()&&st.supportMinimumTKVersion("5.0.7")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let i=t.split("."),a=e.split("."),n=Math.max(i.length,a.length);for(var s=0;s<n;s++){let t=Number(void 0!==i[s]?i[s]:"0"),e=Number(void 0!==a[s]?a[s]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let i=Z(),a=1==i&&-1!=st.compareVersion(q(),t),n=2==i&&-1!=st.compareVersion(q(),e);return a||n}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let i=Z(),a=1==i&&0==st.compareVersion(q(),t),n=2==i&&0==st.compareVersion(q(),e);return a||n}static supportCurrentTKVersion(t="0.0.0"){return X()==t}static supportMinimumTKVersion(t="0.0.0"){return-1!=st.compareVersion(X(),t)}}st.platform=Tachikoma.env.platform;at("h5_default_icon.png"),at("download_default_icon.png");var rt,ot,lt,ht;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PORTRAIT_CLICK=13]="PORTRAIT_CLICK",t[t.COMMENT_CLICK=14]="COMMENT_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.COMMENT_DETAIL_CLICK=25]="COMMENT_DETAIL_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.COMMON_CARD_CLICK=89]="COMMON_CARD_CLICK",t[t.COMMENT_PICTURE_CLICK=100]="COMMENT_PICTURE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA",t[t.POPLAY_FALL_IOCN=186]="POPLAY_FALL_IOCN",t[t.ROTATE_SHAKE_BIG_ICON_CLICK=187]="ROTATE_SHAKE_BIG_ICON_CLICK",t[t.RETAIN_AGG_CARD_CLICK=189]="RETAIN_AGG_CARD_CLICK",t[t.PLAYEND_AGG_CARD_CLICK=190]="PLAYEND_AGG_CARD_CLICK",t[t.SURPRISE_BOX_CLICK=191]="SURPRISE_BOX_CLICK",t[t.BUBBLE_RAIN_CLICK=192]="BUBBLE_RAIN_CLICK"}(rt||(rt={})),function(t){t[t.adClickReward=1]="adClickReward"}(ot||(ot={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(lt||(lt={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(ht||(ht={}));var dt,ct,pt;!function(t){t[t.THREEIMG_DEFAULT_CLICK=0]="THREEIMG_DEFAULT_CLICK",t[t.THREEIMG_FIRST_CLICK=1]="THREEIMG_FIRST_CLICK",t[t.THREEIMG_SECOND_CLICK=2]="THREEIMG_SECOND_CLICK",t[t.THREEIMG_THIRD_CLICK=3]="THREEIMG_THIRD_CLICK"}(dt||(dt={})),function(t){t[t.picStyle=1]="picStyle",t[t.textStyle=2]="textStyle"}(ct||(ct={})),function(t){t[t.GRAYBG_ONE_LINE=1]="GRAYBG_ONE_LINE",t[t.GRADIENT_ONE_LINE=2]="GRADIENT_ONE_LINE",t[t.GRADIENT_TWO_LINE=3]="GRADIENT_TWO_LINE"}(pt||(pt={}));const Ct=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t),it()&&console.log("tkloadcontroller:"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class ut{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i="",a=0;a<t;a++)i+=e.charAt(Math.floor(48*Math.random()));return i}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,i){if(!t)return null;const a=this.randomName(i);return Tachikoma[a]=e=>{t(e)},"Tachikoma."+a}}ut.globalIndex=0;class gt{static getDeviceInfoAsync(){return gt.callNative("getDeviceInfo",null).then((t=>(t.result&&t.data&&P(t.data),t)))}static getKsAdDataAsync(){return gt.callNative("getKsAdData",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,V=e),t}))}static getKsAdConfigAsync(){return gt.callNative("getKsAdConfig",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,B=e),t}))}static getScreenOrientationAsync(){return gt.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return gt.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return gt.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return gt.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.lifeStatusCallback=t,this.callNativeWithCallback("registerLifecycleListener",null,(t=>{this.lifeStatusCallback&&!this.isForceUpdateLifeStatus&&this.lifeStatusCallback(t)}),!1)}static forceUpdateLifeStatus(t,e){let i={result:1,data:{lifeStatus:t}};this.isForceUpdateLifeStatus=e,this.lifeStatusCallback&&this.lifeStatusCallback(i)}static registerFocusListener(t){st.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("registerFocusListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,i,a=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},i,a)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static adOutCallback(t,e){st.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("adOutCallback",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:$(e)?e:""})}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,(e=>{t&&t(e)}),!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,i,a=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:i,playDuration:a})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e,i){this.callNativeWithCallback("openURL",{url:t,title:e,showConfirmDialog:i})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){z()&&this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((i,a)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),i(t)):i({result:0,data:null})}))))}static callNativeWithCallback(t,e,i,a=!0){const n=j()?1:0;j()&&"pageStatus"==t||j()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,i,a,0):this.callNativeWithCallbackAndType(t,e,i,a,n)}static callTKWithCallback(t,e,i,a=!0){this.callNativeWithCallbackAndType(t,e,i,a,1)}static callNativeWithCallbackAndType(t,e,i,a=!0,n=0){if("undefined"==typeof KwaiAd)return Ct.log("undefined value KwaiAd"),void(i&&i({result:0,data:null}));Ct.log("call:"+t);let s=e=>{let a=0,n=null,s=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,a=t.result,n=t.data,s=t.error_msg}catch(r){a=0,n=null}Ct.log("cb:"+t+"  r:"+a),i&&i({result:a,data:n,error_msg:s})};const r=ut.registerCallbackForAction(s,a,t),o={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?s:r};0==n?KwaiAd.callAdBridge(o):KwaiAd.callTKBridge(o)}}function mt(t){gt.callNativeWithCallback("showToast",{message:t})}function ft(){gt.callNativeWithCallback("callbackAfterHandleAdClick",{})}let It;function Tt(){var t;return It||(It={all:t=t||new Map,on(e,i){const a=t.get(e);a?a.push(i):t.set(e,[i])},off(e,i){const a=t.get(e);a&&(i?a.splice(a.indexOf(i)>>>0,1):t.set(e,[]))},emit(e,i){let a=t.get(e);a&&a.slice().map((t=>{t(i)})),a=t.get("*"),a&&a.slice().map((t=>{t(e,i)}))},clear(){t.clear()}}),It}class wt{constructor(t,e,i,a,n,s,r){this.soundEnable=!1,this.ignoreCompliance=!1,this.disableDownloadDialog=!1,this.disableLeaveConfirm=!1,this.disableVideoWebPage=!1,this.disableActivityMiddlePage=!1,this.originAdInfo=t,this.deviceInfo=e,this.serverConfig=i,this.creativeId=s;let o=f(this.originAdInfo,s);this.adInfo=I(o),this.adCacheId=r||Tachikoma.env.adCacheId,this.originAdInfo.adCacheId=this.adCacheId,this.appId=n||Tachikoma.env.appId,this.scene=a,a||(Tachikoma.env.adScene?this.scene=JSON.parse(Tachikoma.env.adScene):this.scene={adStyle:o.adStyle,backUrl:""})}getCommercialLogInfo(){const t=new _t;t.creativeId=this.creativeId,t.llsid=this.originAdInfo.llsid,t.posId=this.originAdInfo.impAdInfo[0].posId;const e=this.adInfo.adConversionInfo.h5SecondConfirmationSwitch;return t.landingPageType=e?0:1,this.sourceTemplate&&(t.templateId=this.sourceTemplate.templateId,t.templateVersion=this.sourceTemplate.templateVersionCode,t.tkPublishType=G(this.adInfo,this.sourceTemplate)),t}getOcpcActionType(){try{return this.adInfo.ocpcActionType}catch(t){return 0}}getCampaignType(){try{return this.adInfo.adBaseInfo.campaignType}catch(t){return 0}}getIndustryFirstLevelId(){try{return this.adInfo.adBaseInfo.industryFirstLevelId}catch(t){return 0}}getAdOperationType(){try{return this.adInfo.adBaseInfo.adOperationType}catch(t){return 0}}}class _t{}class vt{constructor(){this.reward_type=-1,this.task_type=-1,this.task_step=-1}static createPageShowInstance(t,e,i){if(0==e||Q(i))return null;if(i.loadDataTime<=0||i.downloadFinishTime<=0)return null;let a=this.INVALID_VALUE;if(e!=this.INVALID_VALUE){a=Date.parse((new Date).toString())-e,a<this.INVALID_VALUE&&(a=this.INVALID_VALUE)}let n=new vt;return n.page_status=2,n.load_type=i.loadFromCache?2:1,n.render_duration_ms=a,n.download_type=i.downloadType,n.download_size=i.downloadSize,n.creative_id=t.adBaseInfo.creativeId,n.video_url=function(t){try{return t.adMaterialInfo.materialFeature[0].materialUrl}catch(e){}return""}(t),n.video_duration_ms=v(t),n}}function yt(t,e,i,a,n=!0){let s=.01;"component_empty"==t&&(s=1);St({category:1==s?"ad_client_error_log":"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:s,suffixRatio:"",event_id:"ad_tk_uicomponent_track",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{is_component:n?1:0,event_name:null!=t?t:"",scene_type:null!=e?e:"",page_id:null!=i?i:"",component_name:null!=a?a:""}})}function St(t){st.supportMinimumTKVersion("4.0.4")&&(t.msg&&(t.msg.report_source=1),gt.sendCommercialLog(t,(()=>{})))}vt.INVALID_VALUE=-1;class At{static createVideoCommonInstance(t,e){return 3==t?At.createFullscreenCommonInstance(e):2==t?At.createNeoCommonInstance(e):null}static createImageCommonInstance(t,e){var i;let a=new d;return a.template_id=A(e,16),a.template_version=null===(i=k(e,16))||void 0===i?void 0:i.templateVersion,a}static createLiveCommonInstance(t,e){var i;let a=new d;return a.template_id=A(e,14),a.template_version=null===(i=k(e,14))||void 0===i?void 0:i.templateVersion,a}static createNeoCommonInstance(t){var e;let i=new d,a=m.getNeoActionBarCardType(t);return i.actionbar_card_type=a,i.template_id=A(t,12),i.template_version=null===(e=k(t,12))||void 0===e?void 0:e.templateVersion,a!=p.LIVE_CUT3_STYLE1&&a!=p.LIVE_CUT3_STYLE2||(i.live_room_pattern=l.SIMPLIFIED_LIVE_ROOM_PATTERN),i}static createFullscreenCommonInstance(t){let e=new d,i=m.getFullscreenActionBarCardType(t);return e.actionbar_card_type=i,i!=p.LIVE_CUT3_STYLE1&&i!=p.LIVE_CUT3_STYLE2||(e.live_room_pattern=l.SIMPLIFIED_LIVE_ROOM_PATTERN),e}static appendNeoExtData(t,e,i,a){if(null==t)return;let n=t.neo_ext_data;null==n&&(n=new c,t.neo_ext_data=n),i&&(n.videoRollbackToImageTimeout=i.videoRollbackToImageTimeout),n.originalMaterialType=w(e),a&&n&&a(n)}}var Lt=function(t,e,i,a){return new(i||(i=Promise))((function(n,s){function r(t){try{l(a.next(t))}catch(e){s(e)}}function o(t){try{l(a.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}l((a=a.apply(t,e||[])).next())}))};class kt{static sendLog(t,e,i,a){this.log(t,null,e,i,a)}static log(t,e,i,a,n){(i=i||{}).renderContainer=1;const s={actionType:t,payload:JSON.stringify(i)};if(n&&(s.creativeId=n),a)if(null==a?void 0:a.adCacheId)s.adCacheId=null==a?void 0:a.adCacheId;else{const t=f(a,n);s.adTemplate=JSON.stringify(t)}e&&(s.clickInfo=e),gt.sendLog(s)}static convertIfNeeded(t,e,i,a,n,s,r,o,l,h,c){let p=D(e,i);if(!p)return p;let C=O;return Q(C)||(s||(s=new d),Q(s.template_id)&&(s.template_id=C.templateId),Q(s.template_version)&&(s.template_version=C.templateVersion)),s=kt.appendGlobalNeoExtData(s,e),E(e)&&this.reportLivePlaySecond(this.sCurrentPlayTimeMs/1e3),this.convert(i,a,n,t,s,r,o,l,h,c),p}static convert(t,e,i,a,n,s,r,o,l,h){var d,c;return Lt(this,void 0,void 0,(function*(){const p=I(f(W(),o));if(!p||!D(p,t))return void console.log("tkloadcontroller invalid convert:"+p+":"+t);let C,u;C=Q(n)?{itemClickType:i,renderContainer:1}:{itemClickType:i,renderContainer:1,clientExtData:JSON.stringify(n)},Q(s)||Object.assign(C,s),Tt().emit("ad_convert_event",{clickType:i}),e?(u={x:e.x,y:e.y},e.width&&(u.width=e.width),e.height&&(u.height=e.height)):u={};let g=-1;(null==r?void 0:r.convertType)&&(g=r.convertType,C.triggerType=g);let m=!1;if(this.matchTKConversion()){console.log("tkloadcontroller match conversion service");let i=KSAdTKBundleService.getInstance("CommercialKSAdConversionService","conversion-service",null);if(i){console.log("tkloadcontroller service instance is:"+i);const n=new wt(l||W(),x(),F());n.currentPlayTime=this.sCurrentPlayTimeMs,n.clickScene=a,n.convertType=g,n.creativeId=o,n.clickArea=t,n.soundEnable=this.sSoundEnable,n.sourceTemplate=U(),(null==r?void 0:r.liveItemId)&&(n.liveItemId=r.liveItemId),Tachikoma.env.isDebug&&mt("TK转化链路开始"),i.getVersion()>=2&&(this.sSecondClickCallback=t=>{0==t?gt.forceUpdateLifeStatus("pageInvisiable",!0):1==t?gt.forceUpdateLifeStatus("pageInvisiable",!1):2==t&&(gt.forceUpdateLifeStatus("pageVisiable",!1),st.supportMinimumTKVersion("6.0.3")&&!st.isAndroid()&&ft())},i.setSecondConfirmCallback(this.sSecondClickCallback),i.getVersion()>=3&&st.supportMinimumTKVersion("5.1.3")&&z()&&(this.sDownloadTipCallback=t=>{switch(t){case 0:gt.adOutCallback({targetMethod:"adDownloadConfirmTipShow"});break;case 2:gt.adOutCallback({targetMethod:"adDownloadConfirmTipCancel"});break;case 1:gt.adOutCallback({targetMethod:"adDownloadConfirmTipDismiss"})}},i.setDownloadConfirmTipCallback(this.sDownloadTipCallback))),this.sHandleAdClickCallback=t=>{if(this.sCurrentPlayTimeMs>0&&(C.playedDuration=this.sCurrentPlayTimeMs),t.reportExtraParam)try{let e=Q(C.clientExtData)?{}:JSON.parse(C.clientExtData);e.clientExtData=JSON.parse(t.reportExtraParam),C.clientExtData=JSON.stringify(e)}catch(i){!function(t,e="",i=""){var a,n;St({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_tk_render_performance",primaryKey:"unknown",type:"OTHER",msg:{render_state:3,error_reason:J(t),template_id:Q(i)?null===(a=U())||void 0===a?void 0:a.templateId:i,version_code:Q(e)?null===(n=U())||void 0===n?void 0:n.templateVersionCode:e}})}(i)}this.log(2,e,C),st.isAndroid()||this.handleIOSConvertCallback(t)},this.sAfterHandleClickCallback=()=>{st.supportMinimumTKVersion("6.0.3")&&!st.isAndroid()&&ft()},i.getVersion()>=4&&i.setAfterHandleClickCallback(this.sAfterHandleClickCallback),i.handleAdClick(JSON.stringify(n),this.sHandleAdClickCallback),m=!0}else this.loadConversionServiceIfNeeded((t=>{console.log("tkloadcontroller service load result:"+t)}))}let w=null==l?void 0:l.impAdInfo[0];o||(o=null===(c=null===(d=T(l||W()))||void 0===d?void 0:d.adBaseInfo)||void 0===c?void 0:c.creativeId),function(t,e,i,a,n,s,r,o){e.isCallbackOnly=o,gt.clickActionBase(Object.assign(Object.assign({area:t,logParam:e},i),{creativeId:a,adTemplate:s,disableCallback:r,isCallbackOnly:o}),n)}(t,{payload:JSON.stringify(C),clickInfo:u,sceneType:a,itemClickType:i},r,o,(i=>{1!=i.result&&(this.log(2,e,C),gt.convert(1==t))}),w,h,m)}))}static handleIOSConvertCallback(t){t.success&&3==t.interactionType&&gt.adOutCallback({targetMethod:"closeConvertPageCallback",methodParams:JSON.stringify({interactionType:t.interactionType})})}static reportClick(t,e,i,a){null==a&&(a=new d),a=kt.appendGlobalNeoExtData(a,t);let n={clientExtData:JSON.stringify(a)};n=Object.assign(n,i),kt.log(2,null,n)}static appendGlobalNeoExtData(t,e){let i=F(),a=M();return null!=a&&null!=i&&(t||(t=new d),At.appendNeoExtData(t,e,i.abConfig,(t=>{t.realRenderResult=a}))),t}static expose(t,e){this.log(1,null,t,e)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,i,a,n){this.convertWithType(e,i,a,n)}static convertWithType(t,e,i,a){this.convert(t,e,i,0,null,null,{convertType:a})}static convertWithTypeIfNeededNew(t,e,i,a,n,s){D(t,e)&&this.convertWithTypeNew(e,i,a,n,s)}static convertWithTypeNew(t,e,i,a,n){this.convert(t,e,i,0,null,n,{convertType:a})}static playNSecond(t,e){let i={photoPlaySecond:t};if(e){let t={clientExtData:JSON.stringify(e)};Object.assign(i,t)}this.log(402,null,i)}static playStart(t){let e=null;t&&(e={clientExtData:JSON.stringify(t)}),kt.log(399,null,e)}static reportLivePlaySecond(t){let e={photoPlaySecond:Math.round(t)},i={actionType:28,payload:JSON.stringify(e)};gt.sendLog(i)}static skip(){this.log(501,null,null)}static loadConversionServiceIfNeeded(t){this.matchTKConversion()&&KSAdTKBundleService.loadBundle("CommercialKSAdConversionService",t),t&&t(!1)}static matchTKConversion(){var t,e;return!!(null===(e=null===(t=F())||void 0===t?void 0:t.abConfig)||void 0===e?void 0:e.tkConversionSwitch)&&(!(!z()||!st.supportMinimumTKVersion("6.0.5"))||!z()&&st.supportMinimumTKVersion("6.0.3"))}static updateVideoPlayStatus(t,e,i,a){!function(t,e,i,a){gt.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:i||"",currentTime:a||0})}(t,e,i,a),"progress"==t&&a&&(this.sCurrentPlayTimeMs=a)}static updateLivePlayStatus(t,e,i,a){"progress"==t&&a&&(this.sCurrentPlayTimeMs=a)}}kt.sSoundEnable=!1;class bt{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,gt.pageStatus(t,e),this.registerNativeId(),kt.loadConversionServiceIfNeeded((t=>{})))}registerNativeId(){it()&&st.supportMinimumTKVersion("4.0.7")&&!st.isAndroid()&&(this.startConfig(),gt.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{et(this)}),120)}}class Dt extends Object{constructor(t,e,i,a){var n;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=i,this.value=this.get(),this.cb(null!==(n=this.value)&&void 0!==n?n:a,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){Dt.target=this;const t=this.getter.call(this.vm,this.vm);return Dt.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let i=0,a=e.length;i<a;i++){if(!t)return;t=t[e[i]]}return t}}}function Et(t){return!!t}let Nt;function Rt(){if(null!=Nt)return Nt;let t=!1;try{t=!1,Nt=t}catch(e){}return t}function Bt(t,e){if(!0===Rt()&&(null==t||!1===t))throw new Error("tkmvvm ----- 请检查传值: "+e)}function Ot(t){Rt()&&console.log("tachikoma TKMVVM log -> "+t)}class Vt extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var i=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(a){e?e===a&&i.observeValueWithKey(t,a):i.observeValueWithKey(t,a)}))}observeValueWithKey(t,e){let i=t[e];var a=new Pt(e);Mt(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return Dt.target&&a.depend(),i},set:function(t){t!==i&&(i=t,a.notify(),Mt(t))}})}defineArray(t){if(t)for(let e=0,i=t.length;e<i;e++)Mt(t[e])}}var Kt=0;class Pt extends Object{constructor(t){super(),this.key=t,this.pid=Kt++,this.deps=new Array}depend(){Dt.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function Mt(t,e){if(!t||"object"!=typeof t)return;var i;if(!("object"==typeof(i=t)&&Object.keys(i).length>0))return;let a=!1,n=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(n)&&(a=t[n]),!a)return Ot("observe "+n),t[n]=!0,new Vt(t,e);Ot("already observe "+n)}class xt extends Object{constructor(){super()}tk_observe(t){Et(t)&&(t in this?Mt(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}function Ft(t,e,i){if(!Et(t)||!Et(e)||!Et(i))return;const a=Wt(e),n=null==a?void 0:a.split(".");if(!n)return void Bt(n,"tk_bind error, check bind path");const s=n[0];t.tk_observe(s),new Dt(t,a,((t,e)=>{i&&i(t)}))}function Wt(t){let e=function(t){if(t)return t.bind_path?t.$bind_path:"string"==typeof t?t:void 0}(t);if(e)return e;Bt(e,"tk_bind error, check bind path")}class Ut extends TKView{constructor(t,e,i,a="#30303099",n="#FFFFFF",s){super(),this.adInfo=t,this.isVertical=0==e,this.backgroundColor=a,this.color=n,this.shadow=s,this.containerWidth=i,this.setupView(),this.setupData()}setupView(){this.style={opacity:.6,flexDirection:"column",backgroundColor:this.backgroundColor,borderRadius:4,padding:10};let t=this.style.width;if("number"==typeof t)this.containerWidth=t;else if("string"==typeof t)if(isNaN(Number(t))){if("%"!=t.slice(-1))return;this.containerWidth*=Number(t.slice(0,-1))/100}else this.containerWidth=Number(t);if(this.addEventListener("tap",(()=>{})),this.appInfoLabel=this.createLabel(this.color),this.isVertical&&(this.appInfoLabel.style={flexShrink:1,textLineClamp:1,textOverflow:"ellipsis"},this.appInfoLabel.text=this.appendNameText(""),this.appInfoLabel.text=this.appendDeveloperText(this.appInfoLabel.text),$(this.appInfoLabel.text)&&st.supportMinimumTKVersion("5.0.0")))try{this.appInfoLabel.measureForText(this.appInfoLabel.text,this.containerWidth,2).startIndex>1&&(this.appendChild(this.appInfoLabel),this.isTooLong=!0)}catch(e){console.error("ignore"+new Error(e).stack)}this.otherLabel=this.createLabel(this.color),this.otherLabel.style={marginRight:10},this.appendChild(this.otherLabel),$(this.shadow)&&(this.otherLabel.style={shadow:this.shadow})}createLabel(t){let e=new TKText;return e.style={color:t,fontSize:10,textLineHeight:16},e}setupData(){let t="";if(this.isVertical?(this.isTooLong||(t=this.appendNameText(t),t=this.appendDeveloperText(t)),t=this.appendRecordText(t)):(t=this.appendNameText(t),t=this.appendDeveloperText(t),t=this.appendRecordText(t)),st.supportMinimumTKVersion("4.0.5")?$(this.adInfo.downloadSafeInfo.appVersion)&&(t+="| 版本 "+this.adInfo.downloadSafeInfo.appVersion):$(this.adInfo.adBaseInfo.appVersion)&&(t+="版本 "+this.adInfo.adBaseInfo.appVersion),Q(this.adInfo.downloadSafeInfo.introductionInfoUrl)&&Q(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&Q(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.span=new TKSpan,!Q(this.adInfo.downloadSafeInfo.introductionInfoUrl)){const e=t.length;t+="功能";const i=t.length;Q(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&Q(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.introductionClickSpanItem=new TKSpanItem,this.introductionClickSpanItem.spanType="click",this.introductionClickSpanItem.start=e,this.introductionClickSpanItem.end=i,this.introductionClickSpanItem.color=this.color,this.introductionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.introductionInfoUrl,"功能介绍")})),this.span.addSpan(this.introductionClickSpanItem)}if(!Q(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)){const e=t.length;t+="权限";const i=t.length;Q(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.permissionClickSpanItem=new TKSpanItem,this.permissionClickSpanItem.spanType="click",this.permissionClickSpanItem.start=e,this.permissionClickSpanItem.end=i,this.permissionClickSpanItem.color=this.color,this.permissionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPermissionInfoUrl,"权限信息")})),this.span.addSpan(this.permissionClickSpanItem)}if(!Q(this.adInfo.downloadSafeInfo.appPrivacyUrl)){const e=t.length;t+="隐私";const i=t.length;t+=" ",this.privacyClickSpanItem=new TKSpanItem,this.privacyClickSpanItem.spanType="click",this.privacyClickSpanItem.start=e,this.privacyClickSpanItem.end=i,this.privacyClickSpanItem.color=this.color,this.privacyClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPrivacyUrl,"隐私政策")})),this.span.addSpan(this.privacyClickSpanItem)}this.otherLabel.setSpan(t,this.span)}appendNameText(t){return st.supportMinimumTKVersion("4.0.5")?$(this.adInfo.downloadSafeInfo.appName)&&(t+=this.adInfo.downloadSafeInfo.appName+" "):$(this.adInfo.adBaseInfo.appName)&&(t+=this.adInfo.adBaseInfo.appName+" "),t}appendDeveloperText(t){return st.supportMinimumTKVersion("4.0.5")?$(this.adInfo.downloadSafeInfo.corporationName)&&(t+=this.adInfo.downloadSafeInfo.corporationName+" "):$(this.adInfo.adBaseInfo.corporationName)&&(t+=this.adInfo.adBaseInfo.corporationName+" "),t}appendRecordText(t){return st.supportMinimumTKVersion("4.0.5")&&$(this.adInfo.downloadSafeInfo.recordNumber)&&(t+=this.adInfo.downloadSafeInfo.recordNumber+" "),t}}class Gt extends TKView{constructor(){super(),this.style={alignItems:"center",justifyContent:"center"},this.imageView=new TKImage,this.appendChild(this.imageView)}setImageSize(t){this.imageView.style={width:t.width,height:t.height}}setImageSrc(t){nt(this.imageView,t)}setImageSrcAndSize(t,e){this.setImageSize(e),this.setImageSrc(t)}configImage(t){t&&t(this.imageView)}}class Ht extends TKView{constructor(){super(),this.style={height:28,bottomLeftRadius:14,topLeftRadius:14,backgroundColor:"#30303099",flexDirection:"row",alignItems:"center"};const t=new TKImage;t.style={marginLeft:5,width:18,height:18},t.setSrc("image/ksad-video-top-bar/icon_ksad_gift_small.png"),this.appendChild(t);const e=new TKText;e.style={color:"#FFFFFF",fontSize:14,marginLeft:4,marginRight:8},e.setText("观看完视频可获得奖励"),this.appendChild(e),this.addEventListener("tap",(()=>{}))}}const Jt=28;class Yt extends TKView{constructor(t){if(super(),this.callActionTimer=0,this.hasShowCallBtn=!1,this.closeTimer=0,this.hasShowCloseBtn=!1,this.expcetedHeight=44,this.playEndCloseHadDelayShow=!1,this.isFinishAdvance=!1,this.vm=t,this.hasReward=!1,this.btnMargin=this.vm.isDeepRewardTask()?8:12,this.currentTime=0,this.actionState=-1,this.style={position:"absolute",top:0,left:0,right:0,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.topBarContainer=new TKView,this.topBarContainer.style={width:"100%",height:44,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.appendChild(this.topBarContainer),this.leftContainer=new TKView,this.leftContainer.style={height:Jt,marginLeft:16-this.btnMargin/2,alignItems:"center",justifyContent:"center",flexDirection:"row"},this.topBarContainer.appendChild(this.leftContainer),this.rightContainer=this.getRightContainer(),this.topBarContainer.appendChild(this.rightContainer),this.videoDuration=this.vm.getVideoDuration(),this.vm.isRewardVideo()){let t=this.vm.getSkipConfirmSwitch();this.skipNeedPromopt=t,this.rewardSecond=this.vm.getRewardTime(),this.skipSecond=Math.min(this.vm.getSkipShowTime(),this.rewardSecond),this.leftTime=this.rewardSecond}else this.skipNeedPromopt=!1,this.skipSecond=this.vm.getSkipShowTime(),m.isOriginLiveAd(this.vm.adInfo)?this.rewardSecond=30:this.rewardSecond=this.videoDuration,this.leftTime=this.rewardSecond;if(st.supportMinimumVersion("3.3.21","3.3.28")){let t=null,e=this.vm.isShowPrivacy(),i="flex-end";0!=this.vm.screenOrientation&&e?(t=new TKView,t.style={width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},i="flex-start",this.appendChild(t)):t=this;let a=!1;if(e){this.vm.configInfo.abConfig.reduceDownloadVisibility&&(this.style={gradientBgColor:"-90,#00000030,#00000000"});const e=0==this.vm.screenOrientation?this.vm.containerLimit.width-62:154,i=this.vm.configInfo.abConfig.reduceDownloadVisibility?"#FFFFFF00":"#30303099";this.privacyView=new Ut(this.vm.adInfo,this.vm.screenOrientation,e,i,"#FFFFFF","1 1 1 #00000030"),this.privacyView.style={alignSelf:"stretch",marginTop:10},0==this.vm.screenOrientation?(this.privacyView.style={marginLeft:16,marginRight:16,flexGrow:1},this.expcetedHeight+=78):(this.privacyView.style={marginLeft:16,width:200},this.expcetedHeight+=114,a=!0),t.appendChild(this.privacyView),this.privacyView.clickCallback=(t,e)=>{this.vm.handleOpenURL(t,e)}}this.getHasGuideBar()&&(this.guideBar=new Ht,this.guideBar.style={alignSelf:i,marginTop:10},t.appendChild(this.guideBar),a||(this.expcetedHeight+=38))}Ft(this.vm,this.vm.$attrsPath.isMuted,(t=>{this.setMuted(t)})),Ft(this.vm,this.vm.$attrsPath.playFailed,(t=>{t&&this.playFailed()})),Ft(this.vm,this.vm.$attrsPath.playFinished,(t=>{t&&this.finishPlay()})),Ft(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{t&&this.countDown(t)})),Ft(this.vm,this.vm.$attrsPath.hasGetDeepGift,(t=>{t&&this.getDeepReward(t)})),Ft(this.vm,this.vm.$attrsPath.hasInstallTargetApp,(t=>{t&&!this.vm.isCovertTask()&&(this.updateRewardState(!0),this.updateActionBarState(4,!0))})),Ft(this.vm,this.vm.$attrsPath.hasShowPlayend,(t=>{t&&(this.vm.isCovertTask()&&this.vm.giveRewardTime>0&&this.updateRewardState(!0),this.updateActionBarState(4))})),Tt().on("player_mute_change",(t=>{this.setMuted(t.muted),this.vm.isMuted=t.muted})),1!=this.vm.topbarModelType&&this.setupAction()}setupAction(){this.topBarContainer.addEventListener("tap",(t=>{this.vm.convertForOtherArea(t,4==this.actionState?2:3,function(t,e){let i={x:0,y:0};if(st.supportMinimumTKVersion("4.0.0")){const a=e.getLocationOnScreen(),n=t.position;if(!a||!n)return i;n.x=parseFloat((n.x+"").replace("dp","")),n.y=parseFloat((n.y+"").replace("dp","")),i={x:a.x+n.x,y:a.y+n.y}}return i}(t,this.topBarContainer),rt.CARD_PAGE_CLICK)})),this.vm.isSlideClick()&&function(t,e){if(Q(e))return;if(!z())return void t.addEventListener("swipe",(t=>{e()}));let i=null,a=t=>{if("down"==t.type)i=t;else if("up"==t.type&&3==t.motionType&&null!=i){let a=t.position.x,n=t.position.y,s=i.position.x,r=i.position.y;(Math.abs(a-s)>=10||Math.abs(n-r)>=10)&&e()}};t.addEventListener("down",a),t.addEventListener("up",a)}(this.topBarContainer,(()=>{this.vm.convertForOtherArea(null,4==this.actionState?2:3,{x:0,y:0},rt.CARD_SWIPE_CONVERT)}))}shouldShowNormalCallBtn(){return!0}handleCallImpressionWhenPlay(){this.callImpressionWhenPlayCalled||(this.callImpressionWhenPlayCalled=!0,this.vm.handleCallImpressionOnPlay())}updateActionBarStateInner(t,e=!1){}updateActionBarState(t,e=!1){if(!e&&t<=this.actionState)return;4==t&&this.guideBar&&this.guideBar.setVisibility("hidden"),this.actionState=t,this.leftContainer.removeAll(),this.rightContainer.removeAll(),this.updateActionBarStateInner(t,e);let i=this;if(4==this.actionState)clearTimeout(this.callActionTimer),this.closeBtn&&(2==this.vm.needShowPlayEndCloseBtn?this.hidePlayEndCloseBtn():this.vm.isDelayShowEndClose()&&!this.playEndCloseHadDelayShow?(this.hidePlayEndCloseBtn(),0==this.closeTimer&&(this.closeTimer=setTimeout((()=>{this.playEndCloseHadDelayShow=!0,this.showPlayEndCloseBtn()}),1e3*this.vm.getCloseDelaySeconds()))):this.showPlayEndCloseBtn(),this.vm.getPlayEndCallDescription&&this.vm.handleCallImpressionOnFinish());else if(this.callContainer&&this.shouldShowNormalCallBtn()){const t=this.vm.getPlayDetailCallDescription(),e=this.vm.getPlayDetailCallBtnShowTime();t&&(this.hasShowCallBtn||(0==e?this.hasShowCallBtn=!0:this.callActionTimer||(this.callActionTimer=setTimeout((()=>{i.callContainer.appendChild(i.getCallBtn()),i.callLabel.setText(t),i.layout(),i.handleCallImpressionWhenPlay(),i.hasShowCallBtn=!0}),1e3*e))),this.hasShowCallBtn&&(this.callContainer.removeAll(),this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t),this.handleCallImpressionWhenPlay()))}this.layout()}updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+""),this.layout())}showPlayEndCloseBtn(){this.closeBtn&&!this.hasShowCloseBtn&&(this.closeBtn.style={display:"flex"},this.hasShowCloseBtn=!0,st.isAndroid()||this.layout())}hidePlayEndCloseBtn(){this.closeBtn&&(this.closeBtn.style={display:"none"})}updateRewardState(t){this.hasReward=t&&this.vm.isRewardVideo(),this.hasReward&&this.vm&&this.vm.impressionCheckResult&&this.vm.handleHasGift()}getHasGuideBar(){return!1}countDown(t){var e,i,a,n,s,r;t<this.currentTime||this.vm.isDeepRewardTask()&&this.hasDeepReward||(this.currentTime=t,t=Math.floor(t),this.leftTime=this.rewardSecond-t<1?1:this.rewardSecond-t,st.supportMinimumTKVersion("5.0.1")&&this.vm.isNeedCheck&&2==this.vm.getRealAdStyle()&&(this.vm.isNeedSeverCheck=this.isNeedSeverCheck(),this.callBackAdvanceMs=(null===(i=null===(e=this.vm.adInfo.adRewardInfo)||void 0===e?void 0:e.callBackStrategyInfo)||void 0===i?void 0:i.rewardAdvanceSwitch)?(null===(n=null===(a=this.vm.adInfo.adRewardInfo)||void 0===a?void 0:a.callBackStrategyInfo)||void 0===n?void 0:n.callBackAdvanceMs)/1e3:0,t>=this.rewardSecond-this.vm.giveRewardTime-this.callBackAdvanceMs&&(null===(r=null===(s=this.vm.adInfo.adRewardInfo)||void 0===s?void 0:s.callBackStrategyInfo)||void 0===r?void 0:r.rewardAdvanceSwitch)&&!this.isFinishAdvance&&this.vm.impressionCheckResult&&this.vm.isNeedCheck&&this.vm.adInfo.adConversionInfo.callbackUrlInfo&&(this.vm.isNeedSeverCheck?(this.vm.severCheckState=1,this.secverCheck()):this.updateRewardState(!0),this.isFinishAdvance=!0)),t>=this.rewardSecond-this.vm.giveRewardTime?(this.updateRewardState(!0),this.updateActionBarState(2)):(this.updateCountDownText(),t>=this.skipSecond?this.updateActionBarState(1):this.updateActionBarState(0)))}isNeedSeverCheck(){var t,e,i,a,n,s;return(null===(e=null===(t=this.vm.adInfo.adRewardInfo)||void 0===t?void 0:t.callBackStrategyInfo)||void 0===e?void 0:e.serverCheckSwitch)&&(null===(a=null===(i=this.vm.adInfo.adRewardInfo)||void 0===i?void 0:i.callBackStrategyInfo)||void 0===a?void 0:a.callBackAdvanceMs)>0&&(null===(s=null===(n=this.vm.adInfo.adRewardInfo)||void 0===n?void 0:n.callBackStrategyInfo)||void 0===s?void 0:s.rewardAdvanceSwitch)}secverCheck(){if(st.supportMinimumTKVersion("4.0.9")){const n=new TKNetwork;n.isAddCommonParameters=1,n.method="POST",n.url="/rest/e/v3/open/checkReward";try{e=2,i=this.vm.adInfo,St({category:"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_reward_check_result",primaryKey:"web_log",type:"EXECUTION_BIZ_TIME",msg:{check_type:e,request_state:1,creative_id:i.adBaseInfo.creativeId,enviType:1}});let s=JSON.parse(this.vm.adInfo.adConversionInfo.callbackUrlInfo);s.checkType=2;const r={callbackUrlInfo:JSON.stringify(s),impInfo:[{posId:this.vm.posId,adNum:1,adStyle:2}]};try{var t=JSON.parse(JSON.stringify(this.vm.adInfo.serverExt));Q(t)||(delete t._tkmvvm_observed,delete t.nativeID,r.serverExt=t)}catch(a){}n.params=r;const o=H();n.request(((t,e)=>{console.log("[caijie] tknetwork  response "+t+" error "+e);const i=H()-o;if(!e)try{const e=JSON.parse(t).data,a=JSON.parse(e);1==a.result?(this.updateRewardState(!0),this.vm.severCheckState=1):this.vm.severCheckState=2,function(t,e,i,a,n){St({category:"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_reward_check_result",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{check_type:t,request_state:2,creative_id:e.adBaseInfo.creativeId,enviType:1,data_load_interval_duration_ms:i,message:n||"",code:a}})}(2,this.vm.adInfo,i,a.result,a.errorMsg)}catch(a){}}))}catch(a){}}var e,i}getDeepReward(t){this.vm.isDeepRewardTask()&&(this.hasDeepReward=t,4==this.actionState?(this.updateCountDownText(),this.layout()):this.updateActionBarState(3))}finishPlay(){this.updateRewardState(!0),this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!1)}playFailed(){this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!0)}setMuted(t){this.soundBtn&&(t?this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_mute.png"):this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_sound.png"))}hasFeedbackBtn(){return!1}getRightContainer(){let t=new TKView,e={height:Jt,marginRight:16-this.btnMargin/2,alignItems:"center",flexDirection:"row",justifyContent:"center"};return t.style=e,t}getCallContainer(){let t=new TKView;return t.style={height:"100%",alignItems:"center",justifyContent:"center",flexDirection:"row"},t.enabled=!0,this.callContainer=t,t}getSoundBtn(){this.soundBtn=new Gt,this.soundBtn.setImageSize({width:22,height:22});let t={width:Jt,height:Jt,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,backgroundColor:"#30303099"};return this.soundBtn.style=t,this.setMuted(this.vm.isMuted),this.soundBtn.addEventListener("tap",(t=>{this.vm.handleMuteChange(!this.vm.isMuted),this.setMuted(this.vm.isMuted)})),this.soundBtn}getSkipBtn(){let t=new Gt,e={height:Jt,borderRadius:14,backgroundColor:"#30303099",marginRight:this.btnMargin/2,marginLeft:this.btnMargin/2};if(t.style=e,this.vm.getSkipTips()){t.style={paddingLeft:12,paddingRight:12};let e=new TKText;e.style={fontSize:14,color:"#FFFFFF"},e.setText(this.vm.getSkipTips()),t.appendChild(e)}else t.style={width:Jt},1==this.vm.getSkipType()?t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_skip.png",{width:Jt,height:Jt}):t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12});return t.addEventListener("tap",(t=>{this.onSkipClick()})),this.skipBtn=t,t}onSkipClick(){let t=this.skipNeedPromopt&&(this.vm.isDeepRewardTask()?!this.hasDeepReward:!this.hasReward),e=this.vm.isRewardVideo();console.log("jky topbar view onSkipClick showPromopt: "+t),this.vm.handleSkip(t,e,this.skipSecond)}getFeedbackBtn(){this.feedbackBtn=new TKView,this.feedbackBtn.style={height:Jt,borderRadius:14,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,backgroundColor:"30303099",paddingLeft:8,paddingRight:8,alignItems:"center",justifyContent:"center"};let t=new TKText;return t.style={fontSize:14,color:"#FFFFFF"},t.setText("反馈"),this.feedbackBtn.appendChild(t),this.feedbackBtn.addEventListener("tap",(()=>{this.vm.handleOpenFeedback()})),this.feedbackBtn}getCloseBtn(){let t=new Gt,e={width:Jt,height:Jt};return e.marginLeft=this.btnMargin/2,e.marginRight=this.btnMargin/2,e.borderRadius=14,e.backgroundColor="#30303099",t.style=e,t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12}),t.addEventListener("tap",(()=>{this.vm.handleClose()})),this.closeBtn=t,Ft(this.vm,this.vm.$attrsPath.needShowPlayEndCloseBtn,(t=>{let e=this.vm.getCloseDelaySeconds();console.log("jky topbar view onBind needShowPlayEndCloseBtn: "+t+", closeBtnDelayTime: "+e),1==t&&e<=0&&this.showPlayEndCloseBtn()})),t}getGiftBtn(t=!0){let e=new Gt;return e.setImageSize({width:Jt,height:Jt}),e.style={width:Jt,height:Jt,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},t&&e.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift.png"),e.addEventListener("tap",(t=>{this.vm.handleGiftClick(t)})),this.giftBtn=e,e}getCountDownLabel(){let t=new TKText;return t.style={color:"#FFFFFF",fontSize:14,textAlign:"center",height:"100%",textLineClamp:1,minimumTextScaleFactor:.5},t}getCountDownHasBg(){return!0}getCountDownBtn(){return this.countDownBtn=new TKView,this.countDownBtn.style={height:Jt,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},this.getCountDownHasBg()&&(this.countDownBtn.style={borderRadius:14,backgroundColor:"#30303099"}),this.countDownBtn.style={width:Jt},this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={width:"100%"},this.countDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.countDownBtn}getGiftCountDownBtn(){this.giftCountDownBtn=new TKView,this.giftCountDownBtn.style={marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,height:Jt,borderRadius:14,backgroundColor:"#30303099"},this.giftCountDownBtn.addEventListener("tap",(t=>{this.vm.handleGiftClick(t)}));let t=this.getGiftBtn(!1);return t.style={marginTop:2,marginLeft:2,width:24,height:24,borderRadius:12,backgroundColor:"#FE3666"},t.setImageSize({width:21,height:21}),t.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift_new.png"),this.giftCountDownBtn.appendChild(t),this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={marginTop:-26,marginLeft:26+this.btnMargin/2,marginRight:this.btnMargin},this.giftCountDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.giftCountDownBtn}getCallBtn(){this.callBtn=new TKView,this.callBtn.setBackgroundColor("#30303099"),this.callBtn.style={paddingLeft:10,paddingRight:10,height:Jt,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.callBtn.addEventListener("tap",(t=>{this.vm.handleCallClick(4==this.actionState,t)})),this.callLabel=new TKText,this.callLabel.nativeID="topBarCallLabel",this.callLabel.style={fontSize:14,color:"#FFFFFF"},this.callBtn.appendChild(this.callLabel);let t=new TKImage;return t.style={width:6,height:11,marginLeft:6},t.setSrc(this.vm.getResourceRoot()+"icon_ksad_white_right_arrow.png"),this.callBtn.appendChild(t),this.callBtn}}class jt extends Yt{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.vm.isDeepRewardTask()?this.hasDeepReward?this.countDownLabel.setText("已获得全部奖励"):this.hasReward?this.countDownLabel.setText("已获得奖励1/2"):4==this.actionState?this.countDownLabel.setText("未获得奖励"):this.countDownLabel.setText(this.leftTime+"s后获得奖励1"):this.countDownLabel.setText(this.leftTime+""),this.layout())}updateActionBarStateInner(t,e=!1){switch(t){case 0:this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.vm.isDeepRewardTask()?this.leftContainer.appendChild(this.getGiftCountDownBtn()):this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class zt extends Yt{getCountDownHasBg(){return!0}getSmallGiftView(){let t=new TKImage;return t.style={marginLeft:5,width:18,height:18,marginRight:5},t.setSrc(this.vm.getResourceRoot()+"icon_ksad_gift_small.png"),t}getCloseBtn(){let t=super.getCloseBtn();return 4==this.actionState||(t.style={marginLeft:0,marginRight:0,backgroundColor:"#00000000"}),t}getSkipBtn(){let t=super.getSkipBtn(),e=8;return this.actionState>=4&&(e=12),t.style={paddingLeft:e,paddingRight:12,marginRight:0,marginLeft:0,backgroundColor:"#00000000"},t}getSkipTips(){return"跳过"}getRightContainer(){let t=super.getRightContainer();return t.style={backgroundColor:"#30303099",borderRadius:14,marginRight:16},t}shouldShowNormalCallBtn(){return!1}showCallSep(){this.callSep&&this.callSep.setVisibility("visible")}updateActionBarStateInner(t,e){this.rightContainer.style=4==t?{backgroundColor:"#00000000"}:{backgroundColor:"#30303099"}}}class $t extends zt{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+"秒后可领取奖励"),this.layout())}getCountDownLabel(){let t=super.getCountDownLabel();return t.style={width:118},t}getCallBtn(){if(4==this.actionState)return super.getCallBtn();const t=new TKView;t.style={height:Jt,flexDirection:"row",justifyContent:"center",alignItems:"center"};let e=new TKImage;e.style={width:20,height:20,marginLeft:5,marginRight:4},e.src=this.vm.getResourceRoot()+"icon_ksad_gift_small.png",t.appendChild(e),t.addEventListener("tap",(t=>{}));let i=this.getCountDownLabel();t.appendChild(i),this.countDownLabel=i,this.updateCountDownText();let a=new TKView;return a.setBackgroundColor("#FFFFFF33"),a.style={width:.5,height:12,marginLeft:8},a.setVisibility("hidden"),this.callSep=a,t.appendChild(a),t}getSkipBtn(){let t=super.getSkipBtn(),e=8;return this.actionState>1&&(e=12),t.style={paddingLeft:e,paddingRight:12,marginRight:0,marginLeft:0,backgroundColor:"#00000000"},t}updateActionBarStateInner(t,e=!1){switch(super.updateActionBarStateInner(t,e),t){case 0:this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.callContainer.appendChild(this.getCallBtn());break;case 1:this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class Xt extends zt{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+"秒后可领取奖励"),this.layout())}getCountDownLabel(){let t=super.getCountDownLabel();return t.style={width:118},t}hasFeedbackBtn(){return!0}getSkipBtn(){let t=super.getSkipBtn(),e=8;return this.actionState>1&&(e=12),t.style={paddingLeft:e,paddingRight:12,marginRight:0,marginLeft:0,backgroundColor:"#00000000"},t}getCallBtn(){if(4==this.actionState)return super.getCallBtn();const t=new TKView;t.style={height:Jt,flexDirection:"row",justifyContent:"center",alignItems:"center"};let e=new TKImage;e.style={width:20,height:20,marginLeft:5,marginRight:4},e.src=this.vm.getResourceRoot()+"icon_ksad_gift_small.png",t.appendChild(e),t.addEventListener("tap",(t=>{}));let i=this.getCountDownLabel();t.appendChild(i),this.countDownLabel=i,this.updateCountDownText();let a=new TKView;return a.setBackgroundColor("#FFFFFF33"),a.style={width:.5,height:12,marginLeft:8},a.setVisibility("hidden"),this.callSep=a,t.appendChild(a),t}updateActionBarStateInner(t,e=!1){switch(super.updateActionBarStateInner(t,e),t){case 0:this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.callContainer.appendChild(this.getCallBtn());break;case 1:this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn()),this.callContainer.appendChild(this.getCallBtn()),this.showCallSep();break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 4:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCloseBtn())}}}class qt extends Yt{getHasGuideBar(){return!0}hasFeedbackBtn(){return!0}updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getFeedbackBtn()),this.rightContainer.appendChild(this.getCloseBtn())}}}class Zt extends Yt{updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.leftContainer.appendChild(this.getSkipBtn()),this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 2:case 3:this.leftContainer.appendChild(this.getSkipBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.hasReward&&this.rightContainer.appendChild(this.getGiftBtn());break;case 4:{this.leftContainer.appendChild(this.getCloseBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.hasReward&&this.rightContainer.appendChild(this.getGiftBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class Qt extends Yt{updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+"秒后可领取奖励"),this.layout())}getCountDownBtn(){return this.countDownBtn=new TKView,this.countDownBtn.style={height:Jt,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},this.getCountDownHasBg()&&(this.countDownBtn.style={borderRadius:14,backgroundColor:"#30303099"}),this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={marginLeft:12,marginRight:12},this.countDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.countDownBtn}updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class te extends Yt{updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class ee extends zt{getCallBtn(){if(4==this.actionState)return super.getCallBtn();this.callBtn=new TKView,this.callBtn.style={height:Jt,flexDirection:"row",justifyContent:"center",alignItems:"center"};let t=new TKImage;t.style={width:20,height:20,marginLeft:5,marginRight:4},t.src=this.vm.getResourceRoot()+"icon_ksad_gift_small.png",this.callBtn.appendChild(t),this.actionState<4&&(this.callLabel=new TKText,this.callLabel.style={fontSize:14,color:"#FFFFFF",marginRight:8},this.callBtn.appendChild(this.callLabel),this.callLabel.setText("观看完视频可获取奖励")),this.callBtn.addEventListener("tap",(t=>{}));let e=new TKView;return e.setBackgroundColor("#FFFFFF33"),e.style={width:.5,height:12},e.setVisibility("hidden"),this.callSep=e,this.callBtn.appendChild(e),this.callBtn}updateActionBarStateInner(t,e=!1){switch(super.updateActionBarStateInner(t,e),t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 2:case 3:this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallBtn()),this.rightContainer.appendChild(this.getSkipBtn()),this.showCallSep();break;case 4:{this.hasReward&&this.leftContainer.appendChild(this.getGiftBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class ie extends TKView{constructor(){super(),this.setupViews()}setupViews(){this.style={width:28,height:34,flexDirection:"column-reverse",justifyContent:"space-around",alignItems:"center"},this.mArrow1=this.createArrowUpView(),this.appendChild(this.mArrow1),this.mArrow2=this.createArrowUpView(),this.appendChild(this.mArrow2),this.mArrow3=this.createArrowUpView(),this.appendChild(this.mArrow3)}createArrowUpView(){let t=new TKImage;return t.style={width:"100%",height:18,opacity:0},t.setSrc("image/ksad-pre-landingpage-card/icon_up_arrow.png"),t}startAnimation(){let t=this.createArrowAnimation(this.mArrow1,[1,.6,.3,0,0,0]),e=this.createArrowAnimation(this.mArrow2,[0,1,.6,.3,0,0]),i=this.createArrowAnimation(this.mArrow3,[0,0,1,.6,.3,0]);this.mArrow1.addAnimation(t,"arrowUp"),this.mArrow2.addAnimation(e,"arrowUp"),this.mArrow3.addAnimation(i,"arrowUp")}stopAnimation(){this.mArrow1.removeAllAnimation(),this.mArrow2.removeAllAnimation(),this.mArrow3.removeAllAnimation()}createArrowAnimation(t,e){if(e.length<5)return null;let i=new TKKeyframeAnimation;return i.duration=600,i.timingFunction="ease-out",i.repeatCount=Number.MAX_SAFE_INTEGER,i.setAnimations([()=>(t.style={opacity:e[0]},1/6),()=>(t.style={opacity:e[1]},2/6),()=>(t.style={opacity:e[2]},.5),()=>(t.style={opacity:e[3]},4/6),()=>(t.style={opacity:e[4]},5/6),()=>(t.style={opacity:e[5]},1)]),i}}class ae{setBridgeHandler(t){}callJS(t){}}let ne;ne="undefined"==typeof KSAdTKJsBridge?ae:KSAdTKJsBridge;class se extends ne{constructor(){super(),this.bridgeHandlers=new Map;const t=this;this.setBridgeHandler((e=>{let i=e;"string"==typeof e&&(i=JSON.parse(e));const a=e=>{t.callbackJS(i.callback,{result:1,data:e})},n=(e,a)=>{t.callbackJS(i.callback,{result:e,error_msg:a})},s=t.handlerForName(i.action);console.log("tkloadcontroller  call bridge:"+JSON.stringify(e)+" handler:"+s+" data:"+i.data),s?s.handleJsCall(i.data,a,n):n(-1,"bridge handle not registered")}))}registerBridgeHandler(t){this.bridgeHandlers.set(t.getName(),t)}handlerForName(t){return this.bridgeHandlers.get(t)}callbackJS(t,e){if(console.log("tkloadcontroller callback js:"+t+" param:"+JSON.stringify(e)),"string"==typeof t){const i=t;this.callJS(i+"("+JSON.stringify(e)+")")}else{t(e)}}}class re{handleJsCall(t,e,i){}getName(){return""}}class oe extends re{constructor(){super()}getName(){return"clickAction"}handleJsCall(t,e,i){const a=JSON.parse(t);if(Q(a.area)||Q(a.logParam))i(0,"no data");else{if(this.clickCallback)this.clickCallback(a);else if(kt.matchTKConversion()){let t=JSON.parse(a.logParam.payload);kt.convertIfNeeded(a.logParam.sceneType,T(W()),a.area,a.logParam.clickInfo,a.itemClickType,null,t,null,a.creativeId,null)}else gt.clickActionBase(a);e(null)}}}class le extends re{constructor(){super()}getName(){return"commercialLog"}handleJsCall(t,e,i){const a=JSON.parse(t),n=a;Q(a)?i(0,"no data"):(e(null),st.supportMinimumTKVersion("4.0.4")&&gt.sendCommercialLog(n))}}class he extends re{constructor(t){super(),this.configInfo=t}getName(){return"getKsAdConfig"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.configInfo?e(this.configInfo):i(0,"no data")}}class de extends re{constructor(t){super(),this.adOriginInfo=t}getName(){return"getKsAdData"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.adOriginInfo?(e(this.adOriginInfo),console.log("KSAdGetAdDataHandler=========>GetAdData ad count = "+this.adOriginInfo.impAdInfo.length)):(i(0,"no data"),console.log("KSAdGetAdDataHandler=========>GetAdData no data"))}}class ce extends re{constructor(t){super(),this.containerLimit=t}getName(){return"getContainerLimit"}handleJsCall(t,e,i){if(console.log("tkloadcontroller call :"+this.getName()),this.containerLimit){e({width:this.containerLimit.width,height:this.containerLimit.height})}else i(0,"no data")}}class pe extends re{constructor(t){super(),this.deviceInfo=t}getName(){return"getDeviceInfo"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()+this.deviceInfo),this.deviceInfo?e(this.deviceInfo):i(0,"no data")}}class Ce extends re{constructor(){super()}getName(){return"log"}handleJsCall(t,e,i){const a=JSON.parse(t);if(Tachikoma.env.isService&&this.adResult&&!a.adTemplate){let t=this.creativeId||a.creativeId;a.adTemplate=JSON.stringify(f(this.adResult,t))}console.log("tkloadcontroller handle log:"+JSON.stringify(a)),Q(a)?i(0,"no data"):(gt.sendLog(a),e(null))}}class ue extends re{constructor(t){super(),this.screenOrientation=t}getName(){return"getScreenOrientation"}handleJsCall(t,e,i){if(Q(this.screenOrientation))i(0,"no data");else{e({screenOrientation:this.screenOrientation})}}}class ge extends re{constructor(){super()}getName(){return"closeTKDialog"}handleJsCall(t,e,i){this.closeCallback&&this.closeCallback(),e(null)}}class me extends re{constructor(){super(),this.isMoreShow=!1,this.isPreLandingPage=!1}getName(){return"getTKPreEnv"}handleJsCall(t,e,i){e({isPreLandingPage:this.isPreLandingPage,isMoreShow:this.isMoreShow})}}class fe extends re{constructor(){super()}getName(){return"skipVideo"}handleJsCall(t,e,i){const a=JSON.parse(t);if(Q(a))i(0,"no data");else{const t=a.needPromopt,i=a.needReport,n=a.showTime;this.skipCallback&&this.skipCallback(t,i,n),e(null)}}}class Ie{constructor(t){this.vm=t,this.dialog=new KSAdDialog,this.registerBridgeHandle(),this.setupView()}setupView(){this.dialog.setTemplateInfo(this.vm.getTemplateInfo())}showConfirm(){const t=this;this.dialog.show(((e,i)=>{e?t.vm.isShow=!0:this.vm.handleLeaveCallback&&this.vm.handleLeaveCallback()}))}dismiss(){this.dialog.dismiss()}registerBridgeHandle(){const t=new se,e=new de(this.vm.adOriginInfo);t.registerBridgeHandler(e);const i=new he(this.vm.configInfo);t.registerBridgeHandler(i);const a=new pe(x());t.registerBridgeHandler(a);const n=new ue(this.vm.screenOrientation);t.registerBridgeHandler(n);const s=new fe;s.skipCallback=(t,e,i)=>{this.vm.handleLeaveCallback&&this.vm.handleLeaveCallback()},t.registerBridgeHandler(s);const r=new ge;r.closeCallback=()=>{this.dialog.dismiss()},t.registerBridgeHandler(r);const o=new le;t.registerBridgeHandler(o);const l=new Ce;t.registerBridgeHandler(l);const h=new ce(this.vm.containerLimit);t.registerBridgeHandler(h);const d=new oe;t.registerBridgeHandler(d);const c=new me;c.isPreLandingPage=!0,t.registerBridgeHandler(c),this.dialog.registerBridge(t)}}class Te extends TKView{constructor(t){super(),this.mDuration=150,this.mWebViewMarginTop=114,this.vm=t,this.setupViews(),this.renderWebView(),Ft(this.vm,this.vm.$attrsPath.isSlideUp,(t=>{t?this.slideUp():this.slideDown()})),Ft(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"showEnd"==t&&(this.mWebView.setDeeplinkEnabled(!0),this.showCardAnimation(),this.mTopBar.updateRewardState(this.vm.hasNeo),this.mTopBar.updateActionBarState(4),this.vm.reportPreFormImpression())})),this.vm.backPressedCallback=()=>{this.vm.isSlideUp?this.handleBackClick():this.vm.topBarVM.handleClose()}}setupViews(){this.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-start"},this.setupConfirm(),this.appendChild(this.createBgImageView()),this.appendChild(this.createTopBar()),this.appendChild(this.createTopView()),this.appendChild(this.createContentView())}setupConfirm(){this.confirmDialog=new Ie(this.vm.confirmVM);const t=this;this.vm.confirmVM.handleLeaveCallback=()=>{t.confirmDialog.dismiss(),this.vm.isSlideUp=!1}}createBgImageView(){this.mBgImageView=new TKImage,this.mBgImageView.style={width:"100%",height:"100%",position:"absolute",left:0,right:0,bottom:0,top:0};let t=this.vm.getPlayEndBgUrl();return this.mBgImageView.setSrc(t),this.mBgImageView}createTopBar(){let t=null;switch(this.vm.topBarVM.getTopbarStyle()){case 3:t=new Zt(this.vm.topBarVM);break;case 5:t=new Qt(this.vm.topBarVM);break;case 7:t=new te(this.vm.topBarVM);break;case 9:t=new ee(this.vm.topBarVM);break;case 11:t=new $t(this.vm.topBarVM);break;case 13:t=new Xt(this.vm.topBarVM);break;case 15:t=new qt(this.vm.topBarVM);break;default:t=new jt(this.vm.topBarVM)}return this.appendChild(t),t.style={position:"absolute",top:this.vm.getTopMargin(),left:this.vm.getSideMargin(),right:this.vm.getSideMargin()},this.vm.topBarVM.handleCallClick=(t,e)=>{this.vm.handleAdClick(rt.LANDING_PAGE_OTHER_AREA_CLICK,e)},this.vm.topBarVM.handleGiftClick=t=>{this.vm.handleAdClick(rt.LANDING_PAGE_OTHER_AREA_CLICK,t)},this.vm.topBarVM.convertForOtherArea=t=>{this.vm.handleAdClick(rt.LANDING_PAGE_OTHER_AREA_CLICK,t)},this.vm.topBarVM.handleClose=()=>{this.vm.isSlideUp||gt.closeVideo(!1)},this.mTopBar=t,t}createTopView(){this.mTopView=new TKView,this.mTopView.style={width:"100%",height:64+(Y()?20:0),paddingTop:20,backgroundColor:"#FFFFFF",opacity:0,flexDirection:"column",justifyContent:"center",alignItems:"center"};let t=new TKView;return t.style={width:"100%",height:44,bottom:0,position:"absolute",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.mTitleText=new TKText,this.mTitleText.style={width:"100%",height:"100%",position:"absolute",color:"#000000",fontWeight:"medium",fontSize:18,textAlign:"center"},this.mTitleText.setText(this.vm.getTopBarTitle()),t.appendChild(this.mTitleText),this.mBackBtn=new TKImage,this.mBackBtn.style={width:11,height:18,marginLeft:22,marginRight:22},this.mBackBtn.setSrc("image/ksad-pre-landingpage-card/icon_actionbar_back.png"),t.appendChild(this.mBackBtn),this.mCloseBtn=new TKImage,this.mCloseBtn.style={width:14,height:14},this.mCloseBtn.setSrc("image/ksad-pre-landingpage-card/icon_actionbar_close.png"),t.appendChild(this.mCloseBtn),this.mBackBtn.addEventListener("tap",(()=>{this.handleBackClick()})),this.mCloseBtn.addEventListener("tap",(()=>{this.handleCloseClick()})),this.mTopView.appendChild(t),this.mTopView}handleBackClick(){this.vm.needShowConfimDialog()?this.confirmDialog.showConfirm():this.vm.isSlideUp=!1}handleCloseClick(){this.vm.needShowConfimDialog()?this.confirmDialog.showConfirm():this.vm.isSlideUp=!1}createContentView(){return this.mContentView=new TKView,this.mContentView.style={flexBasis:300,flexGrow:1,flexShrink:1,flexDirection:"column"},this.mContentBgView=new TKView,this.mContentBgView.style={width:"100%",height:140,position:"absolute",left:0,top:0,right:0,gradientBgColor:"90,0000009E,00000000"},this.mContentBgView.addEventListener("tap",(t=>{this.vm.handleAdClick(rt.LANDING_PAGE_OTHER_AREA_CLICK,t)})),this.mContentView.appendChild(this.mContentBgView),this.mWebViewContainer=new TKView,this.mWebViewContainer.style={width:"100%",height:"100%",top:this.mWebViewMarginTop+80,position:"absolute",left:0,right:0},this.setupWebView(),this.mWebViewContainer.appendChild(this.mWebView),this.mUpSlideView=this.createUpSlideTipsView(),this.mWebViewContainer.appendChild(this.mUpSlideView),this.mContentView.appendChild(this.mWebViewContainer),this.mContentMaskView=this.createContentMaskView(),this.mContentView.appendChild(this.mContentMaskView),this.mContentView}createContentMaskView(){let t=new TKView;t.style={width:"100%",height:"100%",position:"absolute",top:this.vm.isAppAdvance()?this.mWebViewMarginTop:0},t.addEventListener("tap",(t=>{this.vm.handleAdClick(rt.INTERACT_LANDING_PAGE_CLICK,t)})),t.addEventListener("swipe",(()=>{this.vm.handleAdClick(rt.INTERACT_LANDING_PAGE_CLICK,null)}));let e=new TKView;return e.style={width:"100%",height:this.mWebViewMarginTop,position:"absolute",top:0},e.addEventListener("tap",(t=>{this.vm.handleAdClick(rt.LANDING_PAGE_OTHER_AREA_CLICK,t)})),e.addEventListener("swipe",(()=>{this.vm.handleAdClick(rt.LANDING_PAGE_OTHER_AREA_CLICK,null)})),t.appendChild(e),t}setupWebView(){try{this.mWebView=new KSAdWebView,this.mWebView.style={width:"100%",height:"100%",backgroundColor:"#FFFFFF00",topLeftRadius:20,topRightRadius:20,position:"absolute",top:0,left:0,right:0};let t=new d;t.is_special_preload=1;let e={clientExtData:JSON.stringify(t)};this.mWebView.setOnStartListener((()=>{})),this.mWebView.setOnFinishListener((()=>{this.vm.pageLoaded||(gt.sendLog({actionType:51,payload:JSON.stringify(e)}),this.vm.pageLoaded=!0)})),this.mWebView.setOnFailedListener(((t,i,a)=>{gt.sendLog({actionType:59,payload:JSON.stringify(e)}),this.vm.pageLoadedFailed=!0})),this.mWebView.setJavaScriptEnabled(!0),this.mWebView.setAllowFileAccess(!0),this.mWebView.setAllowFileAccessFromFileURLs(!1),this.mWebView.setAllowUniversalAccessFromFileURLs(!1),this.mWebView.setAllowContentAccess(!0),this.mWebView.setMixedContentMode(0),this.mWebView.setScrollEnabled(!0),this.mWebView.setDeeplinkEnabled(!1)}catch(t){console.log("jky webview error")}}renderWebView(){this.vm.getLandingPageUrl((t=>{Q(t)?this.vm.pageLoadedFailed=!0:this.mWebView.loadUrl(t)}))}createUpSlideTipsView(){let t=new TKView;t.style={topLeftRadius:20,topRightRadius:20,height:140,width:"100%",gradientBgColor:"90,00000000,00000040",flexDirection:"column",alignItems:"center"},this.mSlideUpIconView=new ie,this.mSlideUpIconView.style={top:7,alignSelf:"center",position:"absolute"},t.appendChild(this.mSlideUpIconView);let e=new TKText;return e.style={top:48,fontSize:12,color:"#F4F4F4",alignSelf:"center"},e.setText("上滑/点击查看更多"),t.appendChild(e),t}showCardAnimation(){let t=new TKKeyframeAnimation;t.duration=300,t.timingFunction="EaseOut",t.setAnimations([()=>(this.mWebViewContainer.style={opacity:0,top:this.mWebViewMarginTop+80},0),()=>(this.mWebViewContainer.style={opacity:0,top:this.mWebViewMarginTop+80},.5),()=>(this.mWebViewContainer.style={opacity:1,top:this.mWebViewMarginTop},1)]),t.on("end",(()=>{this.mSlideUpIconView.startAnimation(),this.leadSlideUp()})),this.mWebViewContainer.addAnimation(t,"showAnimation")}leadSlideUp(){let t=new TKKeyframeAnimation;t.duration=600,t.timingFunction="EaseOut",t.repeatCount=Number.MAX_SAFE_INTEGER,t.setAnimations([()=>1/3,()=>(this.mWebViewContainer.style={transform:{translate:{y:14}}},5/6),()=>(this.mWebViewContainer.style={transform:{translate:{y:0}}},1)]),this.mWebViewContainer.addAnimation(t,"leadSlideUpAnima")}slideUp(){if(1==this.mTopView.style.opacity)return;this.mWebViewContainer.removeAllAnimation();let t=new TKBasicAnimation;t.duration=this.mDuration,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mWebViewContainer.style={top:0}}));let e=new TKBasicAnimation;e.duration=this.mDuration,e.timingFunction="EaseOut",e.setEndValue((()=>{this.mTopView.style={opacity:1}}));let i=new TKBasicAnimation;i.duration=this.mDuration,i.timingFunction="EaseOut",i.setEndValue((()=>{this.mUpSlideView.style={opacity:0}})),e.on("end",(()=>{this.mWebView.style={backgroundColor:"#FFFFFF",topLeftRadius:0,topRightRadius:0}})),this.mContentMaskView.style={visibility:"hidden"},this.mWebViewContainer.addAnimation(t,"upSlideAnim"),this.mTopView.addAnimation(e,"upSlideAnim"),this.mUpSlideView.addAnimation(i,"upSlideAnim")}slideDown(){if(0==this.mTopView.style.opacity)return;this.mWebViewContainer.removeAllAnimation();let t=new TKBasicAnimation;t.duration=this.mDuration,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mWebViewContainer.style={top:this.mWebViewMarginTop}}));let e=new TKBasicAnimation;e.duration=this.mDuration,e.timingFunction="EaseOut",e.setStartValue((()=>{this.mWebView.style={backgroundColor:"#FFFFFF00",topLeftRadius:20,topRightRadius:20}})),e.setEndValue((()=>{this.mTopView.style={opacity:0}}));let i=new TKBasicAnimation;i.duration=this.mDuration,i.timingFunction="EaseOut",i.setEndValue((()=>{this.mUpSlideView.style={opacity:1}})),this.mContentMaskView.style={visibility:"visible"},t.on("end",(()=>{this.leadSlideUp()})),this.mWebViewContainer.addAnimation(t,"downSlideAnim"),this.mTopView.addAnimation(e,"downSlideAnim"),this.mUpSlideView.addAnimation(i,"downSlideAnim")}}class we extends xt{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>_e(t,e)})}getData(t){}}function _e(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(i,a)=>"string"!=typeof a||"function"==typeof i[a]||0==a.indexOf("$")?Reflect.get(i,a):_e(t,e+"."+a)})}class ve extends we{constructor(){super(...arguments),this.isNeedCheck=!1,this.topbarModelType=0,this.needShowPlayEndCloseBtn=0,this.hasCallbackGift=!1,this.isMuted=!1,this.playFailed=!1,this.playFinished=!1,this.currentPlaybackTime=0,this.hasGetDeepGift=!1,this.hasInstallTargetApp=!1,this.hasShowPlayend=!1,this.giveRewardTime=0,this.impressionCheckResult=!0,this.isNeedSeverCheck=!1,this.severCheckState=0}checkDataValid(){return!!this.adInfo}getVideoDuration(){return v(this.adInfo)}isDownloadAd(){return 1==this.adInfo.adBaseInfo.adOperationType}isShowPrivacy(){return function(t){var e;try{return st.isAndroid()&&1==t.adBaseInfo.adOperationType&&(null===(e=t.downloadSafeInfo.complianceInfo)||void 0===e?void 0:e.titleBarTextSwitch)>0}catch(i){}return!1}(this.adInfo)}isDeepRewardTask(){return 2==this.adInfo.adBaseInfo.taskType||3==this.adInfo.adBaseInfo.taskType}isCloseBtnHide(){try{let t=this.adInfo.adMatrixInfo.tag;if(t)for(let e=0;e<t.length;e++){let i=t[e];if("playEndClose"==i.type&&i.isHide)return!0}}catch(t){}return!1}isRewardVideo(){return 2==this.adStyle||12==this.adStyle}isSkipToCloseAd(){try{return this.isRewardVideo()?this.adInfo.adRewardInfo.rewardVideoEndCardSwitch:this.adInfo.fullScreenVideoInfo.fullScreenEndCardSwitch}catch(t){return!1}}getRewardTime(){return b(this.adInfo)}isShowSkipRightNow(){return this.isRewardVideo()?Math.min(this.getSkipShowTime(),this.getRewardTime())<=0:this.getSkipShowTime()<=0}getSkipConfirmSwitch(){let t=!0;try{t=null==this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch||this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch}catch(e){}return t}getSkipShowTime(){let t=null;try{if(this.isRewardVideo())try{t=this.adInfo.adRewardInfo.skipShowTime,t<0&&(t=this.getVideoDuration())}catch(e){t=this.configInfo.appConfig.rewardSkipShowTime}else t=this.adInfo.adStyleConfInfo.fullScreenSkipShowTime}catch(e){}return null!=t&&null!=t||(t=5),Math.min(this.getVideoDuration(),t)}getSkipTips(){let t=null;try{t=this.isRewardVideo()?this.configInfo.appConfig.rewardSkipTips:this.configInfo.appConfig.fullscreenSkipTips}catch(e){}return t&&0!=t.length?t:null}getSkipType(){let t=0;try{t=this.isRewardVideo()?this.configInfo.appConfig.rewardSkipType:this.configInfo.appConfig.fullscreenSkipType}catch(e){3==this.adStyle&&(t=1)}return t}getPlayDetailCallDescription(){let t=null;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailTopToolBarInfo.callButtonDescription}catch(e){}return $(t)||(t="立即获取"),t}getPlayEndCallDescription(){let t=null;try{this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription.length>0&&(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription)}catch(e){console.log("no adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription returned")}return t}getPlayDetailCallBtnShowTime(){let t=0;try{t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playDetailInfo.detailTopToolBarInfo.callButtonShowTime}catch(e){console.log("no adMatrixInfo.adDataV2.dynamicAdStyleInfo.playDetailInfo.detailTopToolBarInfo.callButtonShowTime returned")}return t}getCloseDelaySeconds(){let t=0;try{t=this.adInfo.adStyleConfInfo.closeDelaySeconds}catch(e){}return t}isDelayShowEndClose(){return this.getCloseDelaySeconds()>0}getTopbarStyle(){if(3!=this.adStyle&&1!=this.adInfo.adBaseInfo.taskType&&4!=this.adInfo.adBaseInfo.taskType&&0!=this.adInfo.adBaseInfo.taskType)return 1;let t=-1;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailTopToolBarInfo.style}catch(e){}return!st.supportMinimumVersion("3.3.22","3.3.29")&&t>9?0:t}getResourceRoot(){return"image/ksad-video-top-bar/"}handleOpenURL(t,e){gt.openURL(t,e)}handleOpenFeedback(){if(this.hasShowFeedback)return void mt("您已经提交过反馈了哦~");this.hasShowFeedback=!0,gt.showTKDialog("ksad-feed-back-card");let t={actionType:141,payload:JSON.stringify({elementType:194,buttonType:4})};gt.sendLog(t)}handleCallImpressionOnFinish(){}handleCallImpressionOnPlay(){}handleCallClick(t,e){}handleGiftClick(t){}convertForOtherArea(t,e,i,a){}handleSkip(t,e,i){}handleClose(){gt.closeVideo(!1)}handleMuteChange(t){}handleHasGift(){this.hasCallbackGift||(this.hasCallbackGift=!0,gt.hasReward(this.severCheckState))}handlePlayEnd(t){gt.showPlayEnd(t),this.hasShowPlayend=!0}getTaskType(){var t;return null===(t=this.rewardTaskInfo)||void 0===t?void 0:t.taskType}isCovertTask(){return 1==this.getTaskType()}isSlideClick(){var t;return!!(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}getRealAdStyle(){let t=Tachikoma.env.adStyle;return t||(t=this.adStyle),t}}class ye extends ve{constructor(t,e,i,a,n){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=a,this.screenOrientation=n}}class Se extends we{constructor(t,e,i,a,n,s){super(),this.isShow=!1,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=a,this.containerLimit=n,this.screenOrientation=s}getTemplateInfo(){try{const t=function(t,e){try{let i=e.adMatrixInfo.styles.templates,a=0;for(;a<i.length;++a){let e=i[a];if(e&&t==e.templateId)return e}}catch(i){console.log("TK get matrix url error")}return""}(this.getTemplateId(),this.adInfo);return JSON.stringify(t)}catch(t){}return""}getTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.rewardWebTaskCloseInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}}class Ae extends we{constructor(){super(...arguments),this.hasNeo=!1,this.pageLoaded=!1,this.pageLoadedFailed=!1,this.isSlideUp=!1,this.lifeStatus="none"}getData(t){let e=[];e.push(gt.getKsAdDataAsync()),e.push(gt.getDeviceInfoAsync()),e.push(gt.getKsAdConfigAsync()),e.push(gt.getContainerLimitAsync()),e.push(gt.getScreenOrientationAsync()),Promise.all(e).then((e=>{try{const i=e[0].data,a=e[1].data,n=e[2].data,s=e[3].data,r=e[4].data;this.adOriginInfo=i,this.adInfo=i.impAdInfo[0].adInfo[0],this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=r.screenOrientation,this.configInfo=n,this.containerLimit=s,P(a),this.additionalInit(),t&&t(!0)}catch(i){t&&t(!1)}}))}additionalInit(){const t={width:this.containerLimit.width-2*this.getSideMargin(),height:this.containerLimit.height-this.getTopMargin()};this.topBarVM=new ye(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.confirmVM=new Se(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation),gt.registerNeoStatusListener((t=>{t.data&&!Q(t.data.status)&&(this.hasNeo=1==t.data.status)})),this.registerLifeStatusListener(),this.registerBackPressedListener()}registerLifeStatusListener(){gt.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&(this.lifeStatus=e)}}))}registerBackPressedListener(){gt.registerBackPressed((t=>{z()&&null!=this.backPressedCallback&&this.backPressedCallback()}))}reportPreFormImpression(){let t=new d;t.universe_feature_freq=5;let e={elementType:204,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};gt.sendLog(i),2==this.adStyle&&yt("component_ui_show","end_card","","pre-landing-page-card",!1)}getSideMargin(){return Y()&&1==this.screenOrientation?48:0}getTopMargin(){return 0==this.screenOrientation&&Y()?48:20}getPlayEndBgUrl(){return _(function(t){try{return t.adMaterialInfo.materialFeature[0]}catch(e){}return null}(this.adInfo))}getLandingPageUrl(t){try{gt.getLandingPageInfo((e=>{let i=e.data;const a=i?i.landingPageUrl:void 0;$(a)?t(a):t(this.adInfo.adConversionInfo.h5Url)}))}catch(e){t(this.adInfo.adConversionInfo.h5Url)}}getTopBarTitle(){return y(this.adInfo)}getPlayEndTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.endCardInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}isAppAdvance(){return function(t){var e,i;try{return(null===(i=null===(e=t.adConversionInfo)||void 0===e?void 0:e.deeplinkUrl)||void 0===i?void 0:i.length)>0}catch(a){}return!1}(this.adInfo)}handleAdClick(t,e){if(this.isAppAdvance()){let i=0,a=0;Q(e)||(i=e.position.rawX,a=e.position.rawY),kt.convertIfNeeded(2,this.adInfo,2,{x:i,y:a},t),2==this.adStyle&&yt("component_ui_click","end_card","","pre-landing-page-card",!1)}else if(!this.isSlideUp){this.isSlideUp=!0,kt.reportClick(this.adInfo,null,{itemClickType:t,renderContainer:1}),2==this.adStyle&&yt("component_ui_click","end_card","","pre-landing-page-card",!1);let e={creativeId:this.adInfo.adBaseInfo.creativeId+"",targetMethod:"adClickCallback",methodParams:"{}"};gt.adOutCallback(e)}}needShowConfimDialog(){var t,e;return 1==(null===(e=null===(t=this.configInfo)||void 0===t?void 0:t.appConfig)||void 0===e?void 0:e.adLeaveConfirmSwitch)}}(new class extends bt{constructor(){super(),this.vm=new Ae}setupViews(){this.rootView.style={width:"100%",height:"100%",backgroundColor:"#00000080",alignItems:"center",justifyContent:"center"},Ft(this.vm,this.vm.$attrsPath.pageLoaded,(t=>{t&&this.updateRenderStatus(1,"")})),Ft(this.vm,this.vm.$attrsPath.pageLoadedFailed,(t=>{t&&this.updateRenderStatus(0,"")})),this.contentView||(this.contentView=new Te(this.vm)),this.rootView.appendChild(this.contentView)}render(){if(!super.render())return!1;try{this.vm.getData((t=>{if(t)try{this.setupViews(),Tachikoma.render(this.rootView)}catch(e){this.updateRenderStatus(0,J(e))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,J(t))}return!0}}).render()})();
//# sourceMappingURL=ksad-pre-landingpage-card.159.js.map