(()=>{"use strict";var t,e,i,n;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PORTRAIT_CLICK=13]="PORTRAIT_CLICK",t[t.COMMENT_CLICK=14]="COMMENT_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.COMMENT_DETAIL_CLICK=25]="COMMENT_DETAIL_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.COMMON_CARD_CLICK=89]="COMMON_CARD_CLICK",t[t.COMMENT_PICTURE_CLICK=100]="COMMENT_PICTURE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA",t[t.POPLAY_FALL_IOCN=186]="POPLAY_FALL_IOCN",t[t.ROTATE_SHAKE_BIG_ICON_CLICK=187]="ROTATE_SHAKE_BIG_ICON_CLICK",t[t.RETAIN_AGG_CARD_CLICK=189]="RETAIN_AGG_CARD_CLICK",t[t.PLAYEND_AGG_CARD_CLICK=190]="PLAYEND_AGG_CARD_CLICK",t[t.SURPRISE_BOX_CLICK=191]="SURPRISE_BOX_CLICK",t[t.BUBBLE_RAIN_CLICK=192]="BUBBLE_RAIN_CLICK"}(t||(t={})),function(t){t[t.adClickReward=1]="adClickReward"}(e||(e={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(i||(i={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(n||(n={}));const s="player_mute_change",a="player_play_failed",o="player_play_finished",r="player_update_video_progress",h="ad_convert_event",l="neo_playagain_event",d="auto_call_show";var c,p,m;!function(t){t[t.THREEIMG_DEFAULT_CLICK=0]="THREEIMG_DEFAULT_CLICK",t[t.THREEIMG_FIRST_CLICK=1]="THREEIMG_FIRST_CLICK",t[t.THREEIMG_SECOND_CLICK=2]="THREEIMG_SECOND_CLICK",t[t.THREEIMG_THIRD_CLICK=3]="THREEIMG_THIRD_CLICK"}(c||(c={})),function(t){t[t.picStyle=1]="picStyle",t[t.textStyle=2]="textStyle"}(p||(p={})),function(t){t[t.GRAYBG_ONE_LINE=1]="GRAYBG_ONE_LINE",t[t.GRADIENT_ONE_LINE=2]="GRADIENT_ONE_LINE",t[t.GRADIENT_TWO_LINE=3]="GRADIENT_TWO_LINE"}(m||(m={}));class g{static saveLocal(t,e){if("undefined"!=typeof TKLocalStorage&&Le.supportMinimumTKVersion("4.0.0"))try{(new TKLocalStorage).set(t,e)}catch(i){}}static getLocalString(t){if("undefined"!=typeof TKLocalStorage&&Le.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return e.toString()}catch(e){}return null}static getLocalInt(t){if("undefined"!=typeof TKLocalStorage&&Le.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Number.parseInt(e.toString())}catch(e){}return 0}static getLocalBoolean(t){if("undefined"!=typeof TKLocalStorage&&Le.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Boolean(e.toString)}catch(e){}return!1}}let u=null;const w="TKResIndexKey";class C{constructor(){var t,e,i;this.defaultHost="p1-lm.adukwai.com",this.currentIndex=0;let n=null===(i=null===(e=null===(t=ee())||void 0===t?void 0:t.appConfig)||void 0===e?void 0:e.idc)||void 0===i?void 0:i.tkres;n&&0!=n.length||(n=["p1-lm.adukwai.com","p2-lm.adukwai.com"]),this.resList=n;let s=g.getLocalInt(w);s>n.length&&(s=0),this.currentIndex=s}static getInstance(){return u||(u=new C),u}getCurrentHost(){return this.currentIndex>=this.resList.length?this.defaultHost:this.resList[this.currentIndex]}markUrlFail(t){if(!(t.indexOf(this.getCurrentHost())<0||"undefined"!=typeof KSAdTKNetworkManager&&0==KSAdTKNetworkManager.getCurrentNetworkType())){const t=this.currentIndex;this.currentIndex=++this.currentIndex%this.resList.length,this.currentIndex!==t&&g.saveLocal(w,this.currentIndex)}}}var f,y;!function(t){t.START="start",t.CENTRT="center",t.END="end"}(f||(f={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(y||(y={}));var T,I,v;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.PRODUCT=1]="PRODUCT",t[t.EVENT=2]="EVENT",t[t.COUPON=3]="COUPON",t[t.PRODUCT_DEEP_VIDEO=4]="PRODUCT_DEEP_VIDEO"}(T||(T={}));class A{}A.UNKNOWN_DOWNLOAD_SOURCE=0,A.FROM_LANDING_PAGE=1,A.FROM_DIRECT_INSTALLATION=2;class V{}!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(I||(I={}));class b{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(v||(v={}));class S{}class x{}var _,L,D;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(_||(_={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(L||(L={})),function(t){t[t.unkonwn=0]="unkonwn",t[t.videoPromoteFollow=1]="videoPromoteFollow",t[t.videoPromoteGoods=2]="videoPromoteGoods",t[t.liveGoods=3]="liveGoods",t[t.liveNotGoods=4]="liveNotGoods",t[t.videoAd=5]="videoAd"}(D||(D={}));function F(t){try{const e=t.adMatrixInfo.adDataV2.styleComponentInfo;if(e&&e.styleComponentFlag)return!0}catch(e){}return!1}function k(t,e,i){if(console.log("tkloadcontroller target componentName:"+e+" slotId:"+i),me(e)&&!Ce(i))try{const n=t.adMatrixInfo.adDataV2.componentDatas.length;for(let s=0;s<n;s++){let n=t.adMatrixInfo.adDataV2.componentDatas[s];if(n.componentName==e&&n.slotId==i)return n}}catch(n){}}function R(t){try{if(t)return JSON.parse(t.data)}catch(e){}}function B(t,e,i=!0){try{const n=t.adMatrixInfo.adDataV2.styleComponentInfo;let s={component_id:e.componentId,combination_id:i?n.playCardInfo.combinationIds:n.endCardInfo.combinationIds,page_id:i?n.playCardInfo.pageId:n.endCardInfo.pageId};return JSON.stringify(s)}catch(n){return""}}class K{static isClickReward(t,e){try{let i=!0;if(Le.isAndroid()&&!Ce(e)&&(i=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&i)return!0}catch(i){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(i){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){try{return t.advertiserInfo.userId||0}catch(e){return 0}}static getLiveStreamId(t){try{return t.adBaseInfo.liveStreamId||""}catch(e){return""}}static getLiveServiceToken(t){try{return t.adConversionInfo.liveServiceToken||""}catch(e){return""}}static getLiveUserId(t){try{return t.adConversionInfo.liveVisitorId||0}catch(e){return 0}}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!Ce(e)&&K.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),Ce(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=me(e)?e:t.advertiserInfo.rawUserName}catch(i){}return e=me(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(Ce(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return Ce(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=nt(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let i="";try{i=t.neoLiveAuthorInfoData.authorName}catch(n){}try{Ce(i)&&(i=t.neoLiveCartDetailData.authorName)}catch(n){}try{Ce(i)&&(i=e.adBaseInfo.appName)}catch(n){}return i}static liveGetLiveDesc(t,e){let i="";try{i=t.neoLiveCartDetailData.liveDesc}catch(n){}try{Ce(i)&&(i=t.neoLiveAuthorInfoData.liveDesc)}catch(n){}try{Ce(i)&&(i=t.adDescription)}catch(n){}try{Ce(i)&&(i=e.adBaseInfo.adDescription)}catch(n){}return i}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!Ce(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!Ce(e))return e}catch(e){}return null}static getNeoAutoDialogType(t){var e;if(F(t)){if(k(t,"reward-dialog-common",5))return 1;if(k(t,"reward-dialog-fund",5))return 2}else try{let i=0;if(K.isOriginLiveAd(t))i=null===(e=t.adMatrixInfo.adDataV2.videoLiveTKInfo)||void 0===e?void 0:e.neoAutoDialogType;else{let e=N(t);i=1==e?t.adMatrixInfo.adDataV2.neoTKInfo.neoAutoDialogType:2==e?t.adMatrixInfo.adDataV2.videoImageTKInfo.neoAutoDialogType:0}1!=i&&2!=i&&(i=0);let n=function(t){if(null==t)return null;try{let e=null;if(K.isOriginLiveAd(t))e=it(t,14);else{let i=N(t);2==i?e=it(t,16):1==i&&(e=it(t,12))}if(e){let i=At(e,t);return JSON.parse(i.data).neoAutoDialog}}catch(e){}return null}(t);return 1==i&&Ce(n.neoAutoDialogGiftPic)&&Ce(n.neoAutoDialogGiftTitle)&&(i=0),i}catch(i){}return 0}static hasNeoAutoDialog(t){let e=K.getNeoAutoDialogType(t);return!Ce(e)&&0!=e}static newDeepVideoInteractCardInfo(t,e){if(Ce(t)||Ce(e))return null;let i;if(i=JSON.parse(JSON.stringify(Object.assign(t,e))),i.merchantStyleType=T.PRODUCT_DEEP_VIDEO,i.interactiveCardShowTime=0,i.rightsCardCustomImageUrl=t.icon,i.rightsCardCustomContent=t.name,i.rightsCardProductIconDesc="热卖",Ce(t.rating))i.rightsCardProductTags=t.serviceInfoList;else{let e=[t.rating];i.rightsCardProductTags=e.concat(t.serviceInfoList)}return i}}function E(t,e){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;let i=null;if(e)for(let n=0;n<t.impAdInfo.length;++n){let s=t.impAdInfo[n];if(s.adInfo.length>0&&s.adInfo[0].adBaseInfo.creativeId==e){i=s;break}}return i||(i=t.impAdInfo[0]),i}function P(t){var e;return(null===(e=null==t?void 0:t.adInfo)||void 0===e?void 0:e.length)>0?t.adInfo[0]:null}function O(t){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;const e=t.impAdInfo[0];return(null==e?void 0:e.adInfo)&&0!=e.adInfo.length?e.adInfo[0]:null}function M(t){let e=null;try{1==t.adBaseInfo.adOperationType&&me(t.adBaseInfo.appIconUrl)?e=t.adBaseInfo.appIconUrl:me(t.advertiserInfo.portraitUrl)&&(e=t.advertiserInfo.portraitUrl)}catch(i){}return e||"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}function N(t){try{return t.adMaterialInfo.materialFeature[0].featureType}catch(e){}return 0}function H(t){try{return G(t.adMaterialInfo.materialFeature[0])}catch(e){}return""}function W(t){try{return t.adMaterialInfo.materialFeature[0]}catch(e){}return null}function z(t){try{return t.adMaterialInfo.materialFeature[0].materialUrl}catch(e){}return""}function U(t){let e={width:0,height:0};try{const i=t.adMaterialInfo.materialFeature[0];1==i.featureType?(e.width=i.videoWidth,e.height=i.videoHeight):e=i.materialSize}catch(i){}return e.width>0&&e.height>0?e:{width:1280,height:720}}function G(t){try{return!me(t.firstFrame)||t.firstFrame.includes(".kpg")||t.firstFrame.includes(".webp")?me(t.coverUrl)?t.coverUrl:t.coverUrl||t.materialUrl||"":t.firstFrame}catch(e){}return""}function j(t){try{return t.adMaterialInfo.materialFeature[0].videoDuration}catch(e){}return 0}function Y(t){try{return 1==t.adBaseInfo.adOperationType}catch(e){}return!1}function X(t){let e=null;try{switch(t.adBaseInfo.adOperationType){case 1:e=t.adBaseInfo.appName;break;case 2:e=t.adBaseInfo.productName}me(e)||(e=t.advertiserInfo.rawUserName)}catch(i){}return e||"可爱的广告君"}function J(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function $(t){try{return t.adStyleConfInfo.actionBarType}catch(e){}return 0}function Z(t){try{return t.adMatrixInfo.adDataV2.neoTKInfo.confirmCardType}catch(e){}return 0}function q(t){let e=!1;try{e=3==t.adStyleConfInfo.innerAdType}catch(i){}return e}function Q(t){let e=!1;try{e=4==t.adStyleConfInfo.innerAdType||5==t.adStyleConfInfo.innerAdType}catch(i){}return e}function tt(t){return 1==J(t)}function et(t){let e=null;try{if(e=t.advertiserInfo.fansCount,e>0&&e<1e4)return e+"";if(e>=1e4)return e=(e/1e4).toFixed(1)+"万",e}catch(i){}return""}function it(t,e){let i;try{switch(e){case 1:i=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId;break;case 12:i=t.adMatrixInfo.adDataV2.neoTKInfo.templateId;break;case 3:i=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId;break;case 2:i=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId;break;case 4:i=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId;break;case 6:case 9:i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId;break;case 5:i=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId;break;case 7:i=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId;break;case 10:i=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId;break;case 11:i=t.adMatrixInfo.adDataV2.pushTKInfo.templateId;break;case 13:i=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId;break;case 14:i=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId;break;case 15:i=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId;break;case 16:i=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId;break;case 100:i=t.adMatrixInfo.adDataV2.complianceCardInfo.templateId;break;case 101:i=t.adMatrixInfo.adDataV2.downloadConfirmCardInfo.templateId;break;case 17:i=t.adMatrixInfo.adDataV2.feedTKCardInfo.templateId;break;default:i=void 0}}catch(n){i=void 0}return i}function nt(t,e){let i=it(t,e);if(console.log("tkloadcontroller target templateid:"+i),!me(i))return;const n=t.adMatrixInfo.adDataV2.templateDatas.length;for(let s=0;s<n;s++){let e=t.adMatrixInfo.adDataV2.templateDatas[s];if(e.templateId==i)return e}}function st(t,e){let i=it(t,e);if(!i)return null;console.log("tkloadcontroller   get template is:"+i);const n=t.adMatrixInfo.styles.templates.length;for(let s=0;s<n;s++){let e=t.adMatrixInfo.styles.templates[s];if((null==e?void 0:e.templateId)==i)return e}return null}function at(t,e){let i=nt(t,e);if(null!=i)return JSON.parse(i.data).autoCallAppInfo}function ot(t,e){let i=nt(t,e);if(null!=i)return JSON.parse(i.data).downloadCardInfo}function rt(t,e){let i=nt(t,e);if(null!=i)return JSON.parse(i.data).cardDynamicEffects}function ht(t){var e;try{return Le.isAndroid()&&1==t.adBaseInfo.adOperationType&&(null===(e=t.downloadSafeInfo.complianceInfo)||void 0===e?void 0:e.titleBarTextSwitch)>0}catch(i){}return!1}function lt(t){try{let e=t.autoOpenTime;return(e<=0||null==e)&&(e=3e3),e/1e3}catch(e){return 3}}function dt(t){const e=t.adMaterialInfo.materialFeature.length>0?t.adMaterialInfo.materialFeature[0]:null;if(e){let n=e.videoDuration;0==n&&(n=e.videoDurationMs/1e3);let s=n;try{s=t.adRewardInfo.rewardTime}catch(i){}return s?0==n?s:Math.min(n,s):n}return-1}function ct(t){let e="";if(t<=0||t>36e5)return e;let i,n,s,a=Math.floor(t%1e3/100),o=Math.floor(t/1e3),r=Math.floor(o%60),h=Math.floor(o/60%60);return i=""+a.toString(),n=r<10?"0"+r.toString():r.toString(),s=h<10?"0"+h.toString():h.toString(),e=s+":"+n+":"+i,e}function pt(t,e){let i=!0;if(1==t.adBaseInfo.adOperationType)try{let n=t.downloadSafeInfo.complianceInfo;if(console.log("tkloadcontroller   download ad:"+JSON.stringify(n)),null!=n)switch(e){case 1:i=3!=n.actionBarType;break;case 2:i=3!=n.describeBarType;break;case 3:i=3!=n.materialJumpType;break;default:i=!0}}catch(n){i=!0}else try{let n=t.unDownloadConf.unDownloadRegionConf;if(console.log("tkloadcontroller   h5 ad:"+JSON.stringify(n)+", clickArea: "+e),null!=n)switch(e){case 1:i=1!=n.actionBarType;break;case 2:i=1!=n.describeBarType;break;case 3:i=1!=n.materialJumpType;break;default:i=!0}console.log("tkloadcontroller   h5 ad:"+i)}catch(n){i=!0}return i}function mt(t){return 7==J(t)}function gt(t){return K.isOriginLiveAd(t)||mt(t)}function ut(t){return 3==J(t)}function wt(t){let e=null;try{e=t.adMatrixInfo.adDataV2.merchantLiveReservationInfo}catch(i){return!1}if(Ce(e))return!1;if(Ce(e.title)||Ce(e.liveStartTime)||Ce(e.bookUserCount))return!1;try{return 2==t.adStyleConfInfo.innerAdType}catch(i){return!1}}function Ct(t){try{let e=!0;const i=te();if(Le.isAndroid()&&te()&&(e=i.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&e)return!0}catch(e){}return!1}function ft(t){if(Ce(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return Ce(e)&&(e=Y(t)?"立即下载":"查看详情"),e}function yt(t,e){try{if(!me(t.adConversionInfo.playableUrl))return!1;const i=t.adConversionInfo.playableStyleInfo.playableOrientation;return 0==i||2==i&&1==e||1==i&&0==e}catch(i){}return!1}function Tt(t,e,i){try{if(!yt(t,i))return 0;if(3!=e){const e=function(t){let e;try{e=JSON.parse(t.adBaseInfo.expParam)}catch(i){}return e||{}}(t).playableStyle;return!e||e<=0?0:e}if(5==t.adMatrixInfo.adDataV2.actionBarInfo.cardType)return 1;if(6==t.adMatrixInfo.adDataV2.actionBarInfo.cardType)return 2}catch(n){}return 0}function It(t,e){try{let i=e.adMatrixInfo.styles.templates,n=0;for(;n<i.length;++n){let e=i[n];if(e&&t==e.templateId)return e.templateUrl}}catch(i){console.log("TK get matrix url error")}return""}function vt(t,e){try{let i=e.adMatrixInfo.styles.templates,n=0;for(;n<i.length;++n){let e=i[n];if(e&&t==e.templateId)return e}}catch(i){console.log("TK get matrix url error")}return""}function At(t,e){try{let i=e.adMatrixInfo.adDataV2.templateDatas;for(let e=0;e<i.length;e++){let n=i[e];if(n&&t==n.templateId)return n}}catch(i){}}function Vt(t){try{return t.adMatrixInfo.adDataV2.rewardVideoInteractInfo.rewardTime}catch(e){return 5}}function bt(t,e){let i=null,n=Kt(t,e);return n&&(i=function(t,e){let i=nt(t,e);if(null==i)return;return JSON.parse(i.data).redPacketInfo}(t,n)),i}function St(t,e){let i=null,n=Kt(t,e);return n&&(i=function(t,e){let i=nt(t,e);if(null==i)return;return JSON.parse(i.data).merchantCardInfo}(t,n)),i}function xt(t,e){let i=null;return i=function(t,e){let i=nt(t,e);if(null==i)return;return JSON.parse(i.data).ecIndustryInfo}(t,Kt(t,e)),i}function _t(t,e){let i=null;return i=function(t,e){let i=nt(t,e);if(null==i)return;return JSON.parse(i.data).socialCardInfo}(t,Kt(t,e)),i}function Lt(t,e){let i=null;return i=function(t,e){let i=nt(t,e);if(null==i)return;return JSON.parse(i.data).gameIndustryInfo}(t,Kt(t,e)),i}function Dt(t,e){let i=null;return i=function(t,e){let i=nt(t,e);if(null==i)return;return JSON.parse(i.data).deepVideoCardInfo}(t,Kt(t,e)),i}function Ft(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.neoTKInfo.renderType}catch(i){}return e}function kt(t,e){let i=nt(t,e);if(null==i)return;let n=JSON.parse(i.data),s=null;try{s=n.widgetInfo}catch(a){}return s}function Rt(t,e){let i=null,n=Kt(t,e);if(n){let e=kt(t,n);e&&(i=e.redPacketInfo),i&&(i.showTime=1.5)}return i}function Bt(t,e){let i=null,n=Kt(t,e);return n&&(i=function(t,e){let i=nt(t,e);if(null==i)return;return JSON.parse(i.data).giftBoxInfo}(t,n)),i}function Kt(t,e){let i=null;try{if(function(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.videoImageTKInfo.renderType}catch(i){}return e}(t))return 16;if(function(t){let e=!1;try{e=!Ce(t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId)}catch(i){}return e}(t))return 14;2==e?i=Ft(t)?12:4:3==e?i=function(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.fullScreenInfo.renderType}catch(i){}return e}(t)?3:4:13==e?i=2:4==e&&(i=5)}catch(n){}return i}function Et(t){if(Le.isAndroid()){try{return t.shakeInfo.acceleration}catch(e){}return 12}{const i=[.35,.5,.65,.8,1,1.5,2];let n=5;try{n=t.shakeInfo.acceleration-1}catch(e){}return n<=0?n=5:n>=i.length&&(n=i.length-1),i[n]}}function Pt(t){try{return t.bidirectionalSwitch}catch(e){}return!1}function Ot(t,e){var i;if(!Le.supportMinimumTKVersion("4.0.10"))return!1;let n=function(t,e){let i=st(t,e);return Ce(i)?null:i.templateUrl}(t,7);return!Ce(n)&&(null===(i=null==e?void 0:e.appConfig)||void 0===i?void 0:i.autoShowActivityMiddlePage)}function Mt(t){if(null==t)return;let e=null;try{e=JSON.parse(t.data).merchantPlayInfo}catch(i){}return e}function Nt(t,e){if(Ce(e))return;if(!ce())return void t.addEventListener("swipe",(t=>{e()}));let i=null,n=t=>{if("down"==t.type)i=t;else if("up"==t.type&&3==t.motionType&&null!=i){let n=t.position.x,s=t.position.y,a=i.position.x,o=i.position.y;(Math.abs(n-a)>=10||Math.abs(s-o)>=10)&&e()}};t.addEventListener("down",n),t.addEventListener("up",n)}function Ht(t,e){let i=nt(e,3==t?3:12);try{let t=JSON.parse(i.data);return Ce(t)||Ce(t.neoLiveRoomInfoData)?null:t}catch(n){}return null}function Wt(t){var e;return!!(null===(e=null==t?void 0:t.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===e?void 0:e.slideClick)}function zt(t){return!(!t.downloadSafeInfo||!Le.isSupportDownloadDel())&&t.downloadSafeInfo.downloadDeleteEnable}function Ut(t){return!!(Y(t)&&t.downloadSafeInfo&&Le.isSupportDownloadDel())&&t.downloadSafeInfo.downloadShowPauseEnable}function Gt(t,e){try{if(2==e&&7==t.adMatrixInfo.adDataV2.neoVideoInfo.interactionInfo.interactiveStyle)return!0;if(3==e&&7==t.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo.interactiveStyle)return!0}catch(i){return!1}return!1}var jt=null,Yt=null,Xt=null,Jt=null,$t=null;function Zt(t){console.log("tkloadcontroller  save global device info:"+JSON.stringify(t)),jt=t}function qt(t){$t=t}function Qt(){return $t}function te(){return jt}function ee(){return Yt}function ie(){return Jt}function ne(){const t=Tachikoma.env.styleTemplate;return t?JSON.parse(t):null}function se(t,e){e=e||ne(),t=t||O(ie());const i=null==e?void 0:e.templateId,n=null==e?void 0:e.templateVersionCode,s=null==t?void 0:t.adTKGrayConfig,a=i+"#"+n;return(null==s?void 0:s.get(a))||0}function ae(t){if(null==t)return-1;let e=t.screenWidth;return ce()&&(e=Tachikoma.px2Dp(e)),e}function oe(){return Date.parse((new Date).toString())}function re(t){return t instanceof Error?t.message+":"+t.stack:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function he(){var t;return!ce()&&(null===(t=Tachikoma.env.safeAreaInsets)||void 0===t?void 0:t.bottom)>0}function le(){return ce()?{left:0,top:0,bottom:0,right:0}:Tachikoma.env.safeAreaInsets}function de(){return!Ce(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function ce(){return"Android"===Tachikoma.env.platform}function pe(t,e){let i={x:0,y:0};if(Le.supportMinimumTKVersion("4.0.0")){const n=e.getLocationOnScreen(),s=t.position;if(!n||!s)return i;s.x=parseFloat((s.x+"").replace("dp","")),s.y=parseFloat((s.y+"").replace("dp","")),i={x:n.x+s.x,y:n.y+s.y}}return i}function me(t){return"string"==typeof t&&t.length>0}function ge(){return jt?jt.tkVersion:Tachikoma.env.tkVersion||Tachikoma.env.TKVersion}function ue(){return jt?jt.SDKVersion:Tachikoma.env.SDKVersion}function we(){return jt?jt.sdkType:Tachikoma.env.sdkType}function Ce(t){return null===t||null==t||""===t}function fe(t){return!!Ce(t)||0==t.length}new class{};class ye{constructor(t,e,i){this.name=t,this.object=e,this.parent=i,this.children=new Map}addChildren(t,e){this.children.set(t,e)}}function Te(t,e,i){if(t){e||(e=new ye("root",t)),i||(i=new Set),i.add(t);for(const n in t){const s=typeof t[n],a=t[n];if("object"==s&&!n.includes("$")&&a){a.nativeID||(a.nativeID=n);const t=new ye(n,a,e);if(e.addChildren(n,t),i.has(a)){const e=[];e.push(t);let i=t,n=!1;for(;i.parent;)if(i=i.parent,e.push(i),i.object===t.object){n=!0;break}if(n){let t="执行出错：发生循环引用\n";for(let n=e.length-1;n>=0;--n)i=e[n],t+=i.name+":"+i.object+"\n";throw new Error(t)}}Te(a,t,i)}}}}function Ie(){return 1==Tachikoma.env.isDebug}function ve(t,e){let i=e-t,n=Math.random();return t+Math.round(n*i)}function Ae(t){let e=t;return e.indexOf("/")>=0||t.startsWith("http")||(e="https://"+C.getInstance().getCurrentHost()+"/kos/nlav111362/ksad/"+t),e}function Ve(t,e){be(t,e,null)}function be(t,e,i){if(t&&e){const n=Ae(e);t.setImageLoadCallback&&!Ce(n)&&n.startsWith("http")&&t.setImageLoadCallback((t=>{C.getInstance().markUrlFail(n),i&&i(t)})),t.setSrc(n)}}function Se(t,e,i,n){let s=0;if(setTimeout((()=>{0==s&&(s=-1,n(!1))}),i),t&&e){const i=Ae(e);t.setImageLoadCallback&&!Ce(i)&&i.startsWith("http")&&t.setImageLoadCallback((t=>{C.getInstance().markUrlFail(i),n&&0==s&&(s=1,n(t))})),t.setSrc(i)}}function xe(t){return!Ce(t)}function _e(t){const e=t.match(/^([0-9a-zA-Z]+:\/\/)?([\da-zA-Z.-]+)([/\w.-]*)*\/?[/\w]*/);if(e){const[,,t,i]=e;return{host:t,path:i}}return{}}class Le{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||Le.supportMinimumTKVersion("5.0.4")}static isSupportDownloadDel(){return this.isAndroid()&&Le.supportMinimumTKVersion("5.0.7")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let i=t.split("."),n=e.split("."),s=Math.max(i.length,n.length);for(var a=0;a<s;a++){let t=Number(void 0!==i[a]?i[a]:"0"),e=Number(void 0!==n[a]?n[a]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let i=we(),n=1==i&&-1!=Le.compareVersion(ue(),t),s=2==i&&-1!=Le.compareVersion(ue(),e);return n||s}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let i=we(),n=1==i&&0==Le.compareVersion(ue(),t),s=2==i&&0==Le.compareVersion(ue(),e);return n||s}static supportCurrentTKVersion(t="0.0.0"){return ge()==t}static supportMinimumTKVersion(t="0.0.0"){return-1!=Le.compareVersion(ge(),t)}}Le.platform=Tachikoma.env.platform;Ae("h5_default_icon.png"),Ae("download_default_icon.png");const De=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t),Ie()&&console.log("tkloadcontroller:"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class Fe{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i="",n=0;n<t;n++)i+=e.charAt(Math.floor(48*Math.random()));return i}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,i){if(!t)return null;const n=this.randomName(i);return Tachikoma[n]=e=>{t(e)},"Tachikoma."+n}}Fe.globalIndex=0;class ke{static getDeviceInfoAsync(){return ke.callNative("getDeviceInfo",null).then((t=>(t.result&&t.data&&Zt(t.data),t)))}static getKsAdDataAsync(){return ke.callNative("getKsAdData",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,Jt=e),t}))}static getKsAdConfigAsync(){return ke.callNative("getKsAdConfig",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,Yt=e),t}))}static getScreenOrientationAsync(){return ke.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return ke.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return ke.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return ke.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.lifeStatusCallback=t,this.callNativeWithCallback("registerLifecycleListener",null,(t=>{this.lifeStatusCallback&&!this.isForceUpdateLifeStatus&&this.lifeStatusCallback(t)}),!1)}static forceUpdateLifeStatus(t,e){let i={result:1,data:{lifeStatus:t}};this.isForceUpdateLifeStatus=e,this.lifeStatusCallback&&this.lifeStatusCallback(i)}static registerFocusListener(t){Le.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("registerFocusListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,i,n=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},i,n)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static adOutCallback(t,e){Le.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("adOutCallback",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:me(e)?e:""})}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,(e=>{t&&t(e)}),!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,i,n=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:i,playDuration:n})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e,i){this.callNativeWithCallback("openURL",{url:t,title:e,showConfirmDialog:i})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){ce()&&this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((i,n)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),i(t)):i({result:0,data:null})}))))}static callNativeWithCallback(t,e,i,n=!0){const s=de()?1:0;de()&&"pageStatus"==t||de()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,i,n,0):this.callNativeWithCallbackAndType(t,e,i,n,s)}static callTKWithCallback(t,e,i,n=!0){this.callNativeWithCallbackAndType(t,e,i,n,1)}static callNativeWithCallbackAndType(t,e,i,n=!0,s=0){if("undefined"==typeof KwaiAd)return De.log("undefined value KwaiAd"),void(i&&i({result:0,data:null}));De.log("call:"+t);let a=e=>{let n=0,s=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,n=t.result,s=t.data}catch(a){n=0,s=null}De.log("cb:"+t+"  r:"+n),i&&i({result:n,data:s})};const o=Fe.registerCallbackForAction(a,n,t),r={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?a:o};0==s?KwaiAd.callAdBridge(r):KwaiAd.callTKBridge(r)}}function Re(t){ke.callNativeWithCallback("showToast",{message:t})}function Be(){ke.callNativeWithCallback("showActivityMiddlePage")}function Ke(t,e){ke.callNativeWithCallback("cancelAppDownload",t?{url:t}:null,e)}function Ee(){ke.callNativeWithCallback("callbackAfterHandleAdClick",{})}let Pe;function Oe(){var t;return Pe||(Pe={all:t=t||new Map,on(e,i){const n=t.get(e);n?n.push(i):t.set(e,[i])},off(e,i){const n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit(e,i){let n=t.get(e);n&&n.slice().map((t=>{t(i)})),n=t.get("*"),n&&n.slice().map((t=>{t(e,i)}))},clear(){t.clear()}}),Pe}class Me{constructor(t,e,i,n,s,a,o){this.soundEnable=!1,this.ignoreCompliance=!1,this.disableDownloadDialog=!1,this.disableLeaveConfirm=!1,this.disableVideoWebPage=!1,this.disableActivityMiddlePage=!1,this.originAdInfo=t,this.deviceInfo=e,this.serverConfig=i,this.creativeId=a;let r=E(this.originAdInfo,a);this.adInfo=P(r),this.adCacheId=o||Tachikoma.env.adCacheId,this.originAdInfo.adCacheId=this.adCacheId,this.appId=s||Tachikoma.env.appId,this.scene=n,n||(Tachikoma.env.adScene?this.scene=JSON.parse(Tachikoma.env.adScene):this.scene={adStyle:r.adStyle,backUrl:""})}getCommercialLogInfo(){const t=new Ne;t.creativeId=this.creativeId,t.llsid=this.originAdInfo.llsid,t.posId=this.originAdInfo.impAdInfo[0].posId;const e=this.adInfo.adConversionInfo.h5SecondConfirmationSwitch;return t.landingPageType=e?0:1,this.sourceTemplate&&(t.templateId=this.sourceTemplate.templateId,t.templateVersion=this.sourceTemplate.templateVersionCode,t.tkPublishType=se(this.adInfo,this.sourceTemplate)),t}getOcpcActionType(){try{return this.adInfo.ocpcActionType}catch(t){return 0}}getCampaignType(){try{return this.adInfo.adBaseInfo.campaignType}catch(t){return 0}}getIndustryFirstLevelId(){try{return this.adInfo.adBaseInfo.industryFirstLevelId}catch(t){return 0}}getAdOperationType(){try{return this.adInfo.adBaseInfo.adOperationType}catch(t){return 0}}}class Ne{}class He{constructor(){this.reward_type=-1,this.task_type=-1,this.task_step=-1}static createPageShowInstance(t,e,i){if(0==e||Ce(i))return null;if(i.loadDataTime<=0||i.downloadFinishTime<=0)return null;let n=this.INVALID_VALUE;if(e!=this.INVALID_VALUE){n=Date.parse((new Date).toString())-e,n<this.INVALID_VALUE&&(n=this.INVALID_VALUE)}let s=new He;return s.page_status=2,s.load_type=i.loadFromCache?2:1,s.render_duration_ms=n,s.download_type=i.downloadType,s.download_size=i.downloadSize,s.creative_id=t.adBaseInfo.creativeId,s.video_url=z(t),s.video_duration_ms=j(t),s}}function We(t){Ge({category:"ad_client_apm_log",biz:"AD_SPLASH",sub_biz:"OTHER",rate:1,suffixRatio:"",primaryKey:"status",event_id:"ad_sdk_splash_load",type:"EXECUTION_BIZ_TIME",msg:{status:8001,error_msg:t||""}})}function ze(t,e,i,n,s=!0){let a=.01;"component_empty"==t&&(a=1);Ge({category:1==a?"ad_client_error_log":"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:a,suffixRatio:"",event_id:"ad_tk_uicomponent_track",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{is_component:s?1:0,event_name:null!=t?t:"",scene_type:null!=e?e:"",page_id:null!=i?i:"",component_name:null!=n?n:""}})}function Ue(t){Ge({category:"ad_client_apm_log",biz:"AD_SPLASH",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_splash_load",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:t})}function Ge(t){Le.supportMinimumTKVersion("4.0.4")&&(t.msg&&(t.msg.report_source=1),ke.sendCommercialLog(t,(()=>{})))}function je(t,e="",i=""){var n,s;Ge({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_tk_render_performance",primaryKey:"unknown",type:"OTHER",msg:{render_state:3,error_reason:re(t),template_id:Ce(i)?null===(n=ne())||void 0===n?void 0:n.templateId:i,version_code:Ce(e)?null===(s=ne())||void 0===s?void 0:s.templateVersionCode:e}})}function Ye(t,e,i){var n;if(!Le.supportMinimumTKVersion("4.0.7"))return;let s="",a="";if(xe(i)){const{host:t,path:e}=_e(i)||{};s=t||"",a=e||""}const o=t.getCommercialLogInfo();Ge({category:"ad_client_apm_log",biz:qe(null===(n=t.scene)||void 0===n?void 0:n.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_deeplink_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:o.tkPublishType,template_id:o.templateId,version_code:o.templateVersion,creative_id:o.creativeId,llsid:o.llsid,pos_id:o.posId,status:e,url:i,url_host:s,url_path:a}})}function Xe(t,e,i){var n;if(!Le.supportMinimumTKVersion("4.0.7"))return;let s="",a="";if(xe(i)){const{host:t,path:e}=_e(i)||{};s=t||"",a=e||""}const o=t.getCommercialLogInfo();Ge({category:"ad_client_error_log",biz:qe(null===(n=t.scene)||void 0===n?void 0:n.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_deeplink_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:o.tkPublishType,template_id:o.templateId,version_code:o.templateVersion,creative_id:o.creativeId,llsid:o.llsid,pos_id:o.posId,status:e,url:i,url_host:s,url_path:a,error_code:100007}})}function Je(t,e,i,n,s){var a;if(!Le.supportMinimumTKVersion("4.0.7"))return;let o="",r="";if(xe(i)){const{host:t,path:e}=_e(i)||{};o=t||"",r=e||""}const h=n?1:0,l=s?1:0,d=t.getCommercialLogInfo();Ge({category:"ad_client_apm_log",biz:qe(null===(a=t.scene)||void 0===a?void 0:a.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_appstore_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:d.tkPublishType,template_id:d.templateId,version_code:d.templateVersion,creative_id:d.creativeId,llsid:d.llsid,pos_id:d.posId,status:e,url:i,url_host:o,url_path:r,store_type:h,launch_type:l,campaign_type:t.getCampaignType(),ocpc_action_type:t.getOcpcActionType(),industry_first_level_id:t.getIndustryFirstLevelId(),ad_operation_type:t.getAdOperationType()}})}function $e(t,e,i,n,s,a){var o;if(!Le.supportMinimumTKVersion("4.0.7"))return;let r="",h="";if(xe(i)){const{host:t,path:e}=_e(i)||{};r=t||"",h=e||""}const l=s?1:0,d=a?1:0,c=t.getCommercialLogInfo();Ge({category:"ad_client_error_log",biz:qe(null===(o=t.scene)||void 0===o?void 0:o.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_appstore_performance",primaryKey:"unknown",type:"OTHER",msg:{tk_publish_type:c.tkPublishType,template_id:c.templateId,version_code:c.templateVersion,creative_id:c.creativeId,llsid:c.llsid,pos_id:c.posId,status:e,url:i,url_host:r,url_path:h,store_type:l,error_code:100006,error_msg:n,launch_type:d,campaign_type:t.getCampaignType(),ocpc_action_type:t.getOcpcActionType(),industry_first_level_id:t.getIndustryFirstLevelId(),ad_operation_type:t.getAdOperationType()}})}function Ze(t,e){if(!Le.supportMinimumTKVersion("4.0.7"))return;const i=ie(),n=function(t){return(null==t?void 0:t.impAdInfo)&&0!=t.impAdInfo.length?t.impAdInfo[0]:null}(i),s=O(ie());let a=Object.assign(Object.assign({},function(t,e){var i,n;return{creative_id:null==t?void 0:t.adBaseInfo.creativeId,llsid:e,template_id:null===(i=ne())||void 0===i?void 0:i.templateId,version_code:null===(n=ne())||void 0===n?void 0:n.templateVersionCode,tk_publish_type:se(t,ne())}}(s,i.llsid)),{status:t,errorMsg:e});Ge({category:"ad_client_apm_log",biz:qe(n.adStyle),sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_tk_endpage_performance",tag:"ad_tk_endpage_performance",primaryKey:"status",type:"OTHER",msg:a})}function qe(t){let e="OTHER";switch(t){case 3:e="AD_FULLSCREEN";break;case 2:e="AD_REWARD";break;case 4:e="AD_SPLASH";break;case 13:e="AD_INTERSTITIAL";break;case 1:e="AD_FEED";break;case 1e4:e="AD_NATIVE"}return e}He.INVALID_VALUE=-1;class Qe{static createVideoCommonInstance(t,e){return 3==t?Qe.createFullscreenCommonInstance(e):2==t?Qe.createNeoCommonInstance(e):null}static createImageCommonInstance(t,e){var i;let n=new b;return n.template_id=it(e,16),n.template_version=null===(i=st(e,16))||void 0===i?void 0:i.templateVersion,n}static createLiveCommonInstance(t,e){var i;let n=new b;return n.template_id=it(e,14),n.template_version=null===(i=st(e,14))||void 0===i?void 0:i.templateVersion,n}static createNeoCommonInstance(t){var e;let i=new b,n=K.getNeoActionBarCardType(t);return i.actionbar_card_type=n,i.template_id=it(t,12),i.template_version=null===(e=st(t,12))||void 0===e?void 0:e.templateVersion,n!=_.LIVE_CUT3_STYLE1&&n!=_.LIVE_CUT3_STYLE2||(i.live_room_pattern=v.SIMPLIFIED_LIVE_ROOM_PATTERN),i}static createFullscreenCommonInstance(t){let e=new b,i=K.getFullscreenActionBarCardType(t);return e.actionbar_card_type=i,i!=_.LIVE_CUT3_STYLE1&&i!=_.LIVE_CUT3_STYLE2||(e.live_room_pattern=v.SIMPLIFIED_LIVE_ROOM_PATTERN),e}static appendNeoExtData(t,e,i,n){if(null==t)return;let s=t.neo_ext_data;null==s&&(s=new S,t.neo_ext_data=s),i&&(s.videoRollbackToImageTimeout=i.videoRollbackToImageTimeout),s.originalMaterialType=N(e),n&&s&&n(s)}}var ti=function(t,e,i,n){return new(i||(i=Promise))((function(s,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function r(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}h((n=n.apply(t,e||[])).next())}))};class ei{static sendLog(t,e,i,n){this.log(t,null,e,i,n)}static log(t,e,i,n,s){(i=i||{}).renderContainer=1;const a={actionType:t,payload:JSON.stringify(i)};if(s&&(a.creativeId=s),n)if(null==n?void 0:n.adCacheId)a.adCacheId=null==n?void 0:n.adCacheId;else{const t=E(n,s);a.adTemplate=JSON.stringify(t)}e&&(a.clickInfo=e),ke.sendLog(a)}static convertIfNeeded(t,e,i,n,s,a,o,r,h,l,d){let c=pt(e,i);if(!c)return c;let p=Xt;return Ce(p)||(a||(a=new b),Ce(a.template_id)&&(a.template_id=p.templateId),Ce(a.template_version)&&(a.template_version=p.templateVersion)),a=ei.appendGlobalNeoExtData(a,e),gt(e)&&this.reportLivePlaySecond(this.sCurrentPlayTimeMs/1e3),this.convert(i,n,s,t,a,o,r,h,l,d),c}static convert(t,e,i,n,s,a,o,r,l,d){var c,p;return ti(this,void 0,void 0,(function*(){const m=P(E(ie(),r));if(!m||!pt(m,t))return void console.log("tkloadcontroller invalid convert:"+m+":"+t);let g,u;g=Ce(s)?{itemClickType:i,renderContainer:1}:{itemClickType:i,renderContainer:1,clientExtData:JSON.stringify(s)},Ce(a)||Object.assign(g,a),Oe().emit(h,{clickType:i}),e?(u={x:e.x,y:e.y},e.width&&(u.width=e.width),e.height&&(u.height=e.height)):u={};let w=-1;(null==o?void 0:o.convertType)&&(w=o.convertType,g.triggerType=w);let C=!1;if(this.matchTKConversion()){console.log("tkloadcontroller match conversion service");let i=KSAdTKBundleService.getInstance("CommercialKSAdConversionService","conversion-service",null);if(i){console.log("tkloadcontroller service instance is:"+i);const s=new Me(l||ie(),te(),ee());s.currentPlayTime=this.sCurrentPlayTimeMs,s.clickScene=n,s.convertType=w,s.creativeId=r,s.clickArea=t,s.soundEnable=this.sSoundEnable,s.sourceTemplate=ne(),(null==o?void 0:o.liveItemId)&&(s.liveItemId=o.liveItemId),Tachikoma.env.isDebug&&Re("TK转化链路开始"),i.getVersion()>=2&&(this.sSecondClickCallback=t=>{0==t?ke.forceUpdateLifeStatus("pageInvisiable",!0):1==t?ke.forceUpdateLifeStatus("pageInvisiable",!1):2==t&&(ke.forceUpdateLifeStatus("pageVisiable",!1),Le.supportMinimumTKVersion("6.0.3")&&!Le.isAndroid()&&Ee())},i.setSecondConfirmCallback(this.sSecondClickCallback),i.getVersion()>=3&&Le.supportMinimumTKVersion("5.1.3")&&ce()&&(this.sDownloadTipCallback=t=>{switch(t){case 0:ke.adOutCallback({targetMethod:"adDownloadConfirmTipShow"});break;case 2:ke.adOutCallback({targetMethod:"adDownloadConfirmTipCancel"});break;case 1:ke.adOutCallback({targetMethod:"adDownloadConfirmTipDismiss"})}},i.setDownloadConfirmTipCallback(this.sDownloadTipCallback))),this.sHandleAdClickCallback=t=>{if(this.sCurrentPlayTimeMs>0&&(g.playedDuration=this.sCurrentPlayTimeMs),t.reportExtraParam)try{let e=Ce(g.clientExtData)?{}:JSON.parse(g.clientExtData);e.clientExtData=JSON.parse(t.reportExtraParam),g.clientExtData=JSON.stringify(e)}catch(i){je(i)}this.log(2,e,g),Le.isAndroid()||this.handleIOSConvertCallback(t)},this.sAfterHandleClickCallback=()=>{Le.supportMinimumTKVersion("6.0.3")&&!Le.isAndroid()&&Ee()},i.getVersion()>=4&&i.setAfterHandleClickCallback(this.sAfterHandleClickCallback),i.handleAdClick(JSON.stringify(s),this.sHandleAdClickCallback),C=!0}else this.loadConversionServiceIfNeeded((t=>{console.log("tkloadcontroller service load result:"+t)}))}let f=null==l?void 0:l.impAdInfo[0];r||(r=null===(p=null===(c=O(l||ie()))||void 0===c?void 0:c.adBaseInfo)||void 0===p?void 0:p.creativeId),function(t,e,i,n,s,a,o,r){e.isCallbackOnly=r,ke.clickActionBase(Object.assign(Object.assign({area:t,logParam:e},i),{creativeId:n,adTemplate:a,disableCallback:o,isCallbackOnly:r}),s)}(t,{payload:JSON.stringify(g),clickInfo:u,sceneType:n,itemClickType:i},o,r,(i=>{1!=i.result&&(this.log(2,e,g),ke.convert(1==t))}),f,d,C)}))}static handleIOSConvertCallback(t){t.success&&3==t.interactionType&&ke.adOutCallback({targetMethod:"closeConvertPageCallback",methodParams:JSON.stringify({interactionType:t.interactionType})})}static reportClick(t,e,i,n){null==n&&(n=new b),n=ei.appendGlobalNeoExtData(n,t);let s={clientExtData:JSON.stringify(n)};s=Object.assign(s,i),ei.log(2,null,s)}static appendGlobalNeoExtData(t,e){let i=ee(),n=Qt();return null!=n&&null!=i&&(t||(t=new b),Qe.appendNeoExtData(t,e,i.abConfig,(t=>{t.realRenderResult=n}))),t}static expose(t,e){this.log(1,null,t,e)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,i,n,s){this.convertWithType(e,i,n,s)}static convertWithType(t,e,i,n){this.convert(t,e,i,0,null,null,{convertType:n})}static convertWithTypeIfNeededNew(t,e,i,n,s,a){pt(t,e)&&this.convertWithTypeNew(e,i,n,s,a)}static convertWithTypeNew(t,e,i,n,s){this.convert(t,e,i,0,null,s,{convertType:n})}static playNSecond(t,e){let i={photoPlaySecond:t};if(e){let t={clientExtData:JSON.stringify(e)};Object.assign(i,t)}this.log(402,null,i)}static playStart(t){let e=null;t&&(e={clientExtData:JSON.stringify(t)}),ei.log(399,null,e)}static reportLivePlaySecond(t){let e={photoPlaySecond:Math.round(t)},i={actionType:28,payload:JSON.stringify(e)};ke.sendLog(i)}static skip(){this.log(501,null,null)}static loadConversionServiceIfNeeded(t){this.matchTKConversion()&&KSAdTKBundleService.loadBundle("CommercialKSAdConversionService",t),t&&t(!1)}static matchTKConversion(){var t,e;return!!(null===(e=null===(t=ee())||void 0===t?void 0:t.abConfig)||void 0===e?void 0:e.tkConversionSwitch)&&(!(!ce()||!Le.supportMinimumTKVersion("6.0.5"))||!ce()&&Le.supportMinimumTKVersion("6.0.3"))}static updateVideoPlayStatus(t,e,i,n){!function(t,e,i,n){ke.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:i||"",currentTime:n||0})}(t,e,i,n),"progress"==t&&n&&(this.sCurrentPlayTimeMs=n)}static updateLivePlayStatus(t,e,i,n){"progress"==t&&n&&(this.sCurrentPlayTimeMs=n)}}ei.sSoundEnable=!1;class ii{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,ke.pageStatus(t,e),this.registerNativeId(),ei.loadConversionServiceIfNeeded((t=>{})))}registerNativeId(){Ie()&&Le.supportMinimumTKVersion("4.0.7")&&!Le.isAndroid()&&(this.startConfig(),ke.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{Te(this)}),120)}}class ni extends Object{constructor(t,e,i,n){var s;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=i,this.value=this.get(),this.cb(null!==(s=this.value)&&void 0!==s?s:n,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){ni.target=this;const t=this.getter.call(this.vm,this.vm);return ni.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let i=0,n=e.length;i<n;i++){if(!t)return;t=t[e[i]]}return t}}}function si(t){return!!t}function ai(t){return"string"==typeof t}let oi;function ri(){if(null!=oi)return oi;let t=!1;try{t=!1,oi=t}catch(e){}return t}function hi(t,e){if(!0===ri()&&(null==t||!1===t))throw new Error("tkmvvm ----- 请检查传值: "+e)}function li(t){return t.$vm}function di(t){ri()&&console.log("tachikoma TKMVVM log -> "+t)}class ci extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var i=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(n){e?e===n&&i.observeValueWithKey(t,n):i.observeValueWithKey(t,n)}))}observeValueWithKey(t,e){let i=t[e];var n=new mi(e);gi(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return ni.target&&n.depend(),i},set:function(t){t!==i&&(i=t,n.notify(),gi(t))}})}defineArray(t){if(t)for(let e=0,i=t.length;e<i;e++)gi(t[e])}}var pi=0;class mi extends Object{constructor(t){super(),this.key=t,this.pid=pi++,this.deps=new Array}depend(){ni.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function gi(t,e){if(!t||"object"!=typeof t)return;var i;if(!("object"==typeof(i=t)&&Object.keys(i).length>0))return;let n=!1,s=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(s)&&(n=t[s]),!n)return di("observe "+s),t[s]=!0,new ci(t,e);di("already observe "+s)}const ui={updateBackgroundColor:function(t,e,i){if(hi(e,"backgroundColor"),t&&e&&ai(e)){const i=function(t){let e="#FE3666";return t?/^rgb|^hsl/.test(t)?t:(t.startsWith("#")||(t="#"+t),/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(t)?t:e):e}(e);t.style={backgroundColor:i}}},updateStyle:function(t,e,i){hi(e,"style"),t&&e&&(t.style=e)},updateText:function(t,e,i){if(hi(e,"text"),t&&ai(e)){const i=t.setText;"function"==typeof i&&i.call(t,e)}},updateSrc:function(t,e,i){if(hi(e,"src"),t&&e&&ai(e)){const i=t.setSrc;"function"==typeof i&&i.call(t,e)}}};class wi extends Object{constructor(){super()}tk_observe(t){si(t)&&(t in this?gi(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}function Ci(t,e,i,n,s){if(!si(t)||!si(i))return;const a=e.charAt(0).toUpperCase()+e.slice(1),o=ui["update"+a],r=Ti(i),h=null==r?void 0:r.split(".");if(!h)return void hi(h,"tk_bind error, check bind path");const l=h[0],d=li(i);if(!d)return void hi(d,"vm_bind get vm error");d.tk_observe(l),new ni(d,r,((e,i)=>{if(s)for(let t=0;t<s.length;t++){s[t].dataCheck(e,r)}o&&o(t,e,i)}),n)}function fi(t,e){const i=li(t);if(!si(i)||!si(t)||!si(e))return;const n=Ti(t),s=null==n?void 0:n.split(".");if(!s)return void hi(s,"tk_bind error, check bind path");const a=s[0];i.tk_observe(a),new ni(i,n,((t,i)=>{e&&e(t)}))}function yi(t,e,i){if(!si(t)||!si(e)||!si(i))return;const n=Ti(e),s=null==n?void 0:n.split(".");if(!s)return void hi(s,"tk_bind error, check bind path");const a=s[0];t.tk_observe(a),new ni(t,n,((t,e)=>{i&&i(t)}))}function Ti(t){let e=function(t){if(t)return t.bind_path?t.$bind_path:"string"==typeof t?t:void 0}(t);if(e)return e;hi(e,"tk_bind error, check bind path")}class Ii extends TKView{constructor(t,e="#FFFFFF",i={width:264,height:48}){super(),this.showNumber=0,this.progressViewUpdate=!1,this.vm=t,this.hasAutoConverted=!1,this.isShowing=!1,this.color=e,this.progressViewSize=i,this.vm.convertNotify=t=>{this.setConverted(t)},this.vm.closeAutoCallCallback=()=>{this.cardDismiss()},this.setupViews(),this.setupActions()}setupActions(){this.addEventListener("tap",(t=>{})),this.closeBtn.addEventListener("tap",(t=>{this.reportCloseBtnTapped(),this.cardDismiss()}));const t=this,e=13==this.vm.adStyle&&2==this.vm.adDefaultMaterialType;yi(this.vm,this.vm.$attrsPath.lifeStatus,(i=>{"showStart"==i?e&&t.startShowTimer():"hideEnd"==i?e&&t.stopShowTimer():"pageInvisiable"==i&&t.clearProgressTimer()}))}setupViews(){const t=this.oneLineStyle(),e=this.getCardWidth(),i=this.getCardHeight();this.style={right:15,height:i,width:e,flexDirection:"row",justifyContent:"space-between",alignItems:"center",position:"absolute",borderRadius:8,borderWidth:1,borderColor:"#FFFFFF66",visibility:"hidden"},this.isTopAutoCallAppCard()?this.style={top:0!=this.vm.cardTopMargin?this.vm.cardTopMargin:60}:this.style={bottom:0!=this.vm.cardBottomMargin?this.vm.cardBottomMargin:15};const n=new TKView;n.style={top:1,left:1,bottom:1,right:1,height:i-2,width:e-2,position:"absolute",borderRadius:8,backgroundColor:"#30303099"},this.appendChild(n),this.appIcon=new TKImage,this.appIcon.style={width:this.getAppIconWH(),height:this.getAppIconWH(),borderRadius:8,borderWidth:1,borderColor:"#EAEAEAFF",marginLeft:t?8:11,marginBottom:t?8:11,marginTop:t?8:11},this.appIcon.setSrc(this.getAppIconUrl()),this.appendChild(this.appIcon);const s=new TKView;s.style={marginLeft:8,marginRight:8,width:126,height:t?18:34,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"center",flexWrap:"no-wrap",flexShrink:1},this.appendChild(s),this.titleLabel=new TKText,this.titleLabel.style={fontSize:14,color:"#FFFFFF",flexWrap:"no-wrap",textLineClamp:1,width:"100%",textOverflow:"ellipsis"},this.titleLabel.setText(String(lt(this.vm.styleDataInfo))+this.getTitle()),s.appendChild(this.titleLabel),t||(this.subTtileLabel=new TKText,this.subTtileLabel.style={fontSize:12,color:"#FFFFFF99",flexWrap:"no-wrap",textLineClamp:1,width:"100%",textOverflow:"ellipsis"},this.subTtileLabel.setText(this.getSubTitle()),s.appendChild(this.subTtileLabel)),this.closeBtn=new TKButton,this.closeBtn.style={marginRight:9,width:53,height:24,fontSize:12,textAlign:"center",backgroundColor:"#00000000",color:"#FFFFFFB3",borderRadius:12,borderWidth:1,borderColor:"#FFFFFF4D"},this.closeBtn.setText(this.getButtonTitle()),this.appendChild(this.closeBtn)}setConverted(t){this.converted=t,t&&this.cardDismiss()}refreshCardLayout(){this.isShowing&&(this.style={right:15})}handlePlayFailed(){this.cardDismiss()}handlePlayFinished(){this.autoConvertIfNeed()}handlePlayTime(t){const e=j(this.vm.adInfo);let i=Math.floor(t/1e3),n=this.getCardBeginShowTime()/1e3,s=(this.getCardShowTime()+this.getCardBeginShowTime())/1e3,a=13==this.vm.adStyle||e>n+5||K.isOriginLiveAd(this.vm.adInfo);a=!(!a||i!=n||!this.shouldShowCard());let o=s-i<1?1:s-i;if(2==this.vm.adStyle&&(s=dt(this.vm.adInfo),o=s-i<1?1:s-i,a=!!(o==this.getCardShowTime()/1e3||this.isShowHalfPlay()&&o<this.getCardShowTime()/1e3)),a&&(this.isShowing||(this.isShowing=!0,this.addTranslateAction(),13==this.vm.adStyle&&ke.cardImpression(),Oe().emit(d,{}),this.reportCardImpression())),this.isShowing)if(i>=s)this.autoConvertIfNeed();else{const t=this.isShowHalfPlay()?this.getAdTitle():"";this.titleLabel.setText(o+this.getTitle()+t),this.isShowHalfPlay()&&(this.updateProgress(o),this.progressViewUpdate=!0)}}isShowHalfPlay(){return!1}updateProgress(t){if(this.progressViewUpdate)return;if(!this.progressView)return;const e=this.getCardShowTime();let i=e-1e3*t;const n=this;this.progressTimer=setInterval((()=>{i+=100,i>e?n.clearProgressTimer():n.progressView.setProgress(i/e)}),100)}clearProgressTimer(){this.progressTimer&&(this.progressViewUpdate=!1,clearTimeout(this.progressTimer))}startShowTimer(){this.stopShowTimer(),this.showTimer=setInterval((()=>{this.showNumber++,this.handlePlayTime(500*this.showNumber)}),500)}stopShowTimer(){this.showNumber=0,this.showTimer&&clearInterval(this.showTimer),this.showTimer=0}getCardStyle(){let t=0;return t=this.vm.styleDataInfo.cardStyle,t}getCardHeight(){let t=60;return this.oneLineStyle()&&(t=47),t}getCardWidth(){let t=253;return this.oneLineStyle()&&(t=243),t}getAppIconWH(){let t=39;return this.oneLineStyle()&&(t=32),t}getAppIconUrl(){var t;let e=null;return e=null===(t=this.vm.styleDataInfo)||void 0===t?void 0:t.adAppUrl,me(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}getTitle(){let t=null;return t=this.vm.styleDataInfo.title,me(t)||(t="s后打开"),t}getAdTitle(){let t=null;return t=this.vm.styleDataInfo.adTitle,me(t)||(t="可爱的广告君"),t}getSubTitle(){let t=null;return t=this.vm.styleDataInfo.subTitle,me(t)||(t="可查看更多精彩"),t}getButtonTitle(){let t=null;return t=this.vm.styleDataInfo.buttonTitle,me(t)||(t="不用了"),t}oneLineStyle(){let t=!1,e=this.getCardStyle();return 1!=e&&3!=e||(t=!0),t}addTranslateAction(){this.style={right:-this.getCardWidth(),visibility:"visible"},this.animPosition={x:-this.getCardWidth()-15,y:0,z:0};let t=new TKBasicAnimation;t.duration=300,t.animValue={position:this.animPosition},t.on("end",(()=>{this.animateFinishCallback&&(this.animateFinishCallback(),this.animateFinishCallback=null)})),this.addAnimation(t,"translate")}isTopAutoCallAppCard(){let t=this.vm.styleDataInfo.cardStyle;return null==t&&(t=0),1==t||0==t}shouldShowCard(){return!this.converted}getCardShowTime(){let t=2==this.vm.adStyle?3e3:5e3;try{let e=this.vm.styleDataInfo.autoOpenTime;return(e<=0||null==e)&&(e=t),e}catch(e){return t}}getCardBeginShowTime(){let t=13==this.vm.adStyle?5e3:1e4;try{let e=this.vm.styleDataInfo.beginShowTime;return(e<=0||null==e)&&(e=t),e}catch(e){return t}}reportCardImpression(){let t=new b;if(t.template_show_type="auto_evocation_"+this.vm.styleDataInfo.cardStyle,F(this.vm.adInfo)&&this.vm.componentData){t.universe_feature_freq=this.vm.componentData.componentId;const e=this.vm.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds,component_id:this.vm.componentData.componentId};t.component_module=JSON.stringify(i)}else t.universe_feature_freq=13;let e={elementType:191,businessSceneType:10,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}reportCloseBtnTapped(){let t=new b;t.template_show_type="auto_evocation_"+this.vm.styleDataInfo.cardStyle;let e={elementType:69,businessSceneType:10,clientExtData:JSON.stringify(t)},i={actionType:141,payload:JSON.stringify(e)};ke.sendLog(i)}autoConvertIfNeed(){if(!this.hasAutoConverted&&!this.converted&&this.isShowing){let e={},i=new b;this.externalClientExtData&&(i=this.externalClientExtData),i.template_show_type="auto_evocation_"+this.vm.styleDataInfo.cardStyle,F(this.vm.adInfo)&&this.vm.componentData&&(i.component_module=B(this.vm.adInfo,this.vm.componentData)),e.clientExtData=JSON.stringify(i),ei.convertWithTypeIfNeededNew(this.vm.adInfo,1,{x:0,y:0},t.AUTO_CLICK_OTHER_AREA,8,e),this.hasAutoConverted=!0,this.converted=!0,this.cardDismiss()}}cardDismiss(){this.isShowing=!1,this.stopShowTimer(),this.dismissCallback&&(this.dismissCallback(),this.dismissCallback=null)}setExternalClientExtData(t){this.externalClientExtData=t}}class vi extends TKView{constructor(t){super(),this.vm=t,this.cardWidth=this.vm.getCardWidth(),this.cardHeight=this.vm.getCardHeight(),this.setupView(),this.setupData(),this.setupAction(),setTimeout((()=>{this.vm.isHasGuideHandle()&&this.vm.isSecondIcon()?this.startShowNormalAnimation():this.vm.isSecondIcon()?this.startShowSecondIconAnimation():this.vm.isHasGuideHandle()&&this.startGuideHandleAnimationOnly(),this.vm.reportCouponImpression()}),500)}createFontSizeSpanItem(t,e){const i=new TKSpanItem;return i.spanType="absoluteSize",i.color="#F72B2B",i.size=13,i.start=t,i.end=e,i}setupView(){this.style={height:this.cardHeight,width:this.cardWidth,flexDirection:"row",justifyContent:"space-between",overflow:"visible",alignItems:"flex-end",position:"absolute"};let t=0!=this.vm.cardBottomMargin?this.vm.cardBottomMargin:15;Tachikoma.env.deviceHeight,this.cardHeight;this.vm.isShowRightTop()?this.style={right:0,top:0!=this.vm.cardTopMargin?this.vm.cardTopMargin:60}:this.style={left:0,bottom:t},this.firstContentView=new TKView,this.firstContentView.style={top:0,left:0,position:"absolute",width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight(),justifyContent:"center",alignItems:"center",opacity:0},this.appendChild(this.firstContentView),this.firstIcon=new TKImage,this.firstIcon.style={position:"absolute",width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight()},this.firstContentView.appendChild(this.firstIcon),this.guidanceImage=new TKImage,this.guidanceImage.style={top:this.vm.getGuidanceImageMarginTop(),left:this.vm.getGuidanceImageMarginLeft(),position:"absolute",height:this.vm.getGuidanceImageWH(),width:this.vm.getGuidanceImageWH(),opacity:0},this.appendChild(this.guidanceImage),this.SecondContentView=new TKView,this.SecondContentView.style={top:0,left:0,width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight(),justifyContent:"center",alignItems:"center",position:"absolute",opacity:0},this.secondIcon=new TKImage,this.secondIcon.style={width:this.vm.getIconImageWidth(),height:this.vm.getIconImageHeight()},this.SecondContentView.appendChild(this.secondIcon),this.secondPriceView=new TKView,this.secondPriceView.style={top:20,width:this.vm.getIconImageWidth(),height:34,flexDirection:"row",justifyContent:"center",alignItems:"center",alignContent:"center",position:"absolute"},this.SecondContentView.appendChild(this.secondPriceView),this.secondPrice=new TKText,this.secondPrice.style={fontSize:24,color:"#F72B2B",textAlign:"center",justifyContent:"center",fontWeight:"medium"},this.secondPriceView.appendChild(this.secondPrice),this.SecondContentView.appendChild(this.secondPriceView),this.secondBottomGuideMsg=new TKText,this.secondBottomGuideMsg.style={fontSize:12,color:"#D92020",fontWeight:"medium",textAlign:"center",top:69,position:"absolute"},this.SecondContentView.appendChild(this.secondBottomGuideMsg),this.appendChild(this.SecondContentView)}setupData(){let t;this.secondBottomGuideMsg.setText(this.vm.getCouponGuideMsgText()),t=this.vm.getCouponPriceTagText()+this.vm.getCouponPriceText();const e=this.createFontSizeSpanItem(0,this.vm.getCouponPriceTagText().length),i=new TKSpan;i.addSpan(e),this.secondPrice.setSpan(t,i),this.firstIcon.setSrc(this.vm.getCouponFirstIconUrlText()),this.secondIcon.setSrc(this.vm.getCouponSecondIconUrlText()),Ve(this.guidanceImage,"icon_ksad_hand_touch_guide.png")}setupAction(){const t=this;this.addEventListener("tap",(e=>{t.vm.reportCouponClick(e)}))}startHideAnimation(){this.startCouponImageHideAnimation();const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.addAnimation(e,"startHideAnimation")}startCouponImageHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.firstContentView.style={transform:{scale:.8}},t.SecondContentView.style={transform:{scale:.8}},1)]),e.timingFunction="ease-out",e.duration=300,this.addAnimation(e,"startCouponImageHideAnimation")}getShowNormalAnimation(){const t=this;let e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2},opacity:1},.01),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1}},.05),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2}},.1),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1}},.15),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2}},.2),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1},opacity:0},.25),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1},opacity:0},.45),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.55),()=>(t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.65),()=>(t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.8),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.guidanceImage.style={transform:{scale:1},opacity:0},.9),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1},opacity:0},1)]),e.duration=3e3,e.repeatCount=Number.MAX_SAFE_INTEGER,e.timingFunction="linear",e}startShowNormalAnimation(){let t=this.getShowNormalAnimation(),e=this.getShowNormalAnimation(),i=this.getShowNormalAnimation();this.guidanceImage.addAnimation(t,"startShowNormalAnimation"),this.firstContentView.addAnimation(e,"startShowNormalAnimation"),this.SecondContentView.addAnimation(i,"startShowNormalAnimation")}getGuideHandleAnimationOnly(){const t=this;let e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2},opacity:1},.01),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1}},.5),()=>(t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.guidanceImage.style={transform:{scale:1.2}},1)]),e.duration=450,e.repeatCount=Number.MAX_SAFE_INTEGER,e.timingFunction="linear",e}startGuideHandleAnimationOnly(){let t=this.getGuideHandleAnimationOnly(),e=this.getGuideHandleAnimationOnly(),i=this.getGuideHandleAnimationOnly();this.guidanceImage.addAnimation(t,"startGuideHandleAnimationOnly"),this.firstContentView.addAnimation(e,"startGuideHandleAnimationOnly"),this.SecondContentView.addAnimation(i,"startGuideHandleAnimationOnly")}getShowSecondIconAnimation(){const t=this;t.guidanceImage.style={opacity:0};let e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},.01),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},.25),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.35),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.45),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:1,y:1}},opacity:1},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.7),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:0,y:1}},opacity:0},.8),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},.9),()=>(t.guidanceImage.style={opacity:0},t.SecondContentView.style={transform:{scale:{x:0,y:1}},opacity:0},t.firstContentView.style={transform:{scale:{x:1,y:1}},opacity:1},1)]),e.duration=2400,e.repeatCount=Number.MAX_SAFE_INTEGER,e.timingFunction="linear",e}startShowSecondIconAnimation(){let t=this.getShowSecondIconAnimation(),e=this.getShowSecondIconAnimation(),i=this.getShowSecondIconAnimation();this.guidanceImage.addAnimation(t,"startShowSecondIconAnimation"),this.firstContentView.addAnimation(e,"startShowSecondIconAnimation"),this.SecondContentView.addAnimation(i,"startShowSecondIconAnimation")}}class Ai extends TKView{constructor(t,e){super(),this.downloadState=0,this.vm=t,this.showContainer=e,this.setupView(),this.setupAction(),fi(this.vm.$attrsPath.showPopupView,(t=>{console.log("jky KSAdDownloadPopup needShowPopupView: "+t),this.updatePopViewState(t)})),fi(this.vm.$attrsPath.downloadState,(t=>{this.updateControlBtnState(this.vm.isDownloadPaused())})),fi(this.vm.$attrsPath.descText,(t=>{this.desText&&t&&this.desText.setText(t)}))}setupView(){this.style={width:"100%",height:"100%",alignItems:"center",opacity:0,position:"absolute"},this.baseContainer=new TKView,this.baseContainer.style={alignItems:"center",justifyContent:"center",width:245,height:36,top:10,shadow:"0 0 8 #00000099",backgroundColor:"#FFFFFF",borderRadius:120,flexDirection:"row"},this.appendChild(this.baseContainer),this.closeButton=new TKImage,this.closeButton.style={marginStart:10,justifyContent:"center",width:10,height:10},this.closeButton.setSrc("image/ksad-compose-image/ksad_icon_close.png"),this.baseContainer.appendChild(this.closeButton),this.desText=new TKText,this.desText.style={marginStart:10,width:77,fontSize:12,textAlign:"left",includeFontPadding:!1,color:"#222222",fontWeight:"200"},this.desText.setText(this.vm.getDesText()),this.baseContainer.appendChild(this.desText),this.continueButton=new TKText,this.continueButton.style={marginStart:12,width:52,height:20,borderRadius:100,borderWidth:.5,borderColor:"#FE3666",color:"#F66484",fontSize:12,textAlign:"center"},this.updateControlBtnState(!1),this.baseContainer.appendChild(this.continueButton),this.delButton=new TKText,this.delButton.style={marginStart:8,width:52,height:20,borderRadius:100,borderWidth:.5,borderColor:"#4D666666",color:"#666666",fontSize:12,textAlign:"center"},this.delButton.setText("删除"),this.baseContainer.appendChild(this.delButton)}setupAction(){this.baseContainer.addEventListener("tap",(t=>{})),this.closeButton.addEventListener("tap",(t=>{this.vm.onCloseClick(),this.vm.showPopupView=!1})),this.continueButton.addEventListener("tap",(e=>{this.vm.convert(1,1,{x:e.position.rawX,y:e.position.rawY},t.ACTION_BAR_CLICK),this.vm.isNeedShowDownloading()||this.dismissPopup()})),this.delButton.addEventListener("tap",(t=>{var e;e=t=>{ke.showToast(this.vm.getDeleteToast())},ke.callNativeWithCallback("cancelAppDownloadForAd",null,e),this.dismissPopup()}))}updatePopViewState(t){console.log("jky updatePopViewState: show: "+t+", isShow: "+this.isShow),t?this.isShow||(this.showContainer.appendChild(this),this.isShow=!0,this.startShowAnimation()):this.isShow&&(this.showContainer.removeChild(this),this.isShow=!1,this.dismissPopup())}updateControlBtnState(t){t?this.continueButton.setText("继续"):this.continueButton.setText("暂停")}startShowAnimation(){this.style={visibility:"visible"};const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={marginTop:48,opacity:0},0),()=>(this.style={marginTop:64,opacity:1},1)]),t.duration=600,t.repeatCount=1,this.addAnimation(t,"popupShowAnimation")}dismissPopup(){const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={opacity:1},0),()=>(this.style={opacity:0},1)]),t.duration=300,t.repeatCount=1,this.addAnimation(t,"popupDismissAnimation"),this.style={visibility:"hidden"}}setMarginTop(t){this.baseContainer.style={top:t}}}class Vi extends TKView{constructor(t,e,i){super();let n=e.adBaseInfo,s="#00000000";3==t?s="#00000019":0!=t&&(s="#00000025"),this.style={height:Ce(i)?16:i,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",backgroundColor:s,borderRadius:3==t?3:2};let a=3;if(2!=t){let e=null;1==t||3==t?me(n.adMarkIcon)&&(e=n.adMarkIcon):me(n.adGrayMarkIcon)&&(e=n.adGrayMarkIcon),me(e)&&(this.iconView=new TKImage,this.iconView.style={width:12,height:12,marginLeft:3,opacity:3==t?.4:1},a=4,this.appendChild(this.iconView),this.iconView.setSrc(e))}let o="#9C9C9C";0!=t&&(o="#FFFFFF"),this.titleLabel=new TKText,this.titleLabel.style={color:o,minimumTextScaleFactor:.5,fontSize:10,marginLeft:a,marginRight:3,textAlign:"center",includeFontPadding:!1,opacity:3==t?.4:1};let r=n.adSourceDescription;r||(r="广告"),this.titleLabel.setText(r),this.appendChild(this.titleLabel)}setTitleColor(t){this.titleLabel&&(this.titleLabel.style={color:t},this.style={height:16,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",borderRadius:2})}}class bi extends TKView{constructor(t,e=null){super(),this.style={flexDirection:"row",alignItems:"center"},this.starArray=new Array;let i=0;for(;i<5;++i){let n=new TKImage;n.style={width:11,height:11,marginRight:4};t>10*i+5?e&&e.starAllIconUrl?n.setSrc(e.starAllIconUrl):Ve(n,"icon_ksad_star_all_fe3666.png"):t>10*i?e&&e.starHalfIconUrl?n.setSrc(e.starHalfIconUrl):Ve(n,"icon_ksad_star_half_fe3666.png"):e&&e.starGrayIconUrl?n.setSrc(e.starGrayIconUrl):Ve(n,"icon_ksad_star_gray_fe3666.png"),this.appendChild(n),this.starArray.push(n)}}}function Si(t,e,i){const n=new TKKeyframeAnimation;n.setAnimations([()=>(e.style={transform:{rotate:{z:0}}},0),()=>(e.style={transform:{rotate:{z:4}}},.1),()=>(e.style={transform:{rotate:{z:-4}}},.2),()=>(e.style={transform:{rotate:{z:-4}}},.3),()=>(e.style={transform:{rotate:{z:4}}},.4),()=>(e.style={transform:{rotate:{z:2.5}}},.5),()=>(e.style={transform:{rotate:{z:-2.5}}},.55),()=>(e.style={transform:{rotate:{z:-1}}},.6),()=>(e.style={transform:{rotate:{z:1}}},.68),()=>(e.style={transform:{rotate:{z:0}}},.76),()=>(e.style={transform:{rotate:{z:0}}},1)]),n.duration=t,n.on("end",(t=>{i()})),e.addAnimation(n,"anim")}function xi(t,e){const i=new TKBasicAnimation;return i.duration=t,i.timingFunction="Linear",i.animValue={position:{x:e,y:0,z:0}},i}function _i(t,e,i,n,s=!1){const a=new TKKeyframeAnimation;return s?(a.setAnimations([()=>(t.style={transform:{scale:e}},.5),()=>(t.style={transform:{scale:1}},1)]),a.timingFunction="EaseInEaseOut"):(a.animType="scale",a.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:.33,value:e,easing:"EaseInEaseOut"},{percent:.66,value:1/e,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}]),a.duration=i,a.repeatCount=n,a}function Li(t,e,i=!1){const n=new TKKeyframeAnimation;return i?(n.setAnimations([()=>(t.style={opacity:1},1)]),n.timingFunction="ease-in-out"):(n.animType="opacity",n.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}]),n.duration=e,n}function Di(t,e,i=!1){const n=new TKKeyframeAnimation;return i?(n.setAnimations([()=>(t.style={opacity:0},1)]),n.timingFunction="ease-in-out"):(n.animType="opacity",n.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}]),n.duration=e,n}class Fi extends TKView{constructor(t){super(),this.cardDynamicAllowed=!1,this.vm=t}getHeight(){return 0}stopActionAnimation(){}pauseActionAnimation(){}resumeActionAnimation(){}convert(t,e,i){this.vm.convert(1,t,e,i)}addContainerTranslateYAction(t,e,i,n=500){let s=new TKKeyframeAnimation;s.animType="position",s.keyframes=[{percent:0,value:{x:0,y:t},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:e},easing:"EaseInEaseOut"}],s.duration=n,this.addAnimation(s,i)}addContainerAlphaAction(t,e,i=500){let n=new TKKeyframeAnimation;n.animType="opacity",n.keyframes=[{percent:0,value:t!=ce()?1:0,easing:"EaseInEaseOut"},{percent:1,value:t?1:0,easing:"EaseInEaseOut"}],t&&n.on("end",(t=>{this.reportImpressionCallback()})),n.duration=i,this.addAnimation(n,e)}anteversionEffect(t,e,i){let n=new TKKeyframeAnimation,s=.8*t.getSize().width;n.setAnimations([()=>(t.style={transform:{rotate:{x:-15,y:0,z:0},perspective:s}},.225),()=>(t.style={transform:{rotate:{x:4,y:0,z:0},perspective:s}},.4375),()=>(t.style={transform:{rotate:{x:-4,y:0,z:0},perspective:s}},.7125),()=>(t.style={transform:{rotate:{x:0,y:0,z:0},perspective:s}},1)]),n.duration=800,n.timingFunction="linear",t.addAnimation(n,"anteversionAnim"),n.on("end",(()=>{Le.supportMinimumTKVersion("5.0.0")&&setTimeout((()=>{this.addCardDynamicSweepAnimation(t,e,i)}),270)}))}breatheEffect(t,e,i){this.animationCardView?this.animationCardView=t:(this.animationCardView=new TKView,this.animationCardView.style=i,this.insertBefore(this.animationCardView,t));let n=_i(this.animationCardView,1.04,500,1,this.vm.supportNewAnimation());this.animationCardView.addAnimation(n,"breatheEffect1");const s=this;n.on("end",(()=>{s.breatheEffect2(this.animationCardView,e,i)}))}breatheEffect2(t,e,i){let n=_i(t,1.03,500,1,this.vm.supportNewAnimation());t.addAnimation(n,"breatheEffect2");const s=this;n.on("end",(()=>{Le.supportMinimumTKVersion("5.0.0")?setTimeout((()=>{s.addCardDynamicSweepAnimation(t,e,i)}),270):setTimeout((()=>{s.breatheEffect(t,e,i)}),500)}))}addCardDynamicSweepAnimation(t,e,i){if(this.sweepLightView&&e&&e.removeChild(this.sweepLightView),Le.supportMinimumTKVersion("5.0.0")){this.sweepLightView=new RoundRectView,this.sweepLightView.style={left:0,right:0,top:0,bottom:0,borderRadius:e.style.borderRadius,position:"absolute"},this.sweepLightView.throughHitTest=!0,e&&e.appendChild(this.sweepLightView);const n=e.getSize(),s=204*n.height/80;this.sweepLightImage=new TKImage,this.sweepLightImage.style={width:s,height:n.height,left:-s,top:0,position:"absolute"},Ve(this.sweepLightImage,"ksad_video_bottom_sweep_light.png"),this.sweepLightView.appendChild(this.sweepLightImage);let a=xi(500,Number(n.width)+2*s);this.sweepLightImage.addAnimation(a,"sweepAnim");const o=this;a.on("end",(()=>{o.addCardDynamicEffects(t,e,i)}))}}addCardDynamicEffects(t,e,i){if(this.vm.isShowCardDynamicEffects()){const n=this;setTimeout((()=>{1==n.vm.cardDynamicEffects&&n.breatheEffect(t,e,i),2==n.vm.cardDynamicEffects&&n.anteversionEffect(t,e,i),n.cardDynamicAllowed=!0}),600)}}showActionBarAnim(){}onGetMiddleMarginBottom(t){return Number(this.getHeight())}}class ki extends TKView{constructor(t){super(),this.size=t,this.borderRadius=t.borderRadius,this.style={width:this.size.width,height:this.size.height,top:0,left:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius,position:"absolute"},Le.supportMinimumTKVersion("5.0.0")&&(this.canvasView=new Canvas2DView,this.canvasView.style={width:"100%",height:"100%",borderRadius:this.borderRadius},this.canvasView.layerType=1,this.appendChild(this.canvasView),this.roundRectPaint=new Paint,this.roundRectPaint.setColor("FFFFFF30"),this.maskRectPath=new Path,this.maskRectPaint=new Paint,this.maskRectPaint.setColor("#FFFFFF00"),this.maskRectPaint.setPorterDuffMode(0))}setProgress(t){if(!t)return;if(t>1||t<0)return;if(!this.canvasView)return;if(!this.getSize())return;let e=this.getSize().width,i=this.getSize().height;if(e<=0||i<0)return;const n=this,s=t*e;this.canvasView.onDraw=t=>{t.save();const a={x:0,y:0,width:e,height:i};let o=i/2,r=Math.min(n.borderRadius,o);t.drawRoundRect(a,r,r,n.roundRectPaint),n.maskRectPath.reset(),n.maskRectPath.addRect({x:s,y:a.y,width:a.width,height:a.height}),t.drawPath(n.maskRectPath,n.maskRectPaint),t.restore()},this.canvasView.requestDraw()}setProgressColor(t){Le.supportMinimumTKVersion("5.0.0")&&this.roundRectPaint.setColor(t)}}class Ri extends TKView{constructor(t,e,i=null,n=null){super(),this.opType=0,this.supportShowPause=!1,this.downloadProgressBar=null,this.containerConfig=e,this.style={width:this.containerConfig.width,height:this.containerConfig.height,right:this.containerConfig.right,flexDirection:"column",borderRadius:this.containerConfig.borderRadius,backgroundColor:this.containerConfig.backgroundColor||"#FE3666"},this.supportShowPause=Ut(t),this.supportShowPause&&(this.setupDownloadProgressView(),n&&n(this.downloadProgressBar)),this.setupActionButton(),i&&i(this.normalActionButton),this.setupCover()}setupDownloadProgressView(){this.downloadProgressBar=new ki(this.containerConfig),this.downloadProgressBar.style={backgroundColor:this.containerConfig.backgroundColor},this.downloadProgressBar.setProgressColor("#FFFFFF4D"),this.appendChild(this.downloadProgressBar)}setupActionButton(){this.normalActionButton=new TKButton,this.normalActionButton.style={fontSize:14,color:"#FFFFFF",backgroundColor:"#FFFFFF00",left:0,top:0,right:0,bottom:0,textAlign:"center",position:"absolute"},this.appendChild(this.normalActionButton)}setupCover(){this.coverView=new TKView,this.coverView.style={position:"absolute",backgroundColor:"#FFFFFF00",left:0,right:0,top:0,bottom:0},this.appendChild(this.coverView)}setOnTapListener(t){t&&this.coverView&&this.coverView.addEventListener("tap",t)}setOnSwipeListener(t){t&&this.coverView&&this.coverView.addEventListener("swipe",t)}setDownloadChange(t){console.log("jky AdActionButtonView setDownloadChange: "+JSON.stringify(t));let e=t.getProgress();this.downloadProgressBar&&e>=0&&(this.downloadProgressBar.setProgress(e),this.downloadProgressBar.style={visibility:0==e?"hidden":"visible"}),t.isDownloadFinish()&&this.downloadProgressBar&&this.downloadProgressBar.setVisibility("hidden")}setText(t){t&&this.normalActionButton&&this.normalActionButton.setText(t)}}class Bi extends Fi{constructor(e){super(e);let i=1==this.vm.screenOrientation;this.logoView=new Vi(1,this.vm.adInfo);const n=new TKView;this.style={width:Le.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:0},this.logoView.style={marginLeft:12,marginBottom:6},n.style={backgroundColor:"#FFFFFF",height:90,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},i&&(this.style={width:this.vm.containerLimit.height+20,paddingLeft:16,paddingRight:16,paddingBottom:16},this.logoView.style={marginLeft:0,marginBottom:6},n.style={paddingLeft:12,paddingRight:12,borderRadius:12}),this.appendChild(this.logoView),this.appendChild(n);const s=new TKView;s.style={flexDirection:"row",flexShrink:1},n.appendChild(s);let a=0;this.vm.isDownloadAd()&&(this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12},this.appIcon.setSrc(this.vm.getAdIcon()),s.appendChild(this.appIcon),a=12);const o=new TKView;if(o.style={marginLeft:a,height:58,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"stretch",flexWrap:"no-wrap",flexShrink:1,marginRight:16},s.appendChild(o),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,color:"#222222",flexWrap:"no-wrap",textLineClamp:1,textOverflow:"ellipsis"},o.appendChild(this.nameLabel),this.vm.isDownloadAd()){this.nameLabel.setText(this.vm.getAdTitle());const e=new TKView;if(e.style={flexDirection:"column"},o.appendChild(e),this.vm.getAppScore()>=30||me(this.vm.getAppDownloadCountDesc())){if(this.vm.getAppScore()>=30){const i=this.vm.getAppScore();this.scoreView=new bi(i),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),e.appendChild(this.scoreView)}if(me(this.vm.getAppDownloadCountDesc())){let i=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(i=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",marginLeft:0,marginTop:5},this.downloadCountLabel.setText(i),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),e.appendChild(this.downloadCountLabel)}}else this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}))}else this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),o.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));this.rightContainer=new TKView,n.appendChild(this.rightContainer),this.actionBtn=new Ri(this.vm.adInfo,{width:89,height:46,borderRadius:4},(t=>{t.style={fontSize:16}})),this.actionBtn.style={paddingLeft:20,paddingRight:20,marginTop:20,marginBottom:20,marginLeft:5,marginRight:5},fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.rightContainer.appendChild(this.actionBtn),this.rightContainer.clipChildren=!1;const r=new TKView;r.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.rightContainer.appendChild(r),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),r.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),n.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(r,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(n,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation(),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}startActionAnimation(){this.animationAllowed=!0,setTimeout((()=>{if(!this.animationAllowed)return;let t=new TKKeyframeAnimation;t.animType="rotationZ",t.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.11,value:-Le.getRotateSemiCircle()/9,easing:"EaseInEaseOut"},{percent:.22,value:Le.getRotateSemiCircle()/4.5,easing:"EaseInEaseOut"},{percent:.33,value:-Le.getRotateSemiCircle()/4.5,easing:"EaseInEaseOut"},{percent:.44,value:Le.getRotateSemiCircle()/4.5,easing:"EaseInEaseOut"},{percent:.55,value:-Le.getRotateSemiCircle()/6,easing:"EaseInEaseOut"},{percent:.66,value:Le.getRotateSemiCircle()/9,easing:"EaseInEaseOut"},{percent:.77,value:-Le.getRotateSemiCircle()/12,easing:"EaseInEaseOut"},{percent:.88,value:Le.getRotateSemiCircle()/18,easing:"EaseInEaseOut"},{percent:.95,value:-Le.getRotateSemiCircle()/36,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}];t.duration=1500,t.delay=500,t.on("end",(e=>{e?this.addActionRotateAnim(t):setTimeout((()=>{this.addActionRotateAnim(t)}),1500)})),this.addActionRotateAnim(t)}),1e3)}addActionRotateAnim(t){this.animationAllowed&&this.actionBtn.addAnimation(t,"rotate")}stopActionAnimation(){this.animationAllowed=!1,this.actionBtn&&this.actionBtn.removeAllAnimation()}getDefaultHeight(){return 0==this.vm.screenOrientation?112:128}getHeight(){return this.hasInteract?this.limitSize.height:this.getDefaultHeight()}}class Ki extends TKView{constructor(t,e,i){super(),this.adInfo=t,this.fansUrls=function(t){let e=null,i=["icon_ksad_fans_photo4.png","icon_ksad_fans_photo1.png","icon_ksad_fans_photo3.png","icon_ksad_fans_photo2.png"];try{e=t.advertiserInfo.fansIconList}catch(n){}if(null==e)return i;if(e.length<4)for(let s=0;s<4-e.length;s++)e.push(i[s]);return e}(t),this.portraits=new Array;for(let n=0;n<i+1;n++){let t=n%this.fansUrls.length,s=this.fansUrls[t],a=new Ei(s,i);a.left=16*n+4,a.style={position:"absolute",width:e,height:e,borderRadius:e/2,borderWidth:1,borderColor:"#FFFFFF",left:a.left},this.appendChild(a),this.portraits.push(a)}this.portraits[i].style={opacity:0},this.startAnimation()}startAnimation(){this.animationAllowed=!0,this.cycleAnimation()}stopActionAnimation(){this.animationAllowed=!1;for(let t=0;t<this.portraits.length;t++){this.portraits[t].removeAllAnimation()}}cycleAnimation(){this.animationAllowed&&setTimeout((()=>{for(let t=0;t<this.portraits.length;t++){this.portraits[t].moveAnimation(this)}this.cycleAnimation()}),800)}}class Ei extends TKImage{constructor(t,e){super(),this.iconCount=e,Ve(this,t)}moveAnimation(t){this.willHide=!1,this.willShow=!1;let e=this.left;-12==e&&(this.willShow=!0,e=16*this.iconCount+4,t.appendChild(this)),4==e&&(this.willHide=!0);let i=e-16,n=new TKKeyframeAnimation;n.setAnimations([()=>(this.style={left:e,opacity:this.willShow?0:1,transform:{scale:this.willShow?.8:1}},0),()=>(this.style={left:i,opacity:this.willHide?0:1,transform:{scale:this.willHide?.8:1}},1)]),n.duration=500,n.on("end",(()=>{this.left=i})),this.addAnimation(n,"moveAniamtion")}}class Pi extends TKView{constructor(){super(),this.animCount=0,this.animationAllowed=!0,this.createLiveView(),this.createLineLeftView(),this.createLineMiddleView(),this.createLineRightView(),this.startLiveViewAnimation(),this.animationTimer=setInterval((()=>{this.animCount++,this.startLiveViewAnimation()}),300)}createLiveView(){this.liveView=new TKView,this.liveView.style={backgroundColor:"#FE3666",width:16,height:16,borderRadius:8,flexDirection:"row",alignItems:"center",justifyContent:"center"},this.appendChild(this.liveView)}createLineLeftView(){this.lineLeft=new TKView,this.lineLeft.style={position:"absolute",bottom:4,width:1.5,left:4,height:8,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineLeft)}createLineMiddleView(){this.lineMiddle=new TKView,this.lineMiddle.style={position:"absolute",bottom:4,width:1.5,height:4,left:7,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineMiddle)}createLineRightView(){this.lineRight=new TKView,this.lineRight.style={position:"absolute",bottom:4,width:1.5,left:10,height:6,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineRight)}startLiveViewAnimation(){if(!this.animationAllowed)return;const t=this.getAnimation(this.lineLeft,1);this.lineLeft.addAnimation(t,"animLeft");const e=this.getAnimation(this.lineMiddle,2);this.lineMiddle.addAnimation(e,"animMiddle");const i=this.getAnimation(this.lineRight,3);this.lineRight.addAnimation(i,"animRight")}getAnimation(t,e){const i=new TKKeyframeAnimation;return i.setAnimations([()=>(1==e?t.style={height:this.animCount%2==0?6:8}:2==e?t.style={height:this.animCount%2==0?8:4}:3==e&&(t.style={height:this.animCount%2==0?4:6}),1)]),i.duration=300,i}stopLiveViewAnimation(){clearInterval(this.animationTimer),this.animationAllowed=!1,this.lineLeft&&this.lineLeft.removeAllAnimation(),this.lineMiddle&&this.lineMiddle.removeAllAnimation(),this.lineRight&&this.lineRight.removeAllAnimation()}setLineSize(t,e){this.lineLeft.style={bottom:4,width:e,height:t,backgroundColor:"#FFFFFF"},this.lineMiddle.style={bottom:4,width:e,height:t-4,backgroundColor:"#FFFFFF"},this.lineRight.style={bottom:4,width:e,height:t-2,backgroundColor:"#FFFFFF"}}}class Oi extends Fi{constructor(t){super(t),this.bottomBgColor="90,#00000080,#00000000",0==this.vm.screenOrientation?this.style={width:"100%",height:"100%"}:this.style={width:"50%",height:"100%",position:"absolute",right:0,bottom:0},this.setupViews()}setupViews(){let t=new TKView;t.style={width:"100%",height:193,gradientBgColor:this.bottomBgColor,position:"absolute",bottom:0},this.appendChild(t),this.initDailogSmallCard(),this.initDailogBigCard(),this.initBottomUI(),setTimeout((()=>{this.showSmallDialog()}),500)}initBottomUI(){let e=new TKView;e.style={height:68,width:"100%",padding:16,left:0,bottom:0,position:"absolute",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.appendChild(e);let i=new TKView;i.style={flexGrow:1,height:36,marginRight:8,borderRadius:18,backgroundColor:"#FFFFFF32",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",alignContent:"center"},e.appendChild(i),this.fansListView=new Ki(this.vm.adInfo,24,4),this.fansListView.style={width:86,height:24,marginLeft:6},i.appendChild(this.fansListView);let n=new TKText;n.style={fontSize:12,color:"#FFFFFF",marginLeft:-3,marginRight:8,height:34,textAlign:"center"},n.setText(et(this.vm.adInfo)+"人关注了Ta"),i.appendChild(n),this.coverButton=new TKButton,this.coverButton.style={width:110,height:36,borderRadius:18,backgroundColor:"#FE3666",fontSize:14,color:"#FFFFFF"},this.coverButton.setText(this.vm.adInfo.adBaseInfo.adActionDescription),e.appendChild(this.coverButton),i.addEventListener("tap",(e=>{const i=pe(e,this);this.convert(2,i,t.CARD_FOLLOW_NUM)})),this.coverButton.addEventListener("tap",(e=>{const i=pe(e,this);this.convert(1,i,t.CARD_ACTION_BAR_CLICK)}))}initDailogSmallCard(){this.dialogSmallContainer=this.initDailogCardUI(!1),this.appendChild(this.dialogSmallContainer),this.dialogSmallContainer.addEventListener("tap",(e=>{const i=pe(e,this);this.convert(2,i,t.CARD_OTHERAREA_CLICK)}))}initDailogBigCard(){this.dialogBigContainer=this.initDailogCardUI(!0),this.appendChild(this.dialogBigContainer),this.dialogBigContainer.addEventListener("tap",(e=>{const i=pe(e,this);this.convert(2,i,t.CARD_OTHERAREA_CLICK)}))}initDailogCardUI(t){let e=new TKView;e.style={position:"absolute",height:t?88:60,width:"100%",paddingLeft:16,paddingRight:68,top:120,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",opacity:0};let i=new TKView;i.style={height:"100%",width:44},e.appendChild(i);let n=new TKImage;n.style={width:44,height:44,borderColor:"#FFFFFF",borderWidth:1,borderRadius:22};let s=this.vm.adInfo.adBaseInfo.appIconUrl;me(s)||(s="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),n.setSrc(s),i.appendChild(n);let a=new TKView;a.style={position:"absolute",width:26,height:16,borderRadius:8,backgroundColor:"#FE3666",left:9,top:34,flexDirection:"row",justifyContent:"center",alignItems:"center"},i.appendChild(a);let o=new TKImage;o.style={width:12,height:12},Ve(o,"icon_ksad_fans_follow.png"),a.appendChild(o);let r=new TKView;r.style={height:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",flexGrow:1},e.appendChild(r);let h=new TKView;h.style={width:"100%",height:16,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},r.appendChild(h);let l=new TKView;l.style={height:"100%",maxWidth:"80%",marginLeft:12},h.appendChild(l);let d=this.vm.adInfo.adBaseInfo.appName;me(d)||(d=K.getAdTitle(this.vm.adInfo));let c=new TKText;c.style={fontSize:12,height:"100%",width:"100%",color:"#00000030",position:"absolute",marginTop:1,marginLeft:1,textLineClamp:1,textOverflow:"ellipsis"},c.setText(d),l.appendChild(c);let p=new TKText;p.style={fontSize:12,height:"100%",color:"#FFFFFF",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},p.setText(d),l.appendChild(p),this.vm.adInfo.adBaseInfo.isAccountLive&&(t?(this.liveIcon=new Pi,this.liveIcon.style={marginLeft:4,marginRight:4},h.appendChild(this.liveIcon)):(this.liveIconSmall=new Pi,this.liveIconSmall.style={marginLeft:4,marginRight:4},h.appendChild(this.liveIconSmall)));let m=new TKText;m.style={color:"#FFFFFF80",fontSize:12,marginLeft:4,textAlign:"center"},m.setText("刚刚"),h.appendChild(m);let g=new TKView;g.style={marginTop:4,height:t?66:40,width:"100%",paddingRight:16,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},r.appendChild(g);let u=new TKView;u.style={width:7,height:"100%",marginLeft:5},g.appendChild(u);let w=new TKImage;if(w.style={width:7,height:14,position:"absolute",top:10},Ve(w,"icon_ksad_fans_triangle.png"),u.appendChild(w),t){let t=new TKView;t.style={height:"100%",width:"100%",borderRadius:8,paddingLeft:15,paddingRight:15,backgroundColor:"#FFFFFF"},g.appendChild(t);let e=new TKText;e.style={fontSize:14,textLineClamp:2,textLineSpace:4,textOverflow:"ellipsis",color:"#222222",width:"100%",height:"100%",textAlign:"center"},e.setText(this.vm.adInfo.adBaseInfo.adDescription),t.appendChild(e);let i=new Vi(0,this.vm.adInfo);i.style={height:16,position:"absolute",right:4,bottom:4},r.appendChild(i)}else{let t=new TKView;t.style={height:"100%",borderRadius:8,backgroundColor:"#FFFFFF"},g.appendChild(t);let e=new TKText;e.style={fontSize:14,color:"#222222",height:20,marginTop:10,marginBottom:10,marginLeft:15,marginRight:10},e.setText("快来关注我吧"),t.appendChild(e)}return e}stopActionAnimation(){this.dialogSmallContainer.removeAllAnimation(),this.dialogBigContainer.removeAllAnimation(),this.liveIcon.stopLiveViewAnimation(),this.liveIconSmall.stopLiveViewAnimation(),this.fansListView.stopActionAnimation()}showSmallDialog(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.dialogSmallContainer.style={top:106,opacity:1},1)]),t.duration=300,t.on("end",(()=>{setTimeout((()=>{this.showBigDialog()}),2e3)})),this.dialogSmallContainer.addAnimation(t,"showSmallAniamtion")}showBigDialog(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.dialogSmallContainer.style={top:0,opacity:0},1)]),t.duration=500,this.dialogSmallContainer.addAnimation(t,"hideSmallAniamtion");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.dialogBigContainer.style={top:78,opacity:1},1)]),e.duration=500,this.dialogBigContainer.addAnimation(e,"showbigAniamtion")}getHeight(){return 234}}class Mi extends TKView{constructor(){super(),this.tag1=new Ni(1),this.appendChild(this.tag1),this.tag2=new Ni(2),this.appendChild(this.tag2),this.tag3=new Ni(3),this.appendChild(this.tag3),this.tag4=new Ni(4),this.appendChild(this.tag4),this.starAnimation()}starAnimation(){this.tagShow(this.tag1),this.animationAllowed=!0}stopActionAnimation(){this.animationAllowed=!1,this.tag1&&this.tag1.removeAllAnimation(),this.tag2&&this.tag2.removeAllAnimation(),this.tag3&&this.tag3.removeAllAnimation(),this.tag4&&this.tag4.removeAllAnimation()}cycleAnimation(){this.animationAllowed&&(90==this.tag1.status?(this.tag1.status=60,this.tag2.status=90,this.tag3.status=0,this.tag4.status=36):60==this.tag1.status?(this.tag1.status=36,this.tag2.status=60,this.tag3.status=90,this.tag4.status=0):36==this.tag1.status?(this.tag1.status=0,this.tag2.status=36,this.tag3.status=60,this.tag4.status=90):0==this.tag1.status&&(this.tag1.status=90,this.tag2.status=0,this.tag3.status=36,this.tag4.status=60),this.tag1.updateCurrentTop(),this.tag2.updateCurrentTop(),this.tag3.updateCurrentTop(),this.tag4.updateCurrentTop(),setTimeout((()=>{this.cycleAnimation()}),800))}tagShow(t){t.updateCurrentTop(),setTimeout((()=>{t==this.tag1&&(this.tag1.status=60,this.tagShow(this.tag2),this.tag1.updateCurrentTop()),t==this.tag2&&(this.tag2.status=60,this.tag1.status=36,this.tagShow(this.tag3),this.tag1.updateCurrentTop(),this.tag2.updateCurrentTop()),t==this.tag3&&(this.tag3.status=60,this.tag1.status=0,this.tag2.status=36,this.tag1.updateCurrentTop(),this.tag2.updateCurrentTop(),this.tag3.updateCurrentTop(),this.tagShow(this.tag4)),t==this.tag4&&this.cycleAnimation()}),800)}}class Ni extends TKView{constructor(t){switch(super(),this.isShow=!1,this.style={height:20,borderRadius:10,position:"absolute",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",backgroundColor:"#00000060",top:90,opacity:0},this.leftIcon=new TKImage,this.leftIcon.style={width:16,height:16,marginLeft:8},this.appendChild(this.leftIcon),this.contentText=new TKText,this.contentText.style={height:"100%",marginLeft:3,marginRight:8,fontSize:12,color:"#FFDC84",textAlign:"center"},this.appendChild(this.contentText),t){case 1:Ve(this.leftIcon,"icon_ksad_fans_live_car.png"),this.contentText.setText("好物推荐超低折扣");break;case 2:Ve(this.leftIcon,"icon_ksad_fans_live_heart.png"),this.contentText.setText("宠粉主播");break;case 3:Ve(this.leftIcon,"icon_ksad_fans_live_gift.png"),this.contentText.setText("进入直播间送惊喜");break;case 4:Ve(this.leftIcon,"icon_ksad_fans_live_grass.png"),this.contentText.setText("种草达人")}}updateCurrentTop(){let t=90,e=90;if(60==this.status)t=60,e=36;else if(36==this.status)t=36,e=0,this.tagHideAnimation();else{if(0==this.status)return this.style={top:90},void this.layout();t=90,e=60,this.tagShowAnimation()}let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.style={top:t},0),()=>(this.style={top:e},1)]),i.duration=800,this.addAnimation(i,"updateTopAniamtion")}tagShowAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={opacity:0},0),()=>(this.style={opacity:1},1)]),t.duration=800,this.addAnimation(t,"showAniamtion")}tagHideAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={opacity:1},0),()=>(this.style={opacity:0},1)]),t.duration=800,this.addAnimation(t,"hideAniamtion")}}class Hi extends TKView{constructor(t){super(),this.imageSrcs=["icon_ksad_fans_animate_1.png","icon_ksad_fans_animate_2.png","icon_ksad_fans_animate_3.png","icon_ksad_fans_animate_4.png","icon_ksad_fans_animate_5.png","icon_ksad_fans_animate_6.png","icon_ksad_fans_animate_7.png","icon_ksad_fans_animate_1.png","icon_ksad_fans_animate_2.png","icon_ksad_fans_animate_3.png","icon_ksad_fans_animate_4.png","icon_ksad_fans_animate_5.png","icon_ksad_fans_animate_6.png","icon_ksad_fans_animate_7.png"],this.mImageRight=0,this.mImageRight=t,this.images=new Array;for(let e=0;e<this.imageSrcs.length;++e){let t=this.imageSrcs[e],i=this.createAnimateImage(t);this.images.push(i)}}createAnimateImage(t){let e=new TKImage;return e.style={width:34,height:34,position:"absolute",right:this.mImageRight,top:150,opacity:0},Ve(e,t),this.appendChild(e),e}stopActionAnimation(){this.animationAllowed=!1;for(let t=0;t<this.images.length;++t){this.images[t].removeAllAnimation()}}startAnimation(){this.animationAllowed=!0,this.cycleAniamtion()}cycleAniamtion(){if(this.animationAllowed){for(let t=0;t<this.images.length;++t){let e=this.images[t];setTimeout((()=>{this.animationMove(e)}),300*t)}setTimeout((()=>{this.cycleAniamtion()}),4200)}}animationMove(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={transform:{scale:1}},0),()=>(t.style={transform:{scale:1.3}},1)]),e.duration=600,t.addAnimation(e,"scaleAniamtion");let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={opacity:0,top:125},0),()=>(t.style={opacity:1,top:98},.2),()=>(t.style={opacity:1,top:71},.4),()=>(t.style={opacity:0,top:0},.8),()=>(t.style={opacity:0,top:-20},1)]),i.duration=1600,t.addAnimation(i,"moveAniamtion")}}class Wi extends Fi{constructor(t){super(t),this.setupViews(),this.reloadDataInfo(),this.bindEvent()}setupViews(){this.style={width:"100%",height:"100%"},this.initLiveUI(),this.initBottomCardUI(),this.initAniamteUI(),setTimeout((()=>{this.changeAnimation()}),2400)}initLiveUI(){this.liveContainer=new TKView,this.liveContainer.style={position:"absolute",height:132,width:"100%",left:16,top:90,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"},this.appendChild(this.liveContainer),this.liveTopImage=new TKImage,this.liveTopImage.style={width:123,height:52,position:"absolute",top:5},Ve(this.liveTopImage,"icon_ksad_fans_live.png"),this.liveTagListView=new Mi,this.liveTagListView.style={width:"100%",height:100,top:30},this.liveContainer.appendChild(this.liveTagListView),this.liveContainer.appendChild(this.liveTopImage)}initBottomCardUI(){this.bottomContainer=new TKView,this.bottomContainer.style={position:"absolute",width:"100%",height:100,bottom:0,left:-500},this.appendChild(this.bottomContainer),this.ksadLogoView=new Vi(1,this.vm.adInfo),this.ksadLogoView.style={height:16,position:"absolute",right:16,top:0},this.bottomContainer.appendChild(this.ksadLogoView);let t=new TKView;t.style={position:"absolute",width:"100%",height:94,bottom:0,padding:16},this.bottomContainer.appendChild(t);let e=new TKView;e.style={width:"100%",height:"100%",borderRadius:12,backgroundColor:"#00000060",flexDirection:"row",justifyContent:"space-between",padding:12},t.appendChild(e),this.appIcon=new TKImage,this.appIcon.style={width:20,height:20,borderRadius:10},e.appendChild(this.appIcon),this.descText=new TKText,this.descText.style={color:"#FFFFFF",fontSize:14,flexShrink:2,paddingLeft:8,paddingRight:4,width:"100%",textLineSpace:4,textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descText),this.coverBtn=new TKButton,this.coverBtn.style={width:73,height:33,borderRadius:16.5,backgroundColor:"#FFFFFF32",fontSize:14,color:"#FFFFFF"},e.appendChild(this.coverBtn)}initAniamteUI(){this.imageAnimationView=new Hi(15),this.imageAnimationView.style={width:73,height:170,position:"absolute",right:32,opacity:0},this.appendChild(this.imageAnimationView)}reloadDataInfo(){try{let t=this.vm.adInfo,e=t.adBaseInfo.appIconUrl;me(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),this.appIcon.setSrc(e),this.descText.setText(t.adBaseInfo.adDescription),this.coverBtn.setText(t.adBaseInfo.adActionDescription)}catch(t){}}bindEvent(){this.liveContainer.addEventListener("tap",(e=>{const i=pe(e,this);this.convert(2,i,t.CARD_RECOMMEND_REASON_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{const i=pe(e,this);this.convert(2,i,t.CARD_OTHERAREA_CLICK)})),this.coverBtn.addEventListener("tap",(e=>{const i=pe(e,this);this.convert(1,i,t.CARD_ACTION_BAR_CLICK)}))}stopActionAnimation(){this.liveTagListView.stopActionAnimation(),this.imageAnimationView.stopActionAnimation()}changeAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.liveContainer.style={top:10},1)]),t.duration=1e3,this.liveContainer.addAnimation(t,"liveContainerAniamtion"),setTimeout((()=>{this.showBottomAnimation()}),500)}showBottomAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.bottomContainer.style={left:0},1)]),t.duration=500,t.on("end",(()=>{setTimeout((()=>{this.coverButtomAnimation()}),2e3)})),this.bottomContainer.addAnimation(t,"bottomContainerAniamtion")}coverButtomAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.coverBtn.style={backgroundColor:"#FE3666"},1)]),t.duration=500,t.on("end",(()=>{setTimeout((()=>{this.showImageAnimation()}),2e3)})),this.coverBtn.addAnimation(t,"coverAniamtion")}showImageAnimation(){this.imageAnimationView.style={opacity:1},this.imageAnimationView.startAnimation()}getHeight(){return 218}}class zi extends TKView{constructor(t,e){super(),this.itemWidth=2,this.animStopped=!1,e&&e>0&&(this.itemWidth=e),this.itemHeight=t[0],this.mWaveItemHeight=t,this.setupViews()}setupViews(){this.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:13,height:24},this.waveItem1=this.createWaveItemView(),this.waveItem2=this.createWaveItemView(),this.waveItem3=this.createWaveItemView(),this.appendChild(this.waveItem1),this.appendChild(this.waveItem2),this.appendChild(this.waveItem3)}createWaveItemView(){let t=new TKView;return t.style={width:this.itemWidth,height:this.itemHeight,borderRadius:1,backgroundColor:"#FFFFFF"},t}startWaveAnimation(){this.waveItem1.addAnimation(this.createWaveItemAnim(this.waveItem1,[this.mWaveItemHeight[2],this.mWaveItemHeight[1],this.mWaveItemHeight[2]]),"wave"),this.waveItem2.addAnimation(this.createWaveItemAnim(this.waveItem2,[this.mWaveItemHeight[0],this.mWaveItemHeight[2],this.mWaveItemHeight[0]]),"wave"),this.waveItem3.addAnimation(this.createWaveItemAnim(this.waveItem3,[this.mWaveItemHeight[1],this.mWaveItemHeight[0],this.mWaveItemHeight[1]]),"wave")}createWaveItemAnim(t,e){if(Ce(e)||e.length<3)return null;let i=new TKKeyframeAnimation;return i.setAnimations([()=>(t.style={height:e[0]},0),()=>(t.style={height:e[1]},.5),()=>(t.style={height:e[2]},1)]),i.duration=600,i.repeatCount=-1,i.timingFunction="EaseOut",i.on("start",(()=>{this.animStopped&&t.removeAnimation("wave")})),i}}class Ui extends TKView{constructor(t){super(),this.mTipsText="点击进入快手直播间",Ce(t)||(this.mTipsText=t),this.setupViews(),setTimeout((()=>{this.mWaveView.startWaveAnimation()}),500)}setupViews(){this.style={height:46,width:188,borderRadius:23,borderWidth:1,paddingHorizontal:12,borderColor:"#FFFFFF66",backgroundColor:"#0000004D",flexDirection:"row",justifyContent:"center",alignSelf:"center",alignItems:"center"},this.mWaveView=new zi([5,9,13]),this.appendChild(this.mWaveView),this.mTipsView=new TKText,this.mTipsView.style={height:"100%",flexBasis:100,flexGrow:1,flexShrink:1,color:"#FFFFFF",fontSize:16,marginLeft:6,includeFontPadding:!1,textAlign:"center"},this.mTipsView.setText(this.mTipsText),this.appendChild(this.mTipsView)}}class Gi extends TKView{constructor(){super(),this.mIconContainerSize=40,this.mIconSize=36,this.setupViews()}setupViews(){this.style={width:this.mIconContainerSize,height:this.mIconContainerSize+2,flexDirection:"column",alignItems:"center",justifyContent:"flex-start"};let t=new TKView;t.style={width:this.mIconContainerSize,height:this.mIconContainerSize,borderRadius:this.mIconContainerSize/2,borderColor:"#FE3666",borderWidth:1,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.mIconView=new TKImage,this.mIconView.style={width:this.mIconSize,height:this.mIconSize,borderRadius:this.mIconSize/2,alignSelf:"center"},t.appendChild(this.mIconView),this.appendChild(t),this.mLivingLabel=new TKText,this.mLivingLabel.style={fontSize:10,color:"#FFFFFF",backgroundColor:"#FE3666",height:14,borderRadius:7,paddingHorizontal:4,textAlign:"center",includeFontPadding:!1,position:"absolute",bottom:0},this.mLivingLabel.setText("直播中"),this.appendChild(this.mLivingLabel)}setIconUrl(t){this.mIconView&&t&&this.mIconView.setSrc(t)}}class ji extends wi{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>Yi(t,e)})}getData(t){}}function Yi(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(i,n)=>"string"!=typeof n||"function"==typeof i[n]||0==n.indexOf("$")?Reflect.get(i,n):Yi(t,e+"."+n)})}class Xi extends ji{constructor(t,e,i,n,s){super(),this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s}updateLifeStatus(t){this.lifeStatus=t}isVertical(){return 0==this.screenOrientation}getLiveButtonTitle(){return Ce(this.adInfo.adBaseInfo.universeLiveGuideText)?"点击进入直播间":this.adInfo.adBaseInfo.universeLiveGuideText}}class Ji{constructor(){this.downloadStats=0,this.downloadProgress=-1,this.totalBytes=0}static newInstance(t,e,i){let n=new Ji;return n.downloadStats=t,n.downloadProgress=e,n.totalBytes=i,n}obtainActionButtonText(t){let e,i=Ut(t);switch(this.downloadStats){case 0:case 1:case 4:e=t.adBaseInfo.adActionDescription;break;case 2:e=i?"暂停":`${(100*this.downloadProgress).toFixed(0)}%`;break;case 3:e="继续下载";break;case 5:e=me(t.adBaseInfo.installAppLabel)?t.adBaseInfo.installAppLabel:"点击安装";break;case 6:e=me(t.adBaseInfo.openAppLabel)?t.adBaseInfo.openAppLabel:"立即打开"}return e}getProgress(){return this.downloadProgress}getDownloadState(){return this.downloadStats}getTotalBytes(){return this.totalBytes}isDownloadFinish(){return 5==this.downloadStats||6==this.downloadStats}isDownloading(){return 2==this.downloadStats}}class $i extends ji{constructor(){super(...arguments),this.actionText="",this.downloadChangeEvent=new Ji,this.lifeStatus="none",this.hasExtraReward=!1,this.widthDp=0,this.slotId=-1,this.componentData=void 0}obtainScreenWidthDp(){return this.widthDp>0?this.widthDp:375}isScreenPortrait(){return 0==this.screenOrientation}checkDataValid(){return!!this.adInfo}getBottomBarStyle(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.style}catch(t){}return 0}getShortVideoFollowPlaycardStyle(){return this.configInfo.abConfig.shortVideoFollowRewardPlayStyle}isEcFollow(){return ut(this.adInfo)}getNeoActionBarCardType(){return 2==this.adStyle?K.getNeoActionBarCardType(this.adInfo):3==this.adStyle?K.getFullscreenActionBarCardType(this.adInfo):null}getActionBarStyle(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType}catch(t){}return 0}getLightInteractionType(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionType}catch(t){}return 0}getLightInteractionShowTime(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionShowTime}catch(t){}return 2}getLightInteractionDuration(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionDuration}catch(t){}return 6}getAdAttributeType(){return this.adInfo.adBaseInfo.adAttributeType||0}isDownloadAd(){return 1==this.adInfo.adBaseInfo.adOperationType}getDownloadAppIcon(){let t;try{t=this.adInfo.adBaseInfo.appIconUrl}catch(e){}return me(t)||(t="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),t}getAdTitle(){var t;return tt(this.adInfo)&&si(null===(t=this.adInfo.adProductInfo)||void 0===t?void 0:t.name)?this.adInfo.adProductInfo.name:X(this.adInfo)}getAppScore(){return this.adInfo.adBaseInfo.appScore||0}getAppDownloadCountDesc(){return this.adInfo.adBaseInfo.appDownloadCountDesc||null}getAdDescription(){return this.adInfo.adBaseInfo.appDescription||this.adInfo.adBaseInfo.adDescription||null}getAdActionDesc(){return this.adInfo.adBaseInfo.adActionDescription||""}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}getAdIcon(){var t,e;return tt(this.adInfo)&&me(null===(e=null===(t=this.adInfo)||void 0===t?void 0:t.adProductInfo)||void 0===e?void 0:e.icon)?this.adInfo.adProductInfo.icon:M(this.adInfo)}isVerticalMaterial(){let t=U(this.adInfo);return t.width<t.height}getMaterialSize(){return U(this.adInfo)}getVideoDuration(){return j(this.adInfo)}isAdForLive(){return mt(this.adInfo)}isAddLiveButton(){return 1==this.adInfo.adBaseInfo.universeLiveStyle}isShortLive(){return 6==J(this.adInfo)}isECOrderAd(){return function(t,e){if(tt(e))return!1;let i=!1;try{i=1==t.abConfig.ecRewardAdKwaishopStyle}catch(n){return!1}return i&&Q(e)}(this.configInfo,this.adInfo)}isLiveSubscribe(){return wt(this.adInfo)}isClickReward(){return Ct(this.adInfo)}isCommercialProductStyle(){return tt(this.adInfo)}getAdTagList(){try{const t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.extraDisplayInfo.exposeTagInfoList;if(t.length>0)return t}catch(t){}return null}getPlayableStyle(){return Tt(this.adInfo,this.adStyle,this.screenOrientation)}isHorizontalPlayable(){return 0!=this.getPlayableStyle()&&1==this.screenOrientation}convert(t,e,i,n,s=null,a,o){F(this.adInfo)&&this.componentData&&(s||(s=new b),s.component_module=B(this.adInfo,this.componentData)),ei.convertIfNeeded(t,this.adInfo,e,i,n,s,a,o)}getECOrderData(){return this.mCardModel||(this.mCardModel=qi.newInstance(this.adInfo)),this.mCardModel}getDirectEcData(){return this.directEcCardModel||(this.directEcCardModel=Qi.newInstance(this.adInfo,this.configInfo)),this.directEcCardModel}getNormalModel(){return this.normalCardModel||(this.normalCardModel=en.newInstance(this.adInfo,this.configInfo.appConfig)),this.normalCardModel}getLiveSubscribeModel(){return null==this.liveSubscribeModel&&(this.liveSubscribeModel=nn.newLiveSubscribeCarInstance(this.adInfo,this.componentData)),this.liveSubscribeModel}getCouponModel(){return this.couponCardModel||(null!=tn.newInstance(this.adInfo,this.styleType,this.configInfo)?this.couponCardModel=tn.newInstance(this.adInfo,this.styleType,this.configInfo):this.couponCardModel=new tn),this.couponCardModel}getKSAdLiveButtonViewModel(){return this.adLiveButtonModel=new Xi(this.adInfo,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation),this.adLiveButtonModel}getCouponBackImageUrl(){return"icon_ksad_video_coupon.png"}supportNewAnimation(){return Le.supportMinimumTKVersion("4.0.0")}showPlayable(t){ei.clickElement(67),ke.showPlayable(t)}isDiscountNewStyle(){let t=!1;try{t=1==this.adInfo.adProductInfo.discountStyle}catch(e){}return Le.isAndroid()||Le.supportMinimumTKVersion("4.0.3")||(t=!1),0==this.getDiscountType()&&(t=!1),t}isAutoChooseReward(){try{return 1==this.adInfo.adProductInfo.autoChoose}catch(t){}return!1}getAutoChooseRewardCountDown(){try{return this.configInfo.appConfig.interactiveStyleConfig.chooseRewardTime}catch(t){}return 20}getGuideChooseRewardCountDown(){try{return this.configInfo.appConfig.interactiveStyleConfig.superDiscountTime}catch(t){}return 60}getGuideChooseRewardRemainingTime(){try{return this.configInfo.appConfig.interactiveStyleConfig.transitReceiveTime}catch(t){}return 10}getDiscountType(){try{return this.adInfo.adProductInfo.discountType}catch(t){}return 0}enableShowGuidanceRedPacket(){return this.getVideoDuration()-this.getAutoChooseRewardCountDown()>=this.getGuideChooseRewardRemainingTime()}getDiscountInfos(){try{return this.adInfo.adProductInfo.fakeDiscountInfos}catch(t){}return[]}getRedPacketValueString(t){const e=this.getDiscountInfos();if(0==t){if(e.length>1)return e.length>2?e[2]:e[1]}else if(1==t){if(e.length>0)return e[0]}else if(2==t&&e.length>2)return e[1];return""}getRedPacketImageUrl(t,e){let i="";if(t){if(i=1==this.getDiscountType()?"icon_ksad_discounts_red_packet_open_coupon.png":"icon_ksad_discounts_red_packet_open.png",Ce(this.getRedPacketValueString(e)))return"icon_ksad_discounts_red_packet_open_surprise.png"}else i=1==e?"icon_ksad_discounts_red_packet_close_most.png":"icon_ksad_discounts_red_packet_close.png";return i}setStyleType(t){this.styleType=t}isValidBottomCouponCardInfo(){return null!=this.bottomCouponInfo}getCouponBottomBusinessType(){let t;try{t=null==this.bottomCouponInfo?0:this.bottomCouponInfo.businessType}catch(e){t=0}return t}getCouponBottomDuration(){let t;try{t=null==this.bottomCouponInfo?0:this.bottomCouponInfo.couponDuration}catch(e){t=0}return t}getCouponCardViewBg(){let t;try{t=null==this.bottomCouponInfo?"ksad_bottom_bar_coupon_bg.png":this.bottomCouponInfo.couponIcon}catch(e){t="ksad_bottom_bar_coupon_bg.png"}return me(t)||(t="ksad_bottom_bar_coupon_bg.png"),t}getCouponBottomPriceRMB(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.priceTag}catch(e){t=""}return me(t)||(t=""),t}getCouponBottomPrice(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.price}catch(e){t=""}return me(t)||(t=""),t}getCouponBottomTitle(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.title}catch(e){t=""}return me(t)||(t=""),t}getCouponBottomActionBtn(){let t;try{t=null==this.bottomCouponInfo?"":this.bottomCouponInfo.actionBarDesc}catch(e){t=""}return me(t)||(t=""),t}getProductShortTitle(){let t;try{t=this.adInfo.adProductInfo.shortTitle}catch(e){}return me(t)||(t=""),t}getProductSellingPoint(){let t;try{t=this.adInfo.adProductInfo.sellingPoint}catch(e){}return me(t)||(t="优惠好物 诚心推荐"),t}getDiscountFinalViewWidth(){return 0==this.screenOrientation?Tachikoma.env.deviceWidth:324}getRedPacketViewSize(t,e){let i=Tachikoma.env.deviceWidth-80;1!=t&&(i=0==this.screenOrientation?Tachikoma.env.deviceWidth-76-60:200);let n=i/3.15,s=1.15*n;return{width:1==e?s:n,height:1==e?s/.77:n/.77}}getDiscountNeoExtData(t){const e=this.getDiscountType();let i=new S;return 1==e?i.neoAwardType="union_coupon":2==e?i.neoAwardType="union_spike":3==e&&(i.neoAwardType="union_discount"),t&&t.length>0&&(i.neoAwardAmount=t.join(",")),i}getDiscountTemplateShowType(t){return 1==t?"neo_award_card_1":2==t?"neo_award_card_2":3==t?"neo_award_card_3":""}reportDiscountViewImpression(t){let e=new b;e.neo_ext_data=this.getDiscountNeoExtData(this.getDiscountInfos()),e.template_show_type=this.getDiscountTemplateShowType(t);let i,n={clientExtData:JSON.stringify(e)};1==t?i=929:2==t?i=930:3==t&&(i=931);let s={actionType:i,payload:JSON.stringify(n)};ke.sendLog(s)}reportDiscountInitialViewClose(t){let e=new b;e.template_show_type=this.getDiscountTemplateShowType(t);let i={elementType:69,clientExtData:JSON.stringify(e)},n={actionType:141,payload:JSON.stringify(i)};ke.sendLog(n)}getCouponTemplateShowType(t){return 1==t?"coupon_of_cash_equity":2==t?"coupon_of_no_cash_equity":""}reportEquityCardImpression(t){let e=new b;e.template_show_type=this.getCouponTemplateShowType(t);let i={elementType:16,clientExtData:JSON.stringify(e)},n={actionType:140,payload:JSON.stringify(i)};ke.sendLog(n)}isDeepVideoStyle(){if(1==this.screenOrientation)return!1;if(Ce(this.deepVideoModel)&&(this.deepVideoModel=new sn(this.adInfo)),Ce(this.deepVideoModel.deepVideoInfo)){try{let t;t=2==this.adStyle?this.adInfo.adMatrixInfo.adDataV2.neoTKInfo.templateId:this.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.templateId;let e=Mt(At(t,this.adInfo));if(!Ce(e)&&e.merchantPlayCardStyle>0)return this.deepVideoModel.deepVideoInfo=e,!0}catch(t){}return!1}return!0}isShowCardDynamicEffects(){return 2==this.adStyle?this.cardDynamicEffects=rt(this.adInfo,12):3==this.adStyle&&(this.cardDynamicEffects=rt(this.adInfo,3)),!Ce(this.cardDynamicEffects)&&!(2==this.cardDynamicEffects&&!Le.supportMinimumTKVersion("6.0.0"))}getLiveCutRoomInfo(){return Ht(this.adStyle,this.adInfo)}reportConductCardImpression(t){let e=new b;e.template_show_type=t;let i={elementType:19,clientExtData:JSON.stringify(e)},n={actionType:140,payload:JSON.stringify(i)};ke.sendLog(n)}getDownloadCardTemplateShowType(){var t,e;return 1==(null===(t=this.downloadCardDataInfo)||void 0===t?void 0:t.style)?"white_download_card":2==(null===(e=this.downloadCardDataInfo)||void 0===e?void 0:e.style)?"black_download_card":void 0}isValidDownloadCardInfo(){return 2==this.adStyle?this.downloadCardDataInfo=ot(this.adInfo,12):3==this.adStyle&&(this.downloadCardDataInfo=ot(this.adInfo,3)),!(Ce(this.downloadCardDataInfo)||!me(this.getAppDownloadCountDesc()))}reportDownloadCardImpression(){let t=new b;t.template_show_type=this.getDownloadCardTemplateShowType(),this.isShowCardDynamicEffects()&&(t.dynamic_show_type=this.cardDynamicEffects);let e={elementType:19,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}reportOptimalCardImpression(){let t=new b;t.template_show_type=this.getOptimalCardShowType(),this.isShowCardDynamicEffects()&&(t.dynamic_show_type=this.cardDynamicEffects);let e={elementType:19,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}getOptimalCardShowType(){switch(this.getActionBarStyle()){case 1:return"basic_smallcard";case 2:return"gradient_card";case 4:return"immersion_bigcard";default:return""}}}class Zi{constructor(t){if(this.hour="0",this.minute="0",this.second="0",t>0){let e=t/1e3;this.hour=Math.floor(e/3600).toString(),e%=3600,this.minute=Math.floor(e/60).toString(),e%=60,this.second=Math.floor(e).toString()}}getFormattedHour(){return this.formatTime(this.hour)}getFormattedMinute(){return this.formatTime(this.minute)}getFormattedSecond(){return this.formatTime(this.second)}formatTime(t){return Ce(t)?"":t.length>1?t:"0"+t}}class qi{static newInstance(t){let e,i=new qi,n=t.adProductInfo,s=n.seckillInfo;return i.hasCounpon=!fe(n.couponList),i.name=Ce(n.name)?"可爱的广告君":n.name,i.icon=n.icon,i.price=n.price,i.originalPrice=n.originPrice,Ce(s)||(i.spikeTimestamp=s.endTime,i.spikeSoldStock=s.soldStock,i.spikeOriginalStock=s.originalStock),i.hasSpike=i.spikeTimestamp>0,i.volume=n.volume,i.rating=n.rating,i.btnClickText="立即抢购",i.volume&&i.rating?i.volumeAndRating=i.volume+" | "+i.rating:i.volume?i.volumeAndRating=i.volume:i.rating&&(i.volumeAndRating=i.rating),i.adInfo=t,e=i.hasSpike&&i.hasCounpon?"spikeAndCoupon":i.hasSpike?"spike":i.hasCounpon?"coupon":"noSpikeAndNoCoupon",i.cardStyle=e,i}getSpikeTime(){let t=Date.parse((new Date).toString());return new Zi(this.spikeTimestamp-t)}getAdDesc(){let t;return t=this.hasSpike?"已抢"+this.spikeSoldStock+"/"+this.spikeOriginalStock+"件":Ce(this.rating)||Ce(this.volume)?Ce(this.rating)?Ce(this.volume)?"":this.volume:this.rating:this.volume+"·"+this.rating,t}getPricePrefix(){let t;return t=this.hasCounpon?"券后价":this.hasSpike?"秒杀价":"惊喜价",t}getHeaderIcon(){return this.hasCounpon?"icon_ksad_ec_order_coupon.png":"icon_ksad_ec_order_gift.png"}getHeaderTips(){return this.hasCounpon?"恭喜你，获取一张优惠券":"恭喜你发现好价，手慢无～"}getCardStyleLog(){let t;if(Ce(this.cardStyle))return t="5",t;switch(this.cardStyle){case"spikeAndCoupon":t="1";break;case"spike":t="2";break;case"coupon":t="3";break;case"noSpikeAndNoCoupon":t="4";break;default:t="5"}return t}}class Qi{static newInstance(t,e){let i=new Qi;i.cardStyle=0|e.appConfig.h5UrlNewStyle;let n=t.adProductInfo;if(i.hasCounpon=!fe(n.couponList),i.hasCounpon){const t=n.couponList[0];i.couponTitle="￥ "+t.displayValue}if(i.name=Ce(n.name)?"可爱的广告君":n.name,i.icon=n.icon,i.price=me(n.price)?n.price:"惊喜价",i.originalPrice=n.originPrice,!fe(n.couponList)){let t=n.couponList[0];i.spikeIntervalMs=1e3,i.spikeTimestamp=me(t.leftFetchTime)?Number(t.leftFetchTime):0}return i.hasSpike=i.spikeTimestamp>0&&2==i.cardStyle,i.volume=n.volume,i.rating=n.rating,i.btnClickText="立即抢购",i.volume&&i.rating?i.volumeAndRating=i.volume+" | "+i.rating:i.volume?i.volumeAndRating=i.volume:i.rating&&(i.volumeAndRating=i.rating),i.adInfo=t,i}getSpikeTime(){this.spikeTimestamp<0&&(this.spikeTimestamp=0);const t=new Zi(this.spikeTimestamp);return this.spikeTimestamp-=this.spikeIntervalMs,t}}class tn{constructor(){this.cardStyle=0,this.delayTime=2}static newInstance(t,e,i){return function(t,e){let i=nt(t,e);if(Ce(i)||Ce(i.data))return;let n=JSON.parse(i.data);return Ce(n.couponInfo)?void 0:(null==n.couponInfo.delayTime&&(n.couponInfo.delayTime=2),n.couponInfo)}(t,e)}}class en{bindBaseData(t){this.iconUrl=M(t),this.name=X(t),this.actionText=ft(t),this.desc=t.adBaseInfo.adDescription}static newInstance(t,e){let i=new en;return i.bindBaseData(t),i.extraActionText=e.rewardContentExtraRewardNotClickedDesc,Ce(i.extraActionText)&&(i.extraActionText="立即点击，可再得1份奖励"),i.extraActionTextClicked=e.rewardContentExtraRewardClickedDesc,Ce(i.extraActionTextClicked)&&(i.extraActionTextClicked="立即打开"),i}}class nn extends en{static newLiveSubscribeCarInstance(t,e){let i=new nn;if(F(t)&&e){let t=R(e);t&&(i.name=t.title,i.desc=t.liveStartTime,i.iconUrl=t.userHeadUrl,i.subscribeCount=this.formatCount(t.bookUserCount))}else{let e=t.adMatrixInfo.adDataV2.merchantLiveReservationInfo;e&&(i.name=e.title,i.desc=e.liveStartTime,i.iconUrl=e.userHeadUrl,i.subscribeCount=this.formatCount(e.bookUserCount))}return i}static formatCount(t){let e="";if(t>=50&&t<1e4)e=t.toFixed(2);else if(t>=1e4){e=(t/1e4).toFixed(1)+"万"}return e}}class sn{constructor(t){this.deepVideoInfo=void 0,this.adInfo=t}getDeepVideCardStyle(){return this.deepVideoInfo.merchantPlayCardStyle}getDeepVideoTransformTime(){try{if(this.deepVideoInfo.showNewStyleDelaySeconds>0)return this.deepVideoInfo.showNewStyleDelaySeconds}catch(t){}return 5}getDeepVideoGoodsIcon(){return me(this.deepVideoInfo.icon)?this.deepVideoInfo.icon:M(this.adInfo)}getDeepVideoGoodsIconlabel(){return this.deepVideoInfo.iconLabel}getDeepVideoGoodsTitle(){return this.deepVideoInfo.itemTitle}getDeepVideoAuthorName(){return this.deepVideoInfo.authorName}isDeepVideoShowLowPrice(){var t;return null!==(t=this.deepVideoInfo.showLowPrice)&&void 0!==t&&t}getDeepVideoPrice(){return this.deepVideoInfo.price}getDeepVideoOrderList(){return this.deepVideoInfo.itemTradeInfoList}getActionBarDesc(){return this.deepVideoInfo.actionBarDesc}isShowComments(){return this.deepVideoInfo.showComments}getCommentList(){try{return this.deepVideoInfo.confCommentList}catch(t){return null}}}class an extends en{static newLiveCutInstance(t,e){var i;let n=new an;n.bindBaseData(t);let s=null==e?void 0:e.neoLiveRoomInfoData;if(Ce(s))return null;try{if(n.iconUrl=s.authorIconUrl,n.sellerTag=s.sellerTag,Ce(n.sellerTag)&&(n.sellerTag="优质主播"),n.actionBarDesc=s.actionBarDesc,n.tradeCustomerDesc=s.tradeCustomerDesc,n.watchCount=s.watchCount,s.watchUserIcons){s.watchUserIcons.length<=3?n.watchUserIcons=s.watchUserIcons:(!function(t){let e=t.length;for(let i=0;i<e;i++){let n=ve(i,e-1),s=t[i];t[i]=t[n],t[n]=s}}(s.watchUserIcons),n.watchUserIcons=s.watchUserIcons.slice(0,3))}n.tradeTips=new Array;let t=null===(i=s.tradeTips)||void 0===i?void 0:i.length;for(let e=0;e<t;e++){let t=s.tradeTips[e],i=new x;i.buyerImage=t.iconUrl,i.tradeMessage=t.tipsText,n.tradeTips.push(i)}n.liveStatDataDesc=s.liveStatDataDesc,n.actionBarSubTitle=s.actionBarTips,n.desc=s.authorDesc,Ce(n.desc)&&(n.desc="惊喜多多，快来快来！")}catch(a){return null}return n}}class on extends Fi{constructor(t,e){super(t),this.mTotalHeight=275,this.mLiveCutModel=e,this.setupViews(),this.mCardView.bindView(this.mLiveCutModel)}static newInstance(t){if(Ce(t))return null;let e=t.getLiveCutRoomInfo();if(Ce(e))return null;let i=an.newLiveCutInstance(t.adInfo,e);return Ce(i)?null:new on(t,i)}setupViews(){this.style={width:"100%",height:this.mTotalHeight,gradientBgColor:"270,00000000,0000003D,00000099",flexDirection:"column"},on.addAdClickEvent(this,t.CARD_BLANK_AREA_CLICK,3,this.vm),this.mClickEnterLiveRoom=new Ui,this.appendChild(this.mClickEnterLiveRoom),this.appendChild(this.createCardView())}createCardView(){return this.mCardView=new rn(this.vm),this.mCardView}getHeight(){return this.mTotalHeight}static addAdClickEvent(e,i,n,s){if(Ce(e))return;let a=Qe.createVideoCommonInstance(s.adStyle,s.adInfo);e.addEventListener("tap",(t=>{s.convert(1,n,{x:t.position.rawX,y:t.position.rawY},i,a)})),Wt(s.adInfo)&&Nt(e,(()=>{s.convert(1,n,{x:0,y:0},t.CARD_SWIPE_CONVERT,a)}))}}class rn extends TKView{constructor(t){super(),this.mCardSlideUpValue=68,this.vm=t,this.mScreenDp=t.obtainScreenWidthDp(),this.setupViews(),setTimeout((()=>{this.showActionBar()}),5e3)}showActionBar(){this.startUpSlideAnimation(this,(()=>{setTimeout((()=>{this.startActionBarTransAnimation(this.mActionBarView)}),500)}))}bindView(t){this.mTopTipsView&&t.sellerTag&&this.mTopTipsView.setText(t.sellerTag),this.mNameView&&t.name&&this.mNameView.setText(t.name),this.mDescView&&t.desc&&this.mDescView.setText(t.desc),this.mActionBarIconView&&t.iconUrl&&this.mActionBarIconView.setIconUrl(t.iconUrl),this.mActionBarTitleView&&t.liveStatDataDesc&&this.mActionBarTitleView.setText(t.liveStatDataDesc),this.mActionBarSubTitleView&&t.actionBarSubTitle&&this.mActionBarSubTitleView.setText(t.actionBarSubTitle),this.mActionBarButton&&t.actionBarDesc&&this.mActionBarButton.setText(t.actionBarDesc)}setupViews(){this.style={height:187,width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-end",paddingHorizontal:16,paddingBottom:20,marginTop:this.mCardSlideUpValue},this.appendChild(this.createTopTipsContainer()),this.appendChild(this.createContentContainer()),this.appendChild(this.createActionBar())}createTopTipsContainer(){let t=new TKView;t.style={height:20,width:"100%",flexDirection:"row",alignItems:"center",marginBottom:8};let e=new TKView;e.style={height:20,width:62,backgroundColor:"#FE3666",borderRadius:4,flexDirection:"row",justifyContent:"center",alignItems:"center"};let i=new TKImage;i.style={width:12,height:12,marginRight:2},Ve(i,"icon_ksad_white_shopping_cart2.png"),e.appendChild(i);let n=new TKText;return n.style={color:"#FFFFFF",fontSize:12,includeFontPadding:!1,textAlign:"center"},n.setText("直播中"),e.appendChild(n),t.appendChild(e),this.mTopTipsView=new TKText,this.mTopTipsView.style={height:20,backgroundColor:"#FFFFFF",opacity:.9,color:"#222222",borderRadius:4,marginLeft:8,textAlign:"center",fontSize:12,includeFontPadding:!1,paddingHorizontal:5},t.appendChild(this.mTopTipsView),t}createContentContainer(){let t=new TKView;return t.style={flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between"},this.mNameView=new TKText,this.mNameView.style={color:"#FFFFFF",fontSize:17,includeFontPadding:!1,textLineClamp:1,marginBottom:8,textOverflow:"ellipsis"},t.appendChild(this.mNameView),this.mDescView=new TKText,this.mDescView.style={color:"#FFFFFFE5",fontSize:14,width:"100%",includeFontPadding:!1,textLineClamp:2},t.appendChild(this.mDescView),t}createActionBar(){this.mActionBarView=new TKView,this.mActionBarView.style={width:"100%",height:"56",borderRadius:12,marginTop:12,paddingLeft:8,paddingRight:10,backgroundColor:"#FFFFFF33",marginLeft:0-this.mScreenDp,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},on.addAdClickEvent(this.mActionBarView,t.CARD_OTHERAREA_CLICK,2,this.vm),this.mActionBarIconView=new Gi,this.mActionBarView.appendChild(this.mActionBarIconView);let e=new TKView;return e.style={flexDirection:"column",flexBasis:100,flexShrink:1,flexGrow:1,height:"100%",justifyContent:"center",alignItems:"flex-start",paddingLeft:13,paddingRight:17},this.mActionBarTitleView=new TKText,this.mActionBarTitleView.style={fontSize:14,textLineClamp:1,color:"#FFFFFF",fontWeight:"medium",marginBottom:2,textOverflow:"ellipsis"},e.appendChild(this.mActionBarTitleView),this.mActionBarSubTitleView=new TKText,this.mActionBarSubTitleView.style={fontSize:10,opacity:.7,textLineClamp:1,color:"#FFFFFF",textOverflow:"ellipsis"},e.appendChild(this.mActionBarSubTitleView),this.mActionBarView.appendChild(e),this.mActionBarButton=new TKText,this.mActionBarButton.style={height:36,borderRadius:18,backgroundColor:"#FE3666",textAlign:"center",fontSize:14,paddingHorizontal:19,color:"#FFFFFF"},this.mActionBarView.appendChild(this.mActionBarButton),on.addAdClickEvent(this.mActionBarButton,t.CARD_ACTION_BAR_CLICK,1,this.vm),this.mActionBarView}startUpSlideAnimation(t,e){let i=new TKBasicAnimation;i.duration=300,i.on("end",e),i.timingFunction="ease-out",i.setEndValue((()=>{t.style={transform:{translate:{y:-this.mCardSlideUpValue}}}})),t.addAnimation(i,"upSlideAnimation")}startActionBarTransAnimation(t){let e=new TKBasicAnimation;e.duration=500,e.timingFunction="ease-out",e.setEndValue((()=>{t.style={transform:{translate:{x:this.mScreenDp}}}})),t.addAnimation(e,"leftTransAnimation")}}class hn extends TKView{constructor(t){super(),this.mPlusOneImages=new Array,this.animStopped=!1,this.style={flexDirection:"row",height:70,width:31,justifyContent:"center",alignItems:"flex-end"},this.mPlusOneContainer=this.createPlusOneContainer(),this.appendChild(this.mPlusOneContainer);let e=this;setTimeout((()=>{e.startPlusOneAnim()}),t)}stopAnimation(){this.animStopped=!0}createPlusOneContainer(){let t=new TKView;t.style={opacity:0,height:12,width:15,flexDirection:"column",justifyContent:"flex-end",alignItems:"center"};let e=this.createPlusOneView(),i=this.createPlusOneView(),n=this.createPlusOneView(),s=this.createPlusOneView();return this.mPlusOneImages.push(e,i,n,s),t.appendChild(e),t.appendChild(i),t.appendChild(n),t.appendChild(s),t}createPlusOneView(){let t=new TKImage;return t.style={width:0,height:0,opacity:0,position:"absolute",bottom:0,alignSelf:"center",resize:"contain"},Ve(t,"icon_ksad_plus_one.png"),t}startPlusOneAnim(){if(this.animStopped||Ce(this.mPlusOneContainer))return;let t=new TKBasicAnimation;t.duration=400,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mPlusOneContainer.style={width:31,opacity:1,height:70}}));let e=this.mPlusOneImages.length;for(let n=0;n<e;n++){let t=this.mPlusOneImages[n],e=new TKKeyframeAnimation;e.duration=400,e.timingFunction="EaseOut",e.setAnimations([()=>(t.style={width:31,height:24,opacity:1},1)]),t.addAnimation(e,"imgScale")}this.mPlusOneContainer.addAnimation(t,"plusOneScale");let i=this;t.on("end",(()=>{for(let t=0;t<e;t++){let n=i.mPlusOneImages[t],s=new TKKeyframeAnimation;s.duration=500,s.setAnimations([()=>(n.style={height:12,width:15,opacity:1,transform:{translate:{y:-44}}},1)]),setTimeout((()=>{n.addAnimation(s,"plusOneUp")}),250*t),t==e-1&&s.on("end",(()=>{i.mPlusOneImages.splice(0,e),i.removeChild(i.mPlusOneContainer),i.mPlusOneContainer=null,i.mPlusOneContainer=i.createPlusOneContainer(),i.appendChild(i.mPlusOneContainer),setTimeout((()=>{i.startPlusOneAnim()}),500)}))}}))}}class ln extends TKView{constructor(t){super(),this.stopRolling=!1,this.mItemTradeInfoList=t,Ce(this.mItemTradeInfoList)||this.setupViews()}setupViews(){this.style={width:"100%",height:"100%"}}startRolling(){if(this.stopRolling)return;if(Ce(this.mItemTradeInfoList))return;let t=this.mItemTradeInfoList.length;this.itemList=new Array;for(let e=0;e<t;e++){let t=this.mItemTradeInfoList[e];this.itemList.push(this.addRollingTipsItemView(t,e))}this.startChildAnimation()}addRollingTipsItemView(t,e){let i=this.mItemTradeInfoList.length,n=new dn(t,i-e);return n.style={position:"absolute",left:0,bottom:-ln.itemHeight,alignSelf:"center",height:ln.itemHeight},this.appendChild(n),n}startChildAnimation(){let t=this.mItemTradeInfoList.length;for(let e=0;e<t;e++)setTimeout((()=>{this.itemList[e].slideUpAnimation()}),e*ln.upSlideDuration)}}ln.upSlideDuration=800,ln.itemHeight=24;class dn extends TKView{constructor(t,e){super(),this.upSlideStep=1,this.mInnerSlipUpCallback=()=>{this.upSlideStep>this.maxSlideUpCount||this.slideUpAnimation()},this.mTradeInfo=t,this.maxSlideUpCount=e,this.setupViews()}setupViews(){this.style={flexDirection:"row",justifyContent:"center",alignItems:"center",height:ln.itemHeight,paddingVertical:2,opacity:0};let t=new TKView;t.style={flexDirection:"row",justifyContent:"flex-start",alignItems:"center",backgroundColor:"#00000066",height:"100%",paddingHorizontal:7,borderRadius:10};let e=new TKImage;e.style={width:12,height:12,borderRadius:8,marginRight:4},e.setSrc(this.mTradeInfo.buyerImage),t.appendChild(e);let i=new TKText;i.style={fontSize:12,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",color:"#FFDC84",includeFontPadding:!1},i.setText(this.mTradeInfo.tradeMessage),t.appendChild(i),this.appendChild(t)}slideUpAnimation(){this.removeAllAnimation();let t=new TKKeyframeAnimation;t.duration=ln.upSlideDuration,t.timingFunction="EaseOut",t.on("end",this.mInnerSlipUpCallback),t.setAnimations([()=>(this.style={opacity:1,transform:{translate:{y:0-this.upSlideStep*ln.itemHeight}}},600/ln.upSlideDuration),()=>(this.style={opacity:1},1)]),this.addAnimation(t,"upSlide"),this.upSlideStep++}}class cn extends Fi{constructor(t,e){super(t),this.mTotalHeight=275,this.mAnimationDelay=1e3,this.mLiveCutModel=e,this.setupViews(),setTimeout((()=>{this.mLiveEmojiAnimation.startAnimation(),this.mCardView.startAllAnimation()}),this.mAnimationDelay)}static newInstance(t){if(Ce(t))return null;let e=t.getLiveCutRoomInfo();if(Ce(e))return null;let i=an.newLiveCutInstance(t.adInfo,e);return Ce(i)?null:new cn(t,i)}setupViews(){this.style={width:"100%",height:this.mTotalHeight},on.addAdClickEvent(this,t.CARD_BLANK_AREA_CLICK,2,this.vm),this.mClickEnterLiveRoom=new Ui,this.appendChild(this.mClickEnterLiveRoom);let e=new TKView;e.style={flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end",paddingHorizontal:16,paddingBottom:20},this.mCardView=new pn(this.vm,this.mLiveCutModel,this.mAnimationDelay),e.appendChild(this.mCardView),e.appendChild(this.createEmojiViewContainer()),this.appendChild(e)}createEmojiViewContainer(){let e=new TKView;e.style={width:36,height:170,flexDirection:"column",justifyContent:"flex-end",alignItems:"center"},this.mLiveEmojiAnimation=new Hi(0),this.mLiveEmojiAnimation.style={width:36,height:170},on.addAdClickEvent(this.mLiveEmojiAnimation,t.ACTIONBAR_ICON_CLICK,2,this.vm),e.appendChild(this.mLiveEmojiAnimation);let i=new TKImage;return i.style={width:36,height:36,position:"absolute",bottom:0},Ve(i,"icon_ksad_ec_round_white_like.png"),e.appendChild(i),e}getHeight(){return this.mTotalHeight}}class pn extends TKView{constructor(t,e,i){super(),this.mTradeFlyAnimationDuration=300,this.vm=t,this.mOuterAnimationDelay=i,this.mLiveCutModel=e,this.mScreenDp=t.obtainScreenWidthDp(),this.setupView()}setupView(){this.style={flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-end",paddingRight:28,flexBasis:200,flexGrow:1,flexShrink:1};let t=this.mOuterAnimationDelay+this.mTradeFlyAnimationDuration+500;this.mTradeCustomView=function(t,e,i){let n=new TKView;n.style={height:64,width:e};let s=new TKView;s.style={width:"100%",paddingHorizontal:10,height:24,flexDirection:"row",alignItems:"center",borderRadius:12,position:"absolute",bottom:0,left:0,gradientBgColor:"0,#FFB31973,#FFB31999"};let a=new TKImage;a.style={width:"15",height:"18",marginRight:4},Ve(a,"icon_ksad_yellow_shooping_cart.png"),s.appendChild(a);let o=new TKText;o.style={color:"#FFFFFF",fontSize:12},o.setText(t),s.appendChild(o);let r=new hn(i);return r.style={position:"absolute",right:24,bottom:0},n.appendChild(s),n.appendChild(r),n}(this.mLiveCutModel.tradeCustomerDesc,197,t),this.mTradeCustomView.style={marginLeft:0-this.mScreenDp},this.appendChild(this.mTradeCustomView),this.appendChild(this.createTradeTipsView()),this.appendChild(this.createInputArea())}startAllAnimation(){this.tradeCustomViewFly(),this.startTipsRolling()}tradeCustomViewFly(){let t=new TKBasicAnimation;t.duration=this.mTradeFlyAnimationDuration,t.setEndValue((()=>{this.mTradeCustomView.style={transform:{translate:{x:this.mScreenDp}}}})),this.mTradeCustomView.addAnimation(t,"leftFlyAnimation")}startTipsRolling(){this.rolllingTipsView.startRolling()}createTradeTipsView(){return this.rolllingTipsView=new ln(this.mLiveCutModel.tradeTips),this.rolllingTipsView.style={height:48,marginTop:8,marginBottom:8},on.addAdClickEvent(this.rolllingTipsView,t.ACTIONBAR_ICON_COMMENT_CLICK,2,this.vm),this.rolllingTipsView}createInputArea(){let e=new TKView;e.style={width:"100%",height:36,borderRadius:18,borderColor:"#FFFFFF99",borderWidth:1,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingLeft:18,paddingRight:10};let i=new TKText;i.style={color:"#FFFFFFCC",fontSize:14},i.setText("快来和主播聊聊天");let n=new TKImage;return n.style={width:22,height:22},Ve(n,"icon_ksad_small_face.png"),e.appendChild(i),e.appendChild(n),on.addAdClickEvent(e,t.ACTIONBAR_ICON_COMMENT_CLICK,2,this.vm),e}}const mn="coupon_of_cash_equity";class gn extends Fi{constructor(t){super(t),this.vm=t,this.setupView(),this.appendOutContainerView(),this.appendCouponContainerView(),this.setupData(),this.setupActions()}setupView(){this.width=this.vm.containerLimit.width-32,this.height=80*(this.width-16)/327,this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",bottom:-16,opacity:0},this.containerView=new TKView,this.containerView.style={width:this.width,height:this.getHeight(),left:16,flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",backgroundColor:"#FFFFFF",borderRadius:10},this.appendChild(this.containerView),this.setupLogoView()}appendOutContainerView(){this.couponTitleContainer=new TKView,this.couponTitleContainer.style={width:this.width-16,height:17,top:"7.7%",left:8,flexDirection:"row",alignItems:"center",position:"absolute"},this.containerView.appendChild(this.couponTitleContainer),this.bannerTitle=new TKText,this.bannerTitle.style={left:0,top:0,fontSize:12,color:"#FC4A5D",textLineClamp:1,fontWeight:"medium",position:"absolute",alignItems:"center",justifyContent:"center",textOverflow:"ellipsis"},this.couponTitleContainer.appendChild(this.bannerTitle),this.couponTips=new TKText,this.couponTips.style={right:0,fontSize:10,fontWeight:"medium",color:"#6666664D",textLineClamp:1,position:"absolute",textOverflow:"ellipsis"},this.couponTitleContainer.appendChild(this.couponTips)}appendCouponContainerView(){let t=Math.ceil(.064*this.getHeight());this.icon=new TKImage,this.icon.style={width:this.width-16,height:this.height,left:8,position:"absolute",resize:"stretch",bottom:t},this.containerView.appendChild(this.icon),this.couponViewContainer=new TKView,this.couponViewContainer.style={width:this.width-16,height:this.height,left:8,flexDirection:"row",justifyContent:"center",alignItems:"center",position:"absolute",bottom:"6.4%"},this.containerView.appendChild(this.couponViewContainer),this.priceContainer=new TKView,this.priceContainer.style={left:0,width:"26%",position:"absolute",alignItems:"center",justifyContent:"center",alignContent:"center",flexDirection:"row"},this.couponViewContainer.appendChild(this.priceContainer),this.price=new TKText,this.price.style={fontSize:ce()?38:32,color:"#FFFFFF",textLineClamp:1,fontWeight:"bold",textOverflow:"ellipsis",alignItems:"center",justifyContent:"center",textAlign:"center"},this.priceContainer.appendChild(this.price),this.titleContainer=new TKView,this.titleContainer.style={left:"30.8%",width:"36.7%",height:44,justifyContent:"flex-start",alignItems:"flex-start",position:"absolute"},this.couponViewContainer.appendChild(this.titleContainer),this.title=new TKText,this.title.style={top:ce()?0:2,fontSize:ce()?17:15,color:"#FFFFFF",textLineClamp:1,fontWeight:"medium",textOverflow:"ellipsis",position:"absolute"},this.titleContainer.appendChild(this.title),this.contentDesc=new TKText,this.contentDesc.style={bottom:0,fontSize:ce()?14:12,color:"#FFCCCC",textLineClamp:1,fontWeight:"medium",textOverflow:"ellipsis",position:"absolute"},this.titleContainer.appendChild(this.contentDesc),this.actionBtn=new Ri(this.vm.adInfo,{width:92*this.width/375,height:36*this.width/375,borderRadius:18*this.width/375},(t=>{t.style={fontSize:ce()?16:14,color:"#FF3A30",textLineClamp:1,fontWeight:"medium",textOverflow:"ellipsis"}}),(t=>{t.style={backgroundColor:"#FFFFFF"},t.setProgressColor("#FF133F33")})),this.actionBtn.style={flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#FFFFFF",right:10,position:"absolute"},this.couponViewContainer.appendChild(this.actionBtn),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn&&this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn&&this.actionBtn.setDownloadChange(t)}))}setupLogoView(){var t;const e=(null===(t=le())||void 0===t?void 0:t.bottom)>0?43:27;this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={position:"absolute",left:16,bottom:this.getHeight()+e},this.logoView.enabled=!1,this.appendChild(this.logoView)}getHeight(){return this.height+44}onGetMiddleMarginBottom(t){var e;const i=(null===(e=le())||void 0===e?void 0:e.bottom)>0?43:27;return Number(this.getHeight()+i)}setupData(){let t=this.vm.getCouponModel();this.bannerTitle.setText(t.bannerTitle),this.couponTips.setText(t.couponTips),this.title.setText(t.title),this.contentDesc.setText(t.contentDesc),this.actionBtn&&this.actionBtn.setText(t.actionBarDesc),this.addPriceSpan(),Ve(this.icon,this.vm.getCouponBackImageUrl())}setupActions(){const e=this;e.containerView.addEventListener("tap",(i=>{let n=new b;n.template_show_type=mn;const s=pe(i,e.containerView);e.vm.convert(1,2,s,t.CARD_ACTION_BAR_CLICK,n)})),e.actionBtn&&e.actionBtn.setOnTapListener((i=>{let n=new b;n.template_show_type=mn;const s=pe(i,e.actionBtn);e.vm.convert(1,1,s,t.CARD_ACTION_BAR_CLICK,n)}))}addPriceSpan(){let t=this.vm.getCouponModel(),e=t.priceTag+t.price;const i=e.search(t.priceTag);let n=new TKSpan,s=ce()?22:16;const a=new TKSpanItem;a.size=s,a.spanType="absoluteSize",a.start=i,a.end=i+t.priceTag.length,n.addSpan(a),this.price.setSpan(e,n)}}class un extends TKView{constructor(t,e,i,n){super(),this.vm=t,this.index=e,this.isOpened=i,this.discountCardType=n,this.setupView(),this.setupAction(),this.setupData()}setupView(){const t=this.vm.getRedPacketViewSize(this.discountCardType,this.index);this.style={width:t.width,height:t.height,justifyContent:"center",alignItems:"center"},this.redPacketImage=new TKImage,this.redPacketImage.style={width:"100%",height:"100%"},this.appendChild(this.redPacketImage),this.valueContainerView=new TKView,this.valueContainerView.style={position:"absolute",paddingTop:18,flexDirection:"row",justifyContent:"center",alignItems:"flex-end",opacity:0},this.appendChild(this.valueContainerView);let e=36;1!=this.discountCardType&&(e=0==this.vm.screenOrientation?30:28),this.valueText=new TKText,this.valueText.style={fontSize:e,color:"#FFE7BF",textAlign:"center"},this.valueContainerView.appendChild(this.valueText);let i=18;1!=this.discountCardType&&(i=0==this.vm.screenOrientation?16:14),this.unitText=new TKText,this.unitText.style={fontSize:i,color:"#FFE7BF",textAlign:"center",marginBottom:5},this.valueContainerView.appendChild(this.unitText),this.isOpened?this.openRedPacket():this.closeRedPacket()}setupData(){Ce(this.vm.getRedPacketValueString(this.index))?(this.valueText.style={visibility:"hidden"},this.unitText.style={visibility:"hidden"}):(this.valueText.setText(this.vm.getRedPacketValueString(this.index)),this.unitText.setText("元"))}setupAction(){const e=this;this.addEventListener("tap",(i=>{let n,s,a=new b;me(e.vm.getRedPacketValueString(e.index))&&(n=[e.vm.getRedPacketValueString(e.index)]),a.neo_ext_data=e.vm.getDiscountNeoExtData(n),a.template_show_type=e.vm.getDiscountTemplateShowType(e.discountCardType),0==e.index?s=t.CARD_PICTURE_CLICK_ONE:1==e.index?s=3==this.discountCardType?t.CARD_ACTION_BAR_CLICK:t.CARD_PICTURE_CLICK_TWO:2==e.index&&(s=t.CARD_PICTURE_CLICK_THREE);const o=pe(i,e);e.vm.convert(1,2,o,s,a)}))}openRedPacket(){Ve(this.redPacketImage,this.vm.getRedPacketImageUrl(!0,this.index)),this.valueContainerView.style={opacity:1}}closeRedPacket(){Ve(this.redPacketImage,this.vm.getRedPacketImageUrl(!1,this.index)),this.valueContainerView.style={opacity:0}}updateFinalViewType(t){this.discountCardType=t}getRedPacketWidth(){return this.vm.getRedPacketViewSize(this.discountCardType,this.index).width}startShakeAnimation(t){const e=this,i=new TKKeyframeAnimation;this.vm.supportNewAnimation()?(i.setAnimations([()=>(e.style={transform:{scale:1.05,rotate:5}},.25),()=>(e.style={transform:{scale:1.1,rotate:-5}},.6),()=>(e.style={transform:{scale:1,rotate:0}},1)]),i.timingFunction="EaseInEaseOut"):(i.animType="rotationZ",i.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.25,value:Le.getSemiCircle()/36,easing:"EaseInEaseOut"},{percent:.5,value:-Le.getSemiCircle()/18,easing:"EaseInEaseOut"},{percent:.75,value:Le.getSemiCircle()/36,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}]),i.duration=800,i.repeatCount=t,i.on("end",(()=>{e.shakeAnimationCompletion&&e.shakeAnimationCompletion()})),this.addAnimation(i,"shakeAnimation")}}class wn extends TKImage{constructor(t,e){super(),this.vm=t,this.discountCardType=e,Ve(this,"icon_ksad_hand_touch_guide.png")}startGuidanceAnimation(t){if(this.isCompletedShowAnimation){const e=_i(this,1.15,480,t,this.vm.supportNewAnimation());this.addAnimation(e,"handImageBeatAnimation")}else{const e=Li(this,200,this.vm.supportNewAnimation());this.addAnimation(e,"handImageShowAnimation"),this.isCompletedShowAnimation=!0;const i=this;e.on("end",(()=>{const e=_i(i,1.15,480,t,i.vm.supportNewAnimation());i.addAnimation(e,"handImageBeatAnimation")}))}}}class Cn extends TKView{constructor(t){super(),this.vm=t,this.discountCardType=2,this.setupView()}setupView(){const t=this.vm.getDiscountFinalViewWidth();this.style={paddingLeft:16,paddingRight:16,paddingBottom:16,alignItems:"center",width:t},this.productView=new fn(this.vm),this.productView.style={marginBottom:8},this.appendChild(this.productView);const e=this;this.redPacketsView=new yn(this.vm,t-32),this.redPacketsView.startGuideChooseRewardCallback=()=>{e.discountCardType=3,e.productView.updateFinalViewType(e.discountCardType),e.redPacketsView.updateFinalViewType(e.discountCardType),e.handImage.startGuidanceAnimation(Number.MAX_SAFE_INTEGER),e.vm.reportDiscountViewImpression(e.discountCardType)},this.redPacketsView.stopGuideChooseRewardCallback=()=>{e.handImage.style={visibility:"hidden"}},this.appendChild(this.redPacketsView);this.handImage=new wn(this.vm,this.discountCardType),this.handImage.style={marginTop:-60,marginLeft:70,top:20,height:60,width:60,opacity:0},this.appendChild(this.handImage)}startAnimation(){const t=this,e=Li(t,500,this.vm.supportNewAnimation());e.on("end",(()=>{t.handImage.startGuidanceAnimation(Number.MAX_SAFE_INTEGER),t.redPacketsView.startAnimation()})),this.addAnimation(e,"showFinalViewAnimation"),this.vm.reportDiscountViewImpression(t.discountCardType)}updateAutoChooseRewardCountDown(t){this.redPacketsView&&this.redPacketsView.updateAutoChooseRewardCountDown(t)}}class fn extends TKView{constructor(t){super(),this.vm=t,this.discountCardType=2,this.setupView(),this.setupData(),this.setupAction()}setupView(){this.style={width:"100%",flexDirection:"row",alignItems:"center"},this.iconImage=new TKImage,this.iconImage.style={width:50,height:50,borderRadius:8},this.appendChild(this.iconImage),this.textContainerView=new TKView,this.textContainerView.style={height:50,marginLeft:8,marginRight:110,paddingTop:2,paddingBottom:2,justifyContent:"center"},this.appendChild(this.textContainerView),this.titleText=new TKText,this.titleText.style={fontSize:16,color:"#FFFFFF",textLineClamp:1,marginBottom:8,display:"none"},this.textContainerView.appendChild(this.titleText),this.descriptionText=new TKText,this.descriptionText.style={fontSize:14,color:"#FFFFFF",textLineClamp:1},this.textContainerView.appendChild(this.descriptionText),this.logoView=new Vi(1,this.vm.adInfo),this.logoView.style={position:"absolute",right:0,bottom:0},this.logoView.enabled=!1,this.appendChild(this.logoView)}setupData(){this.iconImage.setSrc(this.vm.getAdIcon()),me(this.vm.getProductShortTitle())&&(this.titleText.style={display:"flex"}),this.titleText.setText(this.vm.getProductShortTitle()),this.descriptionText.setText(this.vm.getProductSellingPoint())}setupAction(){this.addClickConvert(this.iconImage,2,t.CARD_ICON_CLICK),this.addClickConvert(this.titleText,2,t.CARD_ICON_NAME_CLICK),this.addClickConvert(this.descriptionText,2,t.CARD_ICON_NAME_CLICK)}updateFinalViewType(t){this.discountCardType=t}addClickConvert(t,e,i){const n=this;t.addEventListener("tap",(s=>{let a=new b;a.neo_ext_data=n.vm.getDiscountNeoExtData(),a.template_show_type=n.vm.getDiscountTemplateShowType(n.discountCardType);const o=pe(s,t);n.vm.convert(1,e,o,i,a)}))}}class yn extends TKView{constructor(t,e){super(),this.vm=t,this.width=e,this.discountCardType=2,this.setupView(),this.setupData(),this.setupAction()}setupView(){this.style={width:this.width,justifyContent:"flex-end",alignItems:"center",borderRadius:8,backgroundColor:"#222222CC"},this.titleText=new TKText,this.titleText.style={position:"absolute",top:10,left:10,height:21,fontSize:14,color:"#FFFFFF"},this.appendChild(this.titleText),this.countdownText=new TKText,this.countdownText.style={position:"absolute",top:10,right:10,height:21,fontSize:12,color:"#FFFFFF"},this.appendChild(this.countdownText),this.redPacketsView=new TKView,this.redPacketsView.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginTop:0,paddingTop:42},this.appendChild(this.redPacketsView),this.leftRedPacketView=new un(this.vm,0,!1,this.discountCardType),this.leftRedPacketView.style={marginBottom:14},this.redPacketsView.appendChild(this.leftRedPacketView);const t=0==this.vm.screenOrientation?30:28;this.centerRedPacketView=new un(this.vm,1,!0,this.discountCardType),this.centerRedPacketView.style={marginLeft:t,marginRight:t,marginBottom:12},this.redPacketsView.appendChild(this.centerRedPacketView),this.rightRedPacketView=new un(this.vm,2,!1,this.discountCardType),this.rightRedPacketView.style={marginBottom:14},this.redPacketsView.appendChild(this.rightRedPacketView)}setupData(){this.titleText.setText("恭喜获得专属幸运福利"),this.vm.isAutoChooseReward()&&this.vm.enableShowGuidanceRedPacket()||this.countdownText.setText("仅剩66个优惠名额")}setupAction(){const e=this;this.addEventListener("tap",(i=>{let n=new b;n.neo_ext_data=e.vm.getDiscountNeoExtData(),n.template_show_type=e.vm.getDiscountTemplateShowType(e.discountCardType);const s=pe(i,e);e.vm.convert(1,2,s,t.CARD_OTHERAREA_CLICK,n)}))}startAnimation(){this.centerRedPacketView.startShakeAnimation(3)}updateAutoChooseRewardCountDown(t){this.autoChooseRewardCountDown=t,this.countdownText.setText(this.autoChooseRewardCountDown+"s后自动选择"),this.startAutoChooseRewardTimer()}startAutoChooseRewardTimer(){this.stopAutoClooseRewardTimer();const t=this;this.autoChooseRewardTimer=setInterval((()=>{t.autoChooseRewardCountDown-=1,t.countdownText.setText(this.autoChooseRewardCountDown+"s后自动选择"),t.autoChooseRewardCountDown<=0&&(t.stopAutoClooseRewardTimer(),t.countdownText.setText(""),t.countdownText.style={visibility:"hidden"},t.showGuidanceRedPacketIfNeeded())}),1e3)}stopAutoClooseRewardTimer(){this.autoChooseRewardTimer&&(clearInterval(this.autoChooseRewardTimer),this.autoChooseRewardTimer=0)}showGuidanceRedPacketIfNeeded(){this.guideChooseRewardCountDown=this.vm.getGuideChooseRewardCountDown(),this.vm.enableShowGuidanceRedPacket()&&(this.leftRedPacketView.style={visibility:"hidden"},this.rightRedPacketView.style={visibility:"hidden"},this.centerRedPacketView.closeRedPacket(),this.centerRedPacketView.startShakeAnimation(3),this.titleText.setText("已为您选择超级优惠"),this.countdownText.setText(this.guideChooseRewardCountDown+"s后失效"),this.startGuideChooseRewardTimer(),this.startGuideChooseRewardCallback&&this.startGuideChooseRewardCallback())}startGuideChooseRewardTimer(){this.stopGuideChooseRewardTimer();const t=this;this.guideChooseRewardTimer=setInterval((()=>{t.guideChooseRewardCountDown-=1,t.countdownText.style={visibility:"visible"},t.countdownText.setText(t.guideChooseRewardCountDown+"s后失效"),t.guideChooseRewardCountDown<=0&&(t.countdownText.style={visibility:"hidden"},t.stopGuideChooseRewardTimer(),t.style={display:"none"},t.stopGuideChooseRewardCallback&&t.stopGuideChooseRewardCallback())}),1e3)}stopGuideChooseRewardTimer(){this.guideChooseRewardTimer&&(clearInterval(this.guideChooseRewardTimer),this.guideChooseRewardTimer=0)}updateFinalViewType(t){this.discountCardType=t,this.centerRedPacketView.updateFinalViewType(this.discountCardType)}}class Tn extends TKView{constructor(t){super(),this.vm=t,this.discountCardType=1,this.setupView(),this.setupData(),this.setupAction()}setupView(){this.style={width:"100%",height:"100%",backgroundColor:Le.isAndroid?"#00000080":"#00000066",justifyContent:"center",alignItems:"center"};const t=Tachikoma.env.deviceWidth;this.shiningImage=new TKImage,this.shiningImage.style={width:t,height:344*t/375,position:"absolute"},Ve(this.shiningImage,"icon_ksad_discounts_lighting.png"),this.appendChild(this.shiningImage),this.containerView=new TKView,this.containerView.style={justifyContent:"center",alignItems:"center",width:t},this.appendChild(this.containerView);const e=0==this.vm.screenOrientation?26:10;this.closeButton=new TKImage,this.closeButton.style={width:24,height:24,marginBottom:e,marginRight:20,alignSelf:"flex-end"},Ve(this.closeButton,"icon_ksad_fill_close.png"),this.containerView.appendChild(this.closeButton),this.titleImage=new TKImage,this.titleImage.style={width:280,height:64,marginBottom:12},Ve(this.titleImage,"icon_ksad_discounts_interact_title_image.png"),this.containerView.appendChild(this.titleImage),this.maxDiscountsImage=new TKImage,this.maxDiscountsImage.style={width:88,height:26,opacity:0},Ve(this.maxDiscountsImage,"icon_ksad_max_discounts_tag.png"),this.containerView.appendChild(this.maxDiscountsImage);const i=0==this.vm.screenOrientation?31:-13;this.redPacketsView=new TKView,this.redPacketsView.style={top:-13,width:t,marginBottom:i,paddingTop:20,paddingLeft:20,paddingBottom:20,paddingRight:20,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.containerView.appendChild(this.redPacketsView),this.leftRedPacketView=new un(this.vm,0,!0,this.discountCardType),this.leftRedPacketView.style={marginTop:12},this.redPacketsView.appendChild(this.leftRedPacketView),this.rightRedPacketView=new un(this.vm,2,!0,this.discountCardType),this.rightRedPacketView.style={marginTop:12},this.redPacketsView.appendChild(this.rightRedPacketView),this.centerOpendRedPacketView=new un(this.vm,1,!0,this.discountCardType);const n=(t-this.centerOpendRedPacketView.getRedPacketWidth())/2;this.centerOpendRedPacketView.style={position:"absolute",left:n},this.redPacketsView.appendChild(this.centerOpendRedPacketView),this.centerClosedRedPacketView=new un(this.vm,1,!1,this.discountCardType),this.centerClosedRedPacketView.style={position:"absolute",left:n,opacity:0},this.redPacketsView.appendChild(this.centerClosedRedPacketView);const s=0==this.vm.screenOrientation?-20:25;this.handImage=new wn(this.vm,this.discountCardType),this.handImage.style={marginTop:-68,marginLeft:76,top:s,height:68,width:68,opacity:0},this.appendChild(this.handImage),this.vm.reportDiscountViewImpression(this.discountCardType)}setupData(){this.vm.isAutoChooseReward()&&(this.autoChooseRewardCountDown=this.vm.getAutoChooseRewardCountDown(),this.startAutoChooseRewardTimer());const t=this;setTimeout((()=>{t.startAnimation()}),1e3)}setupAction(){const e=this;this.addEventListener("tap",(i=>{let n=new b;n.neo_ext_data=e.vm.getDiscountNeoExtData(),n.template_show_type=e.vm.getDiscountTemplateShowType(e.discountCardType);const s=pe(i,e);e.vm.convert(1,2,s,t.CARD_OTHERAREA_CLICK,n)})),this.titleImage.addEventListener("tap",(i=>{let n=new b;n.neo_ext_data=e.vm.getDiscountNeoExtData(),n.template_show_type=e.vm.getDiscountTemplateShowType(e.discountCardType);const s=pe(i,e.titleImage);e.vm.convert(1,2,s,t.CARD_ICON_NAME_CLICK,n)})),this.closeButton.addEventListener("tap",(()=>{e.vm.reportDiscountInitialViewClose(e.discountCardType),e.hideInitialView()}))}startAnimation(){this.startRedPacketsFoldAnimation()}startRedPacketsFoldAnimation(){const t=this,e=_i(this.centerOpendRedPacketView,.85,800,1,this.vm.supportNewAnimation());this.centerOpendRedPacketView.addAnimation(e,"centerOpendRedPacketBeatAnimation");const i=_i(this.leftRedPacketView,1.05,800,1,this.vm.supportNewAnimation()),n=this.createRedPacketMoveAnimation(this.leftRedPacketView);i.on("end",(()=>{t.leftRedPacketView.addAnimation(n,"lefttRedPacketFoldMoveAnimation")})),this.leftRedPacketView.addAnimation(i,"leftRedPacketBeatAnimation");const s=_i(this.rightRedPacketView,1.05,800,1,this.vm.supportNewAnimation()),a=this.createRedPacketMoveAnimation(this.rightRedPacketView);s.on("end",(()=>{t.rightRedPacketView.addAnimation(a,"rightRedPacketFoldMoveAnimation")})),this.rightRedPacketView.addAnimation(s,"rightRedPacketBeatAnimation"),this.startShiningAnimation(),setTimeout((()=>{t.leftRedPacketView.style={opacity:0},t.rightRedPacketView.style={opacity:0},t.centerOpendRedPacketView.style={opacity:0};const e=Li(t.centerClosedRedPacketView,160,this.vm.supportNewAnimation());setTimeout((()=>{t.startRedPacketsExpandAnimation()}),160),t.centerClosedRedPacketView.addAnimation(e,"centerClosedRedPacketViewOpacityAnimation")}),1200)}createRedPacketMoveAnimation(t,e=!0){const i=new TKKeyframeAnimation,n=t.getRedPacketWidth()+20;let s=0;if(t==this.leftRedPacketView?s=e?n:this.vm.supportNewAnimation()||Le.isAndroid()?0:-n:t==this.rightRedPacketView&&(s=e?-n:this.vm.supportNewAnimation()||Le.isAndroid()?0:n),this.vm.supportNewAnimation())i.setAnimations([()=>(t.style={left:s},1)]),i.timingFunction="EaseInEaseOut";else{const n=Le.isAndroid()?s:Number(t.getOrigin().x)+s,a=Le.isAndroid()?0:Number(t.getOrigin().y),o=Le.isAndroid()?this.getRedPacketMoveAnimationCurrentOffsetX(t,e):n;i.animType="position",i.keyframes=[{percent:0,value:{x:o,y:a},easing:"EaseInEaseOut"},{percent:1,value:{x:n,y:a},easing:"EaseInEaseOut"}]}return i.duration=400,i}getRedPacketMoveAnimationCurrentOffsetX(t,e=!0){let i=0;const n=t.getRedPacketWidth()+20;return t==this.leftRedPacketView?!e&&Le.isAndroid()&&(i=n):t==this.rightRedPacketView&&!e&&Le.isAndroid()&&(i=-n),i}startShiningAnimation(){const t=this,e=new TKKeyframeAnimation;this.vm.supportNewAnimation()?(e.setAnimations([()=>(t.shiningImage.style={transform:{rotate:45}},1)]),e.timingFunction="EaseInEaseOut"):(e.animType="rotationZ",e.keyframes=[{percent:0,value:Le.isAndroid()?0:Le.getSemiCircle()/4,easing:"EaseInEaseOut"},{percent:1,value:Le.getSemiCircle()/4,easing:"EaseInEaseOut"}]),e.duration=800,this.shiningImage.addAnimation(e,"shiningImageRotateAnimation"),e.on("end",(()=>{t.shiningImage.style={opacity:0}}))}startRedPacketsExpandAnimation(){const t=this;this.startCenterClosedRedPacketBeatAnimation(),this.leftRedPacketView.closeRedPacket(),t.leftRedPacketView.style={opacity:1};const e=t.createRedPacketMoveAnimation(t.leftRedPacketView,!1);t.leftRedPacketView.addAnimation(e,"lefttRedPacketExpandMoveAnimation"),this.rightRedPacketView.closeRedPacket(),t.rightRedPacketView.style={opacity:1};const i=t.createRedPacketMoveAnimation(t.rightRedPacketView,!1);t.rightRedPacketView.addAnimation(i,"rightRedPacketExpandMoveAnimation")}startCenterClosedRedPacketBeatAnimation(){const t=this,e=_i(this.centerClosedRedPacketView,.95,500,1,this.vm.supportNewAnimation());setTimeout((()=>{t.centerClosedRedPacketView.startShakeAnimation(2)}),500),this.centerClosedRedPacketView.shakeAnimationCompletion=()=>{t.centerClosedRedPacketView.style={opacity:0};const e=Li(t.centerOpendRedPacketView,145,t.vm.supportNewAnimation());t.centerOpendRedPacketView.addAnimation(e,"centerOpenedRedPackeShowAnimation"),e.on("end",(()=>{setTimeout((()=>{t.hideInitialView()}),2e3)}));const i=Li(t.maxDiscountsImage,120,t.vm.supportNewAnimation());t.maxDiscountsImage.addAnimation(i,"maxDiscountsImageShowAnimation"),i.on("end",(()=>{this.startGuidanceAnimation()}))},this.centerClosedRedPacketView.addAnimation(e,"centerClosedRedPacketBeatAnimation")}startGuidanceAnimation(){this.handImage.startGuidanceAnimation(3)}hideInitialView(){if(this.isHidingInitialView)return;this.isHidingInitialView=!0;const t=this,e=new TKKeyframeAnimation;this.vm.supportNewAnimation()?(e.setAnimations([()=>(t.style={opacity:0},1)]),e.timingFunction="EaseInEaseOut"):(e.animType="opacity",e.keyframes=[{percent:0,value:Le.isAndroid?1:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}]),e.duration=500,e.on("end",(()=>{t.closeCallback&&(t.stopAutoClooseRewardTimer(),t.closeCallback(t.autoChooseRewardCountDown),t.isHidingInitialView=!1)})),this.addAnimation(e,"hideInitialViewAnimation")}startAutoChooseRewardTimer(){const t=this;this.autoChooseRewardTimer=setInterval((()=>{t.autoChooseRewardCountDown-=1}),1e3)}stopAutoClooseRewardTimer(){this.autoChooseRewardTimer&&(clearInterval(this.autoChooseRewardTimer),this.autoChooseRewardTimer=0)}}class In extends Fi{constructor(t){super(t),this.style={width:"100%",height:"100%",padding:0,justifyContent:"center",alignItems:"center"};const e=this;this.initialView=new Tn(this.vm),this.initialView.closeCallback=t=>{e.finalView&&e.vm.isAutoChooseReward()&&this.vm.enableShowGuidanceRedPacket()&&e.finalView.updateAutoChooseRewardCountDown(t),e.showFinalView()},this.appendChild(this.initialView),this.finalView=new Cn(this.vm),this.finalView.style={position:"absolute",left:0,bottom:0,opacity:0},this.appendChild(this.finalView)}getHeight(){return 0==this.vm.screenOrientation?Tachikoma.env.deviceHeight:Tachikoma.env.deviceWidth}showFinalView(){this.isShowFinalView||(this.initialView&&this.removeChild(this.initialView),this.finalView&&this.finalView.startAnimation(),this.isShowFinalView=!0)}}class vn extends Fi{constructor(t){super(t),this.bigHeight=194,this.smallHeight=146,this.cardHeight=142,this.cardHeightSmall=94,this.animStopped=!1,this.btnHeight=36,this.isPortrait=0==this.vm.screenOrientation;let e=Vn.createInstance(this.vm.adInfo);this.style={height:this.getHeight(),width:this.isPortrait?Le.isAndroid()?"100%":this.vm.containerLimit.width:375,flexDirection:"column",justifyContent:"flex-end",alignSelf:"flex-end",paddingBottom:16,paddingLeft:16,paddingRight:16},this.appendChild(this.createHeadView(this.vm.adInfo,e)),this.mCardView=this.createCardView(e),this.appendChild(this.mCardView),setTimeout((()=>{this.startTransHeadView()}),2e3)}createHeadView(e,i){let n=new TKView;n.style={height:36,width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"};let s=new TKView;return s.style={height:28,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",backgroundColor:"#00000080",borderRadius:4,marginBottom:-28,paddingRight:12,opacity:0},vn.addClickConvert(this.vm.adInfo,s,2,t.CARD_FOLLOW_NUM),this.fansListView=new Ki(this.vm.adInfo,20,3),this.fansListView.style={width:60,height:20},this.fansCountView=new TKText,this.fansCountView.style={fontSize:12,color:"#FFFFFFFC"},this.fansCountView.setText(i.fansCountText),s.appendChild(this.fansListView),s.appendChild(this.fansCountView),this.mHeadFansView=s,n.appendChild(s),this.logoView=new Vi(1,e),this.logoView.style={height:14,marginBottom:4},n.appendChild(this.logoView),n}createCardView(e){let i=new TKView;if(i.style={width:"100%",height:this.cardHeightSmall,borderRadius:12,paddingLeft:12,paddingTop:11,paddingRight:16,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"space-between"},i.appendChild(this.createBodyView(e)),this.mCardBtnsView=this.createBtnsView(e),i.appendChild(this.mCardBtnsView),e.isLive){let t=new TKText;t.style={fontSize:10,color:"#FFFFFF",backgroundColor:"#FE3666",height:14,topLeftRadius:7,topRightRadius:7,bottomRightRadius:7,position:"absolute",top:12,left:50,paddingHorizontal:5,textAlign:"center"},t.setText("直播"),i.appendChild(t)}return vn.addClickConvert(this.vm.adInfo,i,2,t.CARD_OTHERAREA_CLICK),i}startTransHeadView(){let t=new TKBasicAnimation;t.setEndValue((()=>{this.mHeadFansView.style={opacity:1,transform:{translate:{y:-36}}}})),t.timingFunction="EaseOut",t.duration=300,t.on("end",(()=>{setTimeout((()=>{this.switchToBigCard()}),3e3)})),this.mHeadFansView.addAnimation(t,"headFansTrans")}switchToBigCard(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.mCardBtnsView.style={opacity:1},1)]),t.duration=300,t.timingFunction="EaseOut";let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.mCardView.style={height:this.cardHeight},1)]),e.duration=300,e.timingFunction="EaseOut",this.mCardBtnsView.addAnimation(t,"btnOpacity"),this.mCardView.addAnimation(e,"cardSwitch")}startLiveBorderAnima(t){let e=new TKKeyframeAnimation;t.style={opacity:0,transform:{scale:1}},e.setAnimations([()=>(t.style={opacity:1,transform:{scale:1.16}},.5),()=>(t.style={opacity:0,transform:{scale:1.35}},1)]),e.duration=500,t.addAnimation(e,"borderWave")}createBodyView(e){let i=new TKView;return i.style={width:"100%",height:70,marginBottom:8,flexDirection:"row"},this.iconArea=new TKView,this.iconArea.style={width:70,height:70,marginRight:3,flexDirection:"column",justifyContent:"center",alignItems:"center"},vn.addClickConvert(this.vm.adInfo,this.iconArea,2,t.CARD_ICON_CLICK),e.isLive&&(this.mIconBorder=new TKView,this.mIconBorder.style={opacity:0,width:52,height:52,borderColor:"#FE3666",borderWidth:1,borderRadius:26,position:"absolute"},this.iconArea.appendChild(this.mIconBorder),this.animateTimer=setInterval((()=>{this.startLiveBorderAnima(this.mIconBorder)}),1e3)),this.iconView=new TKImage,this.iconView.style={width:52,height:52,borderRadius:26,position:"absolute"},this.iconView.setSrc(e.icon),this.iconArea.appendChild(this.iconView),i.appendChild(this.iconArea),this.textContainer=new TKView,this.textContainer.style={height:"60",maxWidth:227,marginTop:4,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start"},this.nameView=new TKText,this.nameView.style={width:"100%",fontSize:16,textAlign:"left",fontWeight:"medium",color:"#000000",textLineClamp:1,textOverflow:"ellipsis"},this.nameView.setText(e.name),vn.addClickConvert(this.vm.adInfo,this.nameView,2,t.CARD_ICON_NAME_CLICK),this.textContainer.appendChild(this.nameView),this.descView=new TKText,this.descView.style={width:"100%",textLineClamp:2,fontSize:12,color:"#666666",textOverflow:"ellipsis"},this.descView.setText(e.desc),vn.addClickConvert(this.vm.adInfo,this.descView,2,t.CARD_ICON_COMMENT_CLICK),this.textContainer.appendChild(this.descView),i.appendChild(this.textContainer),i}createBtnsView(e){this.btnsView=new TKView,this.btnsView.style={height:this.btnHeight,width:"100%",opacity:0,marginBottom:16,flexDirection:"row"},vn.addClickConvert(this.vm.adInfo,this.btnsView,1,t.CARD_ACTION_BAR_CLICK);let i=this.btnHeight/2;return this.detailContainer=new TKView,this.detailContainer.style={height:"100%",width:"35%",backgroundColor:"#FFD7E0",topLeftRadius:i,bottomLeftRadius:i,flexDirection:"row",justifyContent:"center",paddingLeft:6},this.btnDetail=new TKText,this.btnDetail.style={height:"100%",fontSize:14,textAlign:"center",color:"#FE3666",textLineClamp:1},this.btnDetail.setText(e.btnDetail),this.detailContainer.appendChild(this.btnDetail),this.dividerImage=new TKImage,this.dividerImage.style={width:"8%",height:"100%"},Ve(this.dividerImage,"icon_ec_follow_btns.png"),this.followContainer=new TKView,this.followContainer.style={height:"100%",width:"57%",backgroundColor:"#FE3666",topRightRadius:i,bottomRightRadius:i,paddingRight:11},this.followArea=new TKView,this.followArea.style={justifyContent:"center",flexDirection:"row",alignItems:"center",height:"100%",width:"100%"},this.btnFollow=new TKText,this.btnFollow.style={fontSize:14,textLineClamp:1,textAlign:"center",color:"#FFFFFF",width:"100%"},this.btnFollow.setText(ft(this.vm.adInfo)),this.followArea.appendChild(this.btnFollow),this.followContainer.appendChild(this.followArea),(new TKView).style={width:11,height:"100%"},vn.addClickConvert(this.vm.adInfo,this.detailContainer,1,t.ACTION_BAR_CLICK),vn.addClickConvert(this.vm.adInfo,this.followContainer,1,t.ACTION_BAR_CLICK),this.btnsView.appendChild(this.detailContainer),this.btnsView.appendChild(this.dividerImage),this.btnsView.appendChild(this.followContainer),this.btnsView}static addClickConvert(t,e,i,n){e.addEventListener("tap",(e=>{ei.convertIfNeeded(1,t,i,e.position,n,null)}))}getHeight(){return this.bigHeight}stopActionAnimation(){this.animStopped=!0,this.animateTimer&&clearInterval(this.animateTimer),Ce(this.mIconBorder)||this.mIconBorder.removeAllAnimation()}}class An extends Fi{constructor(t){super(t),this.cardHeight=210,this.toolsButtonSize=32,this.itemHeight=8,this.itemHeightHight=14,this.animStopped=!1,this.mPlusOneImages=new Array,this.isPortrait=0==this.vm.screenOrientation;let e=Vn.createInstance(this.vm.adInfo);this.style={flexDirection:"row",height:this.getHeight(),width:Le.isAndroid()?"100%":this.vm.containerLimit.width};let i=new TKView;i.style={width:"100%",height:193,position:"absolute",bottom:0,left:0,right:0,gradientBgColor:"90,00000099,00000000"},this.appendChild(i),this.appendChild(this.createCardArea(e)),e.isLive||this.appendChild(this.createRightToolButtons(e)),setTimeout((()=>{this.startAnim()}),500)}createCardArea(e){if(this.cardArea=new TKView,this.cardArea.style={width:e.isLive?"100%":"78%",height:this.getHeight(),justifyContent:e.isLive?"space-between":"flex-end",flexDirection:"column",paddingTop:e.isLive?64:0},vn.addClickConvert(this.vm.adInfo,this.cardArea,2,t.CARD_OTHERAREA_CLICK),e.isLive){let t=this.createLiveLabel();this.cardArea.appendChild(t)}let i=new TKView;return this.mCardView=i,i.style={width:"100%",height:this.cardHeight,alignSelf:"flex-end",justifyContent:"space-between",flexDirection:"column",marginBottom:-52,paddingLeft:12,paddingRight:12,paddingBottom:16},this.mHeadView=this.createCardHeadView(e),i.appendChild(this.mHeadView),i.appendChild(this.createCardBodyView(e)),this.mBtnsView=this.createCardBtnsView(e),i.appendChild(this.mBtnsView),this.cardArea.appendChild(i),this.cardArea}startAnim(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.mHeadView.style={transform:{translate:{x:375}}},1)]),t.duration=300,t.timingFunction="EaseOut",t.on("end",(()=>{this.animStopped||(setTimeout((()=>{this.startCardUpAnim()}),5e3),this.startPlusOneAnim())})),this.mHeadView.addAnimation(t,"headTrans")}startCardUpAnim(){if(this.animStopped)return;let t=new TKKeyframeAnimation;t.duration=300,t.timingFunction="EaseOut",t.setAnimations([()=>(this.mCardView.style={transform:{translate:{y:-52}}},1)]);let e=new TKKeyframeAnimation;e.duration=300,e.timingFunction="EaseOut",e.setAnimations([()=>(this.mBtnsView.style={opacity:1},1)]),this.mCardView.addAnimation(t,"cardUp"),this.mBtnsView.addAnimation(t,"btnsAlpha")}startPlusOneAnim(){if(this.animStopped||Ce(this.mPlusOneView))return;let t=new TKKeyframeAnimation;t.duration=300,t.timingFunction="EaseOut",t.setAnimations([()=>(this.mPlusOneView.style={width:31,opacity:1,height:70},1)]);let e=this.mPlusOneImages.length;for(let i=0;i<e;i++){let t=this.mPlusOneImages[i],e=new TKKeyframeAnimation;e.duration=300,e.timingFunction="EaseOut",e.setAnimations([()=>(t.style={width:31,height:24,opacity:1},1)]),t.addAnimation(e,"imgScale")}this.mPlusOneView.addAnimation(t,"plusOneScale"),t.on("end",(()=>{for(let t=0;t<e;t++){let i=this.mPlusOneImages[t],n=new TKKeyframeAnimation;n.duration=500,n.setAnimations([()=>(i.style={height:12,width:15,opacity:0,transform:{translate:{y:-44}}},1)]),setTimeout((()=>{i.addAnimation(n,"plusOneUp")}),250*t),t==e-1&&n.on("end",(()=>{this.mPlusOneImages.splice(0,e),this.mHeadView.removeChild(this.mPlusOneView),this.mPlusOneView=null,this.mPlusOneView=this.createPlusOneContainer(),this.mHeadView.appendChild(this.mPlusOneView),setTimeout((()=>{this.startPlusOneAnim()}),500)}))}}))}createPlusOneContainer(){let t=new TKView;t.style={opacity:0,height:12,width:15,bottom:8,right:61,position:"absolute",flexDirection:"column",justifyContent:"flex-end",alignItems:"center"};let e=this.createPlusOneView(),i=this.createPlusOneView(),n=this.createPlusOneView(),s=this.createPlusOneView();return this.mPlusOneImages.push(e,i,n,s),t.appendChild(e),t.appendChild(i),t.appendChild(n),t.appendChild(s),t}createPlusOneView(){let t=new TKImage;return t.style={width:0,height:0,opacity:0,position:"absolute",bottom:0,right:0,resize:"contain"},Ve(t,"icon_ksad_plus_one.png"),t}createLiveLabel(){let t=new TKView;t.style={width:"100%",height:30,justifyContent:"center",alignItems:"center",flexDirection:"row"};let e={width:2,height:this.itemHeight,backgroundColor:"#FFFFFF"},i=new TKView;i.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:16,height:24};let n=new TKView;n.style=e;let s=new TKView;s.style=e;let a=new TKView;a.style=e,i.appendChild(n),i.appendChild(s),i.appendChild(a),t.appendChild(i);let o=new TKText;o.style={color:"#FFFFFF",fontSize:20,textAlign:"center",paddingLeft:8,paddingRight:8},o.setText("当前正在直播"),t.appendChild(o);let r=new TKView;r.style={flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:16,height:24};let h=new TKView;h.style=e;let l=new TKView;l.style=e;let d=new TKView;return d.style=e,r.appendChild(h),r.appendChild(l),r.appendChild(d),t.appendChild(r),n.addAnimation(this.createWaveItemAnim(n,1),"wave"),s.addAnimation(this.createWaveItemAnim(s,2),"wave"),a.addAnimation(this.createWaveItemAnim(a,3),"wave"),d.addAnimation(this.createWaveItemAnim(d,1),"wave"),l.addAnimation(this.createWaveItemAnim(l,2),"wave"),h.addAnimation(this.createWaveItemAnim(h,3),"wave"),t}createWaveItemAnim(t,e){let i=new TKKeyframeAnimation;return i.setAnimations([()=>(t.style={height:this.itemHeight},.25*(e-1)),()=>(t.style={height:this.itemHeightHight},.25*e),()=>(t.style={height:this.itemHeight},1)]),i.duration=1200,i.repeatCount=-1,i.timingFunction="EaseOut",i.on("start",(()=>{this.animStopped&&t.removeAnimation("wave")})),i}createCardHeadView(e){let i=new TKView;if(i.style={height:"70",marginLeft:-375,width:e.isLive?"78%":"100%",flexDirection:"column",justifyContent:"flex-end"},this.headView=new TKView,this.headView.style={width:"100%",height:28,borderRadius:14,gradientBgColor:"0,FE366600,FE3666",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},vn.addClickConvert(this.vm.adInfo,this.headView,2,t.CARD_FOLLOW_NUM),this.fansListView=new Ki(this.vm.adInfo,20,3),this.fansListView.style={width:60,height:20,marginRight:8},this.fansCountView=new TKText,this.fansCountView.style={fontSize:12,color:"#FFFFFF"},this.fansCountView.setText(e.fansCountText),this.plusOneView=null,this.needShowPlusOneLabel()){this.plusOneView=new TKView,this.plusOneView.style={height:20,width:44,borderRadius:10,backgroundColor:"#FFFFFF",flexDirection:"row",justifyContent:"center",alignItems:"center",position:"absolute",right:4};let t=new TKText;t.style={fontSize:10,color:"#FE3666",marginRight:2},t.setText("我要"),this.iconPlusOne=new TKImage,this.iconPlusOne.style={height:9,width:11},Ve(this.iconPlusOne,"icon_ksad_plus_one_pink.png"),this.plusOneView.appendChild(t),this.plusOneView.appendChild(this.iconPlusOne)}return this.headView.appendChild(this.fansListView),this.headView.appendChild(this.fansCountView),null!=this.plusOneView&&this.headView.appendChild(this.plusOneView),i.appendChild(this.headView),this.needShowPlusOneAnima()&&(this.mPlusOneView=this.createPlusOneContainer(),i.appendChild(this.mPlusOneView)),i}createCardBodyView(e){let i=new TKView;i.style={flexDirection:"column",width:"100%"};let n=new TKView;return n.style={flexDirection:"row",width:"100%",alignItems:"center"},this.nameView=new TKText,this.nameView.style={fontSize:15,color:"#FFFFFF",fontWeight:"bold",textAlign:"center",includeFontPadding:!1,marginBottom:5},this.nameView.setText("@"+e.name),n.appendChild(this.nameView),vn.addClickConvert(this.vm.adInfo,this.nameView,2,t.CARD_ICON_NAME_CLICK),this.logoView=new Vi(0,this.vm.adInfo,12),this.logoView.style={height:12,opacity:.4,marginLeft:8},n.appendChild(this.logoView),i.appendChild(n),this.descView=new TKText,this.descView.style={fontSize:14,color:"#FFFFFF",fontWeight:"normal",textLineClamp:2,textOverflow:"ellipsis",textAlign:"left"},this.descView.setText(e.desc),i.appendChild(this.descView),vn.addClickConvert(this.vm.adInfo,this.descView,2,t.CARD_ICON_COMMENT_CLICK),i}createCardBtnsView(e){this.btnsView=new TKView,this.btnsView.style={height:36,width:"100%",flexDirection:"row",justifyContent:"space-between"},vn.addClickConvert(this.vm.adInfo,this.btnsView,1,t.CARD_ACTION_BAR_CLICK),this.btnDetailArea=new TKView,this.btnDetailArea.style={height:"100%",width:"48%",backgroundColor:"#FFFFFF",borderRadius:18,flexDirection:"row",alignItems:"center",justifyContent:"center"},this.btnDetail=new TKText,this.btnDetail.style={height:"100%",color:"#FE3666",textAlign:"center"},this.btnDetail.setText(e.btnDetail),this.btnDetailArea.appendChild(this.btnDetail),this.btnsView.appendChild(this.btnDetailArea),this.followContainer=new TKView,this.followContainer.style={height:"100%",width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:"#FE3666",borderRadius:18},this.btnFollow=new TKText,this.btnFollow.style={height:"100%",color:"#FFFFFF",textAlign:"center"},this.btnFollow.setText(ft(this.vm.adInfo)),this.followContainer.appendChild(this.btnFollow);let i=new TKView;return i.style={height:"100%",width:"48%"},i.appendChild(this.followContainer),this.btnsView.appendChild(i),this.btnsView}createRightToolButtons(e){this.toolsArea=new TKView,this.toolsArea.style={flexDirection:"column",height:"100%",width:"22%",justifyContent:"space-between",alignItems:"center",paddingBottom:22},vn.addClickConvert(this.vm.adInfo,this.toolsArea,1,t.CARD_ICON_CLICK);let i=this.createAvatarView(e);return this.toolsArea.appendChild(i),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_heart.png","点赞")),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_comment.png","评论")),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_favor.png","收藏")),this.toolsArea.appendChild(this.newToolsIcon("icon_ksad_share.png","分享")),this.toolsArea}newToolsIcon(t,e){return this.toolBtn=new TKView,this.toolBtn.style={flexDirection:"column",width:"100%",alignItems:"center"},this.image=new TKImage,this.image.style={padding:2,width:this.toolsButtonSize,height:this.toolsButtonSize},this.image.setSrc(t),Ve(this.image,t),this.toolBtn.appendChild(this.image),this.titleView=new TKText,this.titleView.style={fontSize:10,textAlign:"center",color:"#FFFFFF"},this.titleView.setText(e),this.toolBtn.appendChild(this.titleView),this.toolBtn}createAvatarView(t){let e=new TKView;e.style={width:44,height:52,flexDirection:"column",alignItems:"center"},this.avatarImage=new TKImage,this.avatarImage.style={width:44,height:44,borderRadius:22,borderColor:"#FFFFFF",borderWidth:1},this.avatarImage.setSrc(t.icon),e.appendChild(this.avatarImage);let i=new TKView;return i.style={height:16,width:26,backgroundColor:"#FE3666",borderRadius:8,flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",bottom:0},this.addImgae=new TKImage,this.addImgae.style={height:10,width:10,alignSelf:"center"},Ve(this.addImgae,"icon_ksad_add_white_no_margin.png"),i.appendChild(this.addImgae),e.appendChild(i),e}needShowPlusOneLabel(){let t=this.vm.configInfo.abConfig.shortVideoFollowRewardAnimationStyle;return 0==t||2==t}needShowPlusOneAnima(){let t=this.vm.configInfo.abConfig.shortVideoFollowRewardAnimationStyle;return 0==t||1==t}getHeight(){return 318}stopActionAnimation(){this.animStopped=!0}}class Vn{constructor(){this.btnDetail="了解更多",this.fansCountText="100万人关注了ta"}static createInstance(t){let e=new Vn;return e.name=K.getAdTitle(t),e.desc=t.adBaseInfo.adDescription,Ce(e.desc)&&(e.desc=""),e.icon=K.getIconUrl(t),e.isLive=t.adBaseInfo.isAccountLive,e.fansCountText=et(t)+"人关注了Ta",e}}class bn extends Fi{constructor(t){super(t),this.spikeTimeBgColor="315,#FF8000,#FF0A43",this.spikeTimeStyle={height:"16",width:"16",gradientBgColor:this.spikeTimeBgColor,color:"#FFFFFF",textAlign:"center",borderRadius:2,fontSize:12,includeFontPadding:!1,textLineClamp:1},this.spikeTimer=0,this.isPortrait=0==this.vm.screenOrientation,this.realCardHeight=this.vm.getECOrderData().hasSpike?216:219,this.isPortrait||(this.realCardHeight=this.realCardHeight-24),this.style={height:this.getHeight(),width:Le.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:this.isPortrait?"column":"row-reverse",justifyContent:this.isPortrait?"flex-start":"space-between",paddingLeft:16,paddingRight:16},this.appendChild(this.createKsAdLogoView(this.vm.adInfo));let e=this.isPortrait?"100%":375;this.card=new TKView,this.card.style={width:e,height:175,marginTop:8,flexDirection:"column",backgroundColor:"#FFFFFF",borderRadius:12},this.vm.getECOrderData().hasSpike?this.card.appendChild(this.createSpikeHeaderView(this.vm.getECOrderData())):(this.card.appendChild(this.createNormalHeaderBgView()),this.card.appendChild(this.createNormalHeaderView(this.vm.getECOrderData()))),this.card.appendChild(this.createBodyView(this.vm.getECOrderData())),this.card.appendChild(this.createFooterView(this.vm.getECOrderData())),this.appendChild(this.card)}createKsAdLogoView(t){this.ksadLogoView=new Vi(1,t),this.ksadLogoView.style={height:16,marginBottom:this.isPortrait?0:20};let e=new TKView;return e.appendChild(this.ksadLogoView),e.style={height:this.isPortrait?16:"100%",width:this.isPortrait?"100%":"25%",marginRight:16,alignItems:"flex-end",flexDirection:"column-reverse"},e}createNormalHeaderView(e){this.header=new TKView,this.header.style={flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",paddingLeft:12,height:30};let i=new TKView;return i.style={height:"16",marginTop:11,flexDirection:"row",alignItems:"center",paddingRight:6},this.couponIcon=new TKImage,this.couponIcon.style={width:14,height:e.hasCounpon?11:14.5,marginRight:5},Ve(this.couponIcon,e.getHeaderIcon()),i.appendChild(this.couponIcon),this.couponTips=new TKText,this.couponTips.setText(e.getHeaderTips()),this.couponTips.style={color:"#FF5000",fontSize:12},i.appendChild(this.couponTips),this.header.appendChild(i),this.kwaiLogoView=new TKImage,this.kwaiLogoView.style={width:20,height:20},Ve(this.kwaiLogoView,"icon_ksad_kwai_logo.png"),this.header.appendChild(this.kwaiLogoView),this.addClickConvert(this.header,2,t.CARD_OTHERAREA_CLICK),this.header}createNormalHeaderBgView(){let t=new TKImage;return Ve(t,"icon_ksad_ec_order_coupon_header_bg.png"),t.style={position:"absolute",left:0,right:0,top:0,height:90,width:"100%"},t}createSpikeHeaderView(e){this.header=new TKView,this.header.style={flexDirection:"row",justifyContent:"space-between",paddingLeft:12,height:26};let i=new TKImage;Ve(i,"icon_ksad_ec_order_header_bg.png"),i.style={position:"absolute",height:"100%",left:0,right:0,top:0,topLeftRadius:12,topRightRadius:12},this.header.appendChild(i);let n=new TKView;n.style={height:"100%",paddingBottom:2,paddingTop:2,flexDirection:"row",alignItems:"center",paddingRight:6},this.spikeIcon=new TKImage,this.spikeIcon.style={width:61,height:12},Ve(this.spikeIcon,"icon_ksad_spike.png"),n.appendChild(this.spikeIcon);let s=new TKView;s.style={width:.5,height:11,backgroundColor:"#FF500080",marginLeft:5,marginRight:5},n.appendChild(s);let a=new TKText;return a.setText("距结束"),a.style={color:"#FF5000",fontSize:12,marginRight:2},n.appendChild(a),this.spikeHourText=new TKText,this.spikeHourText.style=this.spikeTimeStyle,n.appendChild(this.spikeHourText),n.appendChild(this.createTimeDivider()),this.spikeMinuteText=new TKText,this.spikeMinuteText.style=this.spikeTimeStyle,n.appendChild(this.spikeMinuteText),n.appendChild(this.createTimeDivider()),this.spikeSecondText=new TKText,this.spikeSecondText.style=this.spikeTimeStyle,n.appendChild(this.spikeSecondText),0!=this.spikeTimer&&clearInterval(this.spikeTimer),this.spikeTimer=setInterval((()=>{let t=e.getSpikeTime();this.spikeHourText.setText(t.getFormattedHour()),this.spikeMinuteText.setText(t.getFormattedMinute()),this.spikeSecondText.setText(t.getFormattedSecond())}),1e3),this.header.appendChild(n),this.kwaiLogoView=new TKImage,this.kwaiLogoView.style={width:20,height:20},Ve(this.kwaiLogoView,"icon_ksad_kwai_logo.png"),this.header.appendChild(this.kwaiLogoView),this.addClickConvert(this.header,2,t.CARD_OTHERAREA_CLICK),this.header}createBodyView(e){this.bodyView=new TKView,this.bodyView.style={height:64,width:"100%",paddingLeft:12,paddingRight:12,marginTop:6,flexDirection:"row"},this.productIcon=new TKImage,this.productIcon.style={width:64,height:64,borderRadius:4,marginRight:8},this.bodyView.appendChild(this.productIcon),this.productIcon.setSrc(e.icon);let i=new TKView;i.style={height:"100%",flexShrink:1,flexDirection:"column"},this.adNameText=new TKText,this.adNameText.style={color:"#222222",fontSize:15,textLineClamp:1,textOverflow:"ellipsis"},this.adNameText.setText(e.name),i.appendChild(this.adNameText),this.adDescText=new TKText,this.adDescText.style={color:"#9C9C9C",fontSize:12,marginTop:4,textLineClamp:1,textOverflow:"ellipsis"},this.adDescText.setText(e.getAdDesc()),i.appendChild(this.adDescText),this.priceContainer=new TKView,this.priceContainer.style={flexDirection:"row",alignItems:"flex-end",height:24},this.pricePrefix=new TKText,this.pricePrefix.setText(e.getPricePrefix()),this.pricePrefix.style={fontSize:12,color:"#FE3666",marginRight:4,textAlign:"center"},this.priceContainer.appendChild(this.pricePrefix);let n=new TKText;n.setText("¥"),n.style={fontSize:14,color:"#FE3666",marginRight:2,textAlign:"center"},this.priceContainer.appendChild(n),this.priceCurrent=new TKText,this.priceCurrent.setText(e.price),this.priceCurrent.style={fontSize:20,color:"#FE3666",marginRight:6,textAlign:"center"},this.priceContainer.appendChild(this.priceCurrent);let s=e.originalPrice;return Ce(s)||(this.priceOriginal=new TKText,this.priceOriginal.setText("¥"+s),this.priceOriginal.style={fontSize:13,color:"#C6C6C6",textDecoration:"line-through",textAlign:"center"},this.priceContainer.appendChild(this.priceOriginal)),i.appendChild(this.priceContainer),this.bodyView.appendChild(i),this.addClickConvert(this.bodyView,2,t.CARD_OTHERAREA_CLICK),this.bodyView}createFooterView(e){let i=new TKView;return i.style={paddingLeft:18,paddingRight:18},this.btnClick=new TKButton,this.btnClick.setText(e.btnClickText),this.btnClick.style={height:48,width:"100%",marginTop:15,fontSize:15,color:"#FFFFFF",backgroundColor:"#FE3666",borderRadius:30},this.addClickConvert(this.btnClick,1,t.CARD_ACTION_BAR_CLICK),i.appendChild(this.btnClick),i}getHeight(){return this.realCardHeight}createTimeDivider(){let t=new TKText;return t.setText(":"),t.style={fontSize:12,height:16,textAlign:"center",color:"#FF5000",marginLeft:2,marginRight:2,includeFontPadding:!1},t}addClickConvert(t,e,i){t.addEventListener("tap",(n=>{let s={template_show_type:this.vm.getECOrderData().getCardStyleLog()};const a=pe(n,t);this.vm.convert(1,e,a,i,s)}))}}class Sn extends Fi{constructor(e){super(e),this.style={width:Le.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:0};const i=new TKView;i.style={backgroundColor:"#00000000",height:68,width:"100%",paddingLeft:12,paddingRight:12,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.appendChild(i);const n=new TKProgressBar;n.style={backgroundColor:"#FF9BB3",width:"100%",height:44,cornerRadius:22,indeterminate:!1};const s=new TKProgressBar;s.style={backgroundColor:"#FE3666",width:"100%",height:44,cornerRadius:22,position:"absolute",left:12,top:12};const a=new TKText;a.style={fontSize:16,fontWeight:"bold",color:"#FFFFFF",width:"100%",height:44,textAlign:"center",position:"absolute",top:12,left:12},i.appendChild(n),i.appendChild(s),i.appendChild(a),Ci(a,"text",this.vm.$attrsPath.actionText),s.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),n.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),i.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}getHeight(){return 68}}class xn extends TKView{constructor(t){super(),this.vm=t,this.isVertical=this.vm.isVertical(),this.size=this.isVertical?{width:188,height:46}:{width:98,height:24},this.setupView(),this.setupAction(),this.setupData();const e=this;yi(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"showStart"===t&&e.startAnimation()}))}setupView(){this.style={position:"absolute",width:this.size.width+30,height:this.size.height+20,justifyContent:"center",alignItems:"center"},this.buttonView=new TKView,this.buttonView.style={position:"absolute",width:this.size.width,height:this.size.height,backgroundColor:"#0000004D",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:.5*this.size.height,alignSelf:"center"},this.appendChild(this.buttonView),this.containerView=new TKView,this.containerView.style={flexDirection:"row",width:this.size.width,height:this.size.height,justifyContent:"center",alignItems:"center"},this.appendChild(this.containerView),this.iconView=new _n(this.vm),this.containerView.appendChild(this.iconView),this.titleText=new TKText,this.titleText.style={color:"#FFFFFF",fontSize:this.isVertical?16:10,fontWeight:"medium",marginLeft:6},this.containerView.appendChild(this.titleText)}setupData(){this.titleText.setText(this.vm.getLiveButtonTitle())}setupAction(){const t=this;this.addEventListener("tap",(e=>{t.clickCallback&&t.clickCallback(e)}))}startAnimation(){if(this.isAnimating)return;this.isAnimating=!0,this.iconView.startAnimation();const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.buttonView.style={transform:{scale:1.02}},.6),()=>(t.buttonView.style={transform:{scale:1}},1)]),e.duration=1100,e.repeatCount=Number.MAX_SAFE_INTEGER,this.buttonView.addAnimation(e,"buttonViewAnimation")}}class _n extends TKView{constructor(t){super(),this.vm=t,this.isVertical=this.vm.isVertical(),this.size=this.isVertical?{width:13,height:13}:{width:9,height:8},this.setupView()}setupView(){this.style={width:this.size.width,height:this.size.height,flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"},this.firstVerticalBar=this.createVerticalBar(this.size.height),this.appendChild(this.firstVerticalBar),this.secondVerticalBar=this.createVerticalBar(this.size.height-8),this.appendChild(this.secondVerticalBar),this.thirdVerticalBar=this.createVerticalBar(this.size.height-4),this.appendChild(this.thirdVerticalBar)}startAnimation(){const t=this.createVerticalBarAnimation(this.firstVerticalBar,this.size.height-4,this.size.height);this.firstVerticalBar.addAnimation(t,"firstVerticalBarAnimation");const e=this.createVerticalBarAnimation(this.secondVerticalBar,this.size.height,this.size.height-8);this.secondVerticalBar.addAnimation(e,"secondVerticalBarAnimation");const i=this.createVerticalBarAnimation(this.thirdVerticalBar,this.size.height-8,this.size.height-4);this.thirdVerticalBar.addAnimation(i,"thirdVerticalBarAnimation")}createVerticalBar(t){const e=new TKView;return e.style={width:this.vm.isVertical()?2:1,height:t,backgroundColor:"#FFFFFF",borderRadius:1},e}createVerticalBarAnimation(t,e,i){const n=new TKKeyframeAnimation;return n.setAnimations([()=>(t.style={height:e},.5),()=>(t.style={height:i},1)]),n.timingFunction="ease-in-out",n.duration=600,n.repeatCount=Number.MAX_SAFE_INTEGER,n}}class Ln extends Fi{constructor(t){super(t),this.setupViews(),this.setDatas(),this.bindEvent()}setupViews(){if(this.cardWidth=0==this.vm.screenOrientation?this.vm.containerLimit.width:375,this.style={width:this.cardWidth,flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:14,left:0},this.bottomContainer=new TKView,this.bottomContainer.style={width:"100%",height:320,flexDirection:"row"},this.appendChild(this.bottomContainer),this.iconImg=new TKImage,this.iconImg.style={width:48,height:48,borderColor:"#FFFFFF",borderWidth:1,borderRadius:24,marginLeft:16,marginRight:10,marginBottom:this.vm.adInfo.adBaseInfo.haveBeenFollowed?12:0,alignSelf:"flex-end"},this.bottomContainer.appendChild(this.iconImg),this.vm.adInfo.adBaseInfo.haveBeenFollowed){let t=new TKView;t.style={position:"absolute",bottom:0,left:16,width:48,height:17,borderRadius:8.5,backgroundColor:"#FFFFFF",flexDirection:"column",alignItems:"center",justifyContent:"center"};let e=new TKText;e.style={fontSize:10,color:"#222222"},e.setText("你的关注"),t.appendChild(e),this.bottomContainer.appendChild(t)}this.rightCardViewContainer=new TKView,this.rightCardViewContainer.style={position:"absolute",bottom:0,left:74,width:this.cardWidth-90,flexDirection:"column",opacity:0},this.rightCardView=new TKView,this.rightCardView.style={width:"100%",flexDirection:"column",backgroundColor:"#FFFFFF",bottomRightRadius:10,topLeftRadius:10,topRightRadius:10},this.vm.isAdForLive()&&0==this.vm.screenOrientation&&this.appendTextAndProductClickView(),this.vm.isAdForLive()&&0==this.vm.screenOrientation&&this.vm.isAddLiveButton()&&Le.isAndroid()&&(this.adLiveButton=new xn(this.vm.getKSAdLiveButtonViewModel()),this.adLiveButton.style={width:"100%",alignSelf:"auto",marginTop:60},this.adLiveButton.startAnimation(),this.adLiveButton.clickCallback=e=>{const i=pe(e,this.adLiveButton);this.convert(1,i,t.LIVE_BUTTON_CLICK)},this.bottomContainer.appendChild(this.adLiveButton)),this.appendAdLogo(),this.rightCardViewContainer.appendChild(this.rightCardView),this.bottomContainer.appendChild(this.rightCardViewContainer),this.appendRightCardTitleView(),this.appendLineView(),this.vm.isValidBottomCouponCardInfo()?(this.appendRightCouponCardView(),this.rightCardViewContainer.style={opacity:1}):(this.appendRightCardDescView(),this.appendActionBarView(),this.startScaleAnimation())}appendTextAndProductClickView(){let t=new TKView;t.style={width:this.cardWidth-24,position:"absolute",left:16,bottom:150,height:170,flexDirection:"row"},this.leftTextClickView=new TKView,this.leftTextClickView.style={width:243,height:170},this.rightProductClickView=new TKView,this.rightProductClickView.style={width:this.cardWidth-24-243,height:170},t.appendChild(this.leftTextClickView),t.appendChild(this.rightProductClickView),this.bottomContainer.appendChild(t)}appendAdLogo(){this.ksadLogoView=new Vi(1,this.vm.adInfo),this.ksadLogoView.style={height:16,marginBottom:4,alignSelf:"flex-end"},this.rightCardViewContainer.appendChild(this.ksadLogoView)}appendRightCardTitleView(){let t=new TKView;t.style={height:32,width:"100%",flexDirection:"row",alignItems:"center"},this.titleText=new TKText,this.titleText.style={color:"#222222",fontSize:14,textLineClamp:1,maxWidth:"92%",paddingLeft:16,paddingRight:4,textOverflow:"ellipsis",fontWeight:"medium"},t.appendChild(this.titleText),this.liveIcon=new Pi,t.appendChild(this.liveIcon),this.rightCardView.appendChild(t)}appendLineView(){let t=new TKView;t.style={height:1,width:"100%",flexDirection:"row",alignItems:"center",backgroundColor:"#F6F6F6"},this.rightCardView.appendChild(t)}appendRightCardDescView(){this.descView=new TKText,this.descView.style={marginLeft:16,marginRight:16,textLineClamp:2,textOverflow:"ellipsis",fontSize:12,color:"#666666",textLineHeight:20,marginTop:8,marginBottom:8},this.rightCardView.appendChild(this.descView)}appendActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={height:0,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row",opacity:0},this.rightCardView.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"33%",height:36,backgroundColor:"#FFD7E0",flexDirection:"row",alignItems:"center",topLeftRadius:18,bottomLeftRadius:18,justifyContent:"center"},this.leftActionBarIcon=new TKImage,this.leftActionBarIcon.style={width:17,height:17},this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:14,color:"#FE3666",fontWeight:"medium"},this.leftActionBar.appendChild(this.leftActionBarIcon),this.leftActionBar.appendChild(this.leftActionBarText),this.middleIcon=new TKImage,this.middleIcon.style={width:"9%",height:36},Ve(this.middleIcon,"icon_ksad_live_actionbar.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"58%",height:36,topRightRadius:18,bottomRightRadius:18,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarIcon=new TKImage,this.rightActionBarIcon.style={width:17,height:17},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:14,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.rightActionBar.appendChild(this.rightActionBarIcon),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(this.middleIcon),this.actionBarView.appendChild(this.rightActionBar)}appendRightCouponCardView(){this.couponCardView=new TKView,this.couponCardView.style={height:60,width:this.cardWidth-122,marginLeft:16,marginRight:16,marginTop:10,marginBottom:10,position:"absolute"},this.rightCardView.appendChild(this.couponCardView),this.couponCardViewBg=new TKImage,this.couponCardViewBg.style={position:"absolute",top:0,left:0,height:60,borderRadius:4,width:this.cardWidth-122},this.couponCardView.appendChild(this.couponCardViewBg),this.priceLayout=new TKView,this.priceLayout.style={height:60,width:65,position:"absolute",top:0,justifyContent:"center",alignContent:"center",alignItems:"center",flexDirection:"row"},this.couponCardPriceTxt=new TKText,this.couponCardPriceTxt.style={fontSize:20,color:"#FFFFFF",height:60,justifyContent:"center",textAlign:"center",fontWeight:"medium"},this.priceLayout.appendChild(this.couponCardPriceTxt),this.couponCardView.appendChild(this.priceLayout),this.couponCardDesView=new TKView,this.couponCardDesView.style={position:"absolute",left:79,flexDirection:"column",justifyContent:"center",alignContent:"center",height:60,width:90},this.couponCardTitle=new TKText,this.couponCardTitle.style={fontSize:13,color:"#FFFFFF",height:18,fontWeight:"medium",textAlign:"left"},this.couponCardTitle.setText("超值优惠券"),this.couponCardDesView.appendChild(this.couponCardTitle),this.couponCardDurationTxt=new TKText,this.couponCardDurationTxt.style={fontSize:12,color:"#FFFFFF",height:15,opacity:.7,textAlign:"left"},this.couponCardDesView.appendChild(this.couponCardDurationTxt),this.couponCardView.appendChild(this.couponCardDesView),this.couponCardActionBtn=new TKText,this.couponCardActionBtn.style={right:9,top:17,width:62,height:26,backgroundColor:"#FFFFFF",fontSize:12,color:"#FF3A30",alignItems:"center",borderRadius:13,alignContent:"flex-end",justifyContent:"center",textAlign:"center",position:"absolute"},this.couponCardView.appendChild(this.couponCardActionBtn),this.reportCouponImpression()}createFontSizeSpanItem(t,e){const i=new TKSpanItem;return i.spanType="absoluteSize",i.color="#FFFFFF",i.size=12,i.start=t,i.end=e,i}setDatas(){if(this.iconImg.setSrc(this.vm.getAdIcon()),this.titleText.setText(this.vm.getAdTitle()),this.vm.isValidBottomCouponCardInfo()){let t;Ve(this.couponCardViewBg,this.vm.getCouponCardViewBg()),t=this.vm.getCouponBottomPriceRMB()+this.vm.getCouponBottomPrice();const e=this.createFontSizeSpanItem(0,this.vm.getCouponBottomPriceRMB().length),i=new TKSpan;i.addSpan(e),this.couponCardPriceTxt.setSpan(t,i),this.couponCardActionBtn.setText(this.vm.getCouponBottomActionBtn()),this.couponCardTitle.setText(this.vm.getCouponBottomTitle()),this.couponCardDuration=1e3*this.vm.getCouponBottomDuration(),this.couponCardDurationTxt.setText(ct(this.couponCardDuration)+"后失效"),this.startShowTimer()}else this.descView.setText(this.vm.adInfo.adBaseInfo.adDescription),this.vm.adInfo.adBaseInfo.haveBeenFollowed?(Ve(this.leftActionBarIcon,"icon_ksad_collected.png"),this.leftActionBarText.setText("感兴趣")):(Ve(this.leftActionBarIcon,"icon_ksad_live_follow.png"),this.leftActionBarText.setText("关注")),Ve(this.rightActionBarIcon,"icon_ksad_live_look.png"),this.rightActionBarText.setText(this.vm.adInfo.adBaseInfo.adActionDescription)}bindEvent(){this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.isValidBottomCouponCardInfo()?this.couponCardView.addEventListener("tap",(e=>{let i=new b,n=new S;n.couponType=this.vm.getCouponBottomBusinessType(),i.neo_ext_data=n,ei.convertIfNeeded(1,this.vm.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK,i)})):(this.leftActionBar.addEventListener("tap",(e=>{let i=new b;i.follows_status=this.vm.adInfo.adBaseInfo.haveBeenFollowed?2:1,ei.convertIfNeeded(1,this.vm.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.CARD_LEFT_ACTION_BAR_CLICK,i)})),this.rightActionBar.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.ACTION_BAR_CLICK)})),this.leftTextClickView&&this.leftTextClickView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.ACTIONBAR_ICON_COMMENT_CLICK)}))),this.rightProductClickView&&this.rightProductClickView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.ACTIONBAR_ICON_CLICK)})),this.adLiveButton&&this.adLiveButton.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.LIVE_BUTTON_CLICK)}))}startScaleAnimation(){setTimeout((()=>{const t=this.getScaleAnimation(this.rightCardViewContainer);this.rightCardViewContainer.addAnimation(t,"scaleAnimation")}),500)}startTransAnimation(){const t=this.getTransformAnimation(this.rightCardViewContainer);this.rightCardViewContainer.addAnimation(t,"tkKeyframeAnimation")}showActionBarAnimation(){const t=this.getShowActionBarAnimation(this.actionBarView);this.actionBarView.addAnimation(t,"showActionBarAnimation")}startActionBarOpacityAnimation(){const t=this.getOpacityActionBarAnimation(this.actionBarView);this.actionBarView.addAnimation(t,"opacityActionBarAnimation"),t.on("end",(t=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}))}getScaleAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={transform:{translate:{x:-t.getSize().width/2/2,y:t.getSize().height/2/2},scale:.5},opacity:.1},1)]),e.duration=100,e.on("end",(()=>{this.startTransAnimation()})),e}getTransformAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={transform:{translate:{x:0,y:0},scale:1},opacity:1},1)]),e.duration=300,e.on("end",(()=>{setTimeout((()=>{this.showActionBarAnimation()}),2e3)})),e}getShowActionBarAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={height:46,paddingBottom:10},1)]),e.duration=300,e.on("end",(()=>{this.startActionBarOpacityAnimation()})),e}getOpacityActionBarAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={opacity:1},1)]),e.duration=300,e.on("end",(()=>{})),e}getHeight(){return 334}startShowTimer(){this.stopShowTimer(),this.showTimer=setInterval((()=>{let t=this.couponCardDuration;this.couponCardDuration=t-10,this.couponCardDuration<=0?this.stopShowTimer():this.couponCardDurationTxt.setText(ct(this.couponCardDuration)+"后失效")}),10)}stopShowTimer(){this.showTimer&&clearInterval(this.showTimer),this.showTimer=0}stopActionAnimation(){this.liveIcon&&this.liveIcon.stopLiveViewAnimation(),this.vm.isValidBottomCouponCardInfo()&&this.stopShowTimer()}reportCouponImpression(){let t=new b,e=new S;e.couponType=this.vm.getCouponBottomBusinessType(),t.neo_ext_data=e;let i={elementType:16,clientExtData:JSON.stringify(t)},n={actionType:140,payload:JSON.stringify(i)};ke.sendLog(n)}onGetMiddleMarginBottom(t){return t?super.onGetMiddleMarginBottom(t):108}}const Dn="coupon_of_no_cash_equity";class Fn extends Fi{constructor(t){super(t),this.bgColor="135, #FF786A, #FFF4E1",this.vm=t,this.setupView(),this.setupData(),this.setupActions(),this.addHighlightSpan()}setupView(){this.width=this.vm.containerLimit.width-32,this.height=80*(this.width-16)/327,this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",bottom:-16,opacity:0},this.containerView=new TKView,this.containerView.style={width:this.width,height:this.getHeight(),left:16,flexDirection:"column",position:"absolute",justifyContent:"center",alignItems:"center",gradientBgColor:this.bgColor,borderRadius:10},this.appendChild(this.containerView),this.appendOutContainerView(),this.appendCouponContainerView(),this.setupLogoView()}appendOutContainerView(){this.couponTitleContainer=new TKView,this.couponTitleContainer.style={width:this.width-16,height:17,left:8,top:"7.7%",flexDirection:"row",alignItems:"center",position:"absolute"},this.containerView.appendChild(this.couponTitleContainer),this.bannerTitle=new TKText,this.bannerTitle.style={left:0,top:0,fontSize:12,color:"#FC4A5D",textLineClamp:1,fontWeight:"medium",position:"absolute",textOverflow:"ellipsis"},this.couponTitleContainer.appendChild(this.bannerTitle),this.couponTips=new TKText,this.couponTips.style={right:0,fontSize:10,color:"#FFFFFF",textLineClamp:1,position:"absolute",fontWeight:"medium",textOverflow:"ellipsis"},this.couponTitleContainer.appendChild(this.couponTips)}appendCouponContainerView(){this.couponViewContainer=new TKView,this.couponViewContainer.style={width:this.width-16,height:this.height,flexDirection:"row",backgroundColor:"#FDFDFD",justifyContent:"center",alignItems:"center",position:"absolute",bottom:"6.4%",borderRadius:8},this.containerView.appendChild(this.couponViewContainer),this.icon=new TKImage,this.icon.style={width:68*this.width/343,height:68*this.width/343,left:"1.8%",borderRadius:6,position:"absolute"},this.couponViewContainer.appendChild(this.icon),this.titleContainer=new TKView,this.titleContainer.style={left:"27.5%",width:"40%",height:46,justifyContent:"flex-start",alignItems:"flex-start",position:"absolute"},this.couponViewContainer.appendChild(this.titleContainer),this.title=new TKText,this.title.style={top:ce()?0:2,fontSize:15,position:"absolute",color:"#040404",textLineClamp:1,fontWeight:"medium",textOverflow:"ellipsis"},this.titleContainer.appendChild(this.title),this.contentDesc=new TKText,this.contentDesc.style={bottom:0,fontSize:12,color:"#8C8C8C",textLineClamp:1,position:"absolute",fontWeight:"medium",textOverflow:"ellipsis"},this.titleContainer.appendChild(this.contentDesc),this.actionBtn=new Ri(this.vm.adInfo,{width:88*this.width/343,height:36*this.width/343,borderRadius:18*this.width/343},(t=>{t.style={fontSize:14,color:"#FFFFFF",textLineClamp:1,fontWeight:"medium",textOverflow:"ellipsis"}})),this.actionBtn.style={flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",backgroundColor:"#FE3666",right:10},this.couponViewContainer.appendChild(this.actionBtn),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn&&this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn&&this.actionBtn.setDownloadChange(t)}))}setupLogoView(){var t;const e=(null===(t=le())||void 0===t?void 0:t.bottom)>0?43:27;this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={position:"absolute",left:16,bottom:this.getHeight()+e},this.logoView.enabled=!1,this.appendChild(this.logoView)}getHeight(){return this.height+44}onGetMiddleMarginBottom(t){var e;const i=(null===(e=le())||void 0===e?void 0:e.bottom)>0?43:27;return Number(this.getHeight()+i)}setupData(){let t=this.vm.getCouponModel();this.bannerTitle.setText(t.bannerTitle),this.couponTips.setText(t.couponTips),this.icon.setSrc(t.icon),this.title.setText(t.title),this.contentDesc.setText(t.contentDesc),this.actionBtn&&this.actionBtn.setText(t.actionBarDesc)}setupActions(){const e=this;e.containerView.addEventListener("tap",(i=>{let n=new b;n.template_show_type=Dn;const s=pe(i,e.containerView);e.vm.convert(1,2,s,t.CARD_ACTION_BAR_CLICK,n)})),e.actionBtn&&e.actionBtn.setOnTapListener((i=>{let n=new b;n.template_show_type=Dn;const s=pe(i,e.actionBtn);e.vm.convert(1,1,s,t.CARD_ACTION_BAR_CLICK,n)}))}addHighlightSpan(){let t=this.vm.getCouponModel();const e=t.title.search(t.highlightTitle);if(-1==e||t.highlightTitle.length<=0)return void this.title.setText(t.title);let i=new TKSpan;const n=new TKSpanItem;n.color="#FE3666",n.spanType="foregroundColor",n.start=e,n.end=e+t.highlightTitle.length,i.addSpan(n),this.title.setSpan(t.title,i)}}class kn extends TKView{constructor(t){super(),this.mHeight=36,this.mIconSize=32,this.mFollowBtnHeight=24,this.vm=t,this.setupView(),this.bindView(),setTimeout((()=>{this.mLivingWaveView.startWaveAnimation()}),500)}setupView(){this.style={height:this.mHeight,width:160,borderRadius:this.mHeight/2,backgroundColor:"#00000033",paddingHorizontal:6,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},this.mIconView=new TKImage,this.mIconView.style={width:this.mIconSize,height:this.mIconSize,borderRadius:this.mIconSize/2,marginRight:8},this.appendChild(this.mIconView),this.appendChild(this.createNameContainer()),this.mFollowBtn=new TKText,this.mFollowBtn.style={height:this.mFollowBtnHeight,borderRadius:this.mFollowBtnHeight/2,paddingHorizontal:6,fontSize:12,includeFontPadding:!1,color:"#FFFFFF",marginLeft:8,backgroundColor:"#FE3666",textAlign:"center",textLineClamp:1},this.mFollowBtn.setText("关注"),this.appendChild(this.mFollowBtn)}createNameContainer(){let t=new TKView;t.style={flexDirection:"column",flexBasis:100,flexShrink:1,flexGrow:1},this.mNameView=new TKText,this.mNameView.style={fontSize:12,textAlign:"center",color:"#FFFFFF",marginBottom:2,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.mNameView);let e=new TKView;return e.style={flexDirection:"row"},this.mLivingWaveView=new zi([2,4,5],1),this.mLivingWaveView.style={backgroundColor:"#FE3666",height:10,width:10,borderRadius:5,paddingHorizontal:1.5,flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginRight:2},this.mFansView=new TKText,this.mFansView.style={fontSize:9,color:"#FFFFFF",includeFontPadding:!1,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},e.appendChild(this.mLivingWaveView),e.appendChild(this.mFansView),t.appendChild(e),t}bindView(){Ce(this.vm)||(this.mIconView&&this.mIconView.setSrc(this.vm.iconUrl),this.mNameView&&this.mNameView.setText(this.vm.name),this.mFansView&&this.mFansView.setText(this.vm.fans))}}class Rn extends ji{}class Bn extends TKView{constructor(t,e){super(),this.mIconSize=30,this.mIconMargin=-4,this.mFansCount=e,this.mIconUrlList=t,Ce(this.mIconUrlList)||this.setupViews()}setupViews(){this.style={height:this.mIconSize,flexDirection:"row-reverse",alignItems:"center"},this.mFansCountView=new TKText,this.mFansCountView.style={height:this.mIconSize,borderRadius:this.mIconSize/2,backgroundColor:"#00000054",fontSize:9,paddingHorizontal:9,includeFontPadding:!1,textLineClamp:1,textAlign:"center",color:"#FFFFFF",marginLeft:this.mIconMargin},this.mFansCountView.setText(this.mFansCount),this.appendChild(this.mFansCountView);for(let t=this.mIconUrlList.length-1;t>=0;t--){let e=this.mIconUrlList[t],i=this.createIconImage(0!=t,e);this.appendChild(i)}}createIconImage(t,e){let i=new TKImage;return i.style={width:this.mIconSize,height:this.mIconSize,borderRadius:this.mIconSize/2,marginLeft:t?this.mIconMargin:0},i.setSrc(e),i}}class Kn extends TKView{constructor(t,e){super(),this.vm=t,this.mLiveCutCardModel=e,this.setupViews()}static newInstance(t){if(Ce(t))return null;let e=t.getLiveCutRoomInfo();if(Ce(e))return null;let i=an.newLiveCutInstance(t.callerContext.adInfo,e);return Ce(i)?null:new Kn(t,i)}setupViews(){this.style={height:36,width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingLeft:16,paddingRight:13},this.addAdClickEvent(this,t.CARD_BLANK_AREA_CLICK,2),this.mAuthorInfoView=new kn(this.createAuthorInfoVM()),this.addAdClickEvent(this.mAuthorInfoView,t.CARD_ICON_CLICK,2),this.appendChild(this.mAuthorInfoView),this.mFansIconListView=new Bn(this.mLiveCutCardModel.watchUserIcons,this.mLiveCutCardModel.watchCount),this.addAdClickEvent(this.mFansIconListView,t.ONLINE_AUDIENCE_NUM,2),this.appendChild(this.mFansIconListView)}createAuthorInfoVM(){let t=new Rn;return t.fans=this.mLiveCutCardModel.liveStatDataDesc,t.isLiving=!0,t.name=this.mLiveCutCardModel.name,t.iconUrl=this.mLiveCutCardModel.iconUrl,t}addAdClickEvent(e,i,n){if(Ce(e))return;let s=Qe.createVideoCommonInstance(this.vm.callerContext.adStyle,this.vm.callerContext.adInfo);e.addEventListener("tap",(t=>{this.vm.convert(n,{x:t.position.rawX,y:t.position.rawY},i,s)})),Wt(this.vm.callerContext.adInfo)&&Nt(e,(()=>{this.vm.convert(n,{x:0,y:0},t.CARD_SWIPE_CONVERT,s)}))}}class En extends TKView{constructor(t,e,i,n="#30303099",s="#FFFFFF",a){super(),this.adInfo=t,this.isVertical=0==e,this.backgroundColor=n,this.color=s,this.shadow=a,this.containerWidth=i,this.setupView(),this.setupData()}setupView(){this.style={opacity:.6,flexDirection:"column",backgroundColor:this.backgroundColor,borderRadius:4,padding:10};let t=this.style.width;if("number"==typeof t)this.containerWidth=t;else if("string"==typeof t)if(isNaN(Number(t))){if("%"!=t.slice(-1))return;this.containerWidth*=Number(t.slice(0,-1))/100}else this.containerWidth=Number(t);if(this.addEventListener("tap",(()=>{})),this.appInfoLabel=this.createLabel(this.color),this.isVertical&&(this.appInfoLabel.style={flexShrink:1,textLineClamp:1,textOverflow:"ellipsis"},this.appInfoLabel.text=this.appendNameText(""),this.appInfoLabel.text=this.appendDeveloperText(this.appInfoLabel.text),me(this.appInfoLabel.text)&&Le.supportMinimumTKVersion("5.0.0")))try{this.appInfoLabel.measureForText(this.appInfoLabel.text,this.containerWidth,2).startIndex>1&&(this.appendChild(this.appInfoLabel),this.isTooLong=!0)}catch(e){console.error("ignore"+new Error(e).stack)}this.otherLabel=this.createLabel(this.color),this.otherLabel.style={marginRight:10},this.appendChild(this.otherLabel),me(this.shadow)&&(this.otherLabel.style={shadow:this.shadow})}createLabel(t){let e=new TKText;return e.style={color:t,fontSize:10,textLineHeight:16},e}setupData(){let t="";if(this.isVertical?(this.isTooLong||(t=this.appendNameText(t),t=this.appendDeveloperText(t)),t=this.appendRecordText(t)):(t=this.appendNameText(t),t=this.appendDeveloperText(t),t=this.appendRecordText(t)),Le.supportMinimumTKVersion("4.0.5")?me(this.adInfo.downloadSafeInfo.appVersion)&&(t+="| 版本 "+this.adInfo.downloadSafeInfo.appVersion):me(this.adInfo.adBaseInfo.appVersion)&&(t+="版本 "+this.adInfo.adBaseInfo.appVersion),Ce(this.adInfo.downloadSafeInfo.introductionInfoUrl)&&Ce(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&Ce(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.span=new TKSpan,!Ce(this.adInfo.downloadSafeInfo.introductionInfoUrl)){const e=t.length;t+="功能";const i=t.length;Ce(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&Ce(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.introductionClickSpanItem=new TKSpanItem,this.introductionClickSpanItem.spanType="click",this.introductionClickSpanItem.start=e,this.introductionClickSpanItem.end=i,this.introductionClickSpanItem.color=this.color,this.introductionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.introductionInfoUrl,"功能介绍")})),this.span.addSpan(this.introductionClickSpanItem)}if(!Ce(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)){const e=t.length;t+="权限";const i=t.length;Ce(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.permissionClickSpanItem=new TKSpanItem,this.permissionClickSpanItem.spanType="click",this.permissionClickSpanItem.start=e,this.permissionClickSpanItem.end=i,this.permissionClickSpanItem.color=this.color,this.permissionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPermissionInfoUrl,"权限信息")})),this.span.addSpan(this.permissionClickSpanItem)}if(!Ce(this.adInfo.downloadSafeInfo.appPrivacyUrl)){const e=t.length;t+="隐私";const i=t.length;t+=" ",this.privacyClickSpanItem=new TKSpanItem,this.privacyClickSpanItem.spanType="click",this.privacyClickSpanItem.start=e,this.privacyClickSpanItem.end=i,this.privacyClickSpanItem.color=this.color,this.privacyClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPrivacyUrl,"隐私政策")})),this.span.addSpan(this.privacyClickSpanItem)}this.otherLabel.setSpan(t,this.span)}appendNameText(t){return Le.supportMinimumTKVersion("4.0.5")?me(this.adInfo.downloadSafeInfo.appName)&&(t+=this.adInfo.downloadSafeInfo.appName+" "):me(this.adInfo.adBaseInfo.appName)&&(t+=this.adInfo.adBaseInfo.appName+" "),t}appendDeveloperText(t){return Le.supportMinimumTKVersion("4.0.5")?me(this.adInfo.downloadSafeInfo.corporationName)&&(t+=this.adInfo.downloadSafeInfo.corporationName+" "):me(this.adInfo.adBaseInfo.corporationName)&&(t+=this.adInfo.adBaseInfo.corporationName+" "),t}appendRecordText(t){return Le.supportMinimumTKVersion("4.0.5")&&me(this.adInfo.downloadSafeInfo.recordNumber)&&(t+=this.adInfo.downloadSafeInfo.recordNumber+" "),t}}class Pn extends TKView{constructor(){super(),this.style={alignItems:"center",justifyContent:"center"},this.imageView=new TKImage,this.appendChild(this.imageView)}setImageSize(t){this.imageView.style={width:t.width,height:t.height}}setImageSrc(t){Ve(this.imageView,t)}setImageSrcAndSize(t,e){this.setImageSize(e),this.setImageSrc(t)}configImage(t){t&&t(this.imageView)}}class On extends TKView{constructor(){super(),this.style={height:28,bottomLeftRadius:14,topLeftRadius:14,backgroundColor:"#30303099",flexDirection:"row",alignItems:"center"};const t=new TKImage;t.style={marginLeft:5,width:18,height:18},t.setSrc("image/ksad-video-top-bar/icon_ksad_gift_small.png"),this.appendChild(t);const e=new TKText;e.style={color:"#FFFFFF",fontSize:14,marginLeft:4,marginRight:8},e.setText("观看完视频可获得奖励"),this.appendChild(e),this.addEventListener("tap",(()=>{}))}}const Mn=28;class Nn extends TKView{constructor(t){if(super(),this.callActionTimer=0,this.hasShowCallBtn=!1,this.closeTimer=0,this.hasShowCloseBtn=!1,this.expcetedHeight=44,this.playEndCloseHadDelayShow=!1,this.isFinishAdvance=!1,this.vm=t,this.hasReward=!1,this.btnMargin=this.vm.isDeepRewardTask()?8:12,this.currentTime=0,this.actionState=-1,this.style={position:"absolute",top:0,left:0,right:0,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.topBarContainer=new TKView,this.topBarContainer.style={width:"100%",height:44,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.appendChild(this.topBarContainer),this.leftContainer=new TKView,this.leftContainer.style={height:Mn,marginLeft:16-this.btnMargin/2,alignItems:"center",justifyContent:"center",flexDirection:"row"},this.topBarContainer.appendChild(this.leftContainer),this.rightContainer=this.getRightContainer(),this.topBarContainer.appendChild(this.rightContainer),this.videoDuration=this.vm.getVideoDuration(),this.vm.isRewardVideo()){let t=this.vm.getSkipConfirmSwitch();this.skipNeedPromopt=t,this.rewardSecond=this.vm.getRewardTime(),this.skipSecond=Math.min(this.vm.getSkipShowTime(),this.rewardSecond),this.leftTime=this.rewardSecond}else this.skipNeedPromopt=!1,this.skipSecond=this.vm.getSkipShowTime(),K.isOriginLiveAd(this.vm.adInfo)?this.rewardSecond=30:this.rewardSecond=this.videoDuration,this.leftTime=this.rewardSecond;if(Le.supportMinimumVersion("3.3.21","3.3.28")){let t=null,e=this.vm.isShowPrivacy(),i="flex-end";0!=this.vm.screenOrientation&&e?(t=new TKView,t.style={width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},i="flex-start",this.appendChild(t)):t=this;let n=!1;if(e){this.vm.configInfo.abConfig.reduceDownloadVisibility&&(this.style={gradientBgColor:"-90,#00000030,#00000000"});const e=0==this.vm.screenOrientation?this.vm.containerLimit.width-62:154,i=this.vm.configInfo.abConfig.reduceDownloadVisibility?"#FFFFFF00":"#30303099";this.privacyView=new En(this.vm.adInfo,this.vm.screenOrientation,e,i,"#FFFFFF","1 1 1 #00000030"),this.privacyView.style={alignSelf:"stretch",marginTop:10},0==this.vm.screenOrientation?(this.privacyView.style={marginLeft:16,marginRight:16,flexGrow:1},this.expcetedHeight+=78):(this.privacyView.style={marginLeft:16,width:200},this.expcetedHeight+=114,n=!0),t.appendChild(this.privacyView),this.privacyView.clickCallback=(t,e)=>{this.vm.handleOpenURL(t,e)}}this.getHasGuideBar()&&(this.guideBar=new On,this.guideBar.style={alignSelf:i,marginTop:10},t.appendChild(this.guideBar),n||(this.expcetedHeight+=38))}yi(this.vm,this.vm.$attrsPath.isMuted,(t=>{this.setMuted(t)})),yi(this.vm,this.vm.$attrsPath.playFailed,(t=>{t&&this.playFailed()})),yi(this.vm,this.vm.$attrsPath.playFinished,(t=>{t&&this.finishPlay()})),yi(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{t&&this.countDown(t)})),yi(this.vm,this.vm.$attrsPath.hasGetDeepGift,(t=>{t&&this.getDeepReward(t)})),yi(this.vm,this.vm.$attrsPath.hasInstallTargetApp,(t=>{t&&!this.vm.isCovertTask()&&(this.updateRewardState(!0),this.updateActionBarState(4,!0))})),yi(this.vm,this.vm.$attrsPath.hasShowPlayend,(t=>{t&&(this.vm.isCovertTask()&&this.vm.giveRewardTime>0&&this.updateRewardState(!0),this.updateActionBarState(4))})),Oe().on(s,(t=>{this.setMuted(t.muted),this.vm.isMuted=t.muted})),1!=this.vm.topbarModelType&&this.setupAction()}setupAction(){this.topBarContainer.addEventListener("tap",(e=>{this.vm.convertForOtherArea(e,4==this.actionState?2:3,pe(e,this.topBarContainer),t.CARD_PAGE_CLICK)})),this.vm.isSlideClick()&&Nt(this.topBarContainer,(()=>{this.vm.convertForOtherArea(null,4==this.actionState?2:3,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}shouldShowNormalCallBtn(){return!0}handleCallImpressionWhenPlay(){this.callImpressionWhenPlayCalled||(this.callImpressionWhenPlayCalled=!0,this.vm.handleCallImpressionOnPlay())}updateActionBarStateInner(t,e=!1){}updateActionBarState(t,e=!1){if(!e&&t<=this.actionState)return;4==t&&this.guideBar&&this.guideBar.setVisibility("hidden"),this.actionState=t,this.leftContainer.removeAll(),this.rightContainer.removeAll(),this.updateActionBarStateInner(t,e);let i=this;if(4==this.actionState)clearTimeout(this.callActionTimer),this.closeBtn&&(2==this.vm.needShowPlayEndCloseBtn?this.hidePlayEndCloseBtn():this.vm.isDelayShowEndClose()&&!this.playEndCloseHadDelayShow?(this.hidePlayEndCloseBtn(),0==this.closeTimer&&(this.closeTimer=setTimeout((()=>{this.playEndCloseHadDelayShow=!0,this.showPlayEndCloseBtn()}),1e3*this.vm.getCloseDelaySeconds()))):this.showPlayEndCloseBtn(),this.vm.getPlayEndCallDescription&&this.vm.handleCallImpressionOnFinish());else if(this.callContainer&&this.shouldShowNormalCallBtn()){const t=this.vm.getPlayDetailCallDescription(),e=this.vm.getPlayDetailCallBtnShowTime();t&&(this.hasShowCallBtn||(0==e?this.hasShowCallBtn=!0:this.callActionTimer||(this.callActionTimer=setTimeout((()=>{i.callContainer.appendChild(i.getCallBtn()),i.callLabel.setText(t),i.layout(),i.handleCallImpressionWhenPlay(),i.hasShowCallBtn=!0}),1e3*e))),this.hasShowCallBtn&&(this.callContainer.removeAll(),this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t),this.handleCallImpressionWhenPlay()))}this.layout()}updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+""),this.layout())}showPlayEndCloseBtn(){this.closeBtn&&!this.hasShowCloseBtn&&(this.closeBtn.style={display:"flex"},this.hasShowCloseBtn=!0,Le.isAndroid()||this.layout())}hidePlayEndCloseBtn(){this.closeBtn&&(this.closeBtn.style={display:"none"})}updateRewardState(t){this.hasReward=t&&this.vm.isRewardVideo(),this.hasReward&&this.vm&&this.vm.impressionCheckResult&&this.vm.handleHasGift()}getHasGuideBar(){return!1}countDown(t){var e,i,n,s,a,o;t<this.currentTime||this.vm.isDeepRewardTask()&&this.hasDeepReward||(this.currentTime=t,t=Math.floor(t),this.leftTime=this.rewardSecond-t<1?1:this.rewardSecond-t,Le.supportMinimumTKVersion("5.0.1")&&this.vm.isNeedCheck&&2==this.vm.getRealAdStyle()&&(this.vm.isNeedSeverCheck=this.isNeedSeverCheck(),this.callBackAdvanceMs=(null===(i=null===(e=this.vm.adInfo.adRewardInfo)||void 0===e?void 0:e.callBackStrategyInfo)||void 0===i?void 0:i.rewardAdvanceSwitch)?(null===(s=null===(n=this.vm.adInfo.adRewardInfo)||void 0===n?void 0:n.callBackStrategyInfo)||void 0===s?void 0:s.callBackAdvanceMs)/1e3:0,t>=this.rewardSecond-this.vm.giveRewardTime-this.callBackAdvanceMs&&(null===(o=null===(a=this.vm.adInfo.adRewardInfo)||void 0===a?void 0:a.callBackStrategyInfo)||void 0===o?void 0:o.rewardAdvanceSwitch)&&!this.isFinishAdvance&&this.vm.impressionCheckResult&&this.vm.isNeedCheck&&this.vm.adInfo.adConversionInfo.callbackUrlInfo&&(this.vm.isNeedSeverCheck?(this.vm.severCheckState=1,this.secverCheck()):this.updateRewardState(!0),this.isFinishAdvance=!0)),t>=this.rewardSecond-this.vm.giveRewardTime?(this.updateRewardState(!0),this.updateActionBarState(2)):(this.updateCountDownText(),t>=this.skipSecond?this.updateActionBarState(1):this.updateActionBarState(0)))}isNeedSeverCheck(){var t,e,i,n,s,a;return(null===(e=null===(t=this.vm.adInfo.adRewardInfo)||void 0===t?void 0:t.callBackStrategyInfo)||void 0===e?void 0:e.serverCheckSwitch)&&(null===(n=null===(i=this.vm.adInfo.adRewardInfo)||void 0===i?void 0:i.callBackStrategyInfo)||void 0===n?void 0:n.callBackAdvanceMs)>0&&(null===(a=null===(s=this.vm.adInfo.adRewardInfo)||void 0===s?void 0:s.callBackStrategyInfo)||void 0===a?void 0:a.rewardAdvanceSwitch)}secverCheck(){if(Le.supportMinimumTKVersion("4.0.9")){const s=new TKNetwork;s.isAddCommonParameters=1,s.method="POST",s.url="/rest/e/v3/open/checkReward";try{e=2,i=this.vm.adInfo,Ge({category:"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_reward_check_result",primaryKey:"web_log",type:"EXECUTION_BIZ_TIME",msg:{check_type:e,request_state:1,creative_id:i.adBaseInfo.creativeId,enviType:1}});let a=JSON.parse(this.vm.adInfo.adConversionInfo.callbackUrlInfo);a.checkType=2;const o={callbackUrlInfo:JSON.stringify(a),impInfo:[{posId:this.vm.posId,adNum:1,adStyle:2}]};try{var t=JSON.parse(JSON.stringify(this.vm.adInfo.serverExt));Ce(t)||(delete t._tkmvvm_observed,delete t.nativeID,o.serverExt=t)}catch(n){}s.params=o;const r=oe();s.request(((t,e)=>{console.log("[caijie] tknetwork  response "+t+" error "+e);const i=oe()-r;if(!e)try{const e=JSON.parse(t).data,n=JSON.parse(e);1==n.result?(this.updateRewardState(!0),this.vm.severCheckState=1):this.vm.severCheckState=2,function(t,e,i,n,s){Ge({category:"ad_client_apm_log",biz:"AD_REWARD",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_reward_check_result",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:{check_type:t,request_state:2,creative_id:e.adBaseInfo.creativeId,enviType:1,data_load_interval_duration_ms:i,message:s||"",code:n}})}(2,this.vm.adInfo,i,n.result,n.errorMsg)}catch(n){}}))}catch(n){}}var e,i}getDeepReward(t){this.vm.isDeepRewardTask()&&(this.hasDeepReward=t,4==this.actionState?(this.updateCountDownText(),this.layout()):this.updateActionBarState(3))}finishPlay(){this.updateRewardState(!0),this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!1)}playFailed(){this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!0)}setMuted(t){this.soundBtn&&(t?this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_mute.png"):this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_sound.png"))}hasFeedbackBtn(){return!1}getRightContainer(){let t=new TKView,e={height:Mn,marginRight:16-this.btnMargin/2,alignItems:"center",flexDirection:"row",justifyContent:"center"};return t.style=e,t}getCallContainer(){let t=new TKView;return t.style={height:"100%",alignItems:"center",justifyContent:"center",flexDirection:"row"},t.enabled=!0,this.callContainer=t,t}getSoundBtn(){this.soundBtn=new Pn,this.soundBtn.setImageSize({width:22,height:22});let t={width:Mn,height:Mn,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,backgroundColor:"#30303099"};return this.soundBtn.style=t,this.setMuted(this.vm.isMuted),this.soundBtn.addEventListener("tap",(t=>{this.vm.handleMuteChange(!this.vm.isMuted),this.setMuted(this.vm.isMuted)})),this.soundBtn}getSkipBtn(){let t=new Pn,e={height:Mn,borderRadius:14,backgroundColor:"#30303099",marginRight:this.btnMargin/2,marginLeft:this.btnMargin/2};if(t.style=e,this.vm.getSkipTips()){t.style={paddingLeft:12,paddingRight:12};let e=new TKText;e.style={fontSize:14,color:"#FFFFFF"},e.setText(this.vm.getSkipTips()),t.appendChild(e)}else t.style={width:Mn},1==this.vm.getSkipType()?t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_skip.png",{width:Mn,height:Mn}):t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12});return t.addEventListener("tap",(t=>{this.onSkipClick()})),this.skipBtn=t,t}onSkipClick(){let t=this.skipNeedPromopt&&(this.vm.isDeepRewardTask()?!this.hasDeepReward:!this.hasReward),e=this.vm.isRewardVideo();console.log("jky topbar view onSkipClick showPromopt: "+t),this.vm.handleSkip(t,e,this.skipSecond)}getFeedbackBtn(){this.feedbackBtn=new TKView,this.feedbackBtn.style={height:Mn,borderRadius:14,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,backgroundColor:"30303099",paddingLeft:8,paddingRight:8,alignItems:"center",justifyContent:"center"};let t=new TKText;return t.style={fontSize:14,color:"#FFFFFF"},t.setText("反馈"),this.feedbackBtn.appendChild(t),this.feedbackBtn.addEventListener("tap",(()=>{this.vm.handleOpenFeedback()})),this.feedbackBtn}getCloseBtn(){let t=new Pn,e={width:Mn,height:Mn};return e.marginLeft=this.btnMargin/2,e.marginRight=this.btnMargin/2,e.borderRadius=14,e.backgroundColor="#30303099",t.style=e,t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12}),t.addEventListener("tap",(()=>{this.vm.handleClose()})),this.closeBtn=t,yi(this.vm,this.vm.$attrsPath.needShowPlayEndCloseBtn,(t=>{let e=this.vm.getCloseDelaySeconds();console.log("jky topbar view onBind needShowPlayEndCloseBtn: "+t+", closeBtnDelayTime: "+e),1==t&&e<=0&&this.showPlayEndCloseBtn()})),t}getGiftBtn(t=!0){let e=new Pn;return e.setImageSize({width:Mn,height:Mn}),e.style={width:Mn,height:Mn,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},t&&e.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift.png"),e.addEventListener("tap",(t=>{this.vm.handleGiftClick(t)})),this.giftBtn=e,e}getCountDownLabel(){let t=new TKText;return t.style={color:"#FFFFFF",fontSize:14,textAlign:"center",height:"100%",textLineClamp:1,minimumTextScaleFactor:.5},t}getCountDownHasBg(){return!0}getCountDownBtn(){return this.countDownBtn=new TKView,this.countDownBtn.style={height:Mn,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},this.getCountDownHasBg()&&(this.countDownBtn.style={borderRadius:14,backgroundColor:"#30303099"}),this.countDownBtn.style={width:Mn},this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={width:"100%"},this.countDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.countDownBtn}getGiftCountDownBtn(){this.giftCountDownBtn=new TKView,this.giftCountDownBtn.style={marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,height:Mn,borderRadius:14,backgroundColor:"#30303099"},this.giftCountDownBtn.addEventListener("tap",(t=>{this.vm.handleGiftClick(t)}));let t=this.getGiftBtn(!1);return t.style={marginTop:2,marginLeft:2,width:24,height:24,borderRadius:12,backgroundColor:"#FE3666"},t.setImageSize({width:21,height:21}),t.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift_new.png"),this.giftCountDownBtn.appendChild(t),this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={marginTop:-26,marginLeft:26+this.btnMargin/2,marginRight:this.btnMargin},this.giftCountDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.giftCountDownBtn}getCallBtn(){this.callBtn=new TKView,this.callBtn.setBackgroundColor("#30303099"),this.callBtn.style={paddingLeft:10,paddingRight:10,height:Mn,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.callBtn.addEventListener("tap",(t=>{this.vm.handleCallClick(4==this.actionState,t)})),this.callLabel=new TKText,this.callLabel.nativeID="topBarCallLabel",this.callLabel.style={fontSize:14,color:"#FFFFFF"},this.callBtn.appendChild(this.callLabel);let t=new TKImage;return t.style={width:6,height:11,marginLeft:6},t.setSrc(this.vm.getResourceRoot()+"icon_ksad_white_right_arrow.png"),this.callBtn.appendChild(t),this.callBtn}}class Hn extends Nn{updateActionBarStateInner(t,e=!1){switch(t){case 0:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer());break;case 1:this.leftContainer.appendChild(this.getCountDownBtn()),this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 2:case 3:this.leftContainer.appendChild(this.getSoundBtn()),this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getSkipBtn());break;case 4:{this.rightContainer.appendChild(this.getCallContainer()),this.rightContainer.appendChild(this.getCloseBtn());const t=this.vm.getPlayEndCallDescription();t&&(this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t));break}}}}class Wn extends TKView{}class zn extends TKView{constructor(t){super(),this.columnNum=3,this.traveViews=[],this.iconImages=[],this.iconDefaultSize={width:150,height:150},this.hasAnimedView=new Array(9),this.currentIntervalTime=0,this.animedCount=0,this.timer=0,this.hasShow=!1,this.vm=t,this.pendantRowDelay=0,this.rowNum=this.vm.getRowNum(),this.vm.checkParam()&&(this.style={width:"100%",height:"100%"},this.throughHitTest=!0,this.createTravelView(),this.createRedPacketInTravel())}createTravelView(){this.traveViews=[];for(let t=0;t<this.columnNum;t++){let e=new TKView;e.style={width:this.iconDefaultSize.width,height:this.vm.containerSize.height+this.iconDefaultSize.height+30,position:"absolute",left:this.getLeftMagin(t),alignItems:"center",top:-this.iconDefaultSize.height},e.throughHitTest=!0,this.appendChild(e),this.traveViews.push(e)}}getLeftMagin(t){let e=this.vm.containerSize.width/this.columnNum,i=this.iconDefaultSize.width-e;return 0==t?0:1==t?e-i/2:this.vm.containerSize.width-this.iconDefaultSize.width}createRedPacketInTravel(){this.iconImages=[];for(let t=0;t<this.columnNum;t++)for(let e=0;e<this.rowNum;e++){let i=this.createIconImage(e,t);this.iconImages[t*this.rowNum+e]=i,this.traveViews[t].appendChild(i)}}createIconImage(e,i){let n=new TKImage,s=this.vm.getScaleType(e,i);if(n.style={width:this.iconDefaultSize.width*s,height:this.iconDefaultSize.height*s,position:"absolute",top:0},this.vm.isCanClick()){let e=this;n.addEventListener("tap",(i=>{const s=pe(i,n);this.vm.convert(2,s,t.FALL_ICON_CLICK),e.hide(!0)}))}else n.addEventListener("tap",(t=>{}));return n.setSrc(this.vm.getRedPacketIconUrl()),n}createIconAnimation(t,e){const i=1e3*this.vm.getShowTime(t),n=new TKKeyframeAnimation;let s=this;n.timingFunction="linear",n.setAnimations([()=>(e.style={top:0},0),()=>(e.style={top:s.vm.containerSize.height+s.iconDefaultSize.height+30},1)]),t==this.vm.getLastAnimIconIndex()&&n.on("end",(()=>{s.hide()})),n.duration=i;let a="translateAnimation"+t.toString();if(e.addAnimation(n,a),this.vm.isCanShowRotateAnim(t)&&setTimeout((()=>{this.startRotateAnimation(e)}),this.vm.getRotateAnimDelayTime(t)),2==this.vm.getAnimType()){const t=new TKKeyframeAnimation;t.timingFunction="ease-in",t.setAnimations([()=>(e.style={opacity:1},.5),()=>(e.style={opacity:.5},.75),()=>(e.style={opacity:0},1)]),t.duration=.6*i,e.addAnimation(t,"opacityAnimation")}}startRotateAnimation(t){const e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={transform:{rotate:{z:0}}},0),()=>(t.style={transform:{rotate:{z:-25}}},.2),()=>(t.style={transform:{rotate:{z:25}}},.4),()=>(t.style={transform:{rotate:{z:-21}}},.6),()=>(t.style={transform:{rotate:{z:21}}},.8),()=>(t.style={transform:{rotate:{z:0}}},1)]),e.duration=1500,t.addAnimation(e,"rotateAnim")}show(){this.vm.isParamValid()&&(this.hasShow||(this.hasShow=!0,this.vm.reportRedPacketImpression(),this.showRedPacketIconWithAnim()))}hide(t=!1){const e=this;setTimeout((()=>{e.removeAllAnimation(),e.removeAll(),e.vm.dismissCallbackOnlyOnce()}),t?100:0)}showRedPacketIconWithAnim(){this.tryShowAnim(),this.timer=setInterval((()=>{this.currentIntervalTime+=this.vm.getAnimMinTime(),this.tryShowAnim()}),this.vm.getAnimMinTime())}tryShowAnim(){if(this.animedCount!=this.vm.getAnimedCount()){for(let t=0;t<this.vm.getAnimedCount();t++)if(!this.hasAnimedView[t]&&this.currentIntervalTime==this.vm.getIconDelayTime(t)){this.hasAnimedView[t]=!0;let e=this.iconImages[t];this.createIconAnimation(t,e),this.animedCount=this.animedCount+1}}else this.timer&&clearInterval(this.timer)}}class Un extends TKView{constructor(t){super(),this.animationAllowed=!0,this.vm=t,this.setupView(),this.setupData(),this.setupAction(),this.startShowAnimation()}setupView(){this.throughHitTest=!0,this.style={alignItems:"flex-start",width:this.vm.getPendantSize().width,height:this.vm.getPendantSize().height},this.contentView=new TKView,this.contentView.style={justifyContent:"center",alignItems:"center"},this.appendChild(this.contentView),this.pendantTitle=new TKText,this.pendantTitle.style={top:0,marginLeft:this.vm.getPendantTitleMarginLR(),marginRight:this.vm.getPendantTitleMarginLR(),fontSize:this.vm.getPendantTitleFontSize(),color:"#FFFFFF",fontWeight:"bold",textAlign:"center",textLineHeight:20,opacity:0},this.contentView.appendChild(this.pendantTitle),this.pendantImage=new TKImage,this.pendantImage.style={width:this.vm.getPendantImageWH(),height:this.vm.getPendantImageWH(),opacity:0},this.contentView.appendChild(this.pendantImage),this.guidanceImage=new TKImage,this.guidanceImage.style={marginTop:this.vm.getGuidanceImageMarginTop(),marginLeft:this.vm.getGuidanceImageMarginLeft(),height:this.vm.getGuidanceImageWH(),width:this.vm.getGuidanceImageWH(),opacity:0},this.appendChild(this.guidanceImage)}setupData(){this.pendantTitle.setText(this.vm.getPendantTitleText()),this.pendantImage.setSrc(this.vm.getPendantImageUrl()),Ve(this.guidanceImage,"icon_ksad_hand_touch_guide.png")}setupAction(){const t=this;this.pendantImage&&this.vm.enableClickPendant()&&this.pendantImage.addEventListener("tap",(e=>{t.startHideAnimation(),this.vm.enableShowPendantClickAnim()?t.startClickAnimShowAnimation(e):t.vm.reportPendantClick(e)}))}startShowAnimation(){const t=this;this.startPendantImageShowAnimation((()=>{setTimeout((()=>{t.startPendantTitleShowAnimation((()=>{t.startGuidanceImageShowAnimation()}))}),500)})),this.vm.reportPendantImpression()}startPendantImageShowAnimation(t){const e=this,i=new TKKeyframeAnimation;i.setAnimations([()=>(e.pendantImage.style={transform:{scale:.6},opacity:0},0),()=>(e.pendantImage.style={transform:{scale:1},opacity:1},.56),()=>(e.pendantImage.style={transform:{scale:.9}},.78),()=>(e.pendantImage.style={transform:{scale:1}},1)]),i.timingFunction="ease-out",i.duration=700,i.on("end",(()=>{t&&t()})),this.pendantImage.addAnimation(i,"pendantImageShowAnimation")}startPendantTitleShowAnimation(t){const e=this,i=new TKKeyframeAnimation;i.setAnimations([()=>(e.pendantTitle.style={top:10,opacity:0},0),()=>(e.pendantTitle.style={top:0,opacity:1},1)]),i.timingFunction="ease-out",i.duration=300,i.on("end",(()=>{t&&t()})),this.pendantTitle.addAnimation(i,"pendantTitleShowAnimation")}stopActionAnimation(){this.animationAllowed=!1,this.guidanceImage&&this.guidanceImage.removeAllAnimation()}startGuidanceImageShowAnimation(){if(!this.vm.enableShowGuidanceImage())return;if(!this.animationAllowed)return!1;const t=Li(this.guidanceImage,200,!0);this.guidanceImage.addAnimation(t,"guidanceImageShowAnimation");const e=this;t.on("end",(()=>{e.startGuidanceImageMoveAnimation()}))}restartGuidanceImageMoveAnimationIfNeeded(){this.vm.enableShowGuidanceImage()&&(this.guidanceImage.removeAllAnimation(),this.startGuidanceImageMoveAnimation())}startGuidanceImageMoveAnimation(){const t=this;let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.guidanceImage.style={transform:{translate:{x:0,y:0}}},.33),()=>(t.guidanceImage.style={transform:{translate:{x:10,y:10}}},.66),()=>(t.guidanceImage.style={transform:{translate:{x:0,y:0}}},1)]),e.duration=450,e.repeatCount=Number.MAX_SAFE_INTEGER,e.timingFunction="linear",this.guidanceImage.addAnimation(e,"guidanceImageMoveAnimation")}startHideAnimation(){this.startPendantImageHideAnimation();const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.addAnimation(e,"pendantHideAnimation")}startPendantImageHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.pendantImage.style={transform:{scale:.8}},1)]),e.timingFunction="ease-out",e.duration=300,this.pendantImage.addAnimation(e,"pendantImageHideAnimation")}createPendantClickAnimViewIfNeeded(t){this.vm.enableShowPendantClickAnim()&&(this.pendantClickAnimView=new zn(this.vm.pendantAnimViewModel),this.pendantClickAnimView.style={position:"absolute"},t.appendChild(this.pendantClickAnimView))}removePendantClickAnimViewIfNeeded(t){this.pendantClickAnimView&&t.removeChild(this.pendantClickAnimView)}startClickAnimShowAnimation(t){if(!this.pendantClickAnimView)return;this.pendantClickAnimView.show();const e=this;this.expireTimer=setTimeout((()=>{e.startClickAnimHideAnimation(),e.vm.reportPendantClick(t)}),this.vm.getPendantClickAnimDuration())}startClickAnimHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.pendantClickAnimView.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.pendantClickAnimView.addAnimation(e,"pendantClickAnimHideAnimation")}clearTimeoutIfConverted(){this.expireTimer&&clearTimeout(this.expireTimer)}}class Gn extends TKView{constructor(t,e){super(),this.vm=t,this.screenWidth=this.vm.callerContext.containerLimit.width,this.screenHeight=this.vm.callerContext.containerLimit.height,this.nextAnim=e,this.setupViews(),this.setupActions()}setupViews(){this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0},this.throughHitTest=!0,this.setupPreHeatView(),setTimeout((()=>{this.vm.enableCountDown()?this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleCountDownAnimation())}),Gn.NEO_PREHEAT_ANIMATION_SPEED):this.vm.isSplash()?this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleDisappearAnimation(Gn.SPLASH_PREHEAT_ANIMATION_SPEED))}),Gn.SPLASH_PREHEAT_ANIMATION_SPEED):this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleDisappearAnimation(Gn.INTERSTITIAL_PREHEAT_ANIMATION_SPEED))}),Gn.INTERSTITIAL_PREHEAT_ANIMATION_SPEED)}),200)}setupPreHeatView(){this.preHeatView=new TKView,this.preHeatView.throughHitTest=!0,this.preHeatView.style={width:"100%",height:"100%",top:0,alignSelf:"center",flexDirection:"column",alignItems:"center"},this.appendChild(this.preHeatView),this.preHeatBubbleRedPacketView=new TKView,this.preHeatBubbleRedPacketView.throughHitTest=!0,this.preHeatBubbleRedPacketView.style={position:"absolute",width:"100%",height:"100%",top:0,opacity:0},this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.preHeatRedPacketView=new TKView,this.preHeatRedPacketView.style={position:"absolute",width:this.screenAdaptate(270),height:this.screenAdaptate(270),top:(this.screenHeight-this.screenAdaptate(270)-38)/2,alignSelf:"center"},this.preHeatBubbleRedPacketView.appendChild(this.preHeatRedPacketView);let t=this.vm.getIndustryTopIcon();this.preHeatRedPacket=new TKImage,Ce(t)?(this.preHeatRedPacket.style={position:"absolute",width:this.screenAdaptate(132),height:this.screenAdaptate(132),top:this.screenAdaptate(69),alignSelf:"center"},Ve(this.preHeatRedPacket,"image/BubbleRainResources/icon_ksad_bubble_rain_red_packet.png"),this.preHeatRedPacketView.appendChild(this.preHeatRedPacket),this.setupSubView(Gn.LOGO_DISTANCE_WITHOUT_IP,Gn.NUMBER_DISTANCE_WITHOUT_IP)):(this.preHeatRedPacket.style={position:"absolute",width:this.screenAdaptate(132),height:this.screenAdaptate(172),top:this.screenAdaptate(46),alignSelf:"center"},Ve(this.preHeatRedPacket,t),this.preHeatRedPacketView.appendChild(this.preHeatRedPacket),this.setupSubView(Gn.LOGO_DISTANCE_WITH_IP,Gn.NUMBER_DISTANCE_WITH_IP)),this.preHeatBubble=new TKImage,this.preHeatBubble.style={position:"absolute",width:this.screenAdaptate(270),height:this.screenAdaptate(270),top:(this.screenHeight-this.screenAdaptate(270)-38)/2,alignSelf:"center"},Ve(this.preHeatBubble,"image/BubbleRainResources/icon_ksad_bubble_rain_bubble.png"),this.preHeatBubbleRedPacketView.appendChild(this.preHeatBubble),this.preHeatDescView=new TKView,this.preHeatDescView.style={position:"absolute",width:202,height:38,top:(this.screenHeight+this.screenAdaptate(270)-38)/2,alignItems:"center"},this.preHeatView.appendChild(this.preHeatDescView),this.preHeatDescTextBackground=new TKView,this.preHeatDescTextBackground.style={width:202,height:38,borderRadius:20,gradientBgColor:"270, #FFF9EB, #B8976A, #DBC3A7"},this.preHeatDescView.appendChild(this.preHeatDescTextBackground),this.preHeatDescText=new TKText,this.preHeatDescText.style={position:"absolute",width:198,height:34,top:2,fontSize:16,color:"#FFFFFF",textLineHeight:22,borderRadius:20,textAlign:"center",fontWeight:"500",shadow:"0 1 3 #00000025",backgroundColor:"#FC4118"};let e=this.vm.getBubbleActionDes();Ce(e)&&(e="立即开启大促"),this.preHeatDescText.text=e,this.preHeatDescView.appendChild(this.preHeatDescText)}setupSubView(t,e){let i=this.vm.getRedPacketIndustryIcon();Ce(i)&&(i=""),this.preHeatLogo=new TKImage,this.preHeatLogo.style={position:"absolute",width:this.screenAdaptate(86),height:this.screenAdaptate(38),top:this.screenAdaptate(147+t),left:this.screenAdaptate(94)},Se(this.preHeatLogo,i,500,(t=>{t||this.preHeatLogo.setVisibility("hidden")})),this.preHeatRedPacketView.appendChild(this.preHeatLogo),this.preHeatNumber3=new TKImage,this.preHeatNumber3.style={position:"absolute",width:this.screenAdaptate(24),height:this.screenAdaptate(34),top:this.screenAdaptate(146+e),left:this.screenAdaptate(122),opacity:0},Ve(this.preHeatNumber3,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number3.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber3),this.preHeatNumber2=new TKImage,this.preHeatNumber2.style={position:"absolute",width:this.screenAdaptate(24),height:this.screenAdaptate(34),top:this.screenAdaptate(146+e),left:this.screenAdaptate(123),opacity:0},Ve(this.preHeatNumber2,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number2.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber2),this.preHeatNumber1=new TKImage,this.preHeatNumber1.style={position:"absolute",width:this.screenAdaptate(14),height:this.screenAdaptate(35),top:this.screenAdaptate(146+e),left:this.screenAdaptate(127),opacity:0},Ve(this.preHeatNumber1,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number1.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber1)}setBubbleAppearAnimation(t,e){let i=new TKKeyframeAnimation;ce()?i.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:.13,translate:{x:0,y:154,z:0},rotate:{x:0,y:180,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]):i.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.037,y:.13},translate:{x:0,y:154,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),i.duration=400*e,i.timingFunction="0.0 0.0 0.0 1.0";let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.985,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),n.duration=200*e,n.timingFunction="0.0 0.0 0.56 1.0";let s=new TKKeyframeAnimation;s.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.985,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),s.duration=250*e,s.timingFunction="linear",s.on("end",t),n.on("end",(()=>{this.vm.isShowEnd||this.preHeatBubbleRedPacketView.addAnimation(s,"bubbleAppearAnimation3")})),i.on("end",(()=>{this.vm.isShowEnd||this.preHeatBubbleRedPacketView.addAnimation(n,"bubbleAppearAnimation2")})),this.preHeatBubbleRedPacketView.addAnimation(i,"bubbleAppearAnimation1")}setBubbleCountDownAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.preHeatLogo.style={opacity:1},.001),()=>(this.preHeatLogo.style={opacity:0},1)]),t.duration=500,t.timingFunction="0.0 0.0 0.38 0.99",this.preHeatLogo.addAnimation(t,"logoAnimation");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.preHeatNumber3.style={opacity:0},.001),()=>(this.preHeatNumber3.style={opacity:1},5/7),()=>(this.preHeatNumber3.style={opacity:0},1)]),e.duration=700,e.timingFunction="0.0 0.0 0.38 0.99";let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.preHeatNumber2.style={opacity:0},.001),()=>(this.preHeatNumber2.style={opacity:1},5/7),()=>(this.preHeatNumber2.style={opacity:0},1)]),i.duration=700,i.timingFunction="0.0 0.0 0.38 0.99";let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatNumber1.style={opacity:0},.001),()=>(this.preHeatNumber1.style={opacity:1},1)]),n.duration=500,n.timingFunction="0.0 0.0 0.38 0.99",n.on("end",(()=>{this.vm.isShowEnd||this.setBubbleDisappearAnimation(Gn.NEO_PREHEAT_ANIMATION_SPEED)})),i.on("end",(()=>{this.vm.isShowEnd||this.preHeatNumber1.addAnimation(n,"number1Animation")})),e.on("end",(()=>{this.vm.isShowEnd||this.preHeatNumber2.addAnimation(i,"number2Animation")})),this.preHeatNumber3.addAnimation(e,"number3Animation")}setBubbleDisappearAnimation(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.preHeatDescView.style={opacity:1},.001),()=>(this.preHeatDescView.style={opacity:0},1)]),e.duration=1e3*t,e.timingFunction="0.42 0.0 0.58 1.0",this.preHeatDescView.addAnimation(e,"buttonDisappearAnimation");let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.preHeatBubble.style={transform:{scale:1,translate:{y:0}},opacity:1},.001),()=>(this.preHeatBubble.style={transform:{scale:9.47,translate:{y:250}},opacity:0},1)]),i.duration=1e3*t,i.timingFunction="0.42 0.0 0.58 1.0",this.preHeatBubble.addAnimation(i,"bubbleDisappearAnimation");let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatRedPacketView.style={transform:{scale:1,translate:{y:0}}},.001),()=>(this.preHeatRedPacketView.style={transform:{scale:7.4,translate:{y:550}}},1)]),n.duration=1e3*t,n.timingFunction="0.42 0.0 0.58 1.0",this.preHeatRedPacketView.addAnimation(n,"redPacketEnlargeAnimation");let s=new TKKeyframeAnimation;s.setAnimations([()=>(this.preHeatRedPacketView.style={opacity:1},.001),()=>(this.preHeatRedPacketView.style={opacity:0},1)]),s.duration=1e3*t,s.on("end",(()=>{this.vm.isShowEnd||(this.nextAnim(),this.stopAllAnimation())})),this.preHeatRedPacketView.addAnimation(s,"redPacketDisappearAnimation")}setupActions(){let e=new b;e.template_show_type="bubble_id_click",this.preHeatDescText.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.BUBBLE_RAIN_CLICK,e)})),this.preHeatDescView.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.BUBBLE_RAIN_CLICK,e)})),this.preHeatBubble.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.BUBBLE_RAIN_CLICK,e)}))}stopAllAnimation(){this.preHeatBubbleRedPacketView&&this.preHeatBubbleRedPacketView.removeAllAnimation(),this.preHeatLogo&&this.preHeatLogo.removeAllAnimation(),this.preHeatNumber1&&this.preHeatNumber1.removeAllAnimation(),this.preHeatNumber2&&this.preHeatNumber2.removeAllAnimation(),this.preHeatNumber3&&this.preHeatNumber3.removeAllAnimation(),this.preHeatDescView&&this.preHeatDescView.removeAllAnimation(),this.preHeatBubble&&this.preHeatBubble.removeAllAnimation(),this.preHeatRedPacketView&&this.preHeatRedPacketView.removeAllAnimation(),this.removeAll()}screenAdaptate(t){return t*this.screenWidth/414}}Gn.LOGO_DISTANCE_WITH_IP=17,Gn.LOGO_DISTANCE_WITHOUT_IP=0,Gn.NUMBER_DISTANCE_WITH_IP=17,Gn.NUMBER_DISTANCE_WITHOUT_IP=0,Gn.SPLASH_PREHEAT_ANIMATION_SPEED=.5,Gn.NEO_PREHEAT_ANIMATION_SPEED=1,Gn.INTERSTITIAL_PREHEAT_ANIMATION_SPEED=1;class jn{getStartTime(){return this.startTime}setStartTime(t){this.startTime=t}}class Yn extends jn{constructor(t,e){super(),this.alpha=t,this.setStartTime(e)}getAplha(){return this.alpha}setAlpha(t){this.alpha=t}}class Xn extends jn{getAplha(){return this.alpha}setAlpha(t){this.alpha=t}getRotationZ(){return this.rotationZ}getRotationX(){return this.rotationX}getRotationY(){return this.rotationY}setRotationX(t){this.rotationX=t}setRotationY(t){this.rotationY=t}setRotationZ(t){this.rotationZ=t}getScaleX(){return this.scaleX}setScaleX(t){this.scaleX=t}getScaleY(){return this.scaleY}setScaleY(t){this.scaleY=t}getTranslationX(){return this.translationX}setTranslationX(t){this.translationX=t}getTranslationY(){return this.translationY}setTranslationY(t){this.translationY=t}toString(){return"{alpha :"+this.alpha+" + rotationX :"+this.rotationX+" + rotationY :"+this.rotationY+" + rotationZ :"+this.rotationZ+" + scaleX :"+this.scaleX+" + scaleY :"+this.scaleY+" + translationX :"+this.translationX+" + translationY :"+this.translationY+"}"}}class Jn extends jn{constructor(t,e,i,n){super(),this.rotationX=void 0,this.rotationY=void 0,this.rotationZ=t,this.rotationY=n,this.rotationX=i,this.setStartTime(e)}getRotationZ(){return this.rotationZ}getRotationX(){return this.rotationX}getRotationY(){return this.rotationY}setRotation(t){this.rotationZ=t}}class $n extends jn{constructor(t,e,i){super(),this.scaleX=t,this.scaleY=e,this.setStartTime(i)}getScaleX(){return this.scaleX}setScaleX(t){this.scaleX=t}getScaleY(){return this.scaleY}setScaleY(t){this.scaleY=t}}class Zn extends jn{constructor(t,e,i){super(),this.translationX=t,this.translationY=e,this.setStartTime(i)}getTranslationX(){return this.translationX}setTranslationX(t){this.translationX=t}getTranslationY(){return this.translationY}setTranslationY(t){this.translationY=t}}function qn(t,e){return t.getStartTime()-e.getStartTime()}function Qn(t,e,i,n,s){return((n-s)*t+(s-i)*e)/(n-i)}class ts{produceAnimationResult(t){t.sort(qn);let e=t.length;this.rotationInfoList=new Array,this.alphaInfoList=new Array,this.scaleInfoList=new Array,this.translationInfoList=new Array,this.animationResult=new Map,this.timestampSet=new Set;for(let o=0;o<e;o++)this.timestampSet.add(t[o].getStartTime()),t[o]instanceof Jn?this.rotationInfoList.push(t[o]):t[o]instanceof Yn?this.alphaInfoList.push(t[o]):t[o]instanceof $n?this.scaleInfoList.push(t[o]):t[o]instanceof Zn&&this.translationInfoList.push(t[o]),this.duration=t[o].getStartTime();let i=0,n=0,s=0,a=0;for(this.timestampSet.forEach((t=>{for(;i<this.alphaInfoList.length;){let e=this.alphaInfoList[i].getStartTime();if(!(e<=t)){if(i>0&&this.alphaInfoList[i-1].getStartTime()!=t){let n=this.alphaInfoList[i-1].getStartTime(),s=Qn(this.alphaInfoList[i-1].getAplha(),this.alphaInfoList[i].getAplha(),n,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setAlpha(s);else{let e=new Xn;e.setStartTime(t),e.setAlpha(s),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setAlpha(this.alphaInfoList[i].getAplha());else{let n=new Xn;n.setStartTime(t),n.setAlpha(this.alphaInfoList[i].getAplha()),this.animationResult.set(e,n)}i++}for(;s<this.rotationInfoList.length;){let e=this.rotationInfoList[s].getStartTime();if(!(e<=t)){if(s>0&&this.rotationInfoList[s-1].getStartTime()!=t){let i=this.rotationInfoList[s-1].getStartTime(),n=Qn(this.rotationInfoList[s-1].getRotationZ(),this.rotationInfoList[s].getRotationZ(),i,e,t),a=Qn(this.rotationInfoList[s-1].getRotationY(),this.rotationInfoList[s].getRotationY(),i,e,t),o=Qn(this.rotationInfoList[s-1].getRotationX(),this.rotationInfoList[s].getRotationX(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setRotationZ(n),this.animationResult.get(t).setRotationY(a),this.animationResult.get(t).setRotationX(o);else{let e=new Xn;e.setStartTime(t),e.setRotationZ(n),e.setRotationY(a),e.setRotationX(o),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setRotationZ(this.rotationInfoList[s].getRotationZ()),this.animationResult.get(e).setRotationY(this.rotationInfoList[s].getRotationY()),this.animationResult.get(e).setRotationX(this.rotationInfoList[s].getRotationX());else{let i=new Xn;i.setStartTime(t),i.setRotationZ(this.rotationInfoList[s].getRotationZ()),i.setRotationY(this.rotationInfoList[s].getRotationY()),i.setRotationX(this.rotationInfoList[s].getRotationX()),this.animationResult.set(e,i)}s++}for(;n<this.scaleInfoList.length;){let e=this.scaleInfoList[n].getStartTime();if(!(e<=t)){if(n>0&&this.scaleInfoList[n-1].getStartTime()!=t){let i=this.scaleInfoList[n-1].getStartTime(),s=Qn(this.scaleInfoList[n-1].getScaleX(),this.scaleInfoList[n].getScaleX(),i,e,t),a=Qn(this.scaleInfoList[n-1].getScaleY(),this.scaleInfoList[n].getScaleY(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setScaleX(s),this.animationResult.get(t).setScaleY(a);else{let e=new Xn;e.setStartTime(t),e.setScaleX(s),e.setScaleY(a),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setScaleX(this.scaleInfoList[n].getScaleX()),this.animationResult.get(e).setScaleY(this.scaleInfoList[n].getScaleY());else{let i=new Xn;i.setStartTime(t),i.setScaleX(this.scaleInfoList[n].getScaleX()),i.setScaleY(this.scaleInfoList[n].getScaleY()),this.animationResult.set(e,i)}n++}for(;a<this.translationInfoList.length;){let e=this.translationInfoList[a].getStartTime();if(!(e<=t)){if(a>0&&this.translationInfoList[a-1].getStartTime()!=t){let i=this.translationInfoList[a-1].getStartTime(),n=Qn(this.translationInfoList[a-1].getTranslationX(),this.translationInfoList[a].getTranslationX(),i,e,t),s=Qn(this.translationInfoList[a-1].getTranslationY(),this.translationInfoList[a].getTranslationY(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setTranslationX(n),this.animationResult.get(t).setTranslationY(s);else{let e=new Xn;e.setStartTime(t),e.setTranslationX(n),e.setTranslationY(s),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setTranslationX(this.translationInfoList[a].getTranslationX()),this.animationResult.get(e).setTranslationY(this.translationInfoList[a].getTranslationY());else{let t=new Xn;t.setStartTime(e),t.setTranslationX(this.translationInfoList[a].getTranslationX()),t.setTranslationY(this.translationInfoList[a].getTranslationY()),this.animationResult.set(e,t)}a++}}));i<this.alphaInfoList.length;){let t=this.alphaInfoList[i].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setAlpha(this.alphaInfoList[i].getAplha());else{let e=new Xn;e.setStartTime(t),e.setAlpha(this.alphaInfoList[i].getAplha()),this.animationResult.set(t,e)}i++}for(;s<this.rotationInfoList.length;){let t=this.rotationInfoList[s].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setRotationZ(this.rotationInfoList[s].getRotationZ()),this.animationResult.get(t).setRotationY(this.rotationInfoList[s].getRotationY()),this.animationResult.get(t).setRotationX(this.rotationInfoList[s].getRotationX());else{let e=new Xn;e.setRotationZ(this.rotationInfoList[s].getRotationZ()),e.setRotationY(this.rotationInfoList[s].getRotationY()),e.setRotationX(this.rotationInfoList[s].getRotationX()),this.animationResult.set(t,e)}s++}for(;n<this.scaleInfoList.length;){let t=this.scaleInfoList[n].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setScaleX(this.scaleInfoList[n].getScaleX()),this.animationResult.get(t).setScaleY(this.scaleInfoList[n].getScaleY());else{let e=new Xn;e.setScaleX(this.scaleInfoList[n].getScaleX()),e.setScaleY(this.scaleInfoList[n].getScaleY()),this.animationResult.set(t,e)}n++}for(;a<this.translationInfoList.length;){let t=this.translationInfoList[a].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setTranslationX(this.translationInfoList[a].getTranslationX()),this.animationResult.get(t).setTranslationY(this.translationInfoList[a].getTranslationY());else{let e=new Xn;e.setTranslationX(this.translationInfoList[a].getTranslationX()),e.setTranslationY(this.translationInfoList[a].getTranslationY()),this.animationResult.set(t,e)}a++}this.animationFiltering()}animationFiltering(){let t=-1;this.timestampSet.forEach((e=>{if(-1!=t){let i=this.animationResult.get(e);this.isInvaildNumber(i.getAplha())&&i.setAlpha(this.animationResult.get(t).getAplha()),this.isInvaildNumber(i.getRotationZ())&&i.setRotationZ(this.animationResult.get(t).getRotationZ()),this.isInvaildNumber(i.getRotationY())&&i.setRotationY(this.animationResult.get(t).getRotationY()),this.isInvaildNumber(i.getRotationX())&&i.setRotationX(this.animationResult.get(t).getRotationX()),this.isInvaildNumber(i.getScaleX())&&i.setScaleX(this.animationResult.get(t).getScaleX()),this.isInvaildNumber(i.getScaleY())&&i.setScaleY(this.animationResult.get(t).getScaleY()),this.isInvaildNumber(i.getTranslationX())&&i.setTranslationX(this.animationResult.get(t).getTranslationX()),this.isInvaildNumber(i.getTranslationY())&&i.setTranslationY(this.animationResult.get(t).getTranslationY())}t=e}))}isInvaildNumber(t){return isNaN(t)||null==t||null==t}bindViewAnmation(t,e,i,n){if(null==t)return;const s=new TKKeyframeAnimation;let a=new Array;this.timestampSet.forEach((e=>{a.push((()=>(t.style={transform:{scale:{x:this.animationResult.get(e).getScaleX(),y:this.animationResult.get(e).getScaleY()},translate:{x:this.animationResult.get(e).getTranslationX(),y:this.animationResult.get(e).getTranslationY()},rotate:{z:this.animationResult.get(e).getRotationZ(),y:this.animationResult.get(e).getRotationY(),x:this.animationResult.get(e).getRotationX()}},opacity:this.animationResult.get(e).getAplha()},0==this.duration?1:this.animationResult.get(e).getStartTime()/this.duration)))})),s.setAnimations(a),s.duration=this.duration,Ce(n)?s.timingFunction="linear":s.timingFunction=n,i&&(s.on("start",(t=>{i("start")})),s.on("end",(t=>{i("end")}))),t.addAnimation(s,e)}}class es{static bindAnimation(t,e,i,n,s){let a=new ts;a.produceAnimationResult(t),a.bindViewAnmation(e,i,n,s)}}class is extends TKView{constructor(t){super(),this.vm=t,this.animationMap=new Map,this.setupViews()}setupViews(){this.screenWidth=this.vm.callerContext.containerLimit.width,this.screenHeight=this.vm.callerContext.containerLimit.height,this.differenceLength=this.screenAdaptate(102)-this.screenHeight+896,this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0},this.throughHitTest=!0,this.setBubbleRainAnimation()}setBubbleRainAnimation(){this.setBubbleAnimation1(),this.setBubbleAnimation2(),this.setBubbleAnimation3(),this.setBubbleAnimation4(),this.setBubbleAnimation5(),this.setBubbleAnimation6(),this.setBubbleAnimation7(),this.setBubbleAnimation8(),this.setBubbleAnimation9(),this.setBubbleAnimation10(),this.setBubbleAnimation11(),this.setBubbleAnimation12()}screenAdaptate(t){return t*this.screenWidth/414}bindBubbleRainAnim(){let e=this.vm.getRedPacketUrl(),i=this.vm.getRedPacketIndustryIcon();Ce(i)&&(i=""),this.bubbles=new Array;for(let n=1;n<=12;n++){let s=new TKView,a=new TKImage,o=new TKImage,r=new TKImage,h=new TKImage,l=new b;if(l.template_show_type="bubble_redpacket_click",5==n?(l.template_show_type="bubble_gold_redpacket_click",s.style={position:"absolute",width:this.screenAdaptate(259),height:this.screenAdaptate(259),top:0,left:0,opacity:0},this.appendChild(s),o.style={position:"absolute",width:this.screenAdaptate(139),height:this.screenAdaptate(139),top:this.screenAdaptate(57),left:this.screenAdaptate(61)},Ve(o,"image/BubbleRainResources/icon_ksad_bubble_rain_golden_red_packet.png"),s.appendChild(o),r.style={position:"absolute",width:this.screenAdaptate(86),height:this.screenAdaptate(38),top:this.screenAdaptate(83),left:this.screenAdaptate(88)},Se(r,i,500,(t=>{t||r.setVisibility("hidden")})),s.appendChild(r),a.style={position:"absolute",width:this.screenAdaptate(259),height:this.screenAdaptate(259),top:0,left:0},Ve(a,"image/BubbleRainResources/icon_ksad_bubble_rain_golden_bubble.png"),s.appendChild(a)):(s.style={position:"absolute",width:this.screenAdaptate(204),height:this.screenAdaptate(204),top:0,left:0,opacity:0},this.appendChild(s),Ce(e)?(o.style={position:"absolute",width:this.screenAdaptate(110),height:this.screenAdaptate(110),top:this.screenAdaptate(47),left:this.screenAdaptate(47)},Ve(o,"image/BubbleRainResources/icon_ksad_bubble_rain_red_packet.png"),s.appendChild(o),r.style={position:"absolute",width:this.screenAdaptate(72),height:this.screenAdaptate(32),top:this.screenAdaptate(111),left:this.screenAdaptate(68)},Se(r,i,500,(t=>{t||r.setVisibility("hidden")})),s.appendChild(r)):(h.style={position:"absolute",width:this.screenAdaptate(152),height:this.screenAdaptate(152),top:this.screenAdaptate(26),left:this.screenAdaptate(26)},Ve(h,e),s.appendChild(h)),a.style={position:"absolute",width:this.screenAdaptate(204),height:this.screenAdaptate(204),top:0,left:0},Ve(a,"image/BubbleRainResources/icon_ksad_bubble_rain_bubble.png"),s.appendChild(a)),s.addEventListener("tap",(e=>{this.vm.convert(1,{x:e.position.rawX,y:e.position.rawY},t.BUBBLE_RAIN_CLICK,l)})),12==n){const t=this;es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_1"),s,"bubbleAnimation"+n+"_1",(e=>{if("end"==e){if(this.vm.isShowEnd)return;es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_2"),s,"bubbleAnimation"+n+"_2",(e=>{if("end"==e){if(this.vm.isShowEnd)return;es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_3"),s,"bubbleAnimation"+n+"_3",(e=>{if("end"==e){if(this.vm.isShowEnd)return;es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_4"),s,"bubbleAnimation"+n+"_4",(e=>{if("end"==e){if(this.vm.isShowEnd)return;t.onAnimateComplete&&t.onAnimateComplete()}}),"0.92 0.0 0.68 1.0")}}))}}),"0.51 0.57 0.69 0.94")}}),"0.0 0.0 0.0 0.99")}else es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_1"),s,"bubbleAnimation"+n+"_1",(t=>{if("end"==t){if(this.vm.isShowEnd)return;es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_2"),s,"bubbleAnimation"+n+"_2",(t=>{if("end"==t){if(this.vm.isShowEnd)return;es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_3"),s,"bubbleAnimation"+n+"_3",(t=>{if("end"==t){if(this.vm.isShowEnd)return;es.bindAnimation(this.animationMap.get("bubbleAnimation"+n+"_4"),s,"bubbleAnimation"+n+"_4",null,"0.92 0.0 0.68 1.0")}}))}}),"0.51 0.57 0.69 0.94")}}),"0.0 0.0 0.0 0.99");this.bubbles.push(s),this.appendChild(s)}}setBubbleAnimation1(){let t=new Array;t=[new Yn(1,.001),new Jn(90,.001),new Jn(-4.98,800),new Zn(.126*-this.screenWidth,-813-this.differenceLength,.001),new Zn(.118*-this.screenWidth,927-this.differenceLength,800)],this.animationMap.set("bubbleAnimation1_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(-4.98,.001),new Jn(1,900),new Zn(.118*-this.screenWidth,927-this.differenceLength,.001),new Zn(.116*-this.screenWidth,829-this.differenceLength,900)],this.animationMap.set("bubbleAnimation1_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(1,.001),new Jn(0,600),new Zn(.116*-this.screenWidth,829-this.differenceLength,.001),new Zn(.116*-this.screenWidth,835-this.differenceLength,600)],this.animationMap.set("bubbleAnimation1_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.116*-this.screenWidth,835-this.differenceLength,.001),new Zn(.116*-this.screenWidth,1211-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation1_4",n)}setBubbleAnimation2(){let t=new Array;t=[new Yn(1,.001),new Jn(90,.001),new Jn(-4.98,800),new Zn(.167*this.screenWidth,-425-this.differenceLength,.001),new Zn(.258*this.screenWidth,789-this.differenceLength,800)],this.animationMap.set("bubbleAnimation2_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(-4.98,.001),new Jn(1,900),new Zn(.258*this.screenWidth,789-this.differenceLength,.001),new Zn(.254*this.screenWidth,718-this.differenceLength,900)],this.animationMap.set("bubbleAnimation2_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(1,.001),new Jn(0,600),new Zn(.254*this.screenWidth,718-this.differenceLength,.001),new Zn(.254*this.screenWidth,724-this.differenceLength,600)],this.animationMap.set("bubbleAnimation2_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.254*this.screenWidth,724-this.differenceLength,.001),new Zn(.254*this.screenWidth,1281-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation2_4",n)}setBubbleAnimation3(){let t=new Array;t=[new Yn(1,.001),new Jn(-90,.001),new Jn(4.98,800),new Zn(.587*this.screenWidth,-706-this.differenceLength,.001),new Zn(.587*this.screenWidth,949-this.differenceLength,800)],this.animationMap.set("bubbleAnimation3_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(4.98,.001),new Jn(-1,900),new Zn(.587*this.screenWidth,949-this.differenceLength,.001),new Zn(.587*this.screenWidth,855-this.differenceLength,900)],this.animationMap.set("bubbleAnimation3_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(-1,.001),new Jn(0,600),new Zn(.587*this.screenWidth,855-this.differenceLength,.001),new Zn(.587*this.screenWidth,861-this.differenceLength,600)],this.animationMap.set("bubbleAnimation3_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.587*this.screenWidth,861-this.differenceLength,.001),new Zn(.589*this.screenWidth,1318-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation3_4",n)}setBubbleAnimation4(){let t=new Array;t=[new Yn(1,.001),new Jn(-90,.001),new Jn(4.98,800),new Zn(.71*this.screenWidth,-480-this.differenceLength,.001),new Zn(.71*this.screenWidth,719-this.differenceLength,800)],this.animationMap.set("bubbleAnimation4_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(4.98,.001),new Jn(-1,900),new Zn(.71*this.screenWidth,719-this.differenceLength,.001),new Zn(.71*this.screenWidth,654-this.differenceLength,900)],this.animationMap.set("bubbleAnimation4_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(-1,.001),new Jn(0,600),new Zn(.71*this.screenWidth,654-this.differenceLength,.001),new Zn(.71*this.screenWidth,660-this.differenceLength,600)],this.animationMap.set("bubbleAnimation4_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.71*this.screenWidth,660-this.differenceLength,.001),new Zn(.71*this.screenWidth,1008-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation4_4",n)}setBubbleAnimation5(){let t=this.screenAdaptate(130)-this.screenHeight+896,e=new Array;e=[new Yn(1,.001),new Jn(-90,.001),new Jn(4.98,800),new Zn(.08*-this.screenWidth,-641-t,.001),new Zn(.08*-this.screenWidth,604-t,800)],this.animationMap.set("bubbleAnimation5_1",e);let i=new Array;i=[new Yn(1,.001),new Jn(4.98,.001),new Jn(-1,900),new Zn(.08*-this.screenWidth,604-t,.001),new Zn(.08*-this.screenWidth,533-t,900)],this.animationMap.set("bubbleAnimation5_2",i);let n=new Array;n=[new Yn(1,.001),new Jn(-1,.001),new Jn(0,600),new Zn(.08*-this.screenWidth,533-t,.001),new Zn(.08*-this.screenWidth,538-t,600)],this.animationMap.set("bubbleAnimation5_3",n);let s=new Array;s=[new Yn(1,.001),new Jn(0,.001),new Zn(.08*-this.screenWidth,538-t,.001),new Zn(.08*-this.screenWidth,1210-t,2e3)],this.animationMap.set("bubbleAnimation5_4",s)}setBubbleAnimation6(){let t=new Array;t=[new Yn(1,.001),new Jn(90,.001),new Jn(-4.98,800),new Zn(.483*this.screenWidth,-287-this.differenceLength,.001),new Zn(.505*this.screenWidth,524-this.differenceLength,800)],this.animationMap.set("bubbleAnimation6_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(-4.98,.001),new Jn(1,900),new Zn(.505*this.screenWidth,524-this.differenceLength,.001),new Zn(.505*this.screenWidth,477-this.differenceLength,900)],this.animationMap.set("bubbleAnimation6_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(1,.001),new Jn(0,600),new Zn(.505*this.screenWidth,477-this.differenceLength,.001),new Zn(.505*this.screenWidth,481-this.differenceLength,600)],this.animationMap.set("bubbleAnimation6_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.505*this.screenWidth,481-this.differenceLength,.001),new Zn(.505*this.screenWidth,1578-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation6_4",n)}setBubbleAnimation7(){let t=new Array;t=[new Yn(1,.001),new Jn(90,.001),new Jn(-4.98,800),new Zn(.097*this.screenWidth,-776-this.differenceLength,.001),new Zn(.053*this.screenWidth,376-this.differenceLength,800)],this.animationMap.set("bubbleAnimation7_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(-4.98,.001),new Jn(1,900),new Zn(.053*this.screenWidth,376-this.differenceLength,.001),new Zn(.058*this.screenWidth,319-this.differenceLength,900)],this.animationMap.set("bubbleAnimation7_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(1,.001),new Jn(0,600),new Zn(.058*this.screenWidth,319-this.differenceLength,.001),new Zn(.058*this.screenWidth,325-this.differenceLength,600)],this.animationMap.set("bubbleAnimation7_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.058*this.screenWidth,325-this.differenceLength,.001),new Zn(.058*this.screenWidth,1470-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation7_4",n)}setBubbleAnimation8(){let t=new Array;t=[new Yn(1,.001),new Jn(90,.001),new Jn(-4.98,800),new Zn(.529*this.screenWidth,-581-this.differenceLength,.001),new Zn(.57*this.screenWidth,323-this.differenceLength,800)],this.animationMap.set("bubbleAnimation8_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(-4.98,.001),new Jn(1,900),new Zn(.57*this.screenWidth,323-this.differenceLength,.001),new Zn(.57*this.screenWidth,271-this.differenceLength,900)],this.animationMap.set("bubbleAnimation8_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(1,.001),new Jn(0,600),new Zn(.57*this.screenWidth,271-this.differenceLength,.001),new Zn(.57*this.screenWidth,275-this.differenceLength,600)],this.animationMap.set("bubbleAnimation8_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.57*this.screenWidth,275-this.differenceLength,.001),new Zn(.57*this.screenWidth,1442-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation8_4",n)}setBubbleAnimation9(){let t=new Array;t=[new Yn(1,.001),new Jn(-90,.001),new Jn(4.98,800),new Zn(.188*-this.screenWidth,-599-this.differenceLength,.001),new Zn(.188*-this.screenWidth,199-this.differenceLength,800)],this.animationMap.set("bubbleAnimation9_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(4.98,.001),new Jn(-1,900),new Zn(.188*-this.screenWidth,199-this.differenceLength,.001),new Zn(.188*-this.screenWidth,153-this.differenceLength,900)],this.animationMap.set("bubbleAnimation9_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(-1,.001),new Jn(0,600),new Zn(.188*-this.screenWidth,153-this.differenceLength,.001),new Zn(.188*-this.screenWidth,158-this.differenceLength,600)],this.animationMap.set("bubbleAnimation9_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.188*-this.screenWidth,158-this.differenceLength,.001),new Zn(.188*-this.screenWidth,1379-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation9_4",n)}setBubbleAnimation10(){let t=new Array;t=[new Yn(1,.001),new Jn(90,.001),new Jn(-4.98,800),new Zn(.312*this.screenWidth,-513-this.differenceLength,.001),new Zn(.312*this.screenWidth,136-this.differenceLength,800)],this.animationMap.set("bubbleAnimation10_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(-4.98,.001),new Jn(1,900),new Zn(.312*this.screenWidth,136-this.differenceLength,.001),new Zn(.312*this.screenWidth,99-this.differenceLength,900)],this.animationMap.set("bubbleAnimation10_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(1,.001),new Jn(0,600),new Zn(.312*this.screenWidth,99-this.differenceLength,.001),new Zn(.312*this.screenWidth,103-this.differenceLength,600)],this.animationMap.set("bubbleAnimation10_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.312*this.screenWidth,103-this.differenceLength,.001),new Zn(.312*this.screenWidth,1386-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation10_4",n)}setBubbleAnimation11(){let t=new Array;t=[new Yn(1,.001),new Jn(-90,.001),new Jn(4.98,800),new Zn(.036*-this.screenWidth,-425-this.differenceLength,.001),new Zn(.036*-this.screenWidth,-17-this.differenceLength,800)],this.animationMap.set("bubbleAnimation11_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(4.98,.001),new Jn(-1,900),new Zn(.036*-this.screenWidth,-17-this.differenceLength,.001),new Zn(.036*-this.screenWidth,-43-this.differenceLength,900)],this.animationMap.set("bubbleAnimation11_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(-1,.001),new Jn(0,600),new Zn(.036*-this.screenWidth,-43-this.differenceLength,.001),new Zn(.036*-this.screenWidth,-36-this.differenceLength,600)],this.animationMap.set("bubbleAnimation11_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.036*-this.screenWidth,-36-this.differenceLength,.001),new Zn(.036*-this.screenWidth,1566-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation11_4",n)}setBubbleAnimation12(){let t=new Array;t=[new Yn(1,.001),new Jn(90,.001),new Jn(-4.98,800),new Zn(.792*this.screenWidth,-146-this.differenceLength,.001),new Zn(.792*this.screenWidth,17-this.differenceLength,800)],this.animationMap.set("bubbleAnimation12_1",t);let e=new Array;e=[new Yn(1,.001),new Jn(-4.98,.001),new Jn(1,900),new Zn(.792*this.screenWidth,17-this.differenceLength,.001),new Zn(.792*this.screenWidth,7-this.differenceLength,900)],this.animationMap.set("bubbleAnimation12_2",e);let i=new Array;i=[new Yn(1,.001),new Jn(1,.001),new Jn(0,600),new Zn(.792*this.screenWidth,7-this.differenceLength,.001),new Zn(.792*this.screenWidth,10-this.differenceLength,600)],this.animationMap.set("bubbleAnimation12_3",i);let n=new Array;n=[new Yn(1,.001),new Jn(0,.001),new Zn(.792*this.screenWidth,10-this.differenceLength,.001),new Zn(.792*this.screenWidth,1526-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation12_4",n)}stopAllAnimation(){if(!Ce(this.bubbles))for(let t=0;t<this.bubbles.length;t++)this.bubbles[t].removeAllAnimation();this.removeAll()}}class ns{constructor(t){this.currentPlaybackTimeMs=0,this.countDownTime=0,this.isTimerPaused=!1,this.mTimerInterval=500,this.mTotalStayTime=0,this.mTotalStayTime=t}setTotalPlayTime(t){t&&(this.mTotalStayTime=t)}setTimerInterval(t){t&&(this.mTimerInterval=t)}play(){this.startTimer()}paused(){this.isTimerPaused=!0}resume(){this.isTimerPaused=!1}stop(){this.stopTimer()}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{this.isTimerPaused||(this.currentPlaybackTimeMs+=this.mTimerInterval,this.onCurrentPlaybackCallback&&this.onCurrentPlaybackCallback(this.currentPlaybackTimeMs),this.currentPlaybackTimeMs>=this.mTotalStayTime?(this.stopTimer(),this.onFinishCallback&&this.onFinishCallback()):this.currentPlaybackTimeMs<this.mTotalStayTime&&(this.countDownTime=(this.mTotalStayTime-this.currentPlaybackTimeMs)/1e3,this.countDownCallback&&this.countDownCallback(this.countDownTime)))}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}}class ss extends TKView{constructor(t){super(),this.hasRemove=!1,this.vm=t,this.throughHitTest=!0,this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0};const e=this;this.timePlay=new ns(this.vm.getDelayTime()),this.timePlay.onFinishCallback=()=>{e.vm.hasShown=!0,e.vm.reportElementImpression(),e.setupViews()},Oe().on(h,(t=>{this.vm.hasShown&&(this.vm.isShowEnd=!0)})),fi(this.vm.$attrsPath.isShowEnd,(t=>{t&&this.onDismiss()})),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{switch(t){case"showEnd":this.timePlay.play();break;case"pageInvisiable":this.timePlay.paused();break;case"pageVisiable":this.timePlay.resume();break;case"hideEnd":this.vm.isShowEnd=!0}}))}setupViews(){const t=this;this.preHeatView=new Gn(this.vm,(()=>{t.rainFallView=new is(this.vm),t.rainFallView.onAnimateComplete=()=>{t.onDismiss()},t.appendChild(this.rainFallView),t.rainFallView.bindBubbleRainAnim()})),this.appendChild(this.preHeatView)}onDismiss(){this.hasRemove||(this.hasRemove=!0,this.preHeatView&&this.preHeatView.stopAllAnimation(),this.rainFallView&&this.rainFallView.stopAllAnimation(),this.timePlay.stop(),this.style={visibility:"hidden"},this.onDismissComplete&&this.onDismissComplete())}}class as extends TKView{constructor(t){super(),this.vm=t,this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute"},this.throughHitTest=!0,this.setPreloadData(),this.preloadView(),this.produceAnimation(),this.setupAction()}setPreloadData(){this.imageViews=new Array,this.animationMap=new Map,this.imageSrcs=new Array,this.levelsConfig=[8,10,9,7,5,4,13,12,11,6,3,2,1];for(let t=0;t<3;t++){let e="image/ksad-compose-image/GiftBox/ksad_gift_box_"+t+".png",i=this.vm.getGiftBoxIconUrls()[t];this.imageSrcs.push(Ce(i)?e:i)}}preloadView(){this.vm.callerContext.containerLimit.width;let t=this.vm.callerContext.containerLimit.height,e=this.vm.callerContext.containerLimit.width/375,i=[85*e,215.5*e,-28*e,100*e,-10*e,170*e,223*e,-59*e,27*e,-27*e,198.5*e,113.5*e,60*e],n=[0,0,0,1,0,0,1,0,1,0,2,2,0];3==this.vm.callerContext.adStyle||2==this.vm.callerContext.adStyle?Le.isAndroid()?this.appendHeight=70*e/t:this.appendHeight=100*e/t:this.appendHeight=53*e/t;for(let s=0;s<13;s++){let t=new TKImage;t.style={position:"absolute",width:195*e,height:195*e,top:200*-e,left:i[s],right:0,opacity:1},Se(t,this.imageSrcs[n[s]],500,(e=>{e||(this.hasLoadFailed=!0,Ve(t,"image/ksad-compose-image/GiftBox/ksad_gift_box_"+n[s]+".png"))})),this.imageViews.push(t)}}produceAnimation(){this.configGiftBoxAnimation1(),this.configGiftBoxAnimation2(),this.configGiftBoxAnimation3(),this.configGiftBoxAnimation4(),this.configGiftBoxAnimation5(),this.configGiftBoxAnimation6(),this.configGiftBoxAnimation7(),this.configGiftBoxAnimation8(),this.configGiftBoxAnimation9(),this.configGiftBoxAnimation10(),this.configGiftBoxAnimation11(),this.configGiftBoxAnimation12(),this.configGiftBoxAnimation13()}configGiftBoxAnimation1(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(0,500),new Jn(-18,600),new Zn(0,0,0),new Zn(0,1.025*t+t*this.appendHeight,500)],this.animationMap.set("animation0",e)}configGiftBoxAnimation2(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(-45,0),new Jn(-45,700),new Jn(-60,800),new Zn(0,0,500),new Zn(0,1.024*t+t*this.appendHeight,700)],this.animationMap.set("animation1",e)}configGiftBoxAnimation3(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(-60,0),new Jn(-60,750),new Jn(-40,850),new Zn(0,0,550),new Zn(0,1.034*t+t*this.appendHeight,750)],this.animationMap.set("animation2",e)}configGiftBoxAnimation4(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(-100,0),new Zn(0,0,600),new Zn(0,.93*t+t*this.appendHeight,750),new Zn(0,.91*t+t*this.appendHeight,800),new Zn(0,.945*t+t*this.appendHeight,850)],this.animationMap.set("animation3",e)}configGiftBoxAnimation5(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(-100,0),new Jn(-100,800),new Jn(-85,850),new Zn(0,0,600),new Zn(0,.95*t+t*this.appendHeight,800)],this.animationMap.set("animation4",e)}configGiftBoxAnimation6(){let t=this.vm.callerContext.containerLimit.height,e=new Array,i=new Jn(-15,0),n=new Zn(0,0,800);e=[i,n,n,new Zn(0,.925*t+t*this.appendHeight,1050)],this.animationMap.set("animation5",e)}configGiftBoxAnimation7(){let t=this.vm.callerContext.containerLimit.width,e=this.vm.callerContext.containerLimit.height,i=new Array;i=[new Jn(35,0),new Jn(35,1050),new Jn(105,1150),new Zn(0,0,850),new Zn(0,.825*e+e*this.appendHeight,1050),new Zn(.1*t,.925*e+e*this.appendHeight,1150)],this.animationMap.set("animation6",i)}configGiftBoxAnimation8(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Zn(0,0,900),new Zn(0,.92*t+t*this.appendHeight,1200)],this.animationMap.set("animation7",e)}configGiftBoxAnimation9(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(-35,0),new Jn(-35,1400),new Jn(-25,1500),new Zn(0,0,1100),new Zn(0,.835*t+t*this.appendHeight,1400)],this.animationMap.set("animation8",e)}configGiftBoxAnimation10(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(-60,0),new Jn(-60,1850),new Jn(-40,1950),new Zn(0,0,1650),new Zn(0,.777*t+t*this.appendHeight,1850)],this.animationMap.set("animation9",e)}configGiftBoxAnimation11(){let t=this.vm.callerContext.containerLimit.width,e=this.vm.callerContext.containerLimit.height,i=new Array;i=[new Jn(70,0),new Jn(70,1950),new Jn(95,2150),new Zn(0,0,1650),new Zn(0,.803*e+e*this.appendHeight,1950),new Zn(.05*t,.823*e+e*this.appendHeight,2150)],this.animationMap.set("animation10",i)}configGiftBoxAnimation12(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(8,0),new Zn(0,0,1650),new Zn(0,.795*t+t*this.appendHeight,1900)],this.animationMap.set("animation11",e)}configGiftBoxAnimation13(){this.vm.callerContext.containerLimit.width;let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Jn(-15,0),new Jn(-15,2600),new Jn(-40,2750),new Zn(0,0,2400),new Zn(0,.682*t+t*this.appendHeight,2600),new Zn(.02*-t,.702*t+t*this.appendHeight,2750)],this.animationMap.set("animation12",e)}setupAction(){const t=this;for(let e=0;e<this.imageViews.length;e++)this.appendChild(this.imageViews[this.levelsConfig[e]-1]),this.imageViews[this.levelsConfig[e]-1].addEventListener("tap",(e=>{this.hasClicked=!0,t.clickCallback&&t.clickCallback(),t.setVisibility("gone")}))}show(){console.log("giftbox multibox show"+this.imageViews.length);for(let e=0;e<this.imageViews.length;e++)es.bindAnimation(this.animationMap.get("animation"+(this.levelsConfig[e]-1)),this.imageViews[this.levelsConfig[e]-1],"showAnimation"+e);const t=this;setTimeout((()=>{t.dismiss()}),this.vm.getGiftBoxShowTime()-1500)}dismiss(){if(this.hasClicked||this.hasDismissed)return;let t=new Yn(1,0),e=new Yn(0,150);const i=this;es.bindAnimation([t,e],this,"dismissAnimation",(t=>{i.hasClicked||i.hasDismissed||"end"==t&&(i.autoDismissCallback&&i.autoDismissCallback(),i.hasDismissed=!0,i.setVisibility("gone"),console.log("giftbox multibox dismiss"))}))}}class os extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData(),this.setupAction()}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",visibility:"hidden"},this.throughHitTest=!0,this.guideView=new TKView,this.guideView.style={justifyContent:"center",alignItems:"center",opacity:0},this.appendChild(this.guideView),this.guideLabel=new TKText,this.guideLabel.style={height:36,paddingLeft:20,paddingRight:20,backgroundColor:"#0D0000B2",textAlign:"center",color:"#FFFFFF",borderRadius:18,fontWeight:"bold"},this.guideView.appendChild(this.guideLabel),this.guideImageView=new TKImage,this.guideImageView.style={width:12,height:6},this.guideView.appendChild(this.guideImageView),this.giftBoxImage=new TKImage,this.giftBoxImage.style={marginTop:-7,width:195,height:195,opacity:0},this.appendChild(this.giftBoxImage)}setupData(){let t="image/ksad-compose-image/GiftBox/ksad_gift_box_0.png",e=Ce(this.vm.getGiftBoxIconUrls()[0])?t:this.vm.getGiftBoxIconUrls()[0];Se(this.giftBoxImage,e,500,(e=>{e||(Ve(this.giftBoxImage,t),this.hasLoadFailed=!0)})),this.guideLabel.setText(this.vm.getSingleBoxGuideText()),Ve(this.guideImageView,"icon_ksad_gift_box_guide_arrow.png")}setupAction(){const t=this;this.giftBoxImage.addEventListener("tap",(e=>{t.hasClicked=!0,t.clickCallback&&t.clickCallback(),t.dismiss()}))}autoDismiss(){this.hasClicked||(this.autoDismissCallback&&this.autoDismissCallback(),this.dismiss())}startShowAnimation(){const t=this,e=Li(this.giftBoxImage,300,!0);e.on("end",(()=>{t.startShakeAnimation()})),this.giftBoxImage.addAnimation(e,"giftBoxShowAnimation");const i=Li(this.guideView,300,!0);this.guideView.addAnimation(i,"guideShowAnimation")}startShakeAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.giftBoxImage.style={transform:{rotate:20}},.16),()=>(t.giftBoxImage.style={transform:{rotate:0}},.32),()=>(t.giftBoxImage.style={transform:{rotate:-20}},.48),()=>(t.giftBoxImage.style={transform:{rotate:0}},.64),()=>(t.giftBoxImage.style={transform:{rotate:20}},.8),()=>(t.giftBoxImage.style={transform:{rotate:0}},1)]),e.duration=900,e.timingFunction="linear",e.on("end",(()=>{t.startHideAnimation()})),this.giftBoxImage.addAnimation(e,"shakeAnimation")}startHideAnimation(){const t=this,e=Di(this.giftBoxImage,200,!0);e.on("end",(()=>{t.autoDismiss()})),this.giftBoxImage.addAnimation(e,"giftBoxHideAnimation");const i=Di(this.guideView,200,!0);this.guideView.addAnimation(i,"guideHideAnimation")}show(){console.log("giftbox singlebox show"),this.style={visibility:"visible"},this.startShowAnimation()}dismiss(){this.style={visibility:"hidden"},this.setVisibility("gone")}}class rs extends TKView{constructor(t){super(),this.lottieLoadFailed=!1,this.vm=t,this.setupViews(),this.setupData()}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",visibility:"hidden"},this.throughHitTest=!0;const t=this,e=Math.ceil(812*Tachikoma.env.deviceWidth/375);Le.supportMinimumTKVersion("5.0.0")&&(this.couponView=new TKLottieImageView,this.couponView.style={width:"100%",height:e,opacity:0},this.couponView.enabled=!1,this.couponView.setLoop(!1),this.couponView.onAnimationLoaded((e=>{e||(console.log("giftbox transition load animation failed"),t.lottieLoadFailed=!0)})),this.couponView.onAnimationEnd((()=>{t.convert()})),this.appendChild(this.couponView))}setupData(){this.couponView&&this.couponView.setUri(this.vm.getClickAnimationLottieUrl())}startShowAnimation(){this.style={visibility:"visible"},this.startCouponViewFallAnimation()}startCouponViewFallAnimation(){this.couponView&&(this.couponView.style={opacity:1},this.couponView.play())}convert(){this.hasConverted||(this.hasConverted=!0,this.vm.reportGiftBoxClick())}show(){this.vm.enableShowClickAnimation()&&!this.lottieLoadFailed?(console.log("giftbox transition show"),this.startShowAnimation(),setTimeout((()=>{this.convert()}),2300)):this.convert()}}class hs{static reportGiftBoxShowEvent(t){try{Ge({category:"ad_client_apm_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:t?.1:.001,suffixRatio:"",event_id:"ad_huge_scene_render_performance",primaryKey:"status",type:"OTHER",msg:{load_status:t?2:1,scene:"gift_box",status:1}})}catch(e){}}static reportGiftBoxClickEvent(t){try{Ge({category:"ad_client_apm_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:t?.1:.001,suffixRatio:"",event_id:"ad_huge_scene_render_performance",primaryKey:"status",type:"OTHER",msg:{load_status:t?2:1,scene:"gift_box",status:2}})}catch(e){}}}class ls extends TKView{constructor(t){super(),this.vm=t,this.setupViews();const e=this;fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"showEnd"===t&&(2!=e.vm.callerContext.adStyle&&3!=e.vm.callerContext.adStyle||e.startDelayTimerIfNeeded()),"pageVisiable"===t&&e.startDelayTimerIfNeeded(),"pageInvisiable"===t&&e.stopDelayTimerIfNeeded()})),Oe().on(h,(t=>{setTimeout((()=>{console.log("giftbox dismiss"),e.transitionView&&(e.transitionView.hasConverted=!0),e.dismissCallback&&e.dismissCallback()}),500)}))}setupViews(){this.style={width:"100%",height:"100%"},this.throughHitTest=!0;const t=this;this.singleBoxView=new os(this.vm),this.singleBoxView.autoDismissCallback=()=>{console.log("giftbox singlebox auto dissmiss"),t.multiBoxView&&t.multiBoxView.show()},this.singleBoxView.clickCallback=()=>{console.log("giftbox singlebox click"),t.convert()},this.appendChild(this.singleBoxView),this.multiBoxView=new as(this.vm),this.multiBoxView.clickCallback=()=>{console.log("giftbox multibox click"),t.convert()},this.multiBoxView.autoDismissCallback=()=>{t.dismissCallback&&t.dismissCallback()},this.appendChild(this.multiBoxView),this.transitionView=new rs(this.vm),this.appendChild(this.transitionView)}show(){console.log("giftbox show"),this.vm.hasShown=!0,this.vm.showMultiBoxViewDirectly()?this.multiBoxView&&this.multiBoxView.show():this.singleBoxView&&this.singleBoxView.show(),this.vm.reportGiftBoxImpression();let t=this.singleBoxView.hasLoadFailed||this.multiBoxView.hasLoadFailed;hs.reportGiftBoxShowEvent(t)}hide(){this.style={visibility:"gone"},this.dismissCallback&&this.dismissCallback()}convert(){this.transitionView&&this.transitionView.show();let t=this.singleBoxView.hasLoadFailed||this.multiBoxView.hasLoadFailed;hs.reportGiftBoxClickEvent(t)}startDelayTimerIfNeeded(){if(this.vm.hasShown)return;if(this.vm.getGiftBoxDelayTime()<=0)return void this.show();if(this.delayTimer)return void this.delayTimer.resume();this.delayTimer=new ns(this.vm.getGiftBoxDelayTime()),this.delayTimer.play();const t=this;this.delayTimer.onFinishCallback=()=>{t.show()}}stopDelayTimerIfNeeded(){this.vm.hasShown||this.delayTimer&&this.delayTimer.paused()}}class ds extends Wn{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),yi(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{this.vm.updateShowRedPacketRain(t)})),yi(this.vm,this.vm.$attrsPath.showRedPacketRain,(t=>{t&&this.redPackView&&this.redPackView.show()})),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"==t&&this.festivalPendantView&&this.festivalPendantView.restartGuidanceImageMoveAnimationIfNeeded(),"hideEnd"==t&&this.festivalPendantView&&this.festivalPendantView.stopActionAnimation()})),yi(this.vm,this.vm.$attrsPath.hasShowPlayend,(t=>{t&&(this.festivalPendantView&&(this.festivalPendantView.clearTimeoutIfConverted(),this.festivalPendantView.removePendantClickAnimViewIfNeeded(this),this.festivalPendantView.setVisibility("hidden")),this.redPackView&&this.redPackView.hide(),this.bubbleRainView&&(this.vm.bubbleRainViewModel.isShowEnd=!0),this.giftBoxView&&this.giftBoxView.hide())})),yi(this.vm,this.vm.$attrsPath.festivalPendantBottom,(t=>{if(!this.vm.isValidFestivalPendantBottom())return;const e=this.vm.callerContext.containerLimit.height-this.vm.festivalPendantViewModel.getPendantSize().height-t;this.festivalPendantView&&(this.festivalPendantView.style={top:this.vm.isNeedNewStyleTop()?e-60:e,visibility:"visible"})})),yi(this.vm,this.vm.$attrsPath.adHasConvert,(t=>{t&&(this.redPackView&&this.redPackView.hide(!0),this.festivalPendantView&&this.festivalPendantView.clearTimeoutIfConverted())})))}setupViews(){if(this.style={width:"100%",height:"100%"},this.throughHitTest=!0,this.vm.enableShowGiftBoxView())this.createGiftBoxView();else if(this.vm.enableBubblerainView())this.bubbleRainView=new ss(this.vm.bubbleRainViewModel),this.bubbleRainView.onDismissComplete=()=>{this.removeChild(this.bubbleRainView)},this.appendChild(this.bubbleRainView);else if(this.vm.enableShowRedPacketView()){this.redPackView=new zn(this.vm.redPacketViewModel),this.appendChild(this.redPackView);const t=this;this.vm.redPacketViewModel.dismissCallback=()=>{t.vm.enableShowFestivalPendantView()&&t.createFestivalPendantView()}}else this.vm.enableShowFestivalPendantView()&&this.createFestivalPendantView()}createFestivalPendantView(){this.festivalPendantView||(this.festivalPendantView=new Un(this.vm.festivalPendantViewModel),this.festivalPendantView.style={position:"absolute",visibility:"hidden"},this.appendChild(this.festivalPendantView),this.festivalPendantView.createPendantClickAnimViewIfNeeded(this),setTimeout((()=>{this.vm.isValidFestivalPendantBottom()||this.vm.getFestivalPendantBottom()}),this.vm.enableShowRedPacketView()?0:500),setTimeout((()=>{this.vm.isValidFestivalPendantBottom()||this.vm.getFestivalPendantBottom()}),1500))}createGiftBoxView(){if(this.giftBoxView)return;const t=this;this.giftBoxView=new ls(this.vm.giftBoxViewModel),this.giftBoxView.dismissCallback=()=>{t.removeChild(this.giftBoxView)},this.appendChild(this.giftBoxView)}}class cs extends Fi{constructor(t,e){super(t),this.spikeTimer=0,this.limitWidth=e,this.setupViews(),yi(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"showEnd":case"pageVisiable":this.startCountDown();break;case"hideEnd":case"pageInvisiable":this.stopCountDown()}}))}createSpikeView(){const t=new TKView;if(t.style={width:"100%",height:30,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",position:"absolute",top:0,left:0},this.spikeIcon=new TKImage,this.spikeIcon.style={width:74,height:14,marginLeft:8,marginRight:7},Ve(this.spikeIcon,"direct_ec_spike.png"),t.appendChild(this.spikeIcon),this.vm.directEcCardModel.hasSpike){const e={height:16,borderRadius:2,backgroundColor:"#FFFFFF4C",color:"#FFFFFFFF",fontSize:11,fontWeight:"bold",textAlign:"center"},i={fontSize:12,fontWeight:"bold",marginLeft:2,marginRight:2,color:"#FFFFFF"};let n=this.vm.directEcCardModel.getSpikeTime();this.spikeHourText=new TKText,this.spikeHourText.style=e,this.spikeHourText.setText(n.getFormattedHour()),t.appendChild(this.spikeHourText);const s=new TKText;s.style=i,s.setText(":"),t.appendChild(s),this.spikeMinuteText=new TKText,this.spikeMinuteText.style=e,this.spikeMinuteText.setText(n.getFormattedMinute()),t.appendChild(this.spikeMinuteText);const a=new TKText;a.style=i,a.setText(":"),t.appendChild(a),this.spikeSecondText=new TKText,this.spikeSecondText.style=e,this.spikeSecondText.setText(n.getFormattedSecond()),t.appendChild(this.spikeSecondText)}return this.headerSoldText=new TKText,this.headerSoldText.style={textAlign:"right",flexGrow:1,fontSize:12,color:"#FFFFFF"},t.appendChild(this.headerSoldText),t}startCountDown(){if(!this.vm.directEcCardModel.hasSpike||!this.showSpike)return;this.stopCountDown();const t=()=>{let t=this.vm.directEcCardModel.getSpikeTime();this.spikeHourText.setText(t.getFormattedHour()),this.spikeMinuteText.setText(t.getFormattedMinute()),this.spikeSecondText.setText(t.getFormattedSecond())};this.spikeTimer=setInterval(t,1e3),t()}stopCountDown(){this.vm.directEcCardModel.hasSpike&&this.showSpike&&0!=this.spikeTimer&&(clearInterval(this.spikeTimer),this.spikeTimer=0)}updatePriceAndSold(){this.headerSoldText?(me(this.vm.directEcCardModel.volume)&&Ci(this.headerSoldText,"text",this.vm.$attrsPath.directEcCardModel.volume),me(this.vm.directEcCardModel.rating)&&Ci(this.soldText,"text",this.vm.$attrsPath.directEcCardModel.rating)):me(this.vm.directEcCardModel.volumeAndRating)&&Ci(this.soldText,"text",this.vm.$attrsPath.directEcCardModel.volumeAndRating);const t=this.vm.directEcCardModel.price,e=t.toString().split("."),i="￥"+t;let n="";e.length>=1&&(n=e[0]);let s=new TKSpan;const a=new TKSpanItem;a.spanType="absoluteSize",a.size=12,a.start=0,a.end=1,s.addSpan(a);const o=new TKSpanItem;o.spanType="absoluteSize",o.size=16,o.start=1,o.end=1+n.length,s.addSpan(o);const r=new TKSpanItem;r.spanType="absoluteSize",r.size=12,r.start=1+n.length,r.end=i.length,s.addSpan(r),this.priceText.setSpan(i,s);const h=this.vm.directEcCardModel.originalPrice;if(me(h)){const t="￥"+h,e=new TKSpan,i=new TKSpanItem;i.spanType="strikeThrough",i.start=0,i.end=t.length,e.addSpan(i),this.originPriceText.setSpan(t,e)}}createPriceView(t){const e=new TKView;return e.style={flexDirection:"row",alignItems:t?"center":"flex-end",justifyContent:"flex-start",width:"100%"},this.priceText=new TKText,this.priceText.style={color:"#FE3666",fontWeight:"medium"},e.appendChild(this.priceText),this.originPriceText=new TKText,this.originPriceText.style={color:"#9C9C9C",fontSize:12,fontWeight:"normal",marginLeft:4,alignSelf:"center"},e.appendChild(this.originPriceText),e}setupViews(){this.vm.getDirectEcData(),this.cardDelayShowTime=3,this.vm.directEcCardModel.cardStyle=0,this.vm.directEcCardModel.hasSpike=!0,this.showSpike=2==this.vm.directEcCardModel.cardStyle;const e=1==this.vm.screenOrientation;switch(this.vm.directEcCardModel.cardStyle){case 1:this.cardHeight=103,this.growthHeight=48;break;case 2:this.cardHeight=134,this.growthHeight=50;break;default:this.cardHeight=105,this.growthHeight=50}this.totalHeight=1==this.vm.screenOrientation?this.cardHeight+this.growthHeight+12:this.cardHeight+this.growthHeight+12+16+8,this.style={width:"100%",height:this.totalHeight,flexDirection:"column",justifyContent:"flex-start",alignItems:e?"flex-end":"flex-start",position:"relative",paddingLeft:12,paddingRight:12,paddingBottom:12,flexWrap:"no-wrap"},this.logoView=new Vi(1,this.vm.adInfo);const i={right:12,position:"absolute"};e?i.bottom=16:i.top=this.growthHeight,this.logoView.style=i,this.appendChild(this.logoView),this.borderContainer=new TKView,this.borderContainer.style={width:e?351:"100%",height:this.cardHeight,bottom:12,left:12,flexDirection:"column",paddingLeft:this.showSpike?4:0,paddingRight:this.showSpike?4:0,paddingBottom:this.showSpike?5:0,borderRadius:11,position:"absolute"},this.showSpike&&(this.borderContainer.style={gradientBgColor:"315,#FF8000,#FF0A43"}),this.appendChild(this.borderContainer),this.vm.supportSlideClick()&&Nt(this.borderContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.showSpike&&this.borderContainer.appendChild(this.createSpikeView()),this.infoContainer=new TKView,this.infoContainer.style={backgroundColor:"#FFFFFF",height:this.showSpike?this.cardHeight-35:this.cardHeight,width:"100%",top:this.showSpike?30:0,left:this.showSpike?4:0,right:this.showSpike?4:0,padding:8,borderRadius:8,flexDirection:"column",justifyContent:"space-between",position:"absolute",alignItems:"flex-start"},this.borderContainer.appendChild(this.infoContainer);const n=new TKView;if(n.style={flexDirection:"row",width:"100%",height:85,position:"relative"},this.infoContainer.appendChild(n),this.productIcon=new TKImage,this.productIcon.style={width:85,height:85,position:"absolute",top:0,left:0,borderRadius:6,marginRight:8},this.productIcon.setSrc(this.vm.getAdIcon()),n.appendChild(this.productIcon),this.vm.directEcCardModel.hasCounpon&&1!=this.vm.directEcCardModel.cardStyle){const t=new TKImage;t.style={width:43,height:17,bottom:3,left:3,position:"absolute"},n.appendChild(t),Ve(t,"direct_ec_coupon_bg.png");const e=new TKText;e.style={width:17,height:17,fontSize:10,fontWeight:"medium",textAlign:"center",position:"absolute",left:3,bottom:3,color:"#FFFFFF"},e.setText("券"),n.appendChild(e);const i=new TKText;i.style={width:25,height:17,fontSize:10,fontWeight:"medium",textAlign:"center",position:"absolute",left:19,bottom:3,color:"#FFFFFF",minimumTextScaleFactor:.5},n.appendChild(i),Ci(i,"text",this.vm.$attrsPath.directEcCardModel.couponTitle,"")}const s=new TKView;if(s.style={height:85,right:0,left:93,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",flexShrink:1,position:"absolute"},n.appendChild(s),this.nameLabel=new TKText,this.nameLabel.style={height:20,fontSize:16,fontWeight:"bold",color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},s.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:2,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),s.appendChild(this.descLabel),this.soldText=new TKText,this.soldText.style={fontSize:12,color:"#9C9C9C",flexGrow:1,textAlign:"right"},1!=this.vm.directEcCardModel.cardStyle){const t=this.createPriceView(!1);s.appendChild(t),t.appendChild(this.soldText)}else s.appendChild(this.soldText);if(this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={width:"100%",height:40,opacity:0,flexDirection:"row"},this.infoContainer.appendChild(this.bottomBtnContainer),1==this.vm.directEcCardModel.cardStyle){const e=24;this.leftActionBar=new TKView,this.leftActionBar.style={width:205/(331-e)*(this.limitWidth-e-44),height:38,backgroundColor:"#FFE5EBFF",topLeftRadius:19,bottomLeftRadius:19,flexDirection:"row",justifyContent:"flex-start",alignItems:"center",paddingLeft:16};const i=this.createPriceView(!0);this.leftActionBar.appendChild(i),this.middleIcon=new TKImage,this.middleIcon.style={width:e,height:38,resize:"stretch",overflow:"hidden"},this.middleIcon.clipChildren=!0,Ve(this.middleIcon,"direct_ec_sep.png"),this.rightActionBar=new TKButton,this.rightActionBar.style={width:(126-e)/(331-e)*(this.limitWidth-e-44),height:38,topRightRadius:18,bottomRightRadius:18,gradientBgColor:"158,#FF7E26FF,#FE3666FF",flexDirection:"row",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"bold",textAlign:"center",color:"#FFFFFF"},Ci(this.rightActionBar,"text",this.vm.$attrsPath.actionText),this.bottomBtnContainer.appendChild(this.leftActionBar),this.bottomBtnContainer.appendChild(this.middleIcon),this.bottomBtnContainer.appendChild(this.rightActionBar),this.leftActionBar.addEventListener("tap",(e=>{const i=pe(e,this.leftActionBar);this.convert(1,i,t.ACTION_BAR_CLICK)})),this.rightActionBar.addEventListener("tap",(e=>{const i=pe(e,this.leftActionBar);this.convert(1,i,t.ACTION_BAR_CLICK)})),this.vm.supportSlideClick()&&(Nt(this.leftActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}else this.actionBtn=new TKButton,this.actionBtn.style={fontSize:15,fontWeight:"bold",color:"#FFFFFF",backgroundColor:"#FE3666",borderRadius:22,height:"100%",width:"100%",textAlign:"center"},Ci(this.actionBtn,"text",this.vm.$attrsPath.actionText),this.bottomBtnContainer.appendChild(this.actionBtn),this.actionBtn.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.ACTION_BAR_CLICK)})),this.vm.supportSlideClick()&&Nt(this.actionBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)}));this.updatePriceAndSold(),this.startActionAnimation();const a=this;this.borderContainer.addEventListener("tap",(e=>{const i=pe(e,a);this.convert(2,i,t.ACTIONBAR_ICON_OTHER_AREA_CLICK)})),this.addEventListener("tap",(e=>{const i=pe(e,a);this.convert(2,i,t.ACTIONBAR_ICON_OTHER_AREA_CLICK)}))}startActionAnimation(){let t=this;setTimeout((()=>{t.animationAllowed=!0,t.animationAllowed&&t.addActionTranslateAnim()}),1e3*this.cardDelayShowTime)}addActionTranslateAnim(){this.updateHeight(this.borderContainer,this.cardHeight+this.growthHeight,"translate"),this.updateHeight(this.infoContainer,this.showSpike?this.cardHeight+this.growthHeight-35:this.cardHeight+this.growthHeight,"translate"),this.updateOpacity(this.bottomBtnContainer,1,"bottomBtnContainerOpacity"),0==this.vm.screenOrientation&&this.updateTop(this.logoView,0,"logoViewTop")}updateHeight(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={height:e}})),s.duration=n,t&&t.addAnimation(s,i)}updateOpacity(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={opacity:e}})),s.duration=n,t&&t.addAnimation(s,i)}updateTop(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={top:e}})),s.duration=n,t&&t.addAnimation(s,i)}stopActionAnimation(){this.animationAllowed=!1,this&&this.removeAllAnimation()}getHeight(){return this.totalHeight}}class ps extends Fi{constructor(e){super(e),this.style={width:Le.isAndroid()?"100%":e.containerLimit.width,height:this.getHeight(),flexDirection:"row",justifyContent:"center",alignItems:"flex-end"},this.nativeID="KSAdLiveSubscribeBar",this.weakCard=this.createWeakCard(),this.addClickConvert(this.weakCard,1,t.CARD_ACTION_BAR_CLICK),this.appendChild(this.weakCard),this.ksadLogoView=new Vi(1,this.vm.adInfo,16),this.ksadLogoView.style={position:"absolute",bottom:16,right:16},this.appendChild(this.ksadLogoView),this.liveSubscribeCard=this.createBigCard(),this.appendChild(this.liveSubscribeCard),setTimeout((()=>{this.showAndHideWeakCard(this.weakCard,(()=>{this.showBigCard(this.liveSubscribeCard,this.ksadLogoView)}))}),500)}getHeight(){return 186}stopActionAnimation(){this.animateTimer&&clearInterval(this.animateTimer),this.liveLabelView.removeAllAnimation()}showBigCard(t,e){let i=new TKBasicAnimation;i.duration=500,i.timingFunction="EaseOut",i.setEndValue((()=>{t.style={transform:{translate:{y:-178}}}}));let n=new TKBasicAnimation;n.duration=500,n.timingFunction="EaseOut",n.setEndValue((()=>{e.style={transform:{translate:{y:-154}}}})),t.addAnimation(i,"showCard"),this.vm.isScreenPortrait()&&e.addAnimation(n,"logoUp"),this.animateTimer=setInterval((()=>{this.liveLabelView.startRotate()}),800)}showAndHideWeakCard(t,e){let i=new TKBasicAnimation;i.duration=500,i.timingFunction="EaseOut",i.setEndValue((()=>{t.style={transform:{translate:{y:-44}}}}));let n=new TKBasicAnimation;n.duration=500,n.timingFunction="EaseOut",n.setEndValue((()=>{t.style={transform:{translate:{y:0}}}})),i.on("end",(()=>{setTimeout((()=>{t.addAnimation(n,"end")}),2500)})),n.on("end",e),t.addAnimation(i,"show")}createWeakCard(){let t=new TKView;t.style={position:"absolute",left:16,bottom:-28,flexDirection:"row",width:193,height:28,backgroundColor:"#00000080",paddingHorizontal:8,borderRadius:4,justifyContent:"space-between",alignItems:"center"};let e=new TKText;e.style={color:"#FFFFFF",fontSize:8,height:12,width:22,textAlign:"center",backgroundColor:"#FE3666FF",borderRadius:2},e.setText("预告"),t.appendChild(e);let i=new TKText;i.style={color:"#FFFFFF",fontSize:12,textAlign:"center",width:97,textLineClamp:1,textOverflow:"ellipsis"},i.setText(this.vm.getLiveSubscribeModel().name),t.appendChild(i);let n=new TKView;n.style={width:1,height:12,backgroundColor:"#FFFFFF66",marginHorizontal:8},t.appendChild(n);let s=new TKText;return s.setText("感兴趣"),s.style={color:"#FFFFFF",fontSize:12,textAlign:"center"},t.appendChild(s),t}createBigCard(){let e=new TKView;e.style={height:146,flexDirection:"column",justifyContent:"space-between",position:"absolute",bottom:-162,paddingHorizontal:12,paddingBottom:12,paddingTop:6,left:16,right:16,backgroundColor:"#FFFFFF",borderRadius:12},this.vm.isScreenPortrait()||(e.style={width:343});let i=this.newKwaiLogoView();e.appendChild(i);let n=this.newContentView();this.addClickConvert(n,2,t.CARD_OTHERAREA_CLICK),e.appendChild(n);let s=this.newActionButton("100%",48,ft(this.vm.adInfo));return this.addClickConvert(s,1,t.CARD_ACTION_BAR_CLICK),e.appendChild(s),this.addClickConvert(e,2,t.CARD_OTHERAREA_CLICK),e}newActionButton(t,e,i){let n=new TKButton;return n.style={width:t,height:e,borderRadius:e/2,backgroundColor:"#FE3666FF",color:"#FFFFFFFF",fontSize:14,textAlign:"center"},n.setText(i),n}newKwaiLogoView(){let t=new TKImage;return t.style={width:20,height:20,topRightRadius:10,bottomLeftRadius:10,position:"absolute",top:0,right:0},Ve(t,"icon_ksad_kwai_logo.png"),t}newContentView(){let t=new TKView;t.style={flexDirection:"column",justifyContent:"center",alignItems:"flex-start"};let e=new TKText;e.style={color:"#222222FF",fontSize:16,fontWeight:"medium",marginBottom:4};let i=new TKView;i.style={flexDirection:"row",justifyContent:"flex-start",alignItems:"center",height:21};let n=new TKImage;n.style={width:16,height:16},Ve(n,"icon_ksad_clock.png");let s=new TKText;s.style={color:"#666666FF",fontSize:12},i.appendChild(n),i.appendChild(s),e.setText(this.vm.getLiveSubscribeModel().name),s.setText(this.vm.getLiveSubscribeModel().desc),t.appendChild(e),t.appendChild(i);let a=new TKView;a.style={width:"100%",height:80,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"};let o=this.newUserIconView();return a.appendChild(o),a.appendChild(t),a}newUserIconView(){let t=new TKView;t.style={width:68,height:80,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"};let e=new TKImage;return e.style={width:60,height:60,borderRadius:30,borderWidth:1,borderColor:"#FE3666"},e.setSrc(this.vm.getLiveSubscribeModel().iconUrl),this.liveLabelView=new ms,t.appendChild(e),t.appendChild(this.liveLabelView),t}addClickConvert(t,e,i){t.addEventListener("tap",(n=>{console.log("KSAdLiveSubscribe click: "+i);const s=pe(n,t);this.vm.convert(1,e,s,i)}))}}class ms extends TKView{constructor(){super(),this.halfPeriodDuration=100,this.halfPeriodDegree=8,this.newLiveLabelView()}startRotate(){this.rotateAnimation=new TKKeyframeAnimation,this.rotateAnimation.duration=800,this.rotateAnimation.timingFunction="EaseOut",this.rotateAnimation.setAnimations([()=>(this.setStyle(this,this.halfPeriodDegree),.125),()=>(this.setStyle(this,-2*this.halfPeriodDegree),.375),()=>(this.setStyle(this,2*this.halfPeriodDegree),.625),()=>(this.setStyle(this,-2*this.halfPeriodDegree),.875),()=>(this.setStyle(this,this.halfPeriodDegree),1)]),this.addAnimation(this.rotateAnimation,"rotate")}newLiveLabelView(){let t=new TKText;t.setText("直播"),t.style={height:14,width:30,fontSize:10,textAlign:"center",color:"#FFFFFF",backgroundColor:"#FE3666",topLeftRadius:8,topRightRadius:8,bottomRightRadius:8};this.style={width:60,height:28,position:"absolute",flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-start",top:5,right:0},this.appendChild(t)}setStyle(t,e){t.style={transform:{rotate:e}}}}class gs{constructor(){this.tagViewStyle=0,this.height=18,this.tagBorderRadius=2,this.tagFontSize=12,this.tagFontWeight="normal",this.customBackgroundColor="#FFFFFF",this.customTextColor="#FE3666",this.customShadowColor="",this.tagPadding=8,this.tagDividerSize=8}static create(t){return Object.assign(new gs,t)}}class us extends TKView{constructor(t,e){if(super(),t&&t.length>0){e||(e=new gs),this.style={flexDirection:"row",alignItems:"center",flexWrap:"wrap",height:e.height};let i=new TKView;i.style={display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap",height:e.height,overflow:"hidden"},i.clipChildren=!0,this.appendChild(i),this.tagArray=new Array;let n=t.length>3?3:t.length,s="#FFFFFF",a="#FE3666",o="#FE3666",r="normal",h="";1==e.tagViewStyle&&(s="#FFE1E8",a="#FFFFFF00",o="#FE3666",r="medium"),2==e.tagViewStyle&&(s="#FFFFFF",a="#666666",o="#666666",r="normal"),3==e.tagViewStyle&&(s=e.customBackgroundColor,a="#FFFFFF00",o=e.customTextColor,r="normal",h=e.customShadowColor);let l=0;for(;l<n;++l){let r=new TKText;r.style={backgroundColor:s,textAlign:"center",height:e.height,paddingLeft:e.tagPadding,paddingRight:e.tagPadding,marginRight:l==n-1?0:e.tagDividerSize,color:o,borderWidth:1,fontSize:e.tagFontSize,fontWeight:e.tagFontWeight,borderColor:a,borderRadius:e.tagBorderRadius},r.setText(t[l].text),me(h)&&(r.style={shadow:h}),i.appendChild(r)}}}}class ws extends ji{constructor(t,e,i,n){super(),this.renderSuccess=!1,this.isCanConvert=!1,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.screenOrientation=n}getValidClickConvertTime(){try{return this.configInfo.appConfig.validClickConvertTime}catch(t){}return 1e3}getPlayableDeeplinkLimitedTimeMs(){try{return this.adInfo.adConversionInfo.playableDeeplinkLimitedTimeMs}catch(t){}return 0}}class Cs extends ji{constructor(t,e,i,n){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.screenOrientation=n,this.setupData()}setupData(){this.playableVM=new ws(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation)}getPlayableUrl(){try{const t=this.adInfo.adConversionInfo.playableUrl;if(me(t))return t}catch(t){}return""}}class fs extends Fi{constructor(t){super(t),this.cardDelayShowTime=5,0==this.vm.screenOrientation?this.setupVerticalStyle():this.setupHorizonalStyle(),this.setupActions()}setupHorizonalStyle(){this.style={flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",paddingLeft:16,paddingRight:16,backgroundColor:"#000000B2"},this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),this.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,fontWeight:"medium",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",marginTop:16},this.nameLabel.setText(this.vm.getAdTitle()),this.appendChild(this.nameLabel);let t=this.vm.getAdTagList();if(this.hasTags=t&&t.length>0,this.hasScore=this.vm.getAppScore()>=30,this.hasScore||this.hasTags){let e=!1;const i=new TKView;if(i.style={flexDirection:"row",justifyContent:"center",alignItems:"center",width:"100%",height:18,marginTop:8},this.appendChild(i),this.hasScore){e=!0;const t=this.vm.getAppScore();this.scoreView=new bi(t),this.scoreView.style={width:75},i.appendChild(this.scoreView)}this.hasTags&&(this.tagView=new us(t),this.tagView.style={paddingLeft:e?80:0},i.appendChild(this.tagView))}this.descLabel=new TKText,this.descLabel.style={textLineClamp:2,fontSize:14,color:"#FFFFFF",marginTop:12,textOverflow:"ellipsis",textAlign:"center"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),this.appendChild(this.descLabel),this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={flexDirection:"row",justifyContent:"center",width:252,height:40,marginBottom:12,marginLeft:5,marginRight:5,alignItems:"center",marginTop:24},this.appendChild(this.bottomBtnContainer);const e=this.vm.getPlayableStyle();this.playBtn=new TKText,this.playBtn.style={fontSize:14,fontWeight:"medium",backgroundColor:"#FFFFFF33",topLeftRadius:20,bottomLeftRadius:20,topRightRadius:1==e?20:0,bottomRightRadius:1==e?20:0,height:40,flexGrow:2,textAlign:"center",color:"#FFFFFF",marginRight:1==e?15:0},this.playBtn.setText("试玩一下"),this.bottomBtnContainer.appendChild(this.playBtn),this.actionBtn=new TKText,this.actionBtn.style={fontSize:14,fontWeight:"medium",color:"#FFFFFF",backgroundColor:"#FE3666",bottomRightRadius:20,topRightRadius:20,topLeftRadius:1==e?20:0,bottomLeftRadius:1==e?20:0,height:40,flexGrow:2,textAlign:"center"},Ci(this.actionBtn,"text",this.vm.$attrsPath.actionText),this.bottomBtnContainer.appendChild(this.actionBtn)}setupVerticalStyle(){let t=this.vm.getAdTagList();this.hasTags=t&&t.length>0,this.hasScore=this.vm.getAppScore()>=30,this.cardHeight=this.hasScore||this.hasTags?156:136,this.style={width:"100%",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16},this.logoView=new Vi(1,this.vm.adInfo),this.logoView.style={marginBottom:8},this.appendChild(this.logoView),this.bottomContainer=new TKView,this.bottomContainer.style={backgroundColor:"#FFFFFF",height:this.cardHeight,width:"100%",paddingLeft:12,paddingRight:12,paddingTop:12,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,borderRadius:12},this.appendChild(this.bottomContainer);const e=new TKView;e.style={flexDirection:"row",width:"100%",position:"relative"},this.bottomContainer.appendChild(e);const i=new TKView;if(i.style={width:"100%",height:58,paddingLeft:70,flexDirection:"column",justifyContent:"space-around"},e.appendChild(i),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),e.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,fontWeight:"medium",color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},i.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),this.hasScore||this.hasTags){let e=!1;const n=new TKView;if(n.style={flexDirection:"row",width:"100%",height:18,marginTop:6,position:"relative"},i.appendChild(n),this.hasScore){e=!0;const t=this.vm.getAppScore();this.scoreView=new bi(t),this.scoreView.style={width:75,position:"absolute",left:0,bottom:3.5},n.appendChild(this.scoreView)}this.hasTags&&(this.tagView=new us(t),this.tagView.style={paddingLeft:e?80:0},n.appendChild(this.tagView)),this.bottomContainer.appendChild(this.descLabel)}else i.appendChild(this.descLabel);this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={flexDirection:"row",justifyContent:"center",width:"100%",height:40,marginBottom:12,alignItems:"center"},this.bottomContainer.appendChild(this.bottomBtnContainer);const n=this.vm.getPlayableStyle();this.playBtn=new TKText,this.playBtn.style={fontSize:14,fontWeight:"medium",backgroundColor:"#FE366619",topLeftRadius:20,bottomLeftRadius:20,topRightRadius:1==n?20:0,bottomRightRadius:1==n?20:0,height:40,flexGrow:2,textAlign:"center",color:"#FE3666",marginRight:1==n?15:0},this.playBtn.setText("试玩一下"),this.bottomBtnContainer.appendChild(this.playBtn),this.actionBtn=new TKText,this.actionBtn.style={fontSize:14,fontWeight:"medium",color:"#FFFFFF",backgroundColor:"#FE3666",bottomRightRadius:20,topRightRadius:20,topLeftRadius:1==n?20:0,bottomLeftRadius:1==n?20:0,height:40,flexGrow:2,textAlign:"center"},Ci(this.actionBtn,"text",this.vm.$attrsPath.actionText),this.bottomBtnContainer.appendChild(this.actionBtn),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}setupActions(){this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),this.playBtn.addEventListener("tap",(t=>{this.vm.showPlayable(5)})),this.actionBtn.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),this.bottomContainer&&this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.scoreView&&this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.playBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.actionBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.bottomContainer&&Nt(this.bottomContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}getHeight(){return 1==this.vm.screenOrientation?this.vm.containerLimit.height:this.cardHeight+16+8+16}}class ys extends TKView{constructor(t){super(),this.mTimer=-1,this.mCurrentIndex=0,this.stopRolling=!1,this.mEndCallback=t=>{this.removeChild(t),this.mCurrentIndex++,this.startRolling()},this.mItemTradeInfoList=t,this.setupViews(),this.startRolling()}setupViews(){this.style={width:"100%",height:"100%"}}startRolling(){if(this.stopRolling||!this.mItemTradeInfoList)return;let t=this.mCurrentIndex%this.mItemTradeInfoList.length,e=this.mItemTradeInfoList[t];Ce(e)||this.addRollingTipsItemView(e,this.mEndCallback)}addRollingTipsItemView(t,e){this.tipItemView=new Ts(t,e),this.tipItemView.style={position:"absolute",top:36,left:0,alignSelf:"center",width:143,height:24},this.appendChild(this.tipItemView),this.tipItemView.startRollAnimation()}}class Ts extends TKView{constructor(t,e){super(),this.mTradeInfo=t,this.mOnRollEnd=e,this.setupViews()}setupViews(){this.style={flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:"#00000080",borderColor:"#FFFFFF33",height:24,paddingHorizontal:4,borderWidth:1,borderRadius:4,opacity:0};let t=new TKImage;t.style={width:16,height:16,borderRadius:8,marginRight:4},t.setSrc(this.mTradeInfo.buyerImage),this.appendChild(t);let e=new TKText;e.style={fontSize:12,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",color:"#FFFFFF"},e.setText(this.mTradeInfo.tradeMessage),this.appendChild(e)}startRollAnimation(){let t=1600,e=new TKKeyframeAnimation;e.duration=t;let i=this;e.on("end",(()=>{this.mOnRollEnd&&this.mOnRollEnd(i)})),e.setAnimations([()=>(this.style={opacity:0,transform:{translate:{y:0}}},0),()=>(this.style={opacity:1,transform:{translate:{y:-10}}},.1875),()=>(this.style={opacity:1},.8125),()=>(this.style={opacity:0,transform:{scale:.9,translate:{y:-30}}},1)]),this.addAnimation(e,"rollAnimation")}}class Is extends Fi{constructor(t){super(t),this.bottomBgColor="90,#000000D0,#00000000",this.setupSubviews(),this.addActions()}setupSubviews(){this.style={width:"100%",height:224,position:"absolute",bottom:0};let t=new TKView;t.style={width:"100%",height:"100%",gradientBgColor:this.bottomBgColor,position:"absolute",bottom:0},this.appendChild(t);let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",position:"absolute",paddingBottom:16,paddingLeft:16,paddingRight:16,bottom:0},this.appendChild(e),this.rolllingTipsView=new ys(this.vm.deepVideoModel.getDeepVideoOrderList()),this.rolllingTipsView.style={flexBasis:160,height:60,flexShrink:1,flexGrow:1},e.appendChild(this.rolllingTipsView);let i=new TKView;i.style={width:"100%",height:20,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},e.appendChild(i),this.nameLabel=new TKText,this.nameLabel.style={fontSize:15,color:"#FEFFFE"},this.nameLabel.setText("@"+this.vm.deepVideoModel.getDeepVideoAuthorName()),i.appendChild(this.nameLabel),this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={marginLeft:10},i.appendChild(this.logoView),this.descLabel=new TKText,this.descLabel.style={marginTop:5,fontSize:14,color:"#FEFFFE",textLineClamp:2,textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel)}addActions(){let e=this.vm.deepVideoModel.getDeepVideCardStyle(),i=new b;i.merchant_play_card_style=e,this.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_OTHERAREA_CLICK,i)})),this.nameLabel.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK,i)})),this.descLabel.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK,i)})),this.rolllingTipsView.addEventListener("tap",(e=>{this.vm.convert(1,2,{x:e.position.rawX,y:e.position.rawY},t.CARD_TROLLEY_ICON_CLICK,i)})),this.vm.supportSlideClick()&&(Nt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.descLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.rolllingTipsView,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}}class vs extends Fi{constructor(t){super(t),this.isAnimation=!1,this.setupSubviews(),this.refreshDatas(),this.addActions()}setupSubviews(){this.style={width:"100%",height:312,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",position:"absolute",paddingLeft:16,paddingRight:16,paddingBottom:16,bottom:0};let t=new TKView;t.style={width:120,height:120,marginTop:32,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(t),this.goodsImage=new TKImage,this.goodsImage.style={width:120,height:120,backgroundColor:"#FF0000",borderRadius:8},t.appendChild(this.goodsImage),this.goodsLabel=new TKText,this.goodsLabel.style={width:84,height:21,fontSize:12,textAlign:"center",color:"#FFFFFF",backgroundColor:"#00000080",position:"absolute",top:1,left:1,topLeftRadius:8,bottomRightRadius:8},t.appendChild(this.goodsLabel),this.goodsTitle=new TKText,this.goodsTitle.style={marginTop:16,fontSize:16,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},this.appendChild(this.goodsTitle),this.appendActionBarView(),this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={position:"absolute",bottom:16,left:12},this.appendChild(this.logoView)}appendActionBarView(){this.actionBarContainer=new TKView,this.actionBarContainer.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.actionBarContainer),this.vm.deepVideoModel.isDeepVideoShowLowPrice()?this.appendDoubleActionBarView():(this.actionBarView=new TKView,this.actionBarView.style={height:48,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.actionBarContainer.appendChild(this.actionBarView),this.rightActionBar=new TKView,this.rightActionBar.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.actionBarView.appendChild(this.rightActionBar),this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText))}appendDoubleActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={marginTop:16,height:48,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row"},this.actionBarContainer.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"58%",height:48,backgroundColor:"#FFE5EBFF",flexDirection:"row",alignItems:"center",topLeftRadius:24,bottomLeftRadius:24,justifyContent:"center"};let t=new TKText;t.style={fontSize:16,color:"#FE3666",fontWeight:"medium"},t.setText("抢购价￥"),this.leftActionBar.appendChild(t),this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:28,color:"#FE3666",fontWeight:"medium",marginBottom:5},this.leftActionBar.appendChild(this.leftActionBarText);let e=new TKImage;e.style={width:"9%",height:48},Ve(e,"direct_ec_sep.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"33%",height:48,topRightRadius:24,bottomRightRadius:24,paddingRight:25,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(e),this.actionBarView.appendChild(this.rightActionBar)}refreshDatas(){this.goodsLabel.setText(this.vm.deepVideoModel.getDeepVideoGoodsIconlabel()),this.goodsImage.setSrc(this.vm.deepVideoModel.getDeepVideoGoodsIcon()),this.goodsTitle.setText(this.vm.deepVideoModel.getDeepVideoGoodsTitle()),this.leftActionBarText&&this.leftActionBarText.setText(this.vm.deepVideoModel.getDeepVideoPrice()),this.rightActionBarText.setText(this.vm.deepVideoModel.getActionBarDesc())}addActions(){let e=new b;e.merchant_play_card_style=1,this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.goodsImage.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.goodsLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.goodsTitle.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.rightActionBar.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&(Nt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsImage,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsTitle,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}showActionBarAnim(){this.isAnimation||(this.isAnimation=!0,Si(1e3,this.actionBarView,(()=>{this.isAnimation=!1})))}}class As extends Fi{constructor(t){super(t),this.isAnimation=!1,this.setupSubviews(),this.refreshDatas(),this.addActions()}setupSubviews(){this.style={width:"100%",height:308,flexDirection:"column",justifyContent:"flex-start",alignItems:"center",position:"absolute",paddingLeft:16,paddingRight:16,paddingBottom:16,bottom:0};let t=new TKView;t.style={width:120,height:120,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(t),this.goodsImage=new TKImage,this.goodsImage.style={width:120,height:120,borderWidth:1,borderColor:"#FFFFFF",borderRadius:8},t.appendChild(this.goodsImage),this.goodsLabel=new TKText,this.goodsLabel.style={width:84,height:21,fontSize:12,color:"#FFFFFF",backgroundColor:"#00000080",position:"absolute",textAlign:"center",top:1,left:1,topLeftRadius:8,bottomRightRadius:8},t.appendChild(this.goodsLabel),this.goodsTitle=new TKText,this.goodsTitle.style={marginTop:16,fontSize:16,color:"#FFFFFF",textLineClamp:2,textOverflow:"ellipsis"},this.appendChild(this.goodsTitle),this.appendActionBarView(),this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={position:"absolute",bottom:16,left:12},this.appendChild(this.logoView)}appendActionBarView(){this.actionBarContainer=new TKView,this.actionBarContainer.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.actionBarContainer),this.vm.deepVideoModel.isDeepVideoShowLowPrice()?this.appendDoubleActionBarView():(this.actionBarView=new TKView,this.actionBarView.style={height:80,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.actionBarContainer.appendChild(this.actionBarView),this.rightActionBar=new TKView,this.rightActionBar.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.actionBarView.appendChild(this.rightActionBar),this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText))}appendDoubleActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={marginTop:16,height:48,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row"},this.actionBarContainer.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"58%",height:48,backgroundColor:"#FFFFFF32",flexDirection:"row",alignItems:"center",topLeftRadius:24,bottomLeftRadius:24,justifyContent:"center"};let t=new TKText;t.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},t.setText("抢购价￥"),this.leftActionBar.appendChild(t),this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:28,color:"#FFFFFF",fontWeight:"medium",marginBottom:5},this.leftActionBar.appendChild(this.leftActionBarText);let e=new TKImage;e.style={width:"9%",height:48,marginLeft:.5},Ve(e,"deepvide_style3_sep.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"33%",height:48,topRightRadius:24,bottomRightRadius:24,paddingRight:25,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(e),this.actionBarView.appendChild(this.rightActionBar)}refreshDatas(){this.goodsLabel.setText(this.vm.deepVideoModel.getDeepVideoGoodsIconlabel()),this.goodsImage.setSrc(this.vm.deepVideoModel.getDeepVideoGoodsIcon()),this.goodsTitle.setText(this.vm.deepVideoModel.getDeepVideoGoodsTitle()),this.leftActionBarText&&this.leftActionBarText.setText(this.vm.deepVideoModel.getDeepVideoPrice()),this.rightActionBarText.setText(this.vm.deepVideoModel.getActionBarDesc())}addActions(){let e=new b;e.merchant_play_card_style=2,this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.goodsImage.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.goodsLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.goodsTitle.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.rightActionBar.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&(Nt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsImage,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsTitle,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}showActionBarAnim(){this.isAnimation||(this.isAnimation=!0,Si(1e3,this.actionBarView,(()=>{this.isAnimation=!1})))}}class Vs extends Fi{constructor(t){super(t),this.isAnimation=!1,this.setupSubviews(),this.refreshDatas(),this.addActions()}setupSubviews(){this.style={width:"100%",height:224,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",position:"absolute",paddingLeft:40,paddingRight:40,paddingBottom:16,bottom:0};let t=new TKView;t.style={marginTop:12,width:"100%",height:50,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.appendChild(t),this.goodsImage=new TKImage,this.goodsImage.style={width:50,height:50,borderWidth:1,borderColor:"#FFFFFF",borderRadius:8},t.appendChild(this.goodsImage),this.goodsTitle=new TKText,this.goodsTitle.style={marginLeft:8,fontSize:24,color:"#FFFFFF",flexShrink:1,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.goodsTitle),this.goodsDesc=new TKText,this.goodsDesc.style={marginTop:8,fontSize:14,color:"#FFFFFF",textAlign:"left",textLineClamp:2,textOverflow:"ellipsis"},this.appendChild(this.goodsDesc),this.appendActionBarView(),this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={position:"absolute",bottom:16,left:12},this.appendChild(this.logoView)}appendActionBarView(){this.actionBarContainer=new TKView,this.actionBarContainer.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(this.actionBarContainer),this.vm.deepVideoModel.isDeepVideoShowLowPrice()?this.appendDoubleActionBarView():(this.actionBarView=new TKView,this.actionBarView.style={height:80,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.actionBarContainer.appendChild(this.actionBarView),this.rightActionBar=new TKView,this.rightActionBar.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.actionBarView.appendChild(this.rightActionBar),this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText))}appendDoubleActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={marginTop:16,height:48,width:"100%",flexDirection:"row"},this.actionBarContainer.appendChild(this.actionBarView),this.leftActionBar=new TKView,this.leftActionBar.style={width:"58%",height:48,backgroundColor:"#FFFFFF32",flexDirection:"row",alignItems:"center",topLeftRadius:24,bottomLeftRadius:24,justifyContent:"center"};let t=new TKText;t.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},t.setText("抢购价￥"),this.leftActionBar.appendChild(t),this.leftActionBarText=new TKText,this.leftActionBarText.style={fontSize:28,color:"#FFFFFF",fontWeight:"medium",marginBottom:5},this.leftActionBar.appendChild(this.leftActionBarText);let e=new TKImage;e.style={width:"9%",height:48},Ve(e,"deepvide_style3_sep.png"),this.rightActionBar=new TKView,this.rightActionBar.style={width:"33%",height:48,topRightRadius:24,bottomRightRadius:24,paddingRight:25,backgroundColor:"#FE3666",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.rightActionBarText=new TKText,this.rightActionBarText.style={fontSize:16,color:"#FFFFFF",fontWeight:"medium"},this.rightActionBar.appendChild(this.rightActionBarText),this.actionBarView.appendChild(this.leftActionBar),this.actionBarView.appendChild(e),this.actionBarView.appendChild(this.rightActionBar)}refreshDatas(){this.goodsImage.setSrc(this.vm.deepVideoModel.getDeepVideoGoodsIcon()),this.goodsTitle.setText(this.vm.deepVideoModel.getDeepVideoGoodsTitle()),this.goodsDesc.setText(this.vm.getAdDescription()),this.leftActionBarText&&this.leftActionBarText.setText(this.vm.deepVideoModel.getDeepVideoPrice()),this.rightActionBarText.setText(this.vm.deepVideoModel.getActionBarDesc())}addActions(){let e=new b;e.merchant_play_card_style=3,this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.goodsImage.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.goodsDesc.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.goodsTitle.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.rightActionBar.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&(Nt(this,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsImage,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsDesc,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.goodsTitle,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.rightActionBar,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})))}showActionBarAnim(){this.isAnimation||(this.isAnimation=!0,Si(1e3,this.actionBarView,(()=>{this.isAnimation=!1})))}}class bs extends Fi{constructor(t){super(t),this.deepVideoStyle=1,this.deepVideoStyle=this.vm.deepVideoModel.getDeepVideCardStyle(),this.setupSubviews(),this.reportCardImpression()}setupSubviews(){this.style={width:"100%",height:this.getHeight(),flexDirection:"column",justifyContent:"flex-end",position:"relative",flexWrap:"no-wrap"},this.baseView=new Is(this.vm),this.appendChild(this.baseView),this.vm.deepVideoModel.getActionBarDesc(),3==this.deepVideoStyle?this.styleView=new Vs(this.vm):2==this.deepVideoStyle?this.styleView=new As(this.vm):this.styleView=new vs(this.vm),this.styleView.style={opacity:0,visibility:"hidden"},this.appendChild(this.styleView)}reportCardImpression(){let t=new b;t.merchant_play_card_style=this.deepVideoStyle;let e={clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}getHeight(){return 3==this.deepVideoStyle?224:2==this.deepVideoStyle?308:312}getVideoHeight(){return 3==this.deepVideoStyle?244:2==this.deepVideoStyle?268:332}getVideoTop(){return 3==this.deepVideoStyle||2==this.deepVideoStyle?60:0}getVideoRadius(){return 3==this.deepVideoStyle||2==this.deepVideoStyle?8:0}transfromBottomBar(){this.styleView.style={visibility:"visible"};let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.baseView.style={opacity:1},0),()=>(this.baseView.style={opacity:0},1)]),t.duration=300,t.timingFunction="EaseInEaseOut",t.on("end",(t=>{this.baseView.style={visibility:"hidden"},2==this.deepVideoStyle?setTimeout((()=>{this.showGoodsInfoView()}),200):this.showGoodsInfoView()})),this.baseView.addAnimation(t,"baseViewAnim")}showGoodsInfoView(){let t=new TKKeyframeAnimation;if(t.setAnimations([()=>(this.styleView.style={opacity:0},0),()=>(this.styleView.style={opacity:1},1)]),t.duration=300,t.timingFunction="EaseInEaseOut",this.styleView.addAnimation(t,"styleViewAnim"),3!=this.deepVideoStyle){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.styleView.style={top:100},0),()=>(this.styleView.style={top:0},1)]),t.duration=300,t.timingFunction="EaseInEaseOut",this.styleView.addAnimation(t,"styleMoveAnim")}}showActionBarAnim(){this.styleView&&this.styleView.showActionBarAnim()}}class Ss{show(t){}dismiss(){}setTemplateInfo(t){}registerBridge(t){}setOnDismissListener(t){}}let xs,_s,Ls;xs="undefined"==typeof KSAdDialog?Ss:KSAdDialog;class Ds extends xs{}class Fs{setBridgeHandler(t){}callJS(t){}}_s="undefined"==typeof KSAdTKJsBridge?Fs:KSAdTKJsBridge;class ks extends _s{constructor(){super(),this.bridgeHandlers=new Map;const t=this;this.setBridgeHandler((e=>{let i=e;"string"==typeof e&&(i=JSON.parse(e));const n=e=>{t.callbackJS(i.callback,{result:1,data:e})},s=(e,n)=>{t.callbackJS(i.callback,{result:e,error_msg:n})},a=t.handlerForName(i.action);console.log("tkloadcontroller  call bridge:"+JSON.stringify(e)+" handler:"+a+" data:"+i.data),a?a.handleJsCall(i.data,n,s):s(-1,"bridge handle not registered")}))}registerBridgeHandler(t){this.bridgeHandlers.set(t.getName(),t)}handlerForName(t){return this.bridgeHandlers.get(t)}callbackJS(t,e){if(console.log("tkloadcontroller callback js:"+t+" param:"+JSON.stringify(e)),"string"==typeof t){const i=t;this.callJS(i+"("+JSON.stringify(e)+")")}else{t(e)}}}class Rs{handleJsCall(t,e,i){}getName(){return""}}class Bs extends Rs{constructor(){super()}getName(){return"clickAction"}handleJsCall(t,e,i){const n=JSON.parse(t);if(Ce(n.area)||Ce(n.logParam))i(0,"no data");else{if(this.clickCallback)this.clickCallback(n);else if(ei.matchTKConversion()){let t=JSON.parse(n.logParam.payload);ei.convertIfNeeded(n.logParam.sceneType,O(ie()),n.area,n.logParam.clickInfo,n.itemClickType,null,t,null,n.creativeId,null)}else ke.clickActionBase(n);e(null)}}}class Ks extends Rs{constructor(){super()}getName(){return"commercialLog"}handleJsCall(t,e,i){const n=JSON.parse(t),s=n;Ce(n)?i(0,"no data"):(e(null),Le.supportMinimumTKVersion("4.0.4")&&ke.sendCommercialLog(s))}}class Es extends Rs{constructor(t){super(),this.configInfo=t}getName(){return"getKsAdConfig"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.configInfo?e(this.configInfo):i(0,"no data")}}class Ps extends Rs{constructor(t){super(),this.adOriginInfo=t}getName(){return"getKsAdData"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.adOriginInfo?(e(this.adOriginInfo),console.log("KSAdGetAdDataHandler=========>GetAdData ad count = "+this.adOriginInfo.impAdInfo.length)):(i(0,"no data"),console.log("KSAdGetAdDataHandler=========>GetAdData no data"))}}class Os extends Rs{constructor(t){super(),this.containerLimit=t}getName(){return"getContainerLimit"}handleJsCall(t,e,i){if(console.log("tkloadcontroller call :"+this.getName()),this.containerLimit){e({width:this.containerLimit.width,height:this.containerLimit.height})}else i(0,"no data")}}class Ms extends Rs{constructor(t){super(),this.deviceInfo=t}getName(){return"getDeviceInfo"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()+this.deviceInfo),this.deviceInfo?e(this.deviceInfo):i(0,"no data")}}class Ns extends Rs{constructor(){super()}getName(){return"log"}handleJsCall(t,e,i){const n=JSON.parse(t);if(Tachikoma.env.isService&&this.adResult&&!n.adTemplate){let t=this.creativeId||n.creativeId;n.adTemplate=JSON.stringify(E(this.adResult,t))}console.log("tkloadcontroller handle log:"+JSON.stringify(n)),Ce(n)?i(0,"no data"):(ke.sendLog(n),e(null))}}class Hs extends Rs{constructor(t){super(),this.screenOrientation=t}getName(){return"getScreenOrientation"}handleJsCall(t,e,i){if(Ce(this.screenOrientation))i(0,"no data");else{e({screenOrientation:this.screenOrientation})}}}class Ws extends Rs{constructor(){super()}getName(){return"closeTKDialog"}handleJsCall(t,e,i){this.closeCallback&&this.closeCallback(),e(null)}}class zs extends Rs{constructor(){super(),this.isMoreShow=!1,this.isPreLandingPage=!1}getName(){return"getTKPreEnv"}handleJsCall(t,e,i){e({isPreLandingPage:this.isPreLandingPage,isMoreShow:this.isMoreShow})}}class Us extends Rs{constructor(){super()}getName(){return"skipVideo"}handleJsCall(t,e,i){const n=JSON.parse(t);if(Ce(n))i(0,"no data");else{const t=n.needPromopt,i=n.needReport,s=n.showTime;this.skipCallback&&this.skipCallback(t,i,s),e(null)}}}class Gs extends Ds{constructor(t){super(),this.vm=t,this.registerBridgeHandle(),this.setupView()}setupView(){this.setTemplateInfo(this.vm.getTemplateInfo())}showConfirm(t=!1,e){const i=this;this.getTKPreEnvHandler.isMoreShow=t,this.show(((t,n)=>{t?(i.vm.isShow=!0,i.dismissListener()):e&&e()}))}registerBridgeHandle(){this.setOnDismissListener((()=>{console.log("KSAdNeoConfirmView=====++++++ dismiss")}));const t=new ks,e=this,i=new Ps(this.vm.adOriginInfo);t.registerBridgeHandler(i);const n=new Es(this.vm.configInfo);t.registerBridgeHandler(n);const s=new Ms(te());t.registerBridgeHandler(s);const a=new Hs(this.vm.screenOrientation);t.registerBridgeHandler(a);const o=new Us;o.skipCallback=(t,i,n)=>{ei.skip(),e.vm.handleSkipCallback&&e.vm.handleSkipCallback(t,i,n)},t.registerBridgeHandler(o);const r=new Ws;r.closeCallback=()=>{this.dismiss()},t.registerBridgeHandler(r);const h=new Ks;t.registerBridgeHandler(h);const l=new Ns;t.registerBridgeHandler(l);const d=new Os(this.vm.containerLimit);t.registerBridgeHandler(d);const c=new Bs;t.registerBridgeHandler(c),this.registerBridge(t),this.getTKPreEnvHandler=new zs,t.registerBridgeHandler(this.getTKPreEnvHandler)}dismissListener(){this.setOnDismissListener((()=>{this.vm.isShow=!1}))}}class js extends TKView{constructor(t){super(),this.rowCount=3,this.rowHeight=32,this.currentGetTextIndex=0,this.mDanmakuRollTimer=0,this.mRowContainers=new Array,this.mLastAddRowIndex=-1,this.mTextList=t,this.setupViews()}setupViews(){this.style={flexDirection:"column",justifyContent:"space-between",alignItems:"center"};for(let t=0;t<this.rowCount;t++){let t=this.createRowListView();this.mRowContainers.push(t),this.appendChild(t)}}startRoll(){this.mDanmakuRollTimer=setInterval((()=>{if(this.currentGetTextIndex>=this.mTextList.length)return void this.stop();let t=Math.floor(Math.random()*this.rowCount);t==this.mLastAddRowIndex&&(t=(t+1)%this.rowCount),this.addDanmakuItem(this.mRowContainers[t],this.getItemText()),this.mLastAddRowIndex=t}),1500)}stop(){this.mDanmakuRollTimer&&clearInterval(this.mDanmakuRollTimer)}createRowListView(){let t=new TKView;return t.style={width:1e3,height:this.rowHeight},t}addDanmakuItem(t,e){let i=new Ys(e,this.rowHeight,(()=>{t.removeChild(i)}));i.style={position:"absolute",right:0},setTimeout((()=>{i.startTransXAnimation()}),100),t.appendChild(i)}getItemText(){let t=this.currentGetTextIndex%this.mTextList.length,e=this.mTextList[t];return this.currentGetTextIndex++,e}}class Ys extends TKView{constructor(t,e,i){super(),this.transDuration=8e3,this.transX=-700,this.mTextViewHeight=e,this.mText=t,this.mAnimEndCallback=i,this.setupViews()}setupViews(){this.style={height:this.mTextViewHeight,borderRadius:this.mTextViewHeight/2,backgroundColor:"#00000033",flexDirection:"row",paddingHorizontal:this.mTextViewHeight/2,justifyContent:"center",alignItems:"center"};let t=new TKText;t.style={fontSize:14,color:"#FFFFFF",marginRight:8},t.setText(this.mText),this.appendChild(t);let e=new TKImage;e.style={width:16,height:14},Ve(e,"icon_ksad_plus_one.png"),this.appendChild(e)}startTransXAnimation(){let t=new TKBasicAnimation;t.duration=this.transDuration,t.timingFunction="linear",t.setEndValue((()=>{this.style={transform:{translate:{x:this.transX}}}})),t.on("end",this.mAnimEndCallback),this.addAnimation(t,"transX")}}class Xs extends TKView{constructor(t,e,i,n){super(),this.showAtBottom=!1,this.startPositionFunc=e,this.endPositionFunc=i,this.showAtBottom=n,this.vm=t,this.setupView(),this.setupData(),this.setupActions(),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"===t&&this.stopRotateAnimation()}))}setupActions(){this.addEventListener("tap",(e=>{this.vm.convert(1,pe(e,this),t.SHAKE_BIG_ICON_CLICK)})),this.vm.isSlideClick()&&Nt(this,(()=>{this.vm.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}setupData(){this.titleView.setText("摇一摇"),this.smallTitleView.setText("摇一摇"),this.descView.setText(this.vm.getShakeSubtitle())}setupView(){let t={width:168,height:135};1==this.vm.getInteractiveStyleType()&&(t.height=150);const e=this.startPositionFunc(t);this.style={width:168,height:135,left:e.x,top:e.y,position:"absolute",justifyContent:"center",alignItems:"center"},1==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:150}),this.setVisibility("hidden"),this.appendShakeView()}loadFinish(){if(this.vm.startListenSensor(),fi(this.vm.$attrsPath.callerContext.pageFocusAndVisible,(t=>{this.vm.callerContext.hasShowPlayend||(t?this.vm.startListenSensor():this.vm.stopListenSensor())})),this.setVisibility("visible"),this.startActionAnimation(),this.showAtBottom)return void this.showAtBottomWithoutAnimation();let t=this;setTimeout((()=>{t.textDisappearAnimation(),t.changeShakeStyleAnimation()}),3600)}showAtBottomWithoutAnimation(){this.titleContainer.style={opacity:0},this.updateSubViewsBeforeChangeAnimation(),this.updateThisFinalStyle(),this.updateShakeViewTransformStyle(),this.updateShakeViewBorderStyle(),this.updateShakeAnimViewFinalStyle(),this.updateShakeImgFinalStyle()}appendShakeView(){this.clipChildren=!0,this.smallTitleContainer=new TKView,this.smallTitleContainer.style={width:107,height:30,top:6,left:-77,backgroundColor:"#00000066",borderRadius:16,borderColor:"#FFFFFF4D",borderWidth:1,opacity:1,position:"absolute",justifyContent:"flex-start",alignItems:"flex-start",visibility:"hidden"},this.appendChild(this.smallTitleContainer),this.smallTitleView=new TKText,this.smallTitleView.style={color:"#FFFFFF",fontSize:14,fontWeight:"medium",textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",marginLeft:49,height:"100%"},this.smallTitleContainer.appendChild(this.smallTitleView),this.shakeView=new TKView,this.shakeView.style={width:110,height:110,top:0,borderRadius:55,backgroundColor:"#00000066",position:"absolute"},this.appendChild(this.shakeView),this.shakeAnimView=new TKView,this.shakeAnimView.style={width:110,height:110,left:53,top:10,position:"absolute"},this.shakeAnimView.enabled=!1,this.shakeImg=new TKImage,this.shakeImg.style={width:62,height:62},this.shakeImg.enabled=!1,this.shakeAnimView.appendChild(this.shakeImg),this.appendChild(this.shakeAnimView),this.titleContainer=new TKView,this.titleContainer.style={width:168,height:65,marginTop:81,justifyContent:"center",alignItems:"center"},this.appendChild(this.titleContainer),this.titleView=new TKText,this.titleView.style={color:"#FFFFFF",fontSize:14,fontWeight:"medium",textLineClamp:1,textOverflow:"ellipsis",textAlign:"center"},this.titleContainer.appendChild(this.titleView),this.descView=new TKText,this.descView.style={color:"#FFFFFFC8",marginTop:19,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center"},this.titleContainer.appendChild(this.descView),1==this.vm.getInteractiveStyleType()&&(this.shakeView.style={width:96,height:96},this.shakeAnimView.style={width:96,height:96,top:20},this.titleContainer.style={width:168,height:65,marginTop:106},this.titleView.style={fontSize:18},this.descView.style={marginTop:4}),be(this.shakeImg,"icon_ksad_shake_hand.png",(t=>{t&&this.loadFinish()}))}addShakeAnim(){let t=new TKKeyframeAnimation;t.animType="rotationZ";let e=Le.isAndroid()?.8:1;t.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.25,value:Le.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.33,value:-Le.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.5,value:Le.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.66,value:-Le.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.83,value:Le.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.91,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}];t.duration=1200,this.shakeAnimView&&this.shakeAnimView.addAnimation(t,"addShakeRotate")}startActionAnimation(){this.stopRotateAnimation(),this.addShakeAnim(),this.timer=setInterval((()=>{this.addShakeAnim()}),1200)}stopRotateAnimation(){this.timer&&clearInterval(this.timer),this.shakeAnimView&&this.shakeAnimView.removeAllAnimation()}textDisappearAnimation(){let t=new TKKeyframeAnimation;t.animType="opacity",t.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}],t.duration=500,this.titleContainer&&this.titleContainer.addAnimation(t,"textDisappear")}changeShakeStyleAnimation(){this.updateSubViewsBeforeChangeAnimation();let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.updateThisFinalStyle(),1)]),t.duration=500,t.timingFunction="EaseInEaseOut",this.addAnimation(t,"changeShakeStyleAnimation");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.shakeView.style={transform:{scale:1}},0),()=>(this.shakeView.style={transform:{scale:.7}},.5),()=>(this.updateShakeViewTransformStyle(),1)]),e.duration=500,e.timingFunction="EaseInEaseOut",this.shakeView.addAnimation(e,"changeShakeStyleAnim2");let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.updateShakeViewBorderStyle(),1)]),i.duration=500,i.timingFunction="EaseInEaseOut",this.shakeView.addAnimation(i,"changeShakeBorderAnim");let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.updateShakeAnimViewFinalStyle(),1)]),n.duration=500,n.timingFunction="EaseInEaseOut",this.shakeAnimView.addAnimation(n,"changeShakeStyleAnim3");let s=new TKKeyframeAnimation;s.setAnimations([()=>(this.updateShakeImgFinalStyle(),1)]),s.duration=500,s.timingFunction="EaseInEaseOut",this.shakeImg.addAnimation(s,"changeShakeStyleAnim4")}updateSubViewsBeforeChangeAnimation(){this.removeChild(this.titleContainer),this.titleContainer.removeChild(this.descView)}updateThisFinalStyle(){const t=this.endPositionFunc({width:109,height:46});this.style={width:46,height:46,left:t.x,top:t.y,position:"absolute",justifyContent:"center",alignItems:"center"}}updateShakeViewTransformStyle(){let t=-32,e=.4;return 1==this.vm.getInteractiveStyleType()&&(t=-25,e=.45),this.shakeView.style={transform:{translate:{y:t},scale:e}},1}updateShakeViewBorderStyle(){this.shakeView.style={borderWidth:1,borderColor:"#FFFFFF"}}updateShakeAnimViewFinalStyle(){this.shakeAnimView.style={width:60,height:60,position:"absolute",left:8,top:8}}updateShakeImgFinalStyle(){this.shakeImg.style={width:30,height:30,position:"absolute"}}stopActionAnimation(){this.stopRotateAnimation()}}class Js{loadUrl(t){}setOnFinishListener(t){}setOnStartListener(t){}setOnFailedListener(t){}setOnDownloadListener(t){}setShouldOverrideUrlLoadingListener(t){}registerBridgeForName(t,e){}callJSWithParam(t,e){}callJS(t){}setScrollEnabled(t){}setJavaScriptEnabled(t){}setAllowFileAccess(t){}setAllowContentAccess(t){}setTextZoom(t){}setAllowFileAccessFromFileURLs(t){}setAllowUniversalAccessFromFileURLs(t){}setMixedContentMode(t){}setDebugEnabled(t){}setSaveEnabled(t){}setCacheMode(t){}setOnDeeplinkSuccessListener(t){}setOnDeeplinkFailListener(t){}setDeeplinkEnabled(t){}setInnerDownloadEnabled(t){}}Ls="undefined"==typeof KSAdWebView?Js:KSAdWebView;class $s extends Ls{}class Zs extends Rs{constructor(t){super(),this.mAdInfo=t}getName(){return"getKsPlayableAdData"}handleJsCall(t,e,i){this.onSuccess=e;try{let t=this.mAdInfo.adStyleInfo.playableExtraData;Ce(t)?i(-2,"not found playableExtraData in adStyleInfo"):e({playableExtraData:t})}catch(n){i(-1,"not found playableExtraData")}}}class qs extends Rs{constructor(){super()}getName(){return"getKsPlayableDeviceInfo"}handleJsCall(t,e,i){this.onSuccess=e;const n=this;ke.getKsPlayableDeviceInfo((t=>{t&&t.data&&n.onSuccess&&n.onSuccess(t.data)}))}}class Qs extends Rs{constructor(t){super(),this.extraGivenStatus=0,this.adStyle=t}getName(){return"getNativeData"}handleJsCall(t,e,i){this.onSuccess=e;const n=this,s=JSON.parse(t);try{if(!Ce(s)){const t=s.target;"playableSrc"==t&&n.onSuccess({playableSrc:this.playableSourceType}),"getExtraReward"==t&&n.onSuccess({extraRewardStatus:this.extraGivenStatus}),"getAdType"==t&&this.adStyle&&n.onSuccess({adType:this.adStyle})}}catch(a){}}}class ta extends Rs{constructor(){super(),this.lifeStatus="none"}getName(){return"registerLifecycleListener"}handleJsCall(t,e,i){this.onSuccess=e}changeLifeStatus(){this.onSuccess&&this.onSuccess({lifeStatus:this.lifeStatus})}}class ea extends Rs{constructor(t){super(),this.onPageStatus=t}getName(){return"pageStatus"}handleJsCall(t,e,i){const n=JSON.parse(t);console.log("tkloadcontroller callback render status:"+t),this.onPageStatus&&(n.status&&1==n.status?this.onPageStatus(!0):this.onPageStatus(!1)),e(null)}}class ia extends Rs{constructor(t){super(),this.clickTimestamp=0,this.isCanConvert=!1,this.validClickConvertTime=1e3,this.isCanConvert=t.isCanConvert,this.validClickConvertTime=t.getValidClickConvertTime(),yi(t,t.$attrsPath.isCanConvert,(t=>{this.isCanConvert=t}))}getName(){return"playableConvert"}handleJsCall(t,e,i){const n=JSON.parse(t);!Ce(n)&&this.canConvert()?(ce()||ei.log(2,{x:0,y:0},n),ke.playableConvert(n),this.clickTimestamp=oe(),e(null)):i(0,"no data")}canConvert(){if(!this.isCanConvert)return!1;if(this.validClickConvertTime<=0)return!0;return!(oe()-this.clickTimestamp<this.validClickConvertTime)}}class na extends $s{constructor(t){super(),this.renderStatus=-2,this.vm=t,Le.supportMinimumTKVersion("4.0.11")&&(this.setShouldOverrideUrlLoadingListener((t=>!1)),this.allowDeeplinkEnabled(!1)),this.registerBridgeHandle()}render(t){me(t)&&this.loadUrl(t)}registerBridgeHandle(){this.setOnStartListener((()=>{console.log("KSAdPlayable=====++++++ load start")})),this.setOnFinishListener((()=>{console.log("KSAdPlayable=====++++++ load finish")})),this.setOnFailedListener(((t,e,i)=>{console.log("KSAdPlayable=====++++++ load failed:"+t+":"+e+":"+i)})),this.setJavaScriptEnabled(!0);const t=new ks,e=this,i=new Zs(this.vm.adInfo);t.registerBridgeHandler(i);const n=new Es(this.vm.configInfo);t.registerBridgeHandler(n);const s=new qs;t.registerBridgeHandler(s);const a=new Hs(this.vm.screenOrientation);t.registerBridgeHandler(a);const o=new ea((t=>{e.renderStatus=t?1:0,e.vm.renderSuccess=t}));t.registerBridgeHandler(o),this.lifestatusHandler=new ta,t.registerBridgeHandler(this.lifestatusHandler);const r=new Ks;t.registerBridgeHandler(r);const h=new Ns;t.registerBridgeHandler(h);const l=new Bs;t.registerBridgeHandler(l),this.playableConvertHandler=new ia(this.vm),t.registerBridgeHandler(this.playableConvertHandler);const d=new Qs(this.vm.adStyle);t.registerBridgeHandler(d),this.registerBridgeForName(t,"KwaiAd")}willShow(){this.lifestatusHandler.lifeStatus="showStart",this.lifestatusHandler.changeLifeStatus()}didShow(){this.visible=!0,this.lifestatusHandler.lifeStatus="showEnd",this.lifestatusHandler.changeLifeStatus(),this.startDeepLinkLimited()}willHide(){this.lifestatusHandler.lifeStatus="hideStart",this.lifestatusHandler.changeLifeStatus(),this.endDeeplinkLimited()}didHide(){this.visible=!1,this.lifestatusHandler.lifeStatus="hideEnd",this.lifestatusHandler.changeLifeStatus()}pageVisiable(){this.visible=!0,this.lifestatusHandler.lifeStatus="pageVisiable",this.lifestatusHandler.changeLifeStatus()}pageInvisiable(){this.visible=!1,this.lifestatusHandler.lifeStatus="pageInvisiable",this.lifestatusHandler.changeLifeStatus()}startDeepLinkLimited(){if(Le.supportMinimumTKVersion("4.0.11")){const t=this.vm.getPlayableDeeplinkLimitedTimeMs();if(0==t)return void this.allowDeeplinkEnabled(!0);if(-1==t)return;t>0&&(this.limitedTimer=setTimeout((()=>{this.endDeeplinkLimited()}),t))}}endDeeplinkLimited(){Le.supportMinimumTKVersion("4.0.11")&&(this.allowDeeplinkEnabled(!0),this.limitedTimer&&(clearInterval(this.limitedTimer),this.limitedTimer=0))}allowDeeplinkEnabled(t){Le.supportMinimumTKVersion("4.0.11")&&(this.setDeeplinkEnabled(t),this.vm.isCanConvert=t)}}class sa extends TKView{constructor(t){super(),this.vm=t,this.setupView(),this.appendChild(this.playableCard),this.setupUserTouchView()}setupUserTouchView(){0!=this.vm.playableVM.getPlayableDeeplinkLimitedTimeMs()&&Le.supportMinimumTKVersion("4.0.11")&&(this.userTouch=new KSAdTouchInterceptView,this.userTouch.style={width:"100%",height:"100%",backgroundColor:"#00000000"},this.userTouch.setTouchDownInterceptor((t=>(this.userTouch&&(this.removeChild(this.userTouch),this.userTouch=null,this.playableCard.endDeeplinkLimited()),!0))),this.appendChild(this.userTouch))}render(){console.log("KSAdPlayableCardView load url"+this.vm.getPlayableUrl());try{return this.playableCard.render(this.vm.getPlayableUrl()),!0}catch(t){return!1}}show(){1==this.playableCard.renderStatus&&(console.log("====++++ add KSAdPlayableCardView"),this.playableCard.willShow(),this.playableCard.didShow())}setupView(){this.style={flexDirection:"row",alignItems:"center",justifyContent:"center"},this.setupWebView()}setupWebView(){try{this.playableCard=new na(this.vm.playableVM),this.playableCard.style={width:"100%",height:"100%",position:"absolute",left:0}}catch(t){console.log("webview error")}}}class aa extends Rs{getName(){return"cancelAppDownloadForAd"}handleJsCall(t,e,i){var n;const s=JSON.parse(t);const a=P(this.getAdTemplate(s));Ke(null===(n=null==a?void 0:a.adConversionInfo)||void 0===n?void 0:n.appDownloadUrl,(t=>{t.result?e(null):i(t.result,null)}))}getAdTemplate(t){return t.adTemplate?t.adTemplate:E(this.adResult,Number(t.creativeId))}}class oa extends Rs{getName(){return"cancelAppDownload"}handleJsCall(t,e,i){const n=JSON.parse(t);n.url?Ke(n.url,(t=>{t.result?e(null):i(t.result,null)})):i(1,"url is null")}}class ra extends Rs{constructor(){super()}getName(){return"adImpression"}handleJsCall(t,e,i){ke.innerAdImpression(),e(null)}}class ha extends Rs{getName(){return"registerProgressListener"}handleJsCall(t,e,i){console.log("tkloadcontroller call :"+this.getName()),this.mOnSuccess=e,Ce(this.mBufferedProgress)||(this.mOnSuccess(this.mBufferedProgress),this.mBufferedProgress=void 0)}updateDownloadProgress(t){this.mOnSuccess?this.mOnSuccess(t):this.mBufferedProgress=t}}class la extends Rs{constructor(t){super(),this.playAgainCallback=t}getName(){return"showPlayAgain"}handleJsCall(t,e,i){this.playAgainCallback?(this.playAgainCallback(),e(null)):i(0,"no listen playAgainCallback")}}class da extends Rs{constructor(){super()}getName(){return"updateExtraReward"}handleJsCall(t,e,i){const n=JSON.parse(t);Ce(n)?i(0,"no data"):(ke.updateExtraReward(n),e(null))}}class ca extends $s{constructor(t){super(),this.renderStatus=-2,this.deepLinkEnabled=!0,this.vm=t,this.registerBridgeHandle(),yi(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{this.lifestatusHandler.lifeStatus=t,this.lifestatusHandler.changeLifeStatus()})),yi(this.vm,this.vm.$attrsPath.extraGivenStatus,(t=>{this.getNativeIdHandler.extraGivenStatus=t})),yi(this.vm,this.vm.$attrsPath.playableSourceType,(t=>{this.getNativeIdHandler.playableSourceType=t})),yi(this.vm,this.vm.$attrsPath.currentDownloadProgress,(t=>{Ce(t)||Ce(this.registerDownloadProgressListener)||this.registerDownloadProgressListener.updateDownloadProgress(t)}))}render(t){me(t)?(this.url=t,this.loadUrl(this.url)):this.renderStatus=0}setDeeplinkEnabledTag(t){this.setDeeplinkEnabled(t),this.deepLinkEnabled=t}getDeeplinkEnabledTag(){return this.deepLinkEnabled}registerBridgeHandle(){this.setOnStartListener((()=>{console.log("KSAdBaseWebView=====++++++ load start")})),this.setOnFinishListener((()=>{console.log("KSAdBaseWebView=====++++++ load finish")})),this.setOnFailedListener(((t,e,i)=>{console.log("KSAdBaseWebView=====++++++ load failed:"+t+":"+e+":"+i)})),this.setJavaScriptEnabled(!0),this.setAllowFileAccess(!0),this.setAllowFileAccessFromFileURLs(!1),this.setAllowUniversalAccessFromFileURLs(!1),this.setAllowContentAccess(!0),this.setMixedContentMode(0);const t=new ks;this.bridge=t;const e=this;this.getDataHandler=new Ps(this.vm.adOriginInfo),t.registerBridgeHandler(this.getDataHandler);const i=new Es(this.vm.configInfo);t.registerBridgeHandler(i);const n=new Ms(te());t.registerBridgeHandler(n);const s=new Hs(this.vm.screenOrientation);t.registerBridgeHandler(s);const a=new ea((t=>{e.renderStatus=t?1:0,e.renderFinishCallback&&e.renderFinishCallback(t)}));t.registerBridgeHandler(a),this.lifestatusHandler=new ta,t.registerBridgeHandler(this.lifestatusHandler);const o=new Ks;t.registerBridgeHandler(o);const r=new Ns;r.adResult=this.vm.adOriginInfo,t.registerBridgeHandler(r);const h=new Os(this.vm.containerLimit);t.registerBridgeHandler(h);const d=new Bs;t.registerBridgeHandler(d),this.clickActionHandler=d;const c=new ra;t.registerBridgeHandler(c),this.showPlayAgainandler=new la((()=>{Oe().emit(l,{})})),t.registerBridgeHandler(this.showPlayAgainandler),this.getNativeIdHandler=new Qs(this.vm.adStyle),t.registerBridgeHandler(this.getNativeIdHandler);const p=new da;t.registerBridgeHandler(p),this.registerDownloadProgressListener=new ha,t.registerBridgeHandler(this.registerDownloadProgressListener);const m=new oa;t.registerBridgeHandler(m);const g=new aa;g.adResult=this.vm.adOriginInfo,t.registerBridgeHandler(g),this.registerBridgeForName(t,"KwaiAd")}registerBridgeHandler(t){this.bridge.registerBridgeHandler(t)}addClickCallback(t){this.clickActionHandler.clickCallback=t}willShow(){this.vm.lifeStatus="showStart"}didShow(){this.visible=!0,this.vm.lifeStatus="showEnd"}willHide(){this.vm.lifeStatus="hideStart"}didHide(){this.visible=!1,this.vm.lifeStatus="hideEnd"}pageVisiable(){this.visible=!0,this.vm.lifeStatus="pageVisiable"}pageInvisiable(){this.visible=!1,this.vm.lifeStatus="pageInvisiable"}}class pa extends ji{constructor(t,e,i,n){super(),this.canShowAggregation=!1,this.aggcardType=ma.AGG_CARD_FANS,this.adStyle=t,this.configInfo=e,this.containerLimit=i,this.screenOrientation=n}handleConvert(e,i){if(this.adImpInfo&&this.adInfo){let n=0,s=0;Ce(i)||(n=i.position.rawX,s=i.position.rawY),ei.convertIfNeeded(1,this.adInfo,2,{x:n,y:s},0==e?t.RETAIN_AGG_CARD_CLICK:t.PLAYEND_AGG_CARD_CLICK,null,{},null,null,this.adResult,!0),this.isShowConfirm&&this.isShowConfirm(!1)}}getActionDataText(t){if(!me(t.aggActionDescription)){if(this.aggcardType==ma.AGG_CARD_FANS)return"去看看";if(this.aggcardType==ma.AGG_CARD_LIVE_ORDER)return"立即预约";if(this.aggcardType==ma.AGG_CARD_SHOP)return"查看商品"}return t.aggActionDescription}getLiveNameText(t){return me(t.aggProductName)?t.aggProductName:""}getDesText(t){if(!me(t.aggAdDescription)){if(this.aggcardType==ma.AGG_CARD_FANS)return"他来了他来了，他带着福利走来了";if(this.aggcardType==ma.AGG_CARD_LIVE_ORDER)return"直播专享福利，快来预约";if(this.aggcardType==ma.AGG_CARD_SHOP)return"老铁都爱买，你也来逛逛吧";if(this.aggcardType==ma.AGG_CARD_LIVE)return"直播限时福利，进来看看"}return t.aggAdDescription}getIconImg(t){return me(t.aggUserIcon)?t.aggUserIcon:"image/ksad-video-image/aggregation_icon_backup.png"}getCoverImg(t){return me(t.aggMaterialUrl)?t.aggMaterialUrl:"image/ksad-video-image/aggregation_right_bg.png"}getShopBackupCoverImg(){return"image/ksad-video-image/aggregation_shop_bg.png"}}var ma,ga,ua,wa;!function(t){t[t.AGG_CARD_FANS=1]="AGG_CARD_FANS",t[t.AGG_CARD_LIVE_ORDER=2]="AGG_CARD_LIVE_ORDER",t[t.AGG_CARD_SHOP=3]="AGG_CARD_SHOP",t[t.AGG_CARD_LIVE=4]="AGG_CARD_LIVE"}(ma||(ma={})),function(t){t[t.SHOW_CONFIRM=0]="SHOW_CONFIRM",t[t.SHOW_END_CARD=1]="SHOW_END_CARD"}(ga||(ga={}));class Ca extends TKView{constructor(t,e){super(),this.showLocation=ga.SHOW_CONFIRM,this.vm=t,e&&(this.showLocation=e),this.setupView()}setupView(){this.style={width:"100%",height:274,alignItems:"center"},this.contentView=new TKView,this.setupContentView(this.contentView),this.appendChild(this.contentView),yi(this.vm,this.vm.$attrsPath.canShowAggregation,(t=>{t&&this.updateUI(this.vm.aggregationCardInfo)})),this.contentView.addEventListener("tap",(t=>{this.vm.handleConvert(this.showLocation,t)})),Nt(this.contentView,(()=>{this.vm.handleConvert(this.showLocation,null)})),this.adIcon=new TKImage,this.adIcon.style={height:16,width:40,position:"absolute",end:8,bottom:8},this.adIcon.setSrc("image/ksad-video-image/aggregation_icon_ad.png"),this.contentView.appendChild(this.adIcon)}updateUI(t){}setupContentView(t){}}class fa extends Ca{updateUI(t){this.leftImg.setSrc(this.vm.getCoverImg(t)),me(t.aggMaterialUrl)?(this.rightBaseImg.setBlurRadius(8),this.rightBaseImg.setSrc(this.vm.getCoverImg(t))):(this.rightBaseImg.setSrc(""),this.rightBaseImg.setBlurRadius(0)),this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.buttonView.setText(this.vm.getActionDataText(t))}setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",backgroundColor:"#4F4F4F"},this.leftImg=new TKImage,this.leftImg.style={width:"45%",height:"100%",backgroundColor:"#4F4F4F",topLeftRadius:8,bottomLeftRadius:8},e.appendChild(this.leftImg);let i=new TKView;i.style={width:"55%",height:"100%",gradientBgColor:"90,585858 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,alignItems:"center",position:"absolute",marginStart:"45%"},e.appendChild(i),this.rightBaseImg=new TKBlurImage,this.rightBaseImg.style={width:"100%",height:"100%",backgroundColor:"#6D6D6D",topRightRadius:this.showLocation==ga.SHOW_CONFIRM?8:10,bottomRightRadius:this.showLocation==ga.SHOW_CONFIRM?8:10,position:"absolute"},i.appendChild(this.rightBaseImg);let n=new TKView;n.style={width:"100%",height:"100%",gradientBgColor:"360,585858FF 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,flexDirection:"column",alignItems:"center"},i.appendChild(n),this.iconView=new TKImage,this.iconView.style={width:32,height:32,borderRadius:16,backgroundColor:"#4F4F4F",marginTop:this.showLocation==ga.SHOW_CONFIRM?37:60,transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},n.appendChild(this.iconView),this.desView=new TKText,this.desView.style={marginTop:this.showLocation==ga.SHOW_CONFIRM?10:17,maxWidth:112,fontSize:12,fontWeight:"500",textAlign:"center",color:"#FFFFFF",textLineClamp:2,textLineSpace:4,transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},this.desView.setText("老铁发福利，快来关注主播，领取好礼"),n.appendChild(this.desView),this.buttonView=new TKText,this.buttonView.style={marginTop:20,maxWidth:200,height:24,fontSize:12,paddingLeft:12,paddingRight:12,paddingTop:4,paddingBottom:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:12,transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},this.buttonView.setText("去关注"),n.appendChild(this.buttonView)}}class ya extends Ca{setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.baseBackground=new TKBlurImage,this.baseBackground.style={width:"100%",height:"100%",borderRadius:8,position:"absolute"},e.appendChild(this.baseBackground),this.baseBackgroundCover=new TKView,this.baseBackgroundCover.style={width:"100%",height:"100%",borderRadius:8,backgroundColor:"#00000033",position:"absolute"},e.appendChild(this.baseBackgroundCover),this.midImg=new TKImage,this.midImg.style={height:"100%",width:"45%"},e.appendChild(this.midImg);let i=new TKView;i.style={height:"100%",marginTop:12,borderRadius:8,flexDirection:"column",position:"absolute",start:0},e.appendChild(i),this.playIcon=new TKImage,this.playIcon.style={height:70,width:70,position:"absolute",justifyContent:"center",alignItems:"center"},e.appendChild(this.playIcon),this.playIcon.setSrc("image/ksad-video-image/aggregation_play_icon.png"),this.livebaseView=new TKView,this.livebaseView.style={height:22,width:54,borderRadius:4,alignItems:"center",justifyContent:"center",marginStart:8,marginTop:8,visibility:"hidden",transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},i.appendChild(this.livebaseView),this.setLiveIconView(this.livebaseView);let n=new TKView;n.style={height:20,width:"100%",flexDirection:"row",alignItems:"center",marginTop:this.showLocation==ga.SHOW_CONFIRM?107:186},i.appendChild(n),this.iconView=new TKImage,this.iconView.style={height:this.showLocation==ga.SHOW_CONFIRM?14:16,width:this.showLocation==ga.SHOW_CONFIRM?14:16,marginStart:this.showLocation==ga.SHOW_CONFIRM?8:10,borderRadius:this.showLocation==ga.SHOW_CONFIRM?7:8},n.appendChild(this.iconView),this.liveName=new TKText,this.liveName.style={maxWidth:200,height:20,fontSize:10,fontWeight:"400",color:"#FFFFFF",marginStart:this.showLocation==ga.SHOW_CONFIRM?4:6,textAlign:"center"},n.appendChild(this.liveName);let s=new TKView;s.style={height:25,maxWidth:200,borderRadius:4,backgroundColor:"#30303099",marginTop:(this.showLocation,ga.SHOW_CONFIRM,3),marginStart:this.showLocation==ga.SHOW_CONFIRM?8:10,justifyContent:"center",alignItems:"flex-start"},i.appendChild(s),this.desView=new TKText,this.desView.style={height:25,fontSize:this.showLocation==ga.SHOW_CONFIRM?13:14,fontWeight:"500",color:"#FFFFFF",textLineClamp:1,textAlign:"center",paddingStart:this.showLocation==ga.SHOW_CONFIRM?4:6,paddingEnd:this.showLocation==ga.SHOW_CONFIRM?4:6},s.appendChild(this.desView)}setLiveIconView(t){let e=new TKView;e.style={height:19,width:54,borderRadius:4,flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:"#30303099"},t.appendChild(e);let i=new TKView;i.style={height:6,width:6,borderRadius:3,backgroundColor:"#15B15D"},e.appendChild(i);let n=new TKText;n.style={height:14,width:34,fontSize:11,fontWeight:"500",color:"#FFFFFF",marginStart:2,textAlign:"center"},n.setText("直播中"),e.appendChild(n)}updateUI(t){try{me(t.aggMaterialUrl)?(this.baseBackground.setBlurRadius(33),this.baseBackground.setSrc(this.vm.getCoverImg(t)),this.midImg.setSrc(this.vm.getCoverImg(t))):(this.baseBackgroundCover.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"},this.baseBackground.setSrc(""),this.baseBackground.setBlurRadius(0),this.baseBackground.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"}),this.vm.adInfo.adBaseInfo.isAccountLive&&(this.livebaseView.style={visibility:"visible"})}catch(e){}this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.liveName.setText(this.vm.getLiveNameText(t))}}class Ta extends Ca{updateUI(t){this.leftImg.setSrc(this.vm.getCoverImg(t)),me(t.aggMaterialUrl)?(this.rightBaseImg.setBlurRadius(8),this.rightBaseImg.setSrc(this.vm.getCoverImg(t))):(this.rightBaseImg.setSrc(""),this.rightBaseImg.setBlurRadius(0)),this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.buttonView.setText(this.vm.getActionDataText(t))}setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",backgroundColor:"#4F4F4F"},this.leftImg=new TKImage,this.leftImg.style={width:"45%",height:"100%",topLeftRadius:8,bottomLeftRadius:8},e.appendChild(this.leftImg);let i=new TKView;i.style={width:"55%",height:"100%",gradientBgColor:"90,585858 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,alignItems:"center",position:"absolute",marginStart:"45%"},e.appendChild(i),this.rightBaseImg=new TKBlurImage,this.rightBaseImg.style={width:"100%",height:"100%",backgroundColor:"#6D6D6D",topRightRadius:this.showLocation==ga.SHOW_CONFIRM?8:9,bottomRightRadius:this.showLocation==ga.SHOW_CONFIRM?8:9,position:"absolute"},i.appendChild(this.rightBaseImg);let n=new TKView;n.style={width:"100%",height:"100%",gradientBgColor:"360,585858FF 0, 585858CC 1",topRightRadius:8,bottomRightRadius:8,flexDirection:"column",alignItems:"center"},i.appendChild(n),this.iconView=new TKImage,this.iconView.style={width:32,height:32,borderRadius:16,marginTop:this.showLocation==ga.SHOW_CONFIRM?37:60,transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},n.appendChild(this.iconView),this.desView=new TKText,this.desView.style={marginTop:this.showLocation==ga.SHOW_CONFIRM?10:17,maxWidth:112,fontSize:12,fontWeight:"500",textAlign:"center",color:"#FFFFFF",textLineClamp:2,textLineSpace:4,transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},n.appendChild(this.desView),this.buttonView=new TKText,this.buttonView.style={marginTop:20,maxWidth:200,height:24,fontSize:12,paddingLeft:12,paddingRight:12,paddingTop:4,paddingBottom:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:12,transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},this.buttonView.setText("去关注"),n.appendChild(this.buttonView)}}class Ia extends Ca{setupContentView(t){let e=t;e.style={width:271,height:194,marginTop:12,borderRadius:8,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.baseBackground=new TKBlurImage,this.baseBackground.style={width:"100%",height:"100%",borderRadius:8,backgroundColor:"#FFFFFF",position:"absolute"},e.appendChild(this.baseBackground),this.baseBackgroundCover=new TKView,this.baseBackgroundCover.style={width:"100%",height:"100%",borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"},e.appendChild(this.baseBackgroundCover);let i=new TKView;i.style={width:"55%",height:"100%",justifyContent:"center",topLeftRadius:4,bottomLeftRadius:4},e.appendChild(i),this.leftImg=new TKImage,this.leftImg.style={width:this.showLocation==ga.SHOW_CONFIRM?128:146,height:this.showLocation==ga.SHOW_CONFIRM?128:146,marginStart:20,borderRadius:4,transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},i.appendChild(this.leftImg),this.rightView=new TKView,this.rightView.style={width:"45%",height:"100%",topRightRadius:4,bottomRightRadius:4,flexDirection:"column",alignItems:"center",transform:{scale:this.showLocation==ga.SHOW_CONFIRM?1:1.2}},e.appendChild(this.rightView),this.iconView=new TKImage,this.iconView.style={width:32,height:32,borderRadius:16,marginTop:this.showLocation==ga.SHOW_CONFIRM?37:70},this.rightView.appendChild(this.iconView),this.desView=new TKText,this.desView.style={marginTop:10,maxWidth:87,fontSize:12,textLineClamp:2,textLineSpace:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF"},this.desView.setText("老铁发福利，快来关注主播，领取好礼"),this.rightView.appendChild(this.desView),this.buttonView=new TKText,this.buttonView.style={marginTop:20,maxWidth:200,height:24,fontSize:12,paddingLeft:12,paddingRight:12,paddingTop:4,paddingBottom:4,fontWeight:"500",textAlign:"center",color:"#FFFFFF",borderColor:"#FFFFFF66",borderWidth:1,borderRadius:12},this.buttonView.setText("立即预约"),this.rightView.appendChild(this.buttonView)}updateUI(t){try{me(t.aggMaterialUrl)?(this.leftImg.setSrc(this.vm.getCoverImg(t)),this.rightView.style={width:121,height:"100%",topRightRadius:4,bottomRightRadius:4,flexDirection:"column",alignItems:"center"},this.baseBackground.setBlurRadius(8),this.baseBackground.setSrc(this.vm.getCoverImg(t))):(this.rightView.style={width:121,height:"100%",gradientBgColor:"360,585858FF 0, 585858CC 1",topRightRadius:4,bottomRightRadius:4,flexDirection:"column",alignItems:"center"},this.baseBackgroundCover.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"},this.leftImg.setSrc(this.vm.getShopBackupCoverImg()),this.baseBackground.setSrc(""),this.baseBackground.setBlurRadius(0),this.baseBackground.style={width:271,height:194,borderRadius:8,gradientBgColor:"360,585858FF 0, 585858CC 1",position:"absolute"})}catch(e){}this.iconView.setSrc(this.vm.getIconImg(t)),this.desView.setText(this.vm.getDesText(t)),this.buttonView.setText(this.vm.getActionDataText(t))}}class va extends TKView{constructor(){super(),this.setupViews()}setupViews(){this.style={width:28,height:34,flexDirection:"column-reverse",justifyContent:"space-around",alignItems:"center"},this.mArrow1=this.createArrowUpView(),this.appendChild(this.mArrow1),this.mArrow2=this.createArrowUpView(),this.appendChild(this.mArrow2),this.mArrow3=this.createArrowUpView(),this.appendChild(this.mArrow3)}createArrowUpView(){let t=new TKImage;return t.style={width:"100%",height:18,opacity:0},t.setSrc("image/ksad-pre-landingpage-card/icon_up_arrow.png"),t}startAnimation(){let t=this.createArrowAnimation(this.mArrow1,[1,.6,.3,0,0,0]),e=this.createArrowAnimation(this.mArrow2,[0,1,.6,.3,0,0]),i=this.createArrowAnimation(this.mArrow3,[0,0,1,.6,.3,0]);this.mArrow1.addAnimation(t,"arrowUp"),this.mArrow2.addAnimation(e,"arrowUp"),this.mArrow3.addAnimation(i,"arrowUp")}stopAnimation(){this.mArrow1.removeAllAnimation(),this.mArrow2.removeAllAnimation(),this.mArrow3.removeAllAnimation()}createArrowAnimation(t,e){if(e.length<5)return null;let i=new TKKeyframeAnimation;return i.duration=600,i.timingFunction="ease-out",i.repeatCount=Number.MAX_SAFE_INTEGER,i.setAnimations([()=>(t.style={opacity:e[0]},1/6),()=>(t.style={opacity:e[1]},2/6),()=>(t.style={opacity:e[2]},.5),()=>(t.style={opacity:e[3]},4/6),()=>(t.style={opacity:e[4]},5/6),()=>(t.style={opacity:e[5]},1)]),i}}class Aa{constructor(t){this.vm=t,Le.supportMinimumTKVersion("4.0.9")&&(this.dialog=new KSAdDialog,this.registerBridgeHandle(),this.setupView())}setupView(){this.dialog.setTemplateInfo(this.vm.getTemplateInfo())}showConfirm(){const t=this;this.dialog.show(((e,i)=>{e?t.vm.isShow=!0:this.vm.handleLeaveCallback&&this.vm.handleLeaveCallback()}))}dismiss(){this.dialog.dismiss()}registerBridgeHandle(){const t=new ks,e=new Ps(this.vm.adOriginInfo);t.registerBridgeHandler(e);const i=new Es(this.vm.configInfo);t.registerBridgeHandler(i);const n=new Ms(te());t.registerBridgeHandler(n);const s=new Hs(this.vm.screenOrientation);t.registerBridgeHandler(s);const a=new Us;a.skipCallback=(t,e,i)=>{this.vm.handleLeaveCallback&&this.vm.handleLeaveCallback()},t.registerBridgeHandler(a);const o=new Ws;o.closeCallback=()=>{this.dialog.dismiss()},t.registerBridgeHandler(o);const r=new Ks;t.registerBridgeHandler(r);const h=new Ns;t.registerBridgeHandler(h);const l=new Os(this.vm.containerLimit);t.registerBridgeHandler(l);const d=new Bs;t.registerBridgeHandler(d);const c=new zs;c.isPreLandingPage=!0,t.registerBridgeHandler(c),this.dialog.registerBridge(t)}}class Va extends TKView{constructor(t){super(),this.mDuration=150,this.mWebViewMarginTop=114,this.vm=t,this.setupViews(),this.setupConfirm(),this.renderWebView(),yi(this.vm,this.vm.$attrsPath.isSlideUp,(t=>{t?this.slideUp():this.slideDown()})),yi(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"showEnd"==t&&Le.supportMinimumTKVersion("4.0.11")&&this.mWebView.setDeeplinkEnabled(!0)})),this.vm.backPressedCallback=()=>{this.vm.isSlideUp?this.handleBackClick():this.vm.topBarVM.handleClose()},this.setVisibility("hidden")}setupViews(){this.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"flex-start"},this.appendChild(this.createBgImageView()),this.appendChild(this.createTopView()),this.appendChild(this.createContentView()),this.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),this.mContentView.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),this.vm.topBarVM.convertForOtherArea=e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)}}setupConfirm(){this.confirmDialog=new Aa(this.vm.confirmVM);const t=this;this.vm.confirmVM.handleLeaveCallback=()=>{t.confirmDialog.dismiss(),this.vm.isSlideUp=!1}}createBgImageView(){this.mBgImageView=new TKImage,this.mBgImageView.style={width:"100%",height:"100%",position:"absolute",left:0,right:0,bottom:0,top:0};let t=this.vm.getPlayEndBgUrl();return this.mBgImageView.setSrc(t),this.mBgImageView}show(){Le.supportMinimumTKVersion("4.0.11")&&this.mWebView.setDeeplinkEnabled(!0),this.showCardAnimation(),this.setVisibility("visible"),this.vm.reportPreFormImpression()}createTopView(){this.mTopView=new TKView,this.mTopView.style={width:"100%",height:64+(he()?20:0),paddingTop:20,backgroundColor:"#FFFFFF",opacity:0,flexDirection:"column",justifyContent:"center",alignItems:"center"};let t=new TKView;return t.style={width:"100%",height:44,bottom:0,position:"absolute",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.mTitleText=new TKText,this.mTitleText.style={width:"100%",height:"100%",position:"absolute",color:"#000000",fontWeight:"medium",fontSize:18,textAlign:"center"},this.mTitleText.setText(this.vm.getTopBarTitle()),t.appendChild(this.mTitleText),this.mBackBtn=new TKImage,this.mBackBtn.style={width:11,height:18,marginLeft:22,marginRight:22},this.mBackBtn.setSrc("image/ksad-pre-landingpage-card/icon_actionbar_back.png"),t.appendChild(this.mBackBtn),this.mCloseBtn=new TKImage,this.mCloseBtn.style={width:14,height:14},this.mCloseBtn.setSrc("image/ksad-pre-landingpage-card/icon_actionbar_close.png"),t.appendChild(this.mCloseBtn),this.mBackBtn.addEventListener("tap",(()=>{this.handleBackClick()})),this.mCloseBtn.addEventListener("tap",(()=>{this.handleCloseClick()})),this.mTopView.appendChild(t),this.mTopView}handleBackClick(){this.vm.needShowConfimDialog()?this.confirmDialog.showConfirm():this.vm.isSlideUp=!1}handleCloseClick(){this.vm.needShowConfimDialog()?this.confirmDialog.showConfirm():this.vm.isSlideUp=!1}createContentView(){return this.mContentView=new TKView,this.mContentView.style={flexBasis:300,flexGrow:1,flexShrink:1,flexDirection:"column"},this.mContentBgView=new TKView,this.mContentBgView.style={width:"100%",height:140,position:"absolute",left:0,top:0,right:0,gradientBgColor:"90,0000009E,00000000"},this.mContentBgView.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),this.mContentView.appendChild(this.mContentBgView),this.mWebViewContainer=new TKView,this.mWebViewContainer.style={width:"100%",height:"100%",top:this.mWebViewMarginTop+80,position:"absolute",left:0,right:0},this.setupWebView(),this.mWebViewContainer.appendChild(this.mWebView),this.mUpSlideView=this.createUpSlideTipsView(),this.mWebViewContainer.appendChild(this.mUpSlideView),this.mContentView.appendChild(this.mWebViewContainer),this.mContentMaskView=this.createContentMaskView(),this.mContentView.appendChild(this.mContentMaskView),this.mContentView}createContentMaskView(){let e=new TKView;e.style={width:"100%",height:"100%",position:"absolute",top:this.vm.isAppAdvance()?this.mWebViewMarginTop:0},e.addEventListener("tap",(e=>{this.vm.handleAdClick(t.INTERACT_LANDING_PAGE_CLICK,e)})),e.addEventListener("swipe",(()=>{this.vm.handleAdClick(t.INTERACT_LANDING_PAGE_CLICK,null)}));let i=new TKView;return i.style={width:"100%",height:this.mWebViewMarginTop,position:"absolute",top:0},i.addEventListener("tap",(e=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,e)})),i.addEventListener("swipe",(()=>{this.vm.handleAdClick(t.LANDING_PAGE_OTHER_AREA_CLICK,null)})),e.appendChild(i),e}setupWebView(){if(Le.supportMinimumTKVersion("4.0.9"))try{this.mWebView=new KSAdWebView,this.mWebView.style={width:"100%",height:"100%",backgroundColor:"#FFFFFF00",topLeftRadius:20,topRightRadius:20,position:"absolute",top:0,left:0,right:0};let t=new b;t.is_special_preload=1;let e={clientExtData:JSON.stringify(t)};this.mWebView.setOnStartListener((()=>{})),this.mWebView.setOnFinishListener((()=>{this.vm.pageLoaded||(ke.sendLog({actionType:51,payload:JSON.stringify(e)}),this.vm.pageLoaded=!0)})),this.mWebView.setOnFailedListener(((t,i,n)=>{ke.sendLog({actionType:59,payload:JSON.stringify(e)}),this.vm.pageLoadedFailed=!0})),this.mWebView.setJavaScriptEnabled(!0),this.mWebView.setAllowFileAccess(!0),this.mWebView.setAllowFileAccessFromFileURLs(!1),this.mWebView.setAllowUniversalAccessFromFileURLs(!1),this.mWebView.setAllowContentAccess(!0),this.mWebView.setMixedContentMode(0),this.mWebView.setScrollEnabled(!0),Le.supportMinimumTKVersion("4.0.11")&&this.mWebView.setDeeplinkEnabled(!1)}catch(t){console.log("jky webview error")}}renderWebView(){this.vm.getLandingPageUrl((t=>{Ce(t)?this.vm.pageLoadedFailed=!0:this.mWebView.loadUrl(t)}))}createUpSlideTipsView(){let t=new TKView;t.style={topLeftRadius:20,topRightRadius:20,height:140,width:"100%",gradientBgColor:"90,00000000,00000040",flexDirection:"column",alignItems:"center"},this.mSlideUpIconView=new va,this.mSlideUpIconView.style={top:7,alignSelf:"center",position:"absolute"},t.appendChild(this.mSlideUpIconView);let e=new TKText;return e.style={top:48,fontSize:12,color:"#F4F4F4",alignSelf:"center"},e.setText("上滑/点击查看更多"),t.appendChild(e),t}showCardAnimation(){let t=new TKKeyframeAnimation;t.duration=300,t.timingFunction="EaseOut",t.setAnimations([()=>(this.mWebViewContainer.style={opacity:0,top:this.mWebViewMarginTop+80},0),()=>(this.mWebViewContainer.style={opacity:0,top:this.mWebViewMarginTop+80},.5),()=>(this.mWebViewContainer.style={opacity:1,top:this.mWebViewMarginTop},1)]),t.on("end",(()=>{this.mSlideUpIconView.startAnimation(),this.leadSlideUp()})),this.mWebViewContainer.addAnimation(t,"showAnimation")}leadSlideUp(){let t=new TKKeyframeAnimation;t.duration=600,t.timingFunction="EaseOut",t.repeatCount=Number.MAX_SAFE_INTEGER,t.setAnimations([()=>1/3,()=>(this.mWebViewContainer.style={transform:{translate:{y:14}}},5/6),()=>(this.mWebViewContainer.style={transform:{translate:{y:0}}},1)]),this.mWebViewContainer.addAnimation(t,"leadSlideUpAnima")}slideUp(){if(1==this.mTopView.style.opacity)return;this.mWebViewContainer.removeAllAnimation();let t=new TKBasicAnimation;t.duration=this.mDuration,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mWebViewContainer.style={top:0}}));let e=new TKBasicAnimation;e.duration=this.mDuration,e.timingFunction="EaseOut",e.setEndValue((()=>{this.mTopView.style={opacity:1}}));let i=new TKBasicAnimation;i.duration=this.mDuration,i.timingFunction="EaseOut",i.setEndValue((()=>{this.mUpSlideView.style={opacity:0}})),e.on("end",(()=>{this.mWebView.style={backgroundColor:"#FFFFFF",topLeftRadius:0,topRightRadius:0}})),this.mContentMaskView.style={visibility:"hidden"},this.mWebViewContainer.addAnimation(t,"upSlideAnim"),this.mTopView.addAnimation(e,"upSlideAnim"),this.mUpSlideView.addAnimation(i,"upSlideAnim")}slideDown(){if(0==this.mTopView.style.opacity)return;this.mWebViewContainer.removeAllAnimation();let t=new TKBasicAnimation;t.duration=this.mDuration,t.timingFunction="EaseOut",t.setEndValue((()=>{this.mWebViewContainer.style={top:this.mWebViewMarginTop}}));let e=new TKBasicAnimation;e.duration=this.mDuration,e.timingFunction="EaseOut",e.setStartValue((()=>{this.mWebView.style={backgroundColor:"#FFFFFF00",topLeftRadius:20,topRightRadius:20}})),e.setEndValue((()=>{this.mTopView.style={opacity:0}}));let i=new TKBasicAnimation;i.duration=this.mDuration,i.timingFunction="EaseOut",i.setEndValue((()=>{this.mUpSlideView.style={opacity:1}})),this.mContentMaskView.style={visibility:"visible"},t.on("end",(()=>{this.leadSlideUp()})),this.mWebViewContainer.addAnimation(t,"downSlideAnim"),this.mTopView.addAnimation(e,"downSlideAnim"),this.mUpSlideView.addAnimation(i,"downSlideAnim")}}class ba{constructor(t,e,i){this.xDegree=t,this.yDegree=e,this.zDegree=i}}class Sa{constructor(t){this.radFlag=!1,this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antiXFlag=!1,this.antiYFlag=!1,this.antiZFlag=!1,this.bidirectionalSwitch=!1,this.NS2S=1e-9,this.rotateInfo=t,this.bidirectionalSwitch=function(t){try{return t.bidirectionalSwitch}catch(e){}return!1}(t)}beforeMonitor(){this.startTime=Le.isAndroid()?0:oe()/1e3,this.maxSensorInfo=new ba(0,0,0),this.xDegree=0,this.yDegree=0,this.zDegree=0}resetValues(){this.xDegree=0,this.yDegree=0,this.zDegree=0}canConvertRotate(t){try{if(!Ce(t)&&!Ce(t.values)){if(!this.radFlag){this.xOriginOmiga=0,this.yOriginOmiga=0,this.zOriginOmiga=0;let i=-1;try{i=ee().abConfig.rotateProgressIncreaseCompatible}catch(e){}i>=0&&(t.values[0]>i&&(this.xOriginOmiga=t.values[0]),t.values[1]>i&&(this.yOriginOmiga=t.values[1]),t.values[2]>i&&(this.zOriginOmiga=t.values[2])),this.radFlag=!0}let i=!1,n=!1,s=!1,a=0;Le.isAndroid()?(0!=this.startTime&&(a=(t.timestamp-this.startTime)*this.NS2S),this.startTime=t.timestamp):(a=t.timestamp/1e3-this.startTime,this.startTime=t.timestamp/1e3),this.xDegree+=a*(t.values[0]-this.xOriginOmiga)*180/Math.PI,this.yDegree+=a*(t.values[1]-this.yOriginOmiga)*180/Math.PI,this.zDegree+=a*(t.values[2]-this.zOriginOmiga)*180/Math.PI;let o=new ba(this.xDegree,this.yDegree,this.zDegree);if(Math.abs(o.xDegree)>Math.abs(this.maxSensorInfo.xDegree)&&(this.maxSensorInfo.xDegree=o.xDegree),Math.abs(o.yDegree)>Math.abs(this.maxSensorInfo.yDegree)&&(this.maxSensorInfo.yDegree=o.yDegree),Math.abs(o.zDegree)>Math.abs(this.maxSensorInfo.zDegree)&&(this.maxSensorInfo.zDegree=o.zDegree),this.bidirectionalSwitch)return this.bidirectionRotateConvert(o);i=this.canConvertCurrentDegree(o.xDegree,this.rotateInfo.x),n=this.canConvertCurrentDegree(o.yDegree,this.rotateInfo.y),s=this.canConvertCurrentDegree(o.zDegree,this.rotateInfo.z);let r=i||n||s;return r&&(this.radFlag=!1),r}}catch(i){}return!1}bidirectionRotateConvert(t){t.xDegree>0&&!this.xFlag?this.xFlag=this.canConvertCurrentDegree(t.xDegree,this.rotateInfo.x):t.xDegree<0&&!this.antiXFlag&&(this.antiXFlag=this.canConvertCurrentDegree(t.xDegree,this.rotateInfo.x)),t.yDegree>0&&!this.yFlag?this.yFlag=this.canConvertCurrentDegree(t.yDegree,this.rotateInfo.y):t.yDegree<0&&!this.antiYFlag&&(this.antiYFlag=this.canConvertCurrentDegree(t.yDegree,this.rotateInfo.y)),t.zDegree>0&&!this.zFlag?this.zFlag=this.canConvertCurrentDegree(t.zDegree,this.rotateInfo.z):t.zDegree<0&&!this.antiZFlag&&(this.antiZFlag=this.canConvertCurrentDegree(t.zDegree,this.rotateInfo.z));let e=this.xFlag&&this.antiXFlag,i=this.yFlag&&this.antiYFlag,n=this.zFlag&&this.antiZFlag,s=e||i||n;return s&&(console.log("bidirection function canRotate, x:"+e+"===y:"+i+"===z:"+n),this.resetFlag()),s}resetFlag(){this.xFlag=!1,this.antiXFlag=!1,this.yFlag=!1,this.antiYFlag=!1,this.zFlag=!1,this.antiZFlag=!1,this.radFlag=!1}canConvertCurrentDegree(t,e){if(e.rotateDegree<0)return!1;let i=!0,n=0==e.rotateDegree?45:e.rotateDegree;switch(e.direction){case 1:i=t<0&&Math.abs(t)>=n;break;case 2:i=t>0&&Math.abs(t)>=n;break;default:i=Math.abs(t)>=n}return i&&this.bidirectionalSwitch&&this.resetValues(),i}maxRotateContent(){return JSON.stringify({x:Math.round(this.maxSensorInfo.xDegree),y:Math.round(this.maxSensorInfo.yDegree),z:Math.round(this.maxSensorInfo.zDegree)})}}class xa{constructor(t){this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antixFlag=!1,this.antiyFlag=!1,this.antizFlag=!1,this.canShakeCount=0,this.interactiveInfo=t}bidireationShakeConvert(t){let e=this.canBidireationShake(t);return ce()?this.canShakeCount>2&&(console.log("bidirection function android success convert, current canShakeCount:"+this.canShakeCount),this.canShakeCount=0,!0):e}canBidireationShake(t){t[0]>0&&!this.xFlag?this.xFlag=this.computeAcceleration(t[0]):t[0]<0&&!this.antixFlag&&(this.antixFlag=this.computeAcceleration(t[0])),t[1]>0&&!this.yFlag?this.yFlag=this.computeAcceleration(t[1]):t[1]<0&&!this.antiyFlag&&(this.antiyFlag=this.computeAcceleration(t[1])),t[2]>0&&!this.zFlag?this.zFlag=this.computeAcceleration(t[2]):t[2]<0&&!this.antizFlag&&(this.antizFlag=this.computeAcceleration(t[2]));let e=this.xFlag&&this.antixFlag,i=this.yFlag&&this.antiyFlag,n=this.zFlag&&this.antizFlag,s=e||i||n;return s&&(console.log("bidirection function canShake, x:"+e+"===y:"+i+"===z:"+n),this.canShakeCount++,this.resetFlag()),s}computeAcceleration(t){let e=Math.abs(t-9.81);return Math.abs(t)>=Et(this.interactiveInfo)&&e>=.05}resetFlag(){this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antixFlag=!1,this.antiyFlag=!1,this.antizFlag=!1}}class _a{constructor(t){this.gravity=9.81,this.minError=.05,this.accelerationThreshold=Et(t),this.bidireationalSwitch=Pt(t.shakeInfo),this.bidirectionalRotateShakeUtil=new xa(t),this.lastValue=new Array,this.lastValue[0]=0,this.lastValue[1]=0,this.lastValue[2]=0}beforeMonitor(){this.maxAcceleration=0}resetValues(){this.lastValue=new Array,this.lastValue[0]=0,this.lastValue[1]=0,this.lastValue[2]=0}canConvertShake(t){try{if(!Ce(t)&&!Ce(t.values)){if(t=this.noiseReduction(t),this.isInvalidValue(t.values))return!1;this.lastValue=t.values;let e=t.values[0],i=t.values[1],n=t.values[2];return this.bidireationalSwitch?(this.maxAcceleration=Math.max(Math.max(Math.abs(e),Math.abs(i)),Math.abs(n)),this.bidirectionalRotateShakeUtil.bidireationShakeConvert(t.values)):(this.maxAcceleration=Math.sqrt(e*e+i*i+n*n),this.maxAcceleration>=this.accelerationThreshold)}}catch(e){}return!1}isInvalidValue(t){let e=Math.abs(Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]));return!!(Math.abs(e-this.gravity)<=this.minError&&Le.isAndroid())}noiseReduction(t){let e=.6;return 0==this.lastValue[0]&&0==this.lastValue[1]&&0==this.lastValue[2]&&(e=1),this.lastValue[0]=e*t.values[0]+(1-e)*this.lastValue[0],this.lastValue[1]=e*t.values[1]+(1-e)*this.lastValue[1],this.lastValue[2]=e*t.values[2]+(1-e)*this.lastValue[2],t.values[0]=this.lastValue[0],t.values[1]=this.lastValue[1],t.values[2]=this.lastValue[2],t}}class La{constructor(t,e,i){this.xDegree=t,this.yDegree=e,this.zDegree=i}}class Da{constructor(t){this.rotationMatrix=new Array(9),this.simulatedGyroscopeValues=[],this.originRotateDegree=[],this.mRotateDegree=[],this.isInitValidValue=!1,this.rotateInfo=t,this.resetMaxRotateInfo()}resetMaxRotateInfo(){this.maxSensorInfo=new La(0,0,0)}handleImitateSensorData(t,e,i,n=(t=>{})){if(0!=e.length&&0!=t.length){if(this.getRotationMatrix(this.rotationMatrix,null,t,e),this.getOrientation(this.rotationMatrix,this.simulatedGyroscopeValues),this.mRotateDegree[0]=180*this.simulatedGyroscopeValues[0]/Math.PI,this.mRotateDegree[1]=180*this.simulatedGyroscopeValues[1]/Math.PI,this.mRotateDegree[2]=180*this.simulatedGyroscopeValues[2]/Math.PI,!this.isInitValidValue&&(0!=this.mRotateDegree[0]||0!=this.mRotateDegree[1]||0!=this.mRotateDegree[2])){this.isInitValidValue=!0;let t=new Array(3);t[0]=this.mRotateDegree[0],t[1]=this.mRotateDegree[1],t[2]=this.mRotateDegree[2],this.originRotateDegree=t}this.mRotateDegree[0]=this.mRotateDegree[0]-this.originRotateDegree[0],this.mRotateDegree[1]=this.mRotateDegree[1]-this.originRotateDegree[1],this.mRotateDegree[2]=this.mRotateDegree[2]-this.originRotateDegree[2],!Ce(this.mRotateDegree)&&n&&n(this.mRotateDegree),this.canConvertRotate(this.mRotateDegree)&&(i&&i(this.maxRotateContent()),this.resetMaxRotateInfo())}}canConvertRotate(t){try{if(!Ce(t)){let e=!1,i=!1,n=!1;return Math.abs(t[0])>Math.abs(this.maxSensorInfo.xDegree)&&(this.maxSensorInfo.xDegree=t[0]),Math.abs(t[1])>Math.abs(this.maxSensorInfo.yDegree)&&(this.maxSensorInfo.yDegree=t[1]),Math.abs(t[2])>Math.abs(this.maxSensorInfo.zDegree)&&(this.maxSensorInfo.zDegree=t[2]),e=this.canConvertCurrentDegree(t[0],this.rotateInfo.x),i=this.canConvertCurrentDegree(t[1],this.rotateInfo.y),n=this.canConvertCurrentDegree(t[2],this.rotateInfo.z),e||i||n}}catch(e){}return!1}canConvertCurrentDegree(t,e){if(e.rotateDegree<0)return!1;let i=!0,n=0==e.rotateDegree?45:e.rotateDegree;switch(e.direction){case 1:i=t<0&&Math.abs(t)>=n;break;case 2:i=t>0&&Math.abs(t)>=n;break;default:i=Math.abs(t)>=n}return i}maxRotateContent(){return JSON.stringify({x:Math.round(this.maxSensorInfo.xDegree),y:Math.round(this.maxSensorInfo.yDegree),z:Math.round(this.maxSensorInfo.zDegree),useImitateRotate:!0})}getRotationMatrix(t,e,i,n){try{let s=i[0],a=i[1],o=i[2],r=9.81;if(s*s+a*a+o*o<.01*r*r)return!1;let h=n[0],l=n[1],d=n[2],c=l*o-d*a,p=d*s-h*o,m=h*a-l*s,g=Math.sqrt(c*c+p*p+m*m);if(g<.1)return!1;let u=1/g;c*=u,p*=u,m*=u;let w=1/Math.sqrt(s*s+a*a+o*o);s*=w,a*=w,o*=w;let C=a*m-o*p,f=o*c-s*m,y=s*p-a*c;if(null!=t&&(9==t.length?(t[0]=c,t[1]=p,t[2]=m,t[3]=C,t[4]=f,t[5]=y,t[6]=s,t[7]=a,t[8]=o):16==t.length&&(t[0]=c,t[1]=p,t[2]=m,t[3]=0,t[4]=C,t[5]=f,t[6]=y,t[7]=0,t[8]=s,t[9]=a,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1)),null!=e){let t=1/Math.sqrt(h*h+l*l+d*d),i=(h*C+l*f+d*y)*t,n=(h*s+l*a+d*o)*t;9==e.length?(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=i,e[5]=n,e[6]=0,e[7]=-n,e[8]=i):16==e.length&&(e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=i,e[6]=n,e[8]=0,e[9]=-n,e[10]=i,e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1)}}catch(s){return!1}return!0}getOrientation(t,e){try{9==t.length?(e[0]=Math.atan2(t[1],t[4]),e[1]=Math.asin(-t[7]),e[2]=Math.atan2(-t[6],t[8])):(e[0]=Math.atan2(t[1],t[5]),e[1]=Math.asin(-t[9]),e[2]=Math.atan2(-t[8],t[10]))}catch(i){}return e}}class Fa{constructor(t){this.rotateInfo=t}registerImitateRotateSensorListener(t,e=(t=>{})){if(!Le.supportMinimumTKVersion("5.0.5")||!Le.isAndroid())return;if(!KSAdSensorManager.supportSensor(3)||!KSAdSensorManager.supportSensor(5))return;this.imtateRotateHandler=new Da(this.rotateInfo);let i=[],n=[];try{KSAdSensorManager.registerSensorListener(3,-3,(s=>{i=s.values,this.imtateRotateHandler.handleImitateSensorData(i,n,t,e)})),KSAdSensorManager.registerSensorListener(5,-3,(s=>{n=s.values,this.imtateRotateHandler.handleImitateSensorData(i,n,t,e)}))}catch(s){}}unRegisterImitateRotateSensorListener(){Le.supportMinimumTKVersion("5.0.5")&&Le.isAndroid()&&(KSAdSensorManager.unregisterSensorListener(3),KSAdSensorManager.unregisterSensorListener(5))}}class ka{constructor(t){this.isListeningSeneor=!1,this.interactionInfo=t}startSensorListener(t,e){var i,n,s,a;this.isListeningSeneor||(this.isListeningSeneor=!0,(null===(n=null===(i=this.interactionInfo)||void 0===i?void 0:i.rotateInfo)||void 0===n?void 0:n.enable)&&this.startRotateListener(t,e),(null===(a=null===(s=this.interactionInfo)||void 0===s?void 0:s.shakeInfo)||void 0===a?void 0:a.enable)&&this.startShakeListener(t,e))}startRotateListener(t,e){var i,n;if("undefined"!=typeof KSAdSensorManager)if(this.initializeRotateHandler(this.interactionInfo.rotateInfo),this.rotateHandler.beforeMonitor(),KSAdSensorManager.supportSensor(2))try{KSAdSensorManager.registerSensorListener(2,-3,(i=>{try{if(e&&e(this.rotateHandler,this.shakeHandler,!1),this.rotateHandler&&this.rotateHandler.canConvertRotate(i)){t&&this.isListeningSeneor&&t(!1,0,this.rotateHandler.maxRotateContent()),this.stopSensorListener();try{KSAdSystemUtil.startVibrate(200)}catch(n){We(re(n))}}}catch(n){We("outerError:"+re(n))}}))}catch(s){}else{if(this.rotateHandler.bidirectionalSwitch)return;(null===(n=null===(i=this.interactionInfo)||void 0===i?void 0:i.rotateInfo)||void 0===n?void 0:n.useImitateRotate)&&(this.sensorImitateRotateUtil=new Fa(this.interactionInfo.rotateInfo),this.sensorImitateRotateUtil.registerImitateRotateSensorListener((e=>{try{if(!Ce(e)){t&&this.isListeningSeneor&&t(!1,0,e),this.stopSensorListener();try{KSAdSystemUtil.startVibrate(200)}catch(s){We(re(s))}}}catch(s){We("outerError:"+re(s))}}),(t=>{e&&t&&t.length>2&&(this.rotateHandler.xDegree=t[0],this.rotateHandler.yDegree=t[1],this.rotateHandler.zDegree=t[2],e(this.rotateHandler,null,!1))})))}}startShakeListener(t,e){if("undefined"!=typeof KSAdSensorManager){this.initializeShakeHandler(),this.shakeHandler.beforeMonitor();try{KSAdSensorManager.registerSensorListener(1,-3,(i=>{e&&e(this.rotateHandler,this.shakeHandler,!0),this.shakeHandler&&this.shakeHandler.canConvertShake(i)&&(KSAdSystemUtil.startVibrate(200),t&&this.isListeningSeneor&&t(!0,this.shakeHandler.maxAcceleration,""),this.stopSensorListener())}))}catch(i){}}}stopSensorListener(){this.isListeningSeneor=!1,this.stopRotateListener(),this.stopShakeListener()}stopRotateListener(){var t,e;"undefined"!=typeof KSAdSensorManager&&(null===(e=null===(t=this.interactionInfo)||void 0===t?void 0:t.rotateInfo)||void 0===e?void 0:e.enable)&&(this.sensorImitateRotateUtil?this.sensorImitateRotateUtil.unRegisterImitateRotateSensorListener():KSAdSensorManager.unregisterSensorListener(2))}stopShakeListener(){var t,e;"undefined"!=typeof KSAdSensorManager&&(null===(e=null===(t=this.interactionInfo)||void 0===t?void 0:t.shakeInfo)||void 0===e?void 0:e.enable)&&KSAdSensorManager.unregisterSensorListener(1)}initializeShakeHandler(){this.shakeHandler=new _a(this.interactionInfo)}initializeRotateHandler(t){this.rotateHandler=new Sa(t)}getRotateHandler(){return this.rotateHandler}getShakeHandler(){return this.shakeHandler}static reportRotateSensorStatus(t){if(Le.supportMinimumTKVersion("5.0.5")&&Le.isAndroid())try{!function(t){Ue({status:5001,ad_style:t})}(t),KSAdSensorManager.supportSensor(1)||function(t){Ue({status:5011,ad_style:t})}(t);let e=!1;KSAdSensorManager.supportSensor(2)||(e=!0,function(t){Ue({status:5002,ad_style:t})}(t));let i=!1;KSAdSensorManager.supportSensor(3)||(i=!0,function(t){Ue({status:5003,ad_style:t})}(t));let n=!1;KSAdSensorManager.supportSensor(5)||(n=!0,function(t){Ue({status:5004,ad_style:t})}(t));let s=!1;KSAdSensorManager.supportSensor(4)||(s=!0,function(t){Ue({status:5008,ad_style:t})}(t)),i&&s&&function(t){Ue({status:5009,ad_style:t})}(t),i&&n&&function(t){Ue({status:5005,ad_style:t})}(t),e&&(i||n)&&function(t){Ue({status:5007,ad_style:t})}(t),e&&(i||s)&&function(t){Ue({status:5010,ad_style:t})}(t)}catch(e){!function(t,e){Ue({status:5006,error_msg:t,ad_style:e})}(re(e),t)}}}class Ra extends TKView{constructor(t,e,i,n){super(),this.showAtBottom=!1,this.startPositionFunc=e,this.endPositionFunc=i,this.showAtBottom=n,this.vm=t,this.setupView(),this.setupData(),this.setupActions(),this.vm.elementImpression(),ka.reportRotateSensorStatus(this.vm.callerContext.adStyle),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"===t&&this.stopActionAnimation(),"pageVisiable"===t&&this.resumeLottieAnimation(),"pageInvisiable"===t&&this.pauseLottieAnimation()})),this.updateDownloadState()}updateDownloadState(){yi(this.vm,this.vm.$attrsPath.downloadState,(t=>{switch(t){case 0:case 1:case 4:case 5:case 6:break;case 2:this.vm.canRotateConvert=!1;break;case 3:this.vm.canRotateConvert=!0}}))}updateDesTest(t){this.vm.isShowRotateAndShakeView()&&this.descView.setText(t)}setupActions(){this.addEventListener("tap",(t=>{this.vm.clickLog(t,this)})),this.vm.isSlideClick()&&Nt(this,(()=>{this.vm.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))}setupData(){this.vm.isShowRotateAndShakeView()?this.titleView.setText(this.vm.interactionInfo.componentInfo.btnTitle):this.titleView.setText(this.vm.interactionInfo.rotateInfo.title),this.descView.setText(this.vm.getRotateSubtitle())}setupView(){let t={width:168,height:135};1==this.vm.getInteractiveStyleType()&&(t.height=150);const e=this.startPositionFunc(t);this.style={width:168,height:135,left:e.x,top:e.y,position:"absolute",alignItems:"center"},this.rotateContainer=new TKView,this.rotateContainer.style={width:110,height:110,backgroundColor:"#00000064",borderRadius:55,position:"absolute",alignItems:"center"},1==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:150},this.rotateContainer.style={width:96,height:96,borderRadius:48}),this.appendChild(this.rotateContainer),this.setVisibility("hidden"),this.appendRotateView(),this.loadFinish()}loadFinish(){this.bindSensorListener(),this.setVisibility("visible");let t=this;if(this.vm.isShowRotateAndShakeView())return this.vm.rotateShakeUiStyle=this.vm.getBtnStyle(),void this.startShakeAnimation();if(this.showAtBottom)return void this.showAtBottomWithoutAnimation();let e=this.needChangeRotateView()?4300:4700;setTimeout((()=>{Le.supportMinimumTKVersion("5.0.0")&&this.rotateView.pause(),setTimeout((()=>{Le.supportMinimumTKVersion("5.0.0")&&this.rotateView.resume(),t.textDisappearAnimation(),t.startChangeShakeStyleAnimation()}),500),setTimeout((()=>{this.addWhiteLine()}),1e3)}),e)}showAtBottomWithoutAnimation(){this.titleContainer.style={opacity:0},this.updateThisFinalStyle(),this.updateRotateContainerFinalFrameStyle(),this.updateRotateContainerFinalBorderStyle()}appendRotateLottieView(){Le.supportMinimumTKVersion("5.0.0")&&(this.rotateView=new TKLottieImageView,this.setRotateLottieView("image/ksad-video-image/neo_rotate.json",this.rotateView,!0),this.rotateView.style={width:105,height:105,position:"absolute"})}setRotateLottieView(t,e,i){e.setUri(t),e.setLoop(i),i&&setTimeout((()=>{e.play()}),1e3),this.rotateContainer.appendChild(e)}appendRotateView(){this.clipChildren=!0,this.appendRotateLottieView(),this.appendTitleContiner()}appendTitleContiner(){this.titleContainer=new TKView,this.titleContainer.style={width:168,height:49,marginTop:81,justifyContent:"center",alignItems:"center"},1==this.vm.getInteractiveStyleType()&&(this.titleContainer.style={marginTop:106}),this.appendChild(this.titleContainer),this.appendTitleView()}appendTitleView(){this.titleView=new TKText,this.titleView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",fontSize:18,fontWeight:"medium",textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1},(2==this.vm.getInteractiveStyleType()||this.vm.isOriginRotateStyle())&&(this.titleView.style={fontSize:14}),this.titleContainer.appendChild(this.titleView),this.appendDescView()}appendDescView(){this.descView=new TKText,this.descView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",marginTop:19,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1},1==this.vm.getInteractiveStyleType()&&(this.descView.style={marginTop:4}),this.titleContainer.appendChild(this.descView)}textDisappearAnimation(){let t=new TKKeyframeAnimation;t.animType="opacity",t.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}],t.duration=500,this.titleContainer&&this.titleContainer.addAnimation(t,"textDisappear")}needChangeRotateView(){return!0}startChangeShakeStyleAnimation(){this.changeShakeStyleAnimation()}changeShakeStyleAnimation(){this.titleContainer&&(this.titleContainer.removeChild(this.descView),this.removeChild(this.titleContainer));let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.updateThisFinalStyle(),1)]),t.duration=400,t.timingFunction="EaseInEaseOut",this.addAnimation(t,"changeShakeStyleAnimation");let e=new TKKeyframeAnimation;if(e.setAnimations([()=>(this.rotateContainer.style={transform:{scale:1}},0),()=>(this.rotateContainer.style={transform:{scale:.6}},.5),()=>(this.updateRotateContainerFinalFrameStyle(),1)]),e.duration=500,e.timingFunction="EaseInEaseOut",this.rotateContainer.addAnimation(e,"changeShakeStyleAnim2"),2==this.vm.getInteractiveStyleType()||this.vm.isOriginRotateStyle()){let t=new TKKeyframeAnimation,e=0;1!=this.vm.getInteractiveStyleType()&&this.vm.isOriginRotateStyle()&&(e=5),t.setAnimations([()=>(this.rotateView.style={transform:{scale:1}},0),()=>(this.rotateView.style={transform:{scale:1.2}},.5),()=>(this.rotateView.style={transform:{translate:{y:e},scale:1.4}},1)]),t.duration=500,t.timingFunction="EaseInEaseOut",this.rotateView.addAnimation(t,"adapterAnim")}}addWhiteLine(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.updateRotateContainerFinalBorderStyle(),1)]),t.duration=500,t.timingFunction="EaseInEaseOut",this.rotateContainer.addAnimation(t,"changeShakeStyleAnim3")}updateThisFinalStyle(){const t=this.endPositionFunc({width:109,height:46});this.style={width:109,height:46,left:t.x,top:t.y,position:"absolute",justifyContent:"center",alignItems:"center"}}updateRotateContainerFinalFrameStyle(){let t=.45;if((2==this.vm.getInteractiveStyleType()||this.vm.isOriginRotateStyle())&&(t=.37),this.rotateContainer.style={transform:{scale:t,translate:{x:-33,y:0}}},this.showAtBottom){let t=0;1!=this.vm.getInteractiveStyleType()&&this.vm.isOriginRotateStyle()&&(t=5),this.rotateView.style={transform:{translate:{y:t},scale:1.4}}}}updateRotateContainerFinalBorderStyle(){this.rotateContainer.style={borderWidth:1,borderColor:"#FFFFFF"}}stopRotateAnimation(){Le.supportMinimumTKVersion("5.0.0")&&this.rotateView&&(this.rotateContainer.removeAllAnimation(),this.rotateView.stop())}resumeLottieAnimation(){Le.supportMinimumTKVersion("5.0.0")&&this.rotateView.resume(),this.shakeView&&this.startShakeAnimation()}pauseLottieAnimation(){Le.supportMinimumTKVersion("5.0.0")&&this.rotateView.pause(),this.shakeView&&this.stopShakeAnimation()}stopActionAnimation(){this.stopRotateAnimation(),this.stopShakeAnimation()}bindSensorListener(){this.vm.startSensorListener(),fi(this.vm.$attrsPath.isStartSensor,(t=>{this.vm.callerContext.hasShowPlayend&&!this.vm.isShowRotateAndShakeView()||(t?(this.vm.startSensorListener(),this.resumeLottieAnimation()):(this.vm.stopSensorListener(),this.pauseLottieAnimation()))}))}addShakeAnim(){let t=new TKKeyframeAnimation;t.animType="rotationZ";let e=Le.isAndroid()?.8:1;t.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.25,value:Le.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.33,value:-Le.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.5,value:Le.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.66,value:-Le.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.83,value:Le.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.91,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}];t.duration=1200,this.shakeView&&this.shakeView.addAnimation(t,"addShakeRotate")}startShakeAnimation(){this.stopShakeAnimation(),this.addShakeAnim(),this.shaketimer=setInterval((()=>{this.addShakeAnim()}),1200)}stopShakeAnimation(){this.shaketimer&&clearInterval(this.shaketimer),this.shakeView&&this.shakeView.removeAllAnimation()}}class Ba extends Ra{setupView(){let t={width:168,height:150};2==this.vm.getInteractiveStyleType()&&(t.height=135);const e=this.startPositionFunc(t);this.setViewPosition(e),this.setVisibility("hidden"),this.appendRotateView(),this.loadFinish()}appendRotateLottieView(){this.rotateContainer=new TKView,this.rotateContainer.style={width:96,height:96,backgroundColor:"#00000064",borderRadius:48,position:"absolute",alignItems:"center"},2==this.vm.getInteractiveStyleType()&&(this.rotateContainer.style={width:110,height:110,borderRadius:55}),this.appendChild(this.rotateContainer),Le.supportMinimumTKVersion("5.0.0")&&(this.rotateView=new TKLottieImageView,this.rotateView.style={width:56,height:56,marginTop:20,position:"absolute"},this.setRotateLottieView("image/ksad-video-image/neo_rotate_style_2.json",this.rotateView,!0),this.arrowView=new TKLottieImageView,this.arrowView.style={top:8,width:80,height:27,position:"absolute"},this.setRotateLottieView("image/ksad-video-image/neo_rotate_arrow.json",this.arrowView,!1),this.vm.rotateInfoCallback=(t,e,i)=>{let n=Math.abs(t)/this.vm.interactionInfo.rotateInfo.x.rotateDegree,s=Math.abs(e)/this.vm.interactionInfo.rotateInfo.y.rotateDegree,a=Math.abs(i)/this.vm.interactionInfo.rotateInfo.z.rotateDegree,o=Math.max(n,s,a);this.arrowView.setProgress(o>1?1:o<0?0:o)})}appendTitleContiner(){this.titleContainer=new TKView,this.titleContainer.style={width:168,height:65,top:106,alignItems:"center"},2==this.vm.getInteractiveStyleType()&&(this.titleContainer.style={top:81}),this.appendChild(this.titleContainer),this.appendTitleView()}appendDescView(){this.descView=new TKText,this.descView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",marginTop:4,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center"},2==this.vm.getInteractiveStyleType()&&(this.descView.style={marginTop:19}),this.titleContainer.appendChild(this.descView)}needChangeRotateView(){return!1}setViewPosition(t){if(this.vm.isShowRotateAndShakeView())switch(this.vm.getBtnPosition()){case 1:this.style={width:168,height:150,left:t.x,top:136,position:"absolute",alignItems:"center"};case 2:this.style={width:168,height:150,left:t.x,bottom:34,position:"absolute",alignItems:"center"}}else this.style={width:168,height:150,left:t.x,top:t.y,position:"absolute",alignItems:"center"};2==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:135})}}class Ka extends Ra{setupView(){var t;let e={width:168,height:150};2==this.vm.getInteractiveStyleType()&&(e.height=135);const i=this.startPositionFunc(e);this.setViewPosition(i),this.setVisibility("hidden"),this.appendRotateView(),(null===(t=this.vm.interactionInfo.rotateInfo)||void 0===t?void 0:t.enable)&&this.appendArrowiconView(),this.loadFinish()}appendArrowiconView(){let t=new TKImage;t.style={height:48,width:48,position:"absolute",alignItems:"center",justifyContent:"center",marginTop:24,marginStart:25},t.setSrc("image/ksad-video-image/rotate_shake_arrow.png"),this.rotateContainer.appendChild(t),this.arrowTop=new TKImage,this.arrowTop.style={height:7,width:14,position:"absolute",marginTop:16,marginStart:42},this.arrowTop.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowTop),this.arrowBottom=new TKImage,this.arrowBottom.style={height:7,width:14,position:"absolute",marginTop:73,marginStart:42,transform:{rotate:{x:180}}},this.arrowBottom.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowBottom),this.arrowLeft=new TKImage,this.arrowLeft.style={height:7,width:14,position:"absolute",marginTop:43,marginLeft:13,transform:{rotate:{z:-90}}},this.arrowLeft.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowLeft),this.arrowRight=new TKImage,this.arrowRight.style={height:7,width:14,position:"absolute",marginTop:43,marginLeft:71,transform:{rotate:{z:90}}},this.arrowRight.setSrc("image/ksad-video-image/rotate_shake_gray.png"),this.rotateContainer.appendChild(this.arrowRight),2==this.vm.getInteractiveStyleType()&&(t.style={marginTop:17,marginStart:31},this.arrowTop.style={marginTop:9,marginStart:48},this.arrowBottom.style={marginTop:66,marginStart:48},this.arrowLeft.style={marginTop:38,marginLeft:19},this.arrowRight.style={marginTop:38,marginLeft:77})}appendRotateLottieView(){var t;if(this.rotateContainer=new TKView,this.rotateContainer.style={width:96,height:96,backgroundColor:"#00000064",borderRadius:48,position:"absolute"},2==this.vm.getInteractiveStyleType()&&(this.rotateContainer.style={width:110,height:110,borderRadius:55}),this.appendChild(this.rotateContainer),Le.supportMinimumTKVersion("5.0.0")&&(this.rotateView=new TKLottieImageView),null===(t=this.vm.interactionInfo.rotateInfo)||void 0===t?void 0:t.enable)Le.supportMinimumTKVersion("5.0.0")&&(this.rotateView.style={width:32,height:32,marginTop:32,marginStart:33,position:"absolute"},2==this.vm.getInteractiveStyleType()&&(this.rotateView.style={marginTop:24,marginStart:39}),this.setRotateLottieView("image/ksad-video-image/neo_rotate_style_3.json",this.rotateView,!0)),this.vm.rotateInfoCallback=(t,e,i)=>{if(this.vm.interactionInfo.rotateInfo){let n=t/this.vm.interactionInfo.rotateInfo.x.rotateDegree,s=e/this.vm.interactionInfo.rotateInfo.y.rotateDegree,a=i/this.vm.interactionInfo.rotateInfo.z.rotateDegree;this.transformCircle(n,s,a)}};else{this.vm.rotateShakeUiStyle=0,this.shakeView=new TKImage,this.shakeView.style={width:44,height:50,marginTop:24,marginLeft:27,position:"absolute"},2==this.vm.getInteractiveStyleType()&&(this.shakeView.style={marginTop:18,marginStart:35}),this.shakeView.setSrc("image/ksad-video-image/rotate_shake_hand.png"),this.rotateContainer.appendChild(this.shakeView);let t=new TKView;t.style={width:"100%",height:"100%",position:"absolute"},this.rotateContainer.appendChild(t),t.addEventListener("tap",(t=>{this.vm.clickLog(t,this)}))}}transformCircle(t,e,i){let n=e;Le.supportMinimumTKVersion("5.0.0")&&(this.rotateView.style={transform:{translate:{x:10*n,y:10*t}}}),(Math.abs(n)>=.9||Math.abs(t)>=.9)&&!this.vm.isShowConvertState&&(n>=.9?this.arrowRight.setSrc("image/ksad-video-image/rotate_shake_white.png"):n<=-.9&&this.arrowLeft.setSrc("image/ksad-video-image/rotate_shake_white.png"),t>=.9?this.arrowBottom.setSrc("image/ksad-video-image/rotate_shake_white.png"):t<=-.9&&this.arrowTop.setSrc("image/ksad-video-image/rotate_shake_white.png"),this.vm.isShowConvertState=!0)}appendTitleContiner(){this.titleContainer=new TKView,this.titleContainer.style={width:168,height:65,top:106,alignItems:"center"},2==this.vm.getInteractiveStyleType()&&(this.titleContainer.style={width:168,height:65,top:81,alignItems:"center"}),this.appendChild(this.titleContainer),this.appendTitleView()}appendDescView(){this.descView=new TKText,this.descView.style={color:"#FFFFFF",shadow:"1 1 1 #00000060",marginTop:4,fontSize:12,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center"},2==this.vm.getInteractiveStyleType()&&(this.descView.style={marginTop:19}),this.titleContainer.appendChild(this.descView)}needChangeRotateView(){return!1}setViewPosition(t){switch(this.vm.getBtnPosition()){case 1:this.style={width:168,height:150,left:t.x,top:136,position:"absolute",alignItems:"center"};break;case 2:this.style={width:168,height:150,left:t.x,bottom:34,position:"absolute",alignItems:"center"};break;default:this.style={width:168,height:150,bottom:34,position:"absolute",alignItems:"center"}}2==this.vm.getInteractiveStyleType()&&(this.style={width:168,height:135})}}class Ea extends TKView{constructor(t){super(),this.vm=t,this.setupView()}setupView(){let e=1==this.vm.callerContext.screenOrientation,i=Y(this.vm.callerContext.adInfo)&&this.vm.getAppScore()>30,n=i&&me(this.vm.getAppDownloadCountDesc()),s=e?54:100;this.coverImageView=new TKImage,this.style=e?{width:"50%",height:"100%",backgroundColor:"#000000A2",flexDirection:"column",alignItems:"center",justifyContent:"center"}:{width:"100%",height:331,backgroundColor:"#FFFFFFD4",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.containerView=new TKView,this.containerView.style={width:"100%",paddingLeft:48,paddingRight:48,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.appendChild(this.containerView),this.imageView=new TKImage,this.imageView.setSrc(M(this.vm.callerContext.adInfo)),this.imageView.style={width:s,height:s,borderRadius:e?14:24},this.containerView.appendChild(this.imageView),this.titleLabel=new TKText,this.titleLabel.setText(X(this.vm.callerContext.adInfo)),this.titleLabel.style={marginTop:16,width:"100%",fontSize:20,color:e?"#FFFFFF":"#222222",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.containerView.appendChild(this.titleLabel),i&&(this.starView=new bi(this.vm.getAppScore()),this.starView.style={marginTop:12},this.starView.addEventListener("tap",(t=>{})),this.containerView.appendChild(this.starView)),n&&(this.downloadCountDescLabel=new TKText,this.downloadCountDescLabel.setText(this.vm.getAppDownloadCountDesc()),this.downloadCountDescLabel.style={marginTop:12,width:"100%",fontSize:e?14:16,color:e?"#FFFFFF":"#666666",textAlign:"center"},this.containerView.appendChild(this.downloadCountDescLabel)),this.subTitleLabel=new TKText,this.subTitleLabel.setText(this.vm.getAdDescription()),this.subTitleLabel.style={marginTop:e?12:16,fontSize:e?14:16,color:e?"#FFFFFF":"#666666",width:"100%",textAlign:"center",textLineClamp:2,textOverflow:"ellipsis"},this.containerView.appendChild(this.subTitleLabel),this.actionBtn=new TKButton,this.actionBtn.setText(ft(this.vm.callerContext.adInfo)),this.actionBtn.style={marginTop:e?24:32,width:"100%",height:48,borderRadius:24,fontSize:16,backgroundColor:"#FE3666",color:"#FFFFFF"},this.containerView.appendChild(this.actionBtn),this.actionBtn.addEventListener("tap",(e=>{this.vm.convert(1,pe(e,this.actionBtn),t.ACTION_BAR_CLICK)}))}}class Pa extends TKView{constructor(t){super(),this.isExpose=!1,this.downloadState=0,this.vm=t,this.setupView(),yi(this.vm,this.vm.$attrsPath.downloadState,(t=>{this.vm.rotateVM.downloadState=t})),ce()?yi(this.vm,this.vm.$attrsPath.focusChangeEvent,(t=>{"windowFocusGet"==t?(this.vm.rotateVM.isStartSensor=!0,this.vm.rotateVM.canRotateConvert=!0):"windowFocusLost"==t&&(this.vm.rotateVM.isStartSensor=!1,this.vm.rotateVM.canRotateConvert=!1)})):yi(this.vm,this.vm.$attrsPath.callerContext.pageFocusAndVisible,(t=>{t?(this.vm.rotateVM.isStartSensor=!0,this.vm.rotateVM.canRotateConvert=!0):(this.vm.rotateVM.isStartSensor=!1,this.vm.rotateVM.canRotateConvert=!1)})),yi(this.vm,this.vm.$attrsPath.canShowAggregation,(t=>{this.parseAgg(this.vm.aggregationCardVM),this.vm.aggregationCardVM.canShowAggregation=t}))}render(){try{return this.webview.render(this.vm.getWebCardEndH5Url()),!0}catch(t){return!1}}show(){if(this.webview){1==this.webview.renderStatus?(this.webview.willShow(),this.endCardView.appendChild(this.webview),this.webview.didShow()):this.setupLocalView();let t=0==this.vm.callerContext.screenOrientation;this.vm.isShowRotatrAndShakeView()&&t&&this.setupRotateView(),this.vm.canShowAggregation&&this.vm.callerContext.adInfo.adConversionInfo.universeAggreEndPage&&t&&setTimeout((()=>{if(this.aggAnim(),!this.isExpose&&this.vm.canShowAggregation){let t=null,e=Qe.createNeoCommonInstance(this.vm.aggregationCardVM.adInfo);e&&(t={clientExtData:JSON.stringify(e)}),ei.expose(t,this.vm.aggregationCardVM.adResult),this.neoAggCardExposure(),this.isExpose=!0}}),1e3*this.vm.callerContext.adInfo.adConversionInfo.universeAggreEndPageTs)}this.vm.canShowPreLandingPage()&&this.preLandingView.show()}setupView(){this.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.endCardView=new TKView,this.endCardView.style={width:"100%",height:"100%",flexDirection:"row",alignItems:"center",justifyContent:"center",bottomLeftRadius:8,bottomRightRadius:8},this.appendChild(this.endCardView),Le.supportMinimumTKVersion("5.1.1")&&4==this.vm.callerContext.adInfo.adBaseInfo.aggMidPageAdType&&this.vm.callerContext.adInfo.adConversionInfo.universeAggreEndPage&&0==this.vm.callerContext.screenOrientation&&this.setupAggCardView();let e=new TKImage;if(e.setSrc(this.vm.getVideoFirstFrame()),e.style={width:"100%",height:"100%",resize:"contain",position:"absolute",borderRadius:8},this.endCardView.appendChild(e),this.vm.canShowPreLandingPage()){this.setPreLandingView();try{const t=this.vm.callerContext.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;ze("component_ui_exist","end_card",String(t.endCardInfo.pageId),"pre-landing-page-card")}catch(i){}}else{this.setupWebView();const t=vt("ksad-pre-landingpage-card",this.vm.callerContext.adInfo);2!=this.vm.callerContext.adStyle||Ce(t)||ze("component_ui_exist","end_card","","pre-landing-page-card",!1)}this.addEventListener("tap",(e=>{this.vm.convert(2,pe(e,this),t.PLAY_END_CALL_CLICK)})),this.vm.supportSlideClick()&&Nt(this,(()=>{this.vm.convert(2,{x:0,y:0},t.PLAY_END_CALL_CLICK)}))}setPreLandingView(){let t=new TKView;t.style={width:"100%",height:"100%",position:"absolute"},this.preLandingView=new Va(this.vm.preFormViewModel),t.appendChild(this.preLandingView),this.endCardView.appendChild(t)}setupWebView(){try{this.webview=new ca(this.vm.webViewVM),this.webview.style={width:"100%",height:"100%",position:"absolute",left:0,borderRadius:8}}catch(t){console.log("webview error")}}setupLocalView(){this.localPlayEndView=new Ea(this.vm),this.endCardView.appendChild(this.localPlayEndView),this.layout(),this.logoView=new Vi(1,this.vm.callerContext.adInfo),this.logoView.style={position:"absolute",left:10,bottom:10},1==this.vm.callerContext.screenOrientation?this.appendChild(this.logoView):this.localPlayEndView.appendChild(this.logoView)}setupRotateView(){const t=t=>{let e=this.vm.callerContext.containerLimit.height-270-t.height,i=(this.vm.callerContext.containerLimit.height-t.height)/2;return e<i&&(e=i),{x:this.vm.callerContext.containerLimit.width/2-t.width/2,y:e}},e=t=>{let e=this.vm.callerContext.containerLimit.height-270-t.height,i=(this.vm.callerContext.containerLimit.height-t.height)/2;return e<i&&(e=i),{x:this.vm.callerContext.containerLimit.width/2-t.width/2,y:e}};1==this.vm.rotateVM.interactionInfo.componentInfo.btnStyle?(this.rotateView=new Ba(this.vm.rotateVM,t,e),this.endCardView.appendChild(this.rotateView)):2!=this.vm.rotateVM.interactionInfo.componentInfo.btnStyle&&0!=this.vm.rotateVM.interactionInfo.componentInfo.btnStyle||(this.rotateView=new Ka(this.vm.rotateVM,t,e),this.endCardView.appendChild(this.rotateView))}setupAggCardView(){this.style={width:"100%",height:"100%",backgroundColor:"#000000",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.aggCardView=new TKView,this.aggCardView.style={width:"100%",height:"45%",position:"absolute",top:this.vm.callerContext.containerLimit.height-274,opacity:0,flexDirection:"column"},this.aggCardView.addEventListener("tap",(t=>{this.vm.canShowAggregation&&this.vm.aggregationCardVM.handleConvert(1,t)})),this.appendChild(this.aggCardView);let t=new TKImage;t.style={height:17,width:36,position:"absolute",alignSelf:"center",top:15},t.setSrc("image/ksad-video-image/aggregation_end_page_arrow.png"),this.aggCardView.appendChild(t);try{this.vm.aggregationCardVM.aggcardType=this.vm.callerContext.adInfo.adMatrixInfo.adDataV2.neoTKInfo.innerAggEndCardType,this.vm.aggregationCardVM.aggcardType==ma.AGG_CARD_FANS?this.aggCard=new fa(this.vm.aggregationCardVM,1):this.vm.aggregationCardVM.aggcardType==ma.AGG_CARD_SHOP?this.aggCard=new Ia(this.vm.aggregationCardVM,1):this.vm.aggregationCardVM.aggcardType==ma.AGG_CARD_LIVE_ORDER?this.aggCard=new Ta(this.vm.aggregationCardVM,1):this.vm.aggregationCardVM.aggcardType==ma.AGG_CARD_LIVE&&(this.aggCard=new ya(this.vm.aggregationCardVM,1)),this.aggCardView.appendChild(this.aggCard),this.aggCard.contentView.style={width:this.vm.callerContext.containerLimit.width,height:"100%",transform:{scale:.85},position:"absolute",top:0}}catch(e){}}aggAnim(){const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.endCardView.style={transform:{translate:{y:0}},opacity:1},0),()=>(this.endCardView.style={transform:{scale:.85,translate:{y:.85*-this.aggCard.getSize().height}},opacity:1},1)]),t.duration=500,t.repeatCount=1,this.endCardView.addAnimation(t,"aggAnim"),setTimeout((()=>{const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.aggCardView.style={transform:{translate:{y:.85*this.aggCard.getSize().height}},opacity:0},0),()=>(this.aggCardView.style={transform:{translate:{y:0}},opacity:1},1)]),t.duration=300,t.repeatCount=1,this.aggCardView.addAnimation(t,"aggAnim1")}),200)}neoAggCardExposure(){let t;switch(function(t){try{return t.adMatrixInfo.adDataV2.neoTKInfo.innerAggEndCardType}catch(e){}return 0}(this.vm.callerContext.adInfo)){case ma.AGG_CARD_FANS:case ma.AGG_CARD_LIVE_ORDER:case ma.AGG_CARD_SHOP:case ma.AGG_CARD_LIVE:t={elementType:233};let e={actionType:140,payload:JSON.stringify(t),adTemplate:JSON.stringify(this.vm.aggregationCardVM.adImpInfo)};ke.sendLog(e)}}parseAgg(t){t.adResult&&(t.adImpInfo=t.adResult.impAdInfo[0],t.adInfo=t.adImpInfo.adInfo[0],t.aggregationCardInfo=function(t){let e=nt(t,12);if(null!=e)return JSON.parse(e.data)}(t.adInfo).innerAggregationInfo)}}class Oa{constructor(t=5e3){this.mStartTimeoutMS=3e3,this.enable=!1,this.mTimer=0,this.startTimeoutCallback=()=>{},this.mStartTimeoutMS=t}onPlayerPrepare(){this.stopTimer(),this.enable=!0,this.mTimer=setTimeout((()=>{this.enable&&this.startTimeoutCallback&&this.startTimeoutCallback()}),this.mStartTimeoutMS)}onFirstFrame(){this.stopTimer()}stopTimer(){this.mTimer>0&&(clearTimeout(this.mTimer),this.enable=!1,this.mTimer=0)}}class Ma{constructor(t,e){this.enable=!0,this.mOnFailedCallback=(t,e)=>{this.isEnable()&&(this.vm.videoPlayFailed(t,e),Oe().emit(a,{errorCode:t,errorReason:t}))},this.mOnFinishCallback=()=>{this.isEnable()&&(Oe().emit(o,{code:1}),this.vm.videoPlayFinished())},this.mOnFirstFrameCallback=()=>{this.isEnable()&&(this.vm.videoPlayStart(),this.mOuterFirstFrameCallback&&this.mOuterFirstFrameCallback())},this.mOnProgressCallback=(t,e,i)=>{this.isEnable()&&(this.vm.updateVideoProgress(t,e,i),ei.updateVideoPlayStatus("progress",0,"",1e3*t),Oe().emit(r,{currentTime:t,avaliableTime:e,totalTime:i}),this.mOuterProgressCallback&&this.mOuterProgressCallback(t,e,i))},this.mOnMuteChangeCallback=t=>{this.isEnable()&&(this.vm.isMuted=t,Oe().emit(s,{muted:t}))},this.mOnStatusCallback=t=>{this.isEnable()&&(this.vm.playStatus=t)},this.enable=!0,this.vm=t,this.mName=e}destroy(){this.enable=!1,this.vm=null}isEnable(){return this.enable&&null!=this.vm}}class Na{static initImagePlayer(t,e,i,n){let s=i.getView();n.mOuterProgressCallback=(t,e,i)=>{t%5==0&&Na.playerScaleAnimation(s)};let a=H(e.adInfo);i.setURLs([a]),i.setDuration(e.getVideoDuration()),s.style={width:"100%",height:"100%"},i.setOnProgress(n.mOnProgressCallback),i.setOnFirstFrame(n.mOnFirstFrameCallback),i.setOnFinish(n.mOnFinishCallback),i.setOnFailed(n.mOnFailedCallback),i.setOnStatusCallback(n.mOnStatusCallback),Na.setActions(s,e)}static setActions(e,i){let n=new b;n.material_click_area=2==i.adStyle?"neo_image":"fullscreen_image";const s=i.getActionBarStyle();n.template_show_type=10==s?"picture_template10":"picture_template9",i.isSlideEnable()&&(ce()?Nt(e,(()=>{i.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,n)})):e.addEventListener("swipe",(e=>{i.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,n)}))),e.addEventListener("tap",(s=>{const a=pe(s,e);i.convert(3,a,t.CARD_PAGE_CLICK,n)}))}static playerScaleAnimation(t){let e=new TKKeyframeAnimation;e.duration=1600,e.timingFunction="Linear",e.setAnimations([()=>(t.style={transform:{scale:1.1}},.25),()=>(t.style={transform:{scale:1}},.5),()=>(t.style={transform:{scale:1.1}},.75),()=>(t.style={transform:{scale:1}},1)]),t.addAnimation(e,"playerScale")}}!function(t){t.IMAGE="image",t.LIVE="live",t.VIDEO="video"}(ua||(ua={}));class Ha{constructor(){try{Le.supportMinimumTKVersion("5.0.3")&&(this.mDelegate=new TKImagePlayer)}catch(t){}}getView(){return Le.supportMinimumTKVersion("5.0.3")?this.mDelegate:null}isImagePlayerAvailable(){return!!Le.supportMinimumTKVersion("5.0.3")&&null!=this.mDelegate}setURLs(t){this.isImagePlayerAvailable()&&this.mDelegate.setURLs(t)}setDuration(t){this.isImagePlayerAvailable()&&this.mDelegate.setDuration(t)}setImageResize(t){this.isImagePlayerAvailable()&&this.mDelegate.setImageResize(t)}setVerticalGravity(t){this.isImagePlayerAvailable()&&this.mDelegate.setVerticalGravity(t)}setHorizontalGravity(t){this.isImagePlayerAvailable()&&this.mDelegate.setHorizontalGravity(t)}play(){this.isImagePlayerAvailable()&&this.mDelegate.play()}pause(){this.isImagePlayerAvailable()&&this.mDelegate.pause()}resume(){this.isImagePlayerAvailable()&&this.mDelegate.resume()}stop(){this.isImagePlayerAvailable()&&this.mDelegate.stop()}setEnableCache(t){this.isImagePlayerAvailable()&&this.mDelegate.setEnableCache(t)}setOnFirstFrame(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnFirstFrame(t)}setOnProgress(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnProgress(t)}setOnFinish(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnFinish(t)}setOnFailed(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnFailed(t)}setOnStatusCallback(t){this.isImagePlayerAvailable()&&this.mDelegate.setOnStatusCallback(t)}}class Wa{constructor(t,e){this.mEnableRollbackToImage=!1,this.vm=t,this.mEnableRollbackToImage=e}setupPlayer(t,e){if(this.mEnableRollbackToImage){let e=function(t){try{let e=t.abConfig.videoRollbackToImageTimeout;return Math.floor(e)}catch(e){return 4e3}}(ee());this.mTimeoutHelper=new Oa(e),this.mTimeoutHelper.startTimeoutCallback=()=>{this.rollbackToImage(t)}}this.mRealPlayer=new TKVideoPlayer,this.mVideoPlayerCallbacks=new Ma(this.vm,"VideoPlayerCallbacks"),this.mVideoPlayerCallbacks.mOuterFirstFrameCallback=()=>{this.mTimeoutHelper&&this.mTimeoutHelper.onFirstFrame(),qt(ua.VIDEO),e&&e()},this.initVidePlayer(t,this.mRealPlayer,this.mVideoPlayerCallbacks),this.mTimeoutHelper&&this.mTimeoutHelper.onPlayerPrepare()}initVidePlayer(t,e,i){e.setURL(this.vm.getVideoURL()),e.style={width:"100%",height:"100%"},Le.supportMinimumTKVersion("4.0.9")&&e.setVideoAdaptStrategy(1),e.prepareToPlay(),e.setMuted(this.vm.isMuted),t.appendChild(e),e.setOnFailed(i.mOnFailedCallback),e.setOnFinish(i.mOnFinishCallback),e.setOnProgress(i.mOnProgressCallback),e.setOnFirstFrame(i.mOnFirstFrameCallback),e.setOnMuteChange(i.mOnMuteChangeCallback),Le.supportMinimumTKVersion("4.0.9")&&e.setOnStatusCallback(i.mOnStatusCallback)}rollbackToImage(t){let e=this.mRealPlayer;this.mVideoPlayerCallbacks.destroy(),this.mVideoPlayerCallbacks=null,this.mRealPlayer=new Ha,this.mImagePlayerCallbacks=new Ma(this.vm,"ImagePlayerCallbacks"),Na.initImagePlayer(t,this.vm,this.mRealPlayer,this.mImagePlayerCallbacks),this.mRealPlayer.play(),t.replaceChild(Wa.obtainPlayerView(this.mRealPlayer),Wa.obtainPlayerView(e)),e.stop(),e=null,this.vm.onDowngrade()}getView(){return Wa.obtainPlayerView(this.mRealPlayer)}static obtainPlayerView(t){return t instanceof TKVideoPlayer?t:t instanceof Ha?t.getView():null}play(){this.mRealPlayer.play()}pause(){this.mRealPlayer.pause()}resume(){this.mRealPlayer.resume()}stop(){this.mRealPlayer.pause(),this.mRealPlayer.stop()}setForceGetAudioFocus(t){this.mRealPlayer instanceof TKVideoPlayer&&this.mRealPlayer.setForceGetAudioFocus&&this.mRealPlayer.setForceGetAudioFocus(t)}setMuted(t){this.mRealPlayer instanceof TKVideoPlayer&&this.mRealPlayer.setMuted&&this.mRealPlayer.setMuted(t)}setAnimation(t,e){this.mRealPlayer instanceof TKVideoPlayer&&this.mRealPlayer.setAnimation&&this.mRealPlayer.setAnimation(t,e)}}class za extends TKView{constructor(t){super(),this.vm=t,this.setupView(),this.setupActions(),yi(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"showEnd":this.hasPlay||(this.hasPlay=!0,this.player.play());break;case"pageVisiable":this.resume();break;case"pageInvisiable":this.player.pause();break;case"hideEnd":this.player.stop()}})),yi(this.vm,this.vm.$attrsPath.isMuted,(t=>{this.player.setMuted(t)})),this.player.setForceGetAudioFocus(this.vm.configInfo.appConfig.forceGetAudioFocus)}setAnimation(t,e){Le.supportMinimumTKVersion("4.0.9")&&this.player.setAnimation(t,e)}setupActions(){let e=new b;e.material_click_area=2==this.vm.adStyle?"neo_video":"fullscreen_video",this.vm.isSlideEnable()&&(Nt(this.player.getView(),(()=>{this.vm.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this,(()=>{this.vm.convert(3,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))),this.player.getView().addEventListener("tap",(i=>{const n=pe(i,this.player.getView());this.vm.convert(3,n,t.CARD_PAGE_CLICK,e)})),this.addEventListener("tap",(i=>{const n=pe(i,this);this.vm.convert(3,n,t.CARD_PAGE_CLICK,e)}))}setupView(){this.style={flexDirection:"row",alignItems:"center",justifyContent:"center"},ce()||(this.currentFrame=new TKImage,this.currentFrame.style={width:"100%",height:"100%",position:"absolute",left:0,top:0,resize:"contain"},this.currentFrame.setSrc(this.vm.getVideoFirstFrame()),this.appendChild(this.currentFrame));let t=function(t,e){try{if(!Le.supportMinimumTKVersion("5.0.3"))return!1;let i=H(t);return e.abConfig.videoRollbackToImageTimeout>0&&!Ce(i)}catch(i){return!1}}(this.vm.adInfo,ee());this.player=new Wa(this.vm,t),this.player.setupPlayer(this,(()=>{this.currentFrame&&this.currentFrame.setVisibility("hidden")}))}resume(){this.vm.isDialogShowing()||this.player.resume()}pause(){this.player.pause()}stop(){this.player.stop()}}class Ua extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas(),this.setupActions(),yi(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"pageVisiable":this.vm.isPaused=!1;break;case"pageInvisiable":this.vm.isPaused=!0}})),yi(this.vm,this.vm.$attrsPath.isPaused,(t=>{t?this.vm.timerPaused():this.vm.timerResume()})),yi(this.vm,this.vm.$attrsPath.isShowEnd,(t=>{if(t){const t=this;this.showEndAniamtion((()=>{t.removeAllAnimation(),t.setVisibility("hidden")}))}}))}setupViews(){this.style={top:-66,width:343,height:66,position:"absolute",alignSelf:"center",opacity:0},this.contentContainer=new TKView,this.contentContainer.style={width:"100%",height:"100%",borderRadius:12,padding:14,flexDirection:"row",justifyContent:"space-between",backgroundColor:"#FFFFFFE2",alignItems:"center"},this.appendChild(this.contentContainer),this.iconView=new TKImage,this.iconView.style={width:38,height:38,borderRadius:6},this.contentContainer.appendChild(this.iconView);let t=new TKView;t.style={height:"100%",flexDirection:"column",justifyContent:"center",flexGrow:1,flexShrink:1,paddingLeft:12,paddingRight:7},this.contentContainer.appendChild(t),this.titleText=new TKText,this.titleText.style={height:20,fontSize:15,fontWeight:"500",textOverflow:"ellipsis",textLineClamp:1,color:"#222222",includeFontPadding:!1},t.appendChild(this.titleText),this.descText=new TKText,this.descText.style={top:1,height:16,fontSize:12,fontWeight:"400",textOverflow:"ellipsis",textLineClamp:1,includeFontPadding:!1,color:"#666666"},t.appendChild(this.descText),this.actionButton=new TKButton,this.actionButton.style={width:80,height:32,borderRadius:16,fontSize:12,fontWeight:"500",color:"#FFFFFF",backgroundColor:"#FE3666"},this.contentContainer.appendChild(this.actionButton)}setupDatas(){this.iconView.setSrc(this.vm.getAdIcon()),this.titleText.setText(this.vm.getAdTitle()),this.descText.setText(this.vm.getAdDescription()),this.actionButton.setText(this.vm.getAdActionDesc())}setupActions(){let e=new b;e.template_show_type="push_card",this.contentContainer.addEventListener("tap",(i=>{const n=pe(i,this);this.vm.convert(2,n,t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&Nt(this.contentContainer,(()=>{this.vm.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.actionButton.addEventListener("tap",(i=>{const n=pe(i,this);this.vm.convert(1,n,t.CARD_ACTION_BAR_CLICK,e)}))}show(){this.vm.pushCardIsShow||(this.vm.pushCardIsShow=!0,this.vm.reportPlayEndImpression(),this.vm.timerPlay(),this.startAnimation())}startAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={top:this.vm.getTopMargin(),opacity:1},1)]),t.duration=300,this.addAnimation(t,"pushShowAnimation")}showEndAniamtion(t){const e=this;let i=new TKKeyframeAnimation;i.setAnimations([()=>(e.contentContainer.style={opacity:1},0),()=>(e.contentContainer.style={opacity:0},1)]),i.timingFunction="ease-out",i.duration=200,this.contentContainer.addAnimation(i,"pushShowEndAnimation"),i.on("end",(()=>{t&&t()}))}}class Ga{constructor(){this.mCurrentStatus="none",this.mLoadFinished=!1,this.mVisible=!1,this.mHadFocus=!1}updateLifecycleStatus(t){"showEnd"==t?(this.mLoadFinished=!0,this.mHadFocus=!0,this.mVisible=!0):"pageVisiable"==t?this.mVisible=!0:"pageInvisiable"!=t&&"hideStart"!=t&&"hideEnd"!=t||(this.mVisible=!1),this.mCurrentStatus=t}updateWindowFocusChangeEvent(t){"windowFocusGet"==t?this.mHadFocus=!0:"windowFocusLost"==t&&(this.mHadFocus=!1)}isVisible(){return this.mLoadFinished&&this.mVisible}isFocusAndVisible(){return this.mLoadFinished&&this.mVisible&&this.mHadFocus}isFocus(){return this.mHadFocus}}class ja extends ji{constructor(t,e,i,n,s){if(super(),this.lifeStatus="none",this.styleDataInfo=void 0,this.slotId=-1,this.componentData=void 0,this.needShowFlag=!0,this.cardTopMargin=0,this.cardBottomMargin=0,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.styleType=n,s&&(this.slotId=s),F(this.adInfo)){let t=k(this.adInfo,"auto-call-app",this.slotId);t&&(this.styleDataInfo=R(t),this.componentData=t)}else this.styleDataInfo=at(this.adInfo,this.styleType);this.adDefaultMaterialType=N(this.adInfo)}isValidSDKVersion(){return!!Le.supportMinimumTKVersion("4.0.6")}isValidCardInfo(){return null!=this.styleDataInfo}shouldShowAutoCallAppCard(t=void 0){this.isValidCardInfo()?t&&t(!0):t&&t(!1)}setConverted(t){this.convertNotify&&this.convertNotify(t)}closeAutoCall(){this.closeAutoCallCallback&&this.closeAutoCallCallback()}enableShowAutoCallOnInInterstitial(){return!!(this.isValidSDKVersion()&&this.needShowFlag&&this.isValidCardInfo())}updateLifeStatus(t){this.lifeStatus=t}}class Ya extends ji{constructor(t,e,i,n,s,a){super(),this.lifeStatus="none",this.cardTopMargin=0,this.cardBottomMargin=0,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.styleType=n,this.containerLimit=s,this.screenOrientation=a,this.setupData()}setupData(){this.couponWidgetInfo=function(t,e){let i=nt(t,e);if(null!=i)return JSON.parse(i.data).couponWidgetInfo}(this.adInfo,this.styleType)}isValidSDKVersion(){return!(!Le.isAndroid()||!Le.supportMinimumTKVersion("4.0.8"))}isValidCardInfo(){return null!=this.couponWidgetInfo}isHasGuideHandle(){return 1==this.couponWidgetInfo.gestureType}isSecondIcon(){return 1==this.couponWidgetInfo.showSecondIconType}isShowRightTop(){return 1==this.couponWidgetInfo.type||1==this.screenOrientation}getCouponWidgetInfoBusinessType(){return this.couponWidgetInfo.businessType}getCardWidth(){return 100}getCardHeight(){return 140}getIconImageWidth(){return 100}getIconImageHeight(){return 100}getGuidanceImageWH(){return 54}getGuidanceImageMarginTop(){return this.getCardHeight()-this.getGuidanceImageWH()-15}getGuidanceImageMarginLeft(){return this.getCardWidth()-this.getGuidanceImageWH()}getCouponGuideMsgText(){try{return this.couponWidgetInfo.guideMsg}catch(t){}return""}getCouponPriceText(){try{return this.couponWidgetInfo.price}catch(t){}return""}getCouponPriceTagText(){try{return this.couponWidgetInfo.priceTag}catch(t){}return""}getCouponFirstIconUrlText(){try{return this.couponWidgetInfo.firstIcon}catch(t){}return""}getCouponSecondIconUrlText(){try{return this.couponWidgetInfo.secondIcon}catch(t){}return""}reportCouponClick(e){let i=new b,n=new S;n.couponType=this.getCouponWidgetInfoBusinessType(),i.neo_ext_data=n,ei.convertIfNeeded(1,this.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK,i)}reportCouponImpression(){let t=new b,e=new S;e.couponType=this.getCouponWidgetInfoBusinessType(),t.neo_ext_data=e;let i={elementType:13,clientExtData:JSON.stringify(t)},n={actionType:140,payload:JSON.stringify(i)};ke.sendLog(n)}}!function(t){t[t.SHOW_WHEN_PAUSE=1]="SHOW_WHEN_PAUSE",t[t.SHOW_WHEN_STATE_SWITCH=2]="SHOW_WHEN_STATE_SWITCH"}(wa||(wa={}));class Xa extends ji{constructor(t,e,i,n){super(),this.downloadState=0,this.descText="",this.showPopupView=!1,this.showControlStrategy=null,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.screenOrientation=n;let s=Ut(this.adInfo);this.needDownloadingState=!!s&&(3!=e&&2!=e&&1!=e)}onCloseClick(){this.showControlStrategy=wa.SHOW_WHEN_PAUSE,Ut(this.adInfo)?this.needDownloadingState?this.showControlStrategy=wa.SHOW_WHEN_STATE_SWITCH:this.showControlStrategy=wa.SHOW_WHEN_PAUSE:zt(this.adInfo)&&(this.showControlStrategy=wa.SHOW_WHEN_PAUSE)}pageVisibleChange(t){t&&this.updateState(this.downloadState)}updateDownloadProgress(t){1==t.getDownloadState()&&0==t.getProgress()&&(this.showPopupView=!1),t.getTotalBytes()>0&&(this.downloadProgress=t.getProgress(),this.updateDesc(t.getDownloadState(),t.getProgress()),this.updateState(t.getDownloadState()))}updateDesc(t,e){if(this.needDownloadingState){let i=3==t;this.descText=i?"继续下载应用":`下载中${(100*e).toFixed(0)}%`}else this.descText="继续下载应用"}updateState(t){if(0==t)return void(this.downloadState=t);let e=this.downloadState;if(this.downloadState=t,this.showControlStrategy)this.handleShowControlStrategy(e,this.downloadState);else switch(this.downloadState){case 0:case 1:case 4:case 6:break;case 2:this.needDownloadingState?this.showPopupView=!0:this.showPopupView=!1,3==e&&ke.showToast(this.getContinueToast());break;case 3:this.needDownloadingState||(this.showPopupView=!0),ke.showToast(this.getPauseToast());break;case 5:this.showPopupView=!1}}handleShowControlStrategy(t,e){this.showControlStrategy==wa.SHOW_WHEN_PAUSE?3==e&&(this.showPopupView=!0,this.showControlStrategy=null):this.showControlStrategy==wa.SHOW_WHEN_STATE_SWITCH&&(3==e&&2==t||2==e&&3==t)&&(this.showPopupView=!0,this.showControlStrategy=null)}isDownloadPaused(){return 3==this.downloadState}isNeedShowDownloading(){return this.needDownloadingState}convert(t,e,i,n,s=null,a){ei.convertIfNeeded(t,this.adInfo,e,i,n,s,a)}getDesText(){return this.descText}getContinueToast(){return"继续下载中"}getDeleteToast(){return"取消安装,已删除安装包"}getPauseToast(){return"已暂停下载"}}let Ja="MIUI",$a="FLYME",Za="SAMSUNG";class qa{static isMiui(){return this.check(Ja)}static check(t){return!!ce()&&(this.init(),this.sName.indexOf(t)>=0)}static init(){const t=KSAdSystemUtil.getBUILD();this.sName||(Ce(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.build.version.opporom",""))?Ce(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.vivo.os.version",""))?Ce(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.build.version.emui",""))?Ce(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.miui.ui.version.name",""))?Ce(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.product.system.manufacturer",""))?Ce(this.sVersion=KSAdSystemUtil.getSystemProperty("ro.smartisan.version",""))?Ce(this.sVersion=KSAdSystemUtil.getSystemProperty(Za,""))?(this.sVersion=t.DISPLAY,this.sVersion.toUpperCase().indexOf($a)>=0?this.sName=$a:(this.sVersion="Unknown",this.sName=t.MANUFACTURER)):this.sName=Za:this.sName="SMARTISAN":this.sName="OnePlus":this.sName=Ja:this.sName="EMUI":this.sName="VIVO":this.sName="OPPO")}}class Qa{static openDeeplink(t,e,i){if(Le.supportMinimumTKVersion("4.0.9")){let n=new KSAdNativeIntent;n.setUrl(t),n.setAction("android.intent.action.VIEW"),Le.isAndroid()||n.putExtra("KSAdOpenURLOptions","UIApplicationOpenURLOptionUniversalLinksOnly"),Le.supportMinimumTKVersion("5.0.7")&&n.addFlags(268435456),n.setPageStatusCallback((t=>{e(t)})),this.canOpenDeeplink(n)?(i&&i(),KSAdNativeContext.startPage(n)):e(!1,2)}else e(!1,1)}static canOpenDeeplink(t){if(ce()){const e=KSAdNativeContext.getPackageManager().queryIntentActivities(t,65536);return e&&e.length>0}return!0}}class to{static isPkgInstalled(t){if(ce()){return!Ce(KSAdNativeContext.getPackageManager().getPackageInfo(t,0))}return!0}static openApp(t,e){if(!ce())return void(e&&e(!1));if(Ce(t))return void(e&&e(!1));let i=KSAdNativeContext.getPackageManager().getLaunchIntentForPackage(t);i?(i.addFlags(270532608),i.setPageStatusCallback((t=>{e&&e(t)})),KSAdNativeContext.startPage(i)):e&&e(!1)}}var eo=function(t,e,i,n){return new(i||(i=Promise))((function(s,a){function o(t){try{h(n.next(t))}catch(e){a(e)}}function r(t){try{h(n.throw(t))}catch(e){a(e)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}h((n=n.apply(t,e||[])).next())}))};const io="__itemId__",no="__simpleItemId__";class so{static handleDeeplink(t,e,i){var n,s,a,o;return eo(this,void 0,void 0,(function*(){if(!(null===(s=null===(n=t.adInfo)||void 0===n?void 0:n.adConversionInfo)||void 0===s?void 0:s.deeplinkUrl))return void(e&&e(0));let r=this.obtainDeeplinkResult(t);if(Ce(r)||r.indexOf(" ")>=0)return e&&e(-1),function(t,e,i,n,s){var a,o,r;Ge({category:"ad_client_error_log",biz:qe(null===(a=t.scene)||void 0===a?void 0:a.adStyle),sub_biz:"OTHER",rate:1,tag:"response_biz_error",suffixRatio:"",event_id:e,type:"OTHER",msg:{creative_id:null===(o=t.adInfo)||void 0===o?void 0:o.adBaseInfo.creativeId,llsid:null===(r=t.originAdInfo)||void 0===r?void 0:r.llsid,error_name:n,error_data:s},primaryKey:i})}(t,"response_biz_error_convert","dpLinkError","dpLinkError",r),void Xe(t,6,r);Ye(t,1,r);let h=this.replaceTSMacro(r,t);h=this.appendParams(h,t);const l=this.getGlobalReportData(h);null===(o=null===(a=t.adInfo)||void 0===a?void 0:a.adBaseInfo)||void 0===o||o.productName;this.openDeeplink(h,((n,s)=>{console.log("tkloadcontroller  dp跳转："+n+" ext:"+l),e&&e(n?1:-1,l),n?Ye(t,4,h):Xe(t,2==s?2:6,h),this.handleDeepResult(n,t,h,i)}),(()=>{Ye(t,3,h)}))}))}static openDeeplink(t,e,i){Qa.openDeeplink(t,e,i)}static handleDeepResult(t,e,i,n){var s;if(t){if(ei.sendLog(320,{},e.originAdInfo),this.sHasCheckDeeplinkResult)return;let t=Math.abs(null===(s=e.serverConfig)||void 0===s?void 0:s.appConfig.deeplinkCheckSwitch);t>0?(this.sHasCheckDeeplinkResult=!0,setTimeout((()=>{this.sHasCheckDeeplinkResult=!1;if(2===KSAdTKApplication.getCurrentAppState()){const t={deeplinkType:1};ei.sendLog(803,t,e.originAdInfo),Ye(e,5,i),n&&n()}}),1e3*t)):n&&n()}else ei.sendLog(321,{},e.originAdInfo)}static obtainDeeplinkResult(t){var e,i,n,s,a,o,r;if(ce())for(let h=0;h<(null===(n=null===(i=null===(e=t.adInfo)||void 0===e?void 0:e.adConversionInfo)||void 0===i?void 0:i.deeplinkConf)||void 0===n?void 0:n.length);++h){const e=t.adInfo.adConversionInfo.deeplinkConf[h];if(!Ce(e.url)){const i=Ce(e.areaConf)||0==e.areaConf.length||e.areaConf.indexOf(t.itemClickType)>=0,n=Ce(e.sceneConf)||0==e.sceneConf.length||e.sceneConf.indexOf(t.clickScene)>=0;if(i&&n)return e.url+(null===(a=null===(s=t.adInfo)||void 0===s?void 0:s.adConversionInfo)||void 0===a?void 0:a.deeplinkExtra)}}return null===(r=null===(o=t.adInfo)||void 0===o?void 0:o.adConversionInfo)||void 0===r?void 0:r.deeplinkUrl}static appendParams(t,e){var i,n;if(e.adInfo.adConversionInfo.isSupportKeepPlaying&&e.currentPlayTime&&(null===(i=null==e?void 0:e.adInfo)||void 0===i?void 0:i.adConversionInfo.keepPlayingBackOffTime)){const i=Math.max(e.currentPlayTime-(null===(n=null==e?void 0:e.adInfo)||void 0===n?void 0:n.adConversionInfo.keepPlayingBackOffTime),0);t=this.appendQueryParam(t,{KWAI_PLAYSTARTTIME:i.toString()})}return 1==e.adInfo.adBaseInfo.universeLiveType&&e.adInfo.advertiserInfo.userId&&e.liveItemId&&(t=this.appendLiveParams(t,e)),(q(e.adInfo)||Q(e.adInfo)&&e.scene)&&(t=this.appendEcParams(t,e)),t}static appendLiveParams(t,e){var i;if(Le.supportMinimumTKVersion("5.1.2")){if(!e.adInfo.adConversionInfo.needDeeplinkReplaceAdapta)return t;const n=new KSAdTKFlowUuid;let s=e.liveItemId,a="";return Ce(s)||(a=n.decryptLongFromBase64(a)),Ce(a)||Ce(s)?t.indexOf(io)>0||t.indexOf(no)>0?null===(i=e.adInfo)||void 0===i?void 0:i.adConversionInfo.deeplinkUrl:t:t.replace(io,s).replace(no,a)}return t}static replaceTSMacro(t,e){return t.replace("__TS__",KSAdSystemUtil.getSystemTimeInMs(e.adInfo.adBaseInfo.enableClientProofreadTime).toString())}static appendEcParams(t,e){var i;if(!(null===(i=e.scene)||void 0===i?void 0:i.backUrl))return t;let n=3;return to.isPkgInstalled("com.smile.gifmaker")&&(n=0),this.appendQueryParam(t,{KWAI_RETURN_BACK:"liveunion_"+e.appId,KWAI_BACKURL:e.scene.backUrl})}static appendQueryParam(t,e){let i="",n="";for(let s in e)n+=s+"="+e[s]+"&";return i=t.indexOf("?")>0?t.endsWith("&")?t+n:t+"&"+n:t+"?"+n,i}static getGlobalReportData(t){const e=t.split("?");if(e.length>=2){const t=e[1].split("&");if(t.length>=1)for(let e in t){const i=t[e].split("=");if(2==i.length&&"universeClientInfo"===i[0]){return decodeURIComponent(i[1])}}}return null}}so.sHasCheckDeeplinkResult=!1;let ao={HUAWEI:"com.huawei.appmarket",OPPO:"com.oppo.market",vivo:"com.bbk.appstore",xiaomi:"com.xiaomi.market",OnePlus:"com.oppo.market",Meizu:"com.meizu.mstore",samsung:"com.sec.android.app.samsungapps",SMARTISAN:"com.smartisanos.appstore",Realme:"com.oppo.market",HONOR:"com.huawei.appmarket"};class oo{static openAppMarket(t,e,i){var n,s,a,o;let r=null===(n=t.adInfo)||void 0===n?void 0:n.adConversionInfo.marketUrl;if(Ce(r)||!ce())return $e(t,4,r,"not Android platform or marketUrl is empty",!1,!0),void e(!1);"sumsung"===KSAdSystemUtil.getBUILD().BRAND&&(r="http://apps.samsung.com/appquery/appDetail.as?appId="+(null===(s=t.adInfo)||void 0===s?void 0:s.adBaseInfo.appPackageName));try{if(Le.supportMinimumTKVersion("5.0.7")){Je(t,1,r,!1,!0);const n=KSAdSystemUtil.getBUILD().BRAND;let s=ao[n],h=new KSAdNativeIntent;h.setUrl(r),h.setAction("android.intent.action.VIEW"),h.addFlags(268435456);let l=KSAdNativeContext.getPackageManager().queryIntentActivities(h,0);if(!l)return e(!1),void $e(t,4,r,"no match app",!1,!0);for(let d in l){const c=l[d],p=null===(a=null==c?void 0:c.activityInfo)||void 0===a?void 0:a.packageName;if(p===s||this.adaptOs(p,n))return h.setComponentName(p,null===(o=null==c?void 0:c.activityInfo)||void 0===o?void 0:o.name),h.setPageStatusCallback((n=>{if(n)return e(n),ei.sendLog(323,{appStorePageType:0,triggerType:0},t.originAdInfo),Je(t,2,r,!1,!0),void this.checkAppMarketNs(t,r,i);this.openMarketDefault(t,r,e,i)})),void KSAdNativeContext.startPage(h)}return void e(!1)}e(!1),$e(t,4,r,"tk version less than 5.0.7",!1,!0)}catch(h){je(h),this.openMarketDefault(t,r,e,i)}}static checkAppMarketNs(t,e,i){var n;let s=Math.abs(null===(n=t.serverConfig)||void 0===n?void 0:n.appConfig.deeplinkCheckSwitch);s>0?setTimeout((()=>{2===KSAdTKApplication.getCurrentAppState()&&Je(t,3,e,!1,!0),i&&i()}),1e3*s):i&&i()}static openMarketDefault(t,e,i,n){if(Le.supportMinimumTKVersion("5.0.7")){let s=new KSAdNativeIntent;s.setUrl(e),s.setAction("android.intent.action.VIEW"),s.addFlags(268435456),s.setPageStatusCallback((s=>{i(s),s?(ei.sendLog(323,{appStorePageType:0,triggerType:0},t.originAdInfo),Je(t,2,e,!1,!1),Je(t,3,e,!1,!1),n&&n()):$e(t,4,e,"unknown_openMarketDefault",!1,!1)})),KSAdNativeContext.startPage(s)}else i(!1),$e(t,4,e,"tk version less than 5.0.7",!1,!1)}static adaptOs(t,e){return"OPPO"===e&&"com.heytap.market"===t}static openMiAppStore(t,e){var i,n;if(!ce())return void e(!1);const s=null===(i=t.adInfo)||void 0===i?void 0:i.adConversionInfo.marketUrl;ce()&&s&&qa.isMiui()&&4!=(null===(n=t.scene)||void 0===n?void 0:n.adStyle)?(Je(t,1,s,!0,!1),so.openDeeplink(s,(i=>{e(i),i?(ei.sendLog(323,{appStorePageType:1,triggerType:0},t.originAdInfo),Je(t,2,s,!0,!1),this.checkAppMarketNs(t,s)):$e(t,4,s,"unknown_openMiAppStore",!0,!1)}),(()=>{}))):e(!1)}static isSupportMiMarket2(){if(!ce()||!qa.isMiui())return!1;if(Le.supportMinimumTKVersion("6.0.3")){let e=null;try{if(e=KSAdNativeContext.getContentResolver().query("content://com.xiaomi.market.provider.DirectMailProvider",null,null,null,null),null==e||e.isClosed())return console.log("AppMarketHelper: isSupportMiMarket2-----cursor is null"),!1;e.moveToFirst();let t=e.getColumnIndex("support");if(t>=0){return"true"===e.getString(t)}return!1}catch(t){console.log("AppMarketHelper: isSupportMiMarket2-----"+t)}finally{null!=e&&e.close()}}return!1}static isMiMarket2Dp(t){return!(!t.startsWith("market://details")&&!t.startsWith("mimarket://details"))}}class ro extends $i{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.bottomCouponInfo=function(t,e){let i=nt(t,e);if(!Ce(i))return JSON.parse(i.data).bottomCouponInfo}(this.adInfo,3)}}var ho,lo,co;!function(t){t[t.NEO=0]="NEO",t[t.FULLSCREEN=1]="FULLSCREEN",t[t.LIVE_NEO=2]="LIVE_NEO",t[t.LIVE_FULLSCREEN=3]="LIVE_FULLSCREEN",t[t.IMAGE_NEO=4]="IMAGE_NEO",t[t.IMAGE_FULLSCREEN=5]="IMAGE_FULLSCREEN"}(ho||(ho={})),function(t){t[t.Unknow=0]="Unknow",t[t.neoGift=1]="neoGift"}(lo||(lo={}));class po extends ji{constructor(){super(...arguments),this.isPlayAgain=!1,this.currentPlaybackTime=0,this.lifeStatus="none",this.isMoreShow=!1,this.sceneSource=lo.Unknow,this.sceneType=0,this.isNeedExpose=!0}checkDataValid(){return!!this.adInfo}refreshCurrentTime(t){}getShowAlertInfo(){let t="观看完整视频即可获取奖励";try{let e=this.adInfo.adRewardInfo.rewardTime;e<this.getVideoDuration()&&(t="观看视频"+e.toString()+"s即可获取奖励")}catch(e){}return t}getVideoDuration(){let t=0;try{let e=this.adInfo;const i=e.adMaterialInfo.materialFeature.length>0?e.adMaterialInfo.materialFeature[0]:null;i&&(t=i.videoDuration,0==t&&(t=i.videoDurationMs/1e3))}catch(e){}return t}getRewardTime(){return dt(this.adInfo)}getIconUrl(){try{let t=this.adInfo.adBaseInfo.appIconUrl;return me(t)||(t=this.adInfo.advertiserInfo.portraitUrl),me(t)||(t="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),t}catch(t){}return"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}getProductName(){let t="";try{if(K.isOriginLiveAd(this.adInfo)){let e=K.obtainVideoLiveData(this.adInfo);t=K.liveGetAuthorName(e,this.adInfo)}else t=this.adInfo.adProductInfo.name}catch(e){}return t}getDescription(){let t="";try{if(K.isOriginLiveAd(this.adInfo)){let e=K.obtainVideoLiveData(this.adInfo);t=K.liveGetLiveDesc(e,this.adInfo)}else t=this.adInfo.adBaseInfo.adDescription}catch(e){}return t}getAppName(){let t="";try{t=this.adInfo.adBaseInfo.appName}catch(e){}return t}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}isEcFollow(){return ut(this.adInfo)}isLiveSubscribe(){return wt(this.adInfo)}isJinniu(){return tt(this.adInfo)}handleAbandon(){}handleContinue(){}handleClose(){}handleGiftCallAction(t){}handleConvert(t,e,i){}getNeoConformTips(){var t;if(Ft(this.adInfo))try{return null!==(t=function(t){let e=nt(t,12);if(null!=e)return JSON.parse(e.data)}(this.adInfo).confirmTipsDes)&&void 0!==t?t:"为你推荐更多精彩内容"}catch(e){console.log("TK endCardInfo confirmTipsDes error")}try{return this.adInfo.adMatrixInfo.adDataV2.confirmTKInfo.tipsDes}catch(e){console.log("TK endCardInfo getNeoConformTips error")}return"为你推荐更多精彩内容"}getNeoConformActionDes(){return ft(this.adInfo)}getNeoConfirmCardType(){try{return this.adInfo.adMatrixInfo.adDataV2.confirmTKInfo.cardType}catch(t){console.log("TK endCardInfo getNeoConfirmCardType error")}return 1}getRetainCodeType(){switch(Z(this.adInfo)){case 9:return I.RETAIN_CARD_TYPE_7;case 10:return I.RETAIN_CARD_TYPE_5;case 5:return I.RETAIN_CARD_TYPE_8;case 6:return I.RETAIN_CARD_TYPE_9;case 7:return I.RETAIN_CARD_TYPE_10;case 8:return I.RETAIN_CARD_TYPE_11;default:return}}neoGiftPopupExposure(t=!1){if(this.isMoreShow)return;let e;switch(this.isMoreShow=!0,Z(this.adInfo)){case 9:case 10:case 5:case 6:case 7:case 8:if(e={elementType:149,retain_code_type:this.getRetainCodeType()},10==Z(this.adInfo)){let t=new b;t.universe_feature_freq=6,e.clientExtData=JSON.stringify(t)}else if(9!=Z(this.adInfo)){let t=new b;t.universe_feature_freq=10,e.clientExtData=JSON.stringify(t)}let t={actionType:140,payload:JSON.stringify(e)};ke.sendLog(t);break;default:this.confirmExposure()}}confirmExposure(){let t={};t=3==this.sceneType?{elementType:149,businessSceneType:33}:{elementType:149},ei.log(140,{x:0,y:0},t)}}class mo extends po{constructor(t,e,i,n,s,a){super(),this.isShow=!1,this.isPlayAgain=!1,this.hasClickBefore=!1,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a}isShowConfirm(){if(!Le.supportMinimumTKVersion("4.0.9"))return!1;if(this.hasClickBefore)return!1;const t=this.adInfo.adMatrixInfo.adDataV2.adExitIntentPopUpInfo;return!(!t||t.style==y.unknown)}getTemplateInfo(){try{const t=vt(this.getTemplateId(),this.adInfo);return JSON.stringify(t)}catch(t){}return""}getTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.adExitIntentPopUpInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}}class go extends ji{constructor(){super(...arguments),this.currentPlaybackTime=0,this.playFailed=!1,this.playFinished=!1,this.autocallHasConverted=!1}checkDataValid(){return!!this.callerContext.adInfo}getRewardTime(){return dt(this.callerContext.adInfo)}getLightInteractionType(){try{const t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionType;if(!Ce(t))return t}catch(t){}return 0}getLightInteractionShowTime(){let t=2;try{t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionShowTime}catch(e){}return t||2}getLightInteractionDuration(){let t=6;try{t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailCommonInfo.rewardInteractionDuration}catch(e){}return t||6}getAdAttributeType(){try{return this.callerContext.adInfo.adBaseInfo.adAttributeType}catch(t){}return 0}getActionBarStyle(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType}catch(t){}return 0}getMiddleCardType(){var t,e,i,n,s,a;try{if(2==this.callerContext.adStyle){let n=null===(i=null===(e=null===(t=this.callerContext.adInfo.adMatrixInfo)||void 0===t?void 0:t.adDataV2)||void 0===e?void 0:e.neoTKInfo)||void 0===i?void 0:i.middleCardType;if(!Ce(n))return n}else if(3==this.callerContext.adStyle){let t=null===(a=null===(s=null===(n=this.callerContext.adInfo.adMatrixInfo)||void 0===n?void 0:n.adDataV2)||void 0===s?void 0:s.fullScreenInfo)||void 0===a?void 0:a.middleCardType;if(!Ce(t))return t}}catch(o){}return null}isClickReward(){return Ct(this.callerContext.adInfo)}isDownloadComplaince(){let t=1==this.callerContext.screenOrientation;return!(!ht(this.callerContext.adInfo)||!t)}isValidCardInfo(){return null!=at(this.callerContext.adInfo,1)}isValidPlayable(){if(!me(this.callerContext.adInfo.adConversionInfo.playableUrl))return!1;let t=this.callerContext.adInfo.adConversionInfo.playableStyleInfo.playableOrientation;return!(0==this.callerContext.screenOrientation&&2==t||1==this.callerContext.screenOrientation&&1==t)}isBrowseTask(){return 1!=this.callerContext.adInfo.adBaseInfo.taskType&&0!=this.callerContext.adInfo.adBaseInfo.taskType}getLiveCutRoomInfo(){return Ht(this.callerContext.adStyle,this.callerContext.adInfo)}isValideTime(){return!(dt(this.callerContext.adInfo)<=lt(at(this.callerContext.adInfo,1)))}isValidSDKVersion(){return!!Le.supportMinimumTKVersion("3.0.2")}shouldShowAutoCallAppCard(t=void 0){if(!this.isValidSDKVersion())return!1;if(2!=this.callerContext.adStyle)return!1;if(this.isDownloadComplaince())return!1;if(this.isValidCardInfo())if(this.isValidPlayable())t&&t(!1);else{if(!this.isBrowseTask())return!!this.isValideTime()&&void(t&&t(!0));t&&t(!1)}else t&&t(!1)}isSlideClick(){var t;return!!(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}convert(t,e,i,n){}isFansLive(){try{let t=this.callerContext.configInfo.abConfig.shortVideoFollowRewardPlayStyle;if(Le.supportMinimumVersion("3.3.26","3.3.30")&&4==t&&ut(this.callerContext.adInfo))return!0}catch(t){}return!1}}class uo extends go{constructor(t){super(),this.callerContext=t,this.couponWidgetVM=new Ya(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.configInfo,1,this.callerContext.containerLimit,this.callerContext.screenOrientation)}convert(t,e,i,n){n||(n=new b),n.material_click_area="fullscreen_mid",ei.convertIfNeeded(3,this.callerContext.adInfo,t,e,i,n)}}class wo extends ji{constructor(t,e,i,n,s,a){super(),this.lifeStatus="none",this.extraGivenStatus=0,this.playableSourceType=0,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a}}!function(t){t[t.NONE=0]="NONE",t[t.BRIDGE_HANDLER=1]="BRIDGE_HANDLER",t[t.SENSOR_COMPONENT=2]="SENSOR_COMPONENT"}(co||(co={}));class Co{static checkShakeRegisterType(t,e){let i=co.NONE;return t==ho.FULLSCREEN?i=Le.supportMinimumTKVersion("5.0.9")?co.SENSOR_COMPONENT:co.BRIDGE_HANDLER:t==ho.NEO||t==ho.LIVE_NEO||t==ho.IMAGE_NEO?i=co.SENSOR_COMPONENT:t!=ho.LIVE_FULLSCREEN&&t!=ho.IMAGE_FULLSCREEN||(i=e?Le.supportMinimumTKVersion("5.0.0")?co.SENSOR_COMPONENT:co.NONE:Le.supportMinimumTKVersion("4.0.9")?co.SENSOR_COMPONENT:co.NONE),i}static registerBridgeShake(t){try{ke.registerShakeListener(t)}catch(e){}}static supportSensor(t){let e=!1;try{e=KSAdSensorManager.supportSensor(t)}catch(i){}return e}static registerSensorListener(t,e,i){try{KSAdSensorManager.registerSensorListener(t,e,i)}catch(n){}}static unregisterSensorListener(t){try{KSAdSensorManager.unregisterSensorListener(t)}catch(e){}}}const fo="neo_rotate_style1",yo="neo_rotate_style2",To="neo_rotate_style3",Io="neo_rotate_style4",vo="neo_rotate_style5";class Ao extends ji{constructor(t,e,i){super(),this.isRotateInitialized=!1,this.isShakeInitialized=!1,this.isStartSensor=!0,this.isListeningRotate=!1,this.canRotateConvert=!0,this.downloadState=0,this.downloadProgressTest="下载中",this.isListeningSeneor=!1,this.mVideoTKScene=ho.NEO,this.slotId=-1,this.componentData=void 0,this.mVideoTKScene=e,this.callerContext=t,i&&(this.slotId=i),this.initializeRotateHandler(),this.enableShakeConvert()&&this.initializeShakeHandler()}enableShowRotate(){if(!this.isRotateInitialized||!Le.supportMinimumTKVersion("5.0.0"))return!1;try{if(1==this.interactionInfo.interactiveStyle)return!0}catch(t){}return!1}initializeRotateHandler(){if(!this.isRotateInitialized)try{if(F(this.callerContext.adInfo)){let t;t=k(this.callerContext.adInfo,"reward-rotate",this.slotId),t&&(this.interactionInfo=R(t),this.componentData=t),null==t&&(t=k(this.callerContext.adInfo,"reward-end-shake",this.slotId),this.interactionInfo=R(t),this.componentData=t)}else 2==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.neoVideoInfo.interactionInfo),3==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo);this.interactionInfo&&(this.uiStyle=this.interactionInfo.rotateInfo.uiStyle,this.rotateHandler=new Sa(this.interactionInfo.rotateInfo),this.isRotateInitialized=!0)}catch(t){}}startRotateListener(){if(!this.isListeningRotate)if(this.isListeningRotate=!0,this.isListeningSeneor=!0,this.rotateHandler.beforeMonitor(),"undefined"!=typeof KSAdSensorManager&&KSAdSensorManager.supportSensor(2))Co.registerSensorListener(2,-3,(t=>{this.canSplashConvertRotate(t)}));else{if(this.rotateHandler.bidirectionalSwitch)return;let e=this.interactionInfo.rotateInfo;(null==e?void 0:e.useImitateRotate)&&(this.sensorImitateRotateUtil=new Fa(e),this.sensorImitateRotateUtil.registerImitateRotateSensorListener((e=>{try{if(!Ce(e)&&this.isListeningSeneor&&this.canRotateConvert&&2!=this.downloadState){this.canRotateConvert=!1;let i={splashInteractionRotateAngle:e},n=new b;if(this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:n.template_show_type=To;break;case 2:n.template_show_type=Io}else if(2===this.uiStyle)n.template_show_type=yo;else n.template_show_type=fo;n.reward_interactive_style_type=this.getInteractiveStyleType(),ei.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,n,i),KSAdSystemUtil.startVibrate(100),this.stopRotateListener(),this.stopShakeListener()}}catch(i){}}),(t=>{this.rotateInfoCallback&&t&&t.length>2&&this.rotateInfoCallback(t[0],t[1],t[2])})))}}stopRotateListener(){this.isListeningRotate&&(this.isListeningRotate=!1,this.isListeningSeneor=!1,this.isShowConvertState=!1,this.sensorImitateRotateUtil?this.sensorImitateRotateUtil.unRegisterImitateRotateSensorListener():Co.unregisterSensorListener(2))}canSplashConvertRotate(e){try{if(this.rotateInfoCallback&&this.rotateInfoCallback(this.rotateHandler.xDegree,this.rotateHandler.yDegree,this.rotateHandler.zDegree),this.isListeningSeneor&&!Ce(e)&&!Ce(e.values)&&this.rotateHandler&&this.canRotateConvert&&this.rotateHandler.canConvertRotate(e)&&2!=this.downloadState){this.canRotateConvert=!1;let e={splashInteractionRotateAngle:this.rotateHandler.maxRotateContent()},i=new b;if(this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:i.template_show_type=To;break;case 2:i.template_show_type=Io}else if(2===this.uiStyle)i.template_show_type=yo;else i.template_show_type=fo;i.reward_interactive_style_type=this.getInteractiveStyleType(),F(this.callerContext.adInfo)&&this.componentData&&(i.component_module=B(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),ei.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,i,e),KSAdSystemUtil.startVibrate(100),this.stopRotateListener(),this.stopShakeListener()}}catch(i){}}isSlideClick(){var t;return!!(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}convert(t,e,i,n){if(Ce(n)&&(n=new b),this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:n.template_show_type=To;break;case 2:n.template_show_type=Io;break;case 0:n.template_show_type=vo}else if(2===this.uiStyle)n.template_show_type=yo;else n.template_show_type=fo;F(this.callerContext.adInfo)&&this.componentData&&(n.component_module=B(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),n.reward_interactive_style_type=this.getInteractiveStyleType(),ei.convertIfNeeded(0,this.callerContext.adInfo,t,e,i,n)}elementImpression(){let t=184,e=yo,i=new b;if(this.isShowRotateAndShakeView())switch(t=227,this.rotateShakeUiStyle){case 1:e=To;break;case 2:e=Io;break;case 0:e=vo}else if(2===this.uiStyle)e=yo;else e=fo;let n={elementType:t};F(this.callerContext.adInfo)&&this.componentData&&(i.universe_feature_freq=this.componentData.componentId,i.component_module=B(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),i.template_show_type=e,i.reward_interactive_style_type=this.getInteractiveStyleType(),n.clientExtData=JSON.stringify(i),ei.log(140,{x:0,y:0},n)}getRotateSubtitle(){var t;let e="";try{if(console.log("tkloadcontroller isdownload:"+Y(this.callerContext.adInfo)),Y(this.callerContext.adInfo)){let i=null===(t=this.interactionInfo.rotateInfo)||void 0===t?void 0:t.downloadTexts;switch(this.isShowRotateAndShakeView()&&(i=this.interactionInfo.componentInfo.downloadTexts),this.downloadState){case 6:e=i.openAppLabel;break;case 5:e=i.installAppLabel;break;default:e=i.adActionDescription}}else e=this.isShowRotateAndShakeView()?this.interactionInfo.componentInfo.subTitle:this.interactionInfo.rotateInfo.subTitle}catch(i){}return me(e)?"或点击"+e:"或点击立即获取"}initializeShakeHandler(){this.isShakeInitialized||(this.shakeHandler=new _a(this.interactionInfo),this.isShakeInitialized=!0)}startShakeListener(){this.isListeningShake||(this.isListeningShake=!0,this.isListeningSeneor=!0,this.shakeHandler.beforeMonitor(),Co.registerSensorListener(1,-3,(t=>{this.canConvertShake(t)&&(this.convertShake(),this.canRotateConvert=!1,KSAdSystemUtil.startVibrate(200),this.stopShakeListener(),this.stopRotateListener())})))}enableShakeConvert(){try{let t=this.interactionInfo.shakeInfo;return!Ce(t)&&t.enable}catch(t){}return!1}enableRotateConvert(){if(!Le.supportMinimumTKVersion("5.0.0"))return!1;try{let t=this.interactionInfo.rotateInfo;return!Ce(t)&&t.enable}catch(t){}return!1}startSensorListener(){this.enableShakeConvert()&&(Le.supportMinimumTKVersion("5.0.0")?this.startShakeListener():Co.checkShakeRegisterType(this.mVideoTKScene,!0)==co.BRIDGE_HANDLER&&Co.registerBridgeShake((t=>{}))),this.enableRotateConvert()&&this.startRotateListener()}stopSensorListener(){this.enableShakeConvert()&&this.stopShakeListener(),this.enableRotateConvert()&&this.stopRotateListener()}stopShakeListener(){this.isListeningShake&&(this.isListeningShake=!1,this.isListeningSeneor=!1,this.isShowConvertState=!1,Co.unregisterSensorListener(1),this.shakeHandler.resetValues())}canConvertShake(t){try{if(this.canRotateConvert&&this.isListeningSeneor&&this.shakeHandler&&this.shakeHandler.canConvertShake(t)&&2!=this.downloadState)return!0}catch(e){}return!1}convertShake(){let e=new b;if(this.isShowRotateAndShakeView())switch(this.rotateShakeUiStyle){case 1:e.template_show_type=To;break;case 2:e.template_show_type=Io;break;case 0:e.template_show_type=vo}e.reward_interactive_style_type=this.getInteractiveStyleType(),F(this.callerContext.adInfo)&&this.componentData&&(e.component_module=B(this.callerContext.adInfo,this.componentData,"reward-end-shake"!=this.componentData.componentName)),ei.convertIfNeeded(0,this.callerContext.adInfo,1,{x:0,y:0},t.SHAKE_ICON_SHACK,e,{splash_shake_acceleration:this.shakeHandler.maxAcceleration})}getBtnPosition(){var t;try{if(this.interactionInfo)return null===(t=this.interactionInfo)||void 0===t?void 0:t.componentInfo.btnPosition}catch(e){return 0}}getBtnStyle(){var t;try{if(this.interactionInfo)return null===(t=this.interactionInfo)||void 0===t?void 0:t.componentInfo.btnStyle}catch(e){return 0}}isShowRotateAndShakeView(){if(!this.isRotateInitialized||!Le.supportMinimumTKVersion("5.0.0"))return!1;try{if(!F(this.callerContext.adInfo))return Gt(this.callerContext.adInfo,this.callerContext.adStyle);if(7==this.interactionInfo.interactiveStyle)return!0}catch(t){}return!1}getInteractiveStyleType(){try{return this.callerContext.configInfo.abConfig.rewardInteractiveStyleType}catch(t){return 0}}isOriginRotateStyle(){return!this.isShowRotateAndShakeView()&&2!=this.uiStyle}clickLog(e,i){this.isShowRotateAndShakeView()?this.convert(1,pe(e,i),t.ROTATE_SHAKE_BIG_ICON_CLICK):this.convert(1,pe(e,i),t.ROTATE_BIG_ICON_CLICK)}}class Vo extends ji{constructor(t,e,i,n,s,a){super(),this.isShow=!1,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a}getTemplateInfo(){try{const t=vt(this.getTemplateId(),this.adInfo);return JSON.stringify(t)}catch(t){}return""}getTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.rewardWebTaskCloseInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}}class bo extends ji{constructor(){super(...arguments),this.isNeedCheck=!1,this.topbarModelType=0,this.needShowPlayEndCloseBtn=0,this.hasCallbackGift=!1,this.isMuted=!1,this.playFailed=!1,this.playFinished=!1,this.currentPlaybackTime=0,this.hasGetDeepGift=!1,this.hasInstallTargetApp=!1,this.hasShowPlayend=!1,this.giveRewardTime=0,this.impressionCheckResult=!0,this.isNeedSeverCheck=!1,this.severCheckState=0}checkDataValid(){return!!this.adInfo}getVideoDuration(){return j(this.adInfo)}isDownloadAd(){return 1==this.adInfo.adBaseInfo.adOperationType}isShowPrivacy(){return ht(this.adInfo)}isDeepRewardTask(){return 2==this.adInfo.adBaseInfo.taskType||3==this.adInfo.adBaseInfo.taskType}isCloseBtnHide(){try{let t=this.adInfo.adMatrixInfo.tag;if(t)for(let e=0;e<t.length;e++){let i=t[e];if("playEndClose"==i.type&&i.isHide)return!0}}catch(t){}return!1}isRewardVideo(){return 2==this.adStyle||12==this.adStyle}isSkipToCloseAd(){try{return this.isRewardVideo()?this.adInfo.adRewardInfo.rewardVideoEndCardSwitch:this.adInfo.fullScreenVideoInfo.fullScreenEndCardSwitch}catch(t){return!1}}getRewardTime(){return dt(this.adInfo)}isShowSkipRightNow(){return this.isRewardVideo()?Math.min(this.getSkipShowTime(),this.getRewardTime())<=0:this.getSkipShowTime()<=0}getSkipConfirmSwitch(){let t=!0;try{t=null==this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch||this.adInfo.adStyleConfInfo.rewardSkipConfirmSwitch}catch(e){}return t}getSkipShowTime(){let t=null;try{if(this.isRewardVideo())try{t=this.adInfo.adRewardInfo.skipShowTime,t<0&&(t=this.getVideoDuration())}catch(e){t=this.configInfo.appConfig.rewardSkipShowTime}else t=this.adInfo.adStyleConfInfo.fullScreenSkipShowTime}catch(e){}return null!=t&&null!=t||(t=5),Math.min(this.getVideoDuration(),t)}getSkipTips(){let t=null;try{t=this.isRewardVideo()?this.configInfo.appConfig.rewardSkipTips:this.configInfo.appConfig.fullscreenSkipTips}catch(e){}return t&&0!=t.length?t:null}getSkipType(){let t=0;try{t=this.isRewardVideo()?this.configInfo.appConfig.rewardSkipType:this.configInfo.appConfig.fullscreenSkipType}catch(e){3==this.adStyle&&(t=1)}return t}getPlayDetailCallDescription(){let t=null;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailTopToolBarInfo.callButtonDescription}catch(e){}return me(t)||(t="立即获取"),t}getPlayEndCallDescription(){let t=null;try{this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription.length>0&&(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription)}catch(e){console.log("no adMatrixInfo.adDataV2.dynamicAdStyleInfo.playEndInfo.endTopToolBarInfo.callButtonDescription returned")}return t}getPlayDetailCallBtnShowTime(){let t=0;try{t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.playDetailInfo.detailTopToolBarInfo.callButtonShowTime}catch(e){console.log("no adMatrixInfo.adDataV2.dynamicAdStyleInfo.playDetailInfo.detailTopToolBarInfo.callButtonShowTime returned")}return t}getCloseDelaySeconds(){let t=0;try{t=this.adInfo.adStyleConfInfo.closeDelaySeconds}catch(e){}return t}isDelayShowEndClose(){return this.getCloseDelaySeconds()>0}getTopbarStyle(){if(3!=this.adStyle&&1!=this.adInfo.adBaseInfo.taskType&&4!=this.adInfo.adBaseInfo.taskType&&0!=this.adInfo.adBaseInfo.taskType)return 1;let t=-1;try{t=this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailTopToolBarInfo.style}catch(e){}return!Le.supportMinimumVersion("3.3.22","3.3.29")&&t>9?0:t}getResourceRoot(){return"image/ksad-video-top-bar/"}handleOpenURL(t,e){ke.openURL(t,e)}handleOpenFeedback(){if(this.hasShowFeedback)return void Re("您已经提交过反馈了哦~");this.hasShowFeedback=!0,ke.showTKDialog("ksad-feed-back-card");let t={actionType:141,payload:JSON.stringify({elementType:194,buttonType:4})};ke.sendLog(t)}handleCallImpressionOnFinish(){}handleCallImpressionOnPlay(){}handleCallClick(t,e){}handleGiftClick(t){}convertForOtherArea(t,e,i,n){}handleSkip(t,e,i){}handleClose(){ke.closeVideo(!1)}handleMuteChange(t){}handleHasGift(){this.hasCallbackGift||(this.hasCallbackGift=!0,ke.hasReward(this.severCheckState))}handlePlayEnd(t){ke.showPlayEnd(t),this.hasShowPlayend=!0}getTaskType(){var t;return null===(t=this.rewardTaskInfo)||void 0===t?void 0:t.taskType}isCovertTask(){return 1==this.getTaskType()}isSlideClick(){var t;return!!(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}getRealAdStyle(){let t=Tachikoma.env.adStyle;return t||(t=this.adStyle),t}}class So extends bo{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.isNeedCheck=!0,this.additionalInit()}additionalInit(){Le.supportMinimumTKVersion("4.0.4")||(this.needShowPlayEndCloseBtn=1)}handleClose(){this.handleCloseCallback&&this.handleCloseCallback()}handleSkip(t,e,i){let n=new V;n.closeButtonImpressionTime=i,n.closeButtonClickTime=this.currentPlaybackTime,n.clientTimestamp=oe();let s={elementType:69,extParams:JSON.stringify(n)},a={actionType:141,payload:JSON.stringify(s)};ke.sendLog(a),this.handleSkipCallback&&this.handleSkipCallback(t,e,i)}handleGiftClick(e){ei.convertIfNeeded(0,this.adInfo,2,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK)}handleCallClick(e,i){ei.convertIfNeeded(0,this.adInfo,1,{x:i.position.rawX,y:i.position.rawY},e?t.PLAY_END_CALL_CLICK:t.PLAY_DETAIL_CALL_CLICK)}handleCallImpressionOnFinish(){ei.exposeElement(17)}handleCallImpressionOnPlay(){ei.exposeElement(18)}handlePlayEnd(t){this.hasShowPlayend=!0}handleMuteChange(t){this.isMuted=t}obtainNeoInteractTime(){this.giveRewardTime=Vt(this.adInfo)}convertForOtherArea(t,e,i,n){let s=new b;s.material_click_area="neo_top",ei.convertIfNeeded(1,this.adInfo,e,i,n,s)}}class xo extends ji{constructor(t,e,i,n,s,a,o){super(),this.hasNeo=!1,this.pageLoaded=!1,this.pageLoadedFailed=!1,this.isSlideUp=!1,this.lifeStatus="none",this.slotId=-1,this.componentData=void 0,this.configInfo=n,this.containerLimit=s,this.adInfo=t,this.adOriginInfo=e,this.adStyle=i,this.configInfo=n,this.containerLimit=s,this.screenOrientation=a,o&&(this.slotId=o);const r={width:this.containerLimit.width-2*this.getSideMargin(),height:this.containerLimit.height-this.getTopMargin()};if(F(this.adInfo)&&-1!=this.slotId){let t=k(this.adInfo,"pre-landing-page-card",this.slotId);t&&(this.componentData=t)}this.topBarVM=new So(this.adInfo,this.adStyle,this.configInfo,r,this.screenOrientation),this.confirmVM=new Vo(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,r,this.screenOrientation)}reportPreFormImpression(){let t=new b;if(F(this.adInfo)&&this.componentData){const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.endCardInfo.pageId,combination_id:e.endCardInfo.combinationIds,component_id:this.componentData.componentId};t.universe_feature_freq=this.componentData.componentId,t.component_module=JSON.stringify(i),ze("component_ui_show","end_card",String(e.endCardInfo.pageId),"pre-landing-page-card")}else t.universe_feature_freq=5;let e={elementType:204,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}getSideMargin(){return he()&&1==this.screenOrientation?48:0}getTopMargin(){return 0==this.screenOrientation&&he()?48:20}getPlayEndBgUrl(){return G(W(this.adInfo))}getLandingPageUrl(t){try{ke.getLandingPageInfo((e=>{let i=e.data;const n=i?i.landingPageUrl:void 0;me(n)?t(n):t(this.adInfo.adConversionInfo.h5Url)}))}catch(e){t(this.adInfo.adConversionInfo.h5Url)}}getTopBarTitle(){return X(this.adInfo)}getPlayEndTemplateId(){try{return this.adInfo.adMatrixInfo.adDataV2.endCardInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}isAppAdvance(){return function(t){var e,i;try{return(null===(i=null===(e=t.adConversionInfo)||void 0===e?void 0:e.deeplinkUrl)||void 0===i?void 0:i.length)>0}catch(n){}return!1}(this.adInfo)}handleAdClick(t,e){if(this.isAppAdvance()){let i=new b;if(F(this.adInfo)&&this.componentData){const t=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let e={page_id:t.endCardInfo.pageId,combination_id:t.endCardInfo.combinationIds,component_id:this.componentData.componentId};i.component_module=JSON.stringify(e),ze("component_ui_click","end_card",String(t.endCardInfo.pageId),"pre-landing-page-card")}let n=0,s=0;Ce(e)||(n=e.position.rawX,s=e.position.rawY),ei.convertIfNeeded(2,this.adInfo,2,{x:n,y:s},t,i)}else if(!this.isSlideUp){if(this.isSlideUp=!0,F(this.adInfo)&&this.componentData){let e=new b;const i=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let n={page_id:i.endCardInfo.pageId,combination_id:i.endCardInfo.combinationIds,component_id:this.componentData.componentId};e.component_module=JSON.stringify(n),ei.reportClick(this.adInfo,null,{itemClickType:t,renderContainer:1},e),ze("component_ui_click","end_card",String(i.endCardInfo.pageId),"pre-landing-page-card")}else ei.reportClick(this.adInfo,null,{itemClickType:t,renderContainer:1});let e={creativeId:this.adInfo.adBaseInfo.creativeId+"",targetMethod:"adClickCallback",methodParams:"{}"};ke.adOutCallback(e)}}needShowConfimDialog(){var t,e;return 1==(null===(e=null===(t=this.configInfo)||void 0===t?void 0:t.appConfig)||void 0===e?void 0:e.adLeaveConfirmSwitch)}}class _o extends ji{constructor(t,e,i){super(),this.downloadState=0,this.focusChangeEvent="windowFocusGet",this.lifeStatus="none",this.canShowAggregation=!1,this.callerContext=t,this.adOriginInfo=e,this.webViewVM=new wo(this.callerContext.adInfo,this.adOriginInfo,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit,this.callerContext.screenOrientation),this.rotateVM=new Ao(this.callerContext,i,10),this.aggregationCardVM=new pa(this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit,this.callerContext.screenOrientation),this.preFormViewModel=new xo(this.callerContext.adInfo,this.adOriginInfo,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit,this.callerContext.screenOrientation,9)}convert(t,e,i){ei.convertIfNeeded(2,this.callerContext.adInfo,t,e,i)}closeAd(){ke.close()}playAgainClick(){Oe().emit(l,{})}getAppScore(){return this.callerContext.adInfo.adBaseInfo.appScore||0}getAppDownloadCountDesc(){return this.callerContext.adInfo.adBaseInfo.appDownloadCountDesc||null}getVideoFirstFrame(){return G(W(this.callerContext.adInfo))}getAdDescription(){return this.callerContext.adInfo.adBaseInfo.appDescription||this.callerContext.adInfo.adBaseInfo.adDescription||null}getAdActionDesc(){return this.callerContext.adInfo.adBaseInfo.adActionDescription||""}supportSlideClick(){var t;return(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}getWebCardEndH5Url(){return It(this.getTemplateId(),this.callerContext.adInfo)}getTemplateId(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.endCardInfo.templateId}catch(t){console.log("TK endCardInfo templateId error")}return""}getPlayAgainEndH5Url(){return It(this.getPlayAgainTemplateId(),this.callerContext.adInfo)}getPlayAgainTemplateId(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.rewardWatchOnceInfo.templateId}catch(t){console.log("TK rewardWatchOnceInfo templateId error")}return""}isShowRotatrAndShakeView(){try{if(!F(this.callerContext.adInfo))return Gt(this.callerContext.adInfo,this.callerContext.adStyle);if(7==this.rotateVM.interactionInfo.interactiveStyle)return!0}catch(t){}return!1}canShowPreLandingPage(){if(2!=this.callerContext.adStyle)return!1;try{if(F(this.callerContext.adInfo)){if(k(this.callerContext.adInfo,"pre-landing-page-card",9))return!0}}catch(t){}return!1}}class Lo extends ji{constructor(t,e,i){super(),this.lastReportTime=0,this.lifeStatus="none",this.currentPlaybackTime=0,this.playStatus=0,this.playFailed=!1,this.playFinished=!1,this.playStarted=!1,this.isMuted=!1,this.showingDialog=new Set,this.hadDowngrade=!1,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.videoPlayReportSeconds=function(t){let e=[];if(t.adBaseInfo.videoPlayedNS){let n=t.adBaseInfo.videoPlayedNS.split(",");if(n.length>0)for(var i=0;i<n.length;i++){let t=Number(n[i]);e.push(t)}else e=[3]}return e.sort(),e}(this.adInfo)}onDialogShow(t){Ce(t)||this.showingDialog.add(t)}onDialogDismiss(t){Ce(t)||this.showingDialog.has(t)&&this.showingDialog.delete(t)}isDialogShowing(){return this.showingDialog.size>0}onDowngrade(){this.hadDowngrade=!0,qt(this.obtainRealRenderResult())}getVideoURL(){return z(this.adInfo)}getVideoSize(){return U(this.adInfo)}getVideoDuration(){return j(this.adInfo)}getVideoFirstFrame(){return G(this.adInfo.adMaterialInfo.materialFeature[0])}isSlideEnable(){var t,e;return!!(null===(e=null===(t=this.adInfo)||void 0===t?void 0:t.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===e?void 0:e.slideClick)}getActionBarStyle(){try{return this.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo.detailWebCardInfo.cardType}catch(t){}return 0}updateVideoProgress(t,e,i){this.currentPlaybackTime=t;const n=Math.floor(t);if(n!=this.lastReportTime)for(var s=0;s<this.videoPlayReportSeconds.length;s++)if(n==this.videoPlayReportSeconds[s]){this.lastReportTime=this.videoPlayReportSeconds[s];let t=this.obtainClientExtData(null);ei.playNSecond(this.lastReportTime,t);break}}videoPlayFailed(t,e){this.playFailed=!0,ei.updateVideoPlayStatus("failed",t,e)}videoPlayFinished(){this.playFinished||(this.playFinished=!0,Ot(this.adInfo,this.configInfo)&&Be(),ei.log(400,null,null),ei.updateVideoPlayStatus("end"))}videoPlayStart(){if(this.playStarted)return;this.playStarted=!0;let t=this.obtainClientExtData(null);ei.playStart(t),ei.updateVideoPlayStatus("start")}convert(t,e,i,n){ei.convertIfNeeded(0,this.adInfo,t,e,i,n)}obtainClientExtData(t){let e=t;return null==e&&(e=new b),Qe.appendNeoExtData(e,this.adInfo,this.configInfo.abConfig,(t=>{t.realRenderResult=this.obtainRealRenderResult()})),e}obtainRealRenderResult(){return this.hadDowngrade?ua.IMAGE:ua.VIDEO}}class Do extends Object{constructor(t){super(),this.totalBlockDuration=0,this.totalBlockTimes=0,this.maxAllowedBlockDuration=5e3,this.schedulingTimeout=!1,this.currentStatus=0,this.blockCallback=t}updatePlayerStatus(t){this.currentStatus=t,2==t||6==t||3==t||1==t?this.startScheduleTimeout():this.cancelScheduleTimeout()}updateCurrentPlaybackTime(t){(2==this.currentStatus||6==this.currentStatus||3==this.currentStatus||1==this.currentStatus)&&(this.cancelScheduleTimeout(),this.startScheduleTimeout())}startScheduleTimeout(){this.schedulingTimeout||(this.schedulingTimeout=!0,this.blockTimer=setTimeout((()=>{this.handleBlockTimeout()}),this.maxAllowedBlockDuration),this.lastBlockTime=oe())}cancelScheduleTimeout(){if(this.schedulingTimeout&&(this.schedulingTimeout=!1,this.clearBlockTimer(),this.lastBlockTime)){const t=oe()-this.lastBlockTime;t>1e3&&(this.totalBlockDuration+=t,this.totalBlockTimes+=1)}}clearBlockTimer(){this.blockTimer&&clearTimeout(this.blockTimer)}handleBlockTimeout(){this.blockCallback&&this.blockCallback()}}class Fo extends ji{constructor(t,e,i,n,s){super(),this.topNavHeight=58,this.lifeStatus="none",this.pushCardIsShow=!1,this.isPaused=!1,this.isShowEnd=!1,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.pushCardInfo=this.getPushCardInfo(),this.setupTimerPlayer()}setupTimerPlayer(){this.timerPlayer=new ns(this.pushCardStayDuration()),this.timerPlayer.onFinishCallback=()=>{this.isShowEnd=!0}}timerPaused(){this.timerPlayer.paused()}timerResume(){this.timerPlayer.resume()}timerPlay(){this.timerPlayer.play()}getTopMargin(){let t=0;return t=0==this.screenOrientation?he()?48+this.topNavHeight:20+this.topNavHeight:36,t}getAdIcon(){return M(this.adInfo)}getAdTitle(){return X(this.adInfo)}getAdDescription(){return this.adInfo.adBaseInfo.appDescription||this.adInfo.adBaseInfo.adDescription||null}getAdActionDesc(){return ft(this.adInfo)}getPushCardInfo(){return function(t,e){let i=nt(t,3==e?3:12),n=null;try{n=JSON.parse(i.data).pushCardInfo}catch(s){}return n}(this.adInfo,this.adStyle)}canPushCard(){return!this.pushCardIsShow&&!Ce(this.pushCardInfo)}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}pushCardDelayTime(){let t=3e3;!Ce(this.pushCardInfo)&&this.pushCardInfo.delayTime>0&&(t=this.pushCardInfo.delayTime);const e=bt(this.adInfo,this.adStyle);return Ce(e)||(t+=1e3*e.delayTime+(F(this.adInfo)?e.showTime:1e3*e.showTime)),t}pushCardStayDuration(){let t=1e4;return!Ce(this.pushCardInfo)&&this.pushCardInfo.showDuration>0&&(t=this.pushCardInfo.showDuration),t}convert(t,e,i,n){ei.convertIfNeeded(1,this.adInfo,t,e,i,n)}reportPlayEndImpression(){let t=new b;t.template_show_type="push_card",t.universe_feature_freq=18;let e={elementType:191,clientExtData:JSON.stringify(t)};ei.log(140,null,e)}}class ko extends bo{constructor(t,e,i,n,s){super(),this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s}handleClose(){this.handleCloseCallback&&this.handleCloseCallback()}handleSkip(t,e,i){this.handleSkipCallback?this.handleSkipCallback(t,e,i):ke.skipVideo(t,e,i)}handleGiftClick(e){ei.convertIfNeeded(1,this.adInfo,2,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK)}handleCallClick(e,i){ei.convertIfNeeded(1,this.adInfo,1,{x:i.position.rawX,y:i.position.rawY},e?t.PLAY_END_CALL_CLICK:t.PLAY_DETAIL_CALL_CLICK)}handleCallImpressionOnFinish(){ei.exposeElement(17)}handleCallImpressionOnPlay(){ei.exposeElement(18)}handlePlayEnd(t){Le.supportMinimumTKVersion("5.0.8")||ke.showPlayEnd(t,1),this.hasShowPlayend=!0,this.needShowPlayEndCloseBtn=1}handleMuteChange(t){this.isMuted=t}convertForOtherArea(t,e,i,n){let s=new b;s.material_click_area="fullscreen_top",ei.convertIfNeeded(1,this.adInfo,e,i,n,s)}}class Ro extends ji{constructor(t,e,i,n=1,s){if(super(),this.paramValid=!1,this.animMinTime=50,this.dismissCallbackCompleted=!1,this.lastAnimedArray=[],this.slotId=-1,this.componentData=void 0,this.containerSize=t,this.adInfo=e,this.adStyle=i,this.animType=n,this.currentRandomParams=this.getRedPacketRandomParam(),this.initLastAnimedArray(),s&&(this.slotId=s),2==n)this.redPacketInfo=Rt(this.adInfo,this.adStyle);else if(F(this.adInfo)){let t=k(this.adInfo,"red-packet",this.slotId);t&&(this.redPacketInfo=R(t),this.componentData=t)}else this.redPacketInfo=bt(this.adInfo,this.adStyle)}initLastAnimedArray(){this.lastAnimedArray=[5,2]}getAnimType(){return this.animType}getRowNum(){return 2==this.animType?5:3}getAnimMinTime(){return this.animMinTime}getOriginShowTime(){let t=6;return!Ce(this.redPacketInfo)&&!Ce(this.redPacketInfo.showTime)&&this.redPacketInfo.showTime>0&&(t=F(this.adInfo)?this.redPacketInfo.showTime/1e3:this.redPacketInfo.showTime),t}getScaleType(t,e){return this.currentRandomParams[e*this.getRowNum()+t].scaleType}dismissCallbackOnlyOnce(){this.dismissCallbackCompleted||(this.dismissCallbackCompleted=!0,this.dismissCallback&&this.dismissCallback())}enableShowRedPacketView(){return!Ce(this.redPacketInfo)}getRedPacketViewDelayShowTime(){return Ce(this.redPacketInfo)?1:F(this.adInfo)?this.redPacketInfo.delayTime/1e3:this.redPacketInfo.delayTime}isShowRedPacketViewRightNow(){return!Ce(this.redPacketInfo)&&0==this.redPacketInfo.delayTime}checkParam(){return!Ce(this.redPacketInfo)&&(!fe(this.redPacketInfo.iconUrls)&&(this.paramValid=!0,!0))}isParamValid(){return this.paramValid}getShowTime(t){let e=this.getOriginShowTime();return 2==this.animType||Ce(this.currentRandomParams[t].iconShowTime)||(e=this.currentRandomParams[t].iconShowTime*this.getTimeCoefficient()),e}getIconDelayTime(t){return Math.floor(this.currentRandomParams[t].delayTime*this.getTimeCoefficient())*this.animMinTime}getDelayTime(){let t=1;return Ce(this.redPacketInfo)||Ce(this.redPacketInfo.delayTime)||(t=this.redPacketInfo.delayTime),t}getTimeCoefficient(){return 2==this.animType?1:this.getOriginShowTime()/4*1.1}getRotateTimeCoefficient(){return this.getOriginShowTime()/6}getRotateAnimDelayTime(t){return 2==this.animType||Ce(this.currentRandomParams[t].rotateDelayTime)?-1:Math.floor(this.currentRandomParams[t].rotateDelayTime*this.getRotateTimeCoefficient())*this.getAnimMinTime()}isCanShowRotateAnim(t){return-1!=this.getRotateAnimDelayTime(t)}getLastAnimIconIndex(){return this.lastAnimedArray[this.currentRandomParamIndex]}getAnimedCount(){return 2==this.animType?15:9}isCanClick(){return this.redPacketInfo.clickSwitch}getRedPacketIconUrl(){let t=Math.floor(Math.random()*this.redPacketInfo.iconUrls.length);return this.redPacketInfo.iconUrls[t]}reportRedPacketImpression(){if(1!=this.animType)return;let t=new b;if(F(this.adInfo)&&this.componentData){t.universe_feature_freq=this.componentData.componentId;const e=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds,component_id:this.componentData.componentId};t.component_module=JSON.stringify(i)}else t.universe_feature_freq=1;let e={elementType:201,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}convert(t,e,i,n=null,s){if(F(this.adInfo)&&this.componentData){n||(n=new b);const t=this.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let e={page_id:t.playCardInfo.pageId,combination_id:t.playCardInfo.combinationIds,component_id:this.componentData.componentId};n.component_module=JSON.stringify(e)}ei.convertIfNeeded(0,this.adInfo,t,e,i,n,s)}getRedPacketRandomParam(){let t=[];return t=2==this.animType?[[{delayTime:0,scaleType:.85},{delayTime:4.5,scaleType:.7},{delayTime:8.25,scaleType:.7},{delayTime:13.5,scaleType:1},{delayTime:18,scaleType:.7},{delayTime:2.25,scaleType:.7},{delayTime:7.5,scaleType:1},{delayTime:11.25,scaleType:.85},{delayTime:16.5,scaleType:1},{delayTime:21,scaleType:.85},{delayTime:0,scaleType:.85},{delayTime:4.5,scaleType:.7},{delayTime:9,scaleType:.7},{delayTime:14.25,scaleType:.85},{delayTime:18.75,scaleType:.85}]]:[[{delayTime:5,scaleType:.7,iconShowTime:2},{delayTime:15,rotateDelayTime:10,scaleType:.85,iconShowTime:2},{delayTime:22,scaleType:1,iconShowTime:2},{delayTime:0,rotateDelayTime:16,scaleType:1,iconShowTime:2.3},{delayTime:8,scaleType:.85,iconShowTime:2.5},{delayTime:20,scaleType:.7,iconShowTime:2.5},{delayTime:3,scaleType:.7,iconShowTime:1.9},{delayTime:11,scaleType:.7,iconShowTime:1.9},{delayTime:22,rotateDelayTime:13,scaleType:.85,iconShowTime:1.95}],[{delayTime:0,rotateDelayTime:12,scaleType:1,iconShowTime:2.3},{delayTime:10,scaleType:.85,iconShowTime:2.3},{delayTime:20,rotateDelayTime:16,scaleType:1,iconShowTime:2.7},{delayTime:2,scaleType:.7,iconShowTime:2},{delayTime:12,scaleType:1,iconShowTime:2.3},{delayTime:22,scaleType:.7,iconShowTime:2.1},{delayTime:0,scaleType:.85,iconShowTime:1.8},{delayTime:6,rotateDelayTime:18,scaleType:.85,iconShowTime:2.4},{delayTime:21,scaleType:1,iconShowTime:2.4}]],this.currentRandomParamIndex=Math.floor(Math.random()*t.length),t[this.currentRandomParamIndex]}}class Bo extends ji{constructor(t,e,i,n){super(),this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.setupData(),this.setupViewModels()}setupData(){this.pendantInfo=function(t,e){let i=null,n=Kt(t,e);return n&&(i=kt(t,n)),i}(this.adInfo,this.adStyle),this.pendantViewAnimInfo=Rt(this.adInfo,this.adStyle)}setupViewModels(){this.pendantAnimViewModel=new Ro(this.containerLimit,this.adInfo,this.adStyle,2)}updateLifeStatus(t){this.lifeStatus=t}enableShowPendant(){return!Ce(this.getPendantInfo())&&!Ce(this.getPendantImageUrl())}getPendantInfo(){return this.pendantInfo}getPendantViewAnimInfo(){return this.pendantViewAnimInfo}getPendantTitleText(){try{return this.pendantInfo.guideMsg}catch(t){}return""}getPendantImageUrl(){try{return this.pendantInfo.icon}catch(t){}return""}enableShowGuidanceImage(){try{return 1==this.pendantInfo.gestureType}catch(t){}return!1}getPendantType(){try{return this.pendantInfo.type}catch(t){}return 0}getPendantSize(){return 13==this.adStyle?{width:140,height:140}:{width:184,height:170}}getPendantImageWH(){return 13==this.adStyle?105:150}getPendantTitleFontSize(){return 13==this.adStyle?12:16}getPendantTitleMarginLR(){return this.adStyle,8}getGuidanceImageWH(){return 13==this.adStyle?43:63}getGuidanceImageMarginTop(){return 13==this.adStyle?-this.getGuidanceImageWH()-10:-this.getGuidanceImageWH()-12}getGuidanceImageMarginLeft(){return 13==this.adStyle?this.getGuidanceImageWH()+34:this.getGuidanceImageWH()+42}enableClickPendant(){return pt(this.adInfo,1)}reportPendantImpression(){let t=new b;t.template_show_type=this.getPendantTemplateShowType(),t.universe_feature_freq=2;let e={elementType:13,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}reportPendantClick(e){let i=new b;i.template_show_type=this.getPendantTemplateShowType(),ei.convertIfNeeded(1,this.adInfo,1,{x:e.position.rawX,y:e.position.rawY},t.PLAY_END_GIFT_CLICK,i)}getPendantTemplateShowType(){return"pendant_active_red_packet"+this.getPendantType()}enableShowPendantClickAnim(){return!Ce(this.pendantViewAnimInfo)&&!Ce(this.pendantViewAnimInfo.iconUrls)&&this.pendantViewAnimInfo.iconUrls.length>0}getPendantClickAnimDuration(){return 1300}}class Ko extends ji{constructor(t,e){super(),this.hasShown=!1,this.isShowEnd=!1,this.slotId=-1,this.componentData=void 0,this.callerContext=t,e&&(this.slotId=e);if(F(this.callerContext.adInfo)&&-1!=this.slotId){let t=k(this.callerContext.adInfo,"bubble-rain",this.slotId);t&&(this.bubbleRainInfo=R(t),this.componentData=t)}else this.bubbleRainInfo=function(t,e){let i,n=Kt(t,e);if(n){let e=nt(t,n);if(null==e)return;i=JSON.parse(e.data).bubbleRainInfo}return i}(this.callerContext.adInfo,this.callerContext.adStyle)}enableShowBubbleRainView(){return 1!=this.callerContext.screenOrientation&&!Ce(this.bubbleRainInfo)}enableCountDown(){return 2==this.callerContext.adStyle||3==this.callerContext.adStyle}isSplash(){return 4==this.callerContext.adStyle}getBubbleActionDes(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.bubbleActionDescription)&&void 0!==e?e:"立即开启大促"}getIndustryTopIcon(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.industryTopIcon)&&void 0!==e?e:""}getRedPacketUrl(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.redPacketUrl)&&void 0!==e?e:""}getSpecialRedPacketUrl(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.specialRedPacketUrl)&&void 0!==e?e:""}getRedPacketIndustryIcon(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.redPacketIndustryIcon)&&void 0!==e?e:""}getDelayTime(){var t;const e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.delayTime;return e>0?e:0}getShowTime(){var t;return null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.showTime}reportElementImpression(){let t=new b;if(F(this.callerContext.adInfo)&&this.componentData){t.universe_feature_freq=this.componentData.componentId;const e=this.callerContext.adInfo.adMatrixInfo.adDataV2.styleComponentInfo;let i={page_id:e.playCardInfo.pageId,combination_id:e.playCardInfo.combinationIds,component_id:this.componentData.componentId};t.component_module=JSON.stringify(i)}else t.universe_feature_freq=20;let e={elementType:238};e.clientExtData=JSON.stringify(t),ei.log(140,{x:0,y:0},e)}convert(t,e,i,n=null,s){F(this.callerContext.adInfo)&&this.componentData&&(n||(n=new b),n.component_module=B(this.callerContext.adInfo,this.componentData)),ei.convertIfNeeded(0,this.callerContext.adInfo,t,e,i,n,s)}}class Eo extends ji{constructor(t){super(),this.hasShown=!1,this.callerContext=t,this.setupData()}setupData(){this.giftBoxInfo=Bt(this.callerContext.adInfo,this.callerContext.adStyle)}isVertical(){return 0==this.callerContext.screenOrientation||Ce(this.callerContext.screenOrientation)}getGiftBoxInfo(){return this.giftBoxInfo}getGiftBoxIconUrls(){try{return this.giftBoxInfo.iconUrls}catch(t){}return[]}getGiftBoxDelayTime(){try{return this.giftBoxInfo.delayTime}catch(t){}return 1e3}getGiftBoxShowTime(){try{return this.giftBoxInfo.showTime}catch(t){}return 6e3}enableShowClickAnimation(){let t=!1;try{t=this.giftBoxInfo.showClickAnimation}catch(e){}return Ce(this.getClickAnimationLottieUrl())&&(t=!1),Le.supportMinimumTKVersion("5.0.0")||(t=!1),t}getClickAnimationLottieUrl(){let t="";try{t=this.giftBoxInfo.clickAnimationLottieUrl}catch(e){}return Ce(t)&&(t=Le.isAndroid()?"image/ksad-compose-image/GiftBox/ksad_lottie_gift_box_transition_android.json":"image/ksad-compose-image/GiftBox/ksad_lottie_gift_box_transition_ios.json"),t}getSingleBoxGuideText(){return"点击盒子，领取惊喜"}enableShowGiftBox(){const t=this.isVertical()&&!Ce(this.giftBoxInfo)&&!Ce(this.getGiftBoxIconUrls())&&this.getGiftBoxIconUrls().length>0;return console.log("giftbox enableshow"+t),t}showMultiBoxViewDirectly(){return!0}reportGiftBoxClick(){ei.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.SURPRISE_BOX_CLICK)}reportGiftBoxImpression(){let t=new b;t.universe_feature_freq=21;let e={elementType:237,clientExtData:JSON.stringify(t)};ei.log(140,null,e)}}class Po extends ji{constructor(){super(...arguments),this.festivalPendantBottom=0,this.currentPlaybackTime=0,this.showRedPacketRain=!1,this.adHasConvert=!1,this.hasShowPlayend=!1}checkDataValid(){return!!this.callerContext.adInfo}setDatas(){this.enableShowRedPacketView()&&this.isShowRedPacketViewRightNow()&&this.updateShowRedPacketRain(0),Oe().on(h,(t=>{this.adHasConvert=!0}))}createViewModels(){this.redPacketViewModel=new Ro(this.callerContext.containerLimit,this.callerContext.adInfo,this.callerContext.adStyle,1,this.slotId),this.festivalPendantViewModel=new Bo(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit),this.bubbleRainViewModel=new Ko(this.callerContext,this.slotId),this.giftBoxViewModel=new Eo(this.callerContext)}updateShowRedPacketRain(t){this.enableShowRedPacketView()&&(this.showRedPacketRain=t>=this.redPacketViewModel.getRedPacketViewDelayShowTime())}enableInitTopfloorContainer(){return this.enableShowGiftBoxView()||this.enableBubblerainView()||this.enableShowRedPacketView()||this.enableShowFestivalPendantView()}enableBubblerainView(){return this.bubbleRainViewModel.enableShowBubbleRainView()}enableShowRedPacketView(){return this.redPacketViewModel.enableShowRedPacketView()}isShowRedPacketViewRightNow(){return this.redPacketViewModel.isShowRedPacketViewRightNow()}isVertical(){return 0==this.callerContext.screenOrientation}enableShowFestivalPendantView(){return this.isVertical()&&this.festivalPendantViewModel.enableShowPendant()}enableShowGiftBoxView(){return this.giftBoxViewModel.enableShowGiftBox()}getFestivalPendantBottom(){}isNeedNewStyleTop(){return this.isAdForLive()&&this.isAddLiveButton()&&Le.isAndroid()&&this.isVertical()&&2==this.callerContext.adStyle}isAdForLive(){return mt(this.callerContext.adInfo)}isAddLiveButton(){return 1==this.callerContext.adInfo.adBaseInfo.universeLiveStyle}isValidFestivalPendantBottom(){return!this.hasShowPlayend&&!(this.festivalPendantBottom<=0||this.festivalPendantBottom>=this.callerContext.containerLimit.height-this.festivalPendantViewModel.getPendantSize().height)}}class Oo extends Po{constructor(t){super(),this.callerContext=t,this.createViewModels(),this.setDatas()}getFestivalPendantBottom(){this.festivalPendantBottom=this.getBottomHeigtCallback()}}class Mo{constructor(t,e,i,n,s,a){this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=s,this.originContainerLimit=a}getOriginWidth(){return this.originContainerLimit?this.originContainerLimit.width:0}isCurvedScreen(){return this.containerLimit.width/this.containerLimit.height<1.8}getOriginHeight(){return this.originContainerLimit?this.originContainerLimit.height:0}}class No extends Mo{constructor(t,e,i,n,s,a){super(t,e,i,n,s,a),this.downloadState=0,this.hasShowPlayend=!1,this.pageFocusAndVisible=!0,this.componentSwtich=!1,this.componentSwtich=F(t);let o=0;try{o=t.adMatrixInfo.adDataV2.componentDatas.length}catch(r){}0==o&&this.componentSwtich&&ze("component_ui_empty")}}class Ho{constructor(t){this.key=t,this.checkDate()}getCurrentCount(){return console.log("tkloadcontroller currentcount:"+this.currentCount),this.currentCount}increaseCurrentCount(){this.checkDate(),this.currentCount+=1,console.log("tkloadcontroller increase currentcount:"+this.currentCount),g.saveLocal(this.getCountKey(),this.currentCount)}checkDate(){let t=g.getLocalString(this.getDateKey());const e=(new Date).toDateString();console.log("tkloadcontroller t:"+t+":"+e),t!==e?(g.saveLocal(this.getDateKey(),e),g.saveLocal(this.getCountKey(),0),this.currentCount=0):this.currentCount=g.getLocalInt(this.getCountKey())}getDateKey(){return console.log("tkloadcontroller key:"+this.key+"_date"),this.key+"_date"}getCountKey(){return console.log("tkloadcontroller key:"+this.key+"_count"),this.key+"_count"}}class Wo extends ji{constructor(){super(...arguments),this.shakeRegistered=!1,this.hadExposeShakeElement=!1,this.rotateRegistered=!1,this.slotId=-1,this.componentData=void 0}needShowShakeUI(){return!1}getShakeSubtitle(){return""}getAccelerationThreshold(){return 7}enableShakeConvert(){let t=this.getShakeInfo();return!Ce(t)&&t.enable}enableRotateConvert(){if(!Le.supportMinimumTKVersion("5.0.0"))return!1;let t=this.getRotateInfo();return!Ce(t)&&t.enable}getRotateInfo(){let t=null;return this.interactionInfo&&(t=this.interactionInfo.rotateInfo),t}getShakeInfo(){let t=null;return this.interactionInfo&&(t=this.interactionInfo.shakeInfo),t}getInteractionInfoInfo(){if(F(this.callerContext.adInfo))return this.interactionInfo;try{2==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.neoVideoInfo.interactionInfo),3==this.callerContext.adStyle&&(this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo)}catch(t){}return this.interactionInfo}startListenSensor(){this.enableShakeConvert()&&this.listenShakeSensor(),this.enableRotateConvert()&&this.listenRotateSensor()}stopListenSensor(){this.enableShakeConvert()&&this.stopListenShake(),this.enableRotateConvert()&&this.stopListenRotate()}listenShakeSensor(){if(this.lastSensor=new Array,this.lastSensor[0]=0,this.lastSensor[1]=0,this.lastSensor[2]=0,this.shakeRegistered||(this.shakeRegistered=!0,Co.registerSensorListener(1,-3,(e=>{try{if(!Ce(e)&&!Ce(e.values)&&this.shakeRegistered){e=this.shakeNoiseReduction(e);let i,n=Math.sqrt(e.values[0]*e.values[0]+e.values[1]*e.values[1]+e.values[2]*e.values[2]);if(Math.abs(n-9.81)<=.05)return;if(this.lastSensor=e.values,Pt(this.getShakeInfo())?(i=this.bidirectionalRotateShakeUtil.bidireationShakeConvert(e.values),n=Math.max(Math.max(Math.abs(e.values[0]),Math.abs(e.values[1])),Math.abs(e.values[2]))):i=n>=this.getAccelerationThreshold(),this.callerContext.pageFocusAndVisible&&i){this.stopListenSensor(),Le.supportMinimumTKVersion("5.0.0")&&KSAdSystemUtil.startVibrate(100);let e={splash_shake_acceleration:n},i={reward_interactive_style_type:this.getInteractiveStyleType()};this.callerContext.componentSwtich&&(i.component_module=B(this.callerContext.adInfo,this.componentData)),ei.convertIfNeeded(0,this.callerContext.adInfo,1,{x:0,y:0},t.SHAKE_ICON_SHACK,i,e)}}}catch(i){}}))),!this.hadExposeShakeElement){this.hadExposeShakeElement=!0;let t=new b,e={elementType:185};F(this.callerContext.adInfo)&&this.componentData&&(t.universe_feature_freq=this.componentData.componentId,t.component_module=B(this.callerContext.adInfo,this.componentData)),t.reward_interactive_style_type=this.getInteractiveStyleType(),e.clientExtData=JSON.stringify(t),ei.log(140,{x:0,y:0},e)}}listenRotateSensor(){if(this.rotateHandler||(this.rotateHandler=new Sa(this.getRotateInfo())),this.rotateHandler.beforeMonitor(),!this.rotateRegistered)if(this.rotateRegistered=!0,"undefined"!=typeof KSAdSensorManager&&KSAdSensorManager.supportSensor(2))Co.registerSensorListener(2,-3,(e=>{try{if(!Ce(e)&&!Ce(e.values)&&this.rotateHandler&&this.rotateRegistered&&this.callerContext.pageFocusAndVisible&&this.rotateHandler.canConvertRotate(e)){this.stopListenSensor();let e={splashInteractionRotateAngle:this.rotateHandler.maxRotateContent()},i={reward_interactive_style_type:this.getInteractiveStyleType()};F(this.callerContext.adInfo)&&this.componentData&&(i.component_module=B(this.callerContext.adInfo,this.componentData)),ei.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,i,e),KSAdSystemUtil.startVibrate(100)}}catch(i){}}));else{if(this.rotateHandler.bidirectionalSwitch)return;let e=this.getRotateInfo();(null==e?void 0:e.useImitateRotate)&&(this.sensorImitateRotateUtil=new Fa(e),this.sensorImitateRotateUtil.registerImitateRotateSensorListener((e=>{try{if(!Ce(e)&&this.rotateRegistered&&this.callerContext.pageFocusAndVisible){this.stopListenSensor();let i={splashInteractionRotateAngle:e},n={reward_interactive_style_type:this.getInteractiveStyleType()};ei.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},t.ROTATE_ICON_ROTATE,n,i),KSAdSystemUtil.startVibrate(100)}}catch(i){}})))}}stopListenRotate(){this.rotateRegistered&&(this.rotateRegistered=!1,this.sensorImitateRotateUtil?this.sensorImitateRotateUtil.unRegisterImitateRotateSensorListener():Co.unregisterSensorListener(2))}stopListenShake(){this.shakeRegistered&&(this.shakeRegistered=!1,Co.unregisterSensorListener(1))}shakeNoiseReduction(t){let e=.6;return 0==this.lastSensor[0]&&0==this.lastSensor[1]&&0==this.lastSensor[2]&&(e=1),this.lastSensor[0]=e*t.values[0]+(1-e)*this.lastSensor[0],this.lastSensor[1]=e*t.values[1]+(1-e)*this.lastSensor[1],this.lastSensor[2]=e*t.values[2]+(1-e)*this.lastSensor[2],t.values[0]=this.lastSensor[0],t.values[1]=this.lastSensor[1],t.values[2]=this.lastSensor[2],t}getInteractiveStyleType(){try{return this.callerContext.configInfo.abConfig.rewardInteractiveStyleType}catch(t){return 0}}isSlideClick(){var t;return!!(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)}convert(t,e,i,n){}}class zo extends Wo{constructor(t){super(),this.callerContext=t,this.fullscreenShakeControl=new Ho("KSAdFullscreenShakeKey");try{this.interactionInfo=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo}catch(e){}this.bidirectionalRotateShakeUtil=new xa(this.getInteractionInfoInfo())}getVideoTKScene(){return ho.FULLSCREEN}getPlayableStyle(){return Tt(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.screenOrientation)}needShowShakeUI(){var t,e;try{return!!this.interactionInfo&&(!!this.enableShakeConvert()&&(3==this.callerContext.adStyle&&(2==this.interactionInfo.interactiveStyle&&(0==this.getPlayableStyle()&&(6!=(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo)||void 0===t?void 0:t.detailWebCardInfo.cardType)&&5!=(null===(e=this.callerContext.adInfo.adMatrixInfo.adDataV2.playCardStyleInfo)||void 0===e?void 0:e.detailWebCardInfo.cardType)&&(console.log("tkloadcontroller shakecount:"+this.callerContext.configInfo.abConfig.fullScreenShakeMaxCount+";"+(this.fullscreenShakeControl.getCurrentCount()>=this.callerContext.configInfo.abConfig.fullScreenShakeMaxCount)),!(this.fullscreenShakeControl.getCurrentCount()>=this.callerContext.configInfo.abConfig.fullScreenShakeMaxCount)))))))}catch(i){}return!1}getShakeSubtitle(){let t="";try{if(console.log("tkloadcontroller isdownload:"+Y(this.callerContext.adInfo)),Y(this.callerContext.adInfo)){const e=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo.actionBarInfo.downloadTexts;switch(this.callerContext.downloadState){case 6:t=e.openAppLabel;break;case 5:t=e.installAppLabel;break;default:t=e.adActionDescription}}else t=this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo.shakeInfo.subtitle}catch(e){}return me(t)?"或点击"+t:""}getAccelerationThreshold(){return Et(this.callerContext.adInfo.adMatrixInfo.adDataV2.fullScreenInfo.interactionInfo)}startListenSensor(){this.fullscreenShakeControl.increaseCurrentCount();let t=this.getVideoTKScene()==ho.FULLSCREEN;!Le.supportMinimumTKVersion("5.0.8")&&t?Co.registerBridgeShake(null):super.startListenSensor()}convert(t,e,i,n){n||(n=new b),n.material_click_area="fullscreen_mid",n.reward_interactive_style_type=this.getInteractiveStyleType(),ei.convertIfNeeded(3,this.callerContext.adInfo,t,e,i,n)}}class Uo extends ji{constructor(t,e,i=null){super(),this.reportFreQ=!1,this.clickType=0,this.getActionBarRect=()=>({x:0,y:0,width:0,height:0}),this.callerContext=t,this.industryInfo=e,Ce(i)?this.templateShowType=this.obtainTemplateShowType():this.templateShowType=i}obtainTemplateShowType(){let t="ecommerce_coupon";if(this.industryInfo){switch(this.industryInfo.merchantStyleType){case T.PRODUCT:t="benefit_card_item";break;case T.COUPON:t="ecommerce_coupon";break;case T.EVENT:t="benefit_card_activity";break;case T.DEFAULT:t="benefit_card_default"}}return t}updateProgressListener(t){if(t.result&&Le.isSupportDownloadProgressListen()&&Y(this.callerContext.adInfo)){const{status:e,progress:i,totalBytes:n}=t.data,s=Number((100*i).toFixed(0))>100?"100":(100*i).toFixed(0);switch(e){case 0:case 1:case 4:this.actionBarText=this.callerContext.adInfo.adBaseInfo.adActionDescription;break;case 2:this.actionBarText=`${s}%`;break;case 3:this.actionBarText="继续下载";break;case 5:this.actionBarText=me(this.callerContext.adInfo.adBaseInfo.installAppLabel)?this.callerContext.adInfo.adBaseInfo.installAppLabel:"点击安装";break;case 6:this.actionBarText=me(this.callerContext.adInfo.adBaseInfo.openAppLabel)?this.callerContext.adInfo.adBaseInfo.openAppLabel:"立即打开"}}}isCouponLegacy(){return!1}getBottomTipsText(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.riskPromptText)||"具体活动或金额以实际活动为准"}supportHorizontal(){return!1}enableShowCard(){return!Ce(this.industryInfo)}getRightsCardStayTime(){var t,e;let i=7;try{let n=null!==(e=null===(t=this.industryInfo)||void 0===t?void 0:t.rightsCardShowTime)&&void 0!==e?e:7e3;i=Math.ceil(n/1e3)}catch(n){}return i}enableInteractCard(){return this.getInteractShowTime()>0}getInteractShowTime(){var t,e;return null!==(e=null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardShowTime)&&void 0!==e?e:2e3}getInteractTitle(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardTitle)||""}getInteractSubTitle(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardSubTitle)||""}getInteractIcon(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardIcon)||""}getInteractCustomerInfo(){var t;return(null===(t=this.industryInfo)||void 0===t?void 0:t.interactiveCardCustomer)||[]}getDelayShowTime(){var t,e;let i=5;try{let n=null!==(e=null===(t=this.industryInfo)||void 0===t?void 0:t.delayTime)&&void 0!==e?e:2e3;i=Math.ceil(n/1e3)}catch(n){i=5}return i}isVertical(){return 0==this.callerContext.screenOrientation}isSplashScene(){return 4==this.callerContext.adStyle}isInterstitialScene(){return 13==this.callerContext.adStyle}logInteractionImp(){let t=new b;t.template_show_type="interaction_card_ecom";let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}logInteractionClick(t){let e=new b;e.click_area=t,e.template_show_type="interaction_card_ecom";let i={elementType:191,clientExtData:JSON.stringify(e)},n={actionType:141,payload:JSON.stringify(i)};ke.sendLog(n)}logRightsImp(t,e){let i=new b;i.template_show_type=t,this.reportFreQ||(i.universe_feature_freq=e),this.reportFreQ=!0;let n={elementType:191,clientExtData:JSON.stringify(i)},s={actionType:140,payload:JSON.stringify(n)};ke.sendLog(s)}convert(t,e,i,n){let s=new b;return s.template_show_type=this.templateShowType,ei.convertIfNeeded(1,this.callerContext.adInfo,e,t,i,s,n)}logSplashCardImpression(){if(this.isSplashScene()){let t={elementType:239};ei.log(140,null,t)}}}class Go{}class jo extends Uo{constructor(t,e){super(t,e),this.couponInfo=this.industryInfo,this.actionBarText=this.callerContext.adInfo.adBaseInfo.adActionDescription,this.mScreenWidthDp=ae(te()),this.mScreenScaleX=this.mScreenWidthDp/414}getCardSize(){let t=new Go;return t.width=Math.ceil(406*this.mScreenScaleX),t.height=Math.ceil(372*t.width/406),t}getRootBgColor(){return null}getCouponBarSize(){let t=new Go;return t.width=Math.ceil(264*this.mScreenScaleX),t.height=Math.ceil(92*t.width/264),t.left=Math.ceil((this.mScreenWidthDp-t.width)/2),t.bottom=Math.ceil(68*t.height/92),t}getFullCardBgUrl(){return"ec_card_coupon_anim_bg.png"}getFullCardHeight(){return 497*this.mScreenWidthDp/414}getRightsCardTitle(){return""}needCouponBarBg(){return!0}getBottomTipsMarginBottom(){return Math.ceil(45*this.mScreenScaleX)}getBottomImageViewName(){return null}useLegacyAnim(){return!1}getBgUrl(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardBgUrl)||""}getUserIcon(){return""}getTitleDesc(){return""}getCouponTitle(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardTitle)||""}getCouponDesc(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardDescription)||""}getPriceAmount(){var t;return(null===(t=this.couponInfo)||void 0===t?void 0:t.merchantCardAmount)||""}enableAnimation(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle||4==this.callerContext.adStyle}enableShowCloseView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowCountDownView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowActionbarView(){return 13!=this.callerContext.adStyle}enableHandBreathAnim(){return!0}getActionbarDesc(){return this.couponInfo.merchantCardActionDescription||"立即领取"}logECCardImpression(){let t=new b;t.template_show_type="ecommerce_coupon";let e={clientExtData:JSON.stringify(t)};ei.exposeElement(191,e)}}class Yo extends jo{constructor(t){var e;super(t,null),this.merchantCardInfo=St(this.callerContext.adInfo,this.callerContext.adStyle),this.actionBarText=(null===(e=this.merchantCardInfo)||void 0===e?void 0:e.merchantCardActionDescription)||"立即领取"}getCardSize(){let t=new Go;return t.width=263,t.height=273,t}getRootBgColor(){return"#00000099"}getCouponBarSize(){let t=new Go;return t.width=211,t.height=69,t.left=31,t.bottom=38,t}getFullCardBgUrl(){return null}supportHorizontal(){return!0}getRightsCardTitle(){return"恭喜获得"}needCouponBarBg(){return!1}getBottomTipsText(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.riskPromptText)||"具体活动或金额以实际活动为准"}getBottomImageViewName(){return"ec_card_view_bg.png"}useLegacyAnim(){return!0}getBgUrl(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardBgUrl)||""}getUserIcon(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardUserIcon)||""}getTitleDesc(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardTitleDescription)||""}getCouponTitle(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardTitle)||""}getCouponDesc(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardDescription)||""}getPriceAmount(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardAmount)||""}getRightsCardStayTime(){let t=10;try{t=Math.ceil(this.merchantCardInfo.merchantCardStayTime/1e3)}catch(e){t=10}return t}getDelayShowTime(){let t=5;try{t=Math.ceil(this.merchantCardInfo.merchantCardShowTime/1e3)}catch(e){t=5}return t}enableInteractCard(){return!1}isCouponLegacy(){return!Ce(this.merchantCardInfo)}enableShowCard(){return!Ce(this.merchantCardInfo)}enableAnimation(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle||4==this.callerContext.adStyle}enableShowCloseView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowCountDownView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowActionbarView(){return 13!=this.callerContext.adStyle}enableHandBreathAnim(){return!1}getActionbarDesc(){var t;return(null===(t=this.merchantCardInfo)||void 0===t?void 0:t.merchantCardActionDescription)||"立即领取"}}class Xo extends Uo{constructor(t,e,i,n){super(t,e,i),this.needShowSellingText=!1,this.frqType=n,this.productInfo=this.industryInfo}getActionbarDesc(){return this.callerContext.adInfo.adBaseInfo.adActionDescription}getShowTime(){var t,e;return null!==(e=null===(t=this.productInfo)||void 0===t?void 0:t.showTime)&&void 0!==e?e:6e3}getRightsCardTitle(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardTitle)||""}getRightsCardProductTags(){var t,e;const i=new Array;return null===(e=null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardProductTags)||void 0===e||e.forEach((t=>{if(!Ce(t)){let e={text:t,url:"",canClick:!1};i.push(e)}})),i.slice(0,3)||[]}logProductRightsImp(){super.logRightsImp(this.templateShowType,this.frqType)}isHasTags(){return this.getRightsCardProductTags()&&this.getRightsCardProductTags().length>0}getRightsCardCustomImageUrl(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardCustomImageUrl)||""}getRightsCardCustomContent(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardCustomContent)||""}getRightsCardSellingPoint(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.sellingPoint)||""}getRightsCardAction(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardAction)||""}getRightsCardSecKillTime(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardSecKillTime)||0}getRightsCardProductIconDesc(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.rightsCardProductIconDesc)||""}getPrice(){var t;let e=Ce(this.getOriginPrice())?"":"惊爆价格";return(null===(t=this.productInfo)||void 0===t?void 0:t.price)||e}getOriginPrice(){var t;return(null===(t=this.productInfo)||void 0===t?void 0:t.originPrice)||""}isOnlyHasOriginPrice(){var t;return!Ce(this.getOriginPrice())&&Ce(null===(t=this.productInfo)||void 0===t?void 0:t.price)}}class Jo extends Uo{constructor(t,e){super(t,e),this.activityInfo=this.industryInfo,this.actionBarText=this.callerContext.adInfo.adBaseInfo.adActionDescription,this.mScreenWidthDp=ae(te()),this.mScreenScaleX=this.mScreenWidthDp/414}getLottieSize(){let t=this.mScreenWidthDp/500,e=new Go;return e.width=Math.ceil(500*t),e.height=Math.ceil(515*e.width/500),e}getTitleSize(){let t=new Go;return t.width=Math.ceil(414*this.mScreenScaleX),t.height=Math.ceil(187*t.width/414),t}getButtonSize(){let t=new Go;return t.width=Math.ceil(190*this.mScreenScaleX),t.height=Math.ceil(48*t.width/190),t.borderRadius=Math.ceil(t.height/2),t}getWidgetSize(){let t=new Go;return t.width=Math.ceil(248*this.mScreenScaleX),t.height=Math.ceil(54*t.width/248),t}getCardViewSize(){let t=new Go;return t.width=Math.ceil(250*this.mScreenScaleX),t.height=Math.ceil(372*t.width/250),t.borderRadius=Math.ceil(24*t.height/372),t}getCardBgSize(){let t=new Go;return t.width=Math.ceil(414*this.mScreenScaleX),t.height=Math.ceil(497*t.width/414),t}getFullCardHeight(){return 700*this.mScreenScaleX}getHandViewSideLength(){return 90*this.mScreenScaleX}getBottomTipsMarginBottom(t){return Math.ceil(this.mScreenScaleX*t)}getCardMarginTop(t){return Math.ceil(this.mScreenScaleX*t)}getCardMarginRight(t){return Math.ceil(this.mScreenScaleX*t)}getFullCardBgUrl(){return"ec_card_coupon_anim_bg.png"}getRightsCardTitle(){var t;return(null===(t=this.activityInfo)||void 0===t?void 0:t.rightsCardTitle)||""}getRightsCardCustomImageUrl(){var t;return(null===(t=this.activityInfo)||void 0===t?void 0:t.rightsCardCustomImageUrl)||""}getRightsCardAction(){var t;return(null===(t=this.activityInfo)||void 0===t?void 0:t.rightsCardAction)||""}getActionbarDesc(){return""}}class $o extends ji{constructor(t){if(super(),this.cardCreateSuccess=!1,this.callerContext=t,this.ecIndustryInfo=xt(this.callerContext.adInfo,this.callerContext.adStyle),Ce(this.ecIndustryInfo)){let t=Dt(this.callerContext.adInfo,this.callerContext.adStyle),e=this.callerContext.adInfo.adProductInfo;this.ecIndustryInfo=K.newDeepVideoInteractCardInfo(e,t)}if(Ce(this.ecIndustryInfo))this.rightsCardVM=new Yo(t);else{switch(this.ecIndustryInfo.merchantStyleType){case T.COUPON:this.rightsCardVM=new jo(t,this.ecIndustryInfo);break;case T.EVENT:this.rightsCardVM=new Jo(t,this.ecIndustryInfo);break;case T.PRODUCT:this.rightsCardVM=new Xo(t,this.ecIndustryInfo,"benefit_card_item",25);break;case T.PRODUCT_DEEP_VIDEO:let e=new Xo(t,this.ecIndustryInfo,"internal_circulation_item",29);e.needShowSellingText=!0,this.rightsCardVM=e;break;case T.DEFAULT:this.rightsCardVM=new Jo(t,this.ecIndustryInfo)}}}updateProgressListener(t){this.rightsCardVM&&this.rightsCardVM.updateProgressListener(t)}getRightsCardVM(){return this.rightsCardVM}isLegacyVM(){return Ce(this.ecIndustryInfo)}isVertical(){return 0==this.callerContext.screenOrientation}logCloseReport(t,e){let i=new b;i.template_show_type=e;let n={elementType:69,adCloseType:t,clientExtData:JSON.stringify(i)};ei.log(141,null,n)}enableInteract(){return this.rightsCardVM.enableInteractCard()}enableShowCard(){return this.rightsCardVM.enableShowCard()}cardLoadSuccess(){return this.cardCreateSuccess&&this.enableShowCard()}getDelayShowTime(){return this.rightsCardVM.getDelayShowTime()}getRightsCardStayTime(){return this.rightsCardVM.getRightsCardStayTime()}enableAnimation(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle||4==this.callerContext.adStyle}enableShowCloseView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowCountDownView(){return 3==this.callerContext.adStyle||2==this.callerContext.adStyle}enableShowActionbarView(){return 13!=this.callerContext.adStyle}getActionbarDesc(){return this.rightsCardVM.getActionbarDesc()}}class Zo extends ji{constructor(t){super(),this.clickType=0,this.reportFreQ=!1,this.callerContext=t,this.gameIndustryInfo=Lt(this.callerContext.adInfo,this.callerContext.adStyle)}enableShowGameCard(){return!Ce(this.gameIndustryInfo)&&0==this.callerContext.screenOrientation}getDelayTime(){var t,e;return null!==(e=null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.delayTime)&&void 0!==e?e:3e3}enableShowWidget(){var t,e;return null!==(e=null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardTransformSwitch)&&void 0!==e&&e}enableCopy(){return!(ce()||!Le.supportMinimumTKVersion("5.0.0"))||!!Le.supportMinimumTKVersion("5.1.6")}enableInteractCard(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardShowTime)>0}getInteractShowTime(){var t,e;return null!==(e=null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardShowTime)&&void 0!==e?e:3e3}getInteractTitle(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardTitle)||""}getInteractSubTitle(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardSubTitle)||""}getInteractIcon(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardIcon)||""}getInteractCustomerInfo(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.interactiveCardCustomer)||[]}getRightsShowTime(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardShowTime)||3e3}getRightsCardTitle(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardTitle)||""}getRightsIconLis(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardIconList)||[]}getRightsCardCode(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardCode)||""}getRightsCardCodeDesc(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardCodeDesc)||""}getRightsCardAction(){var t;return(null===(t=this.gameIndustryInfo)||void 0===t?void 0:t.rightsCardAction)||""}getRightsGiftStyle(){return this.getRightsIconLis().length>1?1:0}copyRightsCode(){this.enableCopy()&&KSAdPasteboard.copyToPasteboard(this.getRightsCardCode(),1,(t=>{console.log("tkloadcontroller ====+++++pasteboardName"+t)}))}convert(t,e,i,n){ei.convertIfNeeded(1,this.callerContext.adInfo,e,t,i,n)}logCloseReport(t){let e=new b;e.template_show_type="gameindustry";let i={elementType:69,adCloseType:t,clientExtData:JSON.stringify(e)};ei.log(141,null,i)}logRightsImp(){let t=new b;t.template_show_type="benefit_card",this.reportFreQ||(t.universe_feature_freq=22),this.reportFreQ=!0;let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}logInteractionImp(){let t=new b;t.template_show_type="interaction_card",this.reportFreQ||(t.universe_feature_freq=22),this.reportFreQ=!0;let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}logInteractionClick(t){let e=new b;e.click_area=t,e.template_show_type="interaction_card";let i={elementType:191,clientExtData:JSON.stringify(e)},n={actionType:141,payload:JSON.stringify(i)};ke.sendLog(n)}logWidgetImp(){let t=new b;t.template_show_type="pendant_card";let e={elementType:191,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};ke.sendLog(i)}}class qo extends ji{constructor(t,e){super(),this.currentPlaybackTime=0,this.callerContext=t,this.styleType=e,this.liveCouponInfo=this.obtainVideoLiveData()}obtainVideoLiveData(){try{let t=nt(this.callerContext.adInfo,this.styleType),e=JSON.parse(t.data);if(!Ce(e)&&!Ce(e.liveCouponInfo))return e.liveCouponInfo}catch(t){}return null}isLiveCouponPopUpEnable(){let t=!1;if(Ce(this.liveCouponInfo)||0!=this.callerContext.screenOrientation)return t;try{let e=this.liveCouponInfo.innerLiveCouponStyle;t=1==e||3==e}catch(e){}return t}isLiveCouponBottomCardEnable(){let t=!1;if(Ce(this.liveCouponInfo)||0!=this.callerContext.screenOrientation)return t;try{let e=this.liveCouponInfo.innerLiveCouponStyle;t=2==e||3==e}catch(e){}return t}supportSlideClick(){try{return this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo.slideClick}catch(t){return!1}}getShopImage(){try{return this.callerContext.adInfo.adBaseInfo.appIconUrl}catch(t){}return""}getShopName(){try{return this.callerContext.adInfo.adBaseInfo.appName}catch(t){}return""}getCouponTitle(){try{return this.liveCouponInfo.couponTitle}catch(t){}return""}getCouponAmount(){try{return this.liveCouponInfo.couponAmount}catch(t){}return 0}getCouponCondition(){try{return this.liveCouponInfo.couponCondition}catch(t){}return""}getCouponSubTitle(){try{return this.liveCouponInfo.couponSubTitle}catch(t){}return"直播限时补贴"}getCouponActionDesc(){try{return this.liveCouponInfo.couponActionDesc}catch(t){}return"去领取"}getCouponExpireTime(){try{return this.liveCouponInfo.couponExpireTime}catch(t){}return""}getCouponDelayTime(){try{let t=this.liveCouponInfo.delayTime;return Math.ceil(t/1e3)}catch(t){}return 8}getCouponShowTime(){try{return this.liveCouponInfo.showTime}catch(t){}return 5e3}getNumberStringDigits(t){return null==t?0:t.indexOf(".")>=0?t.length-1:t.length}convert(t,e,i,n=null,s){ei.convertIfNeeded(1,this.callerContext.adInfo,t,e,i,n,s)}logCloseReport(t,e){let i=new b;i.template_show_type=e;let n={elementType:69,adCloseType:t,clientExtData:JSON.stringify(i)};ei.log(141,null,n)}impressionReport(t,e){let i=new b;i.template_show_type=e;let n={elementType:t,clientExtData:JSON.stringify(i)},s={actionType:140,payload:JSON.stringify(n)};ke.sendLog(s)}}class Qo extends ji{constructor(t){super(),this.callerContext=t,this.socialCardInfo=_t(this.callerContext.adInfo,this.callerContext.adStyle),this.mScreenWidthDp=ae(te()),this.mScreenScaleX=this.mScreenWidthDp/414}enableShowSocialCard(){return!Ce(this.socialCardInfo)&&0==this.callerContext.screenOrientation}getCardSize(){let t=new Go;return t.width=Math.ceil(382*this.mScreenScaleX),t.height=Math.ceil(510*t.width/382),t.borderRadius=32,t}getPictureFrameSize(){let t=new Go;return t.width=Math.ceil(288*this.mScreenScaleX),t.height=Math.ceil(408*t.width/288),t}getPictureSize(){let t=new Go;return t.width=Math.ceil(246*this.mScreenScaleX),t.height=Math.ceil(370*t.width/246),t}getActionBarSize(){let t=new Go;return t.width=Math.ceil(357*this.mScreenScaleX),t.height=Math.ceil(50*t.width/357),t.borderRadius=t.height,t.left=Math.ceil(25*this.mScreenScaleX)/2,t}getGapDistance(t){return Math.ceil(this.mScreenScaleX*t)}getSocialCardDelayTime(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.delayTime}getSocialCardShowTime(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.showTime}getSocialCardStyle(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardStyle}getSocialCardDialogTitle(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardDialogTitle}getSocialCardDialogDescTitle(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardDialogDesc}getSocialCardBgImageUrl(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardBgUrl}getSocialCardTagText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardTag}getSocialCardDescText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardDesc}getSocialCardActionBarText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardActionText}getSocialCardLiveTagText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardLiveTag}getSocialCardMatchTagText(){var t;return null===(t=this.socialCardInfo)||void 0===t?void 0:t.socialCardMatchTag}hasLiveTag(){return me(this.getSocialCardLiveTagText())}getSocialPhoneIcon(){return"icon_ksad_social_phone.json"}getCardcloseIconImageSrc(){return"icon_ksad_social_close.png"}getSocialCallLottieSrc(){return"icon_ksad_social_call.json"}getSocialSweepImg(){return"icon_ksad_social_strong_sweep.png"}obtainTagText(t){let e=new Array,i={text:t,url:"",canClick:!1};return e.push(i),e}supportSlideClick(){var t;return(null===(t=this.callerContext.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}logECCardImpression(){let t=new b;t.template_show_type=this.templateShowType;let e={clientExtData:JSON.stringify(t)};ei.exposeElement(191,e)}logCloseReport(t){let e=new b;e.template_show_type=this.templateShowType;let i={elementType:69,adCloseType:t,clientExtData:JSON.stringify(e)};ei.log(141,null,i)}convert(t,e,i,n){let s=new b;return s.template_show_type=this.templateShowType,ei.convertIfNeeded(1,this.callerContext.adInfo,e,t,i,s,n)}}class tr extends ji{constructor(){super(...arguments),this.hasReportShow=!1,this.lifeStatus="none",this.actionText="",this.isMuted=!1,this.downloadState=0,this.mLifeCycleHelper=new Ga}getData(t){let e=[];e.push(ke.getKsAdDataAsync()),e.push(ke.getDeviceInfoAsync()),e.push(ke.getKsAdConfigAsync()),e.push(ke.getContainerLimitAsync()),e.push(ke.getScreenOrientationAsync()),e.push(ke.callNative("registerMuteStateListener",null)),Promise.all(e).then((e=>{try{const i=e[0].data,n=e[1].data,s=e[2].data,a=e[3].data,o=e[4].data;this.adOriginInfo=i,this.adInfo=i.impAdInfo[0].adInfo[0],this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=o.screenOrientation,this.isMuted=e[5].data.muted||!1,this.configInfo=s,this.containerLimit=a,this.screenOrientation=o.screenOrientation,Zt(n),this.deviceInfo=n,this.additionalInit(),t&&t(!0)}catch(i){t&&t(!1)}}))}additionalInit(){const t={width:this.containerLimit.width-2*this.getSideMargin(),height:this.containerLimit.height-this.getTopMargin()};this.callerContext=new No(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.topBarVM=new ko(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.middleCardVM=new uo(this.callerContext),this.shakeVM=new zo(this.callerContext),this.bottomBarVM=new ro(this.adInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.playerVM=new Lo(this.adInfo,this.adStyle,this.configInfo),this.playEndCardVM=new _o(this.callerContext,this.adOriginInfo,ho.FULLSCREEN),this.playableCardVM=new Cs(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.autocallVM=new ja(this.adInfo,this.adStyle,this.configInfo,3),this.topFloorVM=new Oo(this.callerContext),this.couponWidgetVM=new Ya(this.adInfo,this.adStyle,this.configInfo,3,t,this.screenOrientation),this.rotateVM=new Ao(this.callerContext,ho.FULLSCREEN),this.pushCardVM=new Fo(this.adInfo,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation),this.topBarVM.isMuted=this.isMuted,this.playerVM.isMuted=this.isMuted,this.confirmVM=new mo(this.adInfo,this.adOriginInfo,this.adStyle,this.configInfo,t,this.screenOrientation),this.downloadPopupVM=new Xa(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.ecCardViewModel=new $o(this.callerContext),this.gameCardViewModel=new Zo(this.callerContext),this.liveCouponVM=new qo(this.callerContext,3),this.socialCardViewModel=new Qo(this.callerContext);const e=this;this.blockRecorder=new Do((()=>{e.topBarVM.playFinished=!0})),yi(this.playerVM,this.playerVM.$attrsPath.currentPlaybackTime,(t=>{this.topBarVM.currentPlaybackTime=t,this.topFloorVM.currentPlaybackTime=t,this.blockRecorder.updateCurrentPlaybackTime(t)})),yi(this.playerVM,this.playerVM.$attrsPath.playFailed,(t=>{this.topBarVM.playFailed=t})),yi(this.playerVM,this.playerVM.$attrsPath.playFinished,(t=>{this.topBarVM.playFinished=t})),yi(this.topBarVM,this.topBarVM.$attrsPath.isMuted,(t=>{this.playerVM.isMuted=t})),yi(this.confirmVM,this.confirmVM.$attrsPath.isShow,(t=>{t?this.playerVM.onDialogShow(this.confirmVM):this.playerVM.onDialogDismiss(this.confirmVM),this.callerContext.pageFocusAndVisible=!t,this.pushCardVM.isPaused=t})),yi(this.playerVM,this.playerVM.$attrsPath.playStatus,(t=>{this.blockRecorder.updatePlayerStatus(t)})),Le.supportMinimumTKVersion("4.0.4")?yi(this.topBarVM,this.topBarVM.$attrsPath.hasShowPlayend,(t=>{t&&ke.getPlayEndType((t=>{if(t&&t.data){const e=t.data.playEndType;this.topBarVM.needShowPlayEndCloseBtn=this.topBarVM.isCloseBtnHide()&&1==e?2:1}else this.topBarVM.needShowPlayEndCloseBtn=1}))})):this.topBarVM.needShowPlayEndCloseBtn=1,this.registerLifeStatusListener(),this.registerProgressListener(),this.registerSceneChangeListener()}handleClose(t){gt(this.adInfo)&&ei.reportLivePlaySecond(this.playerVM.currentPlaybackTime),ke.closeVideo(t)}registerSceneChangeListener(){ke.registerSceneChangeListener((t=>{t.data&&1==t.data.scene&&(this.topBarVM.hasShowPlayend=!0,this.topFloorVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0)}))}registerProgressListener(){this.updateActionText(this.adInfo.adBaseInfo.adActionDescription||"立即下载"),Le.isSupportDownloadProgressListen()&&Y(this.adInfo)&&ke.registerProgressListener((t=>{if(this.ecCardViewModel&&this.ecCardViewModel.updateProgressListener(t),t.result){const{status:e,progress:i,totalBytes:n}=t.data;this.callerContext.downloadState=e,this.downloadState=e,this.rotateVM.downloadState=e,this.playEndCardVM.downloadState=e,this.playEndCardVM.webViewVM.currentDownloadProgress=t.data;let s=Ji.newInstance(e,i,n);if(this.mLifeCycleHelper.isFocus()&&this.downloadPopupVM.updateDownloadProgress(s),2===e)this.pushCardVM.isShowEnd||(this.pushCardVM.isShowEnd=!0);this.bottomBarVM.downloadChangeEvent=s;let a=this.bottomBarVM.downloadChangeEvent.obtainActionButtonText(this.adInfo);this.updateActionText(a)}}))}registerLifeStatusListener(){ke.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&this.updateLifeStatus(e)}})),ke.registerFocusListener((t=>{if(t.result&&t.data){const e=t.data.windowFocusEvent;this.mLifeCycleHelper.updateWindowFocusChangeEvent(e),this.playEndCardVM.focusChangeEvent=e,this.checkShakeVM()}}))}showPlayEnd(){this.updateLifeStatus("showEnd"),this.topBarVM.hasShowPlayend=!0,this.callerContext.hasShowPlayend=!0}updateActionText(t){this.bottomBarVM.actionText=t}updateLifeStatus(t){if("showEnd"==t&&!this.hasReportShow){this.hasReportShow=!0;let t=null,e=Qe.createFullscreenCommonInstance(this.adInfo);e&&(t={clientExtData:JSON.stringify(e)}),ei.expose(t)}this.lifeStatus=t,this.bottomBarVM.lifeStatus=t,this.playerVM.lifeStatus=t,this.playEndCardVM.lifeStatus=t,this.pushCardVM.lifeStatus=t,this.callerContext.lifeStatus=t,this.mLifeCycleHelper.updateLifecycleStatus(t),this.checkShakeVM()}checkShakeVM(){this.mLifeCycleHelper.isFocusAndVisible()&&!this.playerVM.isDialogShowing()?(this.rotateVM.canRotateConvert=!0,this.callerContext.pageFocusAndVisible=!0,this.rotateVM.isStartSensor=!0):(this.callerContext.pageFocusAndVisible=!1,this.rotateVM.canRotateConvert=!1,this.rotateVM.isStartSensor=!1)}getSideMargin(){return he()&&1==this.screenOrientation?48:0}getTopMargin(){return 0==this.screenOrientation&&he()?48:20}canPushCard(){return!0}pushCardDelayTime(){return 5}isShowSkipRightNow(){let t=null;try{t=this.adInfo.adStyleConfInfo.fullScreenSkipShowTime}catch(e){}return null!=t&&null!=t||(t=5),t<=0}checkDataValid(){return!!this.adInfo}showShakeAndRotateDirectlyAtBottom(){return this.topFloorVM.enableShowGiftBoxView()}isValidPlayable(){return yt(this.adInfo,this.screenOrientation)}isPlayableRenderSuccess(){return this.playableCardVM.playableVM.renderSuccess}playableOrientationNotMatch(){try{if(!me(this.adInfo.adConversionInfo.playableUrl))return!1;const t=this.adInfo.adConversionInfo.playableStyleInfo.playableOrientation;if(0==this.screenOrientation&&2==t||1==this.screenOrientation&&1==t)return!0}catch(t){}return!1}canAutoShowAndroidMarket(){if(!Le.supportMinimumTKVersion("5.0.9"))return!1;try{const t=this.adInfo.adBaseInfo.appPackageName;if(Le.isAndroid()&&Y(this.adInfo)&&this.adInfo.adConversionInfo.autoJumpAppMarketSwitch&&!to.isPkgInstalled(t))return!0}catch(t){}return!1}openAppMarket(){ei.reportClick(this.adInfo,null,{itemClickType:t.AUTO_CLICK_OTHER_AREA,renderContainer:1,triggerType:8});let e=new Me(this.adOriginInfo,this.deviceInfo,this.configInfo);oo.openMiAppStore(e,(t=>{t||oo.openAppMarket(e,(t=>{}))}))}reportPlayEndImpression(){let t=new b;this.canAutoShowAndroidMarket()&&(t.universe_feature_freq=16);let e={elementType:87,clientExtData:JSON.stringify(t)};ei.log(140,null,e)}}class er extends Fi{constructor(e){super(e),this.style={width:"100%",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",paddingLeft:16,paddingRight:16,paddingBottom:16},this.logoView=new Vi(1,this.vm.adInfo),this.logoView.style={marginLeft:0,marginBottom:6},this.bottomContainer=new TKView,this.bottomContainer.style={width:"100%",backgroundColor:"#FFFFFF",height:82,paddingLeft:12,paddingRight:12,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:12},1==this.vm.screenOrientation&&(this.style={width:this.vm.containerLimit.height+20}),this.appendChild(this.logoView),this.appendChild(this.bottomContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),this.bottomContainer.appendChild(this.appIcon);let i=new TKView;if(i.style={height:55,width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",flexWrap:"no-wrap",flexShrink:1},this.bottomContainer.appendChild(i),this.nameLabel=new TKText,this.nameLabel.style={fontSize:15,color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},i.appendChild(this.nameLabel),this.vm.isDownloadAd()){this.nameLabel.setText(this.vm.getAdTitle());const e=new TKView;if(e.style={flexDirection:"column"},i.appendChild(e),this.vm.getAppScore()>=30||me(this.vm.getAppDownloadCountDesc())){if(this.vm.getAppScore()>=30){const i=this.vm.getAppScore();this.scoreView=new bi(i),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),e.appendChild(this.scoreView)}if(me(this.vm.getAppDownloadCountDesc())){let i=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(i=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",marginLeft:0,marginTop:5},this.downloadCountLabel.setText(i),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),e.appendChild(this.downloadCountLabel)}}else this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}))}else this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),i.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));this.actionBtn=new Ri(this.vm.adInfo,{borderRadius:18,height:36,width:88}),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomContainer.appendChild(this.actionBtn),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),this.actionBtn.setOnTapListener((e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.nameLabel&&Nt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.descLabel&&Nt(this.descLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.actionBtn&&Nt(this.actionBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),this.bottomContainer&&Nt(this.bottomContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback(),this.addCardDynamic(),this.vm.reportOptimalCardImpression()}getHeight(){return 120}addCardDynamic(){if(this.bottomContainer&&this.actionBtn){const t=this.bottomContainer.style;t.bottom=16,t.left=16,t.position="absolute",this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtn,t):this.addCardDynamicEffects(this.bottomContainer,this.actionBtn,t)}}stopActionAnimation(){this.pauseActionAnimation()}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&this.addCardDynamic()}}class ir extends Fi{constructor(e){super(e);let i=1==this.vm.screenOrientation;this.cardDelayShowTime=3,this.cardHeight=130,this.style={width:Le.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16,bottom:-56},i&&(this.style={width:this.vm.containerLimit.height+20}),this.bottomContainerConver=new TKView,this.bottomContainerConver.style={opacity:0,backgroundColor:"#FFFFFF",position:"absolute",borderRadius:12,left:0,right:0,height:this.cardHeight,bottom:-146},this.bottomContainer=new TKView,this.bottomContainer.style={height:this.cardHeight+16,width:"100%",paddingBottom:16,borderRadius:12,paddingLeft:12,paddingRight:12,paddingTop:12,marginTop:4,flexDirection:"column",alignItems:"flex-start"},this.appendChild(this.bottomContainer),this.bottomContainer.appendChild(this.bottomContainerConver);const n=new TKView;n.style={flexDirection:"row",width:"100%"},this.bottomContainer.appendChild(n),this.textContainer=new TKView,this.textContainer.style={width:"100%",height:58,justifyContent:"center",paddingLeft:70,flexDirection:"column"},n.appendChild(this.textContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),n.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={width:"100%",height:24,alignItems:"center",flexDirection:"row"},this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={marginLeft:10},this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,textAlign:"center",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",flexShrink:1},this.nameContainer.appendChild(this.nameLabel),this.nameContainer.appendChild(this.logoView),this.textContainer.appendChild(this.nameContainer),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={marginTop:4,textLineClamp:1,fontSize:14,color:"#FFFFFF",textOverflow:"ellipsis"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),this.textContainer.appendChild(this.descLabel),this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={marginTop:8,flexDirection:"column",justifyContent:"center",width:"100%",height:40,alignItems:"center",opacity:0},this.bottomContainer.appendChild(this.bottomBtnContainer),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={backgroundColor:"#FFFFFF",opacity:.2,justifyContent:"center",height:40,width:"100%",borderRadius:20},this.bottomBtnContainer.appendChild(this.actionBtnContainer),this.actionBtn=new Ri(this.vm.adInfo,{width:"100%",height:40,borderRadius:20}),this.actionBtn.style={position:"absolute",left:0,right:0,top:0,bottom:0},fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomBtnContainer.appendChild(this.actionBtn),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),this.actionBtn.setOnTapListener((e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.actionBtn,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.bottomContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation(),this.vm.reportOptimalCardImpression()}startActionAnimation(){setTimeout((()=>{this.animationAllowed=!0,this.animationAllowed&&this.addActionTranslateAnim()}),1e3*this.cardDelayShowTime),Le.isAndroid()||this.vm.supportNewAnimation()||this.resetIOSFrame()}resetIOSFrame(){setTimeout((()=>{this.style={bottom:0},this.bottomContainerConver.style={height:this.cardHeight+16,bottom:15}}),1e3*this.cardDelayShowTime+4500)}addActionTranslateAnim(){this.vm.supportNewAnimation()?this.updateBottom(this,-48,"translate"):this.addTranslateAction(this,Le.isAndroid()?0:8,Le.isAndroid()?-48:8,"translate");let t=new TKKeyframeAnimation;t.animType="opacity",t.keyframes=[{percent:0,value:1,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}],t.duration=500,t.on("end",(t=>{setTimeout((()=>{this.actionBtnContainer.style={backgroundColor:"#FE3666"},this.addActionAlphaAnim(this.actionBtnContainer,Le.isAndroid()?.2:1,1,"actionBtnContainerColorOpacity",500,1500,(t=>{this.addActionInfoAndBgChangeAnim()}))}),1500)})),this.bottomBtnContainer.addAnimation(t,"bottomBtnContainerOpacity")}updateAppInfoColor(){this.nameLabel.style={color:"#222222"},this.descLabel.style={color:"#666666"},this.logoView.setTitleColor("#D3D3D3"),this.nameContainer.style={width:"100%",height:24,alignItems:"center",flexDirection:"row"},this.textContainer.style={width:"100%",height:58,justifyContent:"center",paddingLeft:70,flexDirection:"column"}}addActionInfoAndBgChangeAnim(){this.vm.supportNewAnimation()?(this.updateBottom(this,-56,"infotranslate"),this.updateBottom(this.bottomContainerConver,-162,"bottomContainerConverTranslate")):(this.addTranslateAction(this,Le.isAndroid()?-48:0,Le.isAndroid()?-56:0,"infotranslate"),this.addTranslateAction(this.bottomContainerConver,0,Le.isAndroid()?-162:0,"bottomContainerConverTranslate",500)),this.addActionAlphaAnim(this.bottomContainerConver,Le.isAndroid()?0:1,1,"cardOpacity"),setTimeout((()=>{this.updateAppInfoColor(),this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300),setTimeout((()=>{this.addCardDynamic()}),500)}addActionAlphaAnim(t,e,i,n,s=500,a=0,o=void 0){let r=new TKKeyframeAnimation;r.animType="opacity",r.keyframes=[{percent:0,value:e,easing:"EaseInEaseOut"},{percent:1,value:i,easing:"EaseInEaseOut"}],r.duration=s,r.on("end",(t=>{o&&setTimeout((()=>{o(t)}),a)})),t&&t.addAnimation(r,n)}addTranslateAction(t,e,i,n,s=500){let a=new TKKeyframeAnimation;a.animType="position",a.keyframes=[{percent:0,value:{x:0,y:e},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:i},easing:"EaseInEaseOut"}],a.duration=s,t&&t.addAnimation(a,n)}updateBottom(t,e,i,n=500){const s=new TKBasicAnimation;s.setEndValue((()=>{t.style={transform:{translate:{y:e}}}})),s.duration=n,t&&t.addAnimation(s,i)}stopActionAnimation(){this.animationAllowed=!1,this&&this.removeAllAnimation(),this.pauseActionAnimation()}addCardDynamic(){if(this.bottomContainer&&this.actionBtn){const t=this.bottomContainer.style;this.bottomContainerConver.clipChildren=!1,t.bottom=16,t.left=16,t.position="absolute",t.height=this.cardHeight,t.backgroundColor="#FFFFFF",this.clipChildren=!1,this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtn,t):this.addCardDynamicEffects(this.bottomContainer,this.actionBtn,t)}}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&this.addCardDynamic()}getHeight(){return this.cardHeight+20}}class nr extends Fi{constructor(e){super(e),this.moveHeight=-80;let i=1==this.vm.screenOrientation;this.cardDelayShowTime=5,this.style={width:Le.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",bottom:-80},this.logoView=new Vi(1,this.vm.adInfo),this.logoView.style={marginLeft:12,marginBottom:12};const n=new TKView;n.style={backgroundColor:"#FFFFFF",height:80,width:"100%",paddingLeft:16,paddingRight:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},i&&(this.moveHeight=-96,this.style={width:this.vm.containerLimit.height+20,paddingLeft:16,paddingRight:16,paddingBottom:16,bottom:-96},this.logoView.style={marginLeft:0,marginBottom:6},n.style={paddingLeft:12,paddingRight:12,borderRadius:12}),this.appendChild(this.logoView),this.appendChild(n);const s=new TKView;s.style={flexDirection:"row",flexShrink:1},n.appendChild(s);this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),s.appendChild(this.appIcon);const a=new TKView;if(a.style={marginLeft:12,height:55,flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around",alignSelf:"center",flexWrap:"no-wrap",flexShrink:1,marginRight:8},s.appendChild(a),this.nameLabel=new TKText,this.nameLabel.style={fontSize:15,color:"#222222",flexWrap:"no-wrap",textLineClamp:1,textOverflow:"ellipsis"},a.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.vm.isDownloadAd()){this.nameLabel.setText(this.vm.getAdTitle());const e=new TKView;if(e.style={flexDirection:"column"},a.appendChild(e),this.vm.getAppScore()>=30||me(this.vm.getAppDownloadCountDesc())){if(this.vm.getAppScore()>=30){const i=this.vm.getAppScore();this.scoreView=new bi(i),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),e.appendChild(this.scoreView)}if(me(this.vm.getAppDownloadCountDesc())){let i=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(i=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",marginLeft:0,marginTop:5},this.downloadCountLabel.setText(i),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),e.appendChild(this.downloadCountLabel)}}else this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},this.descLabel.setText(this.vm.getAdDescription()),e.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}))}else this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),a.appendChild(this.descLabel),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)}));this.rightContainer=new TKView,this.rightContainer.style={flexDirection:"column",justifyContent:"center",alignItems:"center"},n.appendChild(this.rightContainer),this.actionBtn=new Ri(this.vm.adInfo,{width:88,height:36,borderRadius:18}),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.rightContainer.appendChild(this.actionBtn);const o=new TKView;o.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.rightContainer.appendChild(o),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),o.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),n.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(o,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(n,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation()}startActionAnimation(){const t=this.vm.supportNewAnimation();setTimeout((()=>{if(this.animationAllowed=!0,!this.animationAllowed)return;let e=null;if(t){const t=new TKBasicAnimation;t.setEndValue((()=>{this.style={transform:{translate:{y:this.moveHeight}}}})),e=t}else{const t=new TKKeyframeAnimation;t.animType="position",t.keyframes=[{percent:0,value:{x:0,y:0},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:Le.isAndroid()?this.moveHeight:0},easing:"EaseInEaseOut"}],e=t}e.duration=500,this.addActionTranslateAnim(e)}),1e3*this.cardDelayShowTime),Le.isAndroid()||t||this.resetIOSFrame()}resetIOSFrame(){setTimeout((()=>{this.style={bottom:0}}),1e3*this.cardDelayShowTime+500)}addActionTranslateAnim(t){this&&(this.addAnimation(t,"translate"),t.on("end",(t=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()})))}getHeight(){return 0==this.vm.screenOrientation?108:118}}class sr extends Fi{constructor(e){super(e),this.cardDelayShowTime=5;let i=1==this.vm.screenOrientation,n=this.vm.getAdTagList();this.hasTags=n&&n.length>0,this.hasScore=this.vm.getAppScore()>=30,this.hasDownloadCountDesc=Y(this.vm.adInfo)&&me(this.vm.getAppDownloadCountDesc())&&this.vm.isValidDownloadCardInfo(),this.cardHeight=this.hasScore||this.hasTags?156:136,this.style={width:Le.isAndroid()?"100%":this.vm.containerLimit.width,flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16,bottom:-1*(this.cardHeight+16)},i&&(this.style={width:this.vm.containerLimit.height+20}),this.logoView=new Vi(1,this.vm.adInfo),this.logoView.style={marginBottom:10},this.appendChild(this.logoView),this.bottomContainer=new TKView,this.bottomContainer.style={backgroundColor:"#FFFFFF",height:this.cardHeight,width:"100%",paddingLeft:12,paddingRight:12,paddingTop:12,flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,borderRadius:12},this.appendChild(this.bottomContainer);const s=new TKView;s.style={flexDirection:"row",width:"100%",position:"relative"},this.bottomContainer.appendChild(s);const a=new TKView;if(a.style={width:"100%",height:58,paddingLeft:70,flexDirection:"column",justifyContent:"space-around"},s.appendChild(a),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:.5},this.appIcon.setSrc(this.vm.getAdIcon()),s.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={fontSize:21,color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},a.appendChild(this.nameLabel),this.nameLabel.setText(this.vm.getAdTitle()),this.descLabel=new TKText,this.descLabel.style={textLineClamp:1,fontSize:14,color:"#666666",textOverflow:"ellipsis"},Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription),this.descLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_COMMENT_CLICK)})),this.hasScore||this.hasTags||this.hasDownloadCountDesc){let e=!1;const i=new TKView;if(i.style={flexDirection:"row",width:"100%",height:18,marginTop:6,position:"relative"},a.appendChild(i),this.hasDownloadCountDesc){let e=this.vm.getAppDownloadCountDesc();this.vm.isValidDownloadCardInfo()&&(e=this.vm.getAppDownloadCountDesc()+this.vm.downloadCardDataInfo.appDownloadDescText),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={fontSize:15,color:"#666666",left:0,bottom:1.5,marginRight:6,flexGrow:1},this.downloadCountLabel.setText(e),this.downloadCountLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK)})),i.appendChild(this.downloadCountLabel)}else if(this.hasScore){e=!0;const n=this.vm.getAppScore();this.scoreView=new bi(n),this.scoreView.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_APP_STORE_CLICK)})),this.scoreView.style={width:75,position:"absolute",left:0,bottom:3.5},i.appendChild(this.scoreView)}this.hasTags&&(this.tagView=new us(n),this.tagView.style={paddingLeft:e?80:0},i.appendChild(this.tagView)),this.bottomContainer.appendChild(this.descLabel)}else a.appendChild(this.descLabel);this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={flexDirection:"column",justifyContent:"center",width:"100%",height:40,marginBottom:12,alignItems:"center"},this.bottomContainer.appendChild(this.bottomBtnContainer),this.actionBtn=new Ri(this.vm.adInfo,{width:"100%",height:40,borderRadius:20}),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)})),this.bottomBtnContainer.appendChild(this.actionBtn);const o=new TKView;o.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.bottomBtnContainer.appendChild(o),this.appIcon&&this.appIcon.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_ICON_NAME_CLICK)})),o.addEventListener("tap",(e=>{this.convert(1,{x:e.position.rawX,y:e.position.rawY},t.CARD_ACTION_BAR_CLICK)})),this.bottomContainer.addEventListener("tap",(e=>{this.convert(2,{x:e.position.rawX,y:e.position.rawY},t.CARD_BLANK_AREA_CLICK)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.nameLabel,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(o,(()=>{this.convert(1,{x:0,y:0},t.CARD_SWIPE_CONVERT)})),Nt(this.bottomContainer,(()=>{this.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT)}))),this.startActionAnimation(),this.vm.reportOptimalCardImpression()}startActionAnimation(){const t=this.vm.supportNewAnimation();setTimeout((()=>{if(this.animationAllowed=!0,!this.animationAllowed)return;let e=null;if(t){const t=new TKBasicAnimation;t.setEndValue((()=>{this.style={transform:{translate:{y:-1*(this.cardHeight+16)}}}})),e=t}else{const t=new TKKeyframeAnimation;t.animType="position",t.keyframes=[{percent:0,value:{x:0,y:0},easing:"EaseInEaseOut"},{percent:1,value:{x:0,y:Le.isAndroid()?-(this.cardHeight+16):0},easing:"EaseInEaseOut"}],e=t}e.duration=800,this.addActionTranslateAnim(e)}),1e3*this.cardDelayShowTime),Le.isAndroid()||t||this.resetIOSFrame()}resetIOSFrame(){setTimeout((()=>{this.style={bottom:0}}),1e3*this.cardDelayShowTime+800)}addActionTranslateAnim(t){this&&(this.addAnimation(t,"translate"),t.on("end",(t=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback(),this.addCardDynamic()})))}getHeight(){return this.cardHeight+16+10+16}addCardDynamic(){if(this.bottomContainer&&this.actionBtn){const t=this.bottomContainer.style;t.bottom=0,t.left=16,t.position="absolute",this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtn,t):this.addCardDynamicEffects(this.bottomContainer,this.actionBtn,t)}}stopActionAnimation(){this.pauseActionAnimation()}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&this.addCardDynamic()}}class ar extends Fi{constructor(t){super(t),this.animationAllowed=!1,this.cardHeight=152,this.setupViews(),this.setupData(),this.setupActions(),this.setupAnimation(),this.vm.reportConductCardImpression(this.getTemplateShowType()),fi(this.vm.$attrsPath.lifeStatus,(t=>{this.lifeStatus=t,"pageVisiable"==t&&this.resumeAnim(),"pageInvisiable"==t&&this.pauseAnim(),"hideEnd"==t&&this.stopAnim()}))}setupViews(){this.style={width:this.getWidth(),height:this.getHeight(),flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",position:"absolute",bottom:0,paddingLeft:12,paddingRight:12,paddingBottom:8},this.bottomContainer=new TKView,this.bottomContainer.style={height:110,width:"100%",opacity:0,flexDirection:"column",alignItems:"flex-start"},this.appendChild(this.bottomContainer),this.appInfoContainer=new TKView,this.appInfoContainer.style={top:this.getTopDistance(),position:"absolute",flexDirection:"row",width:"100%"},this.bottomContainer.appendChild(this.appInfoContainer),this.textContainer=new TKView,this.textContainer.style={width:"100%",height:58,justifyContent:"center",paddingLeft:70,flexDirection:"column"},this.appInfoContainer.appendChild(this.textContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,position:"absolute",top:0,left:0,borderRadius:12,marginRight:12,borderColor:"#EAEAEA",borderWidth:1},this.appInfoContainer.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={width:"100%",height:21,alignItems:"center",flexDirection:"row"},this.textContainer.appendChild(this.nameContainer),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,fontWeight:"500",textAlign:"left",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",marginRight:8,flexShrink:2,flexGrow:2},this.nameContainer.appendChild(this.nameLabel),this.logoView=new Vi(0,this.vm.adInfo),this.nameContainer.appendChild(this.logoView),this.descLabel=new TKText,this.descLabel.style={marginTop:8,textLineClamp:1,fontSize:14,color:"#FFFFFFCC",textOverflow:"ellipsis"},this.textContainer.appendChild(this.descLabel),this.bottomBtnContainer=new TKView,this.bottomBtnContainer.style={bottom:0,position:"absolute",flexDirection:"column",justifyContent:"center",width:"100%",height:40,alignItems:"center",opacity:0},this.bottomContainer.appendChild(this.bottomBtnContainer),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={backgroundColor:"#FFFFFF",opacity:.2,justifyContent:"center",height:40,width:"100%",borderRadius:20},this.bottomBtnContainer.appendChild(this.actionBtnContainer),this.actionBtn=new Ri(this.vm.adInfo,{width:"100%",height:40,right:0,borderRadius:20,backgroundColor:"#FFFFFF00"}),this.actionBtn.style={position:"absolute",left:0,right:0,top:0,bottom:0},this.bottomBtnContainer.appendChild(this.actionBtn),Le.supportMinimumTKVersion("5.0.0")&&(this.sweepView=new RoundRectView,this.sweepView.style={left:0,right:0,top:0,bottom:0,borderRadius:20,position:"absolute"},this.sweepView.throughHitTest=!0,this.bottomBtnContainer.appendChild(this.sweepView))}setupData(){Ve(this.appIcon,this.vm.getAdIcon()),this.nameLabel.setText(this.vm.getAdTitle()),Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)}))}setupActions(){let e=new b;e.template_show_type=this.getTemplateShowType(),this.appIcon&&this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.nameLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.actionBtn,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}setupAnimation(){setTimeout((()=>{this.animationAllowed||(this.animationAllowed=!0,this.addAlphaAnim(this.bottomContainer,"opacityAnimation",(t=>{this.cardTranslateAnim(),this.addBottomActionAlphaAnim()}),250,750))}),4e3)}addAlphaAnim(t,e,i=void 0,n=0,s=0,a=0,o=1,r="#FFFFFF00",h="#FFFFFF00"){if("hideEnd"==this.lifeStatus)return;if(!n)return t.style={opacity:o,backgroundColor:h},void(i&&setTimeout((()=>{i(!0)}),s));let l=new TKBasicAnimation;l.timingFunction="Linear",l.setStartValue((()=>{t.style={opacity:a,backgroundColor:r}})),l.setEndValue((()=>{t.style={opacity:o,backgroundColor:h}})),l.duration=n,l.on("end",(t=>{i&&setTimeout((()=>{i(t)}),s)})),t&&t.addAnimation(l,e)}addBottomActionAlphaAnim(){this.addAlphaAnim(this.bottomBtnContainer,"bottomOpacityAnimation",(t=>{this.addActionColorAlphaAnim(),setTimeout((()=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300)}),330,670)}addActionColorAlphaAnim(){this.addAlphaAnim(this.actionBtnContainer,"colorAlphaAnimation",(t=>{this.addActionScaleAnim()}),400,3670,.2,1,"#FFFFFF","#FE3666")}cardTranslateAnim(){if("hideEnd"==this.lifeStatus)return;const t=new TKBasicAnimation;t.setEndValue((()=>{this.appInfoContainer.style={transform:{translate:{y:-52}}}})),t.duration=400,this.appInfoContainer.addAnimation(t,"translate")}addActionScaleAnim(){let t=_i(this.bottomBtnContainer,.95,500,2,this.vm.supportNewAnimation());this.bottomBtnContainer.addAnimation(t,"actionBtnScale"),t.on("end",(()=>{Le.supportMinimumTKVersion("5.0.0")?this.addSweepAnim():setTimeout((()=>{this.addActionScaleAnim()}),1e3)}))}addSweepAnim(){this.sweepImage&&this.sweepView&&this.sweepView.removeChild(this.sweepImage);const t=this.bottomBtnContainer.getSize(),e=204*t.height/80;this.sweepImage=new TKImage,this.sweepImage.style={width:e,height:t.height,left:-e,top:0,position:"absolute"},Ve(this.sweepImage,"ksad_video_bottom_sweep_light.png"),this.sweepView&&this.sweepView.appendChild(this.sweepImage);let i=xi(500,Number(t.width)+2*e);this.sweepImage.addAnimation(i,"sweepAnim"),i.on("end",(()=>{setTimeout((()=>{this.addActionScaleAnim()}),1e3)}))}stopActionAnimation(){this.animationAllowed=!1,this&&this.removeAllAnimation()}getHeight(){return this.cardHeight}getWidth(){return 0==this.vm.screenOrientation?this.vm.containerLimit.width:this.vm.containerLimit.height}getTopDistance(){return 52}getTemplateShowType(){return"gradient_weak_card"}pauseAnim(){this.sweepImage&&this.sweepView&&this.sweepImage.removeAllAnimation(),this.bottomBtnContainer&&this.bottomBtnContainer.removeAllAnimation()}resumeAnim(){this.bottomBtnContainer&&this.addActionScaleAnim()}stopAnim(){this.pauseAnim(),this.removeAllAnimation()}}class or extends ar{setupAnimation(){this.animationAllowed||(this.animationAllowed=!0,this.addAlphaAnim(this.bottomContainer,"opacityAnimation",(t=>{this.addBottomActionAlphaAnim()})))}addBottomActionAlphaAnim(){this.addAlphaAnim(this.bottomBtnContainer,"bottomOpacityAnimation",(t=>{this.addActionColorAlphaAnim(),setTimeout((()=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300)}))}addActionColorAlphaAnim(){this.addAlphaAnim(this.actionBtnContainer,"colorAlphaAnimation",(t=>{this.addActionScaleAnim()}),0,4e3,.2,1,"#FFFFFF","#FE3666")}getTopDistance(){return 0}getTemplateShowType(){return"continued_weak_card"}}class rr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData(),this.setupActions()}setupViews(){this.style={width:"100%",height:116,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appIconContainer=new TKView,this.appIconContainer.style={top:0,width:58,height:58,borderRadius:12,borderColor:"#FFFFFF",borderWidth:1,position:"absolute"},this.appendChild(this.appIconContainer),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:12,top:0,left:0,position:"absolute"},this.appIconContainer.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={width:"100%",height:21,top:66,alignItems:"center",justifyContent:"center",position:"absolute"},this.appendChild(this.nameContainer),this.nameLabel=new TKText,this.nameLabel.style={fontSize:17,color:"#FFFFFF",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"500"},this.nameContainer.appendChild(this.nameLabel),this.textContainer=new TKView,this.textContainer.style={width:"100%",height:21,bottom:0,position:"absolute",alignItems:"center",justifyContent:"center"},this.appendChild(this.textContainer),this.descLabel=new TKText,this.descLabel.style={fontSize:14,color:"#FFFFFFCC",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"400"},this.textContainer.appendChild(this.descLabel)}setupData(){Ve(this.appIcon,this.vm.getAdIcon()),this.nameLabel.setText(this.vm.getAdTitle()),Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,"")}setupActions(){let e=new b;e.template_show_type=this.getTemplateShowType(),this.appIcon&&this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.nameLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.descLabel,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}getTemplateShowType(){return"info_arc_card"}}class hr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData()}setupViews(){this.style={width:"100%",height:22,justifyContent:"center",alignItems:"center"},this.actionBarLabel=new TKText,this.actionBarLabel.style={fontSize:16,color:"#FFFFFF99",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"500"},this.appendChild(this.actionBarLabel)}setupData(){this.actionBarLabel.setText(this.getAdActionDesc())}getAdActionDesc(){return"上滑或点击"+ft(this.vm.adInfo)}getTemplateShowType(){return"all_arc_card"}}class lr extends Fi{constructor(t){super(t),this.animationAllowed=!1,this.cardType=this.vm.getActionBarStyle(),this.setupViews(),this.setupDatas(),this.setupActions(),this.setupAnimation(),this.vm.reportConductCardImpression(this.templateShowType),fi(this.vm.$attrsPath.lifeStatus,(t=>{this.lifeStatus=t,"pageVisiable"==t&&this.resumeAnim(),"pageInvisiable"==t&&this.pauseAnim(),"hideEnd"==t&&this.stopAnim()}))}setupViews(){this.style={width:this.getWidth(),height:this.getHeight(),flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",bottom:-this.getHeight()},this.setupSubViews()}setupSubViews(){let t;this.arcViewContainer=new TKView,this.arcViewContainer.style={width:"100%",height:this.getArcViewHeight(),bottom:0,justifyContent:"center",alignItems:"center",position:"absolute"},this.appendChild(this.arcViewContainer),Le.supportMinimumTKVersion("5.0.0")&&(this.arcView=new TKLottieImageView,this.arcView.style={width:this.getArcViewWidth(),height:"100%",bottom:0,position:"absolute"},ce()||this.arcView.setResize("center"),this.arcViewContainer.appendChild(this.arcView)),this.arrowViewContainer=new TKView,this.arrowViewContainer.style={width:"100%",height:33,top:this.arrowViewTop(),opacity:0,justifyContent:"center",alignItems:"center",position:"absolute"},this.appendChild(this.arrowViewContainer),Le.supportMinimumTKVersion("5.0.0")&&(this.arrowView=new TKLottieImageView,this.arrowView.style={width:23,height:33},this.arrowViewContainer.appendChild(this.arrowView)),this.isElementCard()&&(this.callText=new TKText,this.callText.style={width:"100%",height:"17",top:76,fontSize:12,color:"#FFFFFF99",flexShrink:1,textLineClamp:1,textAlign:"center",textOverflow:"ellipsis",fontWeight:"500",position:"absolute"},this.appendChild(this.callText),this.callText.setText("上滑或点击"+ft(this.vm.adInfo))),this.actionbarView=new TKView,this.actionbarView.style={width:"100%",height:"100%",top:0,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",position:"absolute",paddingLeft:16,paddingRight:16},this.appendChild(this.actionbarView),t=this.isElementCard()?new rr(this.vm):new hr(this.vm),this.templateShowType=t.getTemplateShowType(),t.style={width:"100%",top:this.getPaddingTop()},this.actionbarView.appendChild(t),this.logoView=new Vi(1,this.vm.adInfo),this.logoView.style={left:16,bottom:16,position:"absolute"},this.appendChild(this.logoView)}setupDatas(){Le.supportMinimumTKVersion("5.0.0")&&(this.isElementCard()?this.arcView.setUri(Ae("neo_info_element_arc_style.json")):this.arcView.setUri(Ae("neo_all_arc_element_style.json")),this.arrowView.setUri(Ae("neo_arc_arrow.json")))}setupActions(){let e=new b;e.template_show_type=this.templateShowType,this.addEventListener("tap",(i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&Nt(this,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))}setupAnimation(){setTimeout((()=>{this.cardTranslateAnim()}),4e3)}addTranslateAnim(t,e,i,n=void 0,s=500,a=500){if("hideEnd"==this.lifeStatus)return;let o=new TKBasicAnimation;o.timingFunction="Linear",o.setEndValue((()=>{t.style={transform:{translate:{y:i}}}})),o.duration=a,o.on("end",(t=>{n&&setTimeout((()=>{n(t)}),s)})),t&&t.addAnimation(o,e)}cardTranslateAnim(){this.addTranslateAnim(this,"arcCardTranslate",-this.getHeight(),(t=>{this.arrowAlphaAnim(),this.arrowTranslateUpAnim(),this.arcView.play(),this.arcView.setLoop(!0),setTimeout((()=>{this.vm.isAnimFinishCallback&&this.vm.isAnimFinishCallback()}),300)}))}arrowTranslateUpAnim(){this.addTranslateAnim(this.arrowViewContainer,"arrowTranslateUp",-9,(t=>{this.arrowTranslateDownAnim()}),0)}arrowTranslateDownAnim(){this.addTranslateAnim(this.arrowViewContainer,"arrowTranslateUp",0,(t=>{this.arrowView.play(),this.arrowView.setLoop(!0)}),800)}arrowAlphaAnim(){let t=new TKBasicAnimation;t.timingFunction="Linear",t.setStartValue((()=>{this.arrowViewContainer.style={opacity:0}})),t.setEndValue((()=>{this.arrowViewContainer.style={opacity:1}})),t.duration=500,this.arrowViewContainer.addAnimation(t,"arrowViewOpacity")}pauseAnim(){this.arcView&&this.arcView.pause(),this.arrowView&&this.arrowView.pause()}resumeAnim(){this.arcView&&this.arcView.resume(),this.arrowView&&this.arrowView.resume()}stopAnim(){this.arcView&&this.arcView.stop(),this.arrowView&&this.arrowView.stop(),this.arcViewContainer&&this.arcViewContainer.removeAllAnimation(),this.arrowViewContainer&&this.arrowViewContainer.removeAllAnimation(),this.removeAllAnimation()}getWidth(){return this.vm.containerLimit.width}getHeight(){return this.isElementCard()?263:150}getArcViewWidth(){return this.isElementCard()?700:550}getArcViewHeight(){return this.isElementCard()?263:150}arrowViewTop(){return this.isElementCard()?44:38}getPaddingTop(){return this.isElementCard()?106:79}isElementCard(){return 15===this.cardType}}class dr extends TKView{constructor(t){super(),this.hasTags=!1,this.vm=t,this.setupViews(),this.setupData(),this.setupActions()}setupViews(){this.style={width:"100%",height:40,flexDirection:"row"},this.appIcon=new TKImage,this.appIcon.style={width:40,height:40,marginLeft:0,borderRadius:4},this.appendChild(this.appIcon),this.nameContainer=new TKView,this.nameContainer.style={flexDirection:"column",justifyContent:"center",alignItems:"flex-start",width:204,height:40,marginLeft:8},this.appendChild(this.nameContainer),this.setupNameContainer(),this.logoView=new Vi(0,this.vm.adInfo),this.logoView.style={right:0,bottom:0,position:"absolute"},this.appendChild(this.logoView)}setupNameContainer(){var t;let e=null===(t=this.vm.getAdTagList())||void 0===t?void 0:t.slice(0,2);this.hasTags=!Ce(e)&&e&&e.length>0,this.nameLabel=new TKText,this.nameLabel.style={fontSize:this.hasTags?14:17,fontWeight:"500",textAlign:"left",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",marginLeft:0,shadow:"1 1 1 #000000CC"},this.nameContainer.appendChild(this.nameLabel),this.hasTags&&(this.tagView=new us(e,gs.create({tagViewStyle:3,height:20,tagBorderRadius:4,tagFontSize:10,customBackgroundColor:"#FFFFFF33",customTextColor:"#FFFFFF",customShadowColor:"1 1 1 #00000040"})),this.tagView.style={marginTop:2},this.nameContainer.appendChild(this.tagView))}setupData(){Ve(this.appIcon,this.vm.getAdIcon()),this.nameLabel.setText(this.vm.getAdTitle())}setupActions(){let e=new b;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.appIcon&&this.appIcon.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.nameLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.vm.supportSlideClick()&&(this.appIcon&&Nt(this.appIcon,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),this.nameLabel&&Nt(this.nameLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}}class cr extends Fi{constructor(t){super(t),this.vm=t,this.setupViews(),this.setupData(),this.setupActions(),setTimeout((()=>{this.cardDynamicEffectsCallback&&this.cardDynamicEffectsCallback(this.actionBtn,this.style)}),500)}setupViews(){this.style={width:"100%",height:124,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",borderRadius:8,bottom:16,position:"absolute",gradientBgColor:"0, #FFE8ED 0, #FFFFFF 1",borderWidth:.5,borderColor:"#FFFFFF33"},this.bottomContainer=new TKView,this.bottomContainer.style={marginLeft:0,marginTop:13,height:48,width:"100%",flexDirection:"row",alignItems:"center"},this.appendChild(this.bottomContainer),this.downloadInfoContainer=new TKView,this.downloadInfoContainer.style={marginLeft:0,marginTop:0,paddingLeft:11,paddingRight:4,height:48,width:88,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.downloadInfoContainer),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={marginLeft:0,marginTop:0,width:"100%",fontSize:20,fontWeight:"500",textAlign:"center",color:"#222222",textLineClamp:1,textOverflow:"ellipsis",flexShrink:2},this.downloadInfoContainer.appendChild(this.downloadCountLabel),this.downloadToastContainer=new TKView,this.downloadToastContainer.style={marginTop:4,marginLeft:0,height:15,width:"100%",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.downloadInfoContainer.appendChild(this.downloadToastContainer),this.downloadDescLabel=new TKText,this.downloadDescLabel.style={fontSize:10,textAlign:"center",color:"#666666",textLineClamp:1,flexShrink:1},this.downloadToastContainer.appendChild(this.downloadDescLabel),this.toastView=new TKView,this.toastView.style={width:14,height:10,marginLeft:0},this.downloadToastContainer.appendChild(this.toastView),this.toastTag=new TKImage,this.toastTag.style={width:10,height:10,marginLeft:0},this.toastView.appendChild(this.toastTag),this.splitView=new TKView,this.splitView.style={marginLeft:0,marginTop:0,width:1,height:48,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.splitView);const t=new TKView;t.style={marginLeft:0,marginTop:0,width:"100%",height:24,gradientBgColor:"270,#FFFFFF00 0, #6A6A6A66 1"},this.splitView.appendChild(t);let e=new TKView;e.style={marginLeft:0,marginTop:0,width:"100%",height:24,flexGrow:1,gradientBgColor:"270,#6A6A6A66 0, #FFFFFF00 1"},this.splitView.appendChild(e),this.textContainer=new TKView,this.textContainer.style={width:294,height:"100%",paddingRight:11,paddingLeft:11,flexShrink:1,justifyContent:"center",alignItems:"center"},this.bottomContainer.appendChild(this.textContainer),this.descLabel=new TKText,this.descLabel.style={width:"100%",textLineClamp:2,fontSize:14,color:"#222222",textAlign:"left",textOverflow:"ellipsis"},this.textContainer.appendChild(this.descLabel),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={justifyContent:"center",marginTop:14,paddingLeft:11,paddingRight:11,height:36,width:"100%",borderRadius:100},this.appendChild(this.actionBtnContainer),this.actionBtn=new Ri(this.vm.adInfo,{width:"100%",height:"100%",right:0,borderRadius:100,backgroundColor:"#FE3666"}),this.actionBtnContainer.appendChild(this.actionBtn)}setupData(){var t;Ve(this.toastTag,"ksad_download_card_toast_icon.png"),this.downloadCountLabel.setText(this.vm.getAppDownloadCountDesc()),Ci(this.downloadDescLabel,"text",null===(t=this.vm.$attrsPath.downloadCardDataInfo)||void 0===t?void 0:t.appDownloadDescText,""),Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)}))}setupActions(){let e=new b;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.downloadInfoContainer&&this.downloadInfoContainer.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK,e)})),this.descLabel&&this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn&&this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.toastView&&this.toastView.addEventListener("tap",(t=>{var e;Re(null===(e=this.vm.downloadCardDataInfo)||void 0===e?void 0:e.toastText)})),this.vm.supportSlideClick()&&(this.downloadInfoContainer&&Nt(this.downloadInfoContainer,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.descLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.actionBtn,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}}class pr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData(),this.setupActions(),setTimeout((()=>{this.cardDynamicEffectsCallback&&this.cardDynamicEffectsCallback(this.actionBtn,this.style)}),500)}setupViews(){this.style={width:"100%",height:124,flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",borderRadius:8,bottom:0,position:"absolute"},this.bottomContainer=new TKView,this.bottomContainer.style={marginLeft:0,marginTop:13,height:48,width:"100%",flexDirection:"row",alignItems:"center"},this.appendChild(this.bottomContainer),this.downloadInfoContainer=new TKView,this.downloadInfoContainer.style={marginLeft:0,marginTop:0,paddingLeft:11,paddingRight:4,height:48,width:88,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.downloadInfoContainer),this.downloadCountLabel=new TKText,this.downloadCountLabel.style={marginLeft:0,marginTop:0,width:"100%",fontSize:20,fontWeight:"500",textAlign:"center",color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",flexShrink:2},this.downloadInfoContainer.appendChild(this.downloadCountLabel),this.downloadToastContainer=new TKView,this.downloadToastContainer.style={marginTop:4,marginLeft:0,height:15,width:"100%",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.downloadInfoContainer.appendChild(this.downloadToastContainer),this.downloadDescLabel=new TKText,this.downloadDescLabel.style={fontSize:10,textAlign:"center",color:"#FFFFFF99",textLineClamp:1,flexShrink:1},this.downloadToastContainer.appendChild(this.downloadDescLabel),this.toastView=new TKView,this.toastView.style={width:14,height:10,marginLeft:0},this.downloadToastContainer.appendChild(this.toastView),this.toastTag=new TKImage,this.toastTag.style={width:10,height:10,marginLeft:0},this.toastView.appendChild(this.toastTag),this.splitView=new TKView,this.splitView.style={marginLeft:0,marginTop:0,width:1,height:48,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.bottomContainer.appendChild(this.splitView);const t=new TKView;t.style={marginLeft:0,marginTop:0,width:"100%",height:24,gradientBgColor:"270,#FFFFFF00 0, #FFFFFF66 1"},this.splitView.appendChild(t);let e=new TKView;e.style={marginLeft:0,marginTop:0,width:"100%",height:24,flexGrow:1,gradientBgColor:"270,#FFFFFF66 0, #FFFFFF00 1"},this.splitView.appendChild(e),this.textContainer=new TKView,this.textContainer.style={width:294,height:"100%",paddingRight:11,paddingLeft:11,justifyContent:"center",flexShrink:1,alignItems:"center"},this.bottomContainer.appendChild(this.textContainer),this.descLabel=new TKText,this.descLabel.style={width:"100%",textLineClamp:2,fontSize:14,color:"#FFFFFF",textAlign:"left",textOverflow:"ellipsis"},this.textContainer.appendChild(this.descLabel),this.actionBtnContainer=new TKView,this.actionBtnContainer.style={justifyContent:"center",marginTop:14,paddingLeft:11,paddingRight:11,height:36,width:"100%",borderRadius:100},this.appendChild(this.actionBtnContainer),this.actionBtn=new Ri(this.vm.adInfo,{width:"100%",height:"100%",right:0,borderRadius:100,backgroundColor:"#FE3666"}),this.actionBtnContainer.appendChild(this.actionBtn)}setupData(){var t;Ve(this.toastTag,"ksad_download_card_toast_icon_black.png"),this.downloadCountLabel.setText(this.vm.getAppDownloadCountDesc()),Ci(this.downloadDescLabel,"text",null===(t=this.vm.$attrsPath.downloadCardDataInfo)||void 0===t?void 0:t.appDownloadDescText,""),Ci(this.descLabel,"text",this.vm.$attrsPath.adInfo.adBaseInfo.adDescription,""),fi(this.vm.$attrsPath.actionText,(t=>{this.actionBtn.setText(t)})),fi(this.vm.$attrsPath.downloadChangeEvent,(t=>{this.actionBtn.setDownloadChange(t)}))}setupActions(){let e=new b;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.downloadInfoContainer&&this.downloadInfoContainer.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_APP_DOWNLOAD_NUM_CLICK,e)})),this.descLabel&&this.descLabel.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_COMMENT_CLICK,e)})),this.actionBtn&&this.actionBtn.setOnTapListener((i=>{this.vm.convert(1,1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.toastView&&this.toastView.addEventListener("tap",(t=>{var e;Re(null===(e=this.vm.downloadCardDataInfo)||void 0===e?void 0:e.toastText)})),this.vm.supportSlideClick()&&(this.downloadInfoContainer&&Nt(this.downloadInfoContainer,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.descLabel,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})),Nt(this.actionBtn,(()=>{this.vm.convert(1,1,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)})))}}class mr extends Fi{constructor(t){var e;super(t),this.vm=t,this.cardStyle=null===(e=this.vm.downloadCardDataInfo)||void 0===e?void 0:e.style,this.setupViews(),this.setupActions(),this.vm.reportDownloadCardImpression()}addCardDynamic(t){this.cardContentView&&this.actionBtnAnimation&&(this.animationCardView?this.addCardDynamicEffects(this.animationCardView,this.actionBtnAnimation,this.styleAnimation):this.addCardDynamicEffects(t,this.actionBtnAnimation,this.styleAnimation))}pauseActionAnimation(){this.animationCardView&&this.animationCardView.removeAllAnimation(),this.sweepLightImage&&this.sweepLightImage.removeAllAnimation()}resumeActionAnimation(){this.cardDynamicAllowed&&(this.containerView?this.addCardDynamic(this.containerView):this.addCardDynamic(this.cardContentView))}stopActionAnimation(){this.pauseActionAnimation()}setupViews(){this.style={width:this.getWidth(),height:188,paddingLeft:16,paddingRight:16,flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute",paddingBottom:16},this.setupSubViews()}setupSubViews(){this.titleContentView=new dr(this.vm),this.titleContentView.style={top:0,position:"absolute"},this.appendChild(this.titleContentView),this.setupCardContent()}setupActions(){let e=new b;e.template_show_type=this.vm.getDownloadCardTemplateShowType(),this.addEventListener("tap",(i=>{this.vm.convert(1,2,{x:i.position.rawX,y:i.position.rawY},t.CARD_OTHERAREA_CLICK,e)})),this.vm.supportSlideClick()&&Nt(this,(()=>{this.vm.convert(1,2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))}setupCardContent(){if(1==this.cardStyle)this.cardContentView=new cr(this.vm),this.appendChild(this.cardContentView),this.cardContentView.cardDynamicEffectsCallback=(t,e)=>{this.actionBtnAnimation=t,this.styleAnimation=e,this.addCardDynamic(this.cardContentView)};else{this.containerView=new TKView,this.containerView.style={width:"100%",height:124,bottom:16,borderRadius:8,position:"absolute"},this.appendChild(this.containerView);const t=new TKImage;t.style={width:"100%",height:"100%",borderRadius:8},Ve(t,"ksad_outermost_bg_img.png"),this.containerView.appendChild(t),this.cardContentView=new pr(this.vm),this.containerView.appendChild(this.cardContentView),this.cardContentView.cardDynamicEffectsCallback=(t,e)=>{if(e.bottom=16,this.actionBtnAnimation=t,this.styleAnimation=e,1==this.vm.cardDynamicEffects){this.animationCardView=new TKView,this.animationCardView.style=e,this.insertBefore(this.animationCardView,this.containerView);const t=new TKImage;t.style={width:"100%",height:"100%",borderRadius:8},Ve(t,"ksad_outermost_bg_img.png"),this.animationCardView.appendChild(t)}this.addCardDynamic(this.containerView)}}}getHeight(){return 188}getWidth(){return 0==this.vm.screenOrientation?this.vm.containerLimit.width:this.vm.containerLimit.height}}class gr{static createNormalBottomBarView(t,e){const i=t.getActionBarStyle();let n=null;if(t.isValidDownloadCardInfo()&&Y(t.adInfo)&&t.downloadCardDataInfo.style)return n=new mr(t),n;switch(i){case 1:n=new er(t);break;case 2:n=new ir(t);break;case 3:n=new nr(t);break;case 4:n=new sr(t);break;case 13:n=new ar(t);break;case 12:n=new or(t);break;case 14:case 15:0!=t.screenOrientation||Y(t.adInfo)||(n=new lr(t))}return null==n&&e&&(n=e()),n}}class ur extends TKView{constructor(t=!1){super(),this.style={width:"100%",height:"100%",position:"absolute",flexDirection:"column",justifyContent:"center",alignItems:"center"},t||(this.addEventListener("tap",(t=>{})),this.addEventListener("swipe",(t=>{})))}showDialog(t){t.removeChild(this),this.style={visibility:"visible"},t.appendChild(this),this.dialogContainer=t}isShowing(){return"visible"==this.style.visibility}dismiss(){this.style={visibility:"hidden"},this.dialogContainer&&this.dialogContainer.removeChild(this)}}class wr extends TKView{constructor(){super(),this.throughHitTest=!0,this.enabled=!1,this.setupViews()}setupViews(){this.setupBreathAnim(),this.setupHandAnim()}setupHandAnim(){this.style={width:"100%",height:"100%"},this.clipChildren=!1,this.handView=new TKImage,this.handView.style={width:120,height:120,top:0,bottom:0,position:"absolute"},Ve(this.handView,"interact_card_hand.png"),this.appendChild(this.handView);const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.handView.style={transform:{translate:{x:10,y:10}}},.5),()=>(this.handView.style={transform:{translate:{x:0,y:0}}},1)]),t.duration=1e3,t.repeatCount=Number.MAX_SAFE_INTEGER,this.handView.addAnimation(t,"handAnimation")}setupBreathAnim(){this.gestureBreathAnimView=new TKView,this.gestureBreathAnimView.style={position:"absolute",marginTop:5,width:70,height:70},this.gestureBreathAnimView.clipChildren=!1,this.appendChild(this.gestureBreathAnimView),this.breathBackground=new TKView,this.breathBackground.style={position:"absolute",borderRadius:11,backgroundColor:"#FFFFFF",opacity:.5,width:22,height:22,top:23,left:23},this.gestureBreathAnimView.appendChild(this.breathBackground),this.breathAnim=new TKView,this.breathAnim.style={position:"absolute",borderRadius:11,backgroundColor:"#FFFFFF",opacity:.2,width:22,height:22,top:23,left:23},this.gestureBreathAnimView.appendChild(this.breathAnim);const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.breathAnim.style={transform:{scale:2.3}},.5),()=>(this.breathAnim.style={transform:{scale:1}},1)]),t.duration=1e3,t.repeatCount=Number.MAX_SAFE_INTEGER,this.breathAnim.addAnimation(t,"handBreathAnimation")}clearHandClick(){this.handView.setVisibility("hidden"),this.breathAnim.setVisibility("hidden"),this.breathBackground.setVisibility("hidden"),this.handView.removeAllAnimation(),this.breathAnim.removeAllAnimation()}}class Cr extends TKView{constructor(t){super(),this.animRunCount=1,this.isShowCurrentView=!0,this.upMoveAnimTimer=0,this.downMoveAnimTimer=0,this.infos=t,this.setupViews(),this.setupData(),this.startTopTagViewgMoveAnimation(),this.startDownTagViewMoveAnimation()}setupData(){this.upTagText.setText(this.infos[0]),this.downTagText.setText(this.infos[1])}setupViews(){this.contentView=new TKView,this.contentView.style={position:"absolute",width:"100%",height:30,flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:24},this.appendChild(this.contentView);let t=new TKImage;t.style={width:244,height:30,position:"absolute"},Ve(t,"interact_card_lamp_bg.png"),this.contentView.appendChild(t),this.setUpTagView()}setUpTagView(){let t=new TKView;t.style={width:"100%",height:27,alignItems:"center"},this.upTagText=new TKText,this.upTagText.style={position:"absolute",top:0,color:"#FFF2DD70",fontSize:12,fontWeight:"500",includeFontPadding:!1,textAlign:"center",width:180,height:27,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.upTagText),this.downTagText=new TKText,this.downTagText.style={color:"#FFF2DD70",fontSize:12,position:"absolute",top:27,includeFontPadding:!1,fontWeight:"500",textAlign:"center",width:180,height:27,textLineClamp:1,textOverflow:"ellipsis"},t.appendChild(this.downTagText),this.contentView.appendChild(t)}startTopTagViewgMoveAnimation(){var t;if((null===(t=this.infos)||void 0===t?void 0:t.length)<=1)return;let e=this;this.downMoveAnimTimer=setInterval((()=>{let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(e.upTagText.style={top:e.isShowCurrentView?0:27},0),()=>(e.upTagText.style={top:e.isShowCurrentView?-27:0},1)]),t.on("end",(()=>{e.upTagText.style={top:e.isShowCurrentView?27:0}})),e.upTagText.addAnimation(t,"tagTextTranslateAnimation")}),2e3)}startDownTagViewMoveAnimation(){var t;if((null===(t=this.infos)||void 0===t?void 0:t.length)<=1)return;let e=this;this.upMoveAnimTimer=setInterval((()=>{let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(e.downTagText.style={top:e.isShowCurrentView?27:0},0),()=>(e.downTagText.style={top:e.isShowCurrentView?0:-27},1)]),t.on("end",(()=>{e.downTagText.style={top:e.isShowCurrentView?0:27},e.handleAnimEnd()})),e.downTagText.addAnimation(t,"tagDownTextTranslateAnimation")}),2e3)}handleAnimEnd(){setTimeout((()=>{this.animRunCount++,this.isShowCurrentView=!this.isShowCurrentView,this.isShowCurrentView?this.downTagText.setText(this.infos[this.animRunCount%this.infos.length]):this.upTagText.setText(this.infos[this.animRunCount%this.infos.length])}),1e3)}clearAnim(){this.upMoveAnimTimer&&clearInterval(this.upMoveAnimTimer),this.downMoveAnimTimer&&clearInterval(this.downMoveAnimTimer),this.downTagText.removeAllAnimation(),this.upTagText.removeAllAnimation()}}class fr extends TKView{constructor(t){super(),this.isClick=!1,this.hasInteracted=!1,this.vm=t,this.vm.logInteractionImp(),this.setupViews(),this.showBaseAnim(this),this.showCardAnim(this.leftCardView,this.rightCardView),this.setupActions();const e=this;this.timePlay=new ns(this.vm.getInteractShowTime()),this.timePlay.onFinishCallback=()=>{e.isClick||e.clickAction(0,3),this.isClick=!0},this.timePlay.play(),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&e.onDismiss(),"pageVisiable"==t&&e.timePlay&&e.timePlay.resume(),"pageInvisiable"==t&&e.timePlay&&e.timePlay.paused()}))}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",position:"absolute"};let t=new TKView;t.style={width:"100%",height:540,alignItems:"center"},this.appendChild(t),this.titleContentView=new TKView,this.titleContentView.style={width:382,height:87,top:12,justifyContent:"center",alignItems:"center"},t.appendChild(this.titleContentView);let e=new TKImage;e.style={width:382,height:87,position:"absolute"},Ve(e,"interact_card_title_bg.png"),this.titleContentView.appendChild(e);let i=new TKText;i.style={width:320,height:45,color:"#FBE5C3",fontSize:32,textLineClamp:1,textOverflow:"clip",textAlign:"center",fontWeight:"600"},me(this.vm.getInteractTitle())?i.setText(this.vm.getInteractTitle()):i.setText("翻卡领取专属奖励"),this.titleContentView.appendChild(i),this.subTitleContentView=new TKView,this.subTitleContentView.style={width:224,height:45,top:-7,flexDirection:"row",justifyContent:"center",alignItems:"center"},t.appendChild(this.subTitleContentView);let n=new TKImage;Ve(n,"interact_card_subtitle_left.png"),n.style={width:32,height:6,right:8},this.subTitleContentView.appendChild(n);let s=new TKText;s.style={width:208,height:45,color:"#FBE5C3",fontSize:16,textLineClamp:1,textOverflow:"clip",textAlign:"center"},me(this.vm.getInteractSubTitle())?s.setText(this.vm.getInteractSubTitle()):s.setText("点击任意卡片获取奖励"),this.subTitleContentView.appendChild(s);let a=new TKImage;Ve(a,"interact_card_subtitle_right.png"),a.style={width:32,height:6,left:8},this.subTitleContentView.appendChild(a),this.cardBaseView=new TKView,this.cardBaseView.style={marginTop:5,width:"100%",height:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",position:"absolute"},t.appendChild(this.cardBaseView);let o=new TKView;o.style={width:"100%",height:"100%",position:"absolute",alignItems:"center",justifyContent:"center",flexDirection:"row"},this.cardBaseView.appendChild(o),this.leftLightView=new TKView,this.leftLightView.style={height:265,width:180,shadow:"0 0 10 #FFF4CD44",borderRadius:14,visibility:"hidden"},o.appendChild(this.leftLightView),this.rightLightView=new TKView,this.rightLightView.style={marginStart:12,height:265,width:180,shadow:"0 0 10 #FFF4CD44"},o.appendChild(this.rightLightView),Le.supportMinimumTKVersion("5.0.0")&&(this.leftCardBaseView=new RoundRectView,this.leftCardBaseView.style={height:261,width:174,borderRadius:22},this.leftCardView=new TKImage,this.leftCardView.style={height:261,width:174},this.leftSweepView=new TKImage,this.leftSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1"},this.cardBaseView.appendChild(this.leftCardBaseView),this.leftCardBaseView.appendChild(this.leftCardView),this.leftCardBaseView.appendChild(this.leftSweepView),this.rightCardBaseView=new RoundRectView,this.rightCardBaseView.style={marginStart:18,height:261,width:174,borderRadius:22},this.rightCardView=new TKImage,this.rightCardView.style={height:261,width:174},this.rightSweepView=new TKImage,this.rightSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1",visibility:"hidden"},this.cardBaseView.appendChild(this.rightCardBaseView),this.rightCardBaseView.appendChild(this.rightCardView),this.rightCardBaseView.appendChild(this.rightSweepView)),me(this.vm.getInteractIcon())?(this.leftLightView.setVisibility("hidden"),this.leftSweepView.setVisibility("hidden"),this.rightLightView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.leftCardView.setSrc(this.vm.getInteractIcon()),this.rightCardView.setSrc(this.vm.getInteractIcon())):(this.leftLightView.setVisibility("visible"),this.leftSweepView.setVisibility("visible"),this.rightLightView.setVisibility("visible"),this.sweepAnimation(),setTimeout((()=>{this.rightSweepView.setVisibility("visible"),this.sweepRightAnimation()}),800),this.leftCardView.setSrc("image/ksad-video-image/interact_card_bg_left.png"),this.rightCardView.setSrc("image/ksad-video-image/interact_card_bg_right.png")),setTimeout((()=>{this.handAndBreatheView=new wr;let t=this.cardBaseView.getSize().width-100;this.isClick||(this.handAndBreatheView.style={width:120,height:120,left:t,top:290,position:"absolute"},this.cardBaseView.appendChild(this.handAndBreatheView))}),668),this.lampAndCloseContentView=new TKView,this.lampAndCloseContentView.style={marginTop:300,width:"100%",height:110,alignItems:"center"},t.appendChild(this.lampAndCloseContentView),this.vm.getInteractCustomerInfo().length&&(this.tagView=new Cr(this.vm.getInteractCustomerInfo()),this.tagView.style={width:"100%",height:40},this.lampAndCloseContentView.appendChild(this.tagView)),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={marginTop:18,width:40,height:40,opacity:.6},this.lampAndCloseContentView.appendChild(this.closeView)}setupActions(){this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose(1),this.timePlay&&this.timePlay.stop()})),this.leftCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,this.clickAction(0,1))})),this.rightCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,me(this.vm.getInteractIcon())||(this.vm.clickType=1),this.clickAction(1,2))}))}clickAction(t,e){this.leftSweepView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.vm.logInteractionClick(e),0==t?this.clickCardAnim(this.leftCardBaseView,this.rightCardView,t,this.leftLightView,this.rightLightView):this.clickCardAnim(this.rightCardBaseView,this.leftCardView,t,this.rightLightView,this.leftLightView),this.clickBaseAnim(this.titleContentView,this.subTitleContentView,this.lampAndCloseContentView)}showBaseAnim(t){let e=new TKKeyframeAnimation;e.duration=15,e.timingFunction="linear",e.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:1},1)]),t.addAnimation(e,"leftShowAnimation")}showCardAnim(t,e){let i=new TKKeyframeAnimation;i.duration=250,i.timingFunction="linear",i.setAnimations([()=>(t.style={opacity:0,left:-150},0),()=>(t.style={left:0,opacity:1},1)]),t.addAnimation(i,"leftShowAnimation");let n=new TKKeyframeAnimation;n.duration=250,n.timingFunction="linear",n.setAnimations([()=>(e.style={opacity:0,left:150},0),()=>(e.style={opacity:1,left:0},1)]),e.addAnimation(n,"rightShowAnimation");let s=new TKKeyframeAnimation;s.duration=250,s.timingFunction="linear",s.setAnimations([()=>(this.leftLightView.style={opacity:0,left:-150},0),()=>(this.leftLightView.style={left:0,opacity:1},1)]),this.leftLightView.addAnimation(s,"leftLightShowAnimation");let a=new TKKeyframeAnimation;a.duration=250,a.timingFunction="linear",a.setAnimations([()=>(this.rightLightView.style={opacity:0,left:150},0),()=>(this.rightLightView.style={opacity:1,left:0},1)]),this.rightLightView.addAnimation(a,"rightLightShowAnimation")}clickCardAnim(t,e,i,n,s){if(this.handAndBreatheView&&this.handAndBreatheView.setVisibility("hidden"),!me(this.vm.getInteractIcon())){let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(n.style={},0),()=>(n.style={top:-5,left:1==i?-96:96,transform:{scale:1.4}},1)]),n.addAnimation(t,"lightAnimation");let e=new TKKeyframeAnimation;e.duration=100,e.timingFunction="linear",e.setAnimations([()=>(s.style={opacity:1},0),()=>(s.style={opacity:0},1)]),s.addAnimation(e,"closelightAnimation")}let a=new TKKeyframeAnimation;a.duration=500,a.timingFunction="linear",a.setAnimations([()=>(t.style={},0),()=>(t.style={top:-5,left:1==i?-96:96,transform:{scale:1.4}},1)]),t.addAnimation(a,"cardMoveAnimation");let o=new TKKeyframeAnimation;o.duration=100,o.timingFunction="linear",o.setAnimations([()=>(e.style={opacity:1},0),()=>(e.style={opacity:0},1)]),e.addAnimation(o,"cardDismissAnimation"),a.on("end",(()=>{this.interactCallback&&!this.hasInteracted&&(this.interactCallback(),this.hasInteracted=!0)}))}clickBaseAnim(t,e,i){let n=new TKKeyframeAnimation;n.duration=15,n.timingFunction="linear",n.setAnimations([()=>(t.style={opacity:1},e.style={opacity:1},i.style={opacity:1},0),()=>(t.style={opacity:0},e.style={opacity:0},i.style={opacity:0},1)]),t.addAnimation(n,"clickBaseAnimation")}sweepAnimation(){this.leftSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.leftSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.leftSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1e3,t.repeatCount=1,t.timingFunction="Linear",this.leftSweepView.addAnimation(t,"sweep")}),1500)}sweepRightAnimation(){this.rightSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.rightSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.rightSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1200,t.repeatCount=1,t.timingFunction="Linear",this.rightSweepView.addAnimation(t,"sweep")}),1500)}onDismiss(){this.removeAllAnimation(),this.tagView&&this.tagView.clearAnim(),this.handAndBreatheView&&this.handAndBreatheView.removeAllAnimation(),this.rightCardBaseView&&this.rightCardBaseView.removeAllAnimation(),this.leftCardBaseView&&this.leftCardBaseView.removeAllAnimation(),this.rightCardView&&this.rightCardView.removeAllAnimation(),this.leftCardView&&this.leftCardView.removeAllAnimation(),this.rightSweepView&&this.rightSweepView.removeAllAnimation(),this.leftSweepView&&this.leftSweepView.removeAllAnimation(),this.leftLightView&&this.leftLightView.removeAllAnimation(),this.rightLightView&&this.rightLightView.removeAllAnimation(),this.handAndBreatheView&&this.handAndBreatheView.clearHandClick(),this.timePlay&&this.timePlay.stop()}}class yr extends TKView{constructor(t){super(),this.spikeTimer=0,this.vm=t,this.seckillTime=this.vm.getRightsCardSecKillTime(),this.setupViews(),this.setupActions()}setupActions(){this.cardTitleText.setText(this.vm.getRightsCardTitle()),this.productIconImg.setSrc(this.vm.getRightsCardCustomImageUrl()),this.iconTagText.setText(this.vm.getRightsCardProductIconDesc()),this.sellingPointText&&this.sellingPointText.setText(this.vm.getRightsCardSellingPoint()),this.customContentText.setText(this.vm.getRightsCardCustomContent()),Ce(this.vm.getPrice())||(Ve(this.priceBg,"product_card_price_curve.png"),this.priceTitleText.setText("超值低价"),this.priceText.setText(this.vm.getPrice())),Ce(this.vm.getOriginPrice())||this.origninPriceText.setText("¥"+this.vm.getOriginPrice())}setupViews(){if(this.style={alignItems:"center",justifyContent:"center"},this.container=new TKView,this.container.style={height:316,width:208,top:this.titleTopDis(),flexDirection:"column",alignItems:"center",justifyContent:"flex-start",position:"absolute"},this.appendChild(this.container),this.cardTitleText=new TKText,this.cardTitleText.style={width:"100%",height:28,fontSize:20,textLineClamp:1,color:"#FE3666",marginTop:0,alignItems:"center",fontWeight:"500",textOverflow:"clip",textAlign:"center"},this.container.appendChild(this.cardTitleText),this.productIconView=new TKView,this.productIconView.style={height:this.productIconLength(),width:this.productIconLength(),borderRadius:4,backgroundColor:"#FFFFFF",marginTop:this.productIconDis(),alignItems:"flex-start",justifyContent:"center"},this.container.appendChild(this.productIconView),this.productIconImg=new TKImage,this.productIconImg.style={height:this.productIconLength(),width:this.productIconLength(),borderRadius:4},this.productIconView.appendChild(this.productIconImg),this.iconTagView=new TKView,this.iconTagView.style={width:30,height:20,left:0,top:0,topLeftRadius:4,bottomRightRadius:4,backgroundColor:"#FE3666",alignItems:"center",justifyContent:"center",position:"absolute"},this.productIconView.appendChild(this.iconTagView),this.iconTagText=new TKText,this.iconTagText.style={width:30,height:20,fontSize:11,textLineClamp:1,color:"#FEFFFF",alignItems:"center",textOverflow:"ellipsis",textAlign:"center"},this.iconTagView.appendChild(this.iconTagText),this.container.appendChild(this.createProductTitleArea(this.vm.needShowSellingText)),this.vm.isHasTags()&&this.setupTagView(),Ce(this.vm.getPrice())||this.setupPriceView(),this.vm.getRightsCardSecKillTime()){const t=new TKView;t.style={height:372,width:248,flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",position:"absolute"},this.appendChild(t),this.setupSeckillView(t)}}createProductTitleArea(t){console.log("jky createProductTitleArea: "+t);let e=new TKView;return e.style={width:"100%",flexDirection:"column",justifyContent:"center"},t?(e.style={height:42},this.sellingPointText=new TKText,this.sellingPointText.style={width:"100%",height:"auto",fontSize:14,textLineClamp:1,color:"#881B00",alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},this.customContentText=new TKText,this.customContentText.style={width:"100%",height:"auto",fontSize:14,textLineClamp:1,color:"#881B00",alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},e.appendChild(this.sellingPointText),e.appendChild(this.customContentText)):(e.style={height:22,marginTop:8},this.customContentText=new TKText,this.customContentText.style={width:"100%",height:22,fontSize:16,textLineClamp:1,color:"#881B00",alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},e.appendChild(this.customContentText)),e}setupTagView(){gs.create({tagViewStyle:1,height:24,tagBorderRadius:4,tagFontSize:11}),this.tagView=new us(this.vm.getRightsCardProductTags(),gs.create({tagViewStyle:1,height:24,tagBorderRadius:4,tagFontSize:11,tagPadding:4,tagDividerSize:8})),this.tagView.style={marginTop:8},this.container.appendChild(this.tagView)}setupPriceView(){this.priceContainer=new TKView,this.priceContainer.style={height:74,width:188,marginTop:this.vm.isHasTags()?12:24,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.container.appendChild(this.priceContainer),this.container.clipChildren=!1,this.priceBg=new TKImage,this.priceBg.style={height:74,width:188},this.priceContainer.appendChild(this.priceBg),this.priceTitleText=new TKText,this.priceTitleText.style={width:"100%",height:15,fontSize:12,textLineClamp:1,color:"#FE3666",top:0,alignItems:"center",fontWeight:"500",textOverflow:"ellipsis",textAlign:"center",position:"absolute"},this.priceContainer.appendChild(this.priceTitleText),this.priceView=new TKView,this.priceView.style={maxWidth:"100%",height:36,backgroundColor:"#FFFFFF",borderColor:"#FE3666",borderWidth:1,borderRadius:100,top:19,flexDirection:"row",position:"absolute",paddingLeft:8,paddingRight:8},this.priceContainer.appendChild(this.priceView),this.vm.isOnlyHasOriginPrice()||(this.priceTag=new TKText,this.priceTag.style={width:16,height:16,top:14,fontSize:16,textLineClamp:1,includeFontPadding:!1,color:"#FE3666",fontWeight:"600"},this.priceTag.setText("¥"),this.priceView.appendChild(this.priceTag));let t=this.vm.isOnlyHasOriginPrice()?18:26;this.priceText=new TKText,this.priceText.style={height:28,fontSize:t,top:4,textLineClamp:1,color:"#FE3666",alignItems:"center",includeFontPadding:!1,fontWeight:"600",textOverflow:"clip",textAlign:"center"},this.priceView.appendChild(this.priceText),Ce(this.vm.getOriginPrice())||this.setupOriginPriceView()}setupOriginPriceView(){this.origninPriceText=new TKText,this.origninPriceText.style={width:54,height:17,fontSize:12,textLineClamp:1,color:"#9C9C9C",left:0,bottom:0,alignItems:"center",textOverflow:"clip",textAlign:"center",position:"absolute"},this.priceContainer.appendChild(this.origninPriceText)}setupSeckillView(t){const e={height:16,width:16,marginRight:6,color:"#FE3665",backgroundColor:"#FFFFFF",textAlign:"center",borderRadius:2,fontSize:12,includeFontPadding:!1,textLineClamp:1},i=new TKView;i.style={width:"100%",paddingStart:12,height:34,top:0,position:"absolute",flexDirection:"row",justifyContent:"space-between"},t.appendChild(i);let n=new TKView;n.style={width:"100%",height:"100%",flexDirection:"row",alignItems:"center"},i.appendChild(n);const s=new TKImage;s.style={width:66,height:14},n.appendChild(s),Ve(s,"product_card_seckill_icon.png");const a=new TKText;a.style={width:38,height:16,fontSize:12,marginLeft:4,textLineClamp:1,color:"#FFFFFF",alignItems:"center",fontWeight:"500",textOverflow:"ellipsis",textAlign:"center"},n.appendChild(a),a.setText("距结束"),this.spikeHourText=new TKText,this.spikeHourText.style=e,n.appendChild(this.spikeHourText),this.spikeMinuteText=new TKText,this.spikeMinuteText.style=e,n.appendChild(this.spikeMinuteText),this.spikeSecondText=new TKText,this.spikeSecondText.style=e,n.appendChild(this.spikeSecondText),0!=this.spikeTimer&&clearInterval(this.spikeTimer),this.updateSpikeText(),this.spikeTimer=setInterval((()=>{this.updateSpikeText()}),1e3)}updateSpikeText(){let t=new Zi(this.seckillTime);this.seckillTime=this.seckillTime-1e3,this.spikeHourText.setText(t.getFormattedHour()),this.spikeMinuteText.setText(t.getFormattedMinute()),this.spikeSecondText.setText(t.getFormattedSecond())}productIconLength(){return Ce(this.vm.getPrice())?156:132}productIconDis(){return Ce(this.vm.getPrice())?20:8}titleTopDis(){return this.vm.getRightsCardSecKillTime()?106:90}}class Tr extends TKView{constructor(t){super(),this.actionBarSize={width:186,height:48},this.startDismissCalled=!1,this.vm=t,this.setupViews()}setupViews(){this.style={height:"100%",width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute"},this.setupContainer();const t=this;fi(this.vm.$attrsPath.callerContext.lifeStatus,(e=>{"hideEnd"==e&&t.onDismiss(2)}))}showRightsDialogCard(){const t=this;this.titleBg.style={opacity:0},this.titleText.style={opacity:0},this.actionBarView.style={opacity:0},this.closeView.style={opacity:0},this.showCardAnimation((()=>{t.titleAndBottomShow(),t.cricleAnimation(),t.cardAppearCallback&&t.cardAppearCallback()})),this.vm.logProductRightsImp(),this.setupActions(),this.startDismissCalled=!1}showCardAnimation(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.cardView.style={transform:{scale:.02}},0),()=>(this.cardView.style={transform:{scale:1.15}},1)]),e.duration=250,e.timingFunction="0.19 0.81 1 1",this.cardView.addAnimation(e,"cardContentAnim");const i=this;e.on("end",(()=>{t&&t();let e=new TKKeyframeAnimation;e.setAnimations([()=>(i.cardView.style={transform:{scale:1.15}},0),()=>(i.cardView.style={transform:{scale:1}},1)]),e.duration=330,e.timingFunction="0.19 0.54 0.58 1",i.cardView.addAnimation(e,"cardScaleAnim"),e.on("end",(()=>{}))}))}titleAndBottomShow(){this.titleBg.style={opacity:1},this.titleText.style={opacity:1},this.actionBarView.style={opacity:1},this.closeView.style={opacity:.6}}cricleAnimation(){Le.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080));let t=new wr;t.style={width:90,height:90,right:(this.vm.callerContext.containerLimit.width-this.actionBarSize.width)/2-30,bottom:39,position:"absolute"},this.containerView.appendChild(t)}addSweepAnimation(){if(this.sweepView&&this.actionBarView.removeChild(this.sweepView),Le.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:48,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=34;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,opacity:1,position:"absolute"},this.sweepView.appendChild(this.sweepImage),Ve(this.sweepImage,"icon_ksad_extra_reward_sweep.png"),this.actionBarView.appendChild(this.sweepView),this.sweepImage.addAnimation(xi(540,this.actionBarSize.width+t),"anim")}}setupContainer(){this.containerView=new TKView,this.containerView.style={width:"100%",height:700,flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute"},this.containerView.clipChildren=!1,this.appendChild(this.containerView),this.setupContentView(this.containerView),this.setupTitleView(this.containerView),this.setupCardView(this.contentView),this.setupActionbar(this.contentView),this.setupTipsView(this.containerView),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={bottom:0,width:40,height:40,opacity:0,resize:"contain",position:"absolute"},this.containerView.appendChild(this.closeView)}setupContentView(t){this.contentView=new TKView,this.contentView.style={width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},t.appendChild(this.contentView)}setupTitleView(t){const e=new TKView;e.style={width:414,height:187,top:0,position:"absolute"},t.appendChild(e),this.titleBg=new TKImage,this.titleBg.style={width:414,height:187,top:0,position:"absolute"},Ve(this.titleBg,"product_card_title_bg.png"),e.appendChild(this.titleBg),this.titleText=new TKText,this.titleText.style={color:"#FFFCF7",top:70,position:"absolute",fontWeight:"600",fontSize:32,height:45,width:"100%",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.titleText.setText("限时"+this.vm.getRightsCardStayTime()+"秒后消失"),e.appendChild(this.titleText)}setupCardView(t){this.cardView=new TKView,this.cardView.style={top:124,width:414,height:497,position:"absolute"},t.appendChild(this.cardView),this.cardBgView=new TKImage,this.cardBgView.style={top:0,width:414,height:497,position:"absolute"},this.vm.getRightsCardSecKillTime()?Ve(this.cardBgView,"product_card_seckill.png"):Ve(this.cardBgView,"product_card_usual.png"),this.cardView.appendChild(this.cardBgView),this.cardContent=new yr(this.vm),this.cardContent.clipChildren=!1,this.cardContent.style={top:0,width:414,height:497,position:"absolute"},this.cardView.appendChild(this.cardContent)}setupTipsView(t){let e=this.vm.getBottomTipsText();if(Ce(e))return;let i=new TKText;i.style={width:"100%",height:15,fontSize:10,color:"#FFF9F9",opacity:.5,includeFontPadding:!1,fontWeight:"400",textAlign:"center",position:"absolute",bottom:42},i.setText(e),this.contentView.appendChild(i)}setupActionbar(t){this.actionBarView=new TKView,this.actionBarView.style={bottom:65,width:186,height:48,borderRadius:24,position:"absolute"},this.actionBarView.clipChildren=!0,t.appendChild(this.actionBarView);let e=new TKImage;e.style={width:"100%",height:"100%",position:"absolute"},Ve(e,"product_card_button.png"),this.actionBarView.appendChild(e),this.actionBarText=new TKText,this.actionBarText.style={color:"#FFFFFF",width:"90%",height:"100%",alignSelf:"center",fontWeight:"600",fontSize:20,position:"absolute",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLetterSpace:1.5},this.actionBarText.setText(this.vm.getRightsCardAction()),this.actionBarView.appendChild(this.actionBarText)}setupActions(){this.actionBarView.addEventListener("tap",(e=>{const i=pe(e,this.actionBarView);let n=new b;n.template_show_type="benefit_card_item",this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),this.cardContent.addEventListener("tap",(e=>{const i=pe(e,this.actionBarView);let n=new b;n.template_show_type="benefit_card_item",this.vm.convert(i,2,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),this.closeView.addEventListener("tap",(t=>{this.onDismiss(2)}))}onDismiss(t){this.startDismissCalled||(this.startDismissCallback&&this.startDismissCallback(this.contentView,t),this.removeAllAnimation(),this.sweepTimer&&clearInterval(this.sweepTimer),this.startDismissCalled=!0)}updateCountdown(t){this.titleText&&this.titleText.setText(`限时${t}秒后消失`)}}class Ir{static addCardShowAnimation(t,e){let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={transform:{scale:.02}},0),()=>(t.style={transform:{scale:1.15}},1)]),i.duration=230,i.timingFunction="0.19 0.81 1 1",t.addAnimation(i,"cardContentAnim");i.on("end",(()=>{e&&e();let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={transform:{scale:1.15}},0),()=>(t.style={transform:{scale:1}},1)]),i.duration=380,i.timingFunction="0.19 0.54 0.58 1",t.addAnimation(i,"cardScaleAnim")}))}static addCouponLegacyCardShowAnimation(t,e){let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={transform:{scale:0},opacity:0},0),()=>(t.style={transform:{scale:1},opacity:1},1)]),i.duration=600,i.timingFunction="linear",i.on("end",(()=>{e&&e()})),t.addAnimation(i,"ecShowAnimation")}}class vr extends TKView{constructor(t){super(),this.closeCallbackCalled=!1,this.vm=t,this.setupView(),this.setupAction(),this.fitHorizontalScreenView(),this.vm.getActionBarRect=()=>({x:this.actionbarView.getOrigin().x,y:this.actionbarView.getOrigin().y,width:169,height:48}),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&this.sweepTimer&&clearInterval(this.sweepTimer)}))}setupView(){this.setupRootView(),this.setupCountDownView(),this.setupBgView(),this.setupCardInfoView(),this.setupCouponInfoView(),this.setupTipsView(),this.setupBottomContainerView(),this.tryReportImpression()}setupAction(){this.actionbarView&&this.actionbarView.addEventListener("tap",(e=>{const i=pe(e,this.actionbarView);this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK)&&this.vm.enableShowCloseView()&&this.onCloseClick&&this.handleCloseClick(3)})),this.closeImage&&this.closeImage.addEventListener("tap",(t=>{this.handleCloseClick(1)})),this.vm.isSplashScene()||this.vm.isInterstitialScene()||this.bgContainerView.addEventListener("tap",(e=>{const i=pe(e,this.bgContainerView);let n=this.vm.convert(i,2,t.CARD_OTHERAREA_CLICK);console.log(`jky click bgContainerView shouldConvert: ${n}`),n&&this.onCloseClick&&this.handleCloseClick(3)}))}handleCloseClick(t){this.closeCallbackCalled||(this.onCloseClick&&(this.onCloseClick(this.bgContainerView,t),this.closeCallbackCalled=!0),this.removeAllAnimation(),this.sweepTimer&&clearInterval(this.sweepTimer))}setupRootView(){this.actionBarSize=this.getActionBarSize(),this.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"};let t=this.vm.getRootBgColor();t&&(this.style={backgroundColor:t}),this.rootContainerView=new TKView,this.rootContainerView.style={width:"100%",height:"auto",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingBottom:this.vm.useLegacyAnim()?52:0,paddingTop:this.vm.useLegacyAnim()?0:80};let e=this.vm.getFullCardBgUrl();if(!Ce(e)){let t=new TKImage;t.style={width:"100%",height:this.vm.getFullCardHeight(),position:"absolute",left:0,top:80,right:0},Ve(t,e),this.rootContainerView.appendChild(t)}this.vm.useLegacyAnim()&&this.vm.enableShowCloseView()&&(this.rootContainerView.style={transform:{scale:0},opacity:0}),this.appendChild(this.rootContainerView)}setupCountDownView(){if(!this.vm.enableShowCountDownView())return;let t=new TKView;t.style={shadow:"0 0 26 #FFDF8E99"},this.countDownTextView=new TKText,this.countDownTextView.style={fontSize:22,marginBottom:8,fontWeight:"600",color:Le.isAndroid()?"#FFE296":"#FFF7E0",gradientTextColor:"270,FFFFFF,FFE296"},t.appendChild(this.countDownTextView),this.countDownTextView.setText("限时福利 "+this.vm.getRightsCardStayTime()+"s 后消失"),this.rootContainerView.appendChild(t)}setupBgView(){let t=this.vm.getCardSize();this.bgContainerView=new TKView,this.bgContainerView.style={width:t.width,height:t.height,flexDirection:"column",alignItems:"center"},this.rootContainerView.appendChild(this.bgContainerView),this.bgImageView=new TKImage,this.bgImageView.style={width:"100%",height:"100%",bottomLeftRadius:60,bottomRightRadius:60},this.bgImageView.setSrc(this.vm.getBgUrl()),this.bgContainerView.appendChild(this.bgImageView),this.setupIPView();let e=this.vm.getBottomImageViewName();Ce(e)||(this.bgBottomImageView=new TKImage,this.bgBottomImageView.style={width:273,height:263,position:"absolute",left:0,top:0},Ve(this.bgBottomImageView,e),this.bgContainerView.appendChild(this.bgBottomImageView))}setupCardInfoView(){this.cardInfoView=new TKView,this.cardInfoView.style={position:"absolute",left:40,width:84,top:34,flexDirection:"column"},this.bgContainerView.appendChild(this.cardInfoView),this.cardTitleText=new TKText,this.cardTitleText.style={fontSize:20,fontWeight:"900",color:"#FFFFFF"},this.cardTitleText.setText(this.vm.getRightsCardTitle()),this.cardInfoView.appendChild(this.cardTitleText),this.cardDescText=new TKText,this.cardDescText.style={color:"#FFFFFF",fontSize:11,marginTop:2,width:"100%",textLineClamp:1,textOverflow:"ellipsis"},this.cardDescText.setText(this.vm.getTitleDesc()),this.cardInfoView.appendChild(this.cardDescText)}setupIPView(){let t=this.vm.getUserIcon();Ce(t)||(this.ipImageView=new TKImage,this.ipImageView.style={position:"absolute",right:12,top:1,width:134,height:134},this.ipImageView.setSrc(t),this.bgContainerView.appendChild(this.ipImageView))}setupCouponInfoView(){let t=this.vm.getCouponBarSize();if(this.couponInfoView=new TKView,this.couponInfoView.style={position:"absolute",left:t.left,bottom:t.bottom,width:t.width,height:t.height,flexDirection:"row",alignItems:"center"},this.vm.needCouponBarBg()){let e=new TKImage;e.style={width:t.width,height:t.height,position:"absolute",left:0,right:0,bottom:0},Ve(e,"ec_card_coupon_bar.png"),this.couponInfoView.appendChild(e)}this.bgContainerView.appendChild(this.couponInfoView),this.priceView=new TKView,this.priceView.style={paddingLeft:8,height:69,width:"33%",marginRight:-4,flexDirection:"row",alignItems:"center",justifyContent:"center"},this.couponInfoView.appendChild(this.priceView);const e=this.getMeatureSize(this.vm.isVertical()?30:20);this.priceSymbolText=new TKText,this.priceSymbolText.style={fontSize:16,fontWeight:"500",color:"#FFFFFF",marginTop:(30==e?8:6)*e/30},this.priceSymbolText.setText("￥"),this.priceView.appendChild(this.priceSymbolText),this.priceText=new TKText,this.priceText.style={fontSize:e,color:"#FFFFFF",fontWeight:"600",width:"auto",textLineClamp:1,textOverflow:"ellipsis"},this.priceText.setText(this.vm.getPriceAmount()),this.priceView.appendChild(this.priceText),this.couponDescView=new TKView,this.couponDescView.style={flexDirection:"column",height:69,width:"64%",paddingRight:10,justifyContent:"center"},this.couponInfoView.appendChild(this.couponDescView),this.couponTitleText=new TKText,this.couponTitleText.style={fontSize:15,color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",fontWeight:"600"},this.couponTitleText.setText(this.vm.getCouponTitle()),this.couponDescView.appendChild(this.couponTitleText),this.couponDescText=new TKText,this.couponDescText.style={fontSize:10,color:"#FFFFFF",marginTop:4,textLineClamp:1,textOverflow:"ellipsis"},this.couponDescText.setText(this.vm.getCouponDesc()),this.couponDescView.appendChild(this.couponDescText)}setupTipsView(){let t=this.vm.getBottomTipsText();if(Ce(t))return;let e=new TKText;e.style={maxWidth:"273",height:"15",fontSize:10,color:"#EB220B",opacity:.5,includeFontPadding:!1,textAlign:"center",position:"absolute",bottom:this.vm.getBottomTipsMarginBottom()},e.setText(t),this.bgContainerView.appendChild(e)}setupActionbarView(){this.vm.enableShowActionbarView()&&(this.actionbarView=new TKView,this.actionbarView.style={width:169,height:48,borderRadius:this.actionBarSize.height/2,marginTop:16},this.bottomContainerView.appendChild(this.actionbarView),this.actionbarBgImageView=new TKImage,this.actionbarBgImageView.style={width:169,height:48},Ve(this.actionbarBgImageView,"ec_card_actionbar_bg.png"),this.actionbarView.appendChild(this.actionbarBgImageView),this.actionbarText=new TKText,this.actionbarText.style={position:"absolute",left:0,top:-1,fontWeight:"600",width:169,height:48,paddingLeft:10,paddingRight:10,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center",color:"#FFFFFF",fontSize:20},this.actionbarView.appendChild(this.actionbarText),1==this.vm.callerContext.adInfo.adBaseInfo.adOperationType?Ci(this.actionbarText,"text",this.vm.$attrsPath.actionBarText):this.actionbarText.setText(this.vm.getActionbarDesc()))}setupBottomContainerView(){this.bottomContainerView=new TKView,this.bottomContainerView.style={width:"100%",height:114,flexDirection:"column",alignItems:"center",justifyContent:"center"},this.setupActionbarView(),this.setupCloseView(),this.vm.useLegacyAnim()?this.tryShowSweepAnimation():this.switchTitleAndBottom(!1),this.rootContainerView.appendChild(this.bottomContainerView)}tryShowSweepAnimation(){if(this.vm.enableAnimation()&&(Le.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),2e3)),this.vm.enableHandBreathAnim())){let t=new wr;t.style={width:110,height:110,top:0,right:(this.vm.callerContext.containerLimit.width-this.actionBarSize.width)/2-40,position:"absolute"},this.bottomContainerView.appendChild(t)}}addSweepAnimation(){if(this.sweepView&&this.actionbarView.removeChild(this.sweepView),Le.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:this.actionBarSize.height,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=128*this.actionBarSize.height/60;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,position:"absolute"},this.sweepView.appendChild(this.sweepImage),Ve(this.sweepImage,"ksad_light.png"),this.actionbarView.appendChild(this.sweepView),this.sweepImage.addAnimation(xi(1e3,this.actionBarSize.width+t),"anim")}}setupCloseView(){this.vm.enableShowCloseView()&&(this.closeImage=new TKImage,this.closeImage.style={width:40,height:40,marginTop:10},Ve(this.closeImage,"ec_card_close.png"),this.bottomContainerView.appendChild(this.closeImage))}show(){this.vm.useLegacyAnim()?Ir.addCouponLegacyCardShowAnimation(this.rootContainerView,this.cardAnimFinish):Ir.addCardShowAnimation(this.bgContainerView,(()=>{this.switchTitleAndBottom(!0),this.tryShowSweepAnimation(),this.cardAnimFinish&&this.cardAnimFinish()})),this.vm.logRightsImp("ecommerce_coupon",27),this.closeCallbackCalled=!1}switchTitleAndBottom(t){this.countDownTextView.style={opacity:t?1:0},this.actionbarView.style={opacity:t?1:0},this.closeImage.style={opacity:t?.6:0}}updateCountdown(t){this.countDownTextView&&this.countDownTextView.setText(`限时福利 ${t}s 后消失`)}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:54,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(54,2).height>1.5*t){if((t-=2)<=18)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}tryReportImpression(){this.vm.logSplashCardImpression()}getActionBarSize(){return{width:169,height:48}}fitHorizontalScreenView(){}}class Ar extends vr{constructor(t){super(t)}fitHorizontalScreenView(){this.rootContainerView.style={paddingBottom:0},this.bgContainerView.style={width:181,height:175},this.bgImageView.style={width:181,height:175},this.bgBottomImageView.style={width:181,height:175},this.countDownTextView&&(this.countDownTextView.style={fontSize:16,marginBottom:4}),this.cardInfoView.style={left:26,top:26,width:60},this.cardTitleText.style={fontSize:14},this.cardDescText.style={fontSize:8},this.ipImageView.style={width:83,height:83,right:8,top:1},this.couponInfoView.style={left:21,bottom:25,width:140,height:46},this.priceView.style={paddingLeft:4,height:40},this.priceSymbolText.style={fontSize:10,marginRight:-2},this.priceText.style={width:32},this.couponDescView.style={height:40},this.couponTitleText.style={fontSize:10},this.couponDescText.style={fontSize:7,marginTop:2},this.actionbarView&&(this.actionbarView.style={width:113,height:32,marginTop:10},this.actionbarBgImageView.style={width:113,height:32},this.actionbarText.style={width:113,height:32,fontSize:14},this.closeImage&&(this.closeImage.style={width:32,height:32,marginTop:6}))}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:32,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(32,2).height>1.5*t){if((t-=2)<=12)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}getActionBarSize(){return{width:112,height:32}}}class Vr extends TKView{constructor(t){super(),this.startDismissCalled=!1,this.vm=t,this.setupViews(),this.setupActions(),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.onDismiss(2))}))}setupViews(){this.setupRootView(),this.setupCountDownView(),this.setupBgView(),this.setupCardInfoView(),this.setupTipsView(),this.setupActionbarView(),this.setupCloseView()}setupRootView(){this.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"absolute"},this.contentView=new TKView,this.contentView.style={width:"100%",height:this.vm.getFullCardHeight(),flexDirection:"column",alignItems:"center",justifyContent:"center"},this.appendChild(this.contentView),this.contentView.clipChildren=!1,this.wrapperView=new TKView,this.wrapperView.style={width:"100%",height:this.vm.getFullCardHeight(),flexDirection:"column",alignItems:"center",justifyContent:"center"},this.contentView.appendChild(this.wrapperView),this.wrapperView.clipChildren=!1;const t=new TKView;t.style={width:"100%",marginTop:0,height:this.vm.getBottomTipsMarginBottom(52)},this.appendChild(t)}setupCountDownView(){let t=this.vm.getTitleSize();const e=new TKView;e.style={width:t.width,height:t.height,top:0,alignItems:"center",justifyContent:"center",position:"absolute"},this.wrapperView.appendChild(e),this.titleBg=new TKImage,this.titleBg.style={width:t.width,height:t.height,position:"absolute"},Ve(this.titleBg,"product_card_title_bg.png"),e.appendChild(this.titleBg),this.titleText=new TKText,this.titleText.style={color:"#FFFCF7",position:"absolute",fontWeight:"600",fontSize:32,height:45,width:"100%",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.titleText.setText("限时"+this.vm.getRightsCardStayTime()+"秒后消失"),e.appendChild(this.titleText)}setupBgView(){let t=this.vm.getCardBgSize();this.containerView=new TKView,this.containerView.style={width:t.width,height:t.height,flexDirection:"column",top:this.vm.getCardMarginTop(124),position:"absolute",left:0,right:0,alignItems:"center",justifyContent:"center"},this.contentView.appendChild(this.containerView);let e=this.vm.getFullCardBgUrl();Ce(e)||(this.cardBgView=new TKImage,this.cardBgView.style={width:"100%",height:"100%",position:"absolute"},Ve(this.cardBgView,e),this.containerView.appendChild(this.cardBgView));let i=this.vm.getWidgetSize();const n=new TKImage;n.style={width:i.width,height:i.height,top:this.vm.getCardMarginTop(11),position:"absolute"},Ve(n,"ec_activity_automaton.png"),this.containerView.appendChild(n);let s=this.vm.getCardViewSize();this.cardView=new TKImage,this.cardView.style={width:s.width,height:s.height,borderRadius:s.borderRadius,position:"absolute"},this.cardView.setSrc(this.vm.getRightsCardCustomImageUrl()),this.containerView.appendChild(this.cardView)}setupCardInfoView(){this.rightCardTitleText=new TKText,this.rightCardTitleText.style={width:200,fontSize:20,fontWeight:"500",color:"#FFFCF1",height:28,top:this.vm.getCardMarginTop(91),textAlign:"center",textLineClamp:1,textOverflow:"clip",position:"absolute"},this.rightCardTitleText.setText(this.vm.getRightsCardTitle()),this.containerView.appendChild(this.rightCardTitleText)}setupTipsView(){let t=this.vm.getBottomTipsText();if(Ce(t))return;let e=new TKText;e.style={width:"100%",height:15,fontSize:10,color:"#FFF9F9",opacity:.5,includeFontPadding:!1,fontWeight:"400",textAlign:"center",position:"absolute",bottom:this.vm.getBottomTipsMarginBottom(42)},e.setText(t),this.containerView.appendChild(e)}setupActionbarView(){this.actionBarView=new TKView,this.actionBarView.style={width:this.vm.getButtonSize().width,height:this.vm.getButtonSize().height,borderRadius:this.vm.getButtonSize().borderRadius,bottom:this.vm.getBottomTipsMarginBottom(64),position:"absolute"},this.contentView.appendChild(this.actionBarView),this.actionBarView.clipChildren=!1;let t=new TKImage;t.style={width:"100%",height:"100%",position:"absolute"},Ve(t,"product_card_button.png"),this.actionBarView.appendChild(t),this.actionBarText=new TKText,this.actionBarText.style={color:"#FFFFFF",width:"90%",height:"100%",alignSelf:"center",fontWeight:"600",fontSize:20,position:"absolute",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLetterSpace:1.5},this.actionBarText.setText(this.vm.getRightsCardAction()),this.actionBarView.appendChild(this.actionBarText)}setupCloseView(){this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={bottom:0,width:40,height:40,opacity:0,resize:"contain",position:"absolute"},this.wrapperView.appendChild(this.closeView)}showRightsDialogCard(t,e){const i=this;this.titleBg.style={opacity:0},this.titleText.style={opacity:0},this.actionBarView.style={opacity:0},this.closeView.style={opacity:0},Ir.addCardShowAnimation(this.containerView,(()=>{i.titleAndBottomShow(),i.cricleAnimation(),i.cardAppearCallback&&i.cardAppearCallback()})),this.showType=t,this.vm.logRightsImp(this.showType,e),this.startDismissCalled=!1}titleAndBottomShow(){this.titleBg.style={opacity:1},this.titleText.style={opacity:1},this.actionBarView.style={opacity:1},this.closeView.style={opacity:.6}}cricleAnimation(){Le.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080));let t=new wr,e=(this.vm.callerContext.containerLimit.width-Number(this.vm.getButtonSize().width))/2-25;t.style={width:this.vm.getHandViewSideLength(),height:this.vm.getHandViewSideLength(),right:e,bottom:40,position:"absolute"},this.contentView.appendChild(t)}addSweepAnimation(){if(this.sweepView&&this.actionBarView.removeChild(this.sweepView),Le.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.vm.getButtonSize().width,height:this.vm.getButtonSize().height,borderRadius:this.vm.getButtonSize().borderRadius,left:0,top:0,position:"absolute"};const t=34;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.vm.getButtonSize().height,left:-t,top:0,opacity:1,position:"absolute"},this.sweepView.appendChild(this.sweepImage),Ve(this.sweepImage,"icon_ksad_extra_reward_sweep.png"),this.actionBarView.appendChild(this.sweepView);let e=t+Number(this.vm.getButtonSize().width);this.sweepImage.addAnimation(xi(540,e),"anim")}}setupActions(){pt(this.vm.callerContext.adInfo,1)&&this.actionBarView.addEventListener("tap",(e=>{const i=pe(e,this.actionBarView);let n=new b;n.template_show_type=this.showType,this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),pt(this.vm.callerContext.adInfo,2)&&this.containerView.addEventListener("tap",(e=>{const i=pe(e,this.containerView);let n=new b;n.template_show_type=this.showType,this.vm.convert(i,2,t.CARD_ACTION_BAR_CLICK,n),this.onDismiss(3)})),this.closeView.addEventListener("tap",(t=>{this.onDismiss(1)}))}updateCountdown(t){this.titleText&&this.titleText.setText(`限时${t}秒后消失`)}onDismiss(t){this.startDismissCalled||(this.startDismissCallback&&this.startDismissCallback(this.contentView,t),this.removeAllAnimation(),this.sweepTimer&&clearInterval(this.sweepTimer),this.startDismissCalled=!0)}}class br extends TKView{constructor(t){super(),this.vm=t,fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"==t&&this.timePlay&&this.timePlay.resume(),"pageInvisiable"==t&&this.timePlay&&this.timePlay.paused()})),Le.supportMinimumTKVersion("5.0.0")&&this.initViews()}initViews(){this.style={width:"100%",height:"100%",backgroundColor:"#00000099",alignContent:"center",alignItems:"center",justifyContent:"center"},this.containerView=new TKView,this.containerView.style={width:"100%",height:"100%",alignContent:"center",alignItems:"center",justifyContent:"center"},this.appendChild(this.containerView),Le.supportMinimumTKVersion("5.0.0")&&(this.lottieView1=new TKLottieImageView,this.lottieView1.style={width:500,height:515,opacity:0,position:"absolute"},this.containerView.appendChild(this.lottieView1),this.lottieView1.setUri(Ae("ecIndustry_interact_atmosphere_lottie1.json")),this.lottieView2=new TKLottieImageView,this.lottieView2.style={width:500,height:515,opacity:0,position:"absolute"},this.containerView.appendChild(this.lottieView2),this.lottieView2.setUri(Ae("ecIndustry_interact_atmosphere_lottie2.json")))}showECIndustCard(){this.vm.enableInteractCard()?this.showInteractCard():this.showRightsCard()}showInteractCard(){this.interactView=new fr(this.vm),this.containerView.appendChild(this.interactView),this.interactView.callbackClose=this.callbackClose,this.interactView.interactCallback=()=>{this.dismissAnim(),this.lottieView1.style={opacity:1},this.lottieView1.play();const t=this;this.lottieView1.onAnimationEnd((()=>{t.removeChild(t.lottieView1),t.lottieView2.style={opacity:1},t.lottieView2.play(),t.lottieView2.setLoop(!0)}))}}dismissAnim(){const t=new TKImage;t.style={width:324,height:445,opacity:0,position:"absolute"},this.containerView.appendChild(t),Ve(t,"ecIndustry_interact_gold_card.png");let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={transform:{scale:1.14},opacity:1},1)]),e.duration=330,e.timingFunction="linear",t.addAnimation(e,"goldViewOpacityAnim"),e.on("end",(()=>{let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={opacity:0},1)]),e.duration=170,e.timingFunction="linear",t.addAnimation(e,"goldViewDismissAnim"),this.showRightsCard()}));const i=this;let n=new TKKeyframeAnimation;n.setAnimations([()=>(i.interactView.style={transform:{scale:1.106},opacity:1},.76),()=>(i.interactView.style={transform:{scale:1.127},opacity:0},.91),()=>(i.interactView.style={transform:{scale:1.14},opacity:0},1)]),n.duration=330,n.timingFunction="linear",i.interactView.addAnimation(n,"dissmissAnim"),n.on("end",(()=>{i.removeChild(i.interactView)}))}showRightsCard(){if(this.vm.industryInfo){switch(this.vm.industryInfo.merchantStyleType){case T.COUPON:this.showCouponCard();break;case T.EVENT:this.showActivityCard("benefit_card_activity",26);break;case T.PRODUCT:case T.PRODUCT_DEEP_VIDEO:this.showProductCard();break;case T.DEFAULT:this.showActivityCard("benefit_card_default",28)}}else this.vm.isCouponLegacy()&&this.showCouponCard();this.startTimer()}startTimer(){this.timePlay=new ns(1e3*this.vm.getRightsCardStayTime()),this.timePlay.setTimerInterval(1e3),this.timePlay.onFinishCallback=()=>{this.productView?this.productView.onDismiss(2):this.activityView?this.activityView.onDismiss(2):this.ecCardView?this.ecCardView.handleCloseClick(2):this.callbackClose&&this.callbackClose(2),this.timePlay&&this.timePlay.stop()},this.timePlay.countDownCallback=t=>{this.updateCountdown(t.toFixed())}}updateCountdown(t){this.ecCardView&&this.ecCardView.updateCountdown(t),this.productView&&this.productView.updateCountdown(t),this.activityView&&this.activityView.updateCountdown(t)}showProductCard(){if(this.productView)return;let t=this.vm;this.productView=new Tr(t),this.containerView.appendChild(this.productView);const e=this;this.productView.startDismissCallback=(t,i)=>{e.dismissCardAnimation(t,"productDismiss",(()=>{e.callbackClose&&e.callbackClose(i)}))},this.productView.showRightsDialogCard(),this.productView.cardAppearCallback=()=>{this.timePlay.play()}}showCouponCard(){if(this.ecCardView)return;let t=this.vm;t.isVertical()?this.ecCardView=new vr(t):this.ecCardView=new Ar(t);const e=this;this.ecCardView.onCloseClick=(t,i)=>{e.dismissCardAnimation(t,"productDismiss",(()=>{e.callbackClose&&e.callbackClose(i)}))},this.containerView.appendChild(this.ecCardView),this.ecCardView.cardAnimFinish=()=>{this.timePlay.play()},this.ecCardView.show()}showActivityCard(t,e){if(this.activityView)return;let i=this.vm;this.activityView=new Vr(i),this.lottieView1&&(this.lottieView1.style={width:i.getLottieSize().width,height:i.getLottieSize().height}),this.lottieView2&&(this.lottieView2.style={width:i.getLottieSize().width,height:i.getLottieSize().height}),this.containerView.appendChild(this.activityView);const n=this;this.activityView.startDismissCallback=(t,e)=>{n.dismissCardAnimation(t,"activityViewDismiss",(()=>{n.callbackClose&&n.callbackClose(e)}))},this.activityView.showRightsDialogCard(t,e),this.activityView.cardAppearCallback=()=>{this.timePlay.play()}}dismissCardAnimation(t,e,i){this.lottieView2.stop(),this.removeChild(this.lottieView2);let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{translate:{y:8}}},1)]),n.duration=250,n.timingFunction="0.42 0 0.58 1",t.addAnimation(n,e),n.on("end",(()=>{let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{translate:{y:-16.7}},opacity:1},.333),()=>(t.style={transform:{translate:{y:-50}},opacity:0},1)]),n.duration=300,n.timingFunction="0.42 0 0.58 1";const s=e+"ScaleAnim";t.addAnimation(n,s),n.on("end",(()=>{i&&i()}))}))}}class Sr extends TKView{constructor(t){super(),this.vm=t,this.setupView(),this.setupAction(),this.fitHorizontalScreenView(),this.vm.getActionBarRect=()=>({x:this.actionbarView.getOrigin().x,y:this.actionbarView.getOrigin().y,width:169,height:48}),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&this.sweepTimer&&clearInterval(this.sweepTimer)}))}setupView(){this.setupRootView(),this.setupCountDownView(),this.setupBgView(),this.setupCardInfoView(),this.setupCouponInfoView(),this.setupActionbarView(),this.setupCloseView(),this.tryReportImpression()}setupAction(){this.actionbarView&&this.actionbarView.addEventListener("tap",(e=>{const i=pe(e,this.actionbarView);this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK),this.vm.enableShowCloseView()&&this.onCloseClick&&this.onCloseClick(3)})),this.closeImage&&this.closeImage.addEventListener("tap",(t=>{this.onCloseClick&&this.onCloseClick(1)})),this.vm.isSplashScene()||this.vm.isInterstitialScene()||this.bgContainerView.addEventListener("tap",(e=>{const i=pe(e,this.bgContainerView);this.vm.convert(i,2,t.CARD_OTHERAREA_CLICK),this.onCloseClick&&this.onCloseClick(3)}))}setupRootView(){this.actionBarSize=this.getActionBarSize(),this.style={width:"100%",height:"100%",backgroundColor:"#00000099",flexDirection:"column",alignItems:"center",justifyContent:"center"},this.rootContainerView=new TKView,this.rootContainerView.style={width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingBottom:52},this.vm.enableShowCloseView()&&(this.rootContainerView.style={transform:{scale:0},opacity:0}),this.appendChild(this.rootContainerView)}setupCountDownView(){if(!this.vm.enableShowCountDownView())return;let t=new TKView;t.style={shadow:"0 0 26 #FFDF8E99"},this.countDownTextView=new TKText,this.countDownTextView.style={fontSize:22,marginBottom:8,fontWeight:"600",color:Le.isAndroid()?"#FFE296":"#FFF7E0",gradientTextColor:"270,FFFFFF,FFE296"},t.appendChild(this.countDownTextView),this.countDownTextView.setText("限时福利 "+this.vm.getRightsCardStayTime()+"s 后消失"),this.rootContainerView.appendChild(t)}setupBgView(){this.bgContainerView=new TKView,this.bgContainerView.style={width:273,height:263,flexDirection:"column",alignItems:"center"},this.rootContainerView.appendChild(this.bgContainerView),this.bgImageView=new TKImage,this.bgImageView.style={width:273,height:263,bottomLeftRadius:60,bottomRightRadius:60},this.bgImageView.setSrc(this.vm.getBgUrl()),this.bgContainerView.appendChild(this.bgImageView),this.setupIPView(),this.bgBottomImageView=new TKImage,this.bgBottomImageView.style={width:273,height:263,position:"absolute",left:0,top:0},Ve(this.bgBottomImageView,this.vm.getBottomImageViewName()),this.bgContainerView.appendChild(this.bgBottomImageView),this.setupTipsView()}setupTipsView(){let t=this.vm.getBottomTipsText();if(Ce(t))return;let e=new TKText;e.style={maxWidth:"249",height:"15",fontSize:10,color:"#B8AB3B",includeFontPadding:!1,textAlign:"center",position:"absolute",bottom:10},e.setText(t),this.bgContainerView.appendChild(e)}setupCardInfoView(){this.cardInfoView=new TKView,this.cardInfoView.style={position:"absolute",left:40,width:84,top:34,flexDirection:"column"},this.bgContainerView.appendChild(this.cardInfoView),this.cardTitleText=new TKText,this.cardTitleText.style={fontSize:20,fontWeight:"900",color:"#FFFFFF"},this.cardTitleText.setText("恭喜获得"),this.cardInfoView.appendChild(this.cardTitleText),this.cardDescText=new TKText,this.cardDescText.style={color:"#FFFFFF",fontSize:11,marginTop:2,width:"100%",textLineClamp:1,textOverflow:"ellipsis"},this.cardDescText.setText(this.vm.getTitleDesc()),this.cardInfoView.appendChild(this.cardDescText)}setupIPView(){this.ipImageView=new TKImage,this.ipImageView.style={position:"absolute",right:12,top:1,width:134,height:134},this.ipImageView.setSrc(this.vm.getUserIcon()),this.bgContainerView.appendChild(this.ipImageView)}setupCouponInfoView(){this.couponInfoView=new TKView,this.couponInfoView.style={position:"absolute",left:31,bottom:38,width:211,height:69,flexDirection:"row",alignItems:"center"},this.bgContainerView.appendChild(this.couponInfoView),this.priceView=new TKView,this.priceView.style={paddingLeft:8,height:69,width:"36%",flexDirection:"row",alignItems:"center"},this.couponInfoView.appendChild(this.priceView);const t=this.getMeatureSize(this.vm.isVertical()?30:20);this.priceSymbolText=new TKText,this.priceSymbolText.style={fontSize:16,fontWeight:"500",color:"#FFFFFF",marginRight:-4,marginTop:(30==t?8:6)*t/30},this.priceSymbolText.setText("￥"),this.priceView.appendChild(this.priceSymbolText),this.priceText=new TKText,this.priceText.style={fontSize:t,color:"#FFFFFF",fontWeight:"600",width:54,textLineClamp:1,textOverflow:"ellipsis"},this.priceText.setText(this.vm.getPriceAmount()),this.priceView.appendChild(this.priceText),this.couponDescView=new TKView,this.couponDescView.style={flexDirection:"column",height:69,width:"64%",paddingRight:10,justifyContent:"center"},this.couponInfoView.appendChild(this.couponDescView),this.couponTitleText=new TKText,this.couponTitleText.style={fontSize:15,color:"#FFFFFF",textLineClamp:1,textOverflow:"ellipsis",fontWeight:"600"},this.couponTitleText.setText(this.vm.getCouponTitle()),this.couponDescView.appendChild(this.couponTitleText),this.couponDescText=new TKText,this.couponDescText.style={fontSize:10,color:"#FFFFFF",marginTop:4,textLineClamp:1,textOverflow:"ellipsis"},this.couponDescText.setText(this.vm.getCouponDesc()),this.couponDescView.appendChild(this.couponDescText)}setupActionbarView(){this.vm.enableShowActionbarView()&&(this.actionbarView=new TKView,this.actionbarView.style={width:169,height:48,borderRadius:this.actionBarSize.height/2,marginTop:16},this.rootContainerView.appendChild(this.actionbarView),this.actionbarBgImageView=new TKImage,this.actionbarBgImageView.style={width:169,height:48},Ve(this.actionbarBgImageView,"ec_card_actionbar_bg.png"),this.actionbarView.appendChild(this.actionbarBgImageView),this.actionbarText=new TKText,this.actionbarText.style={position:"absolute",left:0,top:-1,fontWeight:"600",width:169,height:48,paddingLeft:10,paddingRight:10,textLineClamp:1,minimumTextScaleFactor:.5,textOverflow:"ellipsis",textAlign:"center",color:"#FFFFFF",fontSize:20},this.actionbarView.appendChild(this.actionbarText),1==this.vm.callerContext.adInfo.adBaseInfo.adOperationType?Ci(this.actionbarText,"text",this.vm.$attrsPath.actionBarText):this.actionbarText.setText(this.vm.getActionbarDesc()),this.tryShowSweepAnimation())}tryShowSweepAnimation(){this.vm.enableAnimation()&&Le.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),2e3))}addSweepAnimation(){if(this.sweepView&&this.actionbarView.removeChild(this.sweepView),Le.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:this.actionBarSize.height,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=128*this.actionBarSize.height/60;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,position:"absolute"},this.sweepView.appendChild(this.sweepImage),Ve(this.sweepImage,"ksad_light.png"),this.actionbarView.appendChild(this.sweepView),this.sweepImage.addAnimation(xi(1e3,this.actionBarSize.width+t),"anim")}}setupCloseView(){this.vm.enableShowCloseView()&&(this.closeImage=new TKImage,this.closeImage.style={width:40,height:40,marginTop:10},Ve(this.closeImage,"ec_card_close.png"),this.rootContainerView.appendChild(this.closeImage))}show(){this.startShowAnimation()}updateCountdown(t){this.countDownTextView&&this.countDownTextView.setText(`限时福利 ${t}s 后消失`)}startShowAnimation(){let t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.rootContainerView.style={transform:{scale:0},opacity:0},0),()=>(t.rootContainerView.style={transform:{scale:1},opacity:1},1)]),e.duration=600,e.timingFunction="linear",this.rootContainerView.addAnimation(e,"ecShowAnimation")}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:54,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(54,2).height>1.5*t){if((t-=2)<=18)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}tryReportImpression(){this.vm.logSplashCardImpression()}getActionBarSize(){return{width:169,height:48}}fitHorizontalScreenView(){}}class xr extends Sr{constructor(t){super(t)}fitHorizontalScreenView(){this.rootContainerView.style={paddingBottom:0},this.bgContainerView.style={width:181,height:175},this.bgImageView.style={width:181,height:175},this.bgBottomImageView.style={width:181,height:175},this.countDownTextView&&(this.countDownTextView.style={fontSize:16,marginBottom:4}),this.cardInfoView.style={left:26,top:26,width:60},this.cardTitleText.style={fontSize:14},this.cardDescText.style={fontSize:8},this.ipImageView.style={width:83,height:83,right:8,top:1},this.couponInfoView.style={left:21,bottom:25,width:140,height:46},this.priceView.style={paddingLeft:4,height:40},this.priceSymbolText.style={fontSize:10,marginRight:-2},this.priceText.style={width:32},this.couponDescView.style={height:40},this.couponTitleText.style={fontSize:10},this.couponDescText.style={fontSize:7,marginTop:2},this.actionbarView&&(this.actionbarView.style={width:113,height:32,marginTop:10},this.actionbarBgImageView.style={width:113,height:32},this.actionbarText.style={width:113,height:32,fontSize:14},this.closeImage&&(this.closeImage.style={width:32,height:32,marginTop:6}))}getMeatureSize(t){try{let e=new TKText;if(e.style={fontSize:t,width:32,fontWeight:"600"},e.setText(this.vm.getPriceAmount()),e.measureText(32,2).height>1.5*t){if((t-=2)<=12)return t;t=this.getMeatureSize(t)}}catch(e){return t}return t}getActionBarSize(){return{width:112,height:32}}}class _r extends ur{constructor(t){super(),this.mTimerInterval=100,this.mTimerCurrent=0,this.mTimerPaused=!1,this.showLegacyView=!1,this.vm=t,this.mTotalStayTime=1e3*this.vm.getRightsCardStayTime(),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"!=t&&"pageInvisiable"!=t||(this.mTimerPaused="pageVisiable"!=t)}))}initView(){if(Le.supportMinimumTKVersion("5.0.0")){this.vm.getRightsCardVM();this.showLegacyView=this.vm.isLegacyVM(),this.showLegacyView?this.setupOldCouponView():this.setupViews()}}showDialog(t){this.isShowing()||null==this.ecCardView&&this.showLegacyView||(null!=this.interactView||this.showLegacyView)&&(super.showDialog(t),this.showLegacyView?(this.ecCardView.show(),this.couponVM.logECCardImpression(),this.startTimer()):this.interactView.showECIndustCard())}setupOldCouponView(){this.couponVM=this.vm.getRightsCardVM(),this.vm.isVertical()?this.ecCardView=new Sr(this.couponVM):this.ecCardView=new xr(this.couponVM),this.ecCardView.onCloseClick=t=>{this.callbackCloseTrigger(t)},this.vm.cardCreateSuccess=null!=this.ecCardView,this.appendChild(this.ecCardView)}setupViews(){let t=this.vm.getRightsCardVM();t&&(this.vm.isVertical()||t.supportHorizontal())&&(this.interactView=new br(this.vm.getRightsCardVM())),this.vm.cardCreateSuccess=null!=this.interactView,this.interactView&&(this.interactView=new br(this.vm.getRightsCardVM()),this.interactView.callbackClose=t=>{this.callbackCloseTrigger(t)},this.appendChild(this.interactView))}callbackCloseTrigger(t){this.vm.logCloseReport(t,this.vm.getRightsCardVM().templateShowType),this.onCloseTrigger&&this.onCloseTrigger()}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{if(!this.mTimerPaused)if(this.mTimerCurrent+=this.mTimerInterval,this.mTimerCurrent>this.mTotalStayTime)this.stopTimer(),this.callbackCloseTrigger(2);else if(this.mTimerCurrent<this.mTotalStayTime){let t=Math.ceil((this.mTotalStayTime-this.mTimerCurrent)/1e3).toFixed();this.updateCountdown(t)}}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}updateCountdown(t){this.ecCardView.updateCountdown(t)}}const Lr="rights_bg_animation_circle.png",Dr="rights_card_gift.png";class Fr extends TKView{constructor(t){super(),this.actionBarSize={width:235,height:48},this.vm=t,this.setupViews()}setupViews(){this.style={height:"100%",width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"absolute"},this.setupContainer();const t=this;fi(this.vm.$attrsPath.callerContext.lifeStatus,(e=>{"hideEnd"==e&&t.onDismiss(),"pageVisiable"==e&&t.timePlay&&t.timePlay.resume(),"pageInvisiable"==e&&t.timePlay&&t.timePlay.paused()}))}showWidget(){this.titleText.style={opacity:0},this.titleBg.style={opacity:0},this.lightImage.style={opacity:0},this.cardBgView.style={opacity:0},this.closeView.style={opacity:0},Le.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080));let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.cardContent.style={transform:{scale:1}},0),()=>(this.cardContent.style={transform:{scale:.6}},1)]),t.duration=350,t.timingFunction="linear",this.cardContent.addAnimation(t,"cardAnim");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.actionBarView.style={transform:{scale:1,translate:{y:0}}},0),()=>(this.actionBarView.style={transform:{scale:.8,translate:{y:-143}}},1)]),e.duration=350,e.timingFunction="linear",this.actionBarView.addAnimation(e,"buttonAnim");const i=this;e.on("end",(()=>{let t=this.vm.getRightsCardCodeDesc()+this.vm.getRightsCardCode();me(t)||(t=this.vm.getRightsCardAction()),i.actionBarText.setText(t)}))}showRightsDialogCard(){const t=this;this.timePlay=new ns(this.vm.getRightsShowTime()),this.timePlay.onFinishCallback=()=>{t.callbackClose&&t.callbackClose(2),t.onDismiss()},this.timePlay.play(),this.titleBg.style={opacity:0},this.titleText.style={opacity:0},this.actionBarView.style={opacity:0},this.cardContent.style={transform:{scale:.3,translate:{y:120}}},this.showCardAnimation((()=>{t.titleAndBottomShow(),t.cricleAnimation()})),setTimeout((()=>{this.showBubbleBg()}),140),this.vm.logRightsImp(),this.setupActions(),this.vm.copyRightsCode()}showCardAnimation(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.cardContent.style={transform:{scale:.2,translate:{y:120}}},0),()=>(this.cardContent.style={transform:{scale:1.03,translate:{y:0}}},1)]),e.duration=250,e.timingFunction="linear",this.cardContent.addAnimation(e,"cardContentAnim");const i=this;e.on("end",(()=>{t&&t();let e=new TKKeyframeAnimation;e.setAnimations([()=>(i.cardContent.style={transform:{scale:1.03}},0),()=>(i.cardContent.style={transform:{scale:.96}},.5),()=>(i.cardContent.style={transform:{scale:1}},1)]),e.duration=400,e.timingFunction="linear",i.cardContent.addAnimation(e,"cardScaleAnim"),e.on("end",(()=>{}))}))}showBubbleBg(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.cardBgView.style={opacity:0},0),()=>(this.cardBgView.style={opacity:.5},1)]),t.duration=150,t.timingFunction="linear",this.cardBgView.addAnimation(t,"bubbleAnim")}titleAndBottomShow(){this.titleBg.style={opacity:1},this.titleText.style={opacity:1},this.actionBarView.style={opacity:1}}cricleAnimation(){Le.supportMinimumTKVersion("5.0.0")&&(this.sweepTimer&&clearInterval(this.sweepTimer),this.addSweepAnimation(),this.sweepTimer=setInterval((()=>{this.addSweepAnimation()}),1080)),this.lightHalfTimer&&clearInterval(this.lightHalfTimer),this.addHalfLightAnimation(this.lightHalfImage,.2),this.lightHalfTimer=setInterval((()=>{this.addHalfLightAnimation(this.lightHalfImage,.2)}),1200),this.lightTimer&&clearInterval(this.lightTimer),this.addLightAnimation(this.lightImage,1),this.lightTimer=setInterval((()=>{this.addLightAnimation(this.lightImage,1)}),1200),this.bubbleTimer&&clearInterval(this.bubbleTimer),this.addBubbleAnimation(),this.bubbleTimer=setInterval((()=>{this.addBubbleAnimation()}),1200);let t=new wr;t.style={width:90,height:90,right:(this.vm.callerContext.containerLimit.width-this.actionBarSize.width)/2-30,bottom:41,position:"absolute"},this.containerView.appendChild(t)}addBubbleAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.cardBgView.style={opacity:.5},0),()=>(this.cardBgView.style={opacity:1},.66),()=>(this.cardBgView.style={opacity:.5},1)]),t.duration=1200,t.timingFunction="linear",this.cardBgView.addAnimation(t,"bubbleCricleAnim")}addLightAnimation(t,e){t.style={opacity:0,transform:{scale:.2}};let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:e},.05),()=>(t.style={opacity:e},.77),()=>(t.style={opacity:0},1)]),i.duration=1100,i.timingFunction="linear",t.addAnimation(i,"opacityAnim"+e);let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{scale:.2}},0),()=>(t.style={transform:{scale:1.25}},1)]),n.duration=1100,n.timingFunction="linear",t.addAnimation(n,"scaleAnim"+e)}addHalfLightAnimation(t,e){t.style={opacity:0,transform:{scale:.2}};let i=new TKKeyframeAnimation;i.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:e},.05),()=>(t.style={opacity:e},.77),()=>(t.style={opacity:0},1)]),i.duration=800,i.timingFunction="linear",t.addAnimation(i,"opacityAnim"+e);let n=new TKKeyframeAnimation;n.setAnimations([()=>(t.style={transform:{scale:.2}},0),()=>(t.style={transform:{scale:1.25}},1)]),n.duration=800,n.timingFunction="linear",t.addAnimation(n,"scaleAnim"+e)}addSweepAnimation(){if(this.sweepView&&this.actionBarView.removeChild(this.sweepView),Le.supportMinimumTKVersion("5.0.0")){this.sweepView=new RoundRectView,this.sweepView.style={width:this.actionBarSize.width,height:48,borderRadius:this.actionBarSize.height/2,left:0,top:0,position:"absolute"};const t=34;this.sweepImage=new TKImage,this.sweepImage.style={width:t,height:this.actionBarSize.height,left:-t,top:0,opacity:1,position:"absolute"},this.sweepView.appendChild(this.sweepImage),Ve(this.sweepImage,"icon_ksad_extra_reward_sweep.png"),this.actionBarView.appendChild(this.sweepView),this.sweepImage.addAnimation(xi(540,this.actionBarSize.width+t),"anim")}}setupContainer(){this.containerView=new TKView,this.containerView.style={width:"100%",height:572,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.containerView.clipChildren=!1,this.appendChild(this.containerView),this.setupTitleView(this.containerView),this.setupCardBgView(this.containerView),this.setupCardView(this.containerView),this.setupActionbar(this.containerView),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={marginTop:28,width:40,height:40,opacity:.6,resize:"contain"},this.containerView.appendChild(this.closeView)}setupTitleView(t){const e=(this.vm.callerContext.containerLimit.height-572-256)/2+45;this.titleBg=new TKImage,this.titleBg.style={width:460,height:256,top:e+(he()?10:0),left:(this.vm.callerContext.containerLimit.width-460)/2,position:"absolute"},Ve(this.titleBg,"rights_title_bg2.png"),this.insertBefore(this.titleBg,t),this.titleText=new TKText,this.titleText.style={color:"#FFFCF7",fontWeight:"600",fontSize:32,height:45,width:"100%",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.titleText.setText(this.vm.getRightsCardTitle()),t.appendChild(this.titleText)}setupCardBgView(t){const e=(this.vm.callerContext.containerLimit.width-406)/2;this.cardBgView=new TKImage,this.cardBgView.style={left:e,top:66,width:406,height:416,position:"absolute",opacity:0},Ve(this.cardBgView,"rights_bg_bubble.png"),t.appendChild(this.cardBgView),this.lightHalfImage=new TKImage,this.lightHalfImage.style={left:(this.vm.callerContext.containerLimit.width-390)/2,top:72,width:390,height:390,opacity:0,position:"absolute"},Ve(this.lightHalfImage,Lr),t.appendChild(this.lightHalfImage),this.lightImage=new TKImage,this.lightImage.style={left:(this.vm.callerContext.containerLimit.width-300)/2,top:117,width:300,height:300,opacity:0,position:"absolute"},Ve(this.lightImage,Lr),t.appendChild(this.lightImage)}setupCardView(t){this.cardContent=new TKView,this.cardContent.clipChildren=!1,this.cardContent.style={marginTop:26,width:238,height:357},t.appendChild(this.cardContent);let e=new TKImage;e.style={left:-88,top:-42,width:414,height:441,opacity:.5,position:"absolute"},Ve(e,"rights_card_bg_shadow2.png"),this.cardContent.appendChild(e);let i=new TKImage;i.style={width:"100%",height:"100%",position:"absolute"},Ve(i,0==this.vm.clickType?"rights_card_bg2.png":"rights_card_bg_blue2.png"),this.cardContent.appendChild(i);let n=new TKImage;n.style={left:-59.5,bottom:-80,width:348,height:299,position:"absolute"},Ve(n,0==this.vm.clickType?"rights_card_bg_halo2.png":"rights_card_bg_blue_halo2.png"),this.cardContent.appendChild(n);let s=new TKView;if(s.style={width:"100%",position:"absolute",alignSelf:"center",flexDirection:"row",justifyContent:"center",alignItems:"center"},this.cardContent.appendChild(s),0==this.vm.getRightsGiftStyle()){s.style={marginTop:me(this.vm.getRightsCardCode())?96:113,height:168};let t=new TKImage;Ve(t,0==this.vm.clickType?"rights_card_gift_bg.png":"rights_card_gift_bg_blue.png"),t.style={width:168,height:168,alignSelf:"center",position:"absolute"},s.appendChild(t);let e,i=this.vm.getRightsIconLis();i.length>0&&(e=i[0]);let n=new TKImage;n.setSrc(e?e.cardIcon:Dr),n.style={width:168,height:168,borderRadius:8,alignSelf:"center",position:"absolute"},s.appendChild(n)}else{s.style={marginTop:126,height:86,width:202};const t=this.vm.getRightsIconLis(),e=t.length>3?3:t.length;for(let i=0;i<e;i++){let e;t.length>i&&(e=t[i]);let n=new TKView;n.style={marginLeft:i>0?8:0,width:56,height:86},s.appendChild(n);let a=new TKImage;Ve(a,0==this.vm.clickType?"rights_multi_num.png":"rights_multi_num_blue.png"),a.style={width:56,height:86,position:"absolute"},n.appendChild(a);let o=new TKImage;o.setSrc(e?e.cardIcon:Dr),o.style={marginTop:14,width:56,height:56,alignSelf:"center",position:"absolute"},n.appendChild(o);let r=me(e.cardIconDesc)?e.cardIconDesc:"x1",h=new TKText;h.style={fontSize:11,fontWeight:"500",color:"#FFFFFF",height:15.5,width:"100%",textAlign:"center",position:"absolute",bottom:0,textLineClamp:1,textOverflow:"ellipsis"},h.setText(r),n.appendChild(h)}}if(me(this.vm.getRightsCardCode())){let t=new TKView;t.style={top:270,height:48,width:"100%",position:"absolute",flexDirection:"column",justifyContent:"space-between",alignItems:"center"},this.cardContent.appendChild(t);let e=new TKImage;e.style={width:168,height:8.5},Ve(e,0==this.vm.clickType?"rights_card_line.png":"rights_card_line_blue.png"),t.appendChild(e);let i=new TKView;if(i.style={height:26,marginBottom:5,marginLeft:this.vm.enableCopy()?20:0,flexDirection:"row",justifyContent:"flex-start",alignItems:"flex-end"},t.appendChild(i),this.codeText=new TKText,this.codeText.style={maxWidth:"80%",fontSize:14,fontWeight:"400",color:0==this.vm.clickType?"#DE8029":"#569FAF",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis"},this.codeText.text=this.vm.getRightsCardCodeDesc()+this.vm.getRightsCardCode(),i.appendChild(this.codeText),this.vm.enableCopy()){let t=new TKView;t.style={marginLeft:3,width:36,height:"100%",flexDirection:"column",justifyContent:"flex-start"},i.appendChild(t);let e=new TKText;e.style={width:36,height:15,fontSize:8.5,fontWeight:"500",color:0==this.vm.clickType?"#DE8029":"#569FAF",backgroundColor:0==this.vm.clickType?"#F8E1AB":"#C6E8EF",textAlign:"center",topLeftRadius:7.5,topRightRadius:7.5,bottomRightRadius:7.5},e.text="已复制",t.appendChild(e)}}}setupActionbar(t){this.actionBarView=new TKView,this.actionBarView.style={marginTop:28,width:235,height:48,borderRadius:24},this.actionBarView.clipChildren=!0,t.appendChild(this.actionBarView);let e=new TKImage;e.style={width:"100%",height:"100%",position:"absolute"},Ve(e,0==this.vm.clickType?"rights_button2.png":"rights_button_blue2.png"),this.actionBarView.appendChild(e),this.actionBarText=new TKText,this.actionBarText.style={color:"#FFFFFF",width:"90%",height:"100%",alignSelf:"center",fontWeight:"600",fontSize:20,position:"absolute",textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLetterSpace:1.5},this.actionBarText.setText(this.vm.getRightsCardAction()),this.actionBarView.appendChild(this.actionBarText)}setupActions(){this.actionBarView.addEventListener("tap",(e=>{const i=pe(e,this.actionBarView);let n=new b;n.template_show_type="benefit_card",this.vm.convert(i,1,t.CARD_ACTION_BAR_CLICK,n),this.callbackClose&&this.callbackClose(3),this.onDismiss()})),this.cardContent.addEventListener("tap",(e=>{const i=pe(e,this.actionBarView);let n=new b;n.template_show_type="benefit_card",this.vm.convert(i,2,t.CARD_ACTION_BAR_CLICK,n),this.callbackClose&&this.callbackClose(3),this.onDismiss()})),this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose(2),this.onDismiss()}))}onDismiss(){this.removeAllAnimation(),this.timePlay&&this.timePlay.stop(),this.sweepTimer&&clearInterval(this.sweepTimer),this.lightTimer&&clearInterval(this.lightTimer),this.lightHalfTimer&&clearInterval(this.lightHalfTimer),this.bubbleTimer&&clearInterval(this.bubbleTimer)}}class kr extends TKView{constructor(t){super(),this.isClick=!1,this.hasInteracted=!1,this.vm=t,this.vm.logInteractionImp(),this.setupViews(),this.showBaseAnim(this),this.showCardAnim(this.leftCardView,this.rightCardView),this.setupActions();const e=this;this.timePlay=new ns(this.vm.gameIndustryInfo.interactiveCardShowTime),this.timePlay.onFinishCallback=()=>{e.isClick||e.clickAction(0,3),this.isClick=!0},this.timePlay.play(),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&e.onDismiss(),"pageVisiable"==t&&e.timePlay&&e.timePlay.resume(),"pageInvisiable"==t&&e.timePlay&&e.timePlay.paused()}))}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",position:"absolute"};let t=new TKView;t.style={width:"100%",height:540,alignItems:"center"},this.appendChild(t),this.titleContentView=new TKView,this.titleContentView.style={width:382,height:87,top:12,justifyContent:"center",alignItems:"center"},t.appendChild(this.titleContentView);let e=new TKImage;e.style={width:382,height:87,position:"absolute"},Ve(e,"interact_card_title_bg.png"),this.titleContentView.appendChild(e);let i=new TKText;i.style={width:"100%",height:45,color:"#FBE5C3",fontSize:32,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center",fontWeight:"600"},i.setText(this.vm.getInteractTitle()),this.titleContentView.appendChild(i),this.subTitleContentView=new TKView,this.subTitleContentView.style={width:"100%",height:45,top:-7,flexDirection:"row",justifyContent:"center",alignItems:"center"},t.appendChild(this.subTitleContentView);let n=new TKImage;Ve(n,"interact_card_subtitle_left.png"),n.style={width:32,height:6,right:8},this.subTitleContentView.appendChild(n);let s=new TKText;s.style={width:208,height:45,color:"#FBE5C3",fontSize:16,textLineClamp:1,textOverflow:"ellipsis",textAlign:"center"},s.setText(this.vm.getInteractSubTitle()),this.subTitleContentView.appendChild(s);let a=new TKImage;Ve(a,"interact_card_subtitle_right.png"),a.style={width:32,height:6,left:8},this.subTitleContentView.appendChild(a),this.cardBaseView=new TKView,this.cardBaseView.style={marginTop:5,width:"100%",height:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",position:"absolute"},t.appendChild(this.cardBaseView);let o=new TKView;o.style={width:"100%",height:"100%",position:"absolute",alignItems:"center",justifyContent:"center",flexDirection:"row"},this.cardBaseView.appendChild(o),this.leftLightView=new TKView,this.leftLightView.style={height:265,width:180,shadow:"0 0 10 #FFF4CD44",borderRadius:14,visibility:"hidden"},o.appendChild(this.leftLightView),this.rightLightView=new TKView,this.rightLightView.style={marginStart:12,height:265,width:180,shadow:"0 0 10 #FFF4CD44"},o.appendChild(this.rightLightView),this.leftCardBaseView=new TKView,this.leftCardBaseView.style={height:261,width:174},this.leftCardView=new TKImage,this.leftCardView.style={height:261,width:174},this.leftSweepView=new TKImage,this.leftSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1"},this.cardBaseView.appendChild(this.leftCardBaseView),this.leftCardBaseView.appendChild(this.leftCardView),this.leftCardBaseView.appendChild(this.leftSweepView),this.rightCardBaseView=new TKView,this.rightCardBaseView.style={marginStart:18,height:261,width:174},this.rightCardView=new TKImage,this.rightCardView.style={height:261,width:174},this.rightSweepView=new TKImage,this.rightSweepView.style={height:319,width:148,position:"absolute",gradientBgColor:"180,#FFFFFF4D 0.4 ,#FFFFFF00 1",visibility:"hidden"},this.cardBaseView.appendChild(this.rightCardBaseView),this.rightCardBaseView.appendChild(this.rightCardView),this.rightCardBaseView.appendChild(this.rightSweepView),me(this.vm.getInteractIcon())?(this.leftLightView.setVisibility("hidden"),this.leftSweepView.setVisibility("hidden"),this.rightLightView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.leftCardView.setSrc(this.vm.getInteractIcon()),this.rightCardView.setSrc(this.vm.getInteractIcon())):(this.leftLightView.setVisibility("visible"),this.leftSweepView.setVisibility("visible"),this.rightLightView.setVisibility("visible"),this.sweepAnimation(),setTimeout((()=>{this.rightSweepView.setVisibility("visible"),this.sweepRightAnimation()}),800),this.leftCardView.setSrc("image/ksad-video-image/interact_card_bg.png"),this.rightCardView.setSrc("image/ksad-video-image/interact_card_bg_blue.png")),setTimeout((()=>{this.handAndBreatheView=new wr,this.isClick||(this.handAndBreatheView.style={width:120,height:120,right:-20,top:290,position:"absolute"},this.cardBaseView.appendChild(this.handAndBreatheView))}),668),this.lampAndCloseContentView=new TKView,this.lampAndCloseContentView.style={marginTop:300,width:"100%",height:110,alignItems:"center"},t.appendChild(this.lampAndCloseContentView),this.tagView=new Cr(this.vm.getInteractCustomerInfo()),this.tagView.style={width:"100%",height:40},this.lampAndCloseContentView.appendChild(this.tagView),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={marginTop:18,width:40,height:40,opacity:.6},this.lampAndCloseContentView.appendChild(this.closeView)}setupActions(){this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose(1),this.timePlay&&this.timePlay.stop()})),this.leftCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,this.clickAction(0,1))})),this.rightCardView.addEventListener("tap",(t=>{this.isClick||(this.isClick=!0,me(this.vm.getInteractIcon())||(this.vm.clickType=1),this.clickAction(1,2))}))}clickAction(t,e){this.leftSweepView.setVisibility("hidden"),this.rightSweepView.setVisibility("hidden"),this.vm.logInteractionClick(e),0==t?this.clickCardAnim(this.leftCardBaseView,this.rightCardView,t,this.leftLightView,this.rightLightView):this.clickCardAnim(this.rightCardBaseView,this.leftCardView,t,this.rightLightView,this.leftLightView),this.clickBaseAnim(this.titleContentView,this.subTitleContentView,this.lampAndCloseContentView)}showBaseAnim(t){let e=new TKKeyframeAnimation;e.duration=15,e.timingFunction="linear",e.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:1},1)]),t.addAnimation(e,"leftShowAnimation")}showCardAnim(t,e){let i=new TKKeyframeAnimation;i.duration=250,i.timingFunction="linear",i.setAnimations([()=>(t.style={opacity:0,left:-150},0),()=>(t.style={left:0,opacity:1},1)]),t.addAnimation(i,"leftShowAnimation");let n=new TKKeyframeAnimation;n.duration=250,n.timingFunction="linear",n.setAnimations([()=>(e.style={opacity:0,left:150},0),()=>(e.style={opacity:1,left:0},1)]),e.addAnimation(n,"rightShowAnimation");let s=new TKKeyframeAnimation;s.duration=250,s.timingFunction="linear",s.setAnimations([()=>(this.leftLightView.style={opacity:0,left:-150},0),()=>(this.leftLightView.style={left:0,opacity:1},1)]),this.leftLightView.addAnimation(s,"leftLightShowAnimation");let a=new TKKeyframeAnimation;a.duration=250,a.timingFunction="linear",a.setAnimations([()=>(this.rightLightView.style={opacity:0,left:150},0),()=>(this.rightLightView.style={opacity:1,left:0},1)]),this.rightLightView.addAnimation(a,"rightLightShowAnimation")}clickCardAnim(t,e,i,n,s){if(this.handAndBreatheView&&this.handAndBreatheView.setVisibility("hidden"),!me(this.vm.getInteractIcon())){let t=new TKKeyframeAnimation;t.duration=500,t.timingFunction="linear",t.setAnimations([()=>(n.style={},0),()=>(n.style={left:1==i?-99:99,transform:{scale:1.35}},1)]),n.addAnimation(t,"lightAnimation");let e=new TKKeyframeAnimation;e.duration=100,e.timingFunction="linear",e.setAnimations([()=>(s.style={opacity:1},0),()=>(s.style={opacity:0},1)]),s.addAnimation(e,"closelightAnimation")}let a=new TKKeyframeAnimation;a.duration=500,a.timingFunction="linear",a.setAnimations([()=>(t.style={},0),()=>(t.style={left:1==i?-99:99,transform:{scale:1.35}},1)]),t.addAnimation(a,"cardMoveAnimation");let o=new TKKeyframeAnimation;o.duration=100,o.timingFunction="linear",o.setAnimations([()=>(e.style={opacity:1},0),()=>(e.style={opacity:0},1)]),e.addAnimation(o,"cardDismissAnimation"),a.on("end",(()=>{this.interactCallback&&!this.hasInteracted&&(this.interactCallback(),this.hasInteracted=!0)}))}clickBaseAnim(t,e,i){let n=new TKKeyframeAnimation;n.duration=15,n.timingFunction="linear",n.setAnimations([()=>(t.style={opacity:1},e.style={opacity:1},i.style={opacity:1},0),()=>(t.style={opacity:0},e.style={opacity:0},i.style={opacity:0},1)]),t.addAnimation(n,"clickBaseAnimation")}sweepAnimation(){this.leftSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.leftSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.leftSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1e3,t.repeatCount=1,t.timingFunction="Linear",this.leftSweepView.addAnimation(t,"sweep")}),1500)}sweepRightAnimation(){this.rightSweepView.style={opacity:0},setInterval((()=>{let t=new TKBasicAnimation;t.setStartValue((()=>{this.rightSweepView.style={transform:{translate:{x:-148,y:-319},rotate:{z:60}},opacity:1}})),t.setEndValue((()=>{this.rightSweepView.style={transform:{translate:{x:148,y:319},rotate:{z:60}}}})),t.duration=1200,t.repeatCount=1,t.timingFunction="Linear",this.rightSweepView.addAnimation(t,"sweep")}),1500)}onDismiss(){this.removeAllAnimation(),this.tagView&&this.tagView.clearAnim(),this.handAndBreatheView&&this.handAndBreatheView.removeAllAnimation(),this.rightCardBaseView&&this.rightCardBaseView.removeAllAnimation(),this.leftCardBaseView&&this.leftCardBaseView.removeAllAnimation(),this.rightCardView&&this.rightCardView.removeAllAnimation(),this.leftCardView&&this.leftCardView.removeAllAnimation(),this.rightSweepView&&this.rightSweepView.removeAllAnimation(),this.leftSweepView&&this.leftSweepView.removeAllAnimation(),this.leftLightView&&this.leftLightView.removeAllAnimation(),this.rightLightView&&this.rightLightView.removeAllAnimation(),this.handAndBreatheView&&this.handAndBreatheView.clearHandClick(),this.timePlay&&this.timePlay.stop()}}class Rr extends TKView{constructor(t){super(),this.vm=t,this.style={width:"100%",height:"100%",backgroundColor:"#00000099"}}showGameIndustCard(){this.vm.enableInteractCard()?this.showInteractCard():this.showRightsCard()}showInteractCard(){const t=this;this.interactView=new kr(this.vm),this.appendChild(this.interactView),this.interactView.callbackClose=this.callbackClose,this.interactView.interactCallback=()=>{let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.interactView.style={opacity:0},1)]),e.duration=70,e.timingFunction="linear",t.interactView.addAnimation(e,"dissmissAnim"),e.on("end",(()=>{t.removeChild(t.interactView)})),t.showRightsCard()}}showRightsCard(){this.rightsView||(this.rightsView=new Fr(this.vm),this.appendChild(this.rightsView),this.rightsView.callbackClose=this.callbackClose,this.rightsView.showRightsDialogCard())}}class Br extends ur{constructor(t){super(),this.vm=t,this.setupViews()}showDialog(t){this.isShowing()||(super.showDialog(t),this.cardView.showGameIndustCard())}setupViews(){this.cardView=new Rr(this.vm),this.appendChild(this.cardView);const t=this;this.cardView.callbackClose=e=>{t.callbackCloseTrigger(e)}}callbackCloseTrigger(t){this.vm.logCloseReport(t),this.onCloseTrigger&&this.onCloseTrigger(t)}}class Kr extends TKView{constructor(e,i,n){super(),this.vm=e,this.endPositionFunc=i,this.setupViews(),this.vm.logWidgetImp(),this.addEventListener("tap",(e=>{let i=new b;i.template_show_type="pendant_card",this.vm.convert({x:e.position.rawX,y:e.position.rawY},1,t.CARD_ACTION_BAR_CLICK,i),this.callbackClose&&this.callbackClose(),this.onDismiss()}))}setupViews(){this.style={width:357,height:588,alignSelf:"center",position:"absolute",top:(this.vm.callerContext.containerLimit.height-588)/2},this.rightsView=new Fr(this.vm),this.rightsView.enabled=!1,this.appendChild(this.rightsView),this.rightsView.showWidget(),this.closeView=new TKImage,this.closeView.setSrc("image/ksad-video-image/icon_ksad_circle_close.png"),this.closeView.style={top:-2,right:7,width:20,height:20,position:"absolute"},this.appendChild(this.closeView),this.closeView.addEventListener("tap",(t=>{this.callbackClose&&this.callbackClose()}));let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.rightsView.style={width:357,height:588,transform:{scale:1,translate:{x:0,y:0}}},0),()=>(this.rightsView.style={width:300,height:280,transform:{scale:.4,translate:{x:-102,y:-68}}},1)]),t.duration=350,t.timingFunction="linear",this.rightsView.addAnimation(t,"scaleAnim");const e=this.endPositionFunc({width:96,height:120});let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.style={left:e.x,top:e.y,height:120,width:96},1)]),i.duration=350,i.timingFunction="linear",this.addAnimation(i,"moveAnim")}onDismiss(){this.removeAllAnimation()}}class Er extends ur{constructor(t,e){super(),this.closeCalled=!1,this.hasExposured=!1,this.mTimerInterval=100,this.mTimerCurrent=0,this.mTimerPaused=!1,this.vm=t,this.mTotalStayTime=this.vm.getCouponShowTime(),this.onCloseTrigger=e,this.setupViews(),this.setupActions(),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"!=t&&"pageInvisiable"!=t||(this.mTimerPaused="pageVisiable"!=t)}))}showDialog(t){this.isShowing()||(super.showDialog(t),this.startTimer(),this.hasExposured||(this.vm.impressionReport(191,"coupon_card"),this.hasExposured=!0))}setupViews(){let t=this.vm.callerContext.containerLimit.height,e=Le.isAndroid();this.blackBg=new TKView,this.blackBg.style={height:"100%",width:"100%",backgroundColor:"#00000099",position:"absolute"},this.appendChild(this.blackBg),this.livePopUpCouponView=new TKView,this.livePopUpCouponView.style={height:350,width:240,top:(t-350)/2,alignItems:"center",position:"absolute"},this.appendChild(this.livePopUpCouponView),this.couponBackground=new TKImage,this.couponBackground.style={height:350,width:240,borderRadius:18},Ve(this.couponBackground,"live_coupon_main_background.png"),this.livePopUpCouponView.appendChild(this.couponBackground),this.couponShopContainer=new TKView,this.couponShopContainer.style={width:"auto",height:28,top:14,flexDirection:"row",position:"absolute"},this.livePopUpCouponView.appendChild(this.couponShopContainer),this.couponShopImage=new TKImage,this.couponShopImage.style={width:28,height:28,borderRadius:36},Ve(this.couponShopImage,this.vm.getShopImage()),this.couponShopContainer.appendChild(this.couponShopImage),this.couponShopName=new TKText,this.couponShopName.style={width:"auto",height:22,maxWidth:135,fontWeight:e?"300":"400",color:"#FFFFFF",fontSize:15,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",alignSelf:"center",textLineHeightClamp:22,marginLeft:6},this.couponShopName.setText(this.vm.getShopName()),this.couponShopContainer.appendChild(this.couponShopName),this.couponTitleText=new TKText,this.couponTitleText.style={width:"auto",height:22,maxWidth:180,top:50,fontWeight:e?"400":"500",color:"#FFFFFF",fontSize:17,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22,position:"absolute"},this.couponTitleText.setText(this.vm.getCouponTitle()),this.livePopUpCouponView.appendChild(this.couponTitleText),this.couponSecondaryContainer=new TKView,this.couponSecondaryContainer.style={width:220,height:256,top:84,alignItems:"center",position:"absolute"},this.livePopUpCouponView.appendChild(this.couponSecondaryContainer),this.couponAmountContainer=new TKView,this.couponAmountContainer.style={width:"auto",height:72,maxWidth:220,top:15,flexDirection:"row",position:"absolute"},this.couponSecondaryContainer.appendChild(this.couponAmountContainer),this.couponAmountSymbol=new TKText,this.couponAmountSymbol.style={height:45,top:21,fontWeight:"600",fontStyle:"normal",color:"#5F1C00",fontSize:32,textAlign:"center",textLineClamp:1,textLineHeightClamp:32},this.couponAmountSymbol.setText("¥"),this.couponAmountContainer.appendChild(this.couponAmountSymbol),this.couponAmountNum=new TKText,this.couponAmountNum.style={width:"auto",height:72,maxWidth:190,top:2,fontWeight:"700",fontStyle:"normal",color:"#5F1C00",fontSize:60,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:60},this.couponAmountNum.setText(this.vm.getCouponAmount().toString()),this.couponAmountContainer.appendChild(this.couponAmountNum),this.couponConditionNum=new TKText,this.couponConditionNum.style={width:"auto",height:21,maxWidth:180,top:98,fontWeight:"400",fontStyle:"normal",color:"#A99187",fontSize:13,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22,position:"absolute"},this.couponConditionNum.setText(this.vm.getCouponCondition()),this.couponSecondaryContainer.appendChild(this.couponConditionNum),this.couponCouponExpireTime=new TKText,this.couponCouponExpireTime.style={width:"auto",height:18,maxWidth:180,top:120,fontWeight:"400",fontStyle:"normal",color:"#A99187",fontSize:13,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22,position:"absolute"},this.couponCouponExpireTime.setText(this.vm.getCouponExpireTime()),this.couponSecondaryContainer.appendChild(this.couponCouponExpireTime),this.couponButton=new TKView,this.couponButton.style={width:170,height:46,borderRadius:36,top:170,backgroundColor:"#FF2027",position:"absolute",alignItems:"center"},this.couponSecondaryContainer.appendChild(this.couponButton),this.couponActionDescText=new TKText,this.couponActionDescText.style={width:"auto",height:24,maxWidth:130,top:11,fontWeight:"600",fontStyle:"normal",color:"#FFFFFF",fontSize:16,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:24},this.couponActionDescText.setText(this.vm.getCouponActionDesc()),this.couponButton.appendChild(this.couponActionDescText),this.livePopUpCouponCloseBtn=new TKImage,this.livePopUpCouponCloseBtn.style={height:40,width:40,top:(t+350)/2+24,position:"absolute"},Ve(this.livePopUpCouponCloseBtn,"live_coupon_close_btn.png"),this.appendChild(this.livePopUpCouponCloseBtn)}setupActions(){let e=new b;e.template_show_type="coupon_card",this.livePopUpCouponView&&this.livePopUpCouponView.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e),this.onCloseTrigger&&this.onCloseTrigger()})),this.couponButton&&this.couponButton.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e),this.onCloseTrigger&&this.onCloseTrigger()})),this.livePopUpCouponCloseBtn&&this.livePopUpCouponCloseBtn.addEventListener("tap",(t=>{this.handleCloseCallback(1)}))}handleCloseCallback(t){this.closeCalled||(this.closeCalled=!0,this.vm.logCloseReport(t,"coupon_card"),this.onCloseTrigger&&this.onCloseTrigger())}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{this.mTimerPaused||(this.mTimerCurrent+=this.mTimerInterval,this.mTimerCurrent>this.mTotalStayTime&&(this.stopTimer(),this.handleCloseCallback(2)))}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}}class Pr extends TKView{constructor(t){super(),this.hasExposured=!1,this.width=0,this.vm=t,this.setupViews(),this.setupActions(),this.hasExposured||(this.hasExposured=!0,this.vm.impressionReport(19,"coupon_card"))}setupViews(){this.width=this.vm.callerContext.containerLimit.width;let t=Le.isAndroid();this.style={height:168,width:"100%",alignSelf:"center",paddingTop:4,paddingLeft:11,paddingRight:11,marginBottom:12},this.couponShopContainer=new TKView,this.couponShopContainer.style={width:"100%",height:32,flexDirection:"row"},this.appendChild(this.couponShopContainer),this.couponShopImage=new TKImage,this.couponShopImage.style={width:32,height:32,borderRadius:8},Ve(this.couponShopImage,this.vm.getShopImage()),this.couponShopContainer.appendChild(this.couponShopImage),this.couponShopName=new TKText,this.couponShopName.style={width:280,height:23,maxWidth:this.width-62,fontWeight:"500",color:"#FFFFFF",fontSize:17,textAlign:"left",textLineClamp:1,textOverflow:"ellipsis",alignSelf:"center",textLineHeightClamp:23,marginLeft:8,textShadow:"1 1 1 #00000033"},this.couponShopName.setText(this.vm.getShopName()),this.couponShopContainer.appendChild(this.couponShopName),this.couponBackgroundContainer=new TKView,this.couponBackgroundContainer.style={height:44+this.adaptedSize(),width:this.width-22,borderRadius:8,marginTop:8,paddingLeft:8,paddingRight:8,paddingTop:8,paddingBottom:8,backgroundColor:"#222222CC",flexDirection:"column",alignItems:"center"},this.appendChild(this.couponBackgroundContainer),this.couponTitleContainer=new TKView,this.couponTitleContainer.style={height:20,width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.couponBackgroundContainer.appendChild(this.couponTitleContainer),this.couponTitleText=new TKText,this.couponTitleText.style={width:"auto",height:20,maxWidth:this.width-104,fontWeight:"400",color:"#FFFFFF",fontSize:t?15:14,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22},this.couponTitleText.setText(this.vm.getCouponTitle()),this.couponTitleContainer.appendChild(this.couponTitleText),this.logoView=new Vi(3,this.vm.callerContext.adInfo),this.couponTitleContainer.appendChild(this.logoView),this.couponSecondaryContainer=new TKView,this.couponSecondaryContainer.style={width:this.width-38,height:this.adaptedSize(),top:8,flexDirection:"row",justifyContent:"space-between"},this.couponBackgroundContainer.appendChild(this.couponSecondaryContainer),this.couponSecondaryBackground=new TKImage,this.couponSecondaryBackground.style={width:this.width-38,height:this.adaptedSize(),borderRadius:6,top:0,position:"absolute"},Ve(this.couponSecondaryBackground,"live_coupon_bottombar_background.png"),this.couponSecondaryContainer.appendChild(this.couponSecondaryBackground),this.couponMessageContainer=new TKView,this.couponMessageContainer.style={width:"100%",height:43,alignSelf:"center",flexDirection:"row"},this.couponSecondaryContainer.appendChild(this.couponMessageContainer),this.couponAmountContainer=new TKView,this.couponAmountContainer.style={width:92,height:43,flexDirection:"row",justifyContent:"center"},this.couponMessageContainer.appendChild(this.couponAmountContainer);let e=this.vm.getNumberStringDigits(this.vm.getCouponAmount().toString());this.couponAmountSymbol=new TKText,this.couponAmountSymbol.style={width:14,height:e>3?30:36,top:7,fontWeight:t?"400":"500",fontStyle:"normal",color:"#5F1C00",fontSize:21,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22},this.couponAmountSymbol.setText("¥"),this.couponAmountContainer.appendChild(this.couponAmountSymbol),this.couponAmountNum=new TKText,this.couponAmountNum.style={width:"auto",height:43,maxWidth:78,fontWeight:t?"400":"medium",fontStyle:"normal",color:"#5F1C00",fontSize:e>3?26:36,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:36},this.couponAmountNum.setText(this.vm.getCouponAmount().toString()),this.couponAmountContainer.appendChild(this.couponAmountNum),this.couponTextContainer=new TKView,this.couponTextContainer.style={height:43,width:this.width-104*(this.width-38)/376-130,flexDirection:"column",alignItems:"center"},this.couponMessageContainer.appendChild(this.couponTextContainer),this.couponConditionNum=new TKText,this.couponConditionNum.style={width:"100%",height:21,top:3,fontWeight:t?"400":"500",fontStyle:"normal",color:"#5F1C00",fontSize:15,textAlign:"left",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:22},this.couponConditionNum.setText(this.vm.getCouponCondition()),this.couponTextContainer.appendChild(this.couponConditionNum),this.couponCouponExpireTime=new TKText,this.couponCouponExpireTime.style={width:"100%",height:15,top:5,fontWeight:"400",fontStyle:"normal",color:"#A99187",fontSize:11,textAlign:"left",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:10},this.couponCouponExpireTime.setText(this.vm.getCouponExpireTime()),this.couponTextContainer.appendChild(this.couponCouponExpireTime),this.couponActionDescText=new TKText,this.couponActionDescText.style={width:104*(this.width-38)/376,height:43,fontWeight:t?"400":"500",fontStyle:"normal",color:"#5F1C00",fontSize:15,textAlign:"center",textLineClamp:1,textOverflow:"ellipsis",textLineHeightClamp:24},this.couponActionDescText.setText(this.vm.getCouponActionDesc()),this.couponMessageContainer.appendChild(this.couponActionDescText)}setupActions(){let e=new b;e.template_show_type="coupon_card",this.couponShopImage&&this.couponShopImage.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_CLICK,e)})),this.couponShopName&&this.couponShopName.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ICON_NAME_CLICK,e)})),this.couponActionDescText&&this.couponActionDescText.addEventListener("tap",(i=>{this.vm.convert(1,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.addEventListener("tap",(i=>{this.vm.convert(2,{x:i.position.rawX,y:i.position.rawY},t.CARD_ACTION_BAR_CLICK,e)})),this.vm.supportSlideClick()&&Nt(this,(()=>{this.vm.convert(2,{x:0,y:0},t.CARD_SWIPE_CONVERT,e)}))}getHeight(){return 180}adaptedSize(){return 80*(this.width-38)/376}}class Or extends Fi{constructor(t,e){super(t),this.cardHeight=180,this.vm=t,this.liveCouponVm=e,this.setupViews()}setupViews(){this.style={width:"100%",height:this.cardHeight,flexDirection:"column",justifyContent:"flex-end"},this.liveCouponBottomCard=new Pr(this.liveCouponVm),this.appendChild(this.liveCouponBottomCard)}getHeight(){return this.cardHeight}}class Mr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas(),this.setupActions()}setupActions(){if(this.actionBarContainer){const e=this;this.actionBarContainer.addEventListener("tap",(i=>{const n=pe(i,this);e.vm.convert(n,1,t.CARD_ACTION_BAR_CLICK)&&e.clickCloseCallback&&e.clickCloseCallback&&e.clickCloseCallback(3)})),this.vm.supportSlideClick()&&Nt(this.actionBarContainer,(()=>{e.vm.convert({x:0,y:0},1,t.CARD_SWIPE_CONVERT)&&e.clickCloseCallback&&e.clickCloseCallback&&e.clickCloseCallback(3)}))}}setupDatas(){this.cardTagText.setText(this.vm.getSocialCardTagText()),this.cardDescText.setText(this.vm.getSocialCardDescText()),this.actionBarText.setText(this.vm.getSocialCardActionBarText())}setupViews(){this.style={alignItems:"flex-start",justifyContent:"flex-start",height:this.vm.getGapDistance(149),width:"100%",flexDirection:"column",bottom:this.vm.getGapDistance(20),position:"absolute"},this.clipChildren=!1;const t=new TKView;if(t.style={height:24,width:"100%",paddingLeft:12,marginTop:0,flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start"},this.appendChild(t),this.vm.hasLiveTag()){let e=this.vm.obtainTagText(this.vm.getSocialCardLiveTagText());this.cardLiveTagView=new us(e,gs.create({tagViewStyle:3,height:24,tagBorderRadius:4,tagFontSize:12,customBackgroundColor:"#FE3666",customTextColor:"#FFFFFF",tagPadding:6,tagDividerSize:4,tagFontWeight:ce()?"400":"500"})),t.appendChild(this.cardLiveTagView)}let e=this.vm.obtainTagText(this.vm.getSocialCardMatchTagText());this.cardMatchTagView=new us(e,gs.create({tagViewStyle:3,height:24,tagBorderRadius:4,tagFontSize:12,customBackgroundColor:"#FFFFFF4D",customTextColor:"#FFFFFF",tagPadding:6,tagDividerSize:4,tagFontWeight:ce()?"400":"500"})),this.cardMatchTagView.style={marginLeft:this.vm.hasLiveTag()?6:0},t.appendChild(this.cardMatchTagView),this.cardTagText=new TKText,this.cardTagText.style={height:31,fontSize:22,textLineClamp:1,color:"#FFFFFF",alignItems:"flex-start",marginLeft:12,marginTop:this.vm.getGapDistance(4),fontWeight:ce()?"500":"600",textOverflow:"ellipsis",textAlign:"center",textShadow:"0 0 5 #00000040",includeFontPadding:!1},this.appendChild(this.cardTagText),this.cardDescText=new TKText,this.cardDescText.style={height:20,fontSize:14,textLineClamp:1,color:"#FFFFFFB3",marginTop:this.vm.getGapDistance(5),marginLeft:12,alignItems:"flex-start",fontWeight:ce()?"400":"500",textOverflow:"ellipsis",textAlign:"center",includeFontPadding:!1},this.appendChild(this.cardDescText),Le.supportMinimumTKVersion("5.0.0")?this.actionBarContainer=new RoundRectView:this.actionBarContainer=new TKView,this.actionBarContainer.style={height:this.vm.getActionBarSize().height,width:this.vm.getActionBarSize().width,borderRadius:this.vm.getActionBarSize().borderRadius,marginTop:this.vm.getGapDistance(11),marginLeft:this.vm.getActionBarSize().left,backgroundColor:"#FFFFFF4D",flexDirection:"row",alignItems:"center",justifyContent:"center"},this.appendChild(this.actionBarContainer),Le.supportMinimumTKVersion("5.0.0")&&(this.phoneIconLottie=new TKLottieImageView,this.phoneIconLottie.style={height:33,width:31},this.actionBarContainer.appendChild(this.phoneIconLottie),this.phoneIconLottie.setUri(Ae(this.vm.getSocialPhoneIcon()))),this.actionBarText=new TKText,this.actionBarText.style={height:22,fontSize:16,textLineClamp:1,color:"#FFFFFF",marginLeft:5,alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textAlign:"center"},this.actionBarContainer.appendChild(this.actionBarText)}addSweepAnim(){if(!Le.supportMinimumTKVersion("5.0.0"))return;this.strongSweepImage&&this.actionBarContainer&&this.actionBarContainer.removeChild(this.strongSweepImage);const t=this.actionBarContainer.getSize(),e=714*t.height/50;this.strongSweepImage=new TKImage,this.strongSweepImage.style={width:e,height:t.height,left:-e,top:0,position:"absolute"},Ve(this.strongSweepImage,this.vm.getSocialSweepImg()),this.actionBarContainer&&this.actionBarContainer.insertBefore(this.strongSweepImage,this.phoneIconLottie);let i=xi(1e3,e);this.strongSweepImage.addAnimation(i,"strongSweepAnim")}startLottie(){this.phoneIconLottie&&(this.phoneIconLottie.play(),this.phoneIconLottie.setLoop(!0)),setTimeout((()=>{this.addSweepAnim()}),4e3)}stopLottie(){this.phoneIconLottie&&this.phoneIconLottie.stop()}resumeLottie(){this.phoneIconLottie&&this.phoneIconLottie.resume()}pauseLottie(){this.phoneIconLottie&&this.phoneIconLottie.pause()}}class Nr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas(),this.setupActions()}setupActions(){if(this.closeImg){const t=this;this.closeImg.addEventListener("tap",(e=>{t.clickCloseCallback&&t.clickCloseCallback(1)}))}}setupDatas(){this.dialogTitle.setText(this.vm.getSocialCardDialogTitle()),this.dialogDescTitle.setText(this.vm.getSocialCardDialogDescTitle()),this.iconImg.setSrc(this.vm.getSocialCardBgImageUrl()),Ve(this.closeImg,this.vm.getCardcloseIconImageSrc())}setupViews(){this.style={alignItems:"flex-start",justifyContent:"flex-start",flexDirection:"row",height:this.vm.getGapDistance(55),width:"100%",paddingLeft:12,paddingRight:12,top:this.vm.getGapDistance(20),position:"absolute"},this.iconImg=new TKImage,this.iconImg.style={height:this.vm.getGapDistance(55),width:this.vm.getGapDistance(55),borderRadius:30,borderWidth:1,borderColor:"#FFFFFFCC",resize:"cover"},this.appendChild(this.iconImg),this.titleContainer=new TKView,this.titleContainer.style={width:"100%",height:"100%",marginLeft:10,flexDirection:"column",alignItems:"center",justifyContent:"center",flexShrink:1},this.appendChild(this.titleContainer),this.dialogTitle=new TKText,this.dialogTitle.style={width:"100%",height:28,fontSize:20,textLineClamp:1,color:"#FFFFFF",marginTop:0,marginLeft:0,alignItems:"center",fontWeight:"600",textOverflow:"ellipsis",textShadow:"0 0 5 #0000004D",includeFontPadding:!1},this.titleContainer.appendChild(this.dialogTitle),this.descTitleContainer=new TKView,this.descTitleContainer.style={width:"100%",height:20,marginBottom:0,alignItems:"center",flexDirection:"row"},this.titleContainer.appendChild(this.descTitleContainer),this.dialogDescTitle=new TKText,this.dialogDescTitle.style={height:20,fontSize:14,textLineClamp:1,color:"#FFFFFFCC",marginLeft:0,alignItems:"center",fontWeight:"400",textOverflow:"ellipsis",textShadow:"0 0 5 #0000004D",flexShrink:1,includeFontPadding:!1},this.descTitleContainer.appendChild(this.dialogDescTitle),Le.supportMinimumTKVersion("5.0.0")&&(this.socialCallLottie=new TKLottieImageView,this.socialCallLottie.style={width:20,height:20,marginLeft:4},this.socialCallLottie.setUri(Ae(this.vm.getSocialCallLottieSrc()))),this.descTitleContainer.appendChild(this.socialCallLottie),this.closeImg=new TKImage,this.closeImg.style={height:24,width:24,marginTop:0,marginRight:8,marginLeft:8},this.appendChild(this.closeImg)}startLottie(){this.socialCallLottie&&(this.socialCallLottie.play(),this.socialCallLottie.setLoop(!0))}stopLottie(){this.socialCallLottie&&this.socialCallLottie.stop()}resumeLottie(){this.socialCallLottie&&this.socialCallLottie.resume()}pauseLottie(){this.socialCallLottie&&this.socialCallLottie.pause()}}class Hr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas();const e=this;this.cardTopView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)},this.cardBottomView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)}}setupViews(){this.style={alignItems:"center",justifyContent:"center",flexDirection:"column",width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius},this.clipChildren=!ce(),this.cardBgImg=new TKImage,this.cardBgImg.style={width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius,resize:"cover",top:0,position:"absolute"},this.appendChild(this.cardBgImg),this.cardMaskTopView=new TKView,this.cardMaskTopView.style={width:this.vm.getCardSize().width,height:this.vm.getGapDistance(85),top:0,gradientBgColor:"90,#00000000,#000000A6",topRightRadius:this.vm.getCardSize().borderRadius,topLeftRadius:this.vm.getCardSize().borderRadius,position:"absolute"},this.appendChild(this.cardMaskTopView),this.cardMaskBottomView=new TKView,this.cardMaskBottomView.style={width:this.vm.getCardSize().width,height:this.vm.getGapDistance(200),bottom:0,gradientBgColor:"270,#00000000,#000000A6",bottomRightRadius:this.vm.getCardSize().borderRadius,bottomLeftRadius:this.vm.getCardSize().borderRadius,position:"absolute"},this.appendChild(this.cardMaskBottomView),this.cardTopView=new Nr(this.vm),this.appendChild(this.cardTopView),this.cardBottomView=new Mr(this.vm),this.appendChild(this.cardBottomView)}setupDatas(){this.cardBgImg.setSrc(this.vm.getSocialCardBgImageUrl())}startLottie(){this.cardTopView.startLottie(),this.cardBottomView.startLottie()}stopLottie(){this.cardTopView.stopLottie(),this.cardBottomView.stopLottie()}resumeLottie(){this.cardTopView.resumeLottie(),this.cardBottomView.resumeLottie()}pauseLottie(){this.cardTopView.pauseLottie(),this.cardBottomView.pauseLottie()}}class Wr extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupDatas();const e=this;this.cardTopView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)},this.cardBottomView.clickCloseCallback=t=>{e.clickCloseCallback&&e.clickCloseCallback(t)}}setupViews(){this.style={alignItems:"center",justifyContent:"center",flexDirection:"column",width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius},this.clipChildren=!1,this.cardBgImg=new TKImage,this.cardBgImg.style={top:0,position:"absolute",width:this.vm.getCardSize().width,height:this.vm.getCardSize().height,borderRadius:this.vm.getCardSize().borderRadius,resize:"cover"},this.appendChild(this.cardBgImg),this.cardFrameDownView=this.getCardFrameView(),this.cardFrameDownView.style={top:this.vm.getGapDistance(85),transform:{translate:{y:16,x:-16},rotate:{z:-4}},position:"absolute"},this.appendChild(this.cardFrameDownView),this.cardFrameUpView=this.getCardFrameView(),this.cardFrameUpView.style={top:this.vm.getGapDistance(85),position:"absolute"},this.appendChild(this.cardFrameUpView),this.cardMaskImg=new TKImage,this.cardMaskImg.style={width:this.vm.getCardSize().width,height:this.vm.getGapDistance(244),bottom:0,bottomRightRadius:this.vm.getCardSize().borderRadius,bottomLeftRadius:this.vm.getCardSize().borderRadius,position:"absolute",resize:"cover"},this.appendChild(this.cardMaskImg),this.cardTopView=new Nr(this.vm),this.appendChild(this.cardTopView),this.cardBottomView=new Mr(this.vm),this.appendChild(this.cardBottomView)}getCardFrameView(){let t=new TKView;t.style={width:this.vm.getPictureFrameSize().width,height:this.vm.getPictureFrameSize().height,alignItems:"center",justifyContent:"center",flexDirection:"column"},t.clipChildren=!0;let e=new TKImage;e.style={position:"absolute",width:this.vm.getPictureSize().width,height:this.vm.getPictureSize().height,transform:{rotate:{z:3},translate:{y:-2,x:-2}}},t.appendChild(e),e.setSrc(this.vm.getSocialCardBgImageUrl());let i=new TKImage;return i.style={top:0,position:"absolute",width:"100%",height:"100%"},t.appendChild(i),Ve(i,"icon_ksad_social_picture_frame.png"),t}setupDatas(){Ve(this.cardBgImg,"icon_ksad_social_planb_bg.png"),Ve(this.cardMaskImg,"icon_ksad_social_planb_mask.png")}startLottie(){this.cardTopView.startLottie(),this.cardBottomView.startLottie()}stopLottie(){this.cardTopView.stopLottie(),this.cardBottomView.stopLottie()}resumeLottie(){this.cardTopView.resumeLottie(),this.cardBottomView.resumeLottie()}pauseLottie(){this.cardTopView.pauseLottie(),this.cardBottomView.pauseLottie()}}class zr extends TKView{constructor(t){super(),this.playSoundCount=0,this.hasClosed=!1,this.hasShow=!1,this.vm=t,this.setupViews(),this.setupActions();const e=this;this.startTimer(),fi(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"hideEnd"==t&&e.closeCard(0),"pageVisiable"==t&&e.resume(),"pageInvisiable"==t&&e.paused()}))}setupActions(){const e=this;this.cardView.addEventListener("tap",(i=>{const n=pe(i,e);e.vm.convert(n,2,t.CARD_OTHERAREA_CLICK)&&e.callbackClose&&e.closeCard(3)})),this.vm.supportSlideClick()&&Nt(this.cardView,(()=>{e.vm.convert({x:0,y:0},2,t.CARD_SWIPE_CONVERT)&&e.callbackClose&&e.closeCard(3)}))}setupViews(){this.style={alignItems:"center",justifyContent:"center",flexDirection:"column",width:"100%",height:"100%",backgroundColor:"#00000080"},2==this.vm.getSocialCardStyle()?(this.vm.templateShowType="social_card2",this.cardView=new Wr(this.vm),this.appendChild(this.cardView)):(this.vm.templateShowType="social_card1",this.cardView=new Hr(this.vm),this.appendChild(this.cardView)),this.cardView.clickCloseCallback=t=>{this.closeCard(t)}}startTimer(){this.timePlay=new ns(this.vm.getSocialCardShowTime()),this.timePlay.setTimerInterval(1e3);const t=this;this.timePlay.onFinishCallback=()=>{t.closeCard(2)}}closeCard(t){this.hasClosed||(0!=t&&this.socialCardDismiss(t),this.stopSound(),this.hasClosed=!0,this.cardView.stopLottie(),this.timePlay&&this.timePlay.stop())}addPhoneSound(){if(!Le.supportMinimumTKVersion("5.0.0"))return;const t=this;KSAdSystemUtil.loadSound("https://p1-lm.adkwai.com/udata/pkg/ks-ad-ssp/social_ringtone.mp3",(e=>{zr.playSoundId=e,t.playPhoneSound()}))}playPhoneSound(){Ce(zr.playSoundId)||this.hasClosed||ce()&&3==this.playSoundCount||(this.playSoundCount++,KSAdSystemUtil.playSound(zr.playSoundId,(()=>{})),setTimeout((()=>{this.playPhoneSound()}),2520))}stopSound(){Ce(zr.playSoundId)||(KSAdSystemUtil.stopSound(zr.playSoundId),zr.playSoundId=void 0)}socialCardShow(){this.addDialogOpacityAnimation(this,0,1,"dialogShowOpacityAnim");const t=this;this.addDialogTranslateAnimation(this.cardView,15,"dialogShowTranslateAnim",(()=>{t.cardView.startLottie(),ce()?t.addPhoneSound():setTimeout((()=>{t.addPhoneSound()}),540),t.timePlay.play(),t.vm.logECCardImpression(),this.hasShow=!0}))}socialCardDismiss(t){const e=this;this.addDialogTranslateAnimation(this.cardView,23,"dialogDismissTranslateDownAnim",(()=>{e.dismissTranslateUp(t)}))}dismissTranslateUp(t){this.addDialogTranslateAnimation(this.cardView,-40,"dialogDismissTranslateUpAnim");const e=this;setTimeout((()=>{e.addDialogOpacityAnimation(this,1,0,"dialogDismissOpacityAnim",(()=>{e.callbackClose&&e.callbackClose(t)}))}),100)}addDialogOpacityAnimation(t,e,i,n,s=void 0){let a=new TKKeyframeAnimation;a.setAnimations([()=>(t.style={opacity:e},0),()=>(t.style={opacity:i},1)]),a.duration=200,a.timingFunction="linear",t.addAnimation(a,n),a.on("end",(()=>{s&&s()}))}addDialogTranslateAnimation(t,e,i,n=void 0){let s=new TKKeyframeAnimation;s.setAnimations([()=>(t.style={transform:{translate:{y:e}}},1)]),s.duration=200,s.timingFunction="linear",t.addAnimation(s,i),s.on("end",(()=>{n&&n()}))}resume(){this.hasShow&&(this.cardView.resumeLottie(),this.addPhoneSound(),this.timePlay&&this.timePlay.resume())}paused(){this.hasClosed||(this.cardView.pauseLottie(),this.stopSound(),this.timePlay&&this.timePlay.paused())}}zr.playSoundId=void 0;class Ur extends ur{constructor(t){super(),this.vm=t,this.setupViews()}showDialog(t){this.isShowing()||(super.showDialog(t),this.cardView.socialCardShow())}setupViews(){this.cardView=new zr(this.vm),this.appendChild(this.cardView);const t=this;this.cardView.callbackClose=e=>{t.callbackCloseTrigger(e)}}callbackCloseTrigger(t){this.vm.logCloseReport(t),this.onCloseTrigger&&this.onCloseTrigger(t)}}(new class extends ii{constructor(){super(),this.isDefaultBottombar=!1,this.canShowCoupon=!1,this.moreShowDialog=!1,this.isDeepVideoTrans=!1,this.vm=new tr}setupViews(){this.contentView=new TKView,this.contentView.style={position:"absolute",left:0,right:0,top:0,bottom:0,flexDirection:"row",justifyContent:"center",alignContent:"center"},this.rootView.appendChild(this.contentView),this.setupBlurBgIfNeeded(),this.setupPlayer(),this.setupPlayEndCard(),this.setupBottomBar(),this.setupAdLogoIfNeeded(),this.setupTopBar(),this.setupAutoCallView(),this.setupCouponView(),this.setupLiveCutAuthorView(),this.setupShakeView(),this.setupRotateView(),this.setupConfirm(),this.setupTopFloorView(),this.setupDownloadPopup(),this.vm.liveCouponVM.isLiveCouponPopUpEnable()?this.setupLiveCouponPopUpView():(this.vm.ecCardViewModel.enableShowCard()&&this.setupECCardDialog(),this.vm.gameCardViewModel.enableShowGameCard()&&this.setupGameCardDialog()),this.vm.socialCardViewModel.enableShowSocialCard()&&this.setupSocialCardDialog(),yi(this.vm.confirmVM,this.vm.confirmVM.$attrsPath.isShow,(t=>{t?this.onPlayStatusChange(1):this.onPlayStatusChange(2)})),yi(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"hideEnd"==t?(this.bottombar&&this.bottombar.stopActionAnimation(),this.bottomCouponBar&&this.bottomCouponBar.stopActionAnimation(),this.shakeView&&this.shakeView.stopActionAnimation(),this.rotateView&&this.rotateView.stopActionAnimation()):"pageVisiable"==t?(this.resumeVideoPlayer(),this.bottombar&&this.bottombar.resumeActionAnimation()):"pageInvisiable"==t&&(this.playerView.pause(),this.bottombar&&this.bottombar.pauseActionAnimation())})),Le.supportMinimumTKVersion("5.0.8")?(yi(this.vm.playerVM,this.vm.playerVM.$attrsPath.playStarted,(t=>{t&&(console.log("fullscreen==========>启播成功"),this.vm.isValidPlayable()?(this.setupPlayable(),this.playableCard.render()):this.playendCard.render())})),yi(this.vm.topBarVM,this.vm.topBarVM.$attrsPath.hasShowPlayend,(t=>{t&&(this.vm.topFloorVM.hasShowPlayend=!0,this.vm.callerContext.hasShowPlayend=!0,this.onShowPlayEndCard())})),Oe().on(d,(t=>{this.vm.pushCardVM.isShowEnd=!0}))):yi(this.vm.topBarVM,this.vm.topBarVM.$attrsPath.hasShowPlayend,(t=>{t&&(Ot(this.vm.adInfo,this.vm.configInfo)?setTimeout((()=>{this.handleShowPlayend()}),200):this.handleShowPlayend(),this.rotateView&&(this.vm.rotateVM.stopRotateListener(),this.rotateView.setVisibility("hidden")))})),yi(this.vm.playerVM,this.vm.playerVM.$attrsPath.currentPlaybackTime,(t=>{let e=this.vm.bottomBarVM;if(!this.isDeepVideoTrans&&e.isDeepVideoStyle()){if(t>e.deepVideoModel.getDeepVideoTransformTime()){let t=this.bottombar;this.videoChange(t.getVideoHeight(),t.getVideoTop(),t.getVideoRadius()),t.transfromBottomBar(),this.isDeepVideoTrans=!0,this.setupDanmakuView()}}if(e.isDeepVideoStyle()&&t>15&&this.bottombar.showActionBarAnim(),this.canShowPushCard(t)&&this.showPushCard(),this.ecCardDialogView&&this.vm.ecCardViewModel.cardLoadSuccess()){t>this.vm.ecCardViewModel.getDelayShowTime()&&this.showECCardDialog()}if(this.gameCardDialogView&&this.vm.gameCardViewModel.enableShowGameCard()){1e3*t>this.vm.gameCardViewModel.getDelayTime()&&this.showGameCardDialog()}if(this.liveCouponPopUpView){t>this.vm.liveCouponVM.getCouponDelayTime()&&this.showliveCouponPopUp()}if(this.socialCardDialogView&&this.vm.socialCardViewModel.enableShowSocialCard()&&this.vm.callerContext.pageFocusAndVisible){1e3*t>this.vm.socialCardViewModel.getSocialCardDelayTime()&&this.showSocialCardDialog()}}))}setupECCardDialog(){this.ecCardDialogView=new _r(this.vm.ecCardViewModel),this.ecCardDialogView.initView(),this.ecCardDialogView.onCloseTrigger=()=>{this.hideECCardDialog()}}setupGameCardDialog(){const t=this;this.gameCardDialogView=new Br(this.vm.gameCardViewModel),this.gameCardDialogView.onCloseTrigger=e=>{2==e&&t.vm.gameCardViewModel.enableShowWidget()&&t.showGameWidget(),t.hideGameCardDialog()}}setupSocialCardDialog(){const t=this;this.socialCardDialogView=new Ur(this.vm.socialCardViewModel),this.socialCardDialogView.onCloseTrigger=e=>{t.hideSocialCardDialog()}}showGameWidget(){this.gameWidget=new Kr(this.vm.gameCardViewModel,(t=>{let e=0==this.vm.screenOrientation,i=this.bottombar.onGetMiddleMarginBottom(e),n=this.vm.containerLimit.height+this.vm.getTopMargin();return this.shakeView&&(n-=50),this.rotateView&&(n-=50),{x:this.vm.getSideMargin(),y:n-i-t.height}})),this.contentView.appendChild(this.gameWidget);const t=this;this.gameWidget.callbackClose=()=>{t.contentView.removeChild(t.gameWidget)}}setupLiveCouponPopUpView(){this.liveCouponPopUpView=new Er(this.vm.liveCouponVM,(()=>{this.hideLiveCouponPopUpView()}))}setupCouponView(){this.vm.couponWidgetVM.isValidCardInfo()&&this.vm.couponWidgetVM.isValidSDKVersion()&&(this.vm.couponWidgetVM.cardTopMargin=this.topbar.expcetedHeight+this.vm.getTopMargin()+40,this.vm.couponWidgetVM.cardBottomMargin=this.bottombar.getHeight()+30,this.couponWidgetView=new vi(this.vm.couponWidgetVM),this.contentView.appendChild(this.couponWidgetView),this.contentView.layout())}setupAutoCallView(){this.vm.autocallVM.shouldShowAutoCallAppCard((t=>{if(t){let t=0==this.vm.screenOrientation;this.vm.autocallVM.cardTopMargin=this.topbar.expcetedHeight+this.vm.getTopMargin()+10,this.vm.autocallVM.cardBottomMargin=this.bottombar.onGetMiddleMarginBottom(t)+20,this.autocallView=new Ii(this.vm.autocallVM),this.autoCallCardAdded=!0,this.contentView.appendChild(this.autocallView),this.contentView.layout(),this.autocallView.dismissCallback=()=>{this.autoCallCardAdded&&(this.contentView.removeChild(this.autocallView),this.autocallView=null,this.autoCallCardAdded=!1)},Oe().on(o,(t=>{null!=this.autocallView&&this.autocallView.handlePlayFinished()})),Oe().on(r,(t=>{null!=this.autocallView&&this.autocallView.handlePlayTime(1e3*t.currentTime)})),Oe().on(a,(t=>{null!=this.autocallView&&this.autocallView.handlePlayFailed()})),Oe().on(h,(t=>{null!=this.autocallView&&this.autocallView.setConverted(!0)}))}else this.autocallView=null,this.autoCallCardAdded=!1}))}setupLiveCutAuthorView(){setTimeout((()=>{let t=this.vm.middleCardVM.getMiddleCardType();if(t&&t==L.LIVE_CUT3_STYLE2&&0==this.vm.screenOrientation){const t=Number(this.vm.getTopMargin()+this.topbar.getSize().height);let e=Kn.newInstance(this.vm.middleCardVM);if(!e)return;e.style={position:"absolute",top:16+t,left:0,right:0},this.contentView.appendChild(e)}}),200)}setupRotateView(){if(this.vm.rotateVM.enableShowRotate()){let t=0==this.vm.screenOrientation,e=0;e=this.bottomCouponBar?Math.max(this.bottombar.onGetMiddleMarginBottom(t),this.bottomCouponBar.onGetMiddleMarginBottom(t)):this.bottombar.onGetMiddleMarginBottom(t);let i=t?.98:.9,n=ce()||t&&!he()?this.vm.containerLimit.height-this.vm.getTopMargin():this.vm.containerLimit.height;const s=t=>{let e=this.vm.containerLimit.height-270-t.height,i=(this.vm.containerLimit.height+this.vm.getTopMargin()-t.height)/2;return e<i&&(e=i),{x:this.vm.getSideMargin()+this.vm.containerLimit.width/2-t.width/2,y:e}},a=t=>({x:18+this.vm.getSideMargin(),y:n*i-e}),o=this.vm.showShakeAndRotateDirectlyAtBottom();2==this.vm.rotateVM.uiStyle?this.rotateView=new Ba(this.vm.rotateVM,s,a,o):this.rotateView=new Ra(this.vm.rotateVM,s,a,o),this.contentView.appendChild(this.rotateView)}}setupShakeView(){if(!this.autoCallCardAdded&&this.vm.shakeVM.needShowShakeUI()){let t=0==this.vm.screenOrientation,e=0;e=this.bottomCouponBar?Math.max(this.bottombar.onGetMiddleMarginBottom(t),this.bottomCouponBar.onGetMiddleMarginBottom(t)):this.bottombar.onGetMiddleMarginBottom(t);let i=t?.98:.9,n=ce()||t&&!he()?this.vm.containerLimit.height-this.vm.getTopMargin():this.vm.containerLimit.height;const s=this.vm.showShakeAndRotateDirectlyAtBottom();this.shakeView=new Xs(this.vm.shakeVM,(t=>{let i=this.vm.containerLimit.height/2-t.height/2;return i>this.vm.containerLimit.height-e-16-t.height&&(i=this.vm.containerLimit.height-e-16-t.height),{x:this.vm.getSideMargin()+this.vm.containerLimit.width/2-t.width/2,y:i}}),(t=>({x:18+this.vm.getSideMargin(),y:n*i-e})),s),this.contentView.appendChild(this.shakeView)}}setupAdLogoIfNeeded(){this.vm.bottomBarVM.isHorizontalPlayable()&&(this.adLogo=new Vi(1,this.vm.adInfo),this.adLogo.style={position:"absolute",left:this.vm.getSideMargin()+10,bottom:10},this.contentView.appendChild(this.adLogo))}setupBlurBgIfNeeded(){(this.vm.bottomBarVM.isDeepVideoStyle()||this.vm.bottomBarVM.isHorizontalPlayable())&&(this.blurBg=new TKBlurImage,this.blurBg.style={position:"absolute",left:this.vm.getSideMargin(),right:this.vm.getSideMargin(),top:this.vm.getTopMargin(),bottom:0},this.blurBg.setBlurRadius(10),this.blurBg.setSrc(this.vm.playerVM.getVideoFirstFrame()),this.contentView.appendChild(this.blurBg),this.vm.bottomBarVM.isDeepVideoStyle()&&(this.blurBg.style={opacity:0},this.blackBg=new TKImage,this.blackBg.style={backgroundColor:"#00000080",position:"absolute",left:this.vm.getSideMargin(),right:this.vm.getSideMargin(),top:this.vm.getTopMargin(),bottom:0,opacity:0},this.contentView.appendChild(this.blackBg)))}setupPlayer(){console.log("=====+++++ setup player"),this.playerView=new za(this.vm.playerVM);let t,e={position:"absolute"};const i=this.vm.bottomBarVM.getMaterialSize(),n=this.vm.containerLimit;n.height-=this.vm.getTopMargin(),n.width-=2*this.vm.getSideMargin();let s=n.width,a=n.height,o=n.width;this.vm.bottomBarVM.isHorizontalPlayable()?(t=0,s=n.width/2,o=s):(s="100%",t=n.width>n.height&&i.width>i.height||n.width<n.height&&i.width<i.height?2:0),e.width=s,e.height=a,e.left=this.vm.getSideMargin(),e.top=this.vm.getTopMargin(),this.playerView.style=e,this.contentView.appendChild(this.playerView)}setupTopBar(){this.topbar=new Hn(this.vm.topBarVM),this.topbar.updateActionBarState(this.vm.isShowSkipRightNow()?1:0),this.topbar.style={position:"absolute",top:this.vm.getTopMargin(),left:this.vm.getSideMargin(),right:this.vm.getSideMargin()};const t=this;this.vm.topBarVM.handleSkipCallback=(e,i,n)=>{t.onSkip(e,i,n)},this.vm.topBarVM.handleCloseCallback=()=>{this.vm.handleClose(!1)},this.rootView.appendChild(this.topbar)}setupBottomBar(){var t;const e=new TKView;e.throughHitTest=!0;const i={position:"absolute",bottom:0,left:this.vm.getSideMargin(),right:this.vm.getSideMargin()},n=this.vm.bottomBarVM;n.setStyleType(3);const s=()=>{this.bottombar.vm.reportEquityCardImpression(this.vm.bottomBarVM.getCouponModel().cardStyle)};0!=this.vm.bottomBarVM.getCouponModel().cardStyle&&0==this.vm.screenOrientation&&(this.canShowCoupon=!0);const a=()=>{this.canShowCoupon&&(setTimeout((()=>{let t=new TKBasicAnimation;t.setEndValue((()=>{this.bottombar.style={transform:{translate:{y:8}},opacity:0}})),t.duration=350,t.timingFunction="ease-in-out",this.bottombar.addAnimation(t,"zoomOutAnimation"),t.on("end",(t=>{e.setVisibility("hidden")}))}),1e3*this.vm.bottomBarVM.getCouponModel().delayTime+500),setTimeout((()=>{let t=new TKBasicAnimation;t.setEndValue((()=>{this.bottomCouponBar.style={transform:{translate:{y:-8}},opacity:1}})),t.duration=500,t.timingFunction="ease-in-out",this.bottomCouponBar.addAnimation(t,"zoomInAnimation"),this.bottomCouponBar.reportImpressionCallback=s,this.bottomCouponBar.reportImpressionCallback()}),1e3*this.vm.bottomBarVM.getCouponModel().delayTime+850))};this.canShowCoupon&&(this.vm.bottomBarVM.isAnimFinishCallback=a);let o=this.vm.bottomBarVM.getNeoActionBarCardType();console.log("tkloadcontroller setup bottom");let r=$(this.vm.adInfo);if(this.vm.liveCouponVM.isLiveCouponBottomCardEnable())this.bottombar=new Or(n,this.vm.liveCouponVM);else if(o==_.LIVE_CUT3_STYLE1&&0==this.vm.screenOrientation)this.bottombar=on.newInstance(n);else if(o==_.LIVE_CUT3_STYLE2&&0==this.vm.screenOrientation)this.bottombar=cn.newInstance(n);else if(n.isShortLive())console.log("tkloadcontroller 1"),this.bottombar=new Ln(n);else if(Le.supportMinimumVersion("3.3.26","3.3.30")&&n.isEcFollow()){switch(n.getShortVideoFollowPlaycardStyle()){case 1:console.log("tkloadcontroller 2"),this.bottombar=new vn(n);break;case 2:console.log("tkloadcontroller 3"),0==this.vm.screenOrientation&&(this.bottombar=new An(n));break;case 3:console.log("tkloadcontroller 4"),this.bottombar=new Oi(n);break;case 4:console.log("tkloadcontroller 5"),0==this.vm.screenOrientation&&(this.bottombar=new Wi(n))}}else if(n.isDeepVideoStyle()){let t=new bs(n);this.bottombar=t}else 3==r?n.isDiscountNewStyle()&&(this.bottombar=new In(n)):n.isECOrderAd()?(console.log("tkloadcontroller 6"),this.bottombar=new bn(n)):n.isCommercialProductStyle()?(console.log("tkloadcontroller 7"),this.bottombar=new cs(n,this.vm.containerLimit.width-2*this.vm.getSideMargin())):0!=n.getPlayableStyle()?(console.log("tkloadcontroller 8"),this.bottombar=new fs(n),1==this.vm.screenOrientation&&(i.left=this.vm.containerLimit.width/2+this.vm.getSideMargin())):n.isAdForLive()?Le.supportMinimumVersion("3.3.19","3.3.26")&&!Le.supportMinimumVersion("3.3.22","3.3.29")?(console.log("tkloadcontroller 9"),this.bottombar=new Sn(n)):this.bottombar=new Ln(n):n.isLiveSubscribe()&&(this.bottombar=new ps(n));this.bottombar||(this.bottombar=gr.createNormalBottomBarView(n,(()=>new Bi(n))));let h=this.bottombar.getHeight();if(this.canShowCoupon){1==this.vm.bottomBarVM.getCouponModel().cardStyle?this.bottomCouponBar=new gn(this.vm.bottomBarVM):this.bottomCouponBar=new Fn(this.vm.bottomBarVM);const e=(null===(t=Tachikoma.env.safeAreaInsets)||void 0===t?void 0:t.bottom)>0?74:44,i=this.bottomCouponBar.getHeight()+e>h?this.bottomCouponBar.getHeight()+e:h,n=new TKView,s={position:"absolute",bottom:0,left:this.vm.getSideMargin(),right:this.vm.getSideMargin()};s.height=i,n.style=s,n.appendChild(this.bottomCouponBar),this.contentView.appendChild(n)}i.height=h,e.style=i,this.contentView.appendChild(e),e.appendChild(this.bottombar)}setupTopFloorView(){this.vm.topFloorVM.enableInitTopfloorContainer()&&(this.topFloorView=new ds(this.vm.topFloorVM),this.topFloorView.style={position:"absolute",top:0,left:0},this.rootView.appendChild(this.topFloorView),this.vm.topFloorVM.getBottomHeigtCallback=()=>this.autoCallCardAdded||!this.vm.shakeVM.needShowShakeUI()&&!this.vm.rotateVM.enableShowRotate()?this.bottombar.getHeight():this.bottombar.getHeight()+50)}showECCardDialog(){this.ecCardDialogView.showDialog(this.rootView),this.withDialogShow(this.ecCardDialogView)}hideECCardDialog(){null!=this.ecCardDialogView&&(this.ecCardDialogView.dismiss(),this.vm.playerVM.onDialogDismiss(this.ecCardDialogView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.ecCardDialogView=null)}showGameCardDialog(){this.gameCardDialogView.showDialog(this.rootView),this.withDialogShow(this.gameCardDialogView)}hideGameCardDialog(){this.gameCardDialogView&&(this.gameCardDialogView.dismiss(),this.vm.playerVM.onDialogDismiss(this.gameCardDialogView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.gameCardDialogView=null)}showliveCouponPopUp(){null!=this.liveCouponPopUpView&&(this.liveCouponPopUpView.showDialog(this.rootView),this.withDialogShow(this.liveCouponPopUpView))}hideLiveCouponPopUpView(){null!=this.liveCouponPopUpView&&(this.liveCouponPopUpView.dismiss(),this.vm.playerVM.onDialogDismiss(this.liveCouponPopUpView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.liveCouponPopUpView=null)}showSocialCardDialog(){this.socialCardDialogView.showDialog(this.rootView),this.withDialogShow(this.socialCardDialogView)}hideSocialCardDialog(){this.socialCardDialogView&&(this.socialCardDialogView.dismiss(),this.vm.playerVM.onDialogDismiss(this.socialCardDialogView),this.vm.callerContext.pageFocusAndVisible=!0,this.withDialogHide(),this.socialCardDialogView=null)}withDialogShow(t){this.vm.playerVM.onDialogShow(t),this.vm.middleCardVM.callerContext.pageFocusAndVisible=!1,this.vm.checkShakeVM(),this.playerView.pause()}withDialogHide(){this.vm.mLifeCycleHelper.isVisible()&&(this.vm.checkShakeVM(),this.resumeVideoPlayer())}setupPlayEndCard(){Le.supportMinimumTKVersion("5.0.8")&&(this.playendCard=new Pa(this.vm.playEndCardVM),this.playendCard.style={position:"absolute",width:"100%",height:"100%",left:0},this.rootView.appendChild(this.playendCard),this.playendCard.setVisibility("hidden"))}setupPlayable(){Le.supportMinimumTKVersion("5.0.8")&&(this.playableCard=new sa(this.vm.playableCardVM),this.playableCard.style={width:"100%",height:"100%",position:"absolute",left:0},this.playendCard.appendChild(this.playableCard),this.playendCard.layout(),this.playableCard.setVisibility("hidden"))}setupConfirm(){if(!Le.supportMinimumTKVersion("4.0.9"))return;this.confirmDialog=new Gs(this.vm.confirmVM);const t=this;this.vm.confirmVM.handleSkipCallback=(e,i,n)=>{ke.skipVideo(e||!1,i||!1,n||0,t.vm.topBarVM.currentPlaybackTime)},Oe().on(h,(t=>{this.vm.confirmVM.hasClickBefore=!0}))}setupDownloadPopup(){zt(this.vm.adInfo)&&(this.downloadPopup=new Ai(this.vm.downloadPopupVM,this.rootView))}setupDanmakuView(){let e=this.vm.bottomBarVM.deepVideoModel.getCommentList();this.vm.bottomBarVM.deepVideoModel.isShowComments()&&!Ce(e)&&(this.mDanmakuView=new js(e),this.mDanmakuView.style={position:"absolute",width:"100%",height:120,top:80,left:0,right:0},this.rootView.appendChild(this.mDanmakuView),this.mDanmakuView.startRoll(),this.mDanmakuView.addEventListener("tap",(e=>{let i=new b;this.vm.bottomBarVM.deepVideoModel?i.merchant_play_card_style=this.vm.bottomBarVM.deepVideoModel.getDeepVideCardStyle():i.merchant_play_card_style=0,this.vm.bottomBarVM.convert(1,3,{x:e.position.rawX,y:e.position.rawY},t.CARD_ITEM_BULLET_CLICK,i)})))}showPushCard(){this.pushCard=new Ua(this.vm.pushCardVM);this.topbar.getSize().height>0&&(this.vm.pushCardVM.topNavHeight=this.topbar.getSize().height),this.rootView.appendChild(this.pushCard),this.pushCard.show()}canShowPushCard(t){return!!this.vm.pushCardVM.canPushCard()&&(!this.vm.pushCardVM.isShowEnd&&!(t<this.vm.pushCardVM.pushCardDelayTime()/1e3))}onSkip(t,e,i){if(this.vm.confirmVM.isShowConfirm()&&null!=this.confirmDialog&&0==this.moreShowDialog){const n=this;return this.confirmDialog.showConfirm(this.moreShowDialog,(()=>{ke.skipVideo(t||!1,e||!1,i||0,n.vm.topBarVM.currentPlaybackTime)})),void(this.moreShowDialog=!0)}ke.skipVideo(t||!1,e||!1,i||0,this.vm.topBarVM.currentPlaybackTime),Le.supportMinimumTKVersion("5.0.8")&&this.vm.topBarVM.isSkipToCloseAd()?(this.playerView.stop(),this.vm.handleClose(!0)):this.vm.showPlayEnd()}onPlayStatusChange(t){1==t&&this.playerView.pause(),2!=t||"pageVisiable"!=this.vm.lifeStatus&&"showEnd"!=this.vm.lifeStatus||this.resumeVideoPlayer()}handleShowPlayend(){this.playerView.stop(),this.contentView.setVisibility("hidden");const t=Number(this.topbar.getSize().height)+Number(this.topbar.getOrigin().y)+Number(this.contentView.getOrigin().y);this.rootView.style={height:t,position:"absolute",top:0},this.mDanmakuView&&(this.mDanmakuView.stop(),this.mDanmakuView.setVisibility("hidden"))}resumeVideoPlayer(){this.playerView.resume()}onShowPlayEndCard(){if(!Le.supportMinimumTKVersion("5.0.8"))return;let t=!0;try{if(Ze(1),this.vm.topBarVM.needShowPlayEndCloseBtn=1,this.playerView.stop(),this.contentView.setVisibility("hidden"),this.shakeView&&(this.vm.shakeVM.stopListenSensor(),this.shakeView.setVisibility("hidden")),this.rotateView&&(this.vm.rotateVM.stopRotateListener(),this.rotateView.setVisibility("hidden")),this.mDanmakuView&&(this.mDanmakuView.stop(),this.mDanmakuView.setVisibility("hidden")),this.pushCard&&(this.vm.pushCardVM.isShowEnd=!0),this.playendCard.setVisibility("visible"),this.vm.isValidPlayable()&&this.vm.isPlayableRenderSuccess())return this.playableCard.setVisibility("visible"),void this.playableCard.show();if(this.vm.playableOrientationNotMatch()){let t={creativeId:this.vm.adInfo.adBaseInfo.creativeId},e={actionType:10208,payload:JSON.stringify(t)};ke.sendCommonLog(e)}Ot(this.vm.adInfo,this.vm.configInfo)&&!this.vm.playerVM.playFinished&&Be(),this.vm.canAutoShowAndroidMarket()&&this.vm.openAppMarket(),this.vm.reportPlayEndImpression(),this.playendCard.show()}catch(e){t=!1,Ze(3,re(e))}finally{t&&Ze(2)}}videoChange(t,e,i){const n=Number(this.contentView.getSize().height),s=Number(this.contentView.getSize().width),a=n-t-e,o=a*(9/16),r=e+this.vm.getTopMargin(),h=this;this.blackBg.style={opacity:1},setTimeout((()=>{if(ce()){const t=new TKBasicAnimation;t.setStartValue((()=>{this.playerView.style={width:s,height:n}})),t.setEndValue((()=>{h.playerView.style={width:o,height:a,borderRadius:i,top:r,left:(s-o)/2}})),t.timingFunction="ease-in-out",t.duration=500,h.playerView.addAnimation(t,"VideoAnimation")}else{const t=this,e=500;t.playerView.setAnimation(e,(()=>{t.playerView.style={width:o,height:a,borderRadius:i,top:r,left:(s-o)/2}}))}const t=new TKKeyframeAnimation;t.setAnimations([()=>(h.blurBg.style={opacity:0},0),()=>(h.blurBg.style={opacity:1},1)]),t.duration=500,this.blurBg.addAnimation(t,"animationBlurImage")}),300)}render(){if(this.renderCalled)return!1;this.renderCalled=!0;try{this.vm.getData((t=>{if(t)try{this.setupViews(),Tachikoma.render(this.rootView),this.updateRenderStatus(1,"")}catch(e){this.updateRenderStatus(0,re(e))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,re(t))}return!0}}).render()})();
//# sourceMappingURL=ksad-fullscreen-video-card.578.js.map