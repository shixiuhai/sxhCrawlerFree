(()=>{"use strict";class t{static saveLocal(t,e){if("undefined"!=typeof TKLocalStorage&&rt.supportMinimumTKVersion("4.0.0"))try{(new TKLocalStorage).set(t,e)}catch(i){}}static getLocalString(t){if("undefined"!=typeof TKLocalStorage&&rt.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return e.toString()}catch(e){}return null}static getLocalInt(t){if("undefined"!=typeof TKLocalStorage&&rt.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Number.parseInt(e.toString())}catch(e){}return 0}static getLocalBoolean(t){if("undefined"!=typeof TKLocalStorage&&rt.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Boolean(e.toString)}catch(e){}return!1}}let e=null;const i="TKResIndexKey";class a{constructor(){var e,a,n;this.defaultHost="p1-lm.adukwai.com",this.currentIndex=0;let s=null===(n=null===(a=null===(e=U())||void 0===e?void 0:e.appConfig)||void 0===a?void 0:a.idc)||void 0===n?void 0:n.tkres;s&&0!=s.length||(s=["p1-lm.adukwai.com","p2-lm.adukwai.com"]),this.resList=s;let o=t.getLocalInt(i);o>s.length&&(o=0),this.currentIndex=o}static getInstance(){return e||(e=new a),e}getCurrentHost(){return this.currentIndex>=this.resList.length?this.defaultHost:this.resList[this.currentIndex]}markUrlFail(e){if(!(e.indexOf(this.getCurrentHost())<0||"undefined"!=typeof KSAdTKNetworkManager&&0==KSAdTKNetworkManager.getCurrentNetworkType())){const e=this.currentIndex;this.currentIndex=++this.currentIndex%this.resList.length,this.currentIndex!==e&&t.saveLocal(i,this.currentIndex)}}}var n,s;!function(t){t.START="start",t.CENTRT="center",t.END="end"}(n||(n={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(s||(s={}));var o,r,l;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.PRODUCT=1]="PRODUCT",t[t.EVENT=2]="EVENT",t[t.COUPON=3]="COUPON",t[t.PRODUCT_DEEP_VIDEO=4]="PRODUCT_DEEP_VIDEO"}(o||(o={}));!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(r||(r={}));class h{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(l||(l={}));class c{}var d,u,p;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(d||(d={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(u||(u={})),function(t){t[t.unkonwn=0]="unkonwn",t[t.videoPromoteFollow=1]="videoPromoteFollow",t[t.videoPromoteGoods=2]="videoPromoteGoods",t[t.liveGoods=3]="liveGoods",t[t.liveNotGoods=4]="liveNotGoods",t[t.videoAd=5]="videoAd"}(p||(p={}));function C(t,e,i){if(console.log("tkloadcontroller target componentName:"+e+" slotId:"+i),q(e)&&!it(i))try{const a=t.adMatrixInfo.adDataV2.componentDatas.length;for(let n=0;n<a;n++){let a=t.adMatrixInfo.adDataV2.componentDatas[n];if(a.componentName==e&&a.slotId==i)return a}}catch(a){}}class g{static isClickReward(t,e){try{let i=!0;if(rt.isAndroid()&&!it(e)&&(i=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&i)return!0}catch(i){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(i){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){try{return t.advertiserInfo.userId||0}catch(e){return 0}}static getLiveStreamId(t){try{return t.adBaseInfo.liveStreamId||""}catch(e){return""}}static getLiveServiceToken(t){try{return t.adConversionInfo.liveServiceToken||""}catch(e){return""}}static getLiveUserId(t){try{return t.adConversionInfo.liveVisitorId||0}catch(e){return 0}}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!it(e)&&g.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),it(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=q(e)?e:t.advertiserInfo.rawUserName}catch(i){}return e=q(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(it(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return it(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=y(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let i="";try{i=t.neoLiveAuthorInfoData.authorName}catch(a){}try{it(i)&&(i=t.neoLiveCartDetailData.authorName)}catch(a){}try{it(i)&&(i=e.adBaseInfo.appName)}catch(a){}return i}static liveGetLiveDesc(t,e){let i="";try{i=t.neoLiveCartDetailData.liveDesc}catch(a){}try{it(i)&&(i=t.neoLiveAuthorInfoData.liveDesc)}catch(a){}try{it(i)&&(i=t.adDescription)}catch(a){}try{it(i)&&(i=e.adBaseInfo.adDescription)}catch(a){}return i}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!it(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!it(e))return e}catch(e){}return null}static getNeoAutoDialogType(t){var e;if(function(t){try{const e=t.adMatrixInfo.adDataV2.styleComponentInfo;if(e&&e.styleComponentFlag)return!0}catch(e){}return!1}(t)){if(C(t,"reward-dialog-common",5))return 1;if(C(t,"reward-dialog-fund",5))return 2}else try{let i=0;if(g.isOriginLiveAd(t))i=null===(e=t.adMatrixInfo.adDataV2.videoLiveTKInfo)||void 0===e?void 0:e.neoAutoDialogType;else{let e=_(t);i=1==e?t.adMatrixInfo.adDataV2.neoTKInfo.neoAutoDialogType:2==e?t.adMatrixInfo.adDataV2.videoImageTKInfo.neoAutoDialogType:0}1!=i&&2!=i&&(i=0);let a=function(t){if(null==t)return null;try{let e=null;if(g.isOriginLiveAd(t))e=L(t,14);else{let i=_(t);2==i?e=L(t,16):1==i&&(e=L(t,12))}if(e){let i=k(e,t);return JSON.parse(i.data).neoAutoDialog}}catch(e){}return null}(t);return 1==i&&it(a.neoAutoDialogGiftPic)&&it(a.neoAutoDialogGiftTitle)&&(i=0),i}catch(i){}return 0}static hasNeoAutoDialog(t){let e=g.getNeoAutoDialogType(t);return!it(e)&&0!=e}static newDeepVideoInteractCardInfo(t,e){if(it(t)||it(e))return null;let i;if(i=JSON.parse(JSON.stringify(Object.assign(t,e))),i.merchantStyleType=o.PRODUCT_DEEP_VIDEO,i.interactiveCardShowTime=0,i.rightsCardCustomImageUrl=t.icon,i.rightsCardCustomContent=t.name,i.rightsCardProductIconDesc="热卖",it(t.rating))i.rightsCardProductTags=t.serviceInfoList;else{let e=[t.rating];i.rightsCardProductTags=e.concat(t.serviceInfoList)}return i}}function I(t,e){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;let i=null;if(e)for(let a=0;a<t.impAdInfo.length;++a){let n=t.impAdInfo[a];if(n.adInfo.length>0&&n.adInfo[0].adBaseInfo.creativeId==e){i=n;break}}return i||(i=t.impAdInfo[0]),i}function f(t){var e;return(null===(e=null==t?void 0:t.adInfo)||void 0===e?void 0:e.length)>0?t.adInfo[0]:null}function m(t){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;const e=t.impAdInfo[0];return(null==e?void 0:e.adInfo)&&0!=e.adInfo.length?e.adInfo[0]:null}function T(t){let e=null;try{1==t.adBaseInfo.adOperationType&&q(t.adBaseInfo.appIconUrl)?e=t.adBaseInfo.appIconUrl:q(t.advertiserInfo.portraitUrl)&&(e=t.advertiserInfo.portraitUrl)}catch(i){}return e||"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}function _(t){try{return t.adMaterialInfo.materialFeature[0].featureType}catch(e){}return 0}function S(t){try{return t.adMaterialInfo.materialFeature[0].materialUrl}catch(e){}return""}function v(t){try{return 1==t.adBaseInfo.adOperationType}catch(e){}return!1}function w(t){let e=null;try{switch(t.adBaseInfo.adOperationType){case 1:e=t.adBaseInfo.appName;break;case 2:e=t.adBaseInfo.productName}q(e)||(e=t.advertiserInfo.rawUserName)}catch(i){}return e||"可爱的广告君"}function A(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function L(t,e){let i;try{switch(e){case 1:i=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId;break;case 12:i=t.adMatrixInfo.adDataV2.neoTKInfo.templateId;break;case 3:i=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId;break;case 2:i=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId;break;case 4:i=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId;break;case 6:case 9:i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId;break;case 5:i=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId;break;case 7:i=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId;break;case 10:i=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId;break;case 11:i=t.adMatrixInfo.adDataV2.pushTKInfo.templateId;break;case 13:i=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId;break;case 14:i=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId;break;case 15:i=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId;break;case 16:i=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId;break;case 100:i=t.adMatrixInfo.adDataV2.complianceCardInfo.templateId;break;case 101:i=t.adMatrixInfo.adDataV2.downloadConfirmCardInfo.templateId;break;case 17:i=t.adMatrixInfo.adDataV2.feedTKCardInfo.templateId;break;default:i=void 0}}catch(a){i=void 0}return i}function y(t,e){let i=L(t,e);if(console.log("tkloadcontroller target templateid:"+i),!q(i))return;const a=t.adMatrixInfo.adDataV2.templateDatas.length;for(let n=0;n<a;n++){let e=t.adMatrixInfo.adDataV2.templateDatas[n];if(e.templateId==i)return e}}function D(t,e){let i=L(t,e);if(!i)return null;console.log("tkloadcontroller   get template is:"+i);const a=t.adMatrixInfo.styles.templates.length;for(let n=0;n<a;n++){let e=t.adMatrixInfo.styles.templates[n];if((null==e?void 0:e.templateId)==i)return e}return null}function E(t,e){let i=!0;if(1==t.adBaseInfo.adOperationType)try{let a=t.downloadSafeInfo.complianceInfo;if(console.log("tkloadcontroller   download ad:"+JSON.stringify(a)),null!=a)switch(e){case 1:i=3!=a.actionBarType;break;case 2:i=3!=a.describeBarType;break;case 3:i=3!=a.materialJumpType;break;default:i=!0}}catch(a){i=!0}else try{let a=t.unDownloadConf.unDownloadRegionConf;if(console.log("tkloadcontroller   h5 ad:"+JSON.stringify(a)+", clickArea: "+e),null!=a)switch(e){case 1:i=1!=a.actionBarType;break;case 2:i=1!=a.describeBarType;break;case 3:i=1!=a.materialJumpType;break;default:i=!0}console.log("tkloadcontroller   h5 ad:"+i)}catch(a){i=!0}return i}function b(t){return g.isOriginLiveAd(t)||function(t){return 7==A(t)}(t)}function k(t,e){try{let i=e.adMatrixInfo.adDataV2.templateDatas;for(let e=0;e<i.length;e++){let a=i[e];if(a&&t==a.templateId)return a}}catch(i){}}function N(t){let e=!1;try{e=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.showEndPage}catch(i){}return e}function R(t){if(rt.isAndroid()){try{return t.shakeInfo.acceleration}catch(e){}return 12}{const i=[.35,.5,.65,.8,1,1.5,2];let a=5;try{a=t.shakeInfo.acceleration-1}catch(e){}return a<=0?a=5:a>=i.length&&(a=i.length-1),i[a]}}function V(t){try{return t.bidirectionalSwitch}catch(e){}return!1}function K(t){return!(!t.downloadSafeInfo||!rt.isSupportDownloadDel())&&t.downloadSafeInfo.downloadDeleteEnable}function O(t){return!!(v(t)&&t.downloadSafeInfo&&rt.isSupportDownloadDel())&&t.downloadSafeInfo.downloadShowPauseEnable}var x=null,P=null,M=null,B=null,F=null;function W(t){console.log("tkloadcontroller  save global device info:"+JSON.stringify(t)),x=t}function H(){return F}function U(){return P}function z(){return B}function G(){const t=Tachikoma.env.styleTemplate;return t?JSON.parse(t):null}function Y(t,e){e=e||G(),t=t||m(z());const i=null==e?void 0:e.templateId,a=null==e?void 0:e.templateVersionCode,n=null==t?void 0:t.adTKGrayConfig,s=i+"#"+a;return(null==n?void 0:n.get(s))||0}function j(){return Date.parse((new Date).toString())}function J(t){return t instanceof Error?t.message+":"+t.stack:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function $(){return!it(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function X(){return"Android"===Tachikoma.env.platform}function Z(t,e){let i={x:0,y:0};if(rt.supportMinimumTKVersion("4.0.0")){const a=e.getLocationOnScreen(),n=t.position;if(!a||!n)return i;n.x=parseFloat((n.x+"").replace("dp","")),n.y=parseFloat((n.y+"").replace("dp","")),i={x:a.x+n.x,y:a.y+n.y}}return i}function q(t){return"string"==typeof t&&t.length>0}function Q(){return x?x.tkVersion:Tachikoma.env.tkVersion||Tachikoma.env.TKVersion}function tt(){return x?x.SDKVersion:Tachikoma.env.SDKVersion}function et(){return x?x.sdkType:Tachikoma.env.sdkType}function it(t){return null===t||null==t||""===t}new class{};class at{constructor(t,e,i){this.name=t,this.object=e,this.parent=i,this.children=new Map}addChildren(t,e){this.children.set(t,e)}}function nt(t,e,i){if(t){e||(e=new at("root",t)),i||(i=new Set),i.add(t);for(const a in t){const n=typeof t[a],s=t[a];if("object"==n&&!a.includes("$")&&s){s.nativeID||(s.nativeID=a);const t=new at(a,s,e);if(e.addChildren(a,t),i.has(s)){const e=[];e.push(t);let i=t,a=!1;for(;i.parent;)if(i=i.parent,e.push(i),i.object===t.object){a=!0;break}if(a){let t="执行出错：发生循环引用\n";for(let a=e.length-1;a>=0;--a)i=e[a],t+=i.name+":"+i.object+"\n";throw new Error(t)}}nt(s,t,i)}}}}function st(){return 1==Tachikoma.env.isDebug}function ot(t){let e=t;return e.indexOf("/")>=0||t.startsWith("http")||(e="https://"+a.getInstance().getCurrentHost()+"/kos/nlav111362/ksad/"+t),e}class rt{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||rt.supportMinimumTKVersion("5.0.4")}static isSupportDownloadDel(){return this.isAndroid()&&rt.supportMinimumTKVersion("5.0.7")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let i=t.split("."),a=e.split("."),n=Math.max(i.length,a.length);for(var s=0;s<n;s++){let t=Number(void 0!==i[s]?i[s]:"0"),e=Number(void 0!==a[s]?a[s]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let i=et(),a=1==i&&-1!=rt.compareVersion(tt(),t),n=2==i&&-1!=rt.compareVersion(tt(),e);return a||n}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let i=et(),a=1==i&&0==rt.compareVersion(tt(),t),n=2==i&&0==rt.compareVersion(tt(),e);return a||n}static supportCurrentTKVersion(t="0.0.0"){return Q()==t}static supportMinimumTKVersion(t="0.0.0"){return-1!=rt.compareVersion(Q(),t)}}rt.platform=Tachikoma.env.platform;ot("h5_default_icon.png"),ot("download_default_icon.png");var lt,ht,ct,dt;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PORTRAIT_CLICK=13]="PORTRAIT_CLICK",t[t.COMMENT_CLICK=14]="COMMENT_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.COMMENT_DETAIL_CLICK=25]="COMMENT_DETAIL_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.COMMON_CARD_CLICK=89]="COMMON_CARD_CLICK",t[t.COMMENT_PICTURE_CLICK=100]="COMMENT_PICTURE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA",t[t.POPLAY_FALL_IOCN=186]="POPLAY_FALL_IOCN",t[t.ROTATE_SHAKE_BIG_ICON_CLICK=187]="ROTATE_SHAKE_BIG_ICON_CLICK",t[t.RETAIN_AGG_CARD_CLICK=189]="RETAIN_AGG_CARD_CLICK",t[t.PLAYEND_AGG_CARD_CLICK=190]="PLAYEND_AGG_CARD_CLICK",t[t.SURPRISE_BOX_CLICK=191]="SURPRISE_BOX_CLICK",t[t.BUBBLE_RAIN_CLICK=192]="BUBBLE_RAIN_CLICK"}(lt||(lt={})),function(t){t[t.adClickReward=1]="adClickReward"}(ht||(ht={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(ct||(ct={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(dt||(dt={}));var ut,pt;!function(t){t[t.THREEIMG_DEFAULT_CLICK=0]="THREEIMG_DEFAULT_CLICK",t[t.THREEIMG_FIRST_CLICK=1]="THREEIMG_FIRST_CLICK",t[t.THREEIMG_SECOND_CLICK=2]="THREEIMG_SECOND_CLICK",t[t.THREEIMG_THIRD_CLICK=3]="THREEIMG_THIRD_CLICK"}(ut||(ut={})),function(t){t[t.picStyle=1]="picStyle",t[t.textStyle=2]="textStyle"}(pt||(pt={}));const Ct=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t),st()&&console.log("tkloadcontroller:"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class gt{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i="",a=0;a<t;a++)i+=e.charAt(Math.floor(48*Math.random()));return i}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,i){if(!t)return null;const a=this.randomName(i);return Tachikoma[a]=e=>{t(e)},"Tachikoma."+a}}gt.globalIndex=0;class It{static getDeviceInfoAsync(){return It.callNative("getDeviceInfo",null).then((t=>(t.result&&t.data&&W(t.data),t)))}static getKsAdDataAsync(){return It.callNative("getKsAdData",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,B=e),t}))}static getKsAdConfigAsync(){return It.callNative("getKsAdConfig",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,P=e),t}))}static getScreenOrientationAsync(){return It.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return It.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return It.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return It.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.lifeStatusCallback=t,this.callNativeWithCallback("registerLifecycleListener",null,(t=>{this.lifeStatusCallback&&!this.isForceUpdateLifeStatus&&this.lifeStatusCallback(t)}),!1)}static forceUpdateLifeStatus(t,e){let i={result:1,data:{lifeStatus:t}};this.isForceUpdateLifeStatus=e,this.lifeStatusCallback&&this.lifeStatusCallback(i)}static registerFocusListener(t){rt.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("registerFocusListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,i,a=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},i,a)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static adOutCallback(t,e){rt.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("adOutCallback",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:q(e)?e:""})}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,(e=>{t&&t(e)}),!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,i,a=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:i,playDuration:a})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e,i){this.callNativeWithCallback("openURL",{url:t,title:e,showConfirmDialog:i})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){X()&&this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((i,a)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),i(t)):i({result:0,data:null})}))))}static callNativeWithCallback(t,e,i,a=!0){const n=$()?1:0;$()&&"pageStatus"==t||$()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,i,a,0):this.callNativeWithCallbackAndType(t,e,i,a,n)}static callTKWithCallback(t,e,i,a=!0){this.callNativeWithCallbackAndType(t,e,i,a,1)}static callNativeWithCallbackAndType(t,e,i,a=!0,n=0){if("undefined"==typeof KwaiAd)return Ct.log("undefined value KwaiAd"),void(i&&i({result:0,data:null}));Ct.log("call:"+t);let s=e=>{let a=0,n=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,a=t.result,n=t.data}catch(s){a=0,n=null}Ct.log("cb:"+t+"  r:"+a),i&&i({result:a,data:n})};const o=gt.registerCallbackForAction(s,a,t),r={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?s:o};0==n?KwaiAd.callAdBridge(r):KwaiAd.callTKBridge(r)}}function ft(t,e,i){It.callNativeWithCallback("splashShowStatus",{status:t,errorCode:e,errorMsg:i})}let mt;function Tt(){var t;return mt||(mt={all:t=t||new Map,on(e,i){const a=t.get(e);a?a.push(i):t.set(e,[i])},off(e,i){const a=t.get(e);a&&(i?a.splice(a.indexOf(i)>>>0,1):t.set(e,[]))},emit(e,i){let a=t.get(e);a&&a.slice().map((t=>{t(i)})),a=t.get("*"),a&&a.slice().map((t=>{t(e,i)}))},clear(){t.clear()}}),mt}class _t{constructor(t,e,i,a,n,s,o){this.soundEnable=!1,this.ignoreCompliance=!1,this.disableDownloadDialog=!1,this.disableLeaveConfirm=!1,this.disableVideoWebPage=!1,this.disableActivityMiddlePage=!1,this.originAdInfo=t,this.deviceInfo=e,this.serverConfig=i,this.creativeId=s;let r=I(this.originAdInfo,s);this.adInfo=f(r),this.adCacheId=o||Tachikoma.env.adCacheId,this.originAdInfo.adCacheId=this.adCacheId,this.appId=n||Tachikoma.env.appId,this.scene=a,a||(Tachikoma.env.adScene?this.scene=JSON.parse(Tachikoma.env.adScene):this.scene={adStyle:r.adStyle,backUrl:""})}getCommercialLogInfo(){const t=new St;t.creativeId=this.creativeId,t.llsid=this.originAdInfo.llsid,t.posId=this.originAdInfo.impAdInfo[0].posId;const e=this.adInfo.adConversionInfo.h5SecondConfirmationSwitch;return t.landingPageType=e?0:1,this.sourceTemplate&&(t.templateId=this.sourceTemplate.templateId,t.templateVersion=this.sourceTemplate.templateVersionCode,t.tkPublishType=Y(this.adInfo,this.sourceTemplate)),t}getOcpcActionType(){try{return this.adInfo.ocpcActionType}catch(t){return 0}}getCampaignType(){try{return this.adInfo.adBaseInfo.campaignType}catch(t){return 0}}getIndustryFirstLevelId(){try{return this.adInfo.adBaseInfo.industryFirstLevelId}catch(t){return 0}}getAdOperationType(){try{return this.adInfo.adBaseInfo.adOperationType}catch(t){return 0}}}class St{}class vt{constructor(){this.reward_type=-1,this.task_type=-1,this.task_step=-1}static createPageShowInstance(t,e,i){if(0==e||it(i))return null;if(i.loadDataTime<=0||i.downloadFinishTime<=0)return null;let a=this.INVALID_VALUE;if(e!=this.INVALID_VALUE){a=Date.parse((new Date).toString())-e,a<this.INVALID_VALUE&&(a=this.INVALID_VALUE)}let n=new vt;return n.page_status=2,n.load_type=i.loadFromCache?2:1,n.render_duration_ms=a,n.download_type=i.downloadType,n.download_size=i.downloadSize,n.creative_id=t.adBaseInfo.creativeId,n.video_url=S(t),n.video_duration_ms=function(t){try{return t.adMaterialInfo.materialFeature[0].videoDuration}catch(e){}return 0}(t),n}}function wt(t){Lt({category:"ad_client_apm_log",biz:"AD_SPLASH",sub_biz:"OTHER",rate:1,suffixRatio:"",primaryKey:"status",event_id:"ad_sdk_splash_load",type:"EXECUTION_BIZ_TIME",msg:{status:8001,error_msg:t||""}})}function At(t){Lt({category:"ad_client_apm_log",biz:"AD_SPLASH",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_sdk_splash_load",primaryKey:"status",type:"EXECUTION_BIZ_TIME",msg:t})}function Lt(t){rt.supportMinimumTKVersion("4.0.4")&&(t.msg&&(t.msg.report_source=1),It.sendCommercialLog(t,(()=>{})))}vt.INVALID_VALUE=-1;class yt{static createVideoCommonInstance(t,e){return 3==t?yt.createFullscreenCommonInstance(e):2==t?yt.createNeoCommonInstance(e):null}static createImageCommonInstance(t,e){var i;let a=new h;return a.template_id=L(e,16),a.template_version=null===(i=D(e,16))||void 0===i?void 0:i.templateVersion,a}static createLiveCommonInstance(t,e){var i;let a=new h;return a.template_id=L(e,14),a.template_version=null===(i=D(e,14))||void 0===i?void 0:i.templateVersion,a}static createNeoCommonInstance(t){var e;let i=new h,a=g.getNeoActionBarCardType(t);return i.actionbar_card_type=a,i.template_id=L(t,12),i.template_version=null===(e=D(t,12))||void 0===e?void 0:e.templateVersion,a!=d.LIVE_CUT3_STYLE1&&a!=d.LIVE_CUT3_STYLE2||(i.live_room_pattern=l.SIMPLIFIED_LIVE_ROOM_PATTERN),i}static createFullscreenCommonInstance(t){let e=new h,i=g.getFullscreenActionBarCardType(t);return e.actionbar_card_type=i,i!=d.LIVE_CUT3_STYLE1&&i!=d.LIVE_CUT3_STYLE2||(e.live_room_pattern=l.SIMPLIFIED_LIVE_ROOM_PATTERN),e}static appendNeoExtData(t,e,i,a){if(null==t)return;let n=t.neo_ext_data;null==n&&(n=new c,t.neo_ext_data=n),i&&(n.videoRollbackToImageTimeout=i.videoRollbackToImageTimeout),n.originalMaterialType=_(e),a&&n&&a(n)}}var Dt=function(t,e,i,a){return new(i||(i=Promise))((function(n,s){function o(t){try{l(a.next(t))}catch(e){s(e)}}function r(t){try{l(a.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((a=a.apply(t,e||[])).next())}))};class Et{static sendLog(t,e,i,a){this.log(t,null,e,i,a)}static log(t,e,i,a,n){(i=i||{}).renderContainer=1;const s={actionType:t,payload:JSON.stringify(i)};if(n&&(s.creativeId=n),a)if(null==a?void 0:a.adCacheId)s.adCacheId=null==a?void 0:a.adCacheId;else{const t=I(a,n);s.adTemplate=JSON.stringify(t)}e&&(s.clickInfo=e),It.sendLog(s)}static convertIfNeeded(t,e,i,a,n,s,o,r,l,c,d){let u=E(e,i);if(!u)return u;let p=M;return it(p)||(s||(s=new h),it(s.template_id)&&(s.template_id=p.templateId),it(s.template_version)&&(s.template_version=p.templateVersion)),s=Et.appendGlobalNeoExtData(s,e),b(e)&&this.reportLivePlaySecond(this.sCurrentPlayTimeMs/1e3),this.convert(i,a,n,t,s,o,r,l,c,d),u}static convert(t,e,i,a,n,s,o,r,l,h){var c,d;return Dt(this,void 0,void 0,(function*(){const u=f(I(z(),r));if(!u||!E(u,t))return void console.log("tkloadcontroller invalid convert:"+u+":"+t);let p,C;p=it(n)?{itemClickType:i,renderContainer:1}:{itemClickType:i,renderContainer:1,clientExtData:JSON.stringify(n)},it(s)||Object.assign(p,s),Tt().emit("ad_convert_event",{clickType:i}),e?(C={x:e.x,y:e.y},e.width&&(C.width=e.width),e.height&&(C.height=e.height)):C={};let g=-1;(null==o?void 0:o.convertType)&&(g=o.convertType,p.triggerType=g);let T=!1;if(this.matchTKConversion()){console.log("tkloadcontroller match conversion service");let i=KSAdTKBundleService.getInstance("CommercialKSAdConversionService","conversion-service",null);if(i){console.log("tkloadcontroller service instance is:"+i);const n=new _t(l||z(),x,U());n.currentPlayTime=this.sCurrentPlayTimeMs,n.clickScene=a,n.convertType=g,n.creativeId=r,n.clickArea=t,n.soundEnable=this.sSoundEnable,n.sourceTemplate=G(),(null==o?void 0:o.liveItemId)&&(n.liveItemId=o.liveItemId),Tachikoma.env.isDebug&&(_="TK转化链路开始",It.callNativeWithCallback("showToast",{message:_})),i.getVersion()>=2&&(this.sSecondClickCallback=t=>{0==t?It.forceUpdateLifeStatus("pageInvisiable",!0):1==t?It.forceUpdateLifeStatus("pageInvisiable",!1):2==t&&It.forceUpdateLifeStatus("pageVisiable",!1)},i.setSecondConfirmCallback(this.sSecondClickCallback),i.getVersion()>=3&&rt.supportMinimumTKVersion("5.1.3")&&X()&&(this.sDownloadTipCallback=t=>{switch(t){case 0:It.adOutCallback({targetMethod:"adDownloadConfirmTipShow"});break;case 2:It.adOutCallback({targetMethod:"adDownloadConfirmTipCancel"});break;case 1:It.adOutCallback({targetMethod:"adDownloadConfirmTipDismiss"})}},i.setDownloadConfirmTipCallback(this.sDownloadTipCallback))),this.sHandleAdClickCallback=t=>{if(this.sCurrentPlayTimeMs>0&&(p.playedDuration=this.sCurrentPlayTimeMs),t.reportExtraParam)try{let e=it(p.clientExtData)?{}:JSON.parse(p.clientExtData);e.clientExtData=JSON.parse(t.reportExtraParam),p.clientExtData=JSON.stringify(e)}catch(i){!function(t,e="",i=""){var a,n;Lt({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:.001,suffixRatio:"",event_id:"ad_tk_render_performance",primaryKey:"unknown",type:"OTHER",msg:{render_state:3,error_reason:J(t),template_id:it(i)?null===(a=G())||void 0===a?void 0:a.templateId:i,version_code:it(e)?null===(n=G())||void 0===n?void 0:n.templateVersionCode:e}})}(i)}this.log(2,e,p),rt.isAndroid()||this.handleIOSConvertCallback(t)},this.sAfterHandleClickCallback=()=>{rt.supportMinimumTKVersion("6.0.3")&&!rt.isAndroid()&&It.callNativeWithCallback("callbackAfterHandleAdClick",{})},i.getVersion()>=4&&i.setAfterHandleClickCallback(this.sAfterHandleClickCallback),i.handleAdClick(JSON.stringify(n),this.sHandleAdClickCallback),T=!0}else this.loadConversionServiceIfNeeded((t=>{console.log("tkloadcontroller service load result:"+t)}))}var _;let S=null==l?void 0:l.impAdInfo[0];r||(r=null===(d=null===(c=m(l||z()))||void 0===c?void 0:c.adBaseInfo)||void 0===d?void 0:d.creativeId),function(t,e,i,a,n,s,o,r){e.isCallbackOnly=r,It.clickActionBase(Object.assign(Object.assign({area:t,logParam:e},i),{creativeId:a,adTemplate:s,disableCallback:o,isCallbackOnly:r}),n)}(t,{payload:JSON.stringify(p),clickInfo:C,sceneType:a,itemClickType:i},o,r,(i=>{1!=i.result&&(this.log(2,e,p),It.convert(1==t))}),S,h,T)}))}static handleIOSConvertCallback(t){t.success&&3==t.interactionType&&It.adOutCallback({targetMethod:"closeConvertPageCallback",methodParams:JSON.stringify({interactionType:t.interactionType})})}static reportClick(t,e,i,a){null==a&&(a=new h),a=Et.appendGlobalNeoExtData(a,t);let n={clientExtData:JSON.stringify(a)};n=Object.assign(n,i),Et.log(2,null,n)}static appendGlobalNeoExtData(t,e){let i=U(),a=H();return null!=a&&null!=i&&(t||(t=new h),yt.appendNeoExtData(t,e,i.abConfig,(t=>{t.realRenderResult=a}))),t}static expose(t,e){this.log(1,null,t,e)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,i,a,n){this.convertWithType(e,i,a,n)}static convertWithType(t,e,i,a){this.convert(t,e,i,0,null,null,{convertType:a})}static convertWithTypeIfNeededNew(t,e,i,a,n,s){E(t,e)&&this.convertWithTypeNew(e,i,a,n,s)}static convertWithTypeNew(t,e,i,a,n){this.convert(t,e,i,0,null,n,{convertType:a})}static playNSecond(t,e){let i={photoPlaySecond:t};if(e){let t={clientExtData:JSON.stringify(e)};Object.assign(i,t)}this.log(402,null,i)}static playStart(t){let e=null;t&&(e={clientExtData:JSON.stringify(t)}),Et.log(399,null,e)}static reportLivePlaySecond(t){let e={photoPlaySecond:Math.round(t)},i={actionType:28,payload:JSON.stringify(e)};It.sendLog(i)}static skip(){this.log(501,null,null)}static loadConversionServiceIfNeeded(t){this.matchTKConversion()&&KSAdTKBundleService.loadBundle("CommercialKSAdConversionService",t),t&&t(!1)}static matchTKConversion(){var t,e;return!!(null===(e=null===(t=U())||void 0===t?void 0:t.abConfig)||void 0===e?void 0:e.tkConversionSwitch)&&(!(!X()||!rt.supportMinimumTKVersion("6.0.5"))||!X()&&rt.supportMinimumTKVersion("6.0.3"))}static updateVideoPlayStatus(t,e,i,a){!function(t,e,i,a){It.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:i||"",currentTime:a||0})}(t,e,i,a),"progress"==t&&a&&(this.sCurrentPlayTimeMs=a)}static updateLivePlayStatus(t,e,i,a){"progress"==t&&a&&(this.sCurrentPlayTimeMs=a)}}Et.sSoundEnable=!1;class bt{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,It.pageStatus(t,e),this.registerNativeId(),Et.loadConversionServiceIfNeeded((t=>{})))}registerNativeId(){st()&&rt.supportMinimumTKVersion("4.0.7")&&!rt.isAndroid()&&(this.startConfig(),It.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{nt(this)}),120)}}class kt extends TKView{}class Nt extends Object{constructor(t,e,i,a){var n;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=i,this.value=this.get(),this.cb(null!==(n=this.value)&&void 0!==n?n:a,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){Nt.target=this;const t=this.getter.call(this.vm,this.vm);return Nt.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let i=0,a=e.length;i<a;i++){if(!t)return;t=t[e[i]]}return t}}}function Rt(t){return!!t}function Vt(t){return"string"==typeof t}let Kt;function Ot(){if(null!=Kt)return Kt;let t=!1;try{t=!1,Kt=t}catch(e){}return t}function xt(t,e){if(!0===Ot()&&(null==t||!1===t))throw new Error("tkmvvm ----- 请检查传值: "+e)}function Pt(t){return t.$vm}function Mt(t){Ot()&&console.log("tachikoma TKMVVM log -> "+t)}class Bt extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var i=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(a){e?e===a&&i.observeValueWithKey(t,a):i.observeValueWithKey(t,a)}))}observeValueWithKey(t,e){let i=t[e];var a=new Wt(e);Ht(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return Nt.target&&a.depend(),i},set:function(t){t!==i&&(i=t,a.notify(),Ht(t))}})}defineArray(t){if(t)for(let e=0,i=t.length;e<i;e++)Ht(t[e])}}var Ft=0;class Wt extends Object{constructor(t){super(),this.key=t,this.pid=Ft++,this.deps=new Array}depend(){Nt.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function Ht(t,e){if(!t||"object"!=typeof t)return;var i;if(!("object"==typeof(i=t)&&Object.keys(i).length>0))return;let a=!1,n=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(n)&&(a=t[n]),!a)return Mt("observe "+n),t[n]=!0,new Bt(t,e);Mt("already observe "+n)}const Ut={updateBackgroundColor:function(t,e,i){if(xt(e,"backgroundColor"),t&&e&&Vt(e)){const i=function(t){let e="#FE3666";return t?/^rgb|^hsl/.test(t)?t:(t.startsWith("#")||(t="#"+t),/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(t)?t:e):e}(e);t.style={backgroundColor:i}}},updateStyle:function(t,e,i){xt(e,"style"),t&&e&&(t.style=e)},updateText:function(t,e,i){if(xt(e,"text"),t&&Vt(e)){const i=t.setText;"function"==typeof i&&i.call(t,e)}},updateSrc:function(t,e,i){if(xt(e,"src"),t&&e&&Vt(e)){const i=t.setSrc;"function"==typeof i&&i.call(t,e)}}};class zt extends Object{constructor(){super()}tk_observe(t){Rt(t)&&(t in this?Ht(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}function Gt(t,e,i,a,n){if(!Rt(t)||!Rt(i))return;const s=e.charAt(0).toUpperCase()+e.slice(1),o=Ut["update"+s],r=Jt(i),l=null==r?void 0:r.split(".");if(!l)return void xt(l,"tk_bind error, check bind path");const h=l[0],c=Pt(i);if(!c)return void xt(c,"vm_bind get vm error");c.tk_observe(h),new Nt(c,r,((e,i)=>{if(n)for(let t=0;t<n.length;t++){n[t].dataCheck(e,r)}o&&o(t,e,i)}),a)}function Yt(t,e){const i=Pt(t);if(!Rt(i)||!Rt(t)||!Rt(e))return;const a=Jt(t),n=null==a?void 0:a.split(".");if(!n)return void xt(n,"tk_bind error, check bind path");const s=n[0];i.tk_observe(s),new Nt(i,a,((t,i)=>{e&&e(t)}))}function jt(t,e,i){if(!Rt(t)||!Rt(e)||!Rt(i))return;const a=Jt(e),n=null==a?void 0:a.split(".");if(!n)return void xt(n,"tk_bind error, check bind path");const s=n[0];t.tk_observe(s),new Nt(t,a,((t,e)=>{i&&i(t)}))}function Jt(t){let e=function(t){if(t)return t.bind_path?t.$bind_path:"string"==typeof t?t:void 0}(t);if(e)return e;xt(e,"tk_bind error, check bind path")}class $t extends TKView{constructor(t,e,i){super();let a=e.adBaseInfo,n="#00000000";3==t?n="#00000019":0!=t&&(n="#00000025"),this.style={height:it(i)?16:i,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",backgroundColor:n,borderRadius:3==t?3:2};let s=3;if(2!=t){let e=null;1==t||3==t?q(a.adMarkIcon)&&(e=a.adMarkIcon):q(a.adGrayMarkIcon)&&(e=a.adGrayMarkIcon),q(e)&&(this.iconView=new TKImage,this.iconView.style={width:12,height:12,marginLeft:3,opacity:3==t?.4:1},s=4,this.appendChild(this.iconView),this.iconView.setSrc(e))}let o="#9C9C9C";0!=t&&(o="#FFFFFF"),this.titleLabel=new TKText,this.titleLabel.style={color:o,minimumTextScaleFactor:.5,fontSize:10,marginLeft:s,marginRight:3,textAlign:"center",includeFontPadding:!1,opacity:3==t?.4:1};let r=a.adSourceDescription;r||(r="广告"),this.titleLabel.setText(r),this.appendChild(this.titleLabel)}setTitleColor(t){this.titleLabel&&(this.titleLabel.style={color:t},this.style={height:16,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",borderRadius:2})}}class Xt extends TKView{constructor(t,e){super(),this.isAnimStarting=!1,this.vm=t,this.viewWH=e,this.setupView(),this.setupData()}setupView(){this.style={width:2*this.viewWH,height:2*this.viewWH},this.shakeAnimationView=new TKView,this.shakeAnimationView.style={width:2*this.viewWH,height:2*this.viewWH},this.appendChild(this.shakeAnimationView),this.shakeImage=new TKImage,this.shakeImage.style={width:this.viewWH,height:this.viewWH,left:0,top:0,position:"absolute"},this.shakeImage.setSrc(this.vm.getResourceRoot()+"icon_ksad_endcard_shake.png"),this.shakeAnimationView.appendChild(this.shakeImage)}setupData(){jt(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"showEnd":case"pageVisiable":this.startShakeAnimation();break;case"hideEnd":case"pageInvisiable":this.stopShakeAnimation()}}))}startShakeAnimation(){if(this.isAnimStarting)return;this.stopShakeAnimation(),this.isAnimStarting=!0,this.addShakeAnim();const t=this;this.shakeAnimationTimer=setInterval((()=>{t.addShakeAnim()}),1200);try{KSAdSensorManager.registerSensorListener(1,-3,(t=>{this.vm.canConvertShake(t)}))}catch(e){}}addShakeAnim(){const t=new TKKeyframeAnimation;t.animType="rotationZ";let e=rt.isAndroid()?.8:1;t.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:.25,value:rt.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.33,value:-rt.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.5,value:rt.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.66,value:-rt.getRotateSemiCircle()/(5.625*e),easing:"EaseInEaseOut"},{percent:.83,value:rt.getRotateSemiCircle()/(11.25*e),easing:"EaseInEaseOut"},{percent:.91,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}],t.duration=1500,t.repeatCount=0,this.shakeAnimationView&&this.shakeAnimationView.addAnimation(t,"shakeAnimation")}stopShakeAnimation(){this.isAnimStarting=!1,KSAdSensorManager.unregisterSensorListener(1),this.shakeAnimationTimer&&(clearInterval(this.shakeAnimationTimer),this.shakeAnimationTimer=0),this.shakeAnimationView&&this.shakeAnimationView.removeAllAnimation()}}class Zt extends TKView{constructor(t,e){super(),this.downloadState=0,this.vm=t,this.showContainer=e,this.setupView(),this.setupAction(),Yt(this.vm.$attrsPath.showPopupView,(t=>{console.log("jky KSAdDownloadPopup needShowPopupView: "+t),this.updatePopViewState(t)})),Yt(this.vm.$attrsPath.downloadState,(t=>{this.updateControlBtnState(this.vm.isDownloadPaused())})),Yt(this.vm.$attrsPath.descText,(t=>{this.desText&&t&&this.desText.setText(t)}))}setupView(){this.style={width:"100%",height:"100%",alignItems:"center",opacity:0,position:"absolute"},this.baseContainer=new TKView,this.baseContainer.style={alignItems:"center",justifyContent:"center",width:245,height:36,top:10,shadow:"0 0 8 #00000099",backgroundColor:"#FFFFFF",borderRadius:120,flexDirection:"row"},this.appendChild(this.baseContainer),this.closeButton=new TKImage,this.closeButton.style={marginStart:10,justifyContent:"center",width:10,height:10},this.closeButton.setSrc("image/ksad-compose-image/ksad_icon_close.png"),this.baseContainer.appendChild(this.closeButton),this.desText=new TKText,this.desText.style={marginStart:10,width:77,fontSize:12,textAlign:"left",includeFontPadding:!1,color:"#222222",fontWeight:"200"},this.desText.setText(this.vm.getDesText()),this.baseContainer.appendChild(this.desText),this.continueButton=new TKText,this.continueButton.style={marginStart:12,width:52,height:20,borderRadius:100,borderWidth:.5,borderColor:"#FE3666",color:"#F66484",fontSize:12,textAlign:"center"},this.updateControlBtnState(!1),this.baseContainer.appendChild(this.continueButton),this.delButton=new TKText,this.delButton.style={marginStart:8,width:52,height:20,borderRadius:100,borderWidth:.5,borderColor:"#4D666666",color:"#666666",fontSize:12,textAlign:"center"},this.delButton.setText("删除"),this.baseContainer.appendChild(this.delButton)}setupAction(){this.baseContainer.addEventListener("tap",(t=>{})),this.closeButton.addEventListener("tap",(t=>{this.vm.onCloseClick(),this.vm.showPopupView=!1})),this.continueButton.addEventListener("tap",(t=>{this.vm.convert(1,1,{x:t.position.rawX,y:t.position.rawY},lt.ACTION_BAR_CLICK),this.vm.isNeedShowDownloading()||this.dismissPopup()})),this.delButton.addEventListener("tap",(t=>{var e;e=t=>{It.showToast(this.vm.getDeleteToast())},It.callNativeWithCallback("cancelAppDownloadForAd",null,e),this.dismissPopup()}))}updatePopViewState(t){console.log("jky updatePopViewState: show: "+t+", isShow: "+this.isShow),t?this.isShow||(this.showContainer.appendChild(this),this.isShow=!0,this.startShowAnimation()):this.isShow&&(this.showContainer.removeChild(this),this.isShow=!1,this.dismissPopup())}updateControlBtnState(t){t?this.continueButton.setText("继续"):this.continueButton.setText("暂停")}startShowAnimation(){this.style={visibility:"visible"};const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={marginTop:48,opacity:0},0),()=>(this.style={marginTop:64,opacity:1},1)]),t.duration=600,t.repeatCount=1,this.addAnimation(t,"popupShowAnimation")}dismissPopup(){const t=new TKKeyframeAnimation;t.setAnimations([()=>(this.style={opacity:1},0),()=>(this.style={opacity:0},1)]),t.duration=300,t.repeatCount=1,this.addAnimation(t,"popupDismissAnimation"),this.style={visibility:"hidden"}}setMarginTop(t){this.baseContainer.style={top:t}}}class qt extends TKView{constructor(t,e){super(),this.lottieViewWidth=78,this.lottieViewHeight=62,this.isAnimationRunning=!1,this.vm=t,this.viewWH=e,this.scale=Math.min(e.width/this.lottieViewWidth,e.height/this.lottieViewHeight),this.setupView(),this.setupAction()}setupView(){this.style={width:this.viewWH.width,height:this.viewWH.height},this.rotateAnimationView=new TKView,this.rotateAnimationView.style={width:this.lottieViewWidth,height:this.lottieViewHeight,alignItems:"center",transform:{scale:this.scale,translate:{x:Math.ceil(this.lottieViewWidth*(this.scale-1)/2),y:Math.ceil(this.lottieViewHeight*(this.scale-1)/2)}}},this.appendChild(this.rotateAnimationView),rt.supportMinimumTKVersion("5.0.0")&&(this.rotateView=new TKLottieImageView,this.rotateView.style={top:6,width:56,height:56,position:"absolute"},this.setRotateLottieView("image/ksad-splash-end-card/ksad_endcard_rotate_icon.json",this.rotateView,!0),this.arrowView=new TKLottieImageView,this.arrowView.style={width:80,height:27,position:"absolute"},this.setRotateLottieView("image/ksad-splash-end-card/ksad_endcard_rotate_arrow.json",this.arrowView,!1),this.vm.rotateInfoCallback=(t,e,i)=>{let a=Math.abs(t)/this.vm.splashInfo.interactionInfo.rotateInfo.x.rotateDegree,n=Math.abs(e)/this.vm.splashInfo.interactionInfo.rotateInfo.y.rotateDegree,s=Math.abs(i)/this.vm.splashInfo.interactionInfo.rotateInfo.z.rotateDegree,o=Math.max(a,n,s);this.arrowView.setProgress(o>1?1:o<0?0:o)})}setupAction(){Yt(this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"showEnd":case"pageVisiable":this.startRotateAnimation();break;case"hideEnd":case"pageInvisiable":this.stopRotateAnimation()}}))}setRotateLottieView(t,e,i){e.setUri(t),e.setLoop(i),e.enabled=!1,this.rotateAnimationView.appendChild(e)}startRotateAnimation(){var t;this.isAnimationRunning||(this.stopRotateAnimation(),this.isAnimationRunning=!0,null===(t=this.rotateView)||void 0===t||t.resume(),this.vm.startSensorListener())}stopRotateAnimation(){var t;this.isAnimationRunning&&(null===(t=this.rotateView)||void 0===t||t.stop(),this.vm.stopSensorListener(),this.isAnimationRunning=!1)}}class Qt extends TKView{constructor(t,e,i,a="#30303099",n="#FFFFFF",s){super(),this.adInfo=t,this.isVertical=0==e,this.backgroundColor=a,this.color=n,this.shadow=s,this.containerWidth=i,this.setupView(),this.setupData()}setupView(){this.style={opacity:.6,flexDirection:"column",backgroundColor:this.backgroundColor,borderRadius:4,padding:10};let t=this.style.width;if("number"==typeof t)this.containerWidth=t;else if("string"==typeof t)if(isNaN(Number(t))){if("%"!=t.slice(-1))return;this.containerWidth*=Number(t.slice(0,-1))/100}else this.containerWidth=Number(t);if(this.addEventListener("tap",(()=>{})),this.appInfoLabel=this.createLabel(this.color),this.isVertical&&(this.appInfoLabel.style={flexShrink:1,textLineClamp:1,textOverflow:"ellipsis"},this.appInfoLabel.text=this.appendNameText(""),this.appInfoLabel.text=this.appendDeveloperText(this.appInfoLabel.text),q(this.appInfoLabel.text)&&rt.supportMinimumTKVersion("5.0.0")))try{this.appInfoLabel.measureForText(this.appInfoLabel.text,this.containerWidth,2).startIndex>1&&(this.appendChild(this.appInfoLabel),this.isTooLong=!0)}catch(e){console.error("ignore"+new Error(e).stack)}this.otherLabel=this.createLabel(this.color),this.otherLabel.style={marginRight:10},this.appendChild(this.otherLabel),q(this.shadow)&&(this.otherLabel.style={shadow:this.shadow})}createLabel(t){let e=new TKText;return e.style={color:t,fontSize:10,textLineHeight:16},e}setupData(){let t="";if(this.isVertical?(this.isTooLong||(t=this.appendNameText(t),t=this.appendDeveloperText(t)),t=this.appendRecordText(t)):(t=this.appendNameText(t),t=this.appendDeveloperText(t),t=this.appendRecordText(t)),rt.supportMinimumTKVersion("4.0.5")?q(this.adInfo.downloadSafeInfo.appVersion)&&(t+="| 版本 "+this.adInfo.downloadSafeInfo.appVersion):q(this.adInfo.adBaseInfo.appVersion)&&(t+="版本 "+this.adInfo.adBaseInfo.appVersion),it(this.adInfo.downloadSafeInfo.introductionInfoUrl)&&it(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&it(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.span=new TKSpan,!it(this.adInfo.downloadSafeInfo.introductionInfoUrl)){const e=t.length;t+="功能";const i=t.length;it(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)&&it(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.introductionClickSpanItem=new TKSpanItem,this.introductionClickSpanItem.spanType="click",this.introductionClickSpanItem.start=e,this.introductionClickSpanItem.end=i,this.introductionClickSpanItem.color=this.color,this.introductionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.introductionInfoUrl,"功能介绍")})),this.span.addSpan(this.introductionClickSpanItem)}if(!it(this.adInfo.downloadSafeInfo.appPermissionInfoUrl)){const e=t.length;t+="权限";const i=t.length;it(this.adInfo.downloadSafeInfo.appPrivacyUrl)?t+=" ":t+=" | ",this.permissionClickSpanItem=new TKSpanItem,this.permissionClickSpanItem.spanType="click",this.permissionClickSpanItem.start=e,this.permissionClickSpanItem.end=i,this.permissionClickSpanItem.color=this.color,this.permissionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPermissionInfoUrl,"权限信息")})),this.span.addSpan(this.permissionClickSpanItem)}if(!it(this.adInfo.downloadSafeInfo.appPrivacyUrl)){const e=t.length;t+="隐私";const i=t.length;t+=" ",this.privacyClickSpanItem=new TKSpanItem,this.privacyClickSpanItem.spanType="click",this.privacyClickSpanItem.start=e,this.privacyClickSpanItem.end=i,this.privacyClickSpanItem.color=this.color,this.privacyClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(this.adInfo.downloadSafeInfo.appPrivacyUrl,"隐私政策")})),this.span.addSpan(this.privacyClickSpanItem)}this.otherLabel.setSpan(t,this.span)}appendNameText(t){return rt.supportMinimumTKVersion("4.0.5")?q(this.adInfo.downloadSafeInfo.appName)&&(t+=this.adInfo.downloadSafeInfo.appName+" "):q(this.adInfo.adBaseInfo.appName)&&(t+=this.adInfo.adBaseInfo.appName+" "),t}appendDeveloperText(t){return rt.supportMinimumTKVersion("4.0.5")?q(this.adInfo.downloadSafeInfo.corporationName)&&(t+=this.adInfo.downloadSafeInfo.corporationName+" "):q(this.adInfo.adBaseInfo.corporationName)&&(t+=this.adInfo.adBaseInfo.corporationName+" "),t}appendRecordText(t){return rt.supportMinimumTKVersion("4.0.5")&&q(this.adInfo.downloadSafeInfo.recordNumber)&&(t+=this.adInfo.downloadSafeInfo.recordNumber+" "),t}}class te extends kt{constructor(t){super(),this.contentHeight=0,this.isNeedScale=!1,this.vm=t,this.isCurvedScreen=this.vm.callerContext.isCurvedScreen(),this.isLandScape=this.vm.callerContext.isLandScape(),this.setupViews(),this.bindEvent(),jt(this.vm,this.vm.$attrsPath.closeSecond,(t=>{this.closeTime&&this.closeTime.setText(t+"s")})),jt(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{switch(t){case"showEnd":case"pageVisiable":this.vm.startCountDown();break;case"pageInvisiable":case"hideEnd":this.vm.stopCountDown()}})),N(this.vm.adInfo)&&this.vm.startCountDown()}setupViews(){this.style={width:"100%",height:"100%"},this.vm.isShowTransparentEndPage()||this.appendBgView(),this.appendContnetView(),this.contentHeight+=10,this.isNeedScale=this.vm.isNeedScale(this.contentHeight),this.dialogView.style={height:this.contentHeight},this.setupDownloadPopup(),this.showAnimation()}setupDownloadPopup(){K(this.vm.adInfo)&&(this.downloadPopup=new Zt(this.vm.downloadPopupVM,this))}bindEvent(){this.vm.isSupportFullScreenClick()&&(this.giftView.addEventListener("tap",(t=>{this.vm.convert(2,Z(t,this.giftView),lt.PLAYEND_ICON_OTHERAREA_CLICK,{business_scene_type:6})})),this.iconImg.addEventListener("tap",(t=>{this.vm.convert(2,Z(t,this.iconImg),lt.PLAY_END_ICON_CLICK,{business_scene_type:6})})),this.appName.addEventListener("tap",(t=>{this.vm.convert(2,Z(t,this.appName),lt.PLAY_END_ICON_TITLE_CLICK,{business_scene_type:6})})),this.appDescView.addEventListener("tap",(t=>{this.vm.convert(2,Z(t,this.appDescView),lt.PLAY_END_ICON_DESCRIPTION_CLICK,{business_scene_type:6})})),this.addSwipeEvent(this.giftView,2),this.addSwipeEvent(this.iconImg,2),this.addSwipeEvent(this.appName,2),this.addSwipeEvent(this.appDescView,2),this.vm.isEnableFullScreenClickExpand()&&(this.clickAreaView.addEventListener("tap",(t=>{this.vm.convert(2,Z(t,this.clickAreaView),lt.PLAYEND_ICON_OTHERAREA_CLICK,{business_scene_type:6})})),this.addSwipeEvent(this.clickAreaView,2))),this.actionBarView.addEventListener("tap",(t=>{this.vm.convert(1,Z(t,this.actionBarView),lt.PLAY_END_ACTION_BAR_CLICK,{business_scene_type:6})})),this.addSwipeEvent(this.actionBarView,1),this.closeImg.addEventListener("tap",(t=>{if(N(this.vm.adInfo))this.vm.reportEndCardCloseAction(!0),ft(2);else if(rt.supportMinimumTKVersion("4.0.7"))It.closePassData({closeType:1});else{let t={business_scene_type:6},e={actionType:3,payload:JSON.stringify(t)};It.sendLog(e),It.close()}}))}appendBgView(){this.blurBg=new TKBlurImage,this.blurBg.style={left:0,top:0,width:"100%",height:"100%",resize:"cover",position:"absolute"},this.blurBg.setBlurRadius(20),this.blurBg.setSrc(S(this.vm.adInfo)),this.appendChild(this.blurBg)}appendContnetView(){this.contentView=new TKView,this.contentView.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",backgroundColor:"#00000099"},this.appendChild(this.contentView),this.dialogView=new TKView,this.dialogView.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},this.contentView.appendChild(this.dialogView),this.clickAreaView=new TKView,this.clickAreaView.style={width:327,justifyContent:"center",alignItems:"center"},this.dialogView.appendChild(this.clickAreaView),this.appendContentTitleIcon(),this.apendContentGiftView(),this.vm.isEnableShowRotateActionBar()?this.appendRotateActionBarView():this.vm.isShowShakeActionBar()?this.appendShakeActionBarView():this.appendActionBarView(),this.appendCloseView()}appendContentTitleIcon(){this.contentHeight+=32,this.titleImg=new TKImage,this.titleImg.style={width:220,height:32,resize:"cover"},this.titleImg.setSrc(this.vm.getResourceRoot()+"icon_ksad_endcard_title.png"),!this.isLandScape&&this.clickAreaView.appendChild(this.titleImg)}apendContentGiftView(){this.giftView=new TKView,this.giftView.style={width:this.isLandScape?this.isCurvedScreen?184:163:327,height:this.isLandScape?this.isCurvedScreen?247:206:412,marginTop:this.isLandScape?20:7,alignItems:"center"},this.contentHeight+=Number(this.giftView.style.height)+Number(this.giftView.style.marginTop),this.clickAreaView.appendChild(this.giftView),this.giftImage=new TKImage,this.giftImage.style={width:this.isLandScape?this.isCurvedScreen?130:163:327,height:this.isLandScape?this.isCurvedScreen?164:206:412,position:"absolute",left:0,top:0},this.giftImage.setSrc(this.vm.getResourceRoot()+"icon_ksad_endcard_giftbox.png"),this.giftView.appendChild(this.giftImage),this.appendAppIconView(),this.appendAppNameView(),this.appendAppDescView(),this.appendLogo(),this.appendPrivacyView()}appendAppIconView(){this.iconImg=new TKImage,this.iconImg.style={width:this.isLandScape?this.isCurvedScreen?40:50:100,height:this.isLandScape?this.isCurvedScreen?40:50:100,borderRadius:24,marginTop:this.isLandScape?this.isCurvedScreen?48:60:120},this.iconImg.setSrc(T(this.vm.adInfo)),this.giftView.appendChild(this.iconImg)}appendAppNameView(){this.appName=new TKText,this.appName.style={height:this.isLandScape?18:30,textAlign:"center",fontSize:this.isLandScape?14:20,fontWeight:"medium",color:"#222222",marginTop:8,maxWidth:this.isLandScape?120:230,textOverflow:"ellipsis",textLineClamp:1},this.appName.setText(w(this.vm.adInfo)),this.giftView.appendChild(this.appName)}appendAppDescView(){this.appDescView=new TKText,this.appDescView.style={color:"#FFFFFF",fontSize:this.isLandScape?10:16,marginTop:this.isLandScape?10:34,height:this.isLandScape?50:68,textLineHeight:this.isLandScape?this.isCurvedScreen?12:15:24,textOverflow:"ellipsis",textLineClamp:2,fontWeight:"medium",width:"100%",paddingLeft:this.isLandScape?24:36,paddingRight:this.isLandScape?24:36,textAlign:"center"},this.appDescView.setText(this.vm.adInfo.adBaseInfo.adDescription),this.giftView.appendChild(this.appDescView)}appendLogo(){this.logoView=new $t(3,this.vm.adInfo),this.logoView.style={position:"absolute",left:this.isLandScape?4:12,bottom:this.isLandScape?4:10,transform:{scale:.8}},this.giftView.appendChild(this.logoView)}appendPrivacyView(){if(!this.vm.isShowCompliance())return;const t=this.vm.containerLimit.width-30;this.privacyView=new Qt(this.vm.adInfo,this.vm.screenOrientation,t,""),this.privacyView.style={position:"absolute",bottom:this.isLandScape?null:12,top:this.isLandScape?0:null,left:0,opacity:.6},this.privacyView.clickCallback=(t,e)=>{It.openURL(t,e)},this.contentView.appendChild(this.privacyView)}appendRotateActionBarView(){this.actionBarView=new TKView,this.actionBarView.style={marginTop:this.isLandScape?6:16,width:this.isLandScape?120:200,height:this.isLandScape?36:60,alignItems:"center",flexDirection:"column"},this.contentHeight+=Number(this.actionBarView.style.height)+Number(this.actionBarView.style.marginTop),this.actionBarImg=new TKImage,this.actionBarImg.style={width:this.isLandScape?120:200,height:this.isLandScape?36:60,position:"absolute",left:0,top:0},this.actionBarImg.setSrc(this.vm.getResourceRoot()+"icon_ksad_endcard_high_btn.png"),this.actionBarView.appendChild(this.actionBarImg);let t=new TKView;t.style={width:"100%",height:this.isLandScape?28:56,top:0,justifyContent:"center",flexDirection:"row"},this.actionBarView.appendChild(t),this.rotateActionView=new qt(this.vm,{width:this.isLandScape?12:24,height:this.isLandScape?12:24}),this.rotateActionView.style={marginRight:this.isLandScape?2:4,marginTop:this.isLandScape?4:10},t.appendChild(this.rotateActionView),this.actionBarTitle=new TKText,this.actionBarTitle.style={marginTop:this.isLandScape?5:10,height:this.isLandScape?13:20,fontSize:this.isLandScape?10:16,color:"#FFFFFF",textOverflow:"ellipsis",textLineClamp:1,fontWeight:"medium"},this.actionBarTitle.setText(this.vm.getRotateTitle()),t.appendChild(this.actionBarTitle),this.actionBarSubTitle=new TKText,this.actionBarSubTitle.style={bottom:this.isLandScape?5:10,fontSize:this.isLandScape?7:10,maxWidth:this.isLandScape?110:200,marginTop:4,color:"#FFFFFF",textOverflow:"ellipsis",textLineClamp:1,position:"absolute"},v(this.vm.adInfo)?Gt(this.actionBarSubTitle,"text",this.vm.$attrsPath.rotateActionBarText):this.actionBarSubTitle.setText("或点击"+this.vm.getRotateContent()),this.actionBarView.appendChild(this.actionBarSubTitle),this.clickAreaView.appendChild(this.actionBarView)}appendShakeActionBarView(){this.contentHeight+=this.isLandScape?38:76,this.actionBarView=new TKView,this.actionBarView.style={marginTop:this.isLandScape?8:16,width:this.isLandScape?100:200,height:this.isLandScape?30:60,alignItems:"center",flexDirection:"column"},this.actionBarImg=new TKImage,this.actionBarImg.style={width:this.isLandScape?100:200,height:this.isLandScape?30:60,position:"absolute",left:0,top:0},this.actionBarImg.setSrc(this.vm.getResourceRoot()+"icon_ksad_endcard_high_btn.png"),this.actionBarView.appendChild(this.actionBarImg);let t=new TKView;t.style={width:"100%",height:this.isLandScape?28:56,top:0,justifyContent:"center",flexDirection:"row"},this.actionBarView.appendChild(t),this.shakeActionBar=new Xt(this.vm,this.isLandScape?12:24),this.shakeActionBar.style={marginRight:this.isLandScape?12:void 0,marginTop:this.isLandScape?4:8},t.appendChild(this.shakeActionBar),this.actionBarTitle=new TKText,this.actionBarTitle.style={marginTop:this.isLandScape?5:10,marginLeft:-20,height:20,fontSize:this.isLandScape?10:16,color:"#FFFFFF",textOverflow:"ellipsis",textLineClamp:1,fontWeight:"medium"},this.actionBarTitle.setText(this.vm.shakeTitle()),t.appendChild(this.actionBarTitle),this.actionBarSubTitle=new TKText,this.actionBarSubTitle.style={bottom:this.isLandScape?5:10,fontSize:this.isLandScape?7:10,marginTop:4,color:"#FFFFFF",textOverflow:"ellipsis",textLineClamp:1,position:"absolute"},this.actionBarSubTitle.setText(this.vm.shakeActionBarTitle()),this.actionBarView.appendChild(this.actionBarSubTitle),this.clickAreaView.appendChild(this.actionBarView),this.vm.reportShakeImpression()}appendActionBarView(){this.contentHeight+=this.isLandScape?38:64,this.actionBarView=new TKView,this.actionBarView.style={marginTop:this.isLandScape?8:16,width:this.isLandScape?120:200,height:this.isLandScape?28:48,justifyContent:"center",alignItems:"center",flexDirection:"column"},this.actionBarImg=new TKImage,this.actionBarImg.style={width:this.isLandScape?120:200,height:this.isLandScape?28:48,position:"absolute",left:0,top:0},this.actionBarImg.setSrc(this.vm.getResourceRoot()+"icon_ksad_endcard_btn.png"),this.actionBarView.appendChild(this.actionBarImg),this.actionBarTitle=new TKText,this.actionBarTitle.style={fontSize:this.isLandScape?10:16,color:"#FFFFFF",textOverflow:"ellipsis",textLineClamp:1,fontWeight:"medium"},Gt(this.actionBarTitle,"text",this.vm.$attrsPath.actionText),this.actionBarView.appendChild(this.actionBarTitle),v(this.vm.adInfo)||(this.actionBarSubTitle=new TKText,this.actionBarSubTitle.style={fontSize:this.isLandScape?7:10,color:"#FFFFFF",textOverflow:"ellipsis",textLineClamp:1,marginTop:2},this.actionBarSubTitle.setText("跳转详情页/第三方应用"),this.actionBarView.appendChild(this.actionBarSubTitle)),this.clickAreaView.appendChild(this.actionBarView)}appendCloseView(){this.contentHeight+=38,this.closeView=new TKView,this.closeView.style={height:24,marginTop:this.isLandScape?8:14,paddingLeft:this.vm.isShowCloseCountDown()?12:4,paddingRight:this.vm.isShowCloseCountDown()?12:4,borderRadius:12,borderColor:"#FFFFFF66",borderWidth:1,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.vm.isShowCloseCountDown()&&(this.closeTime=new TKText,this.closeTime.style={color:"#FFFFFFC8",fontSize:12},this.closeTime.setText(this.vm.closeSecond+"s"),this.closeView.appendChild(this.closeTime),this.closeTimeLine=new TKText,this.closeTimeLine.style={color:"#FFFFFFC8",fontSize:12,marginLeft:6,marginRight:4,marginBottom:2},this.closeTimeLine.setText("|"),this.closeView.appendChild(this.closeTimeLine)),this.closeImg=new TKImage,this.closeImg.style={width:16,height:16},this.closeImg.setSrc(this.vm.getResourceRoot()+"icon_ksad_endcard_close.png"),this.closeView.appendChild(this.closeImg),this.dialogView.appendChild(this.closeView)}showAnimation(){this.contentView&&this.contentView.addAnimation(this.getAlphaAnimation(this.contentView),"alphaAnimation"),this.dialogView&&(this.dialogView.addAnimation(this.getAlphaAnimation(this.dialogView),"alphaAnimation"),this.dialogView.addAnimation(this.getScaleAnimation(this.dialogView),"scaleAnimation")),this.appDeveloperText&&this.appDeveloperText.addAnimation(this.getAlphaAnimation(this.appDeveloperText),"alphaAnimation")}getAlphaAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={opacity:0},0),()=>(t.style={opacity:1},1)]),e.duration=300,e}getScaleAnimation(t){const e=new TKKeyframeAnimation;return e.setAnimations([()=>(t.style={transform:{scale:this.isNeedScale?.6:.8}},0),()=>(t.style={transform:{scale:this.isNeedScale?.8:1}},1)]),e.duration=300,e}addSwipeEvent(t,e){if(rt.supportMinimumTKVersion("5.0.0")){let i=0,a=0;t.addEventListener("down",(t=>{i=t.position.x,a=t.position.y})),t.addEventListener("up",(t=>{let n=t.position.x,s=t.position.y;this.vm.tryConvertSlideEvent(i,a,n,s,e)}))}}}class ee extends zt{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>ie(t,e)})}getData(t){}}function ie(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(i,a)=>"string"!=typeof a||"function"==typeof i[a]||0==a.indexOf("$")?Reflect.get(i,a):ie(t,e+"."+a)})}var ae;!function(t){t[t.SHOW_WHEN_PAUSE=1]="SHOW_WHEN_PAUSE",t[t.SHOW_WHEN_STATE_SWITCH=2]="SHOW_WHEN_STATE_SWITCH"}(ae||(ae={}));class ne extends ee{constructor(t,e,i,a){super(),this.downloadState=0,this.descText="",this.showPopupView=!1,this.showControlStrategy=null,this.adInfo=t,this.adStyle=e,this.configInfo=i,this.screenOrientation=a;let n=O(this.adInfo);this.needDownloadingState=!!n&&(3!=e&&2!=e&&1!=e)}onCloseClick(){this.showControlStrategy=ae.SHOW_WHEN_PAUSE,O(this.adInfo)?this.needDownloadingState?this.showControlStrategy=ae.SHOW_WHEN_STATE_SWITCH:this.showControlStrategy=ae.SHOW_WHEN_PAUSE:K(this.adInfo)&&(this.showControlStrategy=ae.SHOW_WHEN_PAUSE)}pageVisibleChange(t){t&&this.updateState(this.downloadState)}updateDownloadProgress(t){1==t.getDownloadState()&&0==t.getProgress()&&(this.showPopupView=!1),t.getTotalBytes()>0&&(this.downloadProgress=t.getProgress(),this.updateDesc(t.getDownloadState(),t.getProgress()),this.updateState(t.getDownloadState()))}updateDesc(t,e){if(this.needDownloadingState){let i=3==t;this.descText=i?"继续下载应用":`下载中${(100*e).toFixed(0)}%`}else this.descText="继续下载应用"}updateState(t){if(0==t)return void(this.downloadState=t);let e=this.downloadState;if(this.downloadState=t,this.showControlStrategy)this.handleShowControlStrategy(e,this.downloadState);else switch(this.downloadState){case 0:case 1:case 4:case 6:break;case 2:this.needDownloadingState?this.showPopupView=!0:this.showPopupView=!1,3==e&&It.showToast(this.getContinueToast());break;case 3:this.needDownloadingState||(this.showPopupView=!0),It.showToast(this.getPauseToast());break;case 5:this.showPopupView=!1}}handleShowControlStrategy(t,e){this.showControlStrategy==ae.SHOW_WHEN_PAUSE?3==e&&(this.showPopupView=!0,this.showControlStrategy=null):this.showControlStrategy==ae.SHOW_WHEN_STATE_SWITCH&&(3==e&&2==t||2==e&&3==t)&&(this.showPopupView=!0,this.showControlStrategy=null)}isDownloadPaused(){return 3==this.downloadState}isNeedShowDownloading(){return this.needDownloadingState}convert(t,e,i,a,n=null,s){Et.convertIfNeeded(t,this.adInfo,e,i,a,n,s)}getDesText(){return this.descText}getContinueToast(){return"继续下载中"}getDeleteToast(){return"取消安装,已删除安装包"}getPauseToast(){return"已暂停下载"}}class se{constructor(){this.downloadStats=0,this.downloadProgress=-1,this.totalBytes=0}static newInstance(t,e,i){let a=new se;return a.downloadStats=t,a.downloadProgress=e,a.totalBytes=i,a}obtainActionButtonText(t){let e,i=O(t);switch(this.downloadStats){case 0:case 1:case 4:e=t.adBaseInfo.adActionDescription;break;case 2:e=i?"暂停":`${(100*this.downloadProgress).toFixed(0)}%`;break;case 3:e="继续下载";break;case 5:e=q(t.adBaseInfo.installAppLabel)?t.adBaseInfo.installAppLabel:"点击安装";break;case 6:e=q(t.adBaseInfo.openAppLabel)?t.adBaseInfo.openAppLabel:"立即打开"}return e}getProgress(){return this.downloadProgress}getDownloadState(){return this.downloadStats}getTotalBytes(){return this.totalBytes}isDownloadFinish(){return 5==this.downloadStats||6==this.downloadStats}isDownloading(){return 2==this.downloadStats}}class oe{constructor(t,e,i){this.xDegree=t,this.yDegree=e,this.zDegree=i}}class re{constructor(t){this.radFlag=!1,this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antiXFlag=!1,this.antiYFlag=!1,this.antiZFlag=!1,this.bidirectionalSwitch=!1,this.NS2S=1e-9,this.rotateInfo=t,this.bidirectionalSwitch=function(t){try{return t.bidirectionalSwitch}catch(e){}return!1}(t)}beforeMonitor(){this.startTime=rt.isAndroid()?0:j()/1e3,this.maxSensorInfo=new oe(0,0,0),this.xDegree=0,this.yDegree=0,this.zDegree=0}resetValues(){this.xDegree=0,this.yDegree=0,this.zDegree=0}canConvertRotate(t){try{if(!it(t)&&!it(t.values)){if(!this.radFlag){this.xOriginOmiga=0,this.yOriginOmiga=0,this.zOriginOmiga=0;let i=-1;try{i=U().abConfig.rotateProgressIncreaseCompatible}catch(e){}i>=0&&(t.values[0]>i&&(this.xOriginOmiga=t.values[0]),t.values[1]>i&&(this.yOriginOmiga=t.values[1]),t.values[2]>i&&(this.zOriginOmiga=t.values[2])),this.radFlag=!0}let i=!1,a=!1,n=!1,s=0;rt.isAndroid()?(0!=this.startTime&&(s=(t.timestamp-this.startTime)*this.NS2S),this.startTime=t.timestamp):(s=t.timestamp/1e3-this.startTime,this.startTime=t.timestamp/1e3),this.xDegree+=s*(t.values[0]-this.xOriginOmiga)*180/Math.PI,this.yDegree+=s*(t.values[1]-this.yOriginOmiga)*180/Math.PI,this.zDegree+=s*(t.values[2]-this.zOriginOmiga)*180/Math.PI;let o=new oe(this.xDegree,this.yDegree,this.zDegree);if(Math.abs(o.xDegree)>Math.abs(this.maxSensorInfo.xDegree)&&(this.maxSensorInfo.xDegree=o.xDegree),Math.abs(o.yDegree)>Math.abs(this.maxSensorInfo.yDegree)&&(this.maxSensorInfo.yDegree=o.yDegree),Math.abs(o.zDegree)>Math.abs(this.maxSensorInfo.zDegree)&&(this.maxSensorInfo.zDegree=o.zDegree),this.bidirectionalSwitch)return this.bidirectionRotateConvert(o);i=this.canConvertCurrentDegree(o.xDegree,this.rotateInfo.x),a=this.canConvertCurrentDegree(o.yDegree,this.rotateInfo.y),n=this.canConvertCurrentDegree(o.zDegree,this.rotateInfo.z);let r=i||a||n;return r&&(this.radFlag=!1),r}}catch(i){}return!1}bidirectionRotateConvert(t){t.xDegree>0&&!this.xFlag?this.xFlag=this.canConvertCurrentDegree(t.xDegree,this.rotateInfo.x):t.xDegree<0&&!this.antiXFlag&&(this.antiXFlag=this.canConvertCurrentDegree(t.xDegree,this.rotateInfo.x)),t.yDegree>0&&!this.yFlag?this.yFlag=this.canConvertCurrentDegree(t.yDegree,this.rotateInfo.y):t.yDegree<0&&!this.antiYFlag&&(this.antiYFlag=this.canConvertCurrentDegree(t.yDegree,this.rotateInfo.y)),t.zDegree>0&&!this.zFlag?this.zFlag=this.canConvertCurrentDegree(t.zDegree,this.rotateInfo.z):t.zDegree<0&&!this.antiZFlag&&(this.antiZFlag=this.canConvertCurrentDegree(t.zDegree,this.rotateInfo.z));let e=this.xFlag&&this.antiXFlag,i=this.yFlag&&this.antiYFlag,a=this.zFlag&&this.antiZFlag,n=e||i||a;return n&&(console.log("bidirection function canRotate, x:"+e+"===y:"+i+"===z:"+a),this.resetFlag()),n}resetFlag(){this.xFlag=!1,this.antiXFlag=!1,this.yFlag=!1,this.antiYFlag=!1,this.zFlag=!1,this.antiZFlag=!1,this.radFlag=!1}canConvertCurrentDegree(t,e){if(e.rotateDegree<0)return!1;let i=!0,a=0==e.rotateDegree?45:e.rotateDegree;switch(e.direction){case 1:i=t<0&&Math.abs(t)>=a;break;case 2:i=t>0&&Math.abs(t)>=a;break;default:i=Math.abs(t)>=a}return i&&this.bidirectionalSwitch&&this.resetValues(),i}maxRotateContent(){return JSON.stringify({x:Math.round(this.maxSensorInfo.xDegree),y:Math.round(this.maxSensorInfo.yDegree),z:Math.round(this.maxSensorInfo.zDegree)})}}class le{constructor(t){this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antixFlag=!1,this.antiyFlag=!1,this.antizFlag=!1,this.canShakeCount=0,this.interactiveInfo=t}bidireationShakeConvert(t){let e=this.canBidireationShake(t);return X()?this.canShakeCount>2&&(console.log("bidirection function android success convert, current canShakeCount:"+this.canShakeCount),this.canShakeCount=0,!0):e}canBidireationShake(t){t[0]>0&&!this.xFlag?this.xFlag=this.computeAcceleration(t[0]):t[0]<0&&!this.antixFlag&&(this.antixFlag=this.computeAcceleration(t[0])),t[1]>0&&!this.yFlag?this.yFlag=this.computeAcceleration(t[1]):t[1]<0&&!this.antiyFlag&&(this.antiyFlag=this.computeAcceleration(t[1])),t[2]>0&&!this.zFlag?this.zFlag=this.computeAcceleration(t[2]):t[2]<0&&!this.antizFlag&&(this.antizFlag=this.computeAcceleration(t[2]));let e=this.xFlag&&this.antixFlag,i=this.yFlag&&this.antiyFlag,a=this.zFlag&&this.antizFlag,n=e||i||a;return n&&(console.log("bidirection function canShake, x:"+e+"===y:"+i+"===z:"+a),this.canShakeCount++,this.resetFlag()),n}computeAcceleration(t){let e=Math.abs(t-9.81);return Math.abs(t)>=R(this.interactiveInfo)&&e>=.05}resetFlag(){this.xFlag=!1,this.yFlag=!1,this.zFlag=!1,this.antixFlag=!1,this.antiyFlag=!1,this.antizFlag=!1}}class he{constructor(t){this.gravity=9.81,this.minError=.05,this.accelerationThreshold=R(t),this.bidireationalSwitch=V(t.shakeInfo),this.bidirectionalRotateShakeUtil=new le(t),this.lastValue=new Array,this.lastValue[0]=0,this.lastValue[1]=0,this.lastValue[2]=0}beforeMonitor(){this.maxAcceleration=0}resetValues(){this.lastValue=new Array,this.lastValue[0]=0,this.lastValue[1]=0,this.lastValue[2]=0}canConvertShake(t){try{if(!it(t)&&!it(t.values)){if(t=this.noiseReduction(t),this.isInvalidValue(t.values))return!1;this.lastValue=t.values;let e=t.values[0],i=t.values[1],a=t.values[2];return this.bidireationalSwitch?(this.maxAcceleration=Math.max(Math.max(Math.abs(e),Math.abs(i)),Math.abs(a)),this.bidirectionalRotateShakeUtil.bidireationShakeConvert(t.values)):(this.maxAcceleration=Math.sqrt(e*e+i*i+a*a),this.maxAcceleration>=this.accelerationThreshold)}}catch(e){}return!1}isInvalidValue(t){let e=Math.abs(Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]));return!!(Math.abs(e-this.gravity)<=this.minError&&rt.isAndroid())}noiseReduction(t){let e=.6;return 0==this.lastValue[0]&&0==this.lastValue[1]&&0==this.lastValue[2]&&(e=1),this.lastValue[0]=e*t.values[0]+(1-e)*this.lastValue[0],this.lastValue[1]=e*t.values[1]+(1-e)*this.lastValue[1],this.lastValue[2]=e*t.values[2]+(1-e)*this.lastValue[2],t.values[0]=this.lastValue[0],t.values[1]=this.lastValue[1],t.values[2]=this.lastValue[2],t}}class ce{constructor(t,e,i){this.xDegree=t,this.yDegree=e,this.zDegree=i}}class de{constructor(t){this.rotationMatrix=new Array(9),this.simulatedGyroscopeValues=[],this.originRotateDegree=[],this.mRotateDegree=[],this.isInitValidValue=!1,this.rotateInfo=t,this.resetMaxRotateInfo()}resetMaxRotateInfo(){this.maxSensorInfo=new ce(0,0,0)}handleImitateSensorData(t,e,i,a=(t=>{})){if(0!=e.length&&0!=t.length){if(this.getRotationMatrix(this.rotationMatrix,null,t,e),this.getOrientation(this.rotationMatrix,this.simulatedGyroscopeValues),this.mRotateDegree[0]=180*this.simulatedGyroscopeValues[0]/Math.PI,this.mRotateDegree[1]=180*this.simulatedGyroscopeValues[1]/Math.PI,this.mRotateDegree[2]=180*this.simulatedGyroscopeValues[2]/Math.PI,!this.isInitValidValue&&(0!=this.mRotateDegree[0]||0!=this.mRotateDegree[1]||0!=this.mRotateDegree[2])){this.isInitValidValue=!0;let t=new Array(3);t[0]=this.mRotateDegree[0],t[1]=this.mRotateDegree[1],t[2]=this.mRotateDegree[2],this.originRotateDegree=t}this.mRotateDegree[0]=this.mRotateDegree[0]-this.originRotateDegree[0],this.mRotateDegree[1]=this.mRotateDegree[1]-this.originRotateDegree[1],this.mRotateDegree[2]=this.mRotateDegree[2]-this.originRotateDegree[2],!it(this.mRotateDegree)&&a&&a(this.mRotateDegree),this.canConvertRotate(this.mRotateDegree)&&(i&&i(this.maxRotateContent()),this.resetMaxRotateInfo())}}canConvertRotate(t){try{if(!it(t)){let e=!1,i=!1,a=!1;return Math.abs(t[0])>Math.abs(this.maxSensorInfo.xDegree)&&(this.maxSensorInfo.xDegree=t[0]),Math.abs(t[1])>Math.abs(this.maxSensorInfo.yDegree)&&(this.maxSensorInfo.yDegree=t[1]),Math.abs(t[2])>Math.abs(this.maxSensorInfo.zDegree)&&(this.maxSensorInfo.zDegree=t[2]),e=this.canConvertCurrentDegree(t[0],this.rotateInfo.x),i=this.canConvertCurrentDegree(t[1],this.rotateInfo.y),a=this.canConvertCurrentDegree(t[2],this.rotateInfo.z),e||i||a}}catch(e){}return!1}canConvertCurrentDegree(t,e){if(e.rotateDegree<0)return!1;let i=!0,a=0==e.rotateDegree?45:e.rotateDegree;switch(e.direction){case 1:i=t<0&&Math.abs(t)>=a;break;case 2:i=t>0&&Math.abs(t)>=a;break;default:i=Math.abs(t)>=a}return i}maxRotateContent(){return JSON.stringify({x:Math.round(this.maxSensorInfo.xDegree),y:Math.round(this.maxSensorInfo.yDegree),z:Math.round(this.maxSensorInfo.zDegree),useImitateRotate:!0})}getRotationMatrix(t,e,i,a){try{let n=i[0],s=i[1],o=i[2],r=9.81;if(n*n+s*s+o*o<.01*r*r)return!1;let l=a[0],h=a[1],c=a[2],d=h*o-c*s,u=c*n-l*o,p=l*s-h*n,C=Math.sqrt(d*d+u*u+p*p);if(C<.1)return!1;let g=1/C;d*=g,u*=g,p*=g;let I=1/Math.sqrt(n*n+s*s+o*o);n*=I,s*=I,o*=I;let f=s*p-o*u,m=o*d-n*p,T=n*u-s*d;if(null!=t&&(9==t.length?(t[0]=d,t[1]=u,t[2]=p,t[3]=f,t[4]=m,t[5]=T,t[6]=n,t[7]=s,t[8]=o):16==t.length&&(t[0]=d,t[1]=u,t[2]=p,t[3]=0,t[4]=f,t[5]=m,t[6]=T,t[7]=0,t[8]=n,t[9]=s,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1)),null!=e){let t=1/Math.sqrt(l*l+h*h+c*c),i=(l*f+h*m+c*T)*t,a=(l*n+h*s+c*o)*t;9==e.length?(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=i,e[5]=a,e[6]=0,e[7]=-a,e[8]=i):16==e.length&&(e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=i,e[6]=a,e[8]=0,e[9]=-a,e[10]=i,e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1)}}catch(n){return!1}return!0}getOrientation(t,e){try{9==t.length?(e[0]=Math.atan2(t[1],t[4]),e[1]=Math.asin(-t[7]),e[2]=Math.atan2(-t[6],t[8])):(e[0]=Math.atan2(t[1],t[5]),e[1]=Math.asin(-t[9]),e[2]=Math.atan2(-t[8],t[10]))}catch(i){}return e}}class ue{constructor(t){this.rotateInfo=t}registerImitateRotateSensorListener(t,e=(t=>{})){if(!rt.supportMinimumTKVersion("5.0.5")||!rt.isAndroid())return;if(!KSAdSensorManager.supportSensor(3)||!KSAdSensorManager.supportSensor(5))return;this.imtateRotateHandler=new de(this.rotateInfo);let i=[],a=[];try{KSAdSensorManager.registerSensorListener(3,-3,(n=>{i=n.values,this.imtateRotateHandler.handleImitateSensorData(i,a,t,e)})),KSAdSensorManager.registerSensorListener(5,-3,(n=>{a=n.values,this.imtateRotateHandler.handleImitateSensorData(i,a,t,e)}))}catch(n){}}unRegisterImitateRotateSensorListener(){rt.supportMinimumTKVersion("5.0.5")&&rt.isAndroid()&&(KSAdSensorManager.unregisterSensorListener(3),KSAdSensorManager.unregisterSensorListener(5))}}class pe{constructor(t){this.isListeningSeneor=!1,this.interactionInfo=t}startSensorListener(t,e){var i,a,n,s;this.isListeningSeneor||(this.isListeningSeneor=!0,(null===(a=null===(i=this.interactionInfo)||void 0===i?void 0:i.rotateInfo)||void 0===a?void 0:a.enable)&&this.startRotateListener(t,e),(null===(s=null===(n=this.interactionInfo)||void 0===n?void 0:n.shakeInfo)||void 0===s?void 0:s.enable)&&this.startShakeListener(t,e))}startRotateListener(t,e){var i,a;if("undefined"!=typeof KSAdSensorManager)if(this.initializeRotateHandler(this.interactionInfo.rotateInfo),this.rotateHandler.beforeMonitor(),KSAdSensorManager.supportSensor(2))try{KSAdSensorManager.registerSensorListener(2,-3,(i=>{try{if(e&&e(this.rotateHandler,this.shakeHandler,!1),this.rotateHandler&&this.rotateHandler.canConvertRotate(i)){t&&this.isListeningSeneor&&t(!1,0,this.rotateHandler.maxRotateContent()),this.stopSensorListener();try{KSAdSystemUtil.startVibrate(200)}catch(a){wt(J(a))}}}catch(a){wt("outerError:"+J(a))}}))}catch(n){}else{if(this.rotateHandler.bidirectionalSwitch)return;(null===(a=null===(i=this.interactionInfo)||void 0===i?void 0:i.rotateInfo)||void 0===a?void 0:a.useImitateRotate)&&(this.sensorImitateRotateUtil=new ue(this.interactionInfo.rotateInfo),this.sensorImitateRotateUtil.registerImitateRotateSensorListener((e=>{try{if(!it(e)){t&&this.isListeningSeneor&&t(!1,0,e),this.stopSensorListener();try{KSAdSystemUtil.startVibrate(200)}catch(n){wt(J(n))}}}catch(n){wt("outerError:"+J(n))}}),(t=>{e&&t&&t.length>2&&(this.rotateHandler.xDegree=t[0],this.rotateHandler.yDegree=t[1],this.rotateHandler.zDegree=t[2],e(this.rotateHandler,null,!1))})))}}startShakeListener(t,e){if("undefined"!=typeof KSAdSensorManager){this.initializeShakeHandler(),this.shakeHandler.beforeMonitor();try{KSAdSensorManager.registerSensorListener(1,-3,(i=>{e&&e(this.rotateHandler,this.shakeHandler,!0),this.shakeHandler&&this.shakeHandler.canConvertShake(i)&&(KSAdSystemUtil.startVibrate(200),t&&this.isListeningSeneor&&t(!0,this.shakeHandler.maxAcceleration,""),this.stopSensorListener())}))}catch(i){}}}stopSensorListener(){this.isListeningSeneor=!1,this.stopRotateListener(),this.stopShakeListener()}stopRotateListener(){var t,e;"undefined"!=typeof KSAdSensorManager&&(null===(e=null===(t=this.interactionInfo)||void 0===t?void 0:t.rotateInfo)||void 0===e?void 0:e.enable)&&(this.sensorImitateRotateUtil?this.sensorImitateRotateUtil.unRegisterImitateRotateSensorListener():KSAdSensorManager.unregisterSensorListener(2))}stopShakeListener(){var t,e;"undefined"!=typeof KSAdSensorManager&&(null===(e=null===(t=this.interactionInfo)||void 0===t?void 0:t.shakeInfo)||void 0===e?void 0:e.enable)&&KSAdSensorManager.unregisterSensorListener(1)}initializeShakeHandler(){this.shakeHandler=new he(this.interactionInfo)}initializeRotateHandler(t){this.rotateHandler=new re(t)}getRotateHandler(){return this.rotateHandler}getShakeHandler(){return this.shakeHandler}static reportRotateSensorStatus(t){if(rt.supportMinimumTKVersion("5.0.5")&&rt.isAndroid())try{!function(t){At({status:5001,ad_style:t})}(t),KSAdSensorManager.supportSensor(1)||function(t){At({status:5011,ad_style:t})}(t);let e=!1;KSAdSensorManager.supportSensor(2)||(e=!0,function(t){At({status:5002,ad_style:t})}(t));let i=!1;KSAdSensorManager.supportSensor(3)||(i=!0,function(t){At({status:5003,ad_style:t})}(t));let a=!1;KSAdSensorManager.supportSensor(5)||(a=!0,function(t){At({status:5004,ad_style:t})}(t));let n=!1;KSAdSensorManager.supportSensor(4)||(n=!0,function(t){At({status:5008,ad_style:t})}(t)),i&&n&&function(t){At({status:5009,ad_style:t})}(t),i&&a&&function(t){At({status:5005,ad_style:t})}(t),e&&(i||a)&&function(t){At({status:5007,ad_style:t})}(t),e&&(i||n)&&function(t){At({status:5010,ad_style:t})}(t)}catch(e){!function(t,e){At({status:5006,error_msg:t,ad_style:e})}(J(e),t)}}}class Ce{constructor(t,e,i,a,n,s){this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=a,this.screenOrientation=n,this.originContainerLimit=s}getOriginWidth(){return this.originContainerLimit?this.originContainerLimit.width:0}isCurvedScreen(){return this.containerLimit.width/this.containerLimit.height<1.8}getOriginHeight(){return this.originContainerLimit?this.originContainerLimit.height:0}}class ge extends Ce{isLandScape(){return 6==this.adInfo.adMaterialInfo.derivativeMaterialType||2==this.adInfo.adMaterialInfo.derivativeMaterialType}}class Ie extends ee{constructor(){super(...arguments),this.hasReportShow=!1,this.hasReportShowShake=!1,this.inShowingOtherVC=!1,this.lifeStatus="none",this.actionText="",this.rotateActionBarText="",this.hasReachSensorTimeInterval=!0,this.downloadState=0}getData(t){let e=[];e.push(It.getKsAdDataAsync()),e.push(It.getDeviceInfoAsync()),e.push(It.getKsAdConfigAsync()),e.push(It.getContainerLimitAsync()),e.push(It.getScreenOrientationAsync()),Promise.all(e).then((e=>{const i=e[0].data,a=e[1].data,n=e[2].data,s=e[3].data,o=e[4].data;try{this.adInfo=i.impAdInfo[0].adInfo[0],this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=o.screenOrientation,this.interactionInfo=function(t,e){let i=y(t,e);if(null==i)return;let a=JSON.parse(i.data);return null!=a?a.interactionInfo:void 0}(this.adInfo,13),this.bidirectionalRotateShakeUtil=new le(this.interactionInfo),this.downloadPopupVM=new ne(this.adInfo,this.adStyle,this.configInfo,this.screenOrientation),this.additionalInit()}catch(r){}this.deviceInfo=a,W(this.deviceInfo),this.configInfo=n,this.containerLimit=s,this.screenOrientation=o.screenOrientation,this.initCallerContext(),t&&t(!0)}))}initCallerContext(){this.callerContext=new ge(this.adInfo,this.adStyle,this.configInfo,this.containerLimit,this.screenOrientation)}checkDataValid(){return!!this.adInfo}getResourceRoot(){return"image/ksad-splash-end-card/"}additionalInit(){this.splashInfo=this.adInfo.adMatrixInfo.adDataV2.splashInfo,this.splashEndCardTKInfo=this.adInfo.adMatrixInfo.adDataV2.splashEndCardTKInfo,this.closeSecond=this.getCountDownSecond(),this.initTime=j(),this.registerProgressListener(),this.registerLifeStatusListener()}registerLifeStatusListener(){It.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.lifeStatus&&this.updateLifeStatus(e)}}))}updateLifeStatus(t){"showEnd"!=t||this.hasReportShow||(this.hasReportShow=!0,this.exposeElement()),"pageVisiable"==t?this.inShowingOtherVC=!1:"pageInvisiable"==t&&(this.inShowingOtherVC=!0),this.lifeStatus=t}exposeElement(){let t=new h;t.universe_feature_freq=9;let e={elementType:87,clientExtData:JSON.stringify(t),business_scene_type:6};Et.log(140,null,e)}registerProgressListener(){this.actionText=v(this.adInfo)?function(t){if(it(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return it(e)&&(e=v(t)?"立即下载":"查看详情"),e}(this.adInfo):"点击查看",rt.isSupportDownloadProgressListen()&&v(this.adInfo)&&It.registerProgressListener((t=>{if(t.result){const{status:e,progress:i,totalBytes:a}=t.data,n=Number((100*i).toFixed(0))>100?"100":(100*i).toFixed(0);let s;switch(this.downloadState=e,this.downloadPopupVM.updateDownloadProgress(se.newInstance(e,i,a)),e){case 0:case 1:case 4:s=this.adInfo.adBaseInfo.adActionDescription,this.rotateActionBarText="或点击"+s;break;case 2:s=`${n}%`,this.rotateActionBarText=s;break;case 3:s="继续下载",this.rotateActionBarText="或点击"+s;break;case 5:s=q(this.adInfo.adBaseInfo.installAppLabel)?this.adInfo.adBaseInfo.installAppLabel:"点击安装",this.rotateActionBarText="或点击"+s;break;case 6:s=q(this.adInfo.adBaseInfo.openAppLabel)?this.adInfo.adBaseInfo.openAppLabel:"立即打开",this.rotateActionBarText="或点击"+s}this.actionText=s}}))}convert(t,e,i,a){Et.convertIfNeeded(2,this.adInfo,t,e,i,null,a)}isShowCloseCountDown(){return!it(this.adInfo.adMatrixInfo.adDataV2.splashEndCardTKInfo.endCardShowCountDown)&&this.adInfo.adMatrixInfo.adDataV2.splashEndCardTKInfo.endCardShowCountDown}getCountDownSecond(){return this.adInfo.adMatrixInfo.adDataV2.splashEndCardTKInfo.endCardShowSecond||5}isSupportFullScreenClick(){return!!it(this.adInfo.adMatrixInfo.adDataV2.splashEndCardTKInfo.endCardFullScreenClick)||this.adInfo.adMatrixInfo.adDataV2.splashEndCardTKInfo.endCardFullScreenClick}isShowCompliance(){try{return this.adInfo.downloadSafeInfo.complianceInfo.titleBarTextSwitch>0&&v(this.adInfo)&&rt.isAndroid()}catch(t){}return!1}isShowShakeActionBar(){try{return rt.supportMinimumTKVersion("4.0.9")&&!it(this.interactionInfo.shakeInfo)&&2==_(this.adInfo)&&KSAdSensorManager.supportSensor(1)}catch(t){}return!1}shakeTitle(){try{return q(this.interactionInfo.shakeInfo.subtitle)?this.interactionInfo.shakeInfo.subtitle:"摇一摇"}catch(t){}return"摇一摇"}shakeActionBarTitle(){let t="";try{if(v(this.adInfo)){const e=this.interactionInfo.actionBarInfo.downloadTexts;switch(this.downloadState){case 6:t=e.openAppLabel;break;case 5:t=e.installAppLabel;break;default:t=e.adActionDescription}}else t=this.interactionInfo.actionBarInfo.title||"跳转详情页或第三方应用"}catch(e){}return q(t)?"或点击"+t:""}canConvertShake(t){try{if(!it(t)&&!it(t.values)){let e=!1,i=0;V(this.interactionInfo.shakeInfo)?(e=this.bidirectionalRotateShakeUtil.bidireationShakeConvert(t.values),i=Math.max(Math.max(Math.abs(t.values[0]),Math.abs(t.values[1])),Math.abs(t.values[2]))):(i=Math.sqrt(t.values[0]*t.values[0]+t.values[1]*t.values[1]+t.values[2]*t.values[2]),e=i>=R(this.interactionInfo)),!this.inShowingOtherVC&&this.hasReachSensorTimeInterval&&e&&(this.hasReachSensorTimeInterval=!1,this.reOpenSensor(),this.convert(2,{x:0,y:0},lt.SHAKE_ICON_SHACK,{splash_shake_acceleration:i,business_scene_type:6}))}}catch(e){}}reOpenSensor(){setTimeout((()=>{this.hasReachSensorTimeInterval=!0}),1500)}reportShakeImpression(){this.hasReportShowShake||(this.hasReportShowShake=!0,Et.exposeElement(205))}startCountDown(){this.stopCountDown(),this.countDownTimer=setInterval((()=>{if(this.closeSecond<=1)return N(this.adInfo)?(this.reportEndCardCloseAction(!1),ft(3)):rt.supportMinimumTKVersion("4.0.7")?It.closePassData({closeType:2}):It.close(),void clearInterval(this.countDownTimer);--this.closeSecond}),1e3)}stopCountDown(){this.countDownTimer&&clearInterval(this.countDownTimer)}isNeedScale(t){return this.containerLimit.height<t&&rt.supportMinimumTKVersion("4.0.10")}isShowTransparentEndPage(){try{return this.adInfo.adMatrixInfo.adDataV2.splashEndCardTKInfo.showTransparentEndCard}catch(t){}return!1}reportEndCardCloseAction(t){let e=new h;e.duration=j()-this.initTime;let i={business_scene_type:6,itemCloseType:t?1:2,clientExtData:JSON.stringify(e)};Et.log(3,null,i)}isEnableShowRotateActionBar(){return rt.supportMinimumTKVersion("5.0.0")&&this.splashEndCardTKInfo.isEnableRotate}isEnableSlide(){return this.splashEndCardTKInfo.isEnableSlide}getRotateTitle(){var t;return(null===(t=this.splashInfo.interactionInfo)||void 0===t?void 0:t.rotateInfo.title)||"扭一扭"}isSensorCanConvert(){return!this.inShowingOtherVC}startSensorListener(){this.sensorUtil||(this.sensorUtil=new pe(this.splashInfo.interactionInfo)),this.sensorUtil.startSensorListener(((t,e,i)=>{this.isSensorCanConvert()&&(t?this.convert(2,{x:0,y:0},lt.SHAKE_ICON_SHACK,{business_scene_type:6,splash_shake_acceleration:e}):this.convert(2,{x:0,y:0},lt.ROTATE_ICON_ROTATE,{business_scene_type:6,splash_interaction_rotate_angle:i}))}),((t,e,i)=>{!i&&this.rotateInfoCallback&&t&&this.rotateInfoCallback(t.xDegree,t.yDegree,t.zDegree)}))}stopSensorListener(){var t;null===(t=this.sensorUtil)||void 0===t||t.stopSensorListener()}getRotateContent(){var t;return(null===(t=this.splashInfo.interactionInfo)||void 0===t?void 0:t.actionBarInfo.title)||"跳转详情页或第三方应用"}tryConvertSlideEvent(t,e,i,a,n){if(!this.isEnableSlide())return;const s=i-t,o=a-e;this.canHitSwipeEvent(s,o,10)&&(Math.abs(s)>=Math.abs(o)?this.convert(n,{x:0,y:0},lt.CARD_SWIPE_CONVERT,{finger_swipe_type:s>0?3:2,finger_swipe_distance:s,business_scene_type:6}):this.convert(n,{x:0,y:0},lt.CARD_SWIPE_CONVERT,{finger_swipe_type:o>0?4:1,finger_swipe_distance:o,business_scene_type:6}))}canHitSwipeEvent(t,e,i){return!(Math.abs(t)<i&&Math.abs(e)<i)}isEnableFullScreenClickExpand(){return this.splashEndCardTKInfo.endCardFullScreenClickExpand}}(new class extends bt{constructor(){super(),this.vm=new Ie}setupViews(){this.contentView=new te(this.vm),this.rootView.appendChild(this.contentView)}render(){if(this.renderCalled)return!1;this.renderCalled=!0;try{this.vm.getData((t=>{if(t)try{this.setupViews(),Tachikoma.render(this.rootView),this.updateRenderStatus(1,"")}catch(e){this.updateRenderStatus(0,J(e))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,J(t))}return!0}updateRenderStatus(t,e){super.updateRenderStatus(t,e)}}).render()})();
//# sourceMappingURL=ksad-splash-end-card.261.js.map