(()=>{"use strict";class t{static saveLocal(t,e){if("undefined"!=typeof TKLocalStorage&&S.supportMinimumTKVersion("4.0.0"))try{(new TKLocalStorage).set(t,e)}catch(i){}}static getLocalString(t){if("undefined"!=typeof TKLocalStorage&&S.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return e.toString()}catch(e){}return null}static getLocalInt(t){if("undefined"!=typeof TKLocalStorage&&S.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Number.parseInt(e.toString())}catch(e){}return 0}static getLocalBoolean(t){if("undefined"!=typeof TKLocalStorage&&S.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Boolean(e.toString)}catch(e){}return!1}}let e=null;const i="TKResIndexKey";class n{constructor(){var e,n,a;this.defaultHost="p1-lm.adukwai.com",this.currentIndex=0;let s=null===(a=null===(n=null===(e=m())||void 0===e?void 0:e.appConfig)||void 0===n?void 0:n.idc)||void 0===a?void 0:a.tkres;s&&0!=s.length||(s=["p1-lm.adukwai.com","p2-lm.adukwai.com"]),this.resList=s;let o=t.getLocalInt(i);o>s.length&&(o=0),this.currentIndex=o}static getInstance(){return e||(e=new n),e}getCurrentHost(){return this.currentIndex>=this.resList.length?this.defaultHost:this.resList[this.currentIndex]}markUrlFail(e){if(!(e.indexOf(this.getCurrentHost())<0||"undefined"!=typeof KSAdTKNetworkManager&&0==KSAdTKNetworkManager.getCurrentNetworkType())){const e=this.currentIndex;this.currentIndex=++this.currentIndex%this.resList.length,this.currentIndex!==e&&t.saveLocal(i,this.currentIndex)}}}var a=null,s=null,o=null,r=null,l=null;function h(t){console.log("tkloadcontroller  save global device info:"+JSON.stringify(t)),a=t}function c(){return l}function d(){return a}function m(){return s}function u(){return r}function p(){const t=Tachikoma.env.styleTemplate;return t?JSON.parse(t):null}function g(t){return t instanceof Error?t.stack?t.stack:t.message:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function f(){return!T(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function w(){return"Android"===Tachikoma.env.platform}function C(t){return"string"==typeof t&&t.length>0}function A(){return a?a.tkVersion:Tachikoma.env.tkVersion||Tachikoma.env.TKVersion}function I(){return a?a.SDKVersion:Tachikoma.env.SDKVersion}function b(){return a?a.sdkType:Tachikoma.env.sdkType}function T(t){return null===t||null==t||""===t}new class{};class _{constructor(t,e,i){this.name=t,this.object=e,this.parent=i,this.children=new Map}addChildren(t,e){this.children.set(t,e)}}function y(t,e,i){if(t){e||(e=new _("root",t)),i||(i=new Set),i.add(t);for(const n in t){const a=typeof t[n],s=t[n];if("object"==a&&!n.includes("$")&&s){s.nativeID||(s.nativeID=n);const t=new _(n,s,e);if(e.addChildren(n,t),i.has(s)){const e=[];e.push(t);let i=t,n=!1;for(;i.parent;)if(i=i.parent,e.push(i),i.object===t.object){n=!0;break}if(n){let t="执行出错：发生循环引用\n";for(let n=e.length-1;n>=0;--n)i=e[n],t+=i.name+":"+i.object+"\n";throw new Error(t)}}y(s,t,i)}}}}function v(t){let e=t;return e.indexOf("/")>=0||t.startsWith("http")||(e="https://"+n.getInstance().getCurrentHost()+"/kos/nlav111362/ksad/"+t),e}function L(t,e){!function(t,e,i){if(t&&e){const a=v(e);t.setImageLoadCallback&&!T(a)&&a.startsWith("http")&&t.setImageLoadCallback((t=>{n.getInstance().markUrlFail(a),i&&i(t)})),t.setSrc(a)}}(t,e,null)}function R(t,e,i,a){let s=0;if(setTimeout((()=>{0==s&&(s=-1,a(!1))}),i),t&&e){const i=v(e);t.setImageLoadCallback&&!T(i)&&i.startsWith("http")&&t.setImageLoadCallback((t=>{n.getInstance().markUrlFail(i),a&&0==s&&(s=1,a(t))})),t.setSrc(i)}}class S{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||S.supportMinimumTKVersion("5.0.4")}static isSupportDownloadDel(){return this.isAndroid()&&S.supportMinimumTKVersion("5.0.7")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let i=t.split("."),n=e.split("."),a=Math.max(i.length,n.length);for(var s=0;s<a;s++){let t=Number(void 0!==i[s]?i[s]:"0"),e=Number(void 0!==n[s]?n[s]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let i=b(),n=1==i&&-1!=S.compareVersion(I(),t),a=2==i&&-1!=S.compareVersion(I(),e);return n||a}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let i=b(),n=1==i&&0==S.compareVersion(I(),t),a=2==i&&0==S.compareVersion(I(),e);return n||a}static supportCurrentTKVersion(t="0.0.0"){return A()==t}static supportMinimumTKVersion(t="0.0.0"){return-1!=S.compareVersion(A(),t)}}S.platform=Tachikoma.env.platform;v("h5_default_icon.png"),v("download_default_icon.png");var k,E,N,P;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PORTRAIT_CLICK=13]="PORTRAIT_CLICK",t[t.COMMENT_CLICK=14]="COMMENT_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.COMMENT_DETAIL_CLICK=25]="COMMENT_DETAIL_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.COMMON_CARD_CLICK=89]="COMMON_CARD_CLICK",t[t.COMMENT_PICTURE_CLICK=100]="COMMENT_PICTURE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA",t[t.POPLAY_FALL_IOCN=186]="POPLAY_FALL_IOCN",t[t.ROTATE_SHAKE_BIG_ICON_CLICK=187]="ROTATE_SHAKE_BIG_ICON_CLICK",t[t.RETAIN_AGG_CARD_CLICK=189]="RETAIN_AGG_CARD_CLICK",t[t.PLAYEND_AGG_CARD_CLICK=190]="PLAYEND_AGG_CARD_CLICK",t[t.SURPRISE_BOX_CLICK=191]="SURPRISE_BOX_CLICK",t[t.BUBBLE_RAIN_CLICK=192]="BUBBLE_RAIN_CLICK"}(k||(k={})),function(t){t[t.adClickReward=1]="adClickReward"}(E||(E={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(N||(N={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(P||(P={}));const V="ad_convert_event";var D,x,B,K;!function(t){t[t.THREEIMG_DEFAULT_CLICK=0]="THREEIMG_DEFAULT_CLICK",t[t.THREEIMG_FIRST_CLICK=1]="THREEIMG_FIRST_CLICK",t[t.THREEIMG_SECOND_CLICK=2]="THREEIMG_SECOND_CLICK",t[t.THREEIMG_THIRD_CLICK=3]="THREEIMG_THIRD_CLICK"}(D||(D={})),function(t){t[t.picStyle=1]="picStyle",t[t.textStyle=2]="textStyle"}(x||(x={})),function(t){t.START="start",t.CENTRT="center",t.END="end"}(B||(B={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(K||(K={}));var O,M;!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(O||(O={}));class H{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(M||(M={}));class W{}var G,F,Y;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(G||(G={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(F||(F={})),function(t){t[t.unkonwn=0]="unkonwn",t[t.videoPromoteFollow=1]="videoPromoteFollow",t[t.videoPromoteGoods=2]="videoPromoteGoods",t[t.liveGoods=3]="liveGoods",t[t.liveNotGoods=4]="liveNotGoods",t[t.videoAd=5]="videoAd"}(Y||(Y={}));const U=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class X{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i="",n=0;n<t;n++)i+=e.charAt(Math.floor(48*Math.random()));return i}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,i){if(!t)return null;const n=this.randomName(i);return Tachikoma[n]=e=>{t(e)},"Tachikoma."+n}}X.globalIndex=0;class z{static getDeviceInfoAsync(){return z.callNative("getDeviceInfo",null).then((t=>(t.result&&t.data&&h(t.data),t)))}static getKsAdDataAsync(){return z.callNative("getKsAdData",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,r=e),t}))}static getKsAdConfigAsync(){return z.callNative("getKsAdConfig",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,s=e),t}))}static getScreenOrientationAsync(){return z.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return z.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return z.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return z.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.lifeStatusCallback=t,this.callNativeWithCallback("registerLifecycleListener",null,(t=>{this.lifeStatusCallback&&!this.isForceUpdateLifeStatus&&this.lifeStatusCallback(t)}),!1)}static forceUpdateLifeStatus(t,e){let i={result:1,data:{lifeStatus:t}};this.isForceUpdateLifeStatus=e,this.lifeStatusCallback&&this.lifeStatusCallback(i)}static registerFocusListener(t){S.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("registerFocusListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,i,n=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},i,n)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static adOutCallback(t,e){S.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("adOutCallback",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:C(e)?e:""})}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,(e=>{t&&t(e)}),!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,i,n=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:i,playDuration:n})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e,i){this.callNativeWithCallback("openURL",{url:t,title:e,showConfirmDialog:i})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){w()&&this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((i,n)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),i(t)):i({result:0,data:null})}))))}static callNativeWithCallback(t,e,i,n=!0){const a=f()?1:0;f()&&"pageStatus"==t||f()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,i,n,0):this.callNativeWithCallbackAndType(t,e,i,n,a)}static callTKWithCallback(t,e,i,n=!0){this.callNativeWithCallbackAndType(t,e,i,n,1)}static callNativeWithCallbackAndType(t,e,i,n=!0,a=0){if("undefined"==typeof KwaiAd)return U.log("undefined value KwaiAd"),void(i&&i({result:0,data:null}));U.log("call:"+t);let s=e=>{let n=0,a=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,n=t.result,a=t.data}catch(s){n=0,a=null}U.log("cb:"+t+"  r:"+n),i&&i({result:n,data:a})};const o=X.registerCallbackForAction(s,n,t),r={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?s:o};0==a?KwaiAd.callAdBridge(r):KwaiAd.callTKBridge(r)}}class J{static isClickReward(t,e){try{let i=!0;if(S.isAndroid()&&!T(e)&&(i=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&i)return!0}catch(i){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(i){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){return t.advertiserInfo.userId}static getLiveStreamId(t){return t.adBaseInfo.liveStreamId}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!T(e)&&J.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),T(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=C(e)?e:t.advertiserInfo.rawUserName}catch(i){}return e=C(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(T(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return T(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=tt(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let i="";try{i=t.neoLiveAuthorInfoData.authorName}catch(n){}try{T(i)&&(i=t.neoLiveCartDetailData.authorName)}catch(n){}try{T(i)&&(i=e.adBaseInfo.appName)}catch(n){}return i}static liveGetLiveDesc(t,e){let i="";try{i=t.neoLiveCartDetailData.liveDesc}catch(n){}try{T(i)&&(i=t.neoLiveAuthorInfoData.liveDesc)}catch(n){}try{T(i)&&(i=t.adDescription)}catch(n){}try{T(i)&&(i=e.adBaseInfo.adDescription)}catch(n){}return i}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!T(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!T(e))return e}catch(e){}return null}static getNeoAutoDialogType(t){try{let e=0,i=$(t);e=1==i?t.adMatrixInfo.adDataV2.neoTKInfo.neoAutoDialogType:2==i?t.adMatrixInfo.adDataV2.videoImageTKInfo.neoAutoDialogType:0,1!=e&&2!=e&&(e=0);let n=function(t){if(null==t)return null;try{let e=null,i=$(t);if(2==i?e=Q(t,16):1==i&&(e=Q(t,12)),e){let i=at(e,t);return JSON.parse(i.data).neoAutoDialog}}catch(e){}return null}(t);return 1==e&&T(n.neoAutoDialogGiftPic)&&T(n.neoAutoDialogGiftTitle)&&(e=0),e}catch(e){}return 0}static hasNeoAutoDialog(t){let e=J.getNeoAutoDialogType(t);return!T(e)&&0!=e}}function j(t,e){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;let i=null;if(e)for(let n=0;n<t.impAdInfo.length;++n){let a=t.impAdInfo[n];if(a.adInfo.length>0&&a.adInfo[0].adBaseInfo.creativeId==e){i=a;break}}return i||(i=t.impAdInfo[0]),i}function Z(t){var e;return(null===(e=null==t?void 0:t.adInfo)||void 0===e?void 0:e.length)>0?t.adInfo[0]:null}function $(t){try{return t.adMaterialInfo.materialFeature[0].featureType}catch(e){}return 0}function q(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function Q(t,e){let i;try{switch(e){case 1:i=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId;break;case 12:i=t.adMatrixInfo.adDataV2.neoTKInfo.templateId;break;case 3:i=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId;break;case 2:i=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId;break;case 4:i=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId;break;case 6:case 9:i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId;break;case 5:i=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId;break;case 7:i=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId;break;case 10:i=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId;break;case 11:i=t.adMatrixInfo.adDataV2.pushTKInfo.templateId;break;case 13:i=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId;break;case 14:i=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId;break;case 15:i=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId;break;case 16:i=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId;break;case 100:i=t.adMatrixInfo.adDataV2.complianceCardInfo.templateId;break;case 101:i=t.adMatrixInfo.adDataV2.downloadConfirmCardInfo.templateId;break;case 17:i=t.adMatrixInfo.adDataV2.feedTKCardInfo.templateId;break;default:i=void 0}}catch(n){i=void 0}return i}function tt(t,e){let i=Q(t,e);if(console.log("tkloadcontroller target templateid:"+i),!C(i))return;const n=t.adMatrixInfo.adDataV2.templateDatas.length;for(let a=0;a<n;a++){let e=t.adMatrixInfo.adDataV2.templateDatas[a];if(e.templateId==i)return e}}function et(t,e){let i=Q(t,e);if(!i)return null;console.log("tkloadcontroller   get template is:"+i);const n=t.adMatrixInfo.adDataV2.templateDatas.length;for(let a=0;a<n;a++){let e=t.adMatrixInfo.styles.templates[a];if((null==e?void 0:e.templateId)==i)return e}return null}function it(t,e){let i=!0;if(1==t.adBaseInfo.adOperationType)try{let n=t.downloadSafeInfo.complianceInfo;if(console.log("tkloadcontroller   download ad:"+JSON.stringify(n)),null!=n)switch(e){case 1:i=3!=n.actionBarType;break;case 2:i=3!=n.describeBarType;break;case 3:i=3!=n.materialJumpType;break;default:i=!0}}catch(n){i=!0}else try{let n=t.unDownloadConf.unDownloadRegionConf;if(console.log("tkloadcontroller   h5 ad:"+JSON.stringify(n)+", clickArea: "+e),null!=n)switch(e){case 1:i=1!=n.actionBarType;break;case 2:i=1!=n.describeBarType;break;case 3:i=1!=n.materialJumpType;break;default:i=!0}console.log("tkloadcontroller   h5 ad:"+i)}catch(n){i=!0}return i}function nt(t){return 7==q(t)}function at(t,e){try{let i=e.adMatrixInfo.adDataV2.templateDatas;for(let e=0;e<i.length;e++){let n=i[e];if(n&&t==n.templateId)return n}}catch(i){}}function st(t,e){let i=null,n=ht(t,e);return n&&(i=function(t,e){let i=tt(t,e);if(null==i)return;return JSON.parse(i.data).redPacketInfo}(t,n)),i}function ot(t,e){let i=tt(t,e);if(null==i)return;let n=JSON.parse(i.data),a=null;try{a=n.widgetInfo}catch(s){}return a}function rt(t,e){let i=null,n=ht(t,e);if(n){let e=ot(t,n);e&&(i=e.redPacketInfo),i&&(i.showTime=1.5)}return i}function lt(t,e){let i=null,n=ht(t,e);return n&&(i=function(t,e){let i=tt(t,e);if(null==i)return;return JSON.parse(i.data).giftBoxInfo}(t,n)),i}function ht(t,e){let i=null;try{if(function(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.videoImageTKInfo.renderType}catch(i){}return e}(t))return 16;if(function(t){let e=!1;try{e=!T(t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId)}catch(i){}return e}(t))return 14;2==e?i=function(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.neoTKInfo.renderType}catch(i){}return e}(t)?12:4:3==e?i=function(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.fullScreenInfo.renderType}catch(i){}return e}(t)?3:4:13==e?i=2:4==e&&(i=5)}catch(n){}return i}let ct;function dt(){var t;return ct||(ct={all:t=t||new Map,on(e,i){const n=t.get(e);n?n.push(i):t.set(e,[i])},off(e,i){const n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit(e,i){let n=t.get(e);n&&n.slice().map((t=>{t(i)})),n=t.get("*"),n&&n.slice().map((t=>{t(e,i)}))},clear(){t.clear()}}),ct}class mt{constructor(t,e,i,n,a,s,o){this.soundEnable=!1,this.ignoreCompliance=!1,this.disableDownloadDialog=!1,this.disableLeaveConfirm=!1,this.disableVideoWebPage=!1,this.disableActivityMiddlePage=!1,this.originAdInfo=t,this.deviceInfo=e,this.serverConfig=i,this.creativeId=s;let r=j(this.originAdInfo,s);this.adInfo=Z(r),this.adCacheId=o||Tachikoma.env.adCacheId,this.originAdInfo.adCacheId=this.adCacheId,this.appId=a||Tachikoma.env.appId,this.scene=n||Tachikoma.env.adScene}}class ut{constructor(){this.reward_type=-1,this.task_type=-1,this.task_step=-1}static createPageShowInstance(t,e,i){if(0==e||T(i))return null;if(i.loadDataTime<=0||i.downloadFinishTime<=0)return null;let n=this.INVALID_VALUE;if(e!=this.INVALID_VALUE){n=Date.parse((new Date).toString())-e,n<this.INVALID_VALUE&&(n=this.INVALID_VALUE)}let a=new ut;return a.page_status=2,a.load_type=i.loadFromCache?2:1,a.render_duration_ms=n,a.download_type=i.downloadType,a.download_size=i.downloadSize,a.creative_id=t.adBaseInfo.creativeId,a.video_url=function(t){try{return t.adMaterialInfo.materialFeature[0].materialUrl}catch(e){}return""}(t),a.video_duration_ms=function(t){try{return t.adMaterialInfo.materialFeature[0].videoDuration}catch(e){}return 0}(t),a}}function pt(t){S.supportMinimumTKVersion("4.0.4")&&(t.msg&&(t.msg.report_source=1),z.sendCommercialLog(t,(()=>{})))}ut.INVALID_VALUE=-1;class gt{static createVideoCommonInstance(t,e){return 3==t?gt.createFullscreenCommonInstance(e):2==t?gt.createNeoCommonInstance(e):null}static createImageCommonInstance(t,e){var i;let n=new H;return n.template_id=Q(e,16),n.template_version=null===(i=et(e,16))||void 0===i?void 0:i.templateVersion,n}static createLiveCommonInstance(t,e){var i;let n=new H;return n.template_id=Q(e,14),n.template_version=null===(i=et(e,14))||void 0===i?void 0:i.templateVersion,n}static createNeoCommonInstance(t){var e;let i=new H,n=J.getNeoActionBarCardType(t);return i.actionbar_card_type=n,i.template_id=Q(t,12),i.template_version=null===(e=et(t,12))||void 0===e?void 0:e.templateVersion,n!=G.LIVE_CUT3_STYLE1&&n!=G.LIVE_CUT3_STYLE2||(i.live_room_pattern=M.SIMPLIFIED_LIVE_ROOM_PATTERN),i}static createFullscreenCommonInstance(t){let e=new H,i=J.getFullscreenActionBarCardType(t);return e.actionbar_card_type=i,i!=G.LIVE_CUT3_STYLE1&&i!=G.LIVE_CUT3_STYLE2||(e.live_room_pattern=M.SIMPLIFIED_LIVE_ROOM_PATTERN),e}static appendNeoExtData(t,e,i,n){if(null==t)return;let a=t.neo_ext_data;null==a&&(a=new W,t.neo_ext_data=a),a.videoRollbackToImageTimeout=i.videoRollbackToImageTimeout,a.originalMaterialType=$(e),n&&a&&n(a)}}var ft=function(t,e,i,n){return new(i||(i=Promise))((function(a,s){function o(t){try{l(n.next(t))}catch(e){s(e)}}function r(t){try{l(n.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}l((n=n.apply(t,e||[])).next())}))};class wt{static sendLog(t,e,i,n){this.log(t,null,e,i,n)}static log(t,e,i,n,a){(i=i||{}).renderContainer=1;const s={actionType:t,payload:JSON.stringify(i)};if(a&&(s.creativeId=a),n)if(null==n?void 0:n.adCacheId)s.adCacheId=null==n?void 0:n.adCacheId;else{const t=j(n,a);s.adTemplate=JSON.stringify(t)}e&&(s.clickInfo=e),z.sendLog(s)}static convertIfNeeded(t,e,i,n,a,s,r,l,h,c,d){if(!it(e,i))return;let m=o;T(m)||(s||(s=new H),T(s.template_id)&&(s.template_id=m.templateId),T(s.template_version)&&(s.template_version=m.templateVersion)),s=wt.appendGlobalNeoExtData(s,e),function(t){return J.isOriginLiveAd(t)||nt(t)}(e)&&this.reportLivePlaySecond(this.sCurrentPlayTimeMs/1e3),this.convert(i,n,a,t,s,r,l,h,c,d)}static convert(t,e,i,n,a,s,o,r,l,h){return ft(this,void 0,void 0,(function*(){const c=Z(j(u(),r));if(!c||!it(c,t))return void console.log("tkloadcontroller invalid convert:"+c+":"+t);let f,C;f=T(a)?{itemClickType:i,renderContainer:1}:{itemClickType:i,renderContainer:1,clientExtData:JSON.stringify(a)},T(s)||Object.assign(f,s),dt().emit(V,{clickType:i}),e?(C={x:e.x,y:e.y},e.width&&(C.width=e.width),e.height&&(C.height=e.height)):C={};let A=-1;if((null==o?void 0:o.convertType)&&(A=o.convertType,f.triggerType=A),console.log("tkloadcontroller begin conversion"),this.matchTKConversion()){console.log("tkloadcontroller match conversion service");let i=KSAdTKBundleService.getInstance("CommercialKSAdConversionService","conversion-service",null);if(i){console.log("tkloadcontroller service instance is:"+i);const a=new mt(l||u(),d(),m());return a.currentPlayTime=this.sCurrentPlayTimeMs,a.clickScene=n,a.convertType=A,a.creativeId=r,a.clickArea=t,a.soundEnable=this.sSoundEnable,(null==o?void 0:o.liveItemId)&&(a.liveItemId=o.liveItemId),Tachikoma.env.isDebug&&(b="TK转化链路开始",z.callNativeWithCallback("showToast",{message:b})),z.clickActionBase({isCallbackOnly:!0},I),i.getVersion()>=2&&(this.sSecondClickCallback=t=>{console.log("tkloadcontroller secondconfirm updatelifestatus status:"+t),0==t?z.forceUpdateLifeStatus("pageInvisiable",!0):1==t?z.forceUpdateLifeStatus("pageInvisiable",!1):2==t&&z.forceUpdateLifeStatus("pageVisiable",!1)},i.setSecondConfirmCallback(this.sSecondClickCallback),i.getVersion()>=3&&S.supportMinimumTKVersion("5.1.3")&&w()&&(this.sDownloadTipCallback=t=>{switch(t){case 0:z.adOutCallback({targetMethod:"adDownloadConfirmTipShow"});break;case 2:z.adOutCallback({targetMethod:"adDownloadConfirmTipCancel"});break;case 1:z.adOutCallback({targetMethod:"adDownloadConfirmTipDismiss"})}},i.setDownloadConfirmTipCallback(this.sDownloadTipCallback))),this.sHandleAdClickCallback=t=>{if(console.log("tkloadcontroller  handle click finish:"+t.success),this.sCurrentPlayTimeMs>0&&(f.playedDuration=this.sCurrentPlayTimeMs),t.reportExtraParam)try{let e=T(f.clientExtData)?{}:JSON.parse(f.clientExtData);e.clientExtData=JSON.parse(t.reportExtraParam),f.clientExtData=JSON.stringify(e)}catch(i){!function(t,e="",i=""){var n,a;pt({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:.1,suffixRatio:"",event_id:"ad_tk_render_performance",primaryKey:"unknown",type:"OTHER",msg:{render_state:3,error_reason:g(t),template_id:T(i)?null===(n=p())||void 0===n?void 0:n.templateId:i,version_code:T(e)?null===(a=p())||void 0===a?void 0:a.templateVersionCode:e}})}(i)}console.log("tkloadcontroller log payload:"+JSON.stringify(f)),this.log(2,e,f),S.isAndroid()||this.handleIOSConvertCallback(t)},void i.handleAdClick(JSON.stringify(a),this.sHandleAdClickCallback)}console.log("tkloadcontroller conversion service failed"),this.loadConversionServiceIfNeeded((t=>{console.log("tkloadcontroller service load result:"+t)}))}var I,b;console.log("tkloadcontroller mismatch conversion service");let _=null==l?void 0:l.impAdInfo[0];!function(t,e,i,n,a,s,o){z.clickActionBase(Object.assign(Object.assign({area:t,logParam:e},i),{creativeId:n,adTemplate:s,disableCallback:o}),a)}(t,{payload:JSON.stringify(f),clickInfo:C,sceneType:n,itemClickType:i},o,r,(i=>{1!=i.result&&(this.log(2,e,f),z.convert(1==t))}),_,h)}))}static handleIOSConvertCallback(t){t.success&&3==t.interactionType&&z.adOutCallback({targetMethod:"closeConvertPageCallback",methodParams:JSON.stringify({interactionType:t.interactionType})})}static reportClick(t,e,i,n){null==n&&(n=new H),n=wt.appendGlobalNeoExtData(n,t);let a={clientExtData:JSON.stringify(n)};a=Object.assign(a,i),wt.log(2,null,a)}static appendGlobalNeoExtData(t,e){let i=m(),n=c();return null!=n&&null!=i&&(t||(t=new H),gt.appendNeoExtData(t,e,i.abConfig,(t=>{t.realRenderResult=n}))),t}static expose(t,e){this.log(1,null,t,e)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,i,n,a){this.convertWithType(e,i,n,a)}static convertWithType(t,e,i,n){this.convert(t,e,i,0,null,null,{convertType:n})}static convertWithTypeIfNeededNew(t,e,i,n,a,s){it(t,e)&&this.convertWithTypeNew(e,i,n,a,s)}static convertWithTypeNew(t,e,i,n,a){this.convert(t,e,i,0,null,a,{convertType:n})}static playNSecond(t,e){let i={photoPlaySecond:t};if(e){let t={clientExtData:JSON.stringify(e)};Object.assign(i,t)}this.log(402,null,i)}static playStart(t){let e=null;t&&(e={clientExtData:JSON.stringify(t)}),wt.log(399,null,e)}static reportLivePlaySecond(t){let e={photoPlaySecond:Math.round(t)},i={actionType:28,payload:JSON.stringify(e)};z.sendLog(i)}static skip(){this.log(501,null,null)}static loadConversionServiceIfNeeded(t){this.matchTKConversion()&&KSAdTKBundleService.loadBundle("CommercialKSAdConversionService",t),t&&t(!1)}static matchTKConversion(){var t,e,i,n;return console.log("tkloadcontroller  tkconversionswitch:"+(null===(e=null===(t=m())||void 0===t?void 0:t.abConfig)||void 0===e?void 0:e.tkConversionSwitch)),console.log("tkloadcontroller  tkconversionswitch:"+JSON.stringify(d())),(null===(n=null===(i=m())||void 0===i?void 0:i.abConfig)||void 0===n?void 0:n.tkConversionSwitch)&&S.supportMinimumTKVersion("5.1.3")}static updateVideoPlayStatus(t,e,i,n){!function(t,e,i,n){z.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:i||"",currentTime:n||0})}(t,e,i,n),"progress"==t&&n&&(this.sCurrentPlayTimeMs=n)}static updateLivePlayStatus(t,e,i,n){"progress"==t&&n&&(this.sCurrentPlayTimeMs=n)}}wt.sSoundEnable=!1;class Ct{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,z.pageStatus(t,e),this.registerNativeId(),wt.loadConversionServiceIfNeeded((t=>{})))}registerNativeId(){1==Tachikoma.env.isDebug&&S.supportMinimumTKVersion("4.0.7")&&!S.isAndroid()&&(this.startConfig(),z.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{y(this)}),120)}}class At extends TKView{}class It extends Object{constructor(t,e,i,n){var a;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=i,this.value=this.get(),this.cb(null!==(a=this.value)&&void 0!==a?a:n,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){It.target=this;const t=this.getter.call(this.vm,this.vm);return It.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let i=0,n=e.length;i<n;i++){if(!t)return;t=t[e[i]]}return t}}}function bt(t){return!!t}let Tt;function _t(){if(null!=Tt)return Tt;let t=!1;try{t=!1,Tt=t}catch(e){}return t}function yt(t,e){if(!0===_t()&&(null==t||!1===t))throw new Error("tkmvvm ----- 请检查传值: "+e)}function vt(t){_t()&&console.log("tachikoma TKMVVM log -> "+t)}class Lt extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var i=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(n){e?e===n&&i.observeValueWithKey(t,n):i.observeValueWithKey(t,n)}))}observeValueWithKey(t,e){let i=t[e];var n=new St(e);kt(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return It.target&&n.depend(),i},set:function(t){t!==i&&(i=t,n.notify(),kt(t))}})}defineArray(t){if(t)for(let e=0,i=t.length;e<i;e++)kt(t[e])}}var Rt=0;class St extends Object{constructor(t){super(),this.key=t,this.pid=Rt++,this.deps=new Array}depend(){It.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function kt(t,e){if(!t||"object"!=typeof t)return;var i;if(!("object"==typeof(i=t)&&Object.keys(i).length>0))return;let n=!1,a=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(a)&&(n=t[a]),!n)return vt("observe "+a),t[a]=!0,new Lt(t,e);vt("already observe "+a)}class Et extends Object{constructor(){super()}tk_observe(t){bt(t)&&(t in this?kt(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}function Nt(t,e){const i=t.$vm;if(!bt(i)||!bt(t)||!bt(e))return;const n=Vt(t),a=null==n?void 0:n.split(".");if(!a)return void yt(a,"tk_bind error, check bind path");const s=a[0];i.tk_observe(s),new It(i,n,((t,i)=>{e&&e(t)}))}function Pt(t,e,i){if(!bt(t)||!bt(e)||!bt(i))return;const n=Vt(e),a=null==n?void 0:n.split(".");if(!a)return void yt(a,"tk_bind error, check bind path");const s=a[0];t.tk_observe(s),new It(t,n,((t,e)=>{i&&i(t)}))}function Vt(t){let e=function(t){if(t)return t.bind_path?t.$bind_path:"string"==typeof t?t:void 0}(t);if(e)return e;yt(e,"tk_bind error, check bind path")}function Dt(t,e,i=!1){const n=new TKKeyframeAnimation;return i?(n.setAnimations([()=>(t.style={opacity:1},1)]),n.timingFunction="ease-in-out"):(n.animType="opacity",n.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}]),n.duration=e,n}function xt(t,e,i=!1){const n=new TKKeyframeAnimation;return i?(n.setAnimations([()=>(t.style={opacity:0},1)]),n.timingFunction="ease-in-out"):(n.animType="opacity",n.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:1,value:0,easing:"EaseInEaseOut"}]),n.duration=e,n}class Bt extends TKView{constructor(t){super(),this.columnNum=3,this.traveViews=[],this.iconImages=[],this.iconDefaultSize={width:150,height:150},this.hasAnimedView=new Array(9),this.currentIntervalTime=0,this.animedCount=0,this.timer=0,this.hasShow=!1,this.vm=t,this.pendantRowDelay=0,this.rowNum=this.vm.getRowNum(),this.vm.checkParam()&&(this.style={width:"100%",height:"100%"},this.throughHitTest=!0,this.createTravelView(),this.createRedPacketInTravel())}createTravelView(){this.traveViews=[];for(let t=0;t<this.columnNum;t++){let e=new TKView;e.style={width:this.iconDefaultSize.width,height:this.vm.containerSize.height+this.iconDefaultSize.height+30,position:"absolute",left:this.getLeftMagin(t),alignItems:"center",top:-this.iconDefaultSize.height},e.throughHitTest=!0,this.appendChild(e),this.traveViews.push(e)}}getLeftMagin(t){let e=this.vm.containerSize.width/this.columnNum,i=this.iconDefaultSize.width-e;return 0==t?0:1==t?e-i/2:this.vm.containerSize.width-this.iconDefaultSize.width}createRedPacketInTravel(){this.iconImages=[];for(let t=0;t<this.columnNum;t++)for(let e=0;e<this.rowNum;e++){let i=this.createIconImage(e,t);this.iconImages[t*this.rowNum+e]=i,this.traveViews[t].appendChild(i)}}createIconImage(t,e){let i=new TKImage,n=this.vm.getScaleType(t,e);if(i.style={width:this.iconDefaultSize.width*n,height:this.iconDefaultSize.height*n,position:"absolute",top:0},this.vm.isCanClick()){let t=this;i.addEventListener("tap",(e=>{const n=function(t,e){let i={x:0,y:0};if(S.supportMinimumTKVersion("4.0.0")){const n=e.getLocationOnScreen(),a=t.position;if(!n||!a)return i;a.x=parseFloat((a.x+"").replace("dp","")),a.y=parseFloat((a.y+"").replace("dp","")),i={x:n.x+a.x,y:n.y+a.y}}return i}(e,i);this.vm.convert(2,n,k.FALL_ICON_CLICK),t.hide(!0)}))}else i.addEventListener("tap",(t=>{}));return i.setSrc(this.vm.getRedPacketIconUrl()),i}createIconAnimation(t,e){const i=1e3*this.vm.getShowTime(t),n=new TKKeyframeAnimation;let a=this;n.timingFunction="linear",n.setAnimations([()=>(e.style={top:0},0),()=>(e.style={top:a.vm.containerSize.height+a.iconDefaultSize.height+30},1)]),t==this.vm.getLastAnimIconIndex()&&n.on("end",(()=>{a.hide()})),n.duration=i;let s="translateAnimation"+t.toString();if(e.addAnimation(n,s),this.vm.isCanShowRotateAnim(t)&&setTimeout((()=>{this.startRotateAnimation(e)}),this.vm.getRotateAnimDelayTime(t)),2==this.vm.getAnimType()){const t=new TKKeyframeAnimation;t.timingFunction="ease-in",t.setAnimations([()=>(e.style={opacity:1},.5),()=>(e.style={opacity:.5},.75),()=>(e.style={opacity:0},1)]),t.duration=.6*i,e.addAnimation(t,"opacityAnimation")}}startRotateAnimation(t){const e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={transform:{rotate:{z:0}}},0),()=>(t.style={transform:{rotate:{z:-25}}},.2),()=>(t.style={transform:{rotate:{z:25}}},.4),()=>(t.style={transform:{rotate:{z:-21}}},.6),()=>(t.style={transform:{rotate:{z:21}}},.8),()=>(t.style={transform:{rotate:{z:0}}},1)]),e.duration=1500,t.addAnimation(e,"rotateAnim")}show(){this.vm.isParamValid()&&(this.hasShow||(this.hasShow=!0,this.vm.reportRedPacketImpression(),this.showRedPacketIconWithAnim()))}hide(t=!1){const e=this;setTimeout((()=>{e.removeAllAnimation(),e.removeAll(),e.vm.dismissCallbackOnlyOnce()}),t?100:0)}showRedPacketIconWithAnim(){this.tryShowAnim(),this.timer=setInterval((()=>{this.currentIntervalTime+=this.vm.getAnimMinTime(),this.tryShowAnim()}),this.vm.getAnimMinTime())}tryShowAnim(){if(this.animedCount!=this.vm.getAnimedCount()){for(let t=0;t<this.vm.getAnimedCount();t++)if(!this.hasAnimedView[t]&&this.currentIntervalTime==this.vm.getIconDelayTime(t)){this.hasAnimedView[t]=!0;let e=this.iconImages[t];this.createIconAnimation(t,e),this.animedCount=this.animedCount+1}}else this.timer&&clearInterval(this.timer)}}class Kt extends TKView{constructor(t){super(),this.animationAllowed=!0,this.vm=t,this.setupView(),this.setupData(),this.setupAction(),this.startShowAnimation()}setupView(){this.throughHitTest=!0,this.style={alignItems:"flex-start",width:this.vm.getPendantSize().width,height:this.vm.getPendantSize().height},this.contentView=new TKView,this.contentView.style={justifyContent:"center",alignItems:"center"},this.appendChild(this.contentView),this.pendantTitle=new TKText,this.pendantTitle.style={top:0,marginLeft:this.vm.getPendantTitleMarginLR(),marginRight:this.vm.getPendantTitleMarginLR(),fontSize:this.vm.getPendantTitleFontSize(),color:"#FFFFFF",fontWeight:"bold",textAlign:"center",textLineHeight:20,opacity:0},this.contentView.appendChild(this.pendantTitle),this.pendantImage=new TKImage,this.pendantImage.style={width:this.vm.getPendantImageWH(),height:this.vm.getPendantImageWH(),opacity:0},this.contentView.appendChild(this.pendantImage),this.guidanceImage=new TKImage,this.guidanceImage.style={marginTop:this.vm.getGuidanceImageMarginTop(),marginLeft:this.vm.getGuidanceImageMarginLeft(),height:this.vm.getGuidanceImageWH(),width:this.vm.getGuidanceImageWH(),opacity:0},this.appendChild(this.guidanceImage)}setupData(){this.pendantTitle.setText(this.vm.getPendantTitleText()),this.pendantImage.setSrc(this.vm.getPendantImageUrl()),L(this.guidanceImage,"icon_ksad_hand_touch_guide.png")}setupAction(){const t=this;this.pendantImage&&this.vm.enableClickPendant()&&this.pendantImage.addEventListener("tap",(e=>{t.startHideAnimation(),this.vm.enableShowPendantClickAnim()?t.startClickAnimShowAnimation():t.vm.reportPendantClick()}))}startShowAnimation(){const t=this;this.startPendantImageShowAnimation((()=>{setTimeout((()=>{t.startPendantTitleShowAnimation((()=>{t.startGuidanceImageShowAnimation()}))}),500)})),this.vm.reportPendantImpression()}startPendantImageShowAnimation(t){const e=this,i=new TKKeyframeAnimation;i.setAnimations([()=>(e.pendantImage.style={transform:{scale:.6},opacity:0},0),()=>(e.pendantImage.style={transform:{scale:1},opacity:1},.56),()=>(e.pendantImage.style={transform:{scale:.9}},.78),()=>(e.pendantImage.style={transform:{scale:1}},1)]),i.timingFunction="ease-out",i.duration=700,i.on("end",(()=>{t&&t()})),this.pendantImage.addAnimation(i,"pendantImageShowAnimation")}startPendantTitleShowAnimation(t){const e=this,i=new TKKeyframeAnimation;i.setAnimations([()=>(e.pendantTitle.style={top:10,opacity:0},0),()=>(e.pendantTitle.style={top:0,opacity:1},1)]),i.timingFunction="ease-out",i.duration=300,i.on("end",(()=>{t&&t()})),this.pendantTitle.addAnimation(i,"pendantTitleShowAnimation")}stopActionAnimation(){this.animationAllowed=!1,this.guidanceImage&&this.guidanceImage.removeAllAnimation()}startGuidanceImageShowAnimation(){if(!this.vm.enableShowGuidanceImage())return;if(!this.animationAllowed)return!1;const t=Dt(this.guidanceImage,200,!0);this.guidanceImage.addAnimation(t,"guidanceImageShowAnimation");const e=this;t.on("end",(()=>{e.startGuidanceImageMoveAnimation()}))}restartGuidanceImageMoveAnimationIfNeeded(){this.vm.enableShowGuidanceImage()&&(this.guidanceImage.removeAllAnimation(),this.startGuidanceImageMoveAnimation())}startGuidanceImageMoveAnimation(){const t=this;let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.guidanceImage.style={transform:{translate:{x:0,y:0}}},.33),()=>(t.guidanceImage.style={transform:{translate:{x:10,y:10}}},.66),()=>(t.guidanceImage.style={transform:{translate:{x:0,y:0}}},1)]),e.duration=450,e.repeatCount=Number.MAX_SAFE_INTEGER,e.timingFunction="linear",this.guidanceImage.addAnimation(e,"guidanceImageMoveAnimation")}startHideAnimation(){this.startPendantImageHideAnimation();const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.addAnimation(e,"pendantHideAnimation")}startPendantImageHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.pendantImage.style={transform:{scale:.8}},1)]),e.timingFunction="ease-out",e.duration=300,this.pendantImage.addAnimation(e,"pendantImageHideAnimation")}createPendantClickAnimViewIfNeeded(t){this.vm.enableShowPendantClickAnim()&&(this.pendantClickAnimView=new Bt(this.vm.pendantAnimViewModel),this.pendantClickAnimView.style={position:"absolute"},t.appendChild(this.pendantClickAnimView))}removePendantClickAnimViewIfNeeded(t){this.pendantClickAnimView&&t.removeChild(this.pendantClickAnimView)}startClickAnimShowAnimation(){if(!this.pendantClickAnimView)return;this.pendantClickAnimView.show();const t=this;this.expireTimer=setTimeout((()=>{t.startClickAnimHideAnimation(),t.vm.reportPendantClick()}),this.vm.getPendantClickAnimDuration())}startClickAnimHideAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.pendantClickAnimView.style={opacity:0},1)]),e.timingFunction="ease-out",e.duration=300,this.pendantClickAnimView.addAnimation(e,"pendantClickAnimHideAnimation")}clearTimeoutIfConverted(){this.expireTimer&&clearTimeout(this.expireTimer)}}class Ot extends TKView{constructor(t,e){super(),this.vm=t,this.screenWidth=this.vm.callerContext.containerLimit.width,this.screenHeight=this.vm.callerContext.containerLimit.height,this.nextAnim=e,this.setupViews(),this.setupActions()}setupViews(){this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0},this.throughHitTest=!0,this.setupPreHeatView(),setTimeout((()=>{this.vm.enableCountDown()?this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleCountDownAnimation())}),Ot.NEO_PREHEAT_ANIMATION_SPEED):this.vm.isSplash()?this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleDisappearAnimation(Ot.SPLASH_PREHEAT_ANIMATION_SPEED))}),Ot.SPLASH_PREHEAT_ANIMATION_SPEED):this.setBubbleAppearAnimation((()=>{this.vm.isShowEnd||(this.preHeatView.removeChild(this.preHeatBubbleRedPacketView),this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.setBubbleDisappearAnimation(Ot.INTERSTITIAL_PREHEAT_ANIMATION_SPEED))}),Ot.INTERSTITIAL_PREHEAT_ANIMATION_SPEED)}),200)}setupPreHeatView(){this.preHeatView=new TKView,this.preHeatView.throughHitTest=!0,this.preHeatView.style={width:"100%",height:"100%",top:0,alignSelf:"center",flexDirection:"column",alignItems:"center"},this.appendChild(this.preHeatView),this.preHeatBubbleRedPacketView=new TKView,this.preHeatBubbleRedPacketView.throughHitTest=!0,this.preHeatBubbleRedPacketView.style={position:"absolute",width:"100%",height:"100%",top:0,opacity:0},this.preHeatView.appendChild(this.preHeatBubbleRedPacketView),this.preHeatRedPacketView=new TKView,this.preHeatRedPacketView.style={position:"absolute",width:this.screenAdaptate(270),height:this.screenAdaptate(270),top:(this.screenHeight-this.screenAdaptate(270)-38)/2,alignSelf:"center"},this.preHeatBubbleRedPacketView.appendChild(this.preHeatRedPacketView);let t=this.vm.getIndustryTopIcon();this.preHeatRedPacket=new TKImage,T(t)?(this.preHeatRedPacket.style={position:"absolute",width:this.screenAdaptate(132),height:this.screenAdaptate(132),top:this.screenAdaptate(69),alignSelf:"center"},L(this.preHeatRedPacket,"image/BubbleRainResources/icon_ksad_bubble_rain_red_packet.png"),this.preHeatRedPacketView.appendChild(this.preHeatRedPacket),this.setupSubView(Ot.LOGO_DISTANCE_WITHOUT_IP,Ot.NUMBER_DISTANCE_WITHOUT_IP)):(this.preHeatRedPacket.style={position:"absolute",width:this.screenAdaptate(132),height:this.screenAdaptate(172),top:this.screenAdaptate(46),alignSelf:"center"},L(this.preHeatRedPacket,t),this.preHeatRedPacketView.appendChild(this.preHeatRedPacket),this.setupSubView(Ot.LOGO_DISTANCE_WITH_IP,Ot.NUMBER_DISTANCE_WITH_IP)),this.preHeatBubble=new TKImage,this.preHeatBubble.style={position:"absolute",width:this.screenAdaptate(270),height:this.screenAdaptate(270),top:(this.screenHeight-this.screenAdaptate(270)-38)/2,alignSelf:"center"},L(this.preHeatBubble,"image/BubbleRainResources/icon_ksad_bubble_rain_bubble.png"),this.preHeatBubbleRedPacketView.appendChild(this.preHeatBubble),this.preHeatDescView=new TKView,this.preHeatDescView.style={position:"absolute",width:202,height:38,top:(this.screenHeight+this.screenAdaptate(270)-38)/2,alignItems:"center"},this.preHeatView.appendChild(this.preHeatDescView),this.preHeatDescTextBackground=new TKView,this.preHeatDescTextBackground.style={width:202,height:38,borderRadius:20,gradientBgColor:"270, #FFF9EB, #B8976A, #DBC3A7"},this.preHeatDescView.appendChild(this.preHeatDescTextBackground),this.preHeatDescText=new TKText,this.preHeatDescText.style={position:"absolute",width:198,height:34,top:2,fontSize:16,color:"#FFFFFF",textLineHeight:22,borderRadius:20,textAlign:"center",fontWeight:"500",shadow:"0 1 3 #00000025",backgroundColor:"#FC4118"};let e=this.vm.getBubbleActionDes();T(e)&&(e="立即开启大促"),this.preHeatDescText.text=e,this.preHeatDescView.appendChild(this.preHeatDescText)}setupSubView(t,e){let i=this.vm.getRedPacketIndustryIcon();T(i)&&(i="image/BubbleRainResources/icon_ksad_bubble_rain_double_eleven.png"),this.preHeatLogo=new TKImage,this.preHeatLogo.style={position:"absolute",width:this.screenAdaptate(86),height:this.screenAdaptate(38),top:this.screenAdaptate(147+t),left:this.screenAdaptate(94)},R(this.preHeatLogo,i,500,(t=>{t||L(this.preHeatLogo,"image/BubbleRainResources/icon_ksad_bubble_rain_double_eleven.png")})),this.preHeatRedPacketView.appendChild(this.preHeatLogo),this.preHeatNumber3=new TKImage,this.preHeatNumber3.style={position:"absolute",width:this.screenAdaptate(24),height:this.screenAdaptate(34),top:this.screenAdaptate(146+e),left:this.screenAdaptate(122),opacity:0},L(this.preHeatNumber3,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number3.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber3),this.preHeatNumber2=new TKImage,this.preHeatNumber2.style={position:"absolute",width:this.screenAdaptate(24),height:this.screenAdaptate(34),top:this.screenAdaptate(146+e),left:this.screenAdaptate(123),opacity:0},L(this.preHeatNumber2,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number2.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber2),this.preHeatNumber1=new TKImage,this.preHeatNumber1.style={position:"absolute",width:this.screenAdaptate(14),height:this.screenAdaptate(35),top:this.screenAdaptate(146+e),left:this.screenAdaptate(127),opacity:0},L(this.preHeatNumber1,"image/BubbleRainResources/icon_ksad_bubble_rain_preheat_number1.png"),this.preHeatRedPacketView.appendChild(this.preHeatNumber1)}setBubbleAppearAnimation(t,e){let i=new TKKeyframeAnimation;w()?i.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:.13,translate:{x:0,y:154,z:0},rotate:{x:0,y:180,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]):i.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.037,y:.13},translate:{x:0,y:154,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),i.duration=400*e,i.timingFunction="0.0 0.0 0.0 1.0";let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1.196,y:1.059},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.985,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),n.duration=200*e,n.timingFunction="0.0 0.0 0.56 1.0";let a=new TKKeyframeAnimation;a.setAnimations([()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:.985,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},.001),()=>(this.preHeatBubbleRedPacketView.style={transform:{scale:{x:1,y:1},translate:{x:0,y:0,z:0},rotate:{x:0,y:360,z:0}},opacity:1},1)]),a.duration=250*e,a.timingFunction="linear",a.on("end",t),n.on("end",(()=>{this.vm.isShowEnd||this.preHeatBubbleRedPacketView.addAnimation(a,"bubbleAppearAnimation3")})),i.on("end",(()=>{this.vm.isShowEnd||this.preHeatBubbleRedPacketView.addAnimation(n,"bubbleAppearAnimation2")})),this.preHeatBubbleRedPacketView.addAnimation(i,"bubbleAppearAnimation1")}setBubbleCountDownAnimation(){let t=new TKKeyframeAnimation;t.setAnimations([()=>(this.preHeatLogo.style={opacity:1},.001),()=>(this.preHeatLogo.style={opacity:0},1)]),t.duration=500,t.timingFunction="0.0 0.0 0.38 0.99",this.preHeatLogo.addAnimation(t,"logoAnimation");let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.preHeatNumber3.style={opacity:0},.001),()=>(this.preHeatNumber3.style={opacity:1},5/7),()=>(this.preHeatNumber3.style={opacity:0},1)]),e.duration=700,e.timingFunction="0.0 0.0 0.38 0.99";let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.preHeatNumber2.style={opacity:0},.001),()=>(this.preHeatNumber2.style={opacity:1},5/7),()=>(this.preHeatNumber2.style={opacity:0},1)]),i.duration=700,i.timingFunction="0.0 0.0 0.38 0.99";let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatNumber1.style={opacity:0},.001),()=>(this.preHeatNumber1.style={opacity:1},1)]),n.duration=500,n.timingFunction="0.0 0.0 0.38 0.99",n.on("end",(()=>{this.vm.isShowEnd||this.setBubbleDisappearAnimation(Ot.NEO_PREHEAT_ANIMATION_SPEED)})),i.on("end",(()=>{this.vm.isShowEnd||this.preHeatNumber1.addAnimation(n,"number1Animation")})),e.on("end",(()=>{this.vm.isShowEnd||this.preHeatNumber2.addAnimation(i,"number2Animation")})),this.preHeatNumber3.addAnimation(e,"number3Animation")}setBubbleDisappearAnimation(t){let e=new TKKeyframeAnimation;e.setAnimations([()=>(this.preHeatDescView.style={opacity:1},.001),()=>(this.preHeatDescView.style={opacity:0},1)]),e.duration=1e3*t,e.timingFunction="0.42 0.0 0.58 1.0",this.preHeatDescView.addAnimation(e,"buttonDisappearAnimation");let i=new TKKeyframeAnimation;i.setAnimations([()=>(this.preHeatBubble.style={transform:{scale:1,translate:{y:0}},opacity:1},.001),()=>(this.preHeatBubble.style={transform:{scale:9.47,translate:{y:250}},opacity:0},1)]),i.duration=1e3*t,i.timingFunction="0.42 0.0 0.58 1.0",this.preHeatBubble.addAnimation(i,"bubbleDisappearAnimation");let n=new TKKeyframeAnimation;n.setAnimations([()=>(this.preHeatRedPacketView.style={transform:{scale:1,translate:{y:0}}},.001),()=>(this.preHeatRedPacketView.style={transform:{scale:7.4,translate:{y:550}}},1)]),n.duration=1e3*t,n.timingFunction="0.42 0.0 0.58 1.0",this.preHeatRedPacketView.addAnimation(n,"redPacketEnlargeAnimation");let a=new TKKeyframeAnimation;a.setAnimations([()=>(this.preHeatRedPacketView.style={opacity:1},.001),()=>(this.preHeatRedPacketView.style={opacity:0},1)]),a.duration=1e3*t,a.on("end",(()=>{this.vm.isShowEnd||(this.nextAnim(),this.stopAllAnimation())})),this.preHeatRedPacketView.addAnimation(a,"redPacketDisappearAnimation")}setupActions(){let t=new H;t.template_show_type="bubble_id_click",this.preHeatDescText.addEventListener("tap",(e=>{this.vm.convert(1,{x:0,y:0},k.BUBBLE_RAIN_CLICK,t)})),this.preHeatDescView.addEventListener("tap",(e=>{this.vm.convert(1,{x:0,y:0},k.BUBBLE_RAIN_CLICK,t)})),this.preHeatBubble.addEventListener("tap",(e=>{this.vm.convert(1,{x:0,y:0},k.BUBBLE_RAIN_CLICK,t)}))}stopAllAnimation(){this.preHeatBubbleRedPacketView&&this.preHeatBubbleRedPacketView.removeAllAnimation(),this.preHeatLogo&&this.preHeatLogo.removeAllAnimation(),this.preHeatNumber1&&this.preHeatNumber1.removeAllAnimation(),this.preHeatNumber2&&this.preHeatNumber2.removeAllAnimation(),this.preHeatNumber3&&this.preHeatNumber3.removeAllAnimation(),this.preHeatDescView&&this.preHeatDescView.removeAllAnimation(),this.preHeatBubble&&this.preHeatBubble.removeAllAnimation(),this.preHeatRedPacketView&&this.preHeatRedPacketView.removeAllAnimation(),this.removeAll()}screenAdaptate(t){return t*this.screenWidth/414}}Ot.LOGO_DISTANCE_WITH_IP=17,Ot.LOGO_DISTANCE_WITHOUT_IP=0,Ot.NUMBER_DISTANCE_WITH_IP=17,Ot.NUMBER_DISTANCE_WITHOUT_IP=0,Ot.SPLASH_PREHEAT_ANIMATION_SPEED=.5,Ot.NEO_PREHEAT_ANIMATION_SPEED=1,Ot.INTERSTITIAL_PREHEAT_ANIMATION_SPEED=1;class Mt{getStartTime(){return this.startTime}setStartTime(t){this.startTime=t}}class Ht extends Mt{constructor(t,e){super(),this.alpha=t,this.setStartTime(e)}getAplha(){return this.alpha}setAlpha(t){this.alpha=t}}class Wt extends Mt{getAplha(){return this.alpha}setAlpha(t){this.alpha=t}getRotationZ(){return this.rotationZ}getRotationX(){return this.rotationX}getRotationY(){return this.rotationY}setRotationX(t){this.rotationX=t}setRotationY(t){this.rotationY=t}setRotationZ(t){this.rotationZ=t}getScaleX(){return this.scaleX}setScaleX(t){this.scaleX=t}getScaleY(){return this.scaleY}setScaleY(t){this.scaleY=t}getTranslationX(){return this.translationX}setTranslationX(t){this.translationX=t}getTranslationY(){return this.translationY}setTranslationY(t){this.translationY=t}toString(){return"{alpha :"+this.alpha+" + rotationX :"+this.rotationX+" + rotationY :"+this.rotationY+" + rotationZ :"+this.rotationZ+" + scaleX :"+this.scaleX+" + scaleY :"+this.scaleY+" + translationX :"+this.translationX+" + translationY :"+this.translationY+"}"}}class Gt extends Mt{constructor(t,e,i,n){super(),this.rotationX=void 0,this.rotationY=void 0,this.rotationZ=t,this.rotationY=n,this.rotationX=i,this.setStartTime(e)}getRotationZ(){return this.rotationZ}getRotationX(){return this.rotationX}getRotationY(){return this.rotationY}setRotation(t){this.rotationZ=t}}class Ft extends Mt{constructor(t,e,i){super(),this.scaleX=t,this.scaleY=e,this.setStartTime(i)}getScaleX(){return this.scaleX}setScaleX(t){this.scaleX=t}getScaleY(){return this.scaleY}setScaleY(t){this.scaleY=t}}class Yt extends Mt{constructor(t,e,i){super(),this.translationX=t,this.translationY=e,this.setStartTime(i)}getTranslationX(){return this.translationX}setTranslationX(t){this.translationX=t}getTranslationY(){return this.translationY}setTranslationY(t){this.translationY=t}}function Ut(t,e){return t.getStartTime()-e.getStartTime()}function Xt(t,e,i,n,a){return((n-a)*t+(a-i)*e)/(n-i)}class zt{produceAnimationResult(t){t.sort(Ut);let e=t.length;this.rotationInfoList=new Array,this.alphaInfoList=new Array,this.scaleInfoList=new Array,this.translationInfoList=new Array,this.animationResult=new Map,this.timestampSet=new Set;for(let o=0;o<e;o++)this.timestampSet.add(t[o].getStartTime()),t[o]instanceof Gt?this.rotationInfoList.push(t[o]):t[o]instanceof Ht?this.alphaInfoList.push(t[o]):t[o]instanceof Ft?this.scaleInfoList.push(t[o]):t[o]instanceof Yt&&this.translationInfoList.push(t[o]),this.duration=t[o].getStartTime();let i=0,n=0,a=0,s=0;for(this.timestampSet.forEach((t=>{for(;i<this.alphaInfoList.length;){let e=this.alphaInfoList[i].getStartTime();if(!(e<=t)){if(i>0&&this.alphaInfoList[i-1].getStartTime()!=t){let n=this.alphaInfoList[i-1].getStartTime(),a=Xt(this.alphaInfoList[i-1].getAplha(),this.alphaInfoList[i].getAplha(),n,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setAlpha(a);else{let e=new Wt;e.setStartTime(t),e.setAlpha(a),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setAlpha(this.alphaInfoList[i].getAplha());else{let n=new Wt;n.setStartTime(t),n.setAlpha(this.alphaInfoList[i].getAplha()),this.animationResult.set(e,n)}i++}for(;a<this.rotationInfoList.length;){let e=this.rotationInfoList[a].getStartTime();if(!(e<=t)){if(a>0&&this.rotationInfoList[a-1].getStartTime()!=t){let i=this.rotationInfoList[a-1].getStartTime(),n=Xt(this.rotationInfoList[a-1].getRotationZ(),this.rotationInfoList[a].getRotationZ(),i,e,t),s=Xt(this.rotationInfoList[a-1].getRotationY(),this.rotationInfoList[a].getRotationY(),i,e,t),o=Xt(this.rotationInfoList[a-1].getRotationX(),this.rotationInfoList[a].getRotationX(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setRotationZ(n),this.animationResult.get(t).setRotationY(s),this.animationResult.get(t).setRotationX(o);else{let e=new Wt;e.setStartTime(t),e.setRotationZ(n),e.setRotationY(s),e.setRotationX(o),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setRotationZ(this.rotationInfoList[a].getRotationZ()),this.animationResult.get(e).setRotationY(this.rotationInfoList[a].getRotationY()),this.animationResult.get(e).setRotationX(this.rotationInfoList[a].getRotationX());else{let i=new Wt;i.setStartTime(t),i.setRotationZ(this.rotationInfoList[a].getRotationZ()),i.setRotationY(this.rotationInfoList[a].getRotationY()),i.setRotationX(this.rotationInfoList[a].getRotationX()),this.animationResult.set(e,i)}a++}for(;n<this.scaleInfoList.length;){let e=this.scaleInfoList[n].getStartTime();if(!(e<=t)){if(n>0&&this.scaleInfoList[n-1].getStartTime()!=t){let i=this.scaleInfoList[n-1].getStartTime(),a=Xt(this.scaleInfoList[n-1].getScaleX(),this.scaleInfoList[n].getScaleX(),i,e,t),s=Xt(this.scaleInfoList[n-1].getScaleY(),this.scaleInfoList[n].getScaleY(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setScaleX(a),this.animationResult.get(t).setScaleY(s);else{let e=new Wt;e.setStartTime(t),e.setScaleX(a),e.setScaleY(s),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setScaleX(this.scaleInfoList[n].getScaleX()),this.animationResult.get(e).setScaleY(this.scaleInfoList[n].getScaleY());else{let i=new Wt;i.setStartTime(t),i.setScaleX(this.scaleInfoList[n].getScaleX()),i.setScaleY(this.scaleInfoList[n].getScaleY()),this.animationResult.set(e,i)}n++}for(;s<this.translationInfoList.length;){let e=this.translationInfoList[s].getStartTime();if(!(e<=t)){if(s>0&&this.translationInfoList[s-1].getStartTime()!=t){let i=this.translationInfoList[s-1].getStartTime(),n=Xt(this.translationInfoList[s-1].getTranslationX(),this.translationInfoList[s].getTranslationX(),i,e,t),a=Xt(this.translationInfoList[s-1].getTranslationY(),this.translationInfoList[s].getTranslationY(),i,e,t);if(this.animationResult.has(t))this.animationResult.get(t).setTranslationX(n),this.animationResult.get(t).setTranslationY(a);else{let e=new Wt;e.setStartTime(t),e.setTranslationX(n),e.setTranslationY(a),this.animationResult.set(t,e)}}break}if(this.animationResult.has(e))this.animationResult.get(e).setTranslationX(this.translationInfoList[s].getTranslationX()),this.animationResult.get(e).setTranslationY(this.translationInfoList[s].getTranslationY());else{let t=new Wt;t.setStartTime(e),t.setTranslationX(this.translationInfoList[s].getTranslationX()),t.setTranslationY(this.translationInfoList[s].getTranslationY()),this.animationResult.set(e,t)}s++}}));i<this.alphaInfoList.length;){let t=this.alphaInfoList[i].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setAlpha(this.alphaInfoList[i].getAplha());else{let e=new Wt;e.setStartTime(t),e.setAlpha(this.alphaInfoList[i].getAplha()),this.animationResult.set(t,e)}i++}for(;a<this.rotationInfoList.length;){let t=this.rotationInfoList[a].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setRotationZ(this.rotationInfoList[a].getRotationZ()),this.animationResult.get(t).setRotationY(this.rotationInfoList[a].getRotationY()),this.animationResult.get(t).setRotationX(this.rotationInfoList[a].getRotationX());else{let e=new Wt;e.setRotationZ(this.rotationInfoList[a].getRotationZ()),e.setRotationY(this.rotationInfoList[a].getRotationY()),e.setRotationX(this.rotationInfoList[a].getRotationX()),this.animationResult.set(t,e)}a++}for(;n<this.scaleInfoList.length;){let t=this.scaleInfoList[n].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setScaleX(this.scaleInfoList[n].getScaleX()),this.animationResult.get(t).setScaleY(this.scaleInfoList[n].getScaleY());else{let e=new Wt;e.setScaleX(this.scaleInfoList[n].getScaleX()),e.setScaleY(this.scaleInfoList[n].getScaleY()),this.animationResult.set(t,e)}n++}for(;s<this.translationInfoList.length;){let t=this.translationInfoList[s].getStartTime();if(this.animationResult.has(t))this.animationResult.get(t).setTranslationX(this.translationInfoList[s].getTranslationX()),this.animationResult.get(t).setTranslationY(this.translationInfoList[s].getTranslationY());else{let e=new Wt;e.setTranslationX(this.translationInfoList[s].getTranslationX()),e.setTranslationY(this.translationInfoList[s].getTranslationY()),this.animationResult.set(t,e)}s++}this.animationFiltering()}animationFiltering(){let t=-1;this.timestampSet.forEach((e=>{if(-1!=t){let i=this.animationResult.get(e);this.isInvaildNumber(i.getAplha())&&i.setAlpha(this.animationResult.get(t).getAplha()),this.isInvaildNumber(i.getRotationZ())&&i.setRotationZ(this.animationResult.get(t).getRotationZ()),this.isInvaildNumber(i.getRotationY())&&i.setRotationY(this.animationResult.get(t).getRotationY()),this.isInvaildNumber(i.getRotationX())&&i.setRotationX(this.animationResult.get(t).getRotationX()),this.isInvaildNumber(i.getScaleX())&&i.setScaleX(this.animationResult.get(t).getScaleX()),this.isInvaildNumber(i.getScaleY())&&i.setScaleY(this.animationResult.get(t).getScaleY()),this.isInvaildNumber(i.getTranslationX())&&i.setTranslationX(this.animationResult.get(t).getTranslationX()),this.isInvaildNumber(i.getTranslationY())&&i.setTranslationY(this.animationResult.get(t).getTranslationY())}t=e}))}isInvaildNumber(t){return isNaN(t)||null==t||null==t}bindViewAnmation(t,e,i,n){if(null==t)return;const a=new TKKeyframeAnimation;let s=new Array;this.timestampSet.forEach((e=>{s.push((()=>(t.style={transform:{scale:{x:this.animationResult.get(e).getScaleX(),y:this.animationResult.get(e).getScaleY()},translate:{x:this.animationResult.get(e).getTranslationX(),y:this.animationResult.get(e).getTranslationY()},rotate:{z:this.animationResult.get(e).getRotationZ(),y:this.animationResult.get(e).getRotationY(),x:this.animationResult.get(e).getRotationX()}},opacity:this.animationResult.get(e).getAplha()},0==this.duration?1:this.animationResult.get(e).getStartTime()/this.duration)))})),a.setAnimations(s),a.duration=this.duration,T(n)?a.timingFunction="linear":a.timingFunction=n,i&&(a.on("start",(t=>{i("start")})),a.on("end",(t=>{i("end")}))),t.addAnimation(a,e)}}class Jt{static bindAnimation(t,e,i,n,a){let s=new zt;s.produceAnimationResult(t),s.bindViewAnmation(e,i,n,a)}}class jt extends TKView{constructor(t){super(),this.vm=t,this.animationMap=new Map,this.setupViews()}setupViews(){this.screenWidth=this.vm.callerContext.containerLimit.width,this.screenHeight=this.vm.callerContext.containerLimit.height,this.differenceLength=this.screenAdaptate(102)-this.screenHeight+896,this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0},this.throughHitTest=!0,this.setBubbleRainAnimation()}setBubbleRainAnimation(){this.setBubbleAnimation1(),this.setBubbleAnimation2(),this.setBubbleAnimation3(),this.setBubbleAnimation4(),this.setBubbleAnimation5(),this.setBubbleAnimation6(),this.setBubbleAnimation7(),this.setBubbleAnimation8(),this.setBubbleAnimation9(),this.setBubbleAnimation10(),this.setBubbleAnimation11(),this.setBubbleAnimation12()}screenAdaptate(t){return t*this.screenWidth/414}bindBubbleRainAnim(){let t=this.vm.getRedPacketUrl(),e=this.vm.getRedPacketIndustryIcon();T(e)&&(e="image/BubbleRainResources/icon_ksad_bubble_rain_double_eleven.png"),this.bubbles=new Array;for(let i=1;i<=12;i++){let n=new TKView,a=new TKImage,s=new TKImage,o=new TKImage,r=new TKImage,l=new H;if(l.template_show_type="bubble_redpacket_click",5==i?(l.template_show_type="bubble_gold_redpacket_click",n.style={position:"absolute",width:this.screenAdaptate(259),height:this.screenAdaptate(259),top:0,left:0,opacity:0},this.appendChild(n),s.style={position:"absolute",width:this.screenAdaptate(139),height:this.screenAdaptate(139),top:this.screenAdaptate(57),left:this.screenAdaptate(61)},L(s,"image/BubbleRainResources/icon_ksad_bubble_rain_golden_red_packet.png"),n.appendChild(s),o.style={position:"absolute",width:this.screenAdaptate(86),height:this.screenAdaptate(38),top:this.screenAdaptate(83),left:this.screenAdaptate(88)},R(o,e,500,(t=>{t||L(o,"image/BubbleRainResources/icon_ksad_bubble_rain_double_eleven.png")})),n.appendChild(o),a.style={position:"absolute",width:this.screenAdaptate(259),height:this.screenAdaptate(259),top:0,left:0},L(a,"image/BubbleRainResources/icon_ksad_bubble_rain_golden_bubble.png"),n.appendChild(a)):(n.style={position:"absolute",width:this.screenAdaptate(204),height:this.screenAdaptate(204),top:0,left:0,opacity:0},this.appendChild(n),T(t)?(s.style={position:"absolute",width:this.screenAdaptate(110),height:this.screenAdaptate(110),top:this.screenAdaptate(47),left:this.screenAdaptate(47)},L(s,"image/BubbleRainResources/icon_ksad_bubble_rain_red_packet.png"),n.appendChild(s),o.style={position:"absolute",width:this.screenAdaptate(72),height:this.screenAdaptate(32),top:this.screenAdaptate(111),left:this.screenAdaptate(68)},R(o,e,500,(t=>{t||L(o,"image/BubbleRainResources/icon_ksad_bubble_rain_double_eleven.png")})),n.appendChild(o)):(r.style={position:"absolute",width:this.screenAdaptate(152),height:this.screenAdaptate(152),top:this.screenAdaptate(26),left:this.screenAdaptate(26)},L(r,t),n.appendChild(r)),a.style={position:"absolute",width:this.screenAdaptate(204),height:this.screenAdaptate(204),top:0,left:0},L(a,"image/BubbleRainResources/icon_ksad_bubble_rain_bubble.png"),n.appendChild(a)),n.addEventListener("tap",(t=>{this.vm.convert(1,{x:0,y:0},k.BUBBLE_RAIN_CLICK,l)})),12==i){const t=this;Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_1"),n,"bubbleAnimation"+i+"_1",(e=>{if("end"==e){if(this.vm.isShowEnd)return;Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_2"),n,"bubbleAnimation"+i+"_2",(e=>{if("end"==e){if(this.vm.isShowEnd)return;Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_3"),n,"bubbleAnimation"+i+"_3",(e=>{if("end"==e){if(this.vm.isShowEnd)return;Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_4"),n,"bubbleAnimation"+i+"_4",(e=>{if("end"==e){if(this.vm.isShowEnd)return;t.onAnimateComplete&&t.onAnimateComplete()}}),"0.92 0.0 0.68 1.0")}}))}}),"0.51 0.57 0.69 0.94")}}),"0.0 0.0 0.0 0.99")}else Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_1"),n,"bubbleAnimation"+i+"_1",(t=>{if("end"==t){if(this.vm.isShowEnd)return;Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_2"),n,"bubbleAnimation"+i+"_2",(t=>{if("end"==t){if(this.vm.isShowEnd)return;Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_3"),n,"bubbleAnimation"+i+"_3",(t=>{if("end"==t){if(this.vm.isShowEnd)return;Jt.bindAnimation(this.animationMap.get("bubbleAnimation"+i+"_4"),n,"bubbleAnimation"+i+"_4",null,"0.92 0.0 0.68 1.0")}}))}}),"0.51 0.57 0.69 0.94")}}),"0.0 0.0 0.0 0.99");this.bubbles.push(n),this.appendChild(n)}}setBubbleAnimation1(){let t=new Array;t=[new Ht(1,.001),new Gt(90,.001),new Gt(-4.98,800),new Yt(.126*-this.screenWidth,-813-this.differenceLength,.001),new Yt(.118*-this.screenWidth,927-this.differenceLength,800)],this.animationMap.set("bubbleAnimation1_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(-4.98,.001),new Gt(1,900),new Yt(.118*-this.screenWidth,927-this.differenceLength,.001),new Yt(.116*-this.screenWidth,829-this.differenceLength,900)],this.animationMap.set("bubbleAnimation1_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(1,.001),new Gt(0,600),new Yt(.116*-this.screenWidth,829-this.differenceLength,.001),new Yt(.116*-this.screenWidth,835-this.differenceLength,600)],this.animationMap.set("bubbleAnimation1_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.116*-this.screenWidth,835-this.differenceLength,.001),new Yt(.116*-this.screenWidth,1211-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation1_4",n)}setBubbleAnimation2(){let t=new Array;t=[new Ht(1,.001),new Gt(90,.001),new Gt(-4.98,800),new Yt(.167*this.screenWidth,-425-this.differenceLength,.001),new Yt(.258*this.screenWidth,789-this.differenceLength,800)],this.animationMap.set("bubbleAnimation2_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(-4.98,.001),new Gt(1,900),new Yt(.258*this.screenWidth,789-this.differenceLength,.001),new Yt(.254*this.screenWidth,718-this.differenceLength,900)],this.animationMap.set("bubbleAnimation2_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(1,.001),new Gt(0,600),new Yt(.254*this.screenWidth,718-this.differenceLength,.001),new Yt(.254*this.screenWidth,724-this.differenceLength,600)],this.animationMap.set("bubbleAnimation2_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.254*this.screenWidth,724-this.differenceLength,.001),new Yt(.254*this.screenWidth,1281-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation2_4",n)}setBubbleAnimation3(){let t=new Array;t=[new Ht(1,.001),new Gt(-90,.001),new Gt(4.98,800),new Yt(.587*this.screenWidth,-706-this.differenceLength,.001),new Yt(.587*this.screenWidth,949-this.differenceLength,800)],this.animationMap.set("bubbleAnimation3_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(4.98,.001),new Gt(-1,900),new Yt(.587*this.screenWidth,949-this.differenceLength,.001),new Yt(.587*this.screenWidth,855-this.differenceLength,900)],this.animationMap.set("bubbleAnimation3_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(-1,.001),new Gt(0,600),new Yt(.587*this.screenWidth,855-this.differenceLength,.001),new Yt(.587*this.screenWidth,861-this.differenceLength,600)],this.animationMap.set("bubbleAnimation3_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.587*this.screenWidth,861-this.differenceLength,.001),new Yt(.589*this.screenWidth,1318-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation3_4",n)}setBubbleAnimation4(){let t=new Array;t=[new Ht(1,.001),new Gt(-90,.001),new Gt(4.98,800),new Yt(.71*this.screenWidth,-480-this.differenceLength,.001),new Yt(.71*this.screenWidth,719-this.differenceLength,800)],this.animationMap.set("bubbleAnimation4_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(4.98,.001),new Gt(-1,900),new Yt(.71*this.screenWidth,719-this.differenceLength,.001),new Yt(.71*this.screenWidth,654-this.differenceLength,900)],this.animationMap.set("bubbleAnimation4_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(-1,.001),new Gt(0,600),new Yt(.71*this.screenWidth,654-this.differenceLength,.001),new Yt(.71*this.screenWidth,660-this.differenceLength,600)],this.animationMap.set("bubbleAnimation4_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.71*this.screenWidth,660-this.differenceLength,.001),new Yt(.71*this.screenWidth,1008-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation4_4",n)}setBubbleAnimation5(){let t=this.screenAdaptate(130)-this.screenHeight+896,e=new Array;e=[new Ht(1,.001),new Gt(-90,.001),new Gt(4.98,800),new Yt(.08*-this.screenWidth,-641-t,.001),new Yt(.08*-this.screenWidth,604-t,800)],this.animationMap.set("bubbleAnimation5_1",e);let i=new Array;i=[new Ht(1,.001),new Gt(4.98,.001),new Gt(-1,900),new Yt(.08*-this.screenWidth,604-t,.001),new Yt(.08*-this.screenWidth,533-t,900)],this.animationMap.set("bubbleAnimation5_2",i);let n=new Array;n=[new Ht(1,.001),new Gt(-1,.001),new Gt(0,600),new Yt(.08*-this.screenWidth,533-t,.001),new Yt(.08*-this.screenWidth,538-t,600)],this.animationMap.set("bubbleAnimation5_3",n);let a=new Array;a=[new Ht(1,.001),new Gt(0,.001),new Yt(.08*-this.screenWidth,538-t,.001),new Yt(.08*-this.screenWidth,1210-t,2e3)],this.animationMap.set("bubbleAnimation5_4",a)}setBubbleAnimation6(){let t=new Array;t=[new Ht(1,.001),new Gt(90,.001),new Gt(-4.98,800),new Yt(.483*this.screenWidth,-287-this.differenceLength,.001),new Yt(.505*this.screenWidth,524-this.differenceLength,800)],this.animationMap.set("bubbleAnimation6_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(-4.98,.001),new Gt(1,900),new Yt(.505*this.screenWidth,524-this.differenceLength,.001),new Yt(.505*this.screenWidth,477-this.differenceLength,900)],this.animationMap.set("bubbleAnimation6_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(1,.001),new Gt(0,600),new Yt(.505*this.screenWidth,477-this.differenceLength,.001),new Yt(.505*this.screenWidth,481-this.differenceLength,600)],this.animationMap.set("bubbleAnimation6_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.505*this.screenWidth,481-this.differenceLength,.001),new Yt(.505*this.screenWidth,1578-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation6_4",n)}setBubbleAnimation7(){let t=new Array;t=[new Ht(1,.001),new Gt(90,.001),new Gt(-4.98,800),new Yt(.097*this.screenWidth,-776-this.differenceLength,.001),new Yt(.053*this.screenWidth,376-this.differenceLength,800)],this.animationMap.set("bubbleAnimation7_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(-4.98,.001),new Gt(1,900),new Yt(.053*this.screenWidth,376-this.differenceLength,.001),new Yt(.058*this.screenWidth,319-this.differenceLength,900)],this.animationMap.set("bubbleAnimation7_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(1,.001),new Gt(0,600),new Yt(.058*this.screenWidth,319-this.differenceLength,.001),new Yt(.058*this.screenWidth,325-this.differenceLength,600)],this.animationMap.set("bubbleAnimation7_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.058*this.screenWidth,325-this.differenceLength,.001),new Yt(.058*this.screenWidth,1470-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation7_4",n)}setBubbleAnimation8(){let t=new Array;t=[new Ht(1,.001),new Gt(90,.001),new Gt(-4.98,800),new Yt(.529*this.screenWidth,-581-this.differenceLength,.001),new Yt(.57*this.screenWidth,323-this.differenceLength,800)],this.animationMap.set("bubbleAnimation8_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(-4.98,.001),new Gt(1,900),new Yt(.57*this.screenWidth,323-this.differenceLength,.001),new Yt(.57*this.screenWidth,271-this.differenceLength,900)],this.animationMap.set("bubbleAnimation8_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(1,.001),new Gt(0,600),new Yt(.57*this.screenWidth,271-this.differenceLength,.001),new Yt(.57*this.screenWidth,275-this.differenceLength,600)],this.animationMap.set("bubbleAnimation8_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.57*this.screenWidth,275-this.differenceLength,.001),new Yt(.57*this.screenWidth,1442-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation8_4",n)}setBubbleAnimation9(){let t=new Array;t=[new Ht(1,.001),new Gt(-90,.001),new Gt(4.98,800),new Yt(.188*-this.screenWidth,-599-this.differenceLength,.001),new Yt(.188*-this.screenWidth,199-this.differenceLength,800)],this.animationMap.set("bubbleAnimation9_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(4.98,.001),new Gt(-1,900),new Yt(.188*-this.screenWidth,199-this.differenceLength,.001),new Yt(.188*-this.screenWidth,153-this.differenceLength,900)],this.animationMap.set("bubbleAnimation9_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(-1,.001),new Gt(0,600),new Yt(.188*-this.screenWidth,153-this.differenceLength,.001),new Yt(.188*-this.screenWidth,158-this.differenceLength,600)],this.animationMap.set("bubbleAnimation9_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.188*-this.screenWidth,158-this.differenceLength,.001),new Yt(.188*-this.screenWidth,1379-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation9_4",n)}setBubbleAnimation10(){let t=new Array;t=[new Ht(1,.001),new Gt(90,.001),new Gt(-4.98,800),new Yt(.312*this.screenWidth,-513-this.differenceLength,.001),new Yt(.312*this.screenWidth,136-this.differenceLength,800)],this.animationMap.set("bubbleAnimation10_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(-4.98,.001),new Gt(1,900),new Yt(.312*this.screenWidth,136-this.differenceLength,.001),new Yt(.312*this.screenWidth,99-this.differenceLength,900)],this.animationMap.set("bubbleAnimation10_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(1,.001),new Gt(0,600),new Yt(.312*this.screenWidth,99-this.differenceLength,.001),new Yt(.312*this.screenWidth,103-this.differenceLength,600)],this.animationMap.set("bubbleAnimation10_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.312*this.screenWidth,103-this.differenceLength,.001),new Yt(.312*this.screenWidth,1386-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation10_4",n)}setBubbleAnimation11(){let t=new Array;t=[new Ht(1,.001),new Gt(-90,.001),new Gt(4.98,800),new Yt(.036*-this.screenWidth,-425-this.differenceLength,.001),new Yt(.036*-this.screenWidth,-17-this.differenceLength,800)],this.animationMap.set("bubbleAnimation11_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(4.98,.001),new Gt(-1,900),new Yt(.036*-this.screenWidth,-17-this.differenceLength,.001),new Yt(.036*-this.screenWidth,-43-this.differenceLength,900)],this.animationMap.set("bubbleAnimation11_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(-1,.001),new Gt(0,600),new Yt(.036*-this.screenWidth,-43-this.differenceLength,.001),new Yt(.036*-this.screenWidth,-36-this.differenceLength,600)],this.animationMap.set("bubbleAnimation11_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.036*-this.screenWidth,-36-this.differenceLength,.001),new Yt(.036*-this.screenWidth,1566-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation11_4",n)}setBubbleAnimation12(){let t=new Array;t=[new Ht(1,.001),new Gt(90,.001),new Gt(-4.98,800),new Yt(.792*this.screenWidth,-146-this.differenceLength,.001),new Yt(.792*this.screenWidth,17-this.differenceLength,800)],this.animationMap.set("bubbleAnimation12_1",t);let e=new Array;e=[new Ht(1,.001),new Gt(-4.98,.001),new Gt(1,900),new Yt(.792*this.screenWidth,17-this.differenceLength,.001),new Yt(.792*this.screenWidth,7-this.differenceLength,900)],this.animationMap.set("bubbleAnimation12_2",e);let i=new Array;i=[new Ht(1,.001),new Gt(1,.001),new Gt(0,600),new Yt(.792*this.screenWidth,7-this.differenceLength,.001),new Yt(.792*this.screenWidth,10-this.differenceLength,600)],this.animationMap.set("bubbleAnimation12_3",i);let n=new Array;n=[new Ht(1,.001),new Gt(0,.001),new Yt(.792*this.screenWidth,10-this.differenceLength,.001),new Yt(.792*this.screenWidth,1526-this.differenceLength,2e3)],this.animationMap.set("bubbleAnimation12_4",n)}stopAllAnimation(){if(!T(this.bubbles))for(let t=0;t<this.bubbles.length;t++)this.bubbles[t].removeAllAnimation();this.removeAll()}}class Zt{constructor(t){this.currentPlaybackTimeMs=0,this.countDownTime=0,this.isTimerPaused=!1,this.mTimerInterval=500,this.mTotalStayTime=0,this.mTotalStayTime=t}setTotalPlayTime(t){t&&(this.mTotalStayTime=t)}setTimerInterval(t){t&&(this.mTimerInterval=t)}play(){this.startTimer()}paused(){this.isTimerPaused=!0}resume(){this.isTimerPaused=!1}stop(){this.stopTimer()}startTimer(){this.mTimer&&clearInterval(this.mTimer),this.mTimer=setInterval((()=>{this.isTimerPaused||(this.currentPlaybackTimeMs+=this.mTimerInterval,this.onCurrentPlaybackCallback&&this.onCurrentPlaybackCallback(this.currentPlaybackTimeMs),this.currentPlaybackTimeMs>this.mTotalStayTime?(this.stopTimer(),this.onFinishCallback&&this.onFinishCallback()):(this.currentPlaybackTimeMs,this.mTotalStayTime))}),this.mTimerInterval)}stopTimer(){this.mTimer&&clearInterval(this.mTimer)}}class $t extends TKView{constructor(t){super(),this.hasRemove=!1,this.vm=t,this.throughHitTest=!0,this.style={width:"100%",height:"100%",position:"absolute",top:0,left:0};const e=this;this.timePlay=new Zt(this.vm.getDelayTime()),this.timePlay.onFinishCallback=()=>{e.vm.hasShown=!0,e.vm.reportElementImpression(),e.setupViews()},dt().on(V,(t=>{this.vm.hasShown&&(this.vm.isShowEnd=!0)})),Nt(this.vm.$attrsPath.isShowEnd,(t=>{t&&this.onDismiss()})),Nt(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{switch(t){case"showEnd":this.timePlay.play();break;case"pageInvisiable":this.timePlay.paused();break;case"pageVisiable":this.timePlay.resume();break;case"hideEnd":this.vm.isShowEnd=!0}}))}setupViews(){const t=this;this.preHeatView=new Ot(this.vm,(()=>{t.rainFallView=new jt(this.vm),t.rainFallView.onAnimateComplete=()=>{t.onDismiss()},t.appendChild(this.rainFallView),t.rainFallView.bindBubbleRainAnim()})),this.appendChild(this.preHeatView)}onDismiss(){this.hasRemove||(this.hasRemove=!0,this.preHeatView&&this.preHeatView.stopAllAnimation(),this.rainFallView&&this.rainFallView.stopAllAnimation(),this.timePlay.stop(),this.style={visibility:"hidden"},this.onDismissComplete&&this.onDismissComplete())}}class qt extends TKView{constructor(t){super(),this.vm=t,this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute"},this.throughHitTest=!0,this.setPreloadData(),this.preloadView(),this.produceAnimation(),this.setupAction()}setPreloadData(){this.imageViews=new Array,this.animationMap=new Map,this.imageSrcs=new Array,this.levelsConfig=[8,10,9,7,5,4,13,12,11,6,3,2,1];for(let t=0;t<3;t++){let e="image/ksad-compose-image/GiftBox/ksad_gift_box_"+t+".png",i=this.vm.getGiftBoxIconUrls()[t];this.imageSrcs.push(T(i)?e:i)}}preloadView(){this.vm.callerContext.containerLimit.width;let t=this.vm.callerContext.containerLimit.height,e=this.vm.callerContext.containerLimit.width/375,i=[85*e,215.5*e,-28*e,100*e,-10*e,170*e,223*e,-59*e,27*e,-27*e,198.5*e,113.5*e,60*e],n=[0,0,0,1,0,0,1,0,1,0,2,2,0];3==this.vm.callerContext.adStyle||2==this.vm.callerContext.adStyle?S.isAndroid()?this.appendHeight=70*e/t:this.appendHeight=100*e/t:this.appendHeight=53*e/t;for(let a=0;a<13;a++){let t=new TKImage;t.style={position:"absolute",width:195*e,height:195*e,top:200*-e,left:i[a],right:0,opacity:1},R(t,this.imageSrcs[n[a]],500,(e=>{e||(this.hasLoadFailed=!0,L(t,"image/ksad-compose-image/GiftBox/ksad_gift_box_"+n[a]+".png"))})),this.imageViews.push(t)}}produceAnimation(){this.configGiftBoxAnimation1(),this.configGiftBoxAnimation2(),this.configGiftBoxAnimation3(),this.configGiftBoxAnimation4(),this.configGiftBoxAnimation5(),this.configGiftBoxAnimation6(),this.configGiftBoxAnimation7(),this.configGiftBoxAnimation8(),this.configGiftBoxAnimation9(),this.configGiftBoxAnimation10(),this.configGiftBoxAnimation11(),this.configGiftBoxAnimation12(),this.configGiftBoxAnimation13()}configGiftBoxAnimation1(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(0,500),new Gt(-18,600),new Yt(0,0,0),new Yt(0,1.025*t+t*this.appendHeight,500)],this.animationMap.set("animation0",e)}configGiftBoxAnimation2(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(-45,0),new Gt(-45,700),new Gt(-60,800),new Yt(0,0,500),new Yt(0,1.024*t+t*this.appendHeight,700)],this.animationMap.set("animation1",e)}configGiftBoxAnimation3(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(-60,0),new Gt(-60,750),new Gt(-40,850),new Yt(0,0,550),new Yt(0,1.034*t+t*this.appendHeight,750)],this.animationMap.set("animation2",e)}configGiftBoxAnimation4(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(-100,0),new Yt(0,0,600),new Yt(0,.93*t+t*this.appendHeight,750),new Yt(0,.91*t+t*this.appendHeight,800),new Yt(0,.945*t+t*this.appendHeight,850)],this.animationMap.set("animation3",e)}configGiftBoxAnimation5(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(-100,0),new Gt(-100,800),new Gt(-85,850),new Yt(0,0,600),new Yt(0,.95*t+t*this.appendHeight,800)],this.animationMap.set("animation4",e)}configGiftBoxAnimation6(){let t=this.vm.callerContext.containerLimit.height,e=new Array,i=new Gt(-15,0),n=new Yt(0,0,800);e=[i,n,n,new Yt(0,.925*t+t*this.appendHeight,1050)],this.animationMap.set("animation5",e)}configGiftBoxAnimation7(){let t=this.vm.callerContext.containerLimit.width,e=this.vm.callerContext.containerLimit.height,i=new Array;i=[new Gt(35,0),new Gt(35,1050),new Gt(105,1150),new Yt(0,0,850),new Yt(0,.825*e+e*this.appendHeight,1050),new Yt(.1*t,.925*e+e*this.appendHeight,1150)],this.animationMap.set("animation6",i)}configGiftBoxAnimation8(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Yt(0,0,900),new Yt(0,.92*t+t*this.appendHeight,1200)],this.animationMap.set("animation7",e)}configGiftBoxAnimation9(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(-35,0),new Gt(-35,1400),new Gt(-25,1500),new Yt(0,0,1100),new Yt(0,.835*t+t*this.appendHeight,1400)],this.animationMap.set("animation8",e)}configGiftBoxAnimation10(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(-60,0),new Gt(-60,1850),new Gt(-40,1950),new Yt(0,0,1650),new Yt(0,.777*t+t*this.appendHeight,1850)],this.animationMap.set("animation9",e)}configGiftBoxAnimation11(){let t=this.vm.callerContext.containerLimit.width,e=this.vm.callerContext.containerLimit.height,i=new Array;i=[new Gt(70,0),new Gt(70,1950),new Gt(95,2150),new Yt(0,0,1650),new Yt(0,.803*e+e*this.appendHeight,1950),new Yt(.05*t,.823*e+e*this.appendHeight,2150)],this.animationMap.set("animation10",i)}configGiftBoxAnimation12(){let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(8,0),new Yt(0,0,1650),new Yt(0,.795*t+t*this.appendHeight,1900)],this.animationMap.set("animation11",e)}configGiftBoxAnimation13(){this.vm.callerContext.containerLimit.width;let t=this.vm.callerContext.containerLimit.height,e=new Array;e=[new Gt(-15,0),new Gt(-15,2600),new Gt(-40,2750),new Yt(0,0,2400),new Yt(0,.682*t+t*this.appendHeight,2600),new Yt(.02*-t,.702*t+t*this.appendHeight,2750)],this.animationMap.set("animation12",e)}setupAction(){const t=this;for(let e=0;e<this.imageViews.length;e++)this.appendChild(this.imageViews[this.levelsConfig[e]-1]),this.imageViews[this.levelsConfig[e]-1].addEventListener("tap",(e=>{this.hasClicked=!0,t.clickCallback&&t.clickCallback(),t.setVisibility("gone")}))}show(){console.log("giftbox multibox show"+this.imageViews.length);for(let e=0;e<this.imageViews.length;e++)Jt.bindAnimation(this.animationMap.get("animation"+(this.levelsConfig[e]-1)),this.imageViews[this.levelsConfig[e]-1],"showAnimation"+e);const t=this;setTimeout((()=>{t.dismiss()}),this.vm.getGiftBoxShowTime()-1500)}dismiss(){if(this.hasClicked||this.hasDismissed)return;let t=new Ht(1,0),e=new Ht(0,150);const i=this;Jt.bindAnimation([t,e],this,"dismissAnimation",(t=>{i.hasClicked||i.hasDismissed||"end"==t&&(i.autoDismissCallback&&i.autoDismissCallback(),i.hasDismissed=!0,i.setVisibility("gone"),console.log("giftbox multibox dismiss"))}))}}class Qt extends TKView{constructor(t){super(),this.vm=t,this.setupViews(),this.setupData(),this.setupAction()}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",visibility:"hidden"},this.throughHitTest=!0,this.guideView=new TKView,this.guideView.style={justifyContent:"center",alignItems:"center",opacity:0},this.appendChild(this.guideView),this.guideLabel=new TKText,this.guideLabel.style={height:36,paddingLeft:20,paddingRight:20,backgroundColor:"#0D0000B2",textAlign:"center",color:"#FFFFFF",borderRadius:18,fontWeight:"bold"},this.guideView.appendChild(this.guideLabel),this.guideImageView=new TKImage,this.guideImageView.style={width:12,height:6},this.guideView.appendChild(this.guideImageView),this.giftBoxImage=new TKImage,this.giftBoxImage.style={marginTop:-7,width:195,height:195,opacity:0},this.appendChild(this.giftBoxImage)}setupData(){let t="image/ksad-compose-image/GiftBox/ksad_gift_box_0.png",e=T(this.vm.getGiftBoxIconUrls()[0])?t:this.vm.getGiftBoxIconUrls()[0];R(this.giftBoxImage,e,500,(e=>{e||(L(this.giftBoxImage,t),this.hasLoadFailed=!0)})),this.guideLabel.setText(this.vm.getSingleBoxGuideText()),L(this.guideImageView,"icon_ksad_gift_box_guide_arrow.png")}setupAction(){const t=this;this.giftBoxImage.addEventListener("tap",(e=>{t.hasClicked=!0,t.clickCallback&&t.clickCallback(),t.dismiss()}))}autoDismiss(){this.hasClicked||(this.autoDismissCallback&&this.autoDismissCallback(),this.dismiss())}startShowAnimation(){const t=this,e=Dt(this.giftBoxImage,300,!0);e.on("end",(()=>{t.startShakeAnimation()})),this.giftBoxImage.addAnimation(e,"giftBoxShowAnimation");const i=Dt(this.guideView,300,!0);this.guideView.addAnimation(i,"guideShowAnimation")}startShakeAnimation(){const t=this,e=new TKKeyframeAnimation;e.setAnimations([()=>(t.giftBoxImage.style={transform:{rotate:20}},.16),()=>(t.giftBoxImage.style={transform:{rotate:0}},.32),()=>(t.giftBoxImage.style={transform:{rotate:-20}},.48),()=>(t.giftBoxImage.style={transform:{rotate:0}},.64),()=>(t.giftBoxImage.style={transform:{rotate:20}},.8),()=>(t.giftBoxImage.style={transform:{rotate:0}},1)]),e.duration=900,e.timingFunction="linear",e.on("end",(()=>{t.startHideAnimation()})),this.giftBoxImage.addAnimation(e,"shakeAnimation")}startHideAnimation(){const t=this,e=xt(this.giftBoxImage,200,!0);e.on("end",(()=>{t.autoDismiss()})),this.giftBoxImage.addAnimation(e,"giftBoxHideAnimation");const i=xt(this.guideView,200,!0);this.guideView.addAnimation(i,"guideHideAnimation")}show(){console.log("giftbox singlebox show"),this.style={visibility:"visible"},this.startShowAnimation()}dismiss(){this.style={visibility:"hidden"},this.setVisibility("gone")}}class te extends TKView{constructor(t){super(),this.lottieLoadFailed=!1,this.vm=t,this.setupViews(),this.setupData()}setupViews(){this.style={width:"100%",height:"100%",justifyContent:"center",alignItems:"center",position:"absolute",visibility:"hidden"},this.throughHitTest=!0;const t=this,e=Math.ceil(812*Tachikoma.env.deviceWidth/375);S.supportMinimumTKVersion("5.0.0")&&(this.couponView=new TKLottieImageView,this.couponView.style={width:"100%",height:e,opacity:0},this.couponView.enabled=!1,this.couponView.setLoop(!1),this.couponView.onAnimationLoaded((e=>{e||(console.log("giftbox transition load animation failed"),t.lottieLoadFailed=!0)})),this.couponView.onAnimationEnd((()=>{t.convert()})),this.appendChild(this.couponView))}setupData(){this.couponView&&this.couponView.setUri(this.vm.getClickAnimationLottieUrl())}startShowAnimation(){this.style={visibility:"visible"},this.startCouponViewFallAnimation()}startCouponViewFallAnimation(){this.couponView&&(this.couponView.style={opacity:1},this.couponView.play())}convert(){this.hasConverted||(this.hasConverted=!0,this.vm.reportGiftBoxClick())}show(){this.vm.enableShowClickAnimation()&&!this.lottieLoadFailed?(console.log("giftbox transition show"),this.startShowAnimation(),setTimeout((()=>{this.convert()}),2300)):this.convert()}}class ee{static reportGiftBoxShowEvent(t){try{pt({category:"ad_client_apm_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:t?.1:.001,suffixRatio:"",event_id:"ad_huge_scene_render_performance",primaryKey:"status",type:"OTHER",msg:{load_status:t?2:1,scene:"gift_box",status:1}})}catch(e){}}static reportGiftBoxClickEvent(t){try{pt({category:"ad_client_apm_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:t?.1:.001,suffixRatio:"",event_id:"ad_huge_scene_render_performance",primaryKey:"status",type:"OTHER",msg:{load_status:t?2:1,scene:"gift_box",status:2}})}catch(e){}}}class ie extends TKView{constructor(t){super(),this.vm=t,this.setupViews();const e=this;Nt(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"showEnd"===t&&(2!=e.vm.callerContext.adStyle&&3!=e.vm.callerContext.adStyle||e.startDelayTimerIfNeeded()),"pageVisiable"===t&&e.startDelayTimerIfNeeded(),"pageInvisiable"===t&&e.stopDelayTimerIfNeeded()})),dt().on(V,(t=>{setTimeout((()=>{console.log("giftbox dismiss"),e.transitionView&&(e.transitionView.hasConverted=!0),e.dismissCallback&&e.dismissCallback()}),500)}))}setupViews(){this.style={width:"100%",height:"100%"},this.throughHitTest=!0;const t=this;this.singleBoxView=new Qt(this.vm),this.singleBoxView.autoDismissCallback=()=>{console.log("giftbox singlebox auto dissmiss"),t.multiBoxView&&t.multiBoxView.show()},this.singleBoxView.clickCallback=()=>{console.log("giftbox singlebox click"),t.convert()},this.appendChild(this.singleBoxView),this.multiBoxView=new qt(this.vm),this.multiBoxView.clickCallback=()=>{console.log("giftbox multibox click"),t.convert()},this.multiBoxView.autoDismissCallback=()=>{t.dismissCallback&&t.dismissCallback()},this.appendChild(this.multiBoxView),this.transitionView=new te(this.vm),this.appendChild(this.transitionView)}show(){console.log("giftbox show"),this.vm.hasShown=!0,this.vm.showMultiBoxViewDirectly()?this.multiBoxView&&this.multiBoxView.show():this.singleBoxView&&this.singleBoxView.show(),this.vm.reportGiftBoxImpression();let t=this.singleBoxView.hasLoadFailed||this.multiBoxView.hasLoadFailed;ee.reportGiftBoxShowEvent(t)}hide(){this.style={visibility:"gone"},this.dismissCallback&&this.dismissCallback()}convert(){this.transitionView&&this.transitionView.show();let t=this.singleBoxView.hasLoadFailed||this.multiBoxView.hasLoadFailed;ee.reportGiftBoxClickEvent(t)}startDelayTimerIfNeeded(){if(this.vm.hasShown)return;if(this.vm.getGiftBoxDelayTime()<=0)return void this.show();if(this.delayTimer)return void this.delayTimer.resume();this.delayTimer=new Zt(this.vm.getGiftBoxDelayTime()),this.delayTimer.play();const t=this;this.delayTimer.onFinishCallback=()=>{t.show()}}stopDelayTimerIfNeeded(){this.vm.hasShown||this.delayTimer&&this.delayTimer.paused()}}class ne extends At{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),Pt(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{this.vm.updateShowRedPacketRain(t)})),Pt(this.vm,this.vm.$attrsPath.showRedPacketRain,(t=>{t&&this.redPackView&&this.redPackView.show()})),Nt(this.vm.$attrsPath.callerContext.lifeStatus,(t=>{"pageVisiable"==t&&this.festivalPendantView&&this.festivalPendantView.restartGuidanceImageMoveAnimationIfNeeded(),"hideEnd"==t&&this.festivalPendantView&&this.festivalPendantView.stopActionAnimation()})),Pt(this.vm,this.vm.$attrsPath.hasShowPlayend,(t=>{t&&(this.festivalPendantView&&(this.festivalPendantView.clearTimeoutIfConverted(),this.festivalPendantView.removePendantClickAnimViewIfNeeded(this),this.festivalPendantView.setVisibility("hidden")),this.redPackView&&this.redPackView.hide(),this.bubbleRainView&&(this.vm.bubbleRainViewModel.isShowEnd=!0),this.giftBoxView&&this.giftBoxView.hide())})),Pt(this.vm,this.vm.$attrsPath.festivalPendantBottom,(t=>{if(!this.vm.isValidFestivalPendantBottom())return;const e=this.vm.callerContext.containerLimit.height-this.vm.festivalPendantViewModel.getPendantSize().height-t;this.festivalPendantView&&(this.festivalPendantView.style={top:this.vm.isNeedNewStyleTop()?e-60:e,visibility:"visible"})})),Pt(this.vm,this.vm.$attrsPath.adHasConvert,(t=>{t&&(this.redPackView&&this.redPackView.hide(!0),this.festivalPendantView&&this.festivalPendantView.clearTimeoutIfConverted())})))}setupViews(){if(this.style={width:"100%",height:"100%"},this.throughHitTest=!0,this.vm.enableShowGiftBoxView())this.createGiftBoxView();else if(this.vm.enableBubblerainView())this.bubbleRainView=new $t(this.vm.bubbleRainViewModel),this.bubbleRainView.onDismissComplete=()=>{this.removeChild(this.bubbleRainView)},this.appendChild(this.bubbleRainView);else if(this.vm.enableShowRedPacketView()){this.redPackView=new Bt(this.vm.redPacketViewModel),this.appendChild(this.redPackView);const t=this;this.vm.redPacketViewModel.dismissCallback=()=>{t.vm.enableShowFestivalPendantView()&&t.createFestivalPendantView()}}else this.vm.enableShowFestivalPendantView()&&this.createFestivalPendantView()}createFestivalPendantView(){this.festivalPendantView||(this.festivalPendantView=new Kt(this.vm.festivalPendantViewModel),this.festivalPendantView.style={position:"absolute",visibility:"hidden"},this.appendChild(this.festivalPendantView),this.festivalPendantView.createPendantClickAnimViewIfNeeded(this),setTimeout((()=>{this.vm.isValidFestivalPendantBottom()||this.vm.getFestivalPendantBottom()}),this.vm.enableShowRedPacketView()?0:500),setTimeout((()=>{this.vm.isValidFestivalPendantBottom()||this.vm.getFestivalPendantBottom()}),1500))}createGiftBoxView(){if(this.giftBoxView)return;const t=this;this.giftBoxView=new ie(this.vm.giftBoxViewModel),this.giftBoxView.dismissCallback=()=>{t.removeChild(this.giftBoxView)},this.appendChild(this.giftBoxView)}}class ae extends Et{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>se(t,e)})}getData(t){}}function se(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(i,n)=>"string"!=typeof n||"function"==typeof i[n]||0==n.indexOf("$")?Reflect.get(i,n):se(t,e+"."+n)})}class oe extends ae{constructor(t,e,i,n=1){super(),this.paramValid=!1,this.animMinTime=50,this.dismissCallbackCompleted=!1,this.lastAnimedArray=[],this.containerSize=t,this.adInfo=e,this.adStyle=i,this.animType=n,this.currentRandomParams=this.getRedPacketRandomParam(),this.initLastAnimedArray(),this.redPacketInfo=2==n?rt(this.adInfo,this.adStyle):st(this.adInfo,this.adStyle)}initLastAnimedArray(){this.lastAnimedArray=[5,2]}getAnimType(){return this.animType}getRowNum(){return 2==this.animType?5:3}getAnimMinTime(){return this.animMinTime}getOriginShowTime(){let t=6;return!T(this.redPacketInfo)&&!T(this.redPacketInfo.showTime)&&this.redPacketInfo.showTime>0&&(t=this.redPacketInfo.showTime),t}getScaleType(t,e){return this.currentRandomParams[e*this.getRowNum()+t].scaleType}dismissCallbackOnlyOnce(){this.dismissCallbackCompleted||(this.dismissCallbackCompleted=!0,this.dismissCallback&&this.dismissCallback())}enableShowRedPacketView(){return!T(this.redPacketInfo)}getRedPacketViewDelayShowTime(){return T(this.redPacketInfo)?1:this.redPacketInfo.delayTime}isShowRedPacketViewRightNow(){return!T(this.redPacketInfo)&&0==this.redPacketInfo.delayTime}checkParam(){return!T(this.redPacketInfo)&&(!T(t=this.redPacketInfo.iconUrls)&&0!=t.length&&(this.paramValid=!0,!0));var t}isParamValid(){return this.paramValid}getShowTime(t){let e=this.getOriginShowTime();return 2==this.animType||T(this.currentRandomParams[t].iconShowTime)||(e=this.currentRandomParams[t].iconShowTime*this.getTimeCoefficient()),e}getIconDelayTime(t){return Math.floor(this.currentRandomParams[t].delayTime*this.getTimeCoefficient())*this.animMinTime}getDelayTime(){let t=1;return T(this.redPacketInfo)||T(this.redPacketInfo.delayTime)||(t=this.redPacketInfo.delayTime),t}getTimeCoefficient(){return 2==this.animType?1:this.getOriginShowTime()/4*1.1}getRotateTimeCoefficient(){return this.getOriginShowTime()/6}getRotateAnimDelayTime(t){return 2==this.animType||T(this.currentRandomParams[t].rotateDelayTime)?-1:Math.floor(this.currentRandomParams[t].rotateDelayTime*this.getRotateTimeCoefficient())*this.getAnimMinTime()}isCanShowRotateAnim(t){return-1!=this.getRotateAnimDelayTime(t)}getLastAnimIconIndex(){return this.lastAnimedArray[this.currentRandomParamIndex]}getAnimedCount(){return 2==this.animType?15:9}isCanClick(){return this.redPacketInfo.clickSwitch}getRedPacketIconUrl(){let t=Math.floor(Math.random()*this.redPacketInfo.iconUrls.length);return this.redPacketInfo.iconUrls[t]}reportRedPacketImpression(){if(1!=this.animType)return;let t=new H;t.universe_feature_freq=1;let e={elementType:201,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};z.sendLog(i)}convert(t,e,i,n=null,a){wt.convertIfNeeded(0,this.adInfo,t,e,i,n,a)}getRedPacketRandomParam(){let t=[];return t=2==this.animType?[[{delayTime:0,scaleType:.85},{delayTime:4.5,scaleType:.7},{delayTime:8.25,scaleType:.7},{delayTime:13.5,scaleType:1},{delayTime:18,scaleType:.7},{delayTime:2.25,scaleType:.7},{delayTime:7.5,scaleType:1},{delayTime:11.25,scaleType:.85},{delayTime:16.5,scaleType:1},{delayTime:21,scaleType:.85},{delayTime:0,scaleType:.85},{delayTime:4.5,scaleType:.7},{delayTime:9,scaleType:.7},{delayTime:14.25,scaleType:.85},{delayTime:18.75,scaleType:.85}]]:[[{delayTime:5,scaleType:.7,iconShowTime:2},{delayTime:15,rotateDelayTime:10,scaleType:.85,iconShowTime:2},{delayTime:22,scaleType:1,iconShowTime:2},{delayTime:0,rotateDelayTime:16,scaleType:1,iconShowTime:2.3},{delayTime:8,scaleType:.85,iconShowTime:2.5},{delayTime:20,scaleType:.7,iconShowTime:2.5},{delayTime:3,scaleType:.7,iconShowTime:1.9},{delayTime:11,scaleType:.7,iconShowTime:1.9},{delayTime:22,rotateDelayTime:13,scaleType:.85,iconShowTime:1.95}],[{delayTime:0,rotateDelayTime:12,scaleType:1,iconShowTime:2.3},{delayTime:10,scaleType:.85,iconShowTime:2.3},{delayTime:20,rotateDelayTime:16,scaleType:1,iconShowTime:2.7},{delayTime:2,scaleType:.7,iconShowTime:2},{delayTime:12,scaleType:1,iconShowTime:2.3},{delayTime:22,scaleType:.7,iconShowTime:2.1},{delayTime:0,scaleType:.85,iconShowTime:1.8},{delayTime:6,rotateDelayTime:18,scaleType:.85,iconShowTime:2.4},{delayTime:21,scaleType:1,iconShowTime:2.4}]],this.currentRandomParamIndex=Math.floor(Math.random()*t.length),t[this.currentRandomParamIndex]}}class re extends ae{constructor(t,e,i,n){super(),this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.setupData(),this.setupViewModels()}setupData(){this.pendantInfo=function(t,e){let i=null,n=ht(t,e);return n&&(i=ot(t,n)),i}(this.adInfo,this.adStyle),this.pendantViewAnimInfo=rt(this.adInfo,this.adStyle)}setupViewModels(){this.pendantAnimViewModel=new oe(this.containerLimit,this.adInfo,this.adStyle,2)}updateLifeStatus(t){this.lifeStatus=t}enableShowPendant(){return!T(this.getPendantInfo())&&!T(this.getPendantImageUrl())}getPendantInfo(){return this.pendantInfo}getPendantViewAnimInfo(){return this.pendantViewAnimInfo}getPendantTitleText(){try{return this.pendantInfo.guideMsg}catch(t){}return""}getPendantImageUrl(){try{return this.pendantInfo.icon}catch(t){}return""}enableShowGuidanceImage(){try{return 1==this.pendantInfo.gestureType}catch(t){}return!1}getPendantType(){try{return this.pendantInfo.type}catch(t){}return 0}getPendantSize(){return 13==this.adStyle?{width:140,height:140}:{width:184,height:170}}getPendantImageWH(){return 13==this.adStyle?105:150}getPendantTitleFontSize(){return 13==this.adStyle?12:16}getPendantTitleMarginLR(){return this.adStyle,8}getGuidanceImageWH(){return 13==this.adStyle?43:63}getGuidanceImageMarginTop(){return 13==this.adStyle?-this.getGuidanceImageWH()-10:-this.getGuidanceImageWH()-12}getGuidanceImageMarginLeft(){return 13==this.adStyle?this.getGuidanceImageWH()+34:this.getGuidanceImageWH()+42}enableClickPendant(){return it(this.adInfo,1)}reportPendantImpression(){let t=new H;t.template_show_type=this.getPendantTemplateShowType(),t.universe_feature_freq=2;let e={elementType:13,clientExtData:JSON.stringify(t)},i={actionType:140,payload:JSON.stringify(e)};z.sendLog(i)}reportPendantClick(){let t=new H;t.template_show_type=this.getPendantTemplateShowType(),wt.convertIfNeeded(1,this.adInfo,1,{x:0,y:0},k.PLAY_END_GIFT_CLICK,t)}getPendantTemplateShowType(){return"pendant_active_red_packet"+this.getPendantType()}enableShowPendantClickAnim(){return!T(this.pendantViewAnimInfo)&&!T(this.pendantViewAnimInfo.iconUrls)&&this.pendantViewAnimInfo.iconUrls.length>0}getPendantClickAnimDuration(){return 1300}}class le extends ae{constructor(t){super(),this.hasShown=!1,this.isShowEnd=!1,this.callerContext=t,this.bubbleRainInfo=function(t,e){let i,n=ht(t,e);if(n){let e=tt(t,n);if(null==e)return;i=JSON.parse(e.data).bubbleRainInfo}return i}(this.callerContext.adInfo,this.callerContext.adStyle)}enableShowBubbleRainView(){return 1!=this.callerContext.screenOrientation&&!T(this.bubbleRainInfo)}enableCountDown(){return 2==this.callerContext.adStyle||3==this.callerContext.adStyle}isSplash(){return 4==this.callerContext.adStyle}getBubbleActionDes(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.bubbleActionDescription)&&void 0!==e?e:"立即开启大促"}getIndustryTopIcon(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.industryTopIcon)&&void 0!==e?e:""}getRedPacketUrl(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.redPacketUrl)&&void 0!==e?e:""}getSpecialRedPacketUrl(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.specialRedPacketUrl)&&void 0!==e?e:""}getRedPacketIndustryIcon(){var t,e;return null!==(e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.redPacketIndustryIcon)&&void 0!==e?e:"icon_ksad_bubble_rain_double_eleven.png"}getDelayTime(){var t;const e=null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.delayTime;return e>0?e:0}getShowTime(){var t;return null===(t=this.bubbleRainInfo)||void 0===t?void 0:t.showTime}reportElementImpression(){let t=new H;t.universe_feature_freq=20;let e={elementType:238};e.clientExtData=JSON.stringify(t),wt.log(140,{x:0,y:0},e)}convert(t,e,i,n=null,a){wt.convertIfNeeded(0,this.callerContext.adInfo,t,e,i,n,a)}}class he extends ae{constructor(t){super(),this.hasShown=!1,this.callerContext=t,this.setupData()}setupData(){this.giftBoxInfo=lt(this.callerContext.adInfo,this.callerContext.adStyle)}isVertical(){return 0==this.callerContext.screenOrientation||T(this.callerContext.screenOrientation)}getGiftBoxInfo(){return this.giftBoxInfo}getGiftBoxIconUrls(){try{return this.giftBoxInfo.iconUrls}catch(t){}return[]}getGiftBoxDelayTime(){try{return this.giftBoxInfo.delayTime}catch(t){}return 1e3}getGiftBoxShowTime(){try{return this.giftBoxInfo.showTime}catch(t){}return 6e3}enableShowClickAnimation(){let t=!1;try{t=this.giftBoxInfo.showClickAnimation}catch(e){}return T(this.getClickAnimationLottieUrl())&&(t=!1),S.supportMinimumTKVersion("5.0.0")||(t=!1),t}getClickAnimationLottieUrl(){let t="";try{t=this.giftBoxInfo.clickAnimationLottieUrl}catch(e){}return T(t)&&(t=S.isAndroid()?"image/ksad-compose-image/GiftBox/ksad_lottie_gift_box_transition_android.json":"image/ksad-compose-image/GiftBox/ksad_lottie_gift_box_transition_ios.json"),t}getSingleBoxGuideText(){return"点击盒子，领取惊喜"}enableShowGiftBox(){const t=this.isVertical()&&!T(this.giftBoxInfo)&&!T(this.getGiftBoxIconUrls())&&this.getGiftBoxIconUrls().length>0;return console.log("giftbox enableshow"+t),t}showMultiBoxViewDirectly(){return!0}reportGiftBoxClick(){wt.convertIfNeeded(1,this.callerContext.adInfo,1,{x:0,y:0},k.SURPRISE_BOX_CLICK)}reportGiftBoxImpression(){let t=new H;t.universe_feature_freq=21;let e={elementType:237,clientExtData:JSON.stringify(t)};wt.log(140,null,e)}}class ce extends ae{constructor(){super(...arguments),this.festivalPendantBottom=0,this.currentPlaybackTime=0,this.showRedPacketRain=!1,this.adHasConvert=!1,this.hasShowPlayend=!1}checkDataValid(){return!!this.callerContext.adInfo}setDatas(){this.enableShowRedPacketView()&&this.isShowRedPacketViewRightNow()&&this.updateShowRedPacketRain(0),dt().on(V,(t=>{this.adHasConvert=!0}))}createViewModels(){this.redPacketViewModel=new oe(this.callerContext.containerLimit,this.callerContext.adInfo,this.callerContext.adStyle),this.festivalPendantViewModel=new re(this.callerContext.adInfo,this.callerContext.adStyle,this.callerContext.configInfo,this.callerContext.containerLimit),this.bubbleRainViewModel=new le(this.callerContext),this.giftBoxViewModel=new he(this.callerContext)}updateShowRedPacketRain(t){this.enableShowRedPacketView()&&(this.showRedPacketRain=t>=this.redPacketViewModel.getRedPacketViewDelayShowTime())}enableInitTopfloorContainer(){return this.enableShowGiftBoxView()||this.enableBubblerainView()||this.enableShowRedPacketView()||this.enableShowFestivalPendantView()}enableBubblerainView(){return this.bubbleRainViewModel.enableShowBubbleRainView()}enableShowRedPacketView(){return this.redPacketViewModel.enableShowRedPacketView()}isShowRedPacketViewRightNow(){return this.redPacketViewModel.isShowRedPacketViewRightNow()}isVertical(){return 0==this.callerContext.screenOrientation}enableShowFestivalPendantView(){return this.isVertical()&&this.festivalPendantViewModel.enableShowPendant()}enableShowGiftBoxView(){return this.giftBoxViewModel.enableShowGiftBox()}getFestivalPendantBottom(){}isNeedNewStyleTop(){return this.isAdForLive()&&this.isAddLiveButton()&&S.isAndroid()&&this.isVertical()&&2==this.callerContext.adStyle}isAdForLive(){return nt(this.callerContext.adInfo)}isAddLiveButton(){return 1==this.callerContext.adInfo.adBaseInfo.universeLiveStyle}isValidFestivalPendantBottom(){return!this.hasShowPlayend&&!(this.festivalPendantBottom<=0||this.festivalPendantBottom>=this.callerContext.containerLimit.height-this.festivalPendantViewModel.getPendantSize().height)}}class de{constructor(t,e,i,n,a,s){this.lifeStatus="none",this.adInfo=t,this.adStyle=e,this.configInfo=i,this.containerLimit=n,this.screenOrientation=a,this.originContainerLimit=s}getOriginWidth(){return this.originContainerLimit?this.originContainerLimit.width:0}getOriginHeight(){return this.originContainerLimit?this.originContainerLimit.height:0}}class me extends de{}class ue extends ce{getData(t){let e=[];e.push(z.getKsAdDataAsync()),e.push(z.getDeviceInfoAsync()),e.push(z.getKsAdConfigAsync()),e.push(z.getContainerLimitAsync()),e.push(z.getScreenOrientationAsync()),Promise.all(e).then((e=>{const i=e[0].data,n=e[1].data,a=e[2].data,s=e[3].data,o=e[4].data;try{const t=i.impAdInfo[0].adInfo[0],e=i.impAdInfo[0].adStyle,r=o.screenOrientation;h(n),this.callerContext=new me(t,e,a,s,r)}catch(r){return void(t&&t(!1))}this.createViewModels(),this.registerBridges(),this.setDatas(),t&&t(!0)}))}registerBridges(){z.registerVideoProgressListener((t=>{if(t.data.failed)this.playFailed=!0;else if(t.data.finished)this.playFailed=!1;else{const e=t.data.currentTime;this.currentPlaybackTime=e}})),z.registerLifecycleListener((t=>{if(t.result&&t.data){const e=t.data.lifeStatus;e!==this.callerContext.lifeStatus&&(this.callerContext.lifeStatus=e)}})),S.supportMinimumVersion("3.3.20","3.3.27")&&z.registerSceneChangeListener((t=>{t.data&&1==t.data.scene&&(this.hasShowPlayend=!0)}))}getFestivalPendantBottom(){var t;S.supportMinimumTKVersion("4.0.8")&&(t=t=>{let e=t.data&&t.data.height;if(T(e)&&(e=0),e<=0||e>=this.callerContext.containerLimit.height-this.festivalPendantViewModel.getPendantSize().height){if(!this.hasGotFestivalPendantBottom)return void(this.hasGotFestivalPendantBottom=!0);this.festivalPendantBottom=(this.callerContext.containerLimit.height-this.festivalPendantViewModel.getPendantSize().height)/2}else this.hasGotFestivalPendantBottom||(this.hasGotFestivalPendantBottom=!0),this.festivalPendantBottom=e},z.callNativeWithCallback("getBottomLimitHeight",null,t))}}(new class extends Ct{constructor(){super(),this.vm=new ue}setupViews(){this.contentView=new ne(this.vm),this.rootView.throughHitTest=!0,this.rootView.appendChild(this.contentView)}render(){if(this.renderCalled)return!1;this.renderCalled=!0;try{this.vm.getData((t=>{if(t)try{this.setupViews(),Tachikoma.render(this.rootView),this.updateRenderStatus(1,"")}catch(e){this.updateRenderStatus(0,g(e))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,g(t))}return!0}}).render()})();
//# sourceMappingURL=ksad-video-topfloor.136.js.map