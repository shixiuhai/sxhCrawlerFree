(()=>{"use strict";var t=null,e=null;function i(e){t=e}function n(t){return t instanceof Error?t.stack?t.stack:t.message:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function a(){return!l(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function s(t){return"string"==typeof t&&t.length>0}function o(){return t?t.SDKVersion:Tachikoma.env.SDKVersion}function r(){return t?t.sdkType:Tachikoma.env.sdkType}function l(t){return null===t||null==t||""===t}function h(t){if(t)for(const i in t){if("object"==typeof t[i]&&!i.includes("$"))try{t[i].nativeID||(t[i].nativeID=i),h(t[i])}catch(e){}}}class d{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||d.supportMinimumTKVersion("5.0.4")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let i=t.split("."),n=e.split("."),a=Math.max(i.length,n.length);for(var s=0;s<a;s++){let t=Number(void 0!==i[s]?i[s]:"0"),e=Number(void 0!==n[s]?n[s]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let i=r(),n=1==i&&-1!=d.compareVersion(o(),t),a=2==i&&-1!=d.compareVersion(o(),e);return n||a}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let i=r(),n=1==i&&0==d.compareVersion(o(),t),a=2==i&&0==d.compareVersion(o(),e);return n||a}static supportMinimumTKVersion(e="0.0.0"){return-1!=d.compareVersion(t?t.tkVersion:Tachikoma.env.tkVersion,e)}}d.platform=Tachikoma.env.platform;class c{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i="",n=0;n<t;n++)i+=e.charAt(Math.floor(48*Math.random()));return i}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,i){if(!t)return null;const n=this.randomName(i);return Tachikoma[n]=e=>{t(e)},"Tachikoma."+n}}c.globalIndex=0;const C=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class p{static getDeviceInfoAsync(){return p.callNative("getDeviceInfo",null)}static getKsAdDataAsync(){return p.callNative("getKsAdData",null)}static getKsAdConfigAsync(){return p.callNative("getKsAdConfig",null)}static getScreenOrientationAsync(){return p.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return p.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return p.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return p.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.callNativeWithCallback("registerLifecycleListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,i,n=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},i,n)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:s(e)?e:""})}static clickAction(t,e,i,n){this.clickActionBase(Object.assign({area:t,logParam:e},i),n)}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,t,!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,i,n=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:i,playDuration:n})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e){this.callNativeWithCallback("openURL",{url:t,title:e})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static updateVideoPlayStatus(t,e,i,n){this.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:i||"",currentTime:n||0})}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((i,n)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),i(t)):i({result:0,data:null})}))))}static callNativeWithCallback(t,e,i,n=!0){const s=a()?1:0;a()&&"pageStatus"==t||a()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,i,n,0):this.callNativeWithCallbackAndType(t,e,i,n,s)}static callTKWithCallback(t,e,i,n=!0){this.callNativeWithCallbackAndType(t,e,i,n,1)}static callNativeWithCallbackAndType(t,e,i,n=!0,a=0){if("undefined"==typeof KwaiAd)return C.log("undefined value KwaiAd"),void(i&&i({result:0,data:null}));C.log("call:"+t);let s=e=>{let n=0,a=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,n=t.result,a=t.data}catch(s){n=0,a=null}C.log("cb:"+t+"  r:"+n),i&&i({result:n,data:a})};const o=c.registerCallbackForAction(s,n,t),r={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?s:o};0==a?KwaiAd.callAdBridge(r):KwaiAd.callTKBridge(r)}}class u{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,p.pageStatus(t,e),this.registerNativeId())}registerNativeId(){1==Tachikoma.env.isDebug&&d.supportMinimumTKVersion("4.0.7")&&!d.isAndroid()&&(this.startConfig(),p.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{h(this)}),120)}}var g,m,f,I;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA"}(g||(g={})),function(t){t[t.adClickReward=1]="adClickReward"}(m||(m={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(f||(f={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(I||(I={}));const T="ad_convert_event";class v extends TKView{constructor(){super(),this.style={alignItems:"center",justifyContent:"center"},this.imageView=new TKImage,this.appendChild(this.imageView)}setImageSize(t){this.imageView.style={width:t.width,height:t.height}}setImageSrc(t){this.imageView.setSrc(t)}setImageSrcAndSize(t,e){this.setImageSize(e),this.setImageSrc(t)}configImage(t){t&&t(this.imageView)}}class _ extends TKView{constructor(t){super(),this.style={backgroundColor:"#30303099",borderRadius:4},this.addEventListener("tap",(()=>{})),this.label=new TKText,this.label.style={color:"#FFFFFF",fontSize:10,textLineHeight:16,margin:10},this.appendChild(this.label);let e="";if(TKUtil.supportMinimumTKVersion("4.0.5")?(isValidString(t.downloadSafeInfo.appName)&&"应用名："+t.downloadSafeInfo.appName+"；",isValidString(t.downloadSafeInfo.appVersion)&&"版本号："+t.downloadSafeInfo.appVersion+"；",isBlank(t.downloadSafeInfo.packageSize)||"应用大小："+formatSize(t.downloadSafeInfo.packageSize)+"；",isValidString(t.downloadSafeInfo.corporationName)&&"开发者："+t.downloadSafeInfo.corporationName+"；"):(isValidString(t.adBaseInfo.appName)&&"应用名："+t.adBaseInfo.appName+"；",isValidString(t.adBaseInfo.appVersion)&&"版本号："+t.adBaseInfo.appVersion+"；",isBlank(t.adBaseInfo.packageSize)||"应用大小："+formatSize(t.adBaseInfo.packageSize)+"；",isValidString(t.adBaseInfo.corporationName)&&"开发者："+t.adBaseInfo.corporationName+"；"),"  ",this.span=new TKSpan,!isBlank(t.downloadSafeInfo.appPermissionInfoUrl)){const i=e.length;"权限信息";const n=e.length;isBlank(t.downloadSafeInfo.appPrivacyUrl)?" ":" | ";const a=new TKSpanItem;a.spanType="underLine",a.start=i,a.end=n,this.permissionClickSpanItem=new TKSpanItem,this.permissionClickSpanItem.spanType="click",this.permissionClickSpanItem.start=i,this.permissionClickSpanItem.end=n,this.permissionClickSpanItem.color="#FFFFFF",this.permissionClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(t.downloadSafeInfo.appPermissionInfoUrl,"权限信息")})),this.span.addSpan(a),this.span.addSpan(this.permissionClickSpanItem)}if(!isBlank(t.downloadSafeInfo.appPrivacyUrl)){const i=e.length;"隐私政策";const n=e.length;" ";const a=new TKSpanItem;a.spanType="underLine",a.start=i,a.end=n,this.privacyClickSpanItem=new TKSpanItem,this.privacyClickSpanItem.spanType="click",this.privacyClickSpanItem.start=i,this.privacyClickSpanItem.end=n,this.privacyClickSpanItem.color="#FFFFFF",this.privacyClickSpanItem.setSpanOnClickListener((()=>{this.clickCallback&&this.clickCallback(t.downloadSafeInfo.appPrivacyUrl,"隐私政策")})),this.span.addSpan(a),this.span.addSpan(this.privacyClickSpanItem)}this.label.setSpan(e,this.span)}}class L extends TKView{constructor(){super(),this.style={height:28,bottomLeftRadius:14,topLeftRadius:14,backgroundColor:"#30303099",flexDirection:"row",alignItems:"center"};const t=new TKImage;t.style={marginLeft:5,width:18,height:18},t.setSrc("image/ksad-video-top-bar/icon_ksad_gift_small.png"),this.appendChild(t);const e=new TKText;e.style={color:"#FFFFFF",fontSize:14,marginLeft:4,marginRight:8},e.setText("观看完视频可获得奖励"),this.appendChild(e),this.addEventListener("tap",(()=>{}))}}class w extends Object{constructor(t,e,i,n){var a;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=i,this.value=this.get(),this.cb(null!==(a=this.value)&&void 0!==a?a:n,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){w.target=this;const t=this.getter.call(this.vm,this.vm);return w.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let i=0,n=e.length;i<n;i++){if(!t)return;t=t[e[i]]}return t}}}function y(t){return!!t}let A;function b(){if(null!=A)return A;let t=!1;try{t=!1,A=t}catch(e){}return t}function E(t,e){if(!0===b()&&(null==t||!1===t))throw new Error("tkmvvm ----- 请检查传值: "+e)}function S(t){b()&&console.log("tachikoma TKMVVM log -> "+t)}class k extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var i=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(n){e?e===n&&i.observeValueWithKey(t,n):i.observeValueWithKey(t,n)}))}observeValueWithKey(t,e){let i=t[e];var n=new D(e);N(i);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return w.target&&n.depend(),i},set:function(t){t!==i&&(i=t,n.notify(),N(t))}})}defineArray(t){if(t)for(let e=0,i=t.length;e<i;e++)N(t[e])}}var R=0;class D extends Object{constructor(t){super(),this.key=t,this.pid=R++,this.deps=new Array}depend(){w.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function N(t,e){if(!t||"object"!=typeof t)return;var i;if(!("object"==typeof(i=t)&&Object.keys(i).length>0))return;let n=!1,a=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(a)&&(n=t[a]),!n)return S("observe "+a),t[a]=!0,new k(t,e);S("already observe "+a)}class x extends Object{constructor(){super()}tk_observe(t){y(t)&&(t in this?N(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}function B(t,e,i){if(!y(t)||!y(e)||!y(i))return;const n=K(e),a=null==n?void 0:n.split(".");if(!a)return void E(a,"tk_bind error, check bind path");const s=a[0];t.tk_observe(s),new w(t,n,((t,e)=>{i&&i(t)}))}function K(t){let e=function(t){if(t)return t.bind_path?t.$bind_path:"string"==typeof t?t:void 0}(t);if(e)return e;E(e,"tk_bind error, check bind path")}var O,F;!function(t){t.START="start",t.CENTRT="center",t.END="end"}(O||(O={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(F||(F={}));var V,P;!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(V||(V={}));class M{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(P||(P={}));var W,U;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(W||(W={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(U||(U={}));function H(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function z(t){try{return t.adMatrixInfo.adDataV2.neoTKInfo.confirmCardType}catch(e){}return 0}function Y(t){return 1==H(t)}function G(t,e){let i;switch(e){case 1:try{i=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId}catch(n){i=void 0}break;case 12:try{i=t.adMatrixInfo.adDataV2.neoTKInfo.templateId}catch(n){i=void 0}break;case 3:try{i=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId}catch(n){i=void 0}break;case 2:try{i=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId}catch(n){i=void 0}break;case 4:try{i=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId}catch(n){i=void 0}break;case 6:try{i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId}catch(n){i=void 0}break;case 5:try{i=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId}catch(n){i=void 0}break;case 7:try{i=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId}catch(n){i=void 0}break;case 10:try{i=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId}catch(n){i=void 0}break;case 9:try{i=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId}catch(n){i=void 0}break;case 11:try{i=t.adMatrixInfo.adDataV2.pushTKInfo.templateId}catch(n){i=void 0}break;case 13:try{i=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId}catch(n){i=void 0}break;case 14:try{i=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId}catch(n){i=void 0}break;case 15:try{i=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId}catch(n){i=void 0}break;case 16:try{i=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId}catch(n){i=void 0}break;default:i=void 0}return i}function j(t,e){let i=G(t,e);if(!s(i))return;const n=t.adMatrixInfo.adDataV2.templateDatas.length;for(let a=0;a<n;a++){let e=t.adMatrixInfo.adDataV2.templateDatas[a];if(e.templateId==i)return e}}function J(t){const e=t.adMaterialInfo.materialFeature.length>0?t.adMaterialInfo.materialFeature[0]:null;if(e){let n=e.videoDuration;0==n&&(n=e.videoDurationMs/1e3);let a=n;try{a=t.adRewardInfo.rewardTime}catch(i){}return a?0==n?a:Math.min(n,a):n}return-1}function $(t,e){let i=!0;if(1==t.adBaseInfo.adOperationType)try{let n=t.downloadSafeInfo.complianceInfo;if(null!=n)switch(e){case 1:i=3!=n.actionBarType;break;case 2:i=3!=n.describeBarType;break;case 3:i=3!=n.materialJumpType;break;default:i=!0}}catch(n){i=!0}else try{let n=t.unDownloadConf.unDownloadRegionConf;if(null!=n)switch(e){case 1:i=1!=n.actionBarType;break;case 2:i=1!=n.describeBarType;break;case 3:i=1!=n.materialJumpType;break;default:i=!0}}catch(n){i=!0}return i}function q(t){let e=!1;try{e=1==t.adMatrixInfo.adDataV2.neoTKInfo.renderType}catch(i){}return e}class Q{static isClickReward(t,e){try{let i=!0;if(d.isAndroid()&&!l(e)&&(i=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&i)return!0}catch(i){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(i){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){return t.advertiserInfo.userId}static getLiveStreamId(t){return t.adBaseInfo.liveStreamId}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!l(e)&&Q.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),l(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=s(e)?e:t.advertiserInfo.rawUserName}catch(i){}return e=s(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(l(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return l(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=j(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let i="";try{i=t.neoLiveAuthorInfoData.authorName}catch(n){}try{l(i)&&(i=t.neoLiveCartDetailData.authorName)}catch(n){}try{l(i)&&(i=e.adBaseInfo.appName)}catch(n){}return i}static liveGetLiveDesc(t,e){let i="";try{i=t.neoLiveCartDetailData.liveDesc}catch(n){}try{l(i)&&(i=t.neoLiveAuthorInfoData.liveDesc)}catch(n){}try{l(i)&&(i=t.adDescription)}catch(n){}try{l(i)&&(i=e.adBaseInfo.adDescription)}catch(n){}return i}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!l(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!l(e))return e}catch(e){}return null}}class X{constructor(){this.reward_type=-1,this.task_type=-1,this.task_step=-1}static createPageShowInstance(t,e,i){if(0==e||l(i))return null;if(i.loadDataTime<=0||i.downloadFinishTime<=0)return null;let n=this.INVALID_VALUE;if(e!=this.INVALID_VALUE){n=Date.parse((new Date).toString())-e,n<this.INVALID_VALUE&&(n=this.INVALID_VALUE)}let a=new X;return a.page_status=2,a.load_type=i.loadFromCache?2:1,a.render_duration_ms=n,a.download_type=i.downloadType,a.download_size=i.downloadSize,a.creative_id=t.adBaseInfo.creativeId,a.video_url=function(t){try{return t.adMaterialInfo.materialFeature[0].materialUrl}catch(e){}return""}(t),a.video_duration_ms=function(t){try{return t.adMaterialInfo.materialFeature[0].videoDuration}catch(e){}return 0}(t),a}}X.INVALID_VALUE=-1;const Z=28;class tt extends TKView{constructor(t){if(super(),this.callActionTimer=0,this.hasShowCallBtn=!1,this.closeTimer=0,this.hasShowCloseBtn=!1,this.expcetedHeight=44,this.playEndCloseHadDelayShow=!1,this.isFinishAdvance=!1,this.vm=t,this.hasReward=!1,this.btnMargin=this.vm.isDeepRewardTask()?8:12,this.currentTime=0,this.actionState=-1,this.style={position:"absolute",top:0,left:0,right:0,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.topBarContainer=new TKView,this.topBarContainer.style={width:"100%",height:44,flexDirection:"row",justifyContent:"space-between",alignItems:"center"},this.appendChild(this.topBarContainer),this.leftContainer=new TKView,this.leftContainer.style={height:Z,marginLeft:16-this.btnMargin/2,alignItems:"center",justifyContent:"center",flexDirection:"row"},this.topBarContainer.appendChild(this.leftContainer),this.rightContainer=this.getRightContainer(),this.topBarContainer.appendChild(this.rightContainer),this.videoDuration=this.vm.getVideoDuration(),this.vm.isRewardVideo()){let t=this.vm.getSkipConfirmSwitch();this.skipNeedPromopt=t,this.rewardSecond=this.vm.getRewardTime(),this.skipSecond=Math.min(this.vm.getSkipShowTime(),this.rewardSecond),this.leftTime=this.rewardSecond}else this.skipNeedPromopt=!1,this.skipSecond=this.vm.getSkipShowTime(),KSAdInfoUtils.isOriginLiveAd(this.vm.adInfo)?this.rewardSecond=30:this.rewardSecond=this.videoDuration,this.leftTime=this.rewardSecond;if(TKUtil.supportMinimumVersion("3.3.21","3.3.28")){let t=null,e=this.vm.isShowPrivacy(),i="flex-end";0!=this.vm.screenOrientation&&e?(new TKView,t.style={width:"100%",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},"flex-start",this.appendChild(t)):this;let n=!1;e&&(this.privacyView=new KSAdPrivacyView(this.vm.adInfo),this.privacyView.style={alignSelf:"stretch",marginTop:10},0==this.vm.screenOrientation?(this.privacyView.style={marginLeft:16,marginRight:16,flexGrow:1},this.expcetedHeight+=78):(this.privacyView.style={marginLeft:16,width:200},this.expcetedHeight+=114,!0),t.appendChild(this.privacyView),this.privacyView.clickCallback=(t,e)=>{this.vm.handleOpenURL(t,e)}),this.getHasGuideBar()&&(this.guideBar=new KSAdVideoGuideView,this.guideBar.style={alignSelf:i,marginTop:10},t.appendChild(this.guideBar),n||(this.expcetedHeight+=38))}tk_bindFn(this.vm,this.vm.$attrsPath.isMuted,(t=>{this.setMuted(t)})),tk_bindFn(this.vm,this.vm.$attrsPath.playFailed,(t=>{t&&this.playFailed()})),tk_bindFn(this.vm,this.vm.$attrsPath.playFinished,(t=>{t&&this.finishPlay()})),tk_bindFn(this.vm,this.vm.$attrsPath.currentPlaybackTime,(t=>{t&&this.countDown(t)})),tk_bindFn(this.vm,this.vm.$attrsPath.hasGetDeepGift,(t=>{t&&this.getDeepReward(t)})),tk_bindFn(this.vm,this.vm.$attrsPath.hasInstallTargetApp,(t=>{t&&!this.vm.isCovertTask()&&(this.updateRewardState(!0),this.updateActionBarState(4,!0))})),tk_bindFn(this.vm,this.vm.$attrsPath.hasShowPlayend,(t=>{t&&(this.vm.isCovertTask()&&this.vm.giveRewardTime>0&&this.updateRewardState(!0),this.updateActionBarState(4))})),globalEventBus().on(PLAYER_MUTE_CHANGE,(t=>{this.setMuted(t.muted),this.vm.isMuted=t.muted})),1!=this.vm.topbarModelType&&this.setupAction()}setupAction(){this.topBarContainer.addEventListener("tap",(t=>{this.vm.convertForOtherArea(4==this.actionState?2:3,getClickPointOnScreen(t,this.topBarContainer),ItemClickType.CARD_PAGE_CLICK)})),this.vm.isSlideClick()&&addSwipeEvent(this.topBarContainer,(()=>{this.vm.convertForOtherArea(4==this.actionState?2:3,{x:0,y:0},ItemClickType.CARD_SWIPE_CONVERT)}))}shouldShowNormalCallBtn(){return!0}handleCallImpressionWhenPlay(){this.callImpressionWhenPlayCalled||(this.callImpressionWhenPlayCalled=!0,this.vm.handleCallImpressionOnPlay())}updateActionBarStateInner(t,e=!1){}updateActionBarState(t,e=!1){if(!e&&t<=this.actionState)return;4==t&&this.guideBar&&this.guideBar.setVisibility("hidden"),this.actionState=t,this.leftContainer.removeAll(),this.rightContainer.removeAll(),this.updateActionBarStateInner(t,e);let i=this;if(4==this.actionState)clearTimeout(this.callActionTimer),this.closeBtn&&(2==this.vm.needShowPlayEndCloseBtn?this.hidePlayEndCloseBtn():this.vm.isDelayShowEndClose()&&!this.playEndCloseHadDelayShow?(this.hidePlayEndCloseBtn(),0==this.closeTimer&&(this.closeTimer=setTimeout((()=>{this.playEndCloseHadDelayShow=!0,this.showPlayEndCloseBtn()}),1e3*this.vm.getCloseDelaySeconds()))):this.showPlayEndCloseBtn(),this.vm.getPlayEndCallDescription&&this.vm.handleCallImpressionOnFinish());else if(this.callContainer&&this.shouldShowNormalCallBtn()){const t=this.vm.getPlayDetailCallDescription(),e=this.vm.getPlayDetailCallBtnShowTime();t&&(this.hasShowCallBtn||(0==e?this.hasShowCallBtn=!0:this.callActionTimer||(this.callActionTimer=setTimeout((()=>{i.callContainer.appendChild(i.getCallBtn()),i.callLabel.setText(t),i.layout(),i.handleCallImpressionWhenPlay(),i.hasShowCallBtn=!0}),1e3*e))),this.hasShowCallBtn&&(this.callContainer.removeAll(),this.callContainer.appendChild(this.getCallBtn()),this.callLabel.setText(t),this.handleCallImpressionWhenPlay()))}this.layout()}updateCountDownText(){this.countDownLabel&&this.leftTime>=0&&(this.countDownLabel.setText(this.leftTime+""),this.layout())}showPlayEndCloseBtn(){this.closeBtn&&!this.hasShowCloseBtn&&(this.closeBtn.style={display:"flex"},this.hasShowCloseBtn=!0,TKUtil.isAndroid()||this.layout())}hidePlayEndCloseBtn(){this.closeBtn&&(this.closeBtn.style={display:"none"})}updateRewardState(t){this.hasReward=t&&this.vm.isRewardVideo(),this.hasReward&&this.vm&&this.vm.impressionCheckResult&&this.vm.handleHasGift()}getHasGuideBar(){return!1}countDown(t){var e,i,n,a,s,o;t<this.currentTime||this.vm.isDeepRewardTask()&&this.hasDeepReward||(this.currentTime=t,Math.floor(t),this.leftTime=this.rewardSecond-t<1?1:this.rewardSecond-t,TKUtil.supportMinimumTKVersion("5.0.1")&&this.vm.isNeedCheck&&2==this.vm.getRealAdStyle()&&(this.vm.isNeedSeverCheck=this.isNeedSeverCheck(),this.callBackAdvanceMs=(null===(null===this.vm.adInfo.adRewardInfo||void 0===e?void 0:e.callBackStrategyInfo)||void 0===i?void 0:i.rewardAdvanceSwitch)?(null===(null===this.vm.adInfo.adRewardInfo||void 0===n?void 0:n.callBackStrategyInfo)||void 0===a?void 0:a.callBackAdvanceMs)/1e3:0,t>=this.rewardSecond-this.vm.giveRewardTime-this.callBackAdvanceMs&&(null===(null===this.vm.adInfo.adRewardInfo||void 0===s?void 0:s.callBackStrategyInfo)||void 0===o?void 0:o.rewardAdvanceSwitch)&&!this.isFinishAdvance&&this.vm.impressionCheckResult&&this.vm.isNeedCheck&&this.vm.adInfo.adConversionInfo.callbackUrlInfo&&(this.vm.isNeedSeverCheck?(this.vm.severCheckState=1,this.secverCheck()):this.updateRewardState(!0),this.isFinishAdvance=!0)),t>=this.rewardSecond-this.vm.giveRewardTime?(this.updateRewardState(!0),this.updateActionBarState(2)):(this.updateCountDownText(),t>=this.skipSecond?this.updateActionBarState(1):this.updateActionBarState(0)))}isNeedSeverCheck(){var t,e,i,n,a,s;return(null===(null===this.vm.adInfo.adRewardInfo||void 0===t?void 0:t.callBackStrategyInfo)||void 0===e?void 0:e.serverCheckSwitch)&&(null===(null===this.vm.adInfo.adRewardInfo||void 0===i?void 0:i.callBackStrategyInfo)||void 0===n?void 0:n.callBackAdvanceMs)>0&&(null===(null===this.vm.adInfo.adRewardInfo||void 0===a?void 0:a.callBackStrategyInfo)||void 0===s?void 0:s.rewardAdvanceSwitch)}secverCheck(){const t=new TKNetwork;t.isAddCommonParameters=1,t.method="POST",t.url="/rest/e/v3/open/checkReward";try{reportStartRewardCallBackCheckRequest(2,this.vm.adInfo);let n=JSON.parse(this.vm.adInfo.adConversionInfo.callbackUrlInfo);n.checkType=2;const a={callbackUrlInfo:JSON.stringify(n),impInfo:[{posId:this.vm.posId,adNum:1,adStyle:2}]};try{var e=JSON.parse(JSON.stringify(this.vm.adInfo.serverExt));isBlank(e)||(delete e._tkmvvm_observed,delete e.nativeID,a.serverExt=e)}catch(i){}t.params=a;const s=now();t.request(((t,e)=>{console.log("[caijie] tknetwork  response "+t+" error "+e);const n=now()-s;if(!e)try{const e=JSON.parse(t).data,i=JSON.parse(e);1==i.result?(this.updateRewardState(!0),this.vm.severCheckState=1):this.vm.severCheckState=2,reportEndRewardCallBackCheckRequest(2,this.vm.adInfo,n,i.result,i.errorMsg)}catch(i){}}))}catch(i){}}getDeepReward(t){this.vm.isDeepRewardTask()&&(this.hasDeepReward=t,4==this.actionState?(this.updateCountDownText(),this.layout()):this.updateActionBarState(3))}finishPlay(){this.updateRewardState(!0),this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!1)}playFailed(){this.updateActionBarState(4,!0),this.vm.handlePlayEnd(!0)}setMuted(t){this.soundBtn&&(t?this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_mute.png"):this.soundBtn.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_sound.png"))}hasFeedbackBtn(){return!1}getRightContainer(){let t=new TKView,e={height:Z,marginRight:16-this.btnMargin/2,alignItems:"center",flexDirection:"row",justifyContent:"center"};return t.style=e,t}getCallContainer(){let t=new TKView;return t.style={height:"100%",alignItems:"center",justifyContent:"center",flexDirection:"row"},t.enabled=!0,this.callContainer=t,t}getSoundBtn(){this.soundBtn=new KSAdImageButton,this.soundBtn.setImageSize({width:22,height:22});let t={width:Z,height:Z,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,backgroundColor:"#30303099"};return this.soundBtn.style=t,this.setMuted(this.vm.isMuted),this.soundBtn.addEventListener("tap",(t=>{this.vm.handleMuteChange(!this.vm.isMuted),this.setMuted(this.vm.isMuted)})),this.soundBtn}getSkipBtn(){let t=new KSAdImageButton,e={height:Z,borderRadius:14,backgroundColor:"#30303099",marginRight:this.btnMargin/2,marginLeft:this.btnMargin/2};if(t.style=e,this.vm.getSkipTips()){t.style={paddingLeft:12,paddingRight:12};let e=new TKText;e.style={fontSize:14,color:"#FFFFFF"},e.setText(this.vm.getSkipTips()),t.appendChild(e)}else t.style={width:Z},1==this.vm.getSkipType()?t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_skip.png",{width:Z,height:Z}):t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12});return t.addEventListener("tap",(t=>{this.onSkipClick()})),this.skipBtn=t,t}onSkipClick(){let t=this.skipNeedPromopt&&(this.vm.isDeepRewardTask()?!this.hasDeepReward:!this.hasReward),e=this.vm.isRewardVideo();console.log("jky topbar view onSkipClick showPromopt: "+t),this.vm.handleSkip(t,e,this.skipSecond)}getFeedbackBtn(){this.feedbackBtn=new TKView,this.feedbackBtn.style={height:Z,borderRadius:14,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,backgroundColor:"30303099",paddingLeft:8,paddingRight:8,alignItems:"center",justifyContent:"center"};let t=new TKText;return t.style={fontSize:14,color:"#FFFFFF"},t.setText("反馈"),this.feedbackBtn.appendChild(t),this.feedbackBtn.addEventListener("tap",(()=>{this.vm.handleOpenFeedback()})),this.feedbackBtn}getCloseBtn(){let t=new KSAdImageButton,e={width:Z,height:Z};return e.marginLeft=this.btnMargin/2,e.marginRight=this.btnMargin/2,e.borderRadius=14,e.backgroundColor="#30303099",t.style=e,t.setImageSrcAndSize(this.vm.getResourceRoot()+"icon_ksad_close.png",{width:12,height:12}),t.addEventListener("tap",(()=>{this.vm.handleClose()})),this.closeBtn=t,tk_bindFn(this.vm,this.vm.$attrsPath.needShowPlayEndCloseBtn,(t=>{let e=this.vm.getCloseDelaySeconds();console.log("jky topbar view onBind needShowPlayEndCloseBtn: "+t+", closeBtnDelayTime: "+e),1==t&&e<=0&&this.showPlayEndCloseBtn()})),t}getGiftBtn(t=!0){let e=new KSAdImageButton;return e.setImageSize({width:Z,height:Z}),e.style={width:Z,height:Z,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},t&&e.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift.png"),e.addEventListener("tap",(()=>{this.vm.handleGiftClick()})),this.giftBtn=e,e}getCountDownLabel(){let t=new TKText;return t.style={color:"#FFFFFF",fontSize:14,textAlign:"center",height:"100%",textLineClamp:1,minimumTextScaleFactor:.5},t}getCountDownHasBg(){return!0}getCountDownBtn(){return this.countDownBtn=new TKView,this.countDownBtn.style={height:Z,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2},this.getCountDownHasBg()&&(this.countDownBtn.style={borderRadius:14,backgroundColor:"#30303099"}),this.countDownBtn.style={width:Z},this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={width:"100%"},this.countDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.countDownBtn}getGiftCountDownBtn(){this.giftCountDownBtn=new TKView,this.giftCountDownBtn.style={marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,height:Z,borderRadius:14,backgroundColor:"#30303099"},this.giftCountDownBtn.addEventListener("tap",this.vm.handleGiftClick);let t=this.getGiftBtn(!1);return t.style={marginTop:2,marginLeft:2,width:24,height:24,borderRadius:12,backgroundColor:"#FE3666"},t.setImageSize({width:21,height:21}),t.setImageSrc(this.vm.getResourceRoot()+"icon_ksad_gift_new.png"),this.giftCountDownBtn.appendChild(t),this.countDownLabel=this.getCountDownLabel(),this.countDownLabel.style={marginTop:-26,marginLeft:26+this.btnMargin/2,marginRight:this.btnMargin},this.giftCountDownBtn.appendChild(this.countDownLabel),this.updateCountDownText(),this.giftCountDownBtn}getCallBtn(){this.callBtn=new TKView,this.callBtn.setBackgroundColor("#30303099"),this.callBtn.style={paddingLeft:10,paddingRight:10,height:Z,marginLeft:this.btnMargin/2,marginRight:this.btnMargin/2,borderRadius:14,flexDirection:"row",justifyContent:"center",alignItems:"center"},this.callBtn.addEventListener("tap",(t=>{this.vm.handleCallClick(4==this.actionState)})),this.callLabel=new TKText,this.callLabel.nativeID="topBarCallLabel",this.callLabel.style={fontSize:14,color:"#FFFFFF"},this.callBtn.appendChild(this.callLabel);let t=new TKImage;return t.style={width:6,height:11,marginLeft:6},t.setSrc(this.vm.getResourceRoot()+"icon_ksad_white_right_arrow.png"),this.callBtn.appendChild(t),this.callBtn}}class et extends TKView{}class it extends et{constructor(){super()}refeshCurrentTIme(t){}showConfirmCard(){}refreshActionDes(t){}}class nt extends it{constructor(t,e=!1,i=!1){if(super(),this.roundIcon=!1,this.showDesc=!1,this.vm=t,this.roundIcon=e,this.showDesc=i,!this.vm.checkDataValid())return;this.setupViews(),this.reloadDataInfo(),this.bindEvent();let n={actionType:140,payload:JSON.stringify({elementType:149})};p.sendLog(n),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)}))}setupViews(){let t=0==this.vm.screenOrientation;this.style={width:271,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},this.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={marginTop:t?32:28,width:205,height:25,fontSize:18,color:"#000000",fontWeight:"bold"},e.appendChild(this.titleLabel),this.appIcon=new TKImage,this.appIcon.style={width:64,height:64,borderRadius:this.roundIcon?32:6,borderColor:"#EAEAEA",borderWidth:.5,marginTop:12},e.appendChild(this.appIcon),this.showDesc?(this.nameLabel=new TKText,this.nameLabel.style={marginTop:12,maxWidth:"82%",maxHeight:40,fontSize:16,fontWeight:"medium",color:"#222222",textLineClamp:1,textOverflow:"ellipsis"},e.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:10,maxWidth:"82%",maxHeight:18,fontSize:14,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descLabel)):(this.nameLabel=new TKText,this.nameLabel.style={marginTop:12,maxWidth:"82%",maxHeight:40,fontSize:16,fontWeight:"medium",color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.nameLabel)),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},e.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center"},this.detailContainer.appendChild(this.detailLabel);let i=new TKImage;i.style={width:12,height:12},i.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(i);let n=new TKView;n.style={marginTop:t?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:t?24:12},e.appendChild(n),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},n.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C"},n.appendChild(this.abandonBtn),this.closeBtn=new v,this.closeBtn.style={paddingLeft:12,paddingRight:12,width:Z,height:Z,position:"absolute",top:0,left:0},this.closeBtn.setImageSrcAndSize("image/ksad-video-confirm-card/icon_ksad_confirm_close.png",{width:24,height:24}),this.appendChild(this.closeBtn)}reloadDataInfo(){this.vm.adInfo;this.titleLabel.formattedText='再看<font color="#FE3666">00秒</font>，即可获得<font color="#FE3666">奖励</font>',this.nameLabel.setText(this.getName()),this.descLabel&&this.descLabel.setText(this.getDesc()),this.appIcon.setSrc(this.vm.getIconUrl()),this.detailLabel.setText(this.getDetailLabelText()),this.actionBtn.setText("继续观看"),this.abandonBtn.setText("放弃奖励")}getName(){return this.vm.getProductName()}getDesc(){return this.vm.getDescription()}getDetailLabelText(){return"查看详情"}bindEvent(){this.closeBtn.addEventListener("tap",(t=>{this.vm.handleClose()})),this.appIcon.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ICON_TITLE_CLICK)})),this.descLabel&&this.descLabel.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ICON_DESCRIPTION_CLICK)})),this.detailLabel.addEventListener("tap",(t=>{this.convert(1,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(t=>{this.convert(1,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(t=>{this.vm.handleContinue()})),this.abandonBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}))}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.formattedText='再看<font color="#FE3666">'+this.skipTime+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}convert(t,e,i){this.vm.handleConvert(t,e,i)}}let at;function st(){var t;return at||(at={all:t=t||new Map,on(e,i){const n=t.get(e);n?n.push(i):t.set(e,[i])},off(e,i){const n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit(e,i){let n=t.get(e);n&&n.slice().map((t=>{t(i)})),n=t.get("*"),n&&n.slice().map((t=>{t(e,i)}))},clear(){t.clear()}}),at}class ot{static log(t,e,i){(i=i||{}).renderContainer=1;const n={actionType:t,payload:JSON.stringify(i)};e&&(n.clickInfo=e),p.sendLog(n)}static convertIfNeeded(t,i,n,a,s,o,r,h){let d=$(i,n);if(console.log("tkloadcontroller shouldconvert:"+d),!d)return;let c=e;l(c)||(l(o)&&(o=new M),l(o.template_id)&&(o.template_id=c.templateId),l(o.template_version)&&(o.template_version=c.templateVersion)),this.convert(n,a,s,t,o,r,h)}static convert(t,e,i,n,a,s,o){let r,h;r=l(a)?{itemClickType:i,renderContainer:1}:{itemClickType:i,renderContainer:1,clientExtData:JSON.stringify(a)},l(s)||Object.assign(r,s),st().emit(T,{clickType:i}),h=e?{x:e.x,y:e.y}:{},p.clickAction(t,{payload:JSON.stringify(r),clickInfo:h,sceneType:n,itemClickType:i},o,(i=>{1!=i.result&&(this.log(2,e,r),p.convert(1==t))}))}static expose(t){this.log(1,null,t)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,i,n,a){if(d.isAndroid())this.convertWithType(e,i,n,a);else{if(!$(t,e))return;this.convertWithType(e,i,n,a)}}static convertWithType(t,e,i,n){let a={itemClickType:i,renderContainer:1};st().emit(T,{clickType:i}),p.clickAction(t,{payload:JSON.stringify(a),clickInfo:{x:e.x,y:e.y},convertType:n},(i=>{1!=i.result&&(this.log(2,e,a),p.convert(1==t))}))}static convertWithTypeIfNeededNew(t,e,i,n,a,s){if(d.isAndroid())this.convertWithTypeNew(e,i,n,a,s);else{if(!$(t,e))return;this.convertWithTypeNew(e,i,n,a,s)}}static convertWithTypeNew(t,e,i,n,a){let s=a||{};s.itemClickType=i,s.renderContainer=1,st().emit(T,{clickType:i}),p.clickAction(t,{payload:JSON.stringify(s),clickInfo:{x:e.x,y:e.y},convertType:n},(i=>{1!=i.result&&(this.log(2,e,s),p.convert(1==t))}))}static convertNew(t,e,i,n,a,s){let o=s||{};o.itemClickType=a,o.renderContainer=1,st().emit(T,{clickType:a});let r=a;p.clickAction(e,{payload:JSON.stringify(o),clickInfo:{x:i.x,y:i.y,width:n.width,height:n.height},sceneType:t,itemClickType:r},(t=>{1!=t.result&&(this.log(2,i,o),p.convert(1==e))}))}static playNSecond(t){let e={photoPlaySecond:t};this.log(402,null,e)}static skip(){this.log(501,null,null)}}class rt extends TKView{constructor(){super(),this.animCount=0,this.animationAllowed=!0,this.createLiveView(),this.createLineLeftView(),this.createLineMiddleView(),this.createLineRightView(),this.startLiveViewAnimation(),this.animationTimer=setInterval((()=>{this.animCount++,this.startLiveViewAnimation()}),300)}createLiveView(){this.liveView=new TKView,this.liveView.style={backgroundColor:"#FE3666",width:16,height:16,borderRadius:8,flexDirection:"row",alignItems:"center",justifyContent:"center"},this.appendChild(this.liveView)}createLineLeftView(){this.lineLeft=new TKView,this.lineLeft.style={position:"absolute",bottom:4,width:1.5,left:4,height:8,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineLeft)}createLineMiddleView(){this.lineMiddle=new TKView,this.lineMiddle.style={position:"absolute",bottom:4,width:1.5,height:4,left:7,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineMiddle)}createLineRightView(){this.lineRight=new TKView,this.lineRight.style={position:"absolute",bottom:4,width:1.5,left:10,height:6,backgroundColor:"#FFFFFF"},this.liveView.appendChild(this.lineRight)}startLiveViewAnimation(){if(!this.animationAllowed)return;const t=this.getAnimation(this.lineLeft,1);this.lineLeft.addAnimation(t,"animLeft");const e=this.getAnimation(this.lineMiddle,2);this.lineMiddle.addAnimation(e,"animMiddle");const i=this.getAnimation(this.lineRight,3);this.lineRight.addAnimation(i,"animRight")}getAnimation(t,e){const i=new TKKeyframeAnimation;return i.setAnimations([()=>(1==e?t.style={height:this.animCount%2==0?6:8}:2==e?t.style={height:this.animCount%2==0?8:4}:3==e&&(t.style={height:this.animCount%2==0?4:6}),1)]),i.duration=300,i}stopLiveViewAnimation(){clearInterval(this.animationTimer),this.animationAllowed=!1,this.lineLeft&&this.lineLeft.removeAllAnimation(),this.lineMiddle&&this.lineMiddle.removeAllAnimation(),this.lineRight&&this.lineRight.removeAllAnimation()}setLineHeightSize(t){this.lineLeft.style={bottom:4,width:1.5,height:t,backgroundColor:"#FFFFFF"},this.lineMiddle.style={bottom:4,width:1.5,height:t-4,backgroundColor:"#FFFFFF"},this.lineRight.style={bottom:4,width:1.5,height:t-2,backgroundColor:"#FFFFFF"}}}class lt extends it{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.reloadDataInfo(),this.bindEvent(),B(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"hideEnd"==t&&this.liveIcon&&this.liveIcon.stopLiveViewAnimation()})),ot.log(140,{x:0,y:0},{elementType:149}),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){let t=0==this.vm.screenOrientation;this.style={width:271,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},this.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={marginTop:t?32:28,width:205,height:25,fontSize:18,color:"#000000",fontWeight:"bold"},e.appendChild(this.titleLabel);let i=new TKView;i.style={marginTop:9,width:60,height:60,alignItems:"center",justifyContent:"center",flexDirection:"column"},this.appIcon=new TKImage,this.appIcon.style={width:54,height:54,borderRadius:27},this.liveIcon=new rt,this.liveIcon.style={position:"absolute",right:3,bottom:3},i.appendChild(this.appIcon),i.appendChild(this.liveIcon),e.appendChild(i),this.nameLabel=new TKText,this.nameLabel.style={marginTop:12,maxWidth:"82%",maxHeight:40,fontSize:16,fontWeight:"medium",color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:10,maxWidth:"82%",maxHeight:40,fontSize:14,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descLabel),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},e.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center"},this.detailContainer.appendChild(this.detailLabel);let n=new TKImage;n.style={width:12,height:12},n.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(n);let a=new TKView;a.style={marginTop:t?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:t?24:12},e.appendChild(a),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},a.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C"},a.appendChild(this.abandonBtn)}reloadDataInfo(){let t=this.vm.adInfo;this.titleLabel.formattedText='再看<font color="#FE3666">00秒</font>，即可获得<font color="#FE3666">奖励</font>',this.nameLabel.setText(t.adBaseInfo.appName),this.descLabel.setText(t.adBaseInfo.adDescription);let e=t.adBaseInfo.appIconUrl;s(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),this.appIcon.setSrc(e),this.detailLabel.setText("了解详情"),this.actionBtn.setText("留下看看"),this.abandonBtn.setText("残忍离开")}bindEvent(){this.detailLabel.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(t=>{ot.log(451),this.vm.handleClose()})),this.abandonBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}))}didDisappear(){this.liveIcon&&this.liveIcon.stopLiveViewAnimation()}refeshCurrentTIme(t){let e=this.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.formattedText='再看<font color="#FE3666">'+this.skipTime+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}convert(t,e,i){this.vm.handleConvert(t,e,i)}getRewardTime(){let t=this.vm.adInfo,e=this.getVideoDuration(),i=e;try{i=t.adRewardInfo.rewardTime}catch(n){}return i?Math.min(e,i):e}getVideoDuration(){let t=this.vm.adInfo,e=0;const i=t.adMaterialInfo.materialFeature.length>0?t.adMaterialInfo.materialFeature[0]:null;return i&&(e=i.videoDuration,0==e&&(e=i.videoDurationMs/1e3)),e}}class ht extends it{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),ot.log(140,{x:0,y:0},{elementType:149}))}setupViews(){this.style={width:271,height:138,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.titleLabel=new TKText,this.titleLabel.style={textAlign:"center",width:"100%",height:89,fontSize:16,color:"#222222"},this.titleLabel.setText(this.vm.getShowAlertInfo()),this.appendChild(this.titleLabel);const t=new TKView;t.style={backgroundColor:"#F5F5F5",height:1,width:"100%"},this.appendChild(t);let e=new TKView;e.style={width:"100%",height:46,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.skipBtn=new TKText,this.skipBtn.style={width:"50%",height:"100%",color:"#9C9C9C",textAlign:"center",fontSize:14},this.skipBtn.setText("关闭广告"),e.appendChild(this.skipBtn),this.appendChild(e),this.skipBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}));const i=new TKView;i.style={backgroundColor:"#F5F5F5",height:"100%",width:1},e.appendChild(i),this.continueBtn=new TKText,this.continueBtn.style={width:"50%",height:"100%",color:"#FE3666",textAlign:"center",fontSize:14},this.continueBtn.setText("继续观看"),e.appendChild(this.continueBtn),this.continueBtn.addEventListener("tap",(t=>{this.vm.handleContinue()}))}}class dt extends it{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.reloadDataInfo(),this.bindEvent(),B(this.vm,this.vm.$attrsPath.lifeStatus,(t=>{"hideEnd"==t&&this.liveIcon&&this.liveIcon.stopLiveViewAnimation()})),ot.log(140,{x:0,y:0},{elementType:149}),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){let t=0==this.vm.screenOrientation;this.style={width:271,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let e=new TKView;e.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},this.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={marginTop:t?32:28,width:205,height:25,fontSize:18,color:"#000000",fontWeight:"bold"},e.appendChild(this.titleLabel);let i=new TKView;if(i.style={width:80,height:80,alignItems:"center",justifyContent:"center",flexDirection:"column"},this.appIcon=new TKImage,this.appIcon.style={width:54,height:54,borderRadius:27},i.appendChild(this.appIcon),e.appendChild(i),this.vm.adInfo.adBaseInfo.isAccountLive)if(1!=this.vm.configInfo.abConfig.shortVideoFollowRewardPlayStyle)this.liveIcon=new rt,this.liveIcon.style={position:"absolute",right:13,bottom:13},i.appendChild(this.liveIcon);else{let t=new TKText;t.style={fontSize:10,color:"#FFFFFF",backgroundColor:"#FE3666",height:14,topLeftRadius:7,topRightRadius:7,bottomRightRadius:7,position:"absolute",top:6,left:50,paddingHorizontal:5,textAlign:"center"},t.setText("直播"),this.mIconBorder=new TKView,this.mIconBorder.style={opacity:0,width:52,height:52,borderColor:"#FE3666",borderWidth:1,borderRadius:26,position:"absolute"},i.appendChild(this.mIconBorder),i.appendChild(t),this.animateTimer=setInterval((()=>{this.startLiveBorderAnima(this.mIconBorder)}),800)}this.nameLabel=new TKText,this.nameLabel.style={maxWidth:"82%",maxHeight:40,fontSize:16,fontWeight:"medium",color:"#222222",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:10,maxWidth:"82%",maxHeight:40,fontSize:14,color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},e.appendChild(this.descLabel),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},e.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center"},this.detailContainer.appendChild(this.detailLabel);let n=new TKImage;n.style={width:12,height:12},n.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(n);let a=new TKView;a.style={marginTop:t?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:t?24:12},e.appendChild(a),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},a.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C"},a.appendChild(this.abandonBtn)}reloadDataInfo(){let t=this.vm.adInfo;this.titleLabel.formattedText='再看<font color="#FE3666">00秒</font>，即可获得<font color="#FE3666">奖励</font>',this.nameLabel.setText(this.vm.getAppName()),this.descLabel.setText(function(t){let e=null;try{if(e=t.advertiserInfo.fansCount,e>0&&e<1e4)return e+"";if(e>=1e4)return e=(e/1e4).toFixed(1)+"万",e}catch(i){}return""}(this.vm.adInfo)+"人关注了Ta");let e=t.adBaseInfo.appIconUrl;s(e)||(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),this.appIcon.setSrc(e),this.detailLabel.setText("了解详情"),this.actionBtn.setText("留下看看"),this.abandonBtn.setText("放弃奖励")}bindEvent(){this.detailLabel.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(t=>{this.vm.handleContinue()})),this.abandonBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}))}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.formattedText='再看<font color="#FE3666">'+this.skipTime+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}convert(t,e,i){this.vm.handleConvert(t,e,i)}startLiveBorderAnima(t){let e=new TKKeyframeAnimation;t.style={opacity:1,transform:{scale:1}},e.setAnimations([()=>(t.style={opacity:1,transform:{scale:1.15}},.5),()=>(t.style={opacity:0,transform:{scale:1.35}},1)]),e.duration=500,t.addAnimation(e,"borderWave")}}class ct extends it{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.vm.refreshCurrentTime((t=>{this.refeshCurrentTIme(t)})))}setupViews(){this.style={width:271,height:266,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"};const t=new TKView;t.style={marginTop:50,paddingTop:30,paddingLeft:32,paddingRight:32,width:"100%",height:216,backgroundColor:"#FFFFFF",borderRadius:12,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(t);let e=new TKView;e.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},t.appendChild(e),this.titleLabel=new TKText,this.titleLabel.style={width:205,height:20,includeFontPadding:!1,fontSize:18,textAlign:"center",color:"#222222"},e.appendChild(this.titleLabel);let i=new TKText;i.style={width:"100%",height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666",textAlign:"center",fontSize:15,fontWeight:"bold"},i.setText("留下看看"),t.appendChild(i),i.addEventListener("tap",(t=>{this.vm.handleContinue()}));let n=new TKText;n.style={width:"50%",height:48,color:"#9C9C9C",textAlign:"center",fontSize:14,fontWeight:"bold"},n.setText("残忍离开"),t.appendChild(n),n.addEventListener("tap",(t=>{this.vm.handleAbandon()}));let a=new TKView;a.style={width:"100%",height:100,position:"absolute",top:0,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(a);let s=new TKImage;s.setSrc("https://tx-ad.a.yximgs.com/kos/nlav11524/ksad/icon_confirm_present.png"),s.style={width:127,height:100},a.appendChild(s)}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);const i=e>0?e:0;this.titleLabel.formattedText='再看<font color="#FE3666">'+i+'秒</font>，即可获得<font color="#FE3666">奖励</font>'}}class Ct extends it{constructor(t){if(super(),this.vm=t,!this.vm.checkDataValid())return;this.setupViews(),this.reloadDataInfo(),this.bindEvent();let e={actionType:140,payload:JSON.stringify({elementType:149})};p.sendLog(e)}setupViews(){this.style={width:286,flexDirection:"column"},this.mHeaderView=this.createHeader(),this.appendChild(this.mHeaderView),this.mCardView=this.createCardView(),this.appendChild(this.mCardView)}createHeader(){let t=new TKView;return t.style={height:30,flexDirection:"row",alignItems:"center",justifyContent:"flex-end"},this.titleLabel=new TKText,this.titleLabel.style={width:205,fontSize:14,color:"#FFFFFF",textAlign:"right"},t.appendChild(this.titleLabel),this.closeBtn=new v,this.closeBtn.style={paddingLeft:12,paddingRight:12,marginLeft:4,width:Z,height:Z},this.closeBtn.setImageSrcAndSize("image/ksad-video-confirm-card/icon_ksad_confirm_close.png",{width:24,height:24}),t.appendChild(this.closeBtn),t}createCardView(){let t=new TKView,e=0==this.vm.screenOrientation;t.style={width:"100%",borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"};let i=new TKView;i.style={width:"100%",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",flexShrink:1},t.appendChild(i),this.appIcon=new TKImage,this.appIcon.style={width:58,height:58,borderRadius:4,borderColor:"#EAEAEA",borderWidth:.5,marginTop:28},i.appendChild(this.appIcon),this.nameLabel=new TKText,this.nameLabel.style={marginTop:10,maxWidth:"82%",maxHeight:40,fontSize:16,fontWeight:"medium",color:"#666666",textLineClamp:2,textOverflow:"ellipsis"},i.appendChild(this.nameLabel),this.descLabel=new TKText,this.descLabel.style={marginTop:8,maxWidth:"82%",maxHeight:40,fontSize:16,color:"#6C6C6C",textLineClamp:2,textOverflow:"ellipsis",textAlign:"center"},i.appendChild(this.descLabel),this.detailContainer=new TKView,this.detailContainer.style={height:40,flexDirection:"row",justifyContent:"center",alignItems:"center"},i.appendChild(this.detailContainer),this.detailLabel=new TKText,this.detailLabel.style={maxWidth:"100%",height:"100%",fontSize:14,color:"#FE3666",textAlign:"center"},this.detailContainer.appendChild(this.detailLabel);let n=new TKImage;n.style={width:12,height:12},n.src="image/ksad-video-confirm-card/icon_ksad_confirm_arrow.png",this.detailContainer.appendChild(n);let a=new TKView;return a.style={marginTop:e?12:2,flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:e?24:12},i.appendChild(a),this.actionBtn=new TKButton,this.actionBtn.style={width:207,height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666"},a.appendChild(this.actionBtn),this.abandonBtn=new TKText,this.abandonBtn.style={marginTop:10.5,height:17,fontSize:12,color:"#9C9C9C"},a.appendChild(this.abandonBtn),t}reloadDataInfo(){this.titleLabel.setText("再看0秒，可获取优惠"),this.nameLabel.setText(this.vm.getProductName()),this.appIcon.setSrc(this.vm.getIconUrl()),this.descLabel.setText(this.vm.getDescription()),this.detailLabel.setText("了解详情"),this.actionBtn.setText("继续看"),this.abandonBtn.setText("残忍离开")}bindEvent(){this.closeBtn.addEventListener("tap",(t=>{this.vm.handleClose()})),this.appIcon.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ICON_CLICK)})),this.nameLabel.addEventListener("tap",(t=>{this.convert(2,{x:0,y:0},g.CLOSE_BULLET_ICON_DESCRIPTION_CLICK)})),this.detailLabel.addEventListener("tap",(t=>{this.convert(1,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.detailContainer.addEventListener("tap",(t=>{this.convert(1,{x:0,y:0},g.CLOSE_BULLET_ACTION_BAR_CLICK)})),this.actionBtn.addEventListener("tap",(t=>{this.vm.handleContinue()})),this.abandonBtn.addEventListener("tap",(t=>{this.vm.handleAbandon()}))}refeshCurrentTIme(t){let e=this.vm.getRewardTime()-Math.floor(t);this.skipTime=e>0?e:0,this.titleLabel.setText("再看"+this.skipTime+"秒，即可获得优惠")}convert(t,e,i){this.vm.handleConvert(t,e,i)}}class pt extends nt{getName(){return function(t){let e=null;try{return e=t.adMatrixInfo.adDataV2.merchantLiveReservationInfo,e.title}catch(i){}return""}(this.vm.adInfo)}getDetailLabelText(){return"立即预约"}}class ut extends it{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&this.setupViews()}setupViews(){this.style={width:271,height:326,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.contentContainer=new TKView,this.contentContainer.style={marginTop:50,paddingTop:30,paddingLeft:32,paddingRight:32,width:"100%",height:243,backgroundColor:"#FFFFFF",borderRadius:12,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(this.contentContainer);let t=new TKView;t.style={height:80,width:"100%",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.contentContainer.appendChild(t),this.titleLabel=new TKText,this.titleLabel.style={width:205,height:20,includeFontPadding:!1,fontSize:18,textAlign:"center",color:"#222222",fontWeight:"bold"},t.appendChild(this.titleLabel),this.titleLabel.setText(this.vm.getNeoConformTips());const e=this;this.covertActionBtn=new TKText,this.covertActionBtn.style={width:"100%",height:48,borderRadius:24,color:"#FFFFFF",backgroundColor:"#FE3666",textAlign:"center",fontSize:15,fontWeight:"bold"},this.covertActionBtn.setText(this.vm.getNeoConformActionDes()),this.contentContainer.appendChild(this.covertActionBtn),this.covertActionBtn.addEventListener("tap",(t=>{e.vm.handleGiftCallAction()}));let i=new TKText;i.style={width:"100%",height:48,borderRadius:24,backgroundColor:"#FFFFFF",borderWidth:1,borderColor:"#FE366680",color:"#FE3666",marginTop:10,fontWeight:"bold",textAlign:"center",fontSize:15},i.setText("留下看看"),this.contentContainer.appendChild(i),i.addEventListener("tap",(t=>{e.vm.handleContinue()})),this.skipBtn=new TKText,this.skipBtn.style={width:80,height:17,fontSize:12,color:"#FFFFFFCC",marginTop:15,backgroundColor:"#FFFFFF00",fontWeight:"bold",textAlign:"center"},this.skipBtn.setText("残忍离开"),this.appendChild(this.skipBtn),this.skipBtn.addEventListener("tap",(t=>{e.vm.handleAbandon()}));let n=new TKView;n.style={width:"100%",height:100,position:"absolute",top:0,flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.appendChild(n);let a=new TKImage;a.setSrc("https://tx-ad.a.yximgs.com/kos/nlav11524/ksad/icon_confirm_present.png"),a.style={width:127,height:100},n.appendChild(a)}refreshActionDes(t){l(t)||this.covertActionBtn.setText(t)}}class gt extends x{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>mt(t,e)})}getData(t){}}function mt(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(i,n)=>"string"!=typeof n||"function"==typeof i[n]||0==n.indexOf("$")?Reflect.get(i,n):mt(t,e+"."+n)})}var ft;!function(t){t[t.Unknow=0]="Unknow",t[t.neoGift=1]="neoGift"}(ft||(ft={}));class It extends gt{constructor(){super(...arguments),this.isPlayAgain=!1,this.currentPlaybackTime=0,this.lifeStatus="none",this.isMoreShow=!1,this.sceneSource=ft.Unknow}checkDataValid(){return!!this.adInfo}refreshCurrentTime(t){}getShowAlertInfo(){let t="观看完整视频即可获取奖励";try{let e=this.adInfo.adRewardInfo.rewardTime;e<this.getVideoDuration()&&(t="观看视频"+e.toString()+"s即可获取奖励")}catch(e){}return t}getVideoDuration(){let t=0;try{let e=this.adInfo;const i=e.adMaterialInfo.materialFeature.length>0?e.adMaterialInfo.materialFeature[0]:null;i&&(t=i.videoDuration,0==t&&(t=i.videoDurationMs/1e3))}catch(e){}return t}getRewardTime(){return J(this.adInfo)}getIconUrl(){try{let t=this.adInfo.adBaseInfo.appIconUrl;return s(t)||(t=this.adInfo.advertiserInfo.portraitUrl),s(t)||(t="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),t}catch(t){}return"https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"}getProductName(){let t="";try{if(Q.isOriginLiveAd(this.adInfo)){let e=Q.obtainVideoLiveData(this.adInfo);t=Q.liveGetAuthorName(e,this.adInfo)}else t=this.adInfo.adProductInfo.name}catch(e){}return t}getDescription(){let t="";try{if(Q.isOriginLiveAd(this.adInfo)){let e=Q.obtainVideoLiveData(this.adInfo);t=Q.liveGetLiveDesc(e,this.adInfo)}else t=this.adInfo.adBaseInfo.adDescription}catch(e){}return t}getAppName(){let t="";try{t=this.adInfo.adBaseInfo.appName}catch(e){}return t}supportSlideClick(){var t;return(null===(t=this.adInfo.adMatrixInfo.adDataV2.dynamicAdStyleInfo)||void 0===t?void 0:t.slideClick)||!1}isEcFollow(){return 3==H(this.adInfo)}isLiveSubscribe(){return function(t){let e=null;try{e=t.adMatrixInfo.adDataV2.merchantLiveReservationInfo}catch(i){return!1}if(l(e))return!1;if(l(e.title)||l(e.liveStartTime)||l(e.bookUserCount))return!1;try{return 2==t.adStyleConfInfo.innerAdType}catch(i){return!1}}(this.adInfo)}isJinniu(){return Y(this.adInfo)}handleAbandon(){}handleContinue(){}handleClose(){}handleGiftCallAction(){}handleConvert(t,e,i){}getNeoConformTips(){var t;if(q(this.adInfo))try{return null!==(t=function(t){let e=j(t,12);if(null!=e)return JSON.parse(e.data)}(this.adInfo).confirmTipsDes)&&void 0!==t?t:"为你推荐更多精彩内容"}catch(e){console.log("TK endCardInfo confirmTipsDes error")}try{return this.adInfo.adMatrixInfo.adDataV2.confirmTKInfo.tipsDes}catch(e){console.log("TK endCardInfo getNeoConformTips error")}return"为你推荐更多精彩内容"}getNeoConformActionDes(){return function(t){if(l(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return l(e)&&(e=function(t){try{return 1==t.adBaseInfo.adOperationType}catch(e){}return!1}(t)?"立即下载":"查看详情"),e}(this.adInfo)}getNeoConfirmCardType(){try{return this.adInfo.adMatrixInfo.adDataV2.confirmTKInfo.cardType}catch(t){console.log("TK endCardInfo getNeoConfirmCardType error")}return 1}getRetainCodeType(){switch(z(this.adInfo)){case 9:return V.RETAIN_CARD_TYPE_7;case 10:return V.RETAIN_CARD_TYPE_5;case 5:return V.RETAIN_CARD_TYPE_8;case 6:return V.RETAIN_CARD_TYPE_9;case 7:return V.RETAIN_CARD_TYPE_10;case 8:return V.RETAIN_CARD_TYPE_11;default:return}}neoGiftPopupExposure(t=!1){if(this.isMoreShow)return;let e;switch(this.isMoreShow=!0,z(this.adInfo)){case 9:case 10:case 5:case 6:case 7:case 8:if(e={elementType:149,retain_code_type:this.getRetainCodeType()},10==z(this.adInfo)){let t=new M;t.universe_feature_freq=6,e.clientExtData=JSON.stringify(t)}else if(9!=z(this.adInfo)){let t=new M;t.universe_feature_freq=10,e.clientExtData=JSON.stringify(t)}let t={actionType:140,payload:JSON.stringify(e)};p.sendLog(t);break;default:ot.log(140,{x:0,y:0},{elementType:149})}}}class Tt extends It{getData(t){let e=[];e.push(p.getKsAdDataAsync()),e.push(p.getDeviceInfoAsync()),e.push(p.getKsAdConfigAsync()),e.push(p.getContainerLimitAsync()),e.push(p.getScreenOrientationAsync()),a()&&e.push(p.getTKPreEnvAsync()),Promise.all(e).then((e=>{try{const s=e[0].data,o=e[1].data,r=e[2].data,l=e[3].data,h=e[4].data;if(this.adInfo=s.impAdInfo[0].adInfo[0],this.adStyle=s.impAdInfo[0].adStyle,this.screenOrientation=h.screenOrientation,this.configInfo=r,this.containerLimit=l,this.screenOrientation=h.screenOrientation,a())try{const t=e[5].data;this.isMoreShow=t.isMoreShow}catch(n){this.isMoreShow=!1}i(o),this.registerLifeCycleListener(),t&&t(!0)}catch(n){t&&t(!1)}}))}registerLifeCycleListener(){p.registerLifecycleListener((t=>{if(t&&t.data){const e=t.data.lifeStatus;this.lifeStatus=e}}))}refreshCurrentTime(t){p.registerVideoProgressListener((e=>{if(e.data.failed)t(0);else if(e.data.finished)t(0);else{const i=e.data.currentTime;t(i)}}))}handleAbandon(){let t={elementType:151};this.sceneSource==ft.neoGift&&(t.retain_code_type=this.getRetainCodeType());let e={actionType:141,payload:JSON.stringify(t)};p.sendLog(e),p.skipVideo(!1,!0,this.currentPlaybackTime)}handleContinue(){let t={elementType:150};this.sceneSource==ft.neoGift&&(t.retain_code_type=this.getRetainCodeType());let e={actionType:451,payload:JSON.stringify(t)};p.sendLog(e),p.closeTKDialog("ksad-video-confirm-card")}handleClose(){p.sendLog({actionType:3}),p.closeTKDialog("ksad-video-confirm-card")}handleConvert(t,e,i){ot.convertIfNeeded(1,this.adInfo,t,e,i)}handleShowPlayAgain(){p.showPlayAgain()}}(new class extends u{constructor(){super(),this.vm=new Tt}setupViews(){this.rootView.style={width:"100%",height:"100%",backgroundColor:"#00000080",alignItems:"center",justifyContent:"center"},this.setupContentView(),this.contentView||(this.vm.configInfo.abConfig.rewardContentDetainType?(1==this.vm.getNeoConfirmCardType()?this.contentView=new ct(this.vm):this.contentView=new ut(this.vm),this.vm.sceneSource=ft.neoGift):this.contentView=new ht(this.vm)),this.vm.neoGiftPopupExposure(),this.rootView.appendChild(this.contentView)}setupContentView(){let t=z(this.vm.adInfo);Q.isEcOrder(this.vm.configInfo,this.vm.adInfo)&&2==t?this.contentView=new nt(this.vm):Q.isOriginLiveAd(this.vm.adInfo)?this.contentView=new nt(this.vm,!0,!0):7==H(this.vm.adInfo)||function(t){return 6==H(t)}(this.vm.adInfo)?this.contentView=new lt(this.vm):d.supportMinimumVersion("3.3.26","3.3.30")&&this.vm.isEcFollow()?this.contentView=new dt(this.vm):this.vm.isLiveSubscribe()?this.contentView=new pt(this.vm,!0):this.vm.isJinniu()&&(this.contentView=new Ct(this.vm))}render(){if(!super.render())return!1;try{this.vm.getData((t=>{if(t)try{this.setupViews(),Tachikoma.render(this.rootView),this.updateRenderStatus(1,"")}catch(e){this.updateRenderStatus(0,n(e))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,n(t))}return!0}}).render()})();
//# sourceMappingURL=ksad-video-confirm-card.118.js.map