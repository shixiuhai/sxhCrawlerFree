(()=>{"use strict";class t{static saveLocal(t,e){if("undefined"!=typeof TKLocalStorage&&y.supportMinimumTKVersion("4.0.0"))try{(new TKLocalStorage).set(t,e)}catch(a){}}static getLocalString(t){if("undefined"!=typeof TKLocalStorage&&y.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return e.toString()}catch(e){}return null}static getLocalInt(t){if("undefined"!=typeof TKLocalStorage&&y.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Number.parseInt(e.toString())}catch(e){}return 0}static getLocalBoolean(t){if("undefined"!=typeof TKLocalStorage&&y.supportMinimumTKVersion("4.0.0"))try{let e=(new TKLocalStorage).get(t);if(e)return Boolean(e.toString)}catch(e){}return!1}}let e=null;const a="TKResIndexKey";class i{constructor(){var e,i,n;this.defaultHost="p1-lm.adukwai.com",this.currentIndex=0;let s=null===(n=null===(i=null===(e=h())||void 0===e?void 0:e.appConfig)||void 0===i?void 0:i.idc)||void 0===n?void 0:n.tkres;s&&0!=s.length||(s=["p1-lm.adukwai.com","p2-lm.adukwai.com"]),this.resList=s;let l=t.getLocalInt(a);l>s.length&&(l=0),this.currentIndex=l}static getInstance(){return e||(e=new i),e}getCurrentHost(){return this.currentIndex>=this.resList.length?this.defaultHost:this.resList[this.currentIndex]}markUrlFail(e){if(!(e.indexOf(this.getCurrentHost())<0||"undefined"!=typeof KSAdTKNetworkManager&&0==KSAdTKNetworkManager.getCurrentNetworkType())){const e=this.currentIndex;this.currentIndex=++this.currentIndex%this.resList.length,this.currentIndex!==e&&t.saveLocal(a,this.currentIndex)}}}var n=null,s=null,l=null,r=null,o=null;function c(t){console.log("tkloadcontroller  save global device info:"+JSON.stringify(t)),n=t}function d(){return o}function C(){return n}function h(){return s}function u(){return r}function I(){const t=Tachikoma.env.styleTemplate;return t?JSON.parse(t):null}function _(t){return t instanceof Error?t.stack?t.stack:t.message:"string"==typeof t?t:"number"==typeof t?t+"":"unknown"}function g(){return!L(Tachikoma.env.hasTKBridge)&&1==Tachikoma.env.hasTKBridge}function T(){return"Android"===Tachikoma.env.platform}function p(t){return"string"==typeof t&&t.length>0}function m(){return n?n.tkVersion:Tachikoma.env.tkVersion||Tachikoma.env.TKVersion}function A(){return n?n.SDKVersion:Tachikoma.env.SDKVersion}function f(){return n?n.sdkType:Tachikoma.env.sdkType}function L(t){return null===t||null==t||""===t}new class{};class v{constructor(t,e,a){this.name=t,this.object=e,this.parent=a,this.children=new Map}addChildren(t,e){this.children.set(t,e)}}function E(t,e,a){if(t){e||(e=new v("root",t)),a||(a=new Set),a.add(t);for(const i in t){const n=typeof t[i],s=t[i];if("object"==n&&!i.includes("$")&&s){s.nativeID||(s.nativeID=i);const t=new v(i,s,e);if(e.addChildren(i,t),a.has(s)){const e=[];e.push(t);let a=t,i=!1;for(;a.parent;)if(a=a.parent,e.push(a),a.object===t.object){i=!0;break}if(i){let t="执行出错：发生循环引用\n";for(let i=e.length-1;i>=0;--i)a=e[i],t+=a.name+":"+a.object+"\n";throw new Error(t)}}E(s,t,a)}}}}function N(t){let e=t;return e.indexOf("/")>=0||t.startsWith("http")||(e="https://"+i.getInstance().getCurrentHost()+"/kos/nlav111362/ksad/"+t),e}function D(t,e){!function(t,e,a){if(t&&e){const n=N(e);t.setImageLoadCallback&&!L(n)&&n.startsWith("http")&&t.setImageLoadCallback((t=>{i.getInstance().markUrlFail(n),a&&a(t)})),t.setSrc(n)}}(t,e,null)}class y{static isAndroid(){return"Android"===this.platform}static isSupportDownloadProgressListen(){return this.isAndroid()||y.supportMinimumTKVersion("5.0.4")}static isSupportDownloadDel(){return this.isAndroid()&&y.supportMinimumTKVersion("5.0.7")}static getCurrentTimeStamp(){return(new Date).getTime()}static getSemiCircle(){return this.isAndroid()?180:Math.PI}static getRotateSemiCircle(){return this.isAndroid()?45:Math.PI}static compareVersion(t,e){if(void 0===t&&void 0===e)return 0;if(void 0===t)return-1;if(void 0===e)return 1;let a=t.split("."),i=e.split("."),n=Math.max(a.length,i.length);for(var s=0;s<n;s++){let t=Number(void 0!==a[s]?a[s]:"0"),e=Number(void 0!==i[s]?i[s]:"0");if(t>e)return 1;if(t!=e)return-1}return 0}static supportMinimumVersion(t="0.0.0",e="0.0.0"){let a=f(),i=1==a&&-1!=y.compareVersion(A(),t),n=2==a&&-1!=y.compareVersion(A(),e);return i||n}static supportCurrentVersion(t="0.0.0",e="0.0.0"){let a=f(),i=1==a&&0==y.compareVersion(A(),t),n=2==a&&0==y.compareVersion(A(),e);return i||n}static supportCurrentTKVersion(t="0.0.0"){return m()==t}static supportMinimumTKVersion(t="0.0.0"){return-1!=y.compareVersion(m(),t)}}y.platform=Tachikoma.env.platform;N("h5_default_icon.png"),N("download_default_icon.png");var k,R,b,K;!function(t){t[t.NONE=-1]="NONE",t[t.ACTION_BAR_CLICK=1]="ACTION_BAR_CLICK",t[t.UNKNOWN_ITEM_CLICK=0]="UNKNOWN_ITEM_CLICK",t[t.PORTRAIT_CLICK=13]="PORTRAIT_CLICK",t[t.COMMENT_CLICK=14]="COMMENT_CLICK",t[t.PLAY_END_ICON_CLICK=15]="PLAY_END_ICON_CLICK",t[t.PLAY_END_ICON_TITLE_CLICK=16]="PLAY_END_ICON_TITLE_CLICK",t[t.PLAY_END_ICON_DESCRIPTION_CLICK=17]="PLAY_END_ICON_DESCRIPTION_CLICK",t[t.COMMENT_DETAIL_CLICK=25]="COMMENT_DETAIL_CLICK",t[t.PLAY_END_ACTION_BAR_CLICK=26]="PLAY_END_ACTION_BAR_CLICK",t[t.CARD_ACTION_BAR_CLICK=29]="CARD_ACTION_BAR_CLICK",t[t.CARD_ICON_CLICK=30]="CARD_ICON_CLICK",t[t.CARD_ICON_NAME_CLICK=31]="CARD_ICON_NAME_CLICK",t[t.CARD_ICON_COMMENT_CLICK=32]="CARD_ICON_COMMENT_CLICK",t[t.CARD_BLANK_AREA_CLICK=35]="CARD_BLANK_AREA_CLICK",t[t.CARD_PLAY_END_CLICK1=37]="CARD_PLAY_END_CLICK1",t[t.CARD_PLAY_END_CLICK2=38]="CARD_PLAY_END_CLICK2",t[t.PLAY_END_CALL_CLICK=39]="PLAY_END_CALL_CLICK",t[t.PLAY_DETAIL_CALL_CLICK=40]="PLAY_DETAIL_CALL_CLICK",t[t.PLAY_END_GIFT_CLICK=41]="PLAY_END_GIFT_CLICK",t[t.CARD_APP_STORE_CLICK=45]="CARD_APP_STORE_CLICK",t[t.CARD_APP_DOWNLOAD_NUM_CLICK=46]="CARD_APP_DOWNLOAD_NUM_CLICK",t[t.CARD_OTHERAREA_CLICK=53]="CARD_OTHERAREA_CLICK",t[t.CARD_ICON_MOBILE_CLICK=54]="CARD_ICON_MOBILE_CLICK",t[t.CARD_PICTURE_CLICK_ONE=57]="CARD_PICTURE_CLICK_ONE",t[t.CARD_PICTURE_CLICK_TWO=58]="CARD_PICTURE_CLICK_TWO",t[t.CARD_PICTURE_CLICK_THREE=59]="CARD_PICTURE_CLICK_THREE",t[t.CARD_PICTURE_TITLE_CLICK_ONE=60]="CARD_PICTURE_TITLE_CLICK_ONE",t[t.CARD_PICTURE_TITLE_CLICK_TWO=61]="CARD_PICTURE_TITLE_CLICK_TWO",t[t.CARD_PICTURE_TITLE_CLICK_THREE=62]="CARD_PICTURE_TITLE_CLICK_THREE",t[t.CARD_PICTURE_SUBTITLE_CLICK_ONE=63]="CARD_PICTURE_SUBTITLE_CLICK_ONE",t[t.CARD_PICTURE_SUBTITLE_CLICK_TWO=64]="CARD_PICTURE_SUBTITLE_CLICK_TWO",t[t.CARD_PICTURE_SUBTITLE_CLICK_THREE=65]="CARD_PICTURE_SUBTITLE_CLICK_THREE",t[t.CARD_RANK_CLICK=75]="CARD_RANK_CLICK",t[t.CARD_DOWNLOAD_CNT_CLICK=76]="CARD_DOWNLOAD_CNT_CLICK",t[t.CARD_TAG_CLICK=77]="CARD_TAG_CLICK",t[t.CARD_ITEM_BULLET_CLICK=80]="CARD_ITEM_BULLET_CLICK",t[t.CARD_RECOMMEND_REASON_CLICK=84]="CARD_RECOMMEND_REASON_CLICK",t[t.CARD_PAGE_CLICK=85]="CARD_PAGE_CLICK",t[t.COMMON_CARD_CLICK=89]="COMMON_CARD_CLICK",t[t.COMMENT_PICTURE_CLICK=100]="COMMENT_PICTURE_CLICK",t[t.PLAYEND_ICON_OTHERAREA_CLICK=104]="PLAYEND_ICON_OTHERAREA_CLICK",t[t.INTERACT_LANDING_PAGE_CLICK=110]="INTERACT_LANDING_PAGE_CLICK",t[t.ACTIONBAR_ICON_CLICK=115]="ACTIONBAR_ICON_CLICK",t[t.ACTIONBAR_ICON_COMMENT_CLICK=117]="ACTIONBAR_ICON_COMMENT_CLICK",t[t.ACTIONBAR_ICON_OTHER_AREA_CLICK=118]="ACTIONBAR_ICON_OTHER_AREA_CLICK",t[t.CLOSE_BULLET_ICON_CLICK=127]="CLOSE_BULLET_ICON_CLICK",t[t.CLOSE_BULLET_ICON_TITLE_CLICK=128]="CLOSE_BULLET_ICON_TITLE_CLICK",t[t.CLOSE_BULLET_ICON_DESCRIPTION_CLICK=129]="CLOSE_BULLET_ICON_DESCRIPTION_CLICK",t[t.CLOSE_BULLET_OTHERAREA_CLICK=130]="CLOSE_BULLET_OTHERAREA_CLICK",t[t.CLOSE_BULLET_ACTION_BAR_CLICK=131]="CLOSE_BULLET_ACTION_BAR_CLICK",t[t.SPLASH_CONVERSION_BUTTON_CLICK=132]="SPLASH_CONVERSION_BUTTON_CLICK",t[t.NEO_AUTO_SHOW_STOREKIT=147]="NEO_AUTO_SHOW_STOREKIT",t[t.CARD_LEFT_ACTION_BAR_CLICK=150]="CARD_LEFT_ACTION_BAR_CLICK",t[t.CARD_SWIPE_CONVERT=153]="CARD_SWIPE_CONVERT",t[t.ONLINE_AUDIENCE_NUM=154]="ONLINE_AUDIENCE_NUM",t[t.SHAKE_ICON_SHACK=157]="SHAKE_ICON_SHACK",t[t.SHAKE_BIG_ICON_CLICK=158]="SHAKE_BIG_ICON_CLICK",t[t.ROTATE_ICON_ROTATE=161]="ROTATE_ICON_ROTATE",t[t.ROTATE_BIG_ICON_CLICK=162]="ROTATE_BIG_ICON_CLICK",t[t.CARD_TROLLEY_ICON_CLICK=164]="CARD_TROLLEY_ICON_CLICK",t[t.LANDING_PAGE_OTHER_AREA_CLICK=171]="LANDING_PAGE_OTHER_AREA_CLICK",t[t.CARD_FOLLOW_NUM=172]="CARD_FOLLOW_NUM",t[t.FALL_ICON_CLICK=173]="FALL_ICON_CLICK",t[t.LIVE_BUTTON_CLICK=175]="LIVE_BUTTON_CLICK",t[t.DIRECT_H5_PAGE_CLICK=177]="DIRECT_H5_PAGE_CLICK",t[t.GOODS_ITEM_CARD_CLICK=178]="GOODS_ITEM_CARD_CLICK",t[t.GOODS_ITEM_CARD_SLIDE_CLICK=179]="GOODS_ITEM_CARD_SLIDE_CLICK",t[t.ITEM_HOT_BUY_STYLE_CLICK=180]="ITEM_HOT_BUY_STYLE_CLICK",t[t.GUIDE_ENTER_LIVE_CLICK=181]="GUIDE_ENTER_LIVE_CLICK",t[t.AUTO_CLICK_OTHER_AREA=182]="AUTO_CLICK_OTHER_AREA",t[t.POPLAY_FALL_IOCN=186]="POPLAY_FALL_IOCN",t[t.ROTATE_SHAKE_BIG_ICON_CLICK=187]="ROTATE_SHAKE_BIG_ICON_CLICK",t[t.RETAIN_AGG_CARD_CLICK=189]="RETAIN_AGG_CARD_CLICK",t[t.PLAYEND_AGG_CARD_CLICK=190]="PLAYEND_AGG_CARD_CLICK",t[t.SURPRISE_BOX_CLICK=191]="SURPRISE_BOX_CLICK",t[t.BUBBLE_RAIN_CLICK=192]="BUBBLE_RAIN_CLICK"}(k||(k={})),function(t){t[t.adClickReward=1]="adClickReward"}(R||(R={})),function(t){t[t.isRewarded=1]="isRewarded",t[t.noExtraReward=2]="noExtraReward",t[t.hasWatchReward=3]="hasWatchReward"}(b||(b={})),function(t){t[t.horizontal=1]="horizontal",t[t.vertical=2]="vertical"}(K||(K={}));var w,O,S,P;!function(t){t[t.THREEIMG_DEFAULT_CLICK=0]="THREEIMG_DEFAULT_CLICK",t[t.THREEIMG_FIRST_CLICK=1]="THREEIMG_FIRST_CLICK",t[t.THREEIMG_SECOND_CLICK=2]="THREEIMG_SECOND_CLICK",t[t.THREEIMG_THIRD_CLICK=3]="THREEIMG_THIRD_CLICK"}(w||(w={})),function(t){t[t.picStyle=1]="picStyle",t[t.textStyle=2]="textStyle"}(O||(O={})),function(t){t.START="start",t.CENTRT="center",t.END="end"}(S||(S={})),function(t){t[t.unknown=0]="unknown",t[t.DetailOne=1]="DetailOne",t[t.Simple=2]="Simple",t[t.DetailTwo=3]="DetailTwo"}(P||(P={}));var M,V;!function(t){t[t.RETAIN_CARD_TYPE_1=8]="RETAIN_CARD_TYPE_1",t[t.RETAIN_CARD_TYPE_2=9]="RETAIN_CARD_TYPE_2",t[t.RETAIN_CARD_TYPE_3=10]="RETAIN_CARD_TYPE_3",t[t.RETAIN_CARD_TYPE_4=11]="RETAIN_CARD_TYPE_4",t[t.RETAIN_CARD_TYPE_5=14]="RETAIN_CARD_TYPE_5",t[t.RETAIN_CARD_TYPE_7=16]="RETAIN_CARD_TYPE_7",t[t.RETAIN_CARD_TYPE_8=17]="RETAIN_CARD_TYPE_8",t[t.RETAIN_CARD_TYPE_9=18]="RETAIN_CARD_TYPE_9",t[t.RETAIN_CARD_TYPE_10=19]="RETAIN_CARD_TYPE_10",t[t.RETAIN_CARD_TYPE_11=20]="RETAIN_CARD_TYPE_11"}(M||(M={}));class x{}!function(t){t[t.UNKNOWN_LIVE_ROOM_PATTERN=0]="UNKNOWN_LIVE_ROOM_PATTERN",t[t.STANDARD_LIVE_ROOM_PATTERN=1]="STANDARD_LIVE_ROOM_PATTERN",t[t.SIMPLIFIED_LIVE_ROOM_PATTERN=2]="SIMPLIFIED_LIVE_ROOM_PATTERN"}(V||(V={}));class W{}var B,U,F;!function(t){t[t.LIVE_CUT3_STYLE1=11]="LIVE_CUT3_STYLE1",t[t.LIVE_CUT3_STYLE2=12]="LIVE_CUT3_STYLE2"}(B||(B={})),function(t){t[t.LIVE_CUT3_STYLE2=1]="LIVE_CUT3_STYLE2"}(U||(U={})),function(t){t[t.unkonwn=0]="unkonwn",t[t.videoPromoteFollow=1]="videoPromoteFollow",t[t.videoPromoteGoods=2]="videoPromoteGoods",t[t.liveGoods=3]="liveGoods",t[t.liveNotGoods=4]="liveNotGoods",t[t.videoAd=5]="videoAd"}(F||(F={}));const G=new class{constructor(){this.enabled=!1,this.logs=[]}setLoggerEnabled(t){this.enabled=t}log(t){if(this.enabled){const e=new Date;0==this.logs.length&&this.logs.push(e.getMonth()+1+":"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),this.logs.push(e.getMilliseconds()+":"+t)}}clear(){this.logs.splice(0,this.logs.length)}exportLog(){return JSON.stringify(this.logs)}};class H{static randomString(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a="",i=0;i<t;i++)a+=e.charAt(Math.floor(48*Math.random()));return a}static randomName(t){return"jscb_"+t+"_"+this.randomString(4)+this.globalIndex++}static registerCallback(t,e=!0){return this.registerCallbackForAction(t,e,"")}static registerCallbackForAction(t,e=!0,a){if(!t)return null;const i=this.randomName(a);return Tachikoma[i]=e=>{t(e)},"Tachikoma."+i}}H.globalIndex=0;class Y{static getDeviceInfoAsync(){return Y.callNative("getDeviceInfo",null).then((t=>(t.result&&t.data&&c(t.data),t)))}static getKsAdDataAsync(){return Y.callNative("getKsAdData",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,r=e),t}))}static getKsAdConfigAsync(){return Y.callNative("getKsAdConfig",null).then((t=>{var e;return t.result&&t.data&&(e=t.data,s=e),t}))}static getScreenOrientationAsync(){return Y.callNative("getScreenOrientation",null)}static getVideoCloseTime(){return Y.callNative("getVideoCloseTime",null)}static getContainerLimitAsync(){return Y.callNative("getContainerLimit",null)}static getTKPreEnvAsync(){return Y.callNative("getTKPreEnv",null)}static getDeviceInfo(t){this.callNativeWithCallback("getDeviceInfo",null,t)}static getKsAdData(t){this.callNativeWithCallback("getKsAdData",null,t)}static getKsAdConfig(t){this.callNativeWithCallback("getKsAdConfig",null,t)}static getScreenOrientation(t){this.callNativeWithCallback("getScreenOrientation",null,t)}static getContainerLimit(t){return this.callNativeWithCallback("getContainerLimit",null,t)}static registerLifecycleListener(t){this.lifeStatusCallback=t,this.callNativeWithCallback("registerLifecycleListener",null,(t=>{this.lifeStatusCallback&&!this.isForceUpdateLifeStatus&&this.lifeStatusCallback(t)}),!1)}static forceUpdateLifeStatus(t,e){let a={result:1,data:{lifeStatus:t}};this.isForceUpdateLifeStatus=e,this.lifeStatusCallback&&this.lifeStatusCallback(a)}static registerFocusListener(t){y.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("registerFocusListener",null,t,!1)}static registerNativeId(t){this.callNativeWithCallback("configNativeId",null,t,!1)}static registerExtraDataListener(t){this.callNativeWithCallback("getKsAdExtraData",null,t,!1)}static hideCard(t,e,a,i=!0){this.callNativeWithCallback("hide",{type:t,playDuration:e},a,i)}static sendLog(t,e){this.callNativeWithCallback("log",t,e)}static sendCommonLog(t,e){this.callNativeWithCallback("commonLog",t,e)}static sendCommercialLog(t,e){this.callNativeWithCallback("commercialLog",t,e)}static adOutCallback(t,e){y.supportMinimumTKVersion("5.0.6")&&this.callNativeWithCallback("adOutCallback",t,e)}static pageStatus(t,e){this.callNativeWithCallback("pageStatus",{status:t,errorMsg:p(e)?e:""})}static clickActionBase(t,e){this.callNativeWithCallback("clickAction",t,e)}static convert(t){this.callNativeWithCallback("convert",{clickActionButton:t})}static updateExceptedPosition(t){this.callNativeWithCallback("initKsAdFrame",t)}static replayVideo(){this.callNativeWithCallback("replayVideo")}static registerVideoListener(t){this.callNativeWithCallback("registerVideoListener",null,t,!1)}static dislike(){this.callNativeWithCallback("dislike")}static registerProgressListener(t){this.callNativeWithCallback("registerProgressListener",null,(e=>{t&&t(e)}),!1)}static registerVideoProgressListener(t){this.callNativeWithCallback("registerVideoProgressListener",null,t,!1)}static registerGetDynamicActionDesListener(t){this.callNativeWithCallback("getDynamicActionDes",null,t,!1)}static registerTimerListener(t){this.callNativeWithCallback("registerTimerListener",null,t,!1)}static registerVideoMuteStateListener(t){this.callNativeWithCallback("registerMuteStateListener",null,t,!1)}static registerVideoAutoPlayListener(t){this.callNativeWithCallback("registerVideoAutoPlayListener",null,t,!1)}static registerPlayStateResetListener(t){this.callNativeWithCallback("registerPlayStateResetListener",null,t,!1)}static updateVideoMuteState(t){this.callNativeWithCallback("updateVideoMuteState",{muted:t})}static skipVideo(t,e,a,i=0){this.callNativeWithCallback("skipVideo",{needPromopt:t,needReport:e,showTime:a,playDuration:i})}static closeVideo(t){this.callNativeWithCallback("closeVideo",{forceClose:t})}static showPlayEnd(t,e=0){this.callNativeWithCallback("showPlayEnd",{userForce:t,type:e})}static showPlayable(t=0){this.callNativeWithCallback("showPlayable",{playableSource:t})}static registerSceneChangeListener(t){this.callNativeWithCallback("registerSceneChangeListener",null,t,!1)}static hasReward(t){this.callNativeWithCallback("hasReward",{severCheckResult:t})}static clickGift(){this.callNativeWithCallback("clickGift")}static clickCall(t){this.callNativeWithCallback("clickCall",{isEnd:t})}static callButtonImpressionWhenPlay(){this.callNativeWithCallback("callButtonImpressionWhenPlay")}static callButtonImpressionWhenFinish(){this.callNativeWithCallback("callButtonImpressionWhenFinish")}static registerDeepRewardListener(t){this.callNativeWithCallback("registerDeepRewardListener",null,t,!1)}static giveRewardInAdvance(t){this.callNativeWithCallback("giveRewardInAdvance",null,t,!1)}static showLiveEndPage(t){this.callNativeWithCallback("showLiveEndPage",null,t,!1)}static updateRewardTaskState(t){this.callNativeWithCallback("updateRewardTaskState",null,t,!1)}static openURL(t,e,a){this.callNativeWithCallback("openURL",{url:t,title:e,showConfirmDialog:a})}static showTKDialog(t){this.callNativeWithCallback("showTKDialog",{templateId:t})}static closeTKDialog(t){this.callNativeWithCallback("closeTKDialog",{templateId:t})}static registerKeyboardChangeListener(t){this.callNativeWithCallback("registerKeyboardChangeListener",null,t,!1)}static registerShakeListener(t){this.callNativeWithCallback("registerMotionListener",null,t,!1)}static close(t){this.callNativeWithCallback("close",null,t,!1)}static closePassData(t,e){this.callNativeWithCallback("close",t,e,!1)}static registerConvertStatusListener(t){this.callNativeWithCallback("registerConvertStatusListener",null,t,!1)}static cardImpression(){this.callNativeWithCallback("cardImpression")}static getCardShowCount(t){this.callNativeWithCallback("getCardShowCount",null,t,!1)}static getNativeData(t,e){this.callNativeWithCallback("getNativeData",{target:t},e,!1)}static updateExtraReward(t){this.callNativeWithCallback("updateExtraReward",t)}static registerApkInstalledListener(t){this.callNativeWithCallback("registerApkInstalledListener",null,t,!1)}static showToast(t){this.callNativeWithCallback("showToast",{message:t})}static registerExtraDialogListener(t){this.callNativeWithCallback("registerExtraDialogListener",null,t,!1)}static getPlayEndType(t){this.callNativeWithCallback("getPlayEndType",null,t,!1)}static playableConvert(t){this.callNativeWithCallback("playableConvert",t)}static getKsPlayableAdData(t){this.callNativeWithCallback("getKsPlayableAdData",null,t)}static getKsPlayableDeviceInfo(t){this.callNativeWithCallback("getKsPlayableDeviceInfo",null,t)}static registerPlayableStatusListener(t){this.callNativeWithCallback("registerPlayableStatusListener",null,t,!1)}static getTrackAdStatus(t){this.callNativeWithCallback("getTrackAdStatus",null,t,!1)}static showLandingPage(t){this.callNative("showLandingPage",{needCloseNeo:t})}static needCloseNeo(t){this.callNativeWithCallback("needCloseNeo",{needClose:t})}static registerBackPressed(t){T()&&this.callNativeWithCallback("registerBackPressedListener",null,t,!1)}static innerAdImpression(){this.callNativeWithCallback("adImpression",null)}static neoDidShowPlayAgain(){this.callNativeWithCallback("neoDidShowPlayAgain")}static showPlayAgain(){this.callNativeWithCallback("showPlayAgain")}static registerAggregationDataListener(t){this.callNativeWithCallback("registerAggregationDataListener",null,t,!1)}static getLandingPageInfo(t){this.callNativeWithCallback("getLandingPageInfo",null,t,!1)}static registerNeoStatusListener(t){this.callNativeWithCallback("registerNeoStatusListener",null,t,!1)}static callNative(t,e){return new Promise(((a,i)=>this.callNativeWithCallback(t,e,(t=>{t?(1!=t.result&&(t.result=null),a(t)):a({result:0,data:null})}))))}static callNativeWithCallback(t,e,a,i=!0){const n=g()?1:0;g()&&"pageStatus"==t||g()&&"registerLifecycleListener"==t?this.callNativeWithCallbackAndType(t,e,a,i,0):this.callNativeWithCallbackAndType(t,e,a,i,n)}static callTKWithCallback(t,e,a,i=!0){this.callNativeWithCallbackAndType(t,e,a,i,1)}static callNativeWithCallbackAndType(t,e,a,i=!0,n=0){if("undefined"==typeof KwaiAd)return G.log("undefined value KwaiAd"),void(a&&a({result:0,data:null}));G.log("call:"+t);let s=e=>{let i=0,n=null;try{let t=null;t="string"==typeof e?JSON.parse(e):e,i=t.result,n=t.data}catch(s){i=0,n=null}G.log("cb:"+t+"  r:"+i),a&&a({result:i,data:n})};const l=H.registerCallbackForAction(s,i,t),r={action:t,data:JSON.stringify(e||{}),callback:!0===Tachikoma.env.useNewBridge?s:l};0==n?KwaiAd.callAdBridge(r):KwaiAd.callTKBridge(r)}}class J{static isClickReward(t,e){try{let a=!0;if(y.isAndroid()&&!L(e)&&(a=e.sdkApiVersionCode>=3032401),t.adBaseInfo.extraClickReward&&a)return!0}catch(a){}return!1}static isEcOrder(t,e){try{return 1==t.abConfig.ecRewardAdKwaishopStyle&&(4==e.adStyleConfInfo.innerAdType||5==e.adStyleConfInfo.innerAdType)}catch(a){}return!1}static isOriginLiveAd(t){return 1==t.adBaseInfo.universeLiveType&&0!=t.advertiserInfo.userId}static getAuthorId(t){return t.advertiserInfo.userId}static getLiveStreamId(t){return t.adBaseInfo.liveStreamId}static getIconUrl(t){let e=t.adBaseInfo.appIconUrl;return!L(e)&&J.isDownloadInteraction(t)||(e=t.advertiserInfo.portraitUrl),L(e)&&(e="https://static.yximgs.com/udata/pkg/ad-universe/universe_icon.png"),e}static isDownloadInteraction(t){return 1==t.adBaseInfo.adOperationType}static getAdTitle(t){let e=null;try{e=1==t.adBaseInfo.adOperationType?t.adBaseInfo.appName:t.adBaseInfo.productName,e=p(e)?e:t.advertiserInfo.rawUserName}catch(a){}return e=p(e)?e:"可爱的广告君",e}static getAdActionDesc(t){if(L(t))return"查看详情";let e=t.adBaseInfo.adActionDescription;return L(e)&&(e=this.isDownloadInteraction(t)?"立即下载":"查看详情"),e}static obtainVideoLiveData(t){let e=Z(t,14);return JSON.parse(e.data)}static liveGetAuthorName(t,e){let a="";try{a=t.neoLiveAuthorInfoData.authorName}catch(i){}try{L(a)&&(a=t.neoLiveCartDetailData.authorName)}catch(i){}try{L(a)&&(a=e.adBaseInfo.appName)}catch(i){}return a}static liveGetLiveDesc(t,e){let a="";try{a=t.neoLiveCartDetailData.liveDesc}catch(i){}try{L(a)&&(a=t.neoLiveAuthorInfoData.liveDesc)}catch(i){}try{L(a)&&(a=t.adDescription)}catch(i){}try{L(a)&&(a=e.adBaseInfo.adDescription)}catch(i){}return a}static getNeoActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.neoTKInfo.actionBarCardType;if(!L(e))return e}catch(e){}return null}static getFullscreenActionBarCardType(t){try{let e=t.adMatrixInfo.adDataV2.fullScreenInfo.actionBarCardType;if(!L(e))return e}catch(e){}return null}static getNeoAutoDialogType(t){try{let e=0,a=$(t);e=1==a?t.adMatrixInfo.adDataV2.neoTKInfo.neoAutoDialogType:2==a?t.adMatrixInfo.adDataV2.videoImageTKInfo.neoAutoDialogType:0,1!=e&&2!=e&&(e=0);let i=function(t){if(null==t)return null;try{let e=null,a=$(t);if(2==a?e=Q(t,16):1==a&&(e=Q(t,12)),e){let a=it(e,t);return JSON.parse(a.data).neoAutoDialog}}catch(e){}return null}(t);return 1==e&&L(i.neoAutoDialogGiftPic)&&L(i.neoAutoDialogGiftTitle)&&(e=0),e}catch(e){}return 0}static hasNeoAutoDialog(t){let e=J.getNeoAutoDialogType(t);return!L(e)&&0!=e}}function j(t,e){if(!(null==t?void 0:t.impAdInfo)||0==t.impAdInfo.length)return null;let a=null;if(e)for(let i=0;i<t.impAdInfo.length;++i){let n=t.impAdInfo[i];if(n.adInfo.length>0&&n.adInfo[0].adBaseInfo.creativeId==e){a=n;break}}return a||(a=t.impAdInfo[0]),a}function z(t){var e;return(null===(e=null==t?void 0:t.adInfo)||void 0===e?void 0:e.length)>0?t.adInfo[0]:null}function $(t){try{return t.adMaterialInfo.materialFeature[0].featureType}catch(e){}return 0}function X(t){try{return t.adStyleConfInfo.innerAdType}catch(e){}return 0}function Q(t,e){let a;try{switch(e){case 1:a=t.adMatrixInfo.adDataV2.middleTKCardInfo.templateId;break;case 12:a=t.adMatrixInfo.adDataV2.neoTKInfo.templateId;break;case 3:a=t.adMatrixInfo.adDataV2.fullScreenInfo.templateId;break;case 2:a=t.adMatrixInfo.adDataV2.interstitialCardInfo.templateId;break;case 4:a=t.adMatrixInfo.adDataV2.topFloorTKInfo.templateId;break;case 6:case 9:a=t.adMatrixInfo.adDataV2.actionBarTKInfo.templateId;break;case 5:a=t.adMatrixInfo.adDataV2.splashPlayCardTKInfo.templateId;break;case 7:a=t.adMatrixInfo.adDataV2.activityMiddlePageInfo.templateId;break;case 10:a=t.adMatrixInfo.adDataV2.rewardVideoTaskInfo.templateId;break;case 11:a=t.adMatrixInfo.adDataV2.pushTKInfo.templateId;break;case 13:a=t.adMatrixInfo.adDataV2.splashEndCardTKInfo.templateId;break;case 14:a=t.adMatrixInfo.adDataV2.videoLiveTKInfo.templateId;break;case 15:a=t.adMatrixInfo.adDataV2.installedActivateInfo.templateId;break;case 16:a=t.adMatrixInfo.adDataV2.videoImageTKInfo.templateId;break;case 100:a=t.adMatrixInfo.adDataV2.complianceCardInfo.templateId;break;case 101:a=t.adMatrixInfo.adDataV2.downloadConfirmCardInfo.templateId;break;case 17:a=t.adMatrixInfo.adDataV2.feedTKCardInfo.templateId;break;default:a=void 0}}catch(i){a=void 0}return a}function Z(t,e){let a=Q(t,e);if(console.log("tkloadcontroller target templateid:"+a),!p(a))return;const i=t.adMatrixInfo.adDataV2.templateDatas.length;for(let n=0;n<i;n++){let e=t.adMatrixInfo.adDataV2.templateDatas[n];if(e.templateId==a)return e}}function q(t,e){let a=Q(t,e);if(!a)return null;console.log("tkloadcontroller   get template is:"+a);const i=t.adMatrixInfo.adDataV2.templateDatas.length;for(let n=0;n<i;n++){let e=t.adMatrixInfo.styles.templates[n];if((null==e?void 0:e.templateId)==a)return e}return null}function tt(t,e){let a=q(t,e);return L(a)?null:a.templateUrl}function et(t,e){let a=!0;if(1==t.adBaseInfo.adOperationType)try{let i=t.downloadSafeInfo.complianceInfo;if(console.log("tkloadcontroller   download ad:"+JSON.stringify(i)),null!=i)switch(e){case 1:a=3!=i.actionBarType;break;case 2:a=3!=i.describeBarType;break;case 3:a=3!=i.materialJumpType;break;default:a=!0}}catch(i){a=!0}else try{let i=t.unDownloadConf.unDownloadRegionConf;if(console.log("tkloadcontroller   h5 ad:"+JSON.stringify(i)+", clickArea: "+e),null!=i)switch(e){case 1:a=1!=i.actionBarType;break;case 2:a=1!=i.describeBarType;break;case 3:a=1!=i.materialJumpType;break;default:a=!0}console.log("tkloadcontroller   h5 ad:"+a)}catch(i){a=!0}return a}function at(t){return J.isOriginLiveAd(t)||function(t){return 7==X(t)}(t)}function it(t,e){try{let a=e.adMatrixInfo.adDataV2.templateDatas;for(let e=0;e<a.length;e++){let i=a[e];if(i&&t==i.templateId)return i}}catch(a){}}let nt;function st(){var t;return nt||(nt={all:t=t||new Map,on(e,a){const i=t.get(e);i?i.push(a):t.set(e,[a])},off(e,a){const i=t.get(e);i&&(a?i.splice(i.indexOf(a)>>>0,1):t.set(e,[]))},emit(e,a){let i=t.get(e);i&&i.slice().map((t=>{t(a)})),i=t.get("*"),i&&i.slice().map((t=>{t(e,a)}))},clear(){t.clear()}}),nt}class lt{constructor(t,e,a,i,n,s,l){this.soundEnable=!1,this.ignoreCompliance=!1,this.disableDownloadDialog=!1,this.disableLeaveConfirm=!1,this.disableVideoWebPage=!1,this.disableActivityMiddlePage=!1,this.originAdInfo=t,this.deviceInfo=e,this.serverConfig=a,this.creativeId=s;let r=j(this.originAdInfo,s);this.adInfo=z(r),this.adCacheId=l||Tachikoma.env.adCacheId,this.originAdInfo.adCacheId=this.adCacheId,this.appId=n||Tachikoma.env.appId,this.scene=i||Tachikoma.env.adScene}}class rt{constructor(){this.reward_type=-1,this.task_type=-1,this.task_step=-1}static createPageShowInstance(t,e,a){if(0==e||L(a))return null;if(a.loadDataTime<=0||a.downloadFinishTime<=0)return null;let i=this.INVALID_VALUE;if(e!=this.INVALID_VALUE){i=Date.parse((new Date).toString())-e,i<this.INVALID_VALUE&&(i=this.INVALID_VALUE)}let n=new rt;return n.page_status=2,n.load_type=a.loadFromCache?2:1,n.render_duration_ms=i,n.download_type=a.downloadType,n.download_size=a.downloadSize,n.creative_id=t.adBaseInfo.creativeId,n.video_url=function(t){try{return t.adMaterialInfo.materialFeature[0].materialUrl}catch(e){}return""}(t),n.video_duration_ms=function(t){try{return t.adMaterialInfo.materialFeature[0].videoDuration}catch(e){}return 0}(t),n}}function ot(t){y.supportMinimumTKVersion("4.0.4")&&(t.msg&&(t.msg.report_source=1),Y.sendCommercialLog(t,(()=>{})))}rt.INVALID_VALUE=-1;class ct{static createVideoCommonInstance(t,e){return 3==t?ct.createFullscreenCommonInstance(e):2==t?ct.createNeoCommonInstance(e):null}static createImageCommonInstance(t,e){var a;let i=new x;return i.template_id=Q(e,16),i.template_version=null===(a=q(e,16))||void 0===a?void 0:a.templateVersion,i}static createLiveCommonInstance(t,e){var a;let i=new x;return i.template_id=Q(e,14),i.template_version=null===(a=q(e,14))||void 0===a?void 0:a.templateVersion,i}static createNeoCommonInstance(t){var e;let a=new x,i=J.getNeoActionBarCardType(t);return a.actionbar_card_type=i,a.template_id=Q(t,12),a.template_version=null===(e=q(t,12))||void 0===e?void 0:e.templateVersion,i!=B.LIVE_CUT3_STYLE1&&i!=B.LIVE_CUT3_STYLE2||(a.live_room_pattern=V.SIMPLIFIED_LIVE_ROOM_PATTERN),a}static createFullscreenCommonInstance(t){let e=new x,a=J.getFullscreenActionBarCardType(t);return e.actionbar_card_type=a,a!=B.LIVE_CUT3_STYLE1&&a!=B.LIVE_CUT3_STYLE2||(e.live_room_pattern=V.SIMPLIFIED_LIVE_ROOM_PATTERN),e}static appendNeoExtData(t,e,a,i){if(null==t)return;let n=t.neo_ext_data;null==n&&(n=new W,t.neo_ext_data=n),n.videoRollbackToImageTimeout=a.videoRollbackToImageTimeout,n.originalMaterialType=$(e),i&&n&&i(n)}}var dt=function(t,e,a,i){return new(a||(a=Promise))((function(n,s){function l(t){try{o(i.next(t))}catch(e){s(e)}}function r(t){try{o(i.throw(t))}catch(e){s(e)}}function o(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(l,r)}o((i=i.apply(t,e||[])).next())}))};class Ct{static sendLog(t,e,a,i){this.log(t,null,e,a,i)}static log(t,e,a,i,n){(a=a||{}).renderContainer=1;const s={actionType:t,payload:JSON.stringify(a)};if(n&&(s.creativeId=n),i)if(null==i?void 0:i.adCacheId)s.adCacheId=null==i?void 0:i.adCacheId;else{const t=j(i,n);s.adTemplate=JSON.stringify(t)}e&&(s.clickInfo=e),Y.sendLog(s)}static convertIfNeeded(t,e,a,i,n,s,r,o,c,d,C){if(!et(e,a))return;let h=l;L(h)||(s||(s=new x),L(s.template_id)&&(s.template_id=h.templateId),L(s.template_version)&&(s.template_version=h.templateVersion)),s=Ct.appendGlobalNeoExtData(s,e),at(e)&&this.reportLivePlaySecond(this.sCurrentPlayTimeMs/1e3),this.convert(a,i,n,t,s,r,o,c,d,C)}static convert(t,e,a,i,n,s,l,r,o,c){return dt(this,void 0,void 0,(function*(){const d=z(j(u(),r));if(!d||!et(d,t))return void console.log("tkloadcontroller invalid convert:"+d+":"+t);let g,p;g=L(n)?{itemClickType:a,renderContainer:1}:{itemClickType:a,renderContainer:1,clientExtData:JSON.stringify(n)},L(s)||Object.assign(g,s),st().emit("ad_convert_event",{clickType:a}),e?(p={x:e.x,y:e.y},e.width&&(p.width=e.width),e.height&&(p.height=e.height)):p={};let m=-1;if((null==l?void 0:l.convertType)&&(m=l.convertType,g.triggerType=m),console.log("tkloadcontroller begin conversion"),this.matchTKConversion()){console.log("tkloadcontroller match conversion service");let a=KSAdTKBundleService.getInstance("CommercialKSAdConversionService","conversion-service",null);if(a){console.log("tkloadcontroller service instance is:"+a);const n=new lt(o||u(),C(),h());return n.currentPlayTime=this.sCurrentPlayTimeMs,n.clickScene=i,n.convertType=m,n.creativeId=r,n.clickArea=t,n.soundEnable=this.sSoundEnable,(null==l?void 0:l.liveItemId)&&(n.liveItemId=l.liveItemId),Tachikoma.env.isDebug&&(f="TK转化链路开始",Y.callNativeWithCallback("showToast",{message:f})),Y.clickActionBase({isCallbackOnly:!0},A),a.getVersion()>=2&&(this.sSecondClickCallback=t=>{console.log("tkloadcontroller secondconfirm updatelifestatus status:"+t),0==t?Y.forceUpdateLifeStatus("pageInvisiable",!0):1==t?Y.forceUpdateLifeStatus("pageInvisiable",!1):2==t&&Y.forceUpdateLifeStatus("pageVisiable",!1)},a.setSecondConfirmCallback(this.sSecondClickCallback),a.getVersion()>=3&&y.supportMinimumTKVersion("5.1.3")&&T()&&(this.sDownloadTipCallback=t=>{switch(t){case 0:Y.adOutCallback({targetMethod:"adDownloadConfirmTipShow"});break;case 2:Y.adOutCallback({targetMethod:"adDownloadConfirmTipCancel"});break;case 1:Y.adOutCallback({targetMethod:"adDownloadConfirmTipDismiss"})}},a.setDownloadConfirmTipCallback(this.sDownloadTipCallback))),this.sHandleAdClickCallback=t=>{if(console.log("tkloadcontroller  handle click finish:"+t.success),this.sCurrentPlayTimeMs>0&&(g.playedDuration=this.sCurrentPlayTimeMs),t.reportExtraParam)try{let e=L(g.clientExtData)?{}:JSON.parse(g.clientExtData);e.clientExtData=JSON.parse(t.reportExtraParam),g.clientExtData=JSON.stringify(e)}catch(a){!function(t,e="",a=""){var i,n;ot({category:"ad_client_error_log",biz:"TACHIKOMA",sub_biz:"OTHER",rate:.1,suffixRatio:"",event_id:"ad_tk_render_performance",primaryKey:"unknown",type:"OTHER",msg:{render_state:3,error_reason:_(t),template_id:L(a)?null===(i=I())||void 0===i?void 0:i.templateId:a,version_code:L(e)?null===(n=I())||void 0===n?void 0:n.templateVersionCode:e}})}(a)}console.log("tkloadcontroller log payload:"+JSON.stringify(g)),this.log(2,e,g),y.isAndroid()||this.handleIOSConvertCallback(t)},void a.handleAdClick(JSON.stringify(n),this.sHandleAdClickCallback)}console.log("tkloadcontroller conversion service failed"),this.loadConversionServiceIfNeeded((t=>{console.log("tkloadcontroller service load result:"+t)}))}var A,f;console.log("tkloadcontroller mismatch conversion service");let v=null==o?void 0:o.impAdInfo[0];!function(t,e,a,i,n,s,l){Y.clickActionBase(Object.assign(Object.assign({area:t,logParam:e},a),{creativeId:i,adTemplate:s,disableCallback:l}),n)}(t,{payload:JSON.stringify(g),clickInfo:p,sceneType:i,itemClickType:a},l,r,(a=>{1!=a.result&&(this.log(2,e,g),Y.convert(1==t))}),v,c)}))}static handleIOSConvertCallback(t){t.success&&3==t.interactionType&&Y.adOutCallback({targetMethod:"closeConvertPageCallback",methodParams:JSON.stringify({interactionType:t.interactionType})})}static reportClick(t,e,a,i){null==i&&(i=new x),i=Ct.appendGlobalNeoExtData(i,t);let n={clientExtData:JSON.stringify(i)};n=Object.assign(n,a),Ct.log(2,null,n)}static appendGlobalNeoExtData(t,e){let a=h(),i=d();return null!=i&&null!=a&&(t||(t=new x),ct.appendNeoExtData(t,e,a.abConfig,(t=>{t.realRenderResult=i}))),t}static expose(t,e){this.log(1,null,t,e)}static exposeElement(t,e){(e=e||{}).elementType=t,this.log(140,null,e)}static clickElement(t){const e={elementType:t};this.log(141,null,e)}static convertWithTypeIfNeeded(t,e,a,i,n){this.convertWithType(e,a,i,n)}static convertWithType(t,e,a,i){this.convert(t,e,a,0,null,null,{convertType:i})}static convertWithTypeIfNeededNew(t,e,a,i,n,s){et(t,e)&&this.convertWithTypeNew(e,a,i,n,s)}static convertWithTypeNew(t,e,a,i,n){this.convert(t,e,a,0,null,n,{convertType:i})}static playNSecond(t,e){let a={photoPlaySecond:t};if(e){let t={clientExtData:JSON.stringify(e)};Object.assign(a,t)}this.log(402,null,a)}static playStart(t){let e=null;t&&(e={clientExtData:JSON.stringify(t)}),Ct.log(399,null,e)}static reportLivePlaySecond(t){let e={photoPlaySecond:Math.round(t)},a={actionType:28,payload:JSON.stringify(e)};Y.sendLog(a)}static skip(){this.log(501,null,null)}static loadConversionServiceIfNeeded(t){this.matchTKConversion()&&KSAdTKBundleService.loadBundle("CommercialKSAdConversionService",t),t&&t(!1)}static matchTKConversion(){var t,e,a,i;return console.log("tkloadcontroller  tkconversionswitch:"+(null===(e=null===(t=h())||void 0===t?void 0:t.abConfig)||void 0===e?void 0:e.tkConversionSwitch)),console.log("tkloadcontroller  tkconversionswitch:"+JSON.stringify(C())),(null===(i=null===(a=h())||void 0===a?void 0:a.abConfig)||void 0===i?void 0:i.tkConversionSwitch)&&y.supportMinimumTKVersion("5.1.3")}static updateVideoPlayStatus(t,e,a,i){!function(t,e,a,i){Y.callNativeWithCallback("updateVideoPlayStatus",{status:t,errorCode:e||0,errorReason:a||"",currentTime:i||0})}(t,e,a,i),"progress"==t&&i&&(this.sCurrentPlayTimeMs=i)}static updateLivePlayStatus(t,e,a,i){"progress"==t&&i&&(this.sCurrentPlayTimeMs=i)}}Ct.sSoundEnable=!1;class ht{constructor(){this.renderCalled=!1,this.renderStatusCalled=!1,this.rootView=new TKView,this.rootView.style={width:"100%",height:"100%"}}render(){return!this.renderCalled&&(this.renderCalled=!0,!0)}updateRenderStatus(t,e=""){this.renderCalled&&!this.renderStatusCalled&&(this.renderStatusCalled=!0,Y.pageStatus(t,e),this.registerNativeId(),Ct.loadConversionServiceIfNeeded((t=>{})))}registerNativeId(){1==Tachikoma.env.isDebug&&y.supportMinimumTKVersion("4.0.7")&&!y.isAndroid()&&(this.startConfig(),Y.registerNativeId((t=>{t&&t.data&&this.startConfig()})))}startConfig(){this.configNativeIdTimer&&clearTimeout(this.configNativeIdTimer),this.configNativeIdTimer=setTimeout((()=>{E(this)}),120)}}class ut extends TKView{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.refreshCountDownText(),this.startGroupAnimation(),this.vm.countDown>0&&(this.timer=setInterval((()=>{this.countDownAction()}),1e3)),this.vm.closeCardImpression())}setupViews(){this.style={width:"100%",height:"100%",opacity:0,backgroundColor:"#000000C0",flexDirection:"column",justifyContent:"center",alignItems:"center"};let t=new TKView;t.style={width:"100%",backgroundColor:"#00000000",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(t),this.titleImage=new TKImage,this.titleImage.style={height:96,width:282,resize:"contain"},this.titleImage.setSrc("image/ksad-video-web-close-card/ksad_web_close_dialog_flag_title.png"),t.appendChild(this.titleImage),this.turntableImage=new TKImage,this.turntableImage.style={width:375,height:375,transform:{scale:.8},resize:"cover"},this.turntableImage.addEventListener("tap",(t=>{this.showAggregationMiddle()})),D(this.turntableImage,"ksad_web_close_agg_mid_turntable.png"),t.appendChild(this.turntableImage);let e=new TKView;e.style={width:202,height:52,flexDirection:"column"},e.addEventListener("tap",(t=>{this.clickAction()}));let a=new TKImage;this.clickButton=new TKText,a.style={height:"100%",width:"100%"},D(a,"ksad_web_close_agg_mid_button.png"),this.clickButton=new TKText,this.clickButton.style={width:202,height:52,textAlign:"center",alignSelf:"center",position:"absolute",color:"#FFFFFF",fontWeight:"500",fontSize:18},e.appendChild(a),e.appendChild(this.clickButton),t.appendChild(e),this.closeButton=new TKImage,this.closeButton.style={marginTop:26,width:27,height:27},this.closeButton.setSrc("image/ksad-video-web-close-card/ksad_web_close_agg_mid_close.png"),this.closeButton.addEventListener("tap",(t=>{this.vm.closeAction()})),t.appendChild(this.closeButton),this.guidanceImage=new TKImage,this.guidanceImage.style={marginTop:this.getGuidanceImageMarginTop(),marginLeft:this.getGuidanceImageMarginLeft(),height:this.getGuidanceImageWH(),width:this.getGuidanceImageWH(),opacity:0},this.appendChild(this.guidanceImage),D(this.guidanceImage,"icon_ksad_hand_touch_guide.png")}clickAction(){this.showAggregationMiddle()}showAggregationMiddle(){this.vm.showAggregationMiddle(),this.stopCountDown()}countDownAction(){this.vm.countDown--,this.refreshCountDownText(),0==this.vm.countDown&&(this.stopCountDown(),this.vm.showAggregationMiddle())}stopCountDown(){clearInterval(this.timer),this.guidanceImage.removeAllAnimation()}refreshCountDownText(){this.clickButton.setText("立刻抽奖 ("+this.vm.countDown+"s)")}getGuidanceImageWH(){return 63}getGuidanceImageMarginTop(){return-this.getGuidanceImageWH()-20}getGuidanceImageMarginLeft(){return this.getGuidanceImageWH()+100}startGroupAnimation(){this.startTurntableImageAnimation(),this.startBaseAnimation((()=>{this.startGuidanceImageShowAnimation()}))}startGuidanceImageShowAnimation(){const t=function(t,e,a=!1){const i=new TKKeyframeAnimation;return a?(i.setAnimations([()=>(t.style={opacity:1},1)]),i.timingFunction="ease-in-out"):(i.animType="opacity",i.keyframes=[{percent:0,value:0,easing:"EaseInEaseOut"},{percent:1,value:1,easing:"EaseInEaseOut"}]),i.duration=e,i}(this.guidanceImage,200,!0);this.guidanceImage.addAnimation(t,"guidanceImageShowAnimation");const e=this;t.on("end",(()=>{e.startGuidanceImageMoveAnimation()}))}startGuidanceImageMoveAnimation(){const t=this;let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.guidanceImage.style={top:0,left:0},.33),()=>(t.guidanceImage.style={top:10,left:10},.66),()=>(t.guidanceImage.style={top:0,left:0},1)]),e.duration=450,e.repeatCount=10,this.guidanceImage.addAnimation(e,"guidanceImageMoveAnimation")}startTurntableImageAnimation(){const t=this;let e=new TKKeyframeAnimation;e.setAnimations([()=>(t.turntableImage.style={transform:{scale:.8}},.33),()=>(t.turntableImage.style={transform:{scale:1}},1)]),e.duration=300,e.repeatCount=1,this.turntableImage.addAnimation(e,"turntableImageAnimation")}startBaseAnimation(t){const e=this;let a=new TKKeyframeAnimation;return a.setAnimations([()=>(e.style={opacity:0},0),()=>(e.style={opacity:1},1)]),a.duration=300,a.repeatCount=1,a.timingFunction="linear",this.addAnimation(a,"baseAnimation"),a.on("end",(()=>{t&&t()})),a}}class It extends TKView{}class _t extends It{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&(this.setupViews(),this.closeCardImpression())}setupViews(){this.style={width:270,height:328,borderRadius:20,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"center",alignItems:"center"},this.titleLabel=new TKText,this.titleLabel.style={textAlign:"center",width:222,height:22,fontSize:16,color:"#222222",top:-20,fontWeight:"bold"};const t=this.vm.getCardTitile(),e=this.createFontSizeSpanItem(2,2+this.vm.getVideoCloseTime().length),a=new TKSpan;a.addSpan(e),this.titleLabel.setSpan(t,a),this.appendChild(this.titleLabel),this.subTitleLabel=new TKText,this.subTitleLabel.style={textAlign:"center",position:"absolute",width:222,height:22,fontSize:16,color:"#222222",top:50,fontWeight:"bold"},this.subTitleLabel.setText("现在放弃太可惜了"),this.appendChild(this.subTitleLabel),this.appIcon=new TKImage,this.appIcon.style={width:113,height:140,top:15},this.appIcon.setSrc("image/ksad-video-web-close-card/ksad_web_close_dialog_flag_image.png"),this.appendChild(this.appIcon);let i=new TKView;i.style={width:"100%",top:27,flexDirection:"column",justifyContent:"center",alignItems:"center"},this.appendChild(i);let n=new TKText;n.style={width:222,height:36,borderRadius:20,fontSize:14,textAlign:"center",color:"#FFFFFF",backgroundColor:"#FE3666",fontWeight:"bold"},n.setText("继续观看"),n.addEventListener("tap",(()=>{this.closePage()})),i.appendChild(n);let s=new TKText;s.style={marginTop:16,height:17,fontSize:12,color:"#9C9C9C"},s.setText("放弃奖励"),s.addEventListener("tap",(()=>{this.abandonAction()})),i.appendChild(s)}createFontSizeSpanItem(t,e){const a=new TKSpanItem;return a.spanType="foregroundColor",a.color="#FE3666",a.size=16,a.start=t,a.end=e,a.textStyle="bold",a}abandonAction(){let t=new x;t.award_task_name=this.vm.getRewardTaskName();let e={elementType:151,clientExtData:JSON.stringify(t)},a={actionType:141,payload:JSON.stringify(e)};Y.sendLog(a),Y.closePassData({interactSuccess:!1})}closePage(){let t=new x;t.award_task_name=this.vm.getRewardTaskName();let e={clientExtData:JSON.stringify(t)},a={actionType:451,payload:JSON.stringify(e)};Y.sendLog(a),Y.closePassData({interactSuccess:!0})}closeCardImpression(){let t=new x;t.award_task_name=this.vm.getRewardTaskName();let e={elementType:149,clientExtData:JSON.stringify(t)},a={actionType:140,payload:JSON.stringify(e)};Y.sendLog(a)}}class gt extends Object{constructor(t,e,a,i){var n;super(),this.depIds={},this.vm=t,this.getter="function"==typeof e?e:this.parseGetter(e.trim()),this.cb=a,this.value=this.get(),this.cb(null!==(n=this.value)&&void 0!==n?n:i,null),console.log("Watcher on "+e)}update(){const t=this.get();t!=this.value&&(this.cb.call(this.vm,t,this.value),this.value=t)}addDep(t){const e=t.pid;this.depIds.hasOwnProperty(e)||(t.addDep(this),this.depIds[e]=t)}get(){gt.target=this;const t=this.getter.call(this.vm,this.vm);return gt.target=null,t}parseGetter(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let a=0,i=e.length;a<i;a++){if(!t)return;t=t[e[a]]}return t}}}let Tt;function pt(){if(null!=Tt)return Tt;let t=!1;try{t=!1,Tt=t}catch(e){}return t}function mt(t){pt()&&console.log("tachikoma TKMVVM log -> "+t)}class At extends Object{constructor(t,e){super(),this.object=t,this.observeKey=e,this._observe(t,e)}_observe(t,e){var a=this;Array.isArray(t)?this.defineArray(t):Object.keys(t).forEach((function(i){e?e===i&&a.observeValueWithKey(t,i):a.observeValueWithKey(t,i)}))}observeValueWithKey(t,e){let a=t[e];var i=new Lt(e);vt(a);Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:function(){return gt.target&&i.depend(),a},set:function(t){t!==a&&(a=t,i.notify(),vt(t))}})}defineArray(t){if(t)for(let e=0,a=t.length;e<a;e++)vt(t[e])}}var ft=0;class Lt extends Object{constructor(t){super(),this.key=t,this.pid=ft++,this.deps=new Array}depend(){gt.target.addDep(this)}addDep(t){this.deps.push(t)}removeDep(t){}notify(){this.deps.forEach((function(t){t.update()}))}}function vt(t,e){if(!t||"object"!=typeof t)return;var a;if(!("object"==typeof(a=t)&&Object.keys(a).length>0))return;let i=!1,n=(null!=e?e:"")+"_tkmvvm_observed";if(t.hasOwnProperty(n)&&(i=t[n]),!i)return mt("observe "+n),t[n]=!0,new At(t,e);mt("already observe "+n)}class Et extends Object{constructor(){super()}tk_observe(t){t&&(t in this?vt(this,t):console.log("=====++++++ observe2: key not in this:"+t+":"+typeof this))}}class Nt extends Et{constructor(){super(),this.$attrsPath=new Proxy(this,{get:(t,e)=>Dt(t,e)})}getData(t){}}function Dt(t,e){return new Proxy({$vm:t,$bind_path:e},{get:(a,i)=>"string"!=typeof i||"function"==typeof a[i]||0==i.indexOf("$")?Reflect.get(a,i):Dt(t,e+"."+i)})}class yt extends Nt{constructor(){super(...arguments),this.isPreLandingPage=!1,this.countDown=0}getVideoCloseTime(){try{return`${this.videoCloseTime.videoCloseTime}`}catch(t){return"1"}}getCardTitile(){return`还差${this.getVideoCloseTime()}秒即可领取免广告权益`}getRewardTaskName(){return"UNION_NEO_DEEP_TRANS"}closeCardImpression(){let t=new x;3==this.getWebCloseConfirmType()&&(t.is_new_load_agg=1);let e={elementType:149,clientExtData:JSON.stringify(t)};Ct.log(140,{x:0,y:0},e)}closeCardElementClick(){let t=new x;3==this.getWebCloseConfirmType()&&(t.is_new_load_agg=1);let e={elementType:149,clientExtData:JSON.stringify(t)};Ct.log(141,{x:0,y:0},e)}closeAction(){Y.closePassData({interactSuccess:!0})}showAggregationMiddle(){let t=tt(this.adInfo,7);p(t)&&(Y.openURL(t,"聚合中间页"),this.closeCardElementClick()),setTimeout((()=>{this.closeAction()}),100)}initCountDownData(){try{let t=function(t){if(null==t)return;let e=null;try{e=JSON.parse(t.data).aggregationMiddleConfirmInfo}catch(a){}return e}(it(this.adInfo.adMatrixInfo.adDataV2.rewardWebTaskCloseInfo.templateId,this.adInfo));t&&t.delayTime&&(this.countDown=t.delayTime/1e3)}catch(t){this.countDown=3}this.countDown<=0&&(this.countDown=3)}getWebCloseConfirmType(){let t=function(t){try{return t.adMatrixInfo.adDataV2.rewardWebTaskCloseInfo.webConfirmCardType}catch(e){}return 0}(this.adInfo);return L(t)?0:t}}class kt extends yt{getData(t){let e=[];e.push(Y.getKsAdDataAsync()),e.push(Y.getDeviceInfoAsync()),e.push(Y.getKsAdConfigAsync()),e.push(Y.getContainerLimitAsync()),e.push(Y.getScreenOrientationAsync()),e.push(Y.getVideoCloseTime()),g()&&e.push(Y.getTKPreEnvAsync()),Promise.all(e).then((e=>{try{const i=e[0].data,n=e[1].data,s=e[2].data,l=e[3].data,r=e[4].data,o=e[5].data;if(this.adInfo=i.impAdInfo[0].adInfo[0],this.adStyle=i.impAdInfo[0].adStyle,this.screenOrientation=r,this.configInfo=s,this.containerLimit=l,this.videoCloseTime=o,g())try{const t=e[6].data;this.isPreLandingPage=t.isPreLandingPage}catch(a){this.isPreLandingPage=!1}this.initDatas(),c(n),this.registerLifeCycleListener(),t&&t(!0)}catch(a){t&&t(!1)}}))}initDatas(){this.initCountDownData()}checkDataValid(){return!!this.adInfo}registerLifeCycleListener(){Y.registerLifecycleListener((t=>{if(t&&t.data){switch(t.data.lifeStatus){case"showStart":this.willAppear();break;case"showEnd":this.didAppear();break;case"hideStart":this.willDisappear();break;case"hideEnd":this.didDisappear()}}}))}willAppear(){}willDisappear(){}didAppear(){}didDisappear(){this.didDisappearCallback&&this.didDisappearCallback()}}class Rt extends TKView{constructor(t){super(),this.vm=t,this.vm.checkDataValid()&&this.setupViews()}setupViews(){this.style={width:271,height:138,borderRadius:12,backgroundColor:"#FFFFFF",flexDirection:"column",justifyContent:"flex-start",alignItems:"center"},this.titleLabel=new TKText,this.titleLabel.style={textAlign:"center",width:"100%",height:89,fontSize:16,color:"#222222"},this.titleLabel.setText("真的不再看看了吗"),this.appendChild(this.titleLabel);const t=new TKView;t.style={backgroundColor:"#F5F5F5",height:1,width:"100%"},this.appendChild(t);let e=new TKView;e.style={width:"100%",height:46,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"},this.skipBtn=new TKText,this.skipBtn.style={width:"50%",height:"100%",color:"#9C9C9C",textAlign:"center",fontSize:14},this.skipBtn.setText("残忍离开"),e.appendChild(this.skipBtn),this.appendChild(e),this.skipBtn.addEventListener("tap",(t=>{this.handleAbandon()}));const a=new TKView;a.style={backgroundColor:"#F5F5F5",height:"100%",width:1},e.appendChild(a),this.continueBtn=new TKText,this.continueBtn.style={width:"50%",height:"100%",color:"#FE3666",textAlign:"center",fontSize:14},this.continueBtn.setText("留下看看"),e.appendChild(this.continueBtn),this.continueBtn.addEventListener("tap",(t=>{this.handleContinue()}))}handleAbandon(){let t={actionType:141,payload:JSON.stringify({elementType:151})};Y.sendLog(t),Y.skipVideo(!1,!0,0)}handleContinue(){let t={actionType:451,payload:JSON.stringify({elementType:150})};Y.sendLog(t),Y.closeTKDialog("ksad-video-web-close-card")}}(new class extends ht{constructor(){super(),this.vm=new kt}setupViews(){this.rootView.style={width:"100%",height:"100%",backgroundColor:"#00000080",alignItems:"center",justifyContent:"center"},this.contentView=this.getContentView(),this.rootView.appendChild(this.contentView)}getContentView(){let t;return this.vm.isPreLandingPage?(t=new Rt(this.vm),t):3==this.vm.getWebCloseConfirmType()?(t=new ut(this.vm),t):(t=new _t(this.vm),t)}render(){if(!super.render())return!1;try{this.vm.getData((t=>{if(t)try{this.setupViews(),Tachikoma.render(this.rootView),this.updateRenderStatus(1,"")}catch(e){this.updateRenderStatus(0,_(e))}else this.updateRenderStatus(0,"data invalid")}))}catch(t){this.updateRenderStatus(0,_(t))}return!0}}).render()})();
//# sourceMappingURL=ksad-video-web-close-card.116.js.map